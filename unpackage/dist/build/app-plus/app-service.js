if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a(e,t){return"string"==typeof e?t:e}const o=t=>(a,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,o)},n=o("onShow"),l=o("onLoad"),i=o("onReachBottom"),s=o("onPullDownRefresh"),c="/static/search.png",r="/static/cancel.png",d="http://localhost:8080",u="https://images1.fantuanpu.com/";let m=e.reactive({isLogin:!1,userInfo:{}});function p(){uni.showToast({title:"请在微信小程序中登录",icon:"none"})}function g(){const e=uni.getStorageSync("token");if(t("log","at common/config.js:81","token:",e),!e)return t("log","at common/config.js:83","没有token，无法获取用户信息"),void f();t("log","at common/config.js:87","请求接口"),uni.request({url:`${d}/with-state/mine`,method:"GET",header:{Authorization:e},success:e=>{const a=e.data.data;a?(t("log","at common/config.js:97","获取用户信息成功,进行存储",a),v(a)):(t("log","at common/config.js:100","无法获取，清理用户状态"),f())},fail:e=>{y(e,"获取用户信息失败")}})}function h(){return new Promise(((e,a)=>{const o=uni.getStorageSync("token");if(!o)return f(),void e(null);uni.request({url:`${d}/with-state/mine`,method:"GET",header:{Authorization:o},success:a=>{const o=a.data.data;o?(t("log","at common/config.js:131","返回：",o),v(o),e(o)):(f(),e(null))},fail:t=>{y(t,"获取用户信息失败"),e(null)}})}))}function v(e){uni.setStorageSync("userInfo",e),uni.setStorageSync("token",e.last_token),m.userInfo=e,m.isLogin=!0}function f(){uni.removeStorageSync("userInfo"),m.userInfo={},m.isLogin=!1}function y(e,a="请求失败"){t("error","at common/config.js:246",e),uni.showToast({title:a,icon:"none"})}const w=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a},k=w({__name:"goods-search",props:{modelValue:{type:String,default:""},width:{type:String,default:"100%"},background:{type:String,default:""},fontSize:{type:String,default:""},tagColor:{type:String,default:"#666"},mode:{type:String,default:"jump",validator:e=>["jump","fill"].includes(e)},hiddenIcon:{type:Boolean,default:!0}},emits:["select","update:modelValue"],setup(a,{emit:o}){const n=e.ref(!1),l=a,i=o,s=e.ref([]),d=e.computed({get:()=>l.modelValue,set:e=>i("update:modelValue",e)});e.watch(s,(e=>{n.value=e.length>0}));const u=()=>{s.value=[],n.value=!1},m=async e=>{var a;d.value=e.detail.value;const o=e.detail.value.trim();if(n.value=!0,o)try{const e=await uni.request({url:`http://localhost:8080/search-goods?search=${encodeURIComponent(o)}`,method:"GET"});s.value="success"===(null==(a=e.data)?void 0:a.status)&&e.data.data||[]}catch(l){t("error","at components/goods-search/goods-search.vue:114","搜索失败:",l),s.value=[]}else s.value=[]},p=()=>{u()};return(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"mask-layer",onClick:u})):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["search_tab",t.$attrs.class]),style:e.normalizeStyle({background:a.background||"#fff"})},[a.hiddenIcon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("image",{key:0,class:"icon_image",src:c})),e.createElementVNode("input",{class:"common_search_input",placeholder:"请输入商品名称...",value:d.value,onInput:m,style:e.normalizeStyle({fontSize:a.fontSize||"22rpx"})},null,44,["value"]),s.value.length>0?(e.openBlock(),e.createElementBlock("image",{key:1,class:"icon_image",src:r,onClick:p})):e.createCommentVNode("",!0)],6),s.value.length>0?(e.openBlock(),e.createElementBlock("scroll-view",{key:1,class:"search_results",style:e.normalizeStyle({width:a.width}),"scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"result_item",onClick:e=>{return a=t,"jump"===l.mode&&uni.navigateTo({url:`/pages/goods/goods?goods_id=${a.id}`}),"fill"===l.mode&&(i("select",a),d.value=a.name,s.value=[]),void u();var a}},[t.brand_name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"brand-tag"},e.toDisplayString(t.brand_name),1)):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))],4)):e.createCommentVNode("",!0)],64))}},[["__scopeId","data-v-71625943"]]),_=w({__name:"index-brand",props:["brand","key"],setup(t){const a=t;function o(){uni.navigateTo({url:"/pages/brand/brand?brand_id="+a.brand.id})}return(a,n)=>(e.openBlock(),e.createElementBlock("view",{class:"brand-card",key:t.key},[e.createElementVNode("view",{class:"brand-header",onClick:o},[e.createElementVNode("image",{class:"brand-logo",src:t.brand.logo_image,mode:"aspectFit"},null,8,["src"]),e.createElementVNode("view",{class:"brand-meta"},[e.createElementVNode("view",{class:"title-row"},[e.createElementVNode("text",{class:"brand-title"},e.toDisplayString(t.brand.brand_name),1),e.createElementVNode("text",{class:"brand-tag"},e.toDisplayString(t.brand.country_name)+"·"+e.toDisplayString(t.brand.type),1),e.createElementVNode("text",{class:"goods-count"},"收录"+e.toDisplayString(t.brand.total_goods)+"款",1)]),e.createElementVNode("text",{class:"brand-desc"},e.toDisplayString(t.brand.description),1)])]),e.createElementVNode("scroll-view",{class:"goods-scroll","scroll-x":"","show-scrollbar":!1},[e.createElementVNode("view",{class:"goods-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.brand.goods,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"goods-item",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/goods/goods?goods_id="+a});var a}},[e.createElementVNode("image",{class:"goods-image",src:t.goods_images[0],mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])])]))}},[["__scopeId","data-v-4619086d"]]),E=[{font_class:"arrow-down",unicode:""},{font_class:"arrow-left",unicode:""},{font_class:"arrow-right",unicode:""},{font_class:"arrow-up",unicode:""},{font_class:"auth",unicode:""},{font_class:"auth-filled",unicode:""},{font_class:"back",unicode:""},{font_class:"bars",unicode:""},{font_class:"calendar",unicode:""},{font_class:"calendar-filled",unicode:""},{font_class:"camera",unicode:""},{font_class:"camera-filled",unicode:""},{font_class:"cart",unicode:""},{font_class:"cart-filled",unicode:""},{font_class:"chat",unicode:""},{font_class:"chat-filled",unicode:""},{font_class:"chatboxes",unicode:""},{font_class:"chatboxes-filled",unicode:""},{font_class:"chatbubble",unicode:""},{font_class:"chatbubble-filled",unicode:""},{font_class:"checkbox",unicode:""},{font_class:"checkbox-filled",unicode:""},{font_class:"checkmarkempty",unicode:""},{font_class:"circle",unicode:""},{font_class:"circle-filled",unicode:""},{font_class:"clear",unicode:""},{font_class:"close",unicode:""},{font_class:"closeempty",unicode:""},{font_class:"cloud-download",unicode:""},{font_class:"cloud-download-filled",unicode:""},{font_class:"cloud-upload",unicode:""},{font_class:"cloud-upload-filled",unicode:""},{font_class:"color",unicode:""},{font_class:"color-filled",unicode:""},{font_class:"compose",unicode:""},{font_class:"contact",unicode:""},{font_class:"contact-filled",unicode:""},{font_class:"down",unicode:""},{font_class:"bottom",unicode:""},{font_class:"download",unicode:""},{font_class:"download-filled",unicode:""},{font_class:"email",unicode:""},{font_class:"email-filled",unicode:""},{font_class:"eye",unicode:""},{font_class:"eye-filled",unicode:""},{font_class:"eye-slash",unicode:""},{font_class:"eye-slash-filled",unicode:""},{font_class:"fire",unicode:""},{font_class:"fire-filled",unicode:""},{font_class:"flag",unicode:""},{font_class:"flag-filled",unicode:""},{font_class:"folder-add",unicode:""},{font_class:"folder-add-filled",unicode:""},{font_class:"font",unicode:""},{font_class:"forward",unicode:""},{font_class:"gear",unicode:""},{font_class:"gear-filled",unicode:""},{font_class:"gift",unicode:""},{font_class:"gift-filled",unicode:""},{font_class:"hand-down",unicode:""},{font_class:"hand-down-filled",unicode:""},{font_class:"hand-up",unicode:""},{font_class:"hand-up-filled",unicode:""},{font_class:"headphones",unicode:""},{font_class:"heart",unicode:""},{font_class:"heart-filled",unicode:""},{font_class:"help",unicode:""},{font_class:"help-filled",unicode:""},{font_class:"home",unicode:""},{font_class:"home-filled",unicode:""},{font_class:"image",unicode:""},{font_class:"image-filled",unicode:""},{font_class:"images",unicode:""},{font_class:"images-filled",unicode:""},{font_class:"info",unicode:""},{font_class:"info-filled",unicode:""},{font_class:"left",unicode:""},{font_class:"link",unicode:""},{font_class:"list",unicode:""},{font_class:"location",unicode:""},{font_class:"location-filled",unicode:""},{font_class:"locked",unicode:""},{font_class:"locked-filled",unicode:""},{font_class:"loop",unicode:""},{font_class:"mail-open",unicode:""},{font_class:"mail-open-filled",unicode:""},{font_class:"map",unicode:""},{font_class:"map-filled",unicode:""},{font_class:"map-pin",unicode:""},{font_class:"map-pin-ellipse",unicode:""},{font_class:"medal",unicode:""},{font_class:"medal-filled",unicode:""},{font_class:"mic",unicode:""},{font_class:"mic-filled",unicode:""},{font_class:"micoff",unicode:""},{font_class:"micoff-filled",unicode:""},{font_class:"minus",unicode:""},{font_class:"minus-filled",unicode:""},{font_class:"more",unicode:""},{font_class:"more-filled",unicode:""},{font_class:"navigate",unicode:""},{font_class:"navigate-filled",unicode:""},{font_class:"notification",unicode:""},{font_class:"notification-filled",unicode:""},{font_class:"paperclip",unicode:""},{font_class:"paperplane",unicode:""},{font_class:"paperplane-filled",unicode:""},{font_class:"person",unicode:""},{font_class:"person-filled",unicode:""},{font_class:"personadd",unicode:""},{font_class:"personadd-filled",unicode:""},{font_class:"personadd-filled-copy",unicode:""},{font_class:"phone",unicode:""},{font_class:"phone-filled",unicode:""},{font_class:"plus",unicode:""},{font_class:"plus-filled",unicode:""},{font_class:"plusempty",unicode:""},{font_class:"pulldown",unicode:""},{font_class:"pyq",unicode:""},{font_class:"qq",unicode:""},{font_class:"redo",unicode:""},{font_class:"redo-filled",unicode:""},{font_class:"refresh",unicode:""},{font_class:"refresh-filled",unicode:""},{font_class:"refreshempty",unicode:""},{font_class:"reload",unicode:""},{font_class:"right",unicode:""},{font_class:"scan",unicode:""},{font_class:"search",unicode:""},{font_class:"settings",unicode:""},{font_class:"settings-filled",unicode:""},{font_class:"shop",unicode:""},{font_class:"shop-filled",unicode:""},{font_class:"smallcircle",unicode:""},{font_class:"smallcircle-filled",unicode:""},{font_class:"sound",unicode:""},{font_class:"sound-filled",unicode:""},{font_class:"spinner-cycle",unicode:""},{font_class:"staff",unicode:""},{font_class:"staff-filled",unicode:""},{font_class:"star",unicode:""},{font_class:"star-filled",unicode:""},{font_class:"starhalf",unicode:""},{font_class:"trash",unicode:""},{font_class:"trash-filled",unicode:""},{font_class:"tune",unicode:""},{font_class:"tune-filled",unicode:""},{font_class:"undo",unicode:""},{font_class:"undo-filled",unicode:""},{font_class:"up",unicode:""},{font_class:"top",unicode:""},{font_class:"upload",unicode:""},{font_class:"upload-filled",unicode:""},{font_class:"videocam",unicode:""},{font_class:"videocam-filled",unicode:""},{font_class:"vip",unicode:""},{font_class:"vip-filled",unicode:""},{font_class:"wallet",unicode:""},{font_class:"wallet-filled",unicode:""},{font_class:"weibo",unicode:""},{font_class:"weixin",unicode:""}];const N=w({name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:E}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(){this.$emit("click")}}},[["render",function(t,a,o,n,l,i){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(i.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+o.type,o.customPrefix,o.customPrefix?o.type:""]]),onClick:a[0]||(a[0]=(...e)=>i._onClick&&i._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-1320ff52"]]),V=w({__name:"common-page",props:{head_color:{type:String,default:"#ffffff"}},emits:["scroll"],setup(t,{emit:a}){e.useCssVars((e=>({"43728dce":i.value,"49412a7e":t.head_color,b56d4348:s.value})));const o=a,n=e=>{o("scroll",e.detail)},l=uni.getSystemInfoSync();e.computed((()=>0));const i=e.computed((()=>"calc(constant(safe-area-inset-top) + 20px)")),s=e.computed((()=>{var e;return`${((null==(e=l.safeAreaInsets)?void 0:e.bottom)||0)+20}px`}));return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"header-placeholder"}),e.createElementVNode("view",{class:"content-container"},[e.createElementVNode("scroll-view",{class:"main-content","scroll-y":"",onScroll:n},[e.renderSlot(t.$slots,"default",{},void 0,!0)],32)]),e.createElementVNode("view",{class:"footer-placeholder"})]))}},[["__scopeId","data-v-23f6b016"]]),b="/static/main/2.png",x=w({__name:"index",setup(o){let n=e.ref([]),c=e.ref({});const r=e.ref([{label:"中国娃社",value:1},{label:"个人作者",value:2},{label:"外国娃社",value:3}]),u=e.ref(1);e.ref(0),uni.getSystemInfoSync(),e.ref(0);const p=e.ref(1),h=e.ref(10),v=e.ref(!0),f=e.ref(!1);let y=e.ref([]);const w=e.ref(1),E=e.ref(10),x=e.ref(!0),B=e.ref(!1);let S=e.ref([]);const C=e.ref(1),T=e.ref(10),D=e.ref(!0),z=e.ref(!1);let I=e.ref([]);const $=e.ref(1),F=e.ref(10),L=e.ref(!0),P=e.ref(!1),R=e.ref("news"),q=e=>{R.value=e};s((async()=>{try{await M(),uni.stopPullDownRefresh()}catch(e){uni.stopPullDownRefresh(),uni.showToast({title:"刷新失败",icon:"none"})}}));const M=async()=>{const e={brands:()=>{p.value=1,n.value=[],v.value=!0,U(!0)},news:()=>{w.value=1,y.value=[],x.value=!0,j(!0)},hot:()=>{C.value=1,S.value=[],D.value=!0,O(!0)},second:()=>{$.value=1,I.value=[],L.value=!0,H(!0)}};await e[R.value](),A()};const A=()=>{uni.request({url:d+"/articles",data:{page:1,page_size:10,status:1},success:e=>{"success"===e.data.status&&(c.value=e.data.data.list)},fail:e=>{t("error","at pages/index/index.vue:426","获取Banner失败:",e),c.value={}}})};const j=async(e=!1)=>{e&&(w.value=1),x.value&&!B.value&&(B.value=!0,uni.showLoading(),uni.request({url:d+"/sale-news",data:{page:w.value,pageSize:E.value},success:e=>{const t=e.data.data.news_list;0!==t.length?(y.value=[...y.value,...t],x.value=e.data.data.news_list.length===E.value,w.value++):x.value=!1},fail:e=>{t("log","at pages/index/index.vue:495",e),uni.showToast({title:"加载失败",icon:"none"})},complete:()=>{B.value=!1,uni.hideLoading()}}))};const O=async(e=!1)=>{e&&(C.value=1),D.value&&!z.value&&(z.value=!0,uni.showLoading(),uni.request({url:d+"/hot-collocation",data:{page:C.value,pageSize:T.value},success:e=>{const t=e.data.data.collocation_relation_list;0!==t.length?(S.value=[...S.value,...t.map((e=>({...e})))],D.value=S.value.length<e.data.data.total,C.value++):D.value=!1},fail:e=>{t("log","at pages/index/index.vue:541",e),uni.showToast({title:"加载失败",icon:"none"})},complete:()=>{z.value=!1,uni.hideLoading()}}))};const U=async(e=!1)=>{e&&(p.value=1),v.value&&!f.value&&(f.value=!0,uni.showLoading(),uni.request({url:d+"/brands",data:{page:p.value,pageSize:h.value,...u.value&&{searchType:u.value}},success:e=>{const t=e.data.data.brands_list;0!==t.length?(n.value=[...n.value,...t],v.value=n.value.length<e.data.data.total,p.value++):v.value=!1},fail:e=>{t("log","at pages/index/index.vue:592",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{f.value=!1,uni.hideLoading()}}))},H=async(e=!1)=>{e&&($.value=1),L.value&&!P.value&&(P.value=!0,uni.showLoading(),uni.request({url:d+"/treehole-submissions",data:{page:$.value,pageSize:F.value},success:e=>{const t=e.data.data.submission_list.map((e=>({...e,images:e.images||[]})));0!==t.length?(I.value=[...I.value,...t],L.value=I.value.length<e.data.data.total,$.value++):L.value=!1},fail:e=>{uni.showToast({title:"加载失败",icon:"none"})},complete:()=>{P.value=!1,uni.hideLoading()}}))};function G(){m.isLogin?uni.navigateTo({url:"/pages/treehole_publish/treehole_publish"}):uni.showModal({title:"提示",content:"需要登录后才能发布树洞",success:e=>{e.confirm&&uni.navigateTo({url:"/pages/login/login"})}})}const W=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`};return l((()=>{g(),U(),j(),O(),H(),A()})),i((()=>{"brands"===R.value?U():"news"===R.value?j():"second"===R.value&&H()})),(t,o)=>{const l=a(e.resolveDynamicComponent("goods-search"),k),i=a(e.resolveDynamicComponent("index-brand"),_),s=a(e.resolveDynamicComponent("uni-icons"),N),g=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#ffe6d7"}),e.createVNode(g,{head_color:"rgb(255 230 215) "},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"body"},[e.createElementVNode("view",{class:"index_header"},[e.createElementVNode("view",null,[e.createElementVNode("image",{src:b,style:{width:"100rpx",height:"100rpx",display:"inline-block","vertical-align":"top"},mode:"aspectFill"}),e.createElementVNode("view",{style:{display:"inline-block"}},[e.createElementVNode("text",{class:"font-alimamashuhei logo",style:{color:"#4cbbd0",width:"250rpx","padding-top":"10rpx","vertical-align":"top",position:"relative"}},"娃圈狗狗助手")])]),e.createElementVNode("view",null,[e.createVNode(l,{width:"720rpx"}),e.createElementVNode("div",{style:{clear:"both"}})]),e.createElementVNode("view",{style:{position:"relative",height:"250rpx"}},[e.createElementVNode("swiper",{interval:3e3,duration:200,class:"banner_swiper","indicator-active-color":"#4cbbd0","indicator-color":"rgba(255,255,255,0.5)"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(t=>(e.openBlock(),e.createElementBlock("swiper-item",{key:t.id,class:"banner_swiper_item"},[e.createElementVNode("view",{class:"swiper-item"},[e.createElementVNode("image",{src:t.banner,mode:"aspectFill",style:{width:"100%",height:"250rpx"},onClick:e=>(e=>{uni.navigateTo({url:`/pages/article_detail/article_detail?id=${e.id}`})})(t)},null,8,["src","onClick"])])])))),128)),0===e.unref(c).length?(e.openBlock(),e.createElementBlock("swiper-item",{key:0},[e.createElementVNode("view",{class:"empty-banner"},[e.createElementVNode("image",{src:"/static/default-banner.jpg",mode:"aspectFill",style:{width:"100%",height:"250rpx"}})])])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{style:{margin:"40rpx 0rpx"}},[e.createElementVNode("view",{class:"index_page_article"},[e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"news"===R.value}]),onClick:o[0]||(o[0]=e=>q("news"))},[e.createElementVNode("image",{src:"/static/cat-1.png",mode:"aspectFill"}),e.createElementVNode("text",null,"品牌图透")],2),e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"brands"===R.value}]),onClick:o[1]||(o[1]=e=>q("brands"))},[e.createElementVNode("image",{src:"/static/cat-2.png",mode:"aspectFill"}),e.createElementVNode("text",null,"品牌图鉴")],2),e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"hot"===R.value}]),onClick:o[2]||(o[2]=e=>q("hot"))},[e.createElementVNode("image",{src:"/static/cat-3.png",mode:"aspectFill"}),e.createElementVNode("text",null,"热门搭配")],2),e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"second"===R.value}]),onClick:o[3]||(o[3]=e=>q("second"))},[e.createElementVNode("image",{src:"/static/cat-10.png",mode:"aspectFill"}),e.createElementVNode("text",null,"树洞投稿")],2)])])]),e.createElementVNode("view",{class:"body_container"},[e.createVNode(e.Transition,{name:"fade",mode:"out-in"},{default:e.withCtx((()=>["news"===R.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list news-box"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"news-item",onClick:e=>function(e){uni.navigateTo({url:"/pages/sale_news/sale_news?id="+e.id+"&brand_id="+e.brand_id})}(t)},[e.createElementVNode("view",{class:"news-images"},[t.image_list.length>0?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"image-swiper",autoplay:!0,circular:!0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.image_list,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"swiper-image"},null,8,["src"])])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"news-content"},[e.createElementVNode("text",{class:"news-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"news-desc"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"news-footer"},[e.createElementVNode("text",{class:"brand-tag"},e.toDisplayString(t.brand_name),1),e.createElementVNode("text",{class:"news-time"},e.toDisplayString(W(t.created_at)),1)])])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"loading-more"},[B.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),x.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多了~"))])])):e.createCommentVNode("",!0)])),_:1}),e.createVNode(e.Transition,{name:"fade",mode:"out-in"},{default:e.withCtx((()=>["brands"===R.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list brand_box",style:{position:"relative"}},[e.createElementVNode("view",{class:"filter-tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item",{active:u.value===t.value}]),onClick:e=>{return a=t.value,u.value===a?u.value=null:u.value=a,p.value=1,v.value=!0,n.value=[],void U();var a}},e.toDisplayString(t.label),11,["onClick"])))),128))]),e.createElementVNode("view",{class:"brand_type_description",style:{display:"block",width:"100%"}},[1==u.value?(e.openBlock(),e.createElementBlock("text",{key:0},"中国公司制作的BJD在打磨、分模线等工艺的处理上比较优秀，价格也比外社低很多。")):e.createCommentVNode("",!0),2==u.value?(e.openBlock(),e.createElementBlock("text",{key:1},"个人作者在贩售娃物前基本都是圈内玩家，在设计方面花的心思很多。")):e.createCommentVNode("",!0),3==u.value?(e.openBlock(),e.createElementBlock("text",{key:2},"国外娃社起步较早，风格设计也比较多样化。")):e.createCommentVNode("",!0)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id},[e.createVNode(i,{brand:t},null,8,["brand"])])))),128)),e.createElementVNode("view",{class:"loading-more"},[f.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),v.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多数据了"))])])):e.createCommentVNode("",!0)])),_:1}),e.createVNode(e.Transition,{name:"fade",mode:"out-in"},{default:e.withCtx((()=>["hot"===R.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list hot-box"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(S),(t=>(e.openBlock(),e.createElementBlock("view",{key:t.collocation_id,class:"hot-item",onClick:e=>function(e){uni.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${e.collocation_id}&origin=${e.origin}`})}(t)},[e.createElementVNode("view",{class:"images-box"},[t.image_urls.length>0?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"image-swiper",autoplay:!0,circular:!0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.image_urls,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"swiper-image"},null,8,["src"])])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"desc"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"tags-box"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.relation_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tag-item"},[e.createElementVNode("text",{class:"tag-text"},e.toDisplayString(t.relation_goods_name),1),e.createElementVNode("text",{class:"brand-text"},e.toDisplayString(t.relation_brand_name),1)])))),128))]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{src:t.avatar,class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"time"}," 发布"+e.toDisplayString(1==t.origin?"搭配":"展示柜")+"于 "+e.toDisplayString(W(t.created_at)),1)]),e.createElementVNode("view",{class:"like-box"},[e.createVNode(s,{type:"heart",size:"18",color:"#ff4d4f"}),e.createElementVNode("text",{class:"like-count"},e.toDisplayString(t.like_count),1)])])])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"loading-more"},[z.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),D.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多了~"))])])):e.createCommentVNode("",!0)])),_:1}),e.createVNode(e.Transition,{name:"fade",mode:"out-in"},{default:e.withCtx((()=>["second"===R.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list treehole-box"},[e.createElementVNode("view",{class:"publish-btn",onClick:G},[e.createVNode(s,{type:"plusempty",size:"30",color:"#fff"})]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(I),(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"treehole-item",onClick:e=>function(e){uni.navigateTo({url:"/pages/treehole_detail/treehole_detail?id="+e.id})}(t)},[e.createElementVNode("view",{class:"user-info",onClick:e.withModifiers((e=>function(e){1!=e.is_anonymous&&uni.navigateTo({url:"/pages/user_page/user_page?uid="+e.uid})}(t)),["stop"])},[""!==t.avatar?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.avatar,class:"avatar",mode:"aspectFill"},null,8,["src"])):(e.openBlock(),e.createElementBlock("image",{key:1,src:"/static/noname.png",class:"avatar",mode:"scaleToFill"})),e.createElementVNode("text",{class:"username"},e.toDisplayString(t.is_anonymous?"匿名用户":t.author_name),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(W(t.created_at)),1),e.createElementVNode("text",{class:"cid"},"【"+e.toDisplayString(t.id)+"】",1)],8,["onClick"]),e.createElementVNode("text",{class:"content"},e.toDisplayString(t.content),1),t.images.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-grid"},[e.createElementVNode("swiper",{class:"image-swiper",autoplay:!0,circular:!0,"indicator-dots":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.images,((a,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o},[e.createElementVNode("image",{src:a,mode:"aspectFill",class:"swiper-image",onClick:e.withModifiers((e=>{return a=t.images,n=o,void uni.previewImage({current:n,urls:a});var a,n}),["stop"])},null,8,["src","onClick"])])))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("view",{class:"action-item",onClick:e=>function(e){if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});let t=uni.getStorageSync("token");t?uni.request({url:d+(e.has_liked?"/with-state/unlike":"/with-state/add-like"),method:"POST",header:{Authorization:t},data:{id:e.id,type:5},success:t=>{"success"===t.data.status?(e.has_liked=!e.has_liked,e.like_count+=e.has_liked?1:-1):uni.showD}}):uni.showToast({title:"请先登录",icon:"none"})}(t)},[e.createVNode(s,{type:t.has_liked?"hand-up-filled":"hand-up",size:"18",color:t.has_liked?"#ff4d4f":"#666"},null,8,["type","color"]),e.createElementVNode("text",{class:"count"},e.toDisplayString(t.like_count||0),1)],8,["onClick"]),e.createElementVNode("view",{class:"action-item"},[e.createVNode(s,{type:"chat",size:"18",color:"#666"}),e.createElementVNode("text",{class:"count"},e.toDisplayString(t.comment_count||0),1)]),e.createElementVNode("view",{class:"action-item",onClick:e.withModifiers((e=>function(e){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+e.id;uni.setClipboardData({data:t,success:function(){uni.showToast({title:"复制链接成功",icon:"none"})}})}(t)),["stop"])},[e.createVNode(s,{type:"redo",size:"18",color:"#666"}),e.createElementVNode("text",{class:"count"},"分享")],8,["onClick"])])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"loading-more"},[P.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),L.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多了~"))])])):e.createCommentVNode("",!0)])),_:1})])])])),_:1})],64)}}},[["__scopeId","data-v-1aca686d"]]),B=w(Object.assign({inheritAttrs:!1},{__name:"common-search",props:{mode:{type:String,default:"jump",validator:e=>["jump","fill"].includes(e)},width:{type:String,default:"100%"},background:{type:String,default:""},fontSize:{type:String,default:""}},emits:["select"],setup(a,{emit:o}){const n=a,l=o,i=e.ref(""),s=e.ref([]),d=async()=>{if(""!==i.value.trim()){l("select",0,i.value);try{const e=await uni.request({url:`http://localhost:8080/search-brand?search=${i.value}`,method:"GET",header:{"Content-Type":"application/json"}});return t("log","at components/common-search/common-search.vue:76","请求结果:",e.data),"success"==e.data.status?null==e.data.data?void(s.value=[]):void(s.value=e.data.data):void(s.value=[])}catch(e){return t("error","at components/common-search/common-search.vue:91","请求错误:",e),void(s.value=[])}}else s.value=[]};function u(){i.value="",s.value=[]}return(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:e.normalizeClass(["search_tab",t.$attrs.class]),style:e.normalizeStyle({background:a.background||"#fff"})},["jump"==n.mode?(e.openBlock(),e.createElementBlock("image",{key:0,class:"icon_image",src:c})):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",{class:"common_search_input",placeholder:"请输入品牌 …","onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),onInput:d,ignoreCompositionEvent:!1},null,544),[[e.vModelText,i.value]]),s.value.length>0?(e.openBlock(),e.createElementBlock("image",{key:1,class:"icon_image",src:r,onClick:u})):e.createCommentVNode("",!0)],6),s.value.length>0?(e.openBlock(),e.createElementBlock("scroll-view",{key:0,class:"search_results",style:e.normalizeStyle({width:a.width}),"scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"result_item",onClick:e=>{return a=t.id,o=t.name,void("jump"===n.mode?uni.navigateTo({url:`/pages/brand/brand?brand_id=${a}`}):"fill"===n.mode&&(i.value=o,s.value=[],l("select",a,o)));var a,o}},e.toDisplayString(t.name),9,["onClick"])))),128))],4)):e.createCommentVNode("",!0)],64))}}),[["__scopeId","data-v-062c298b"]]);const S=w({},[["render",function(t,a){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("image",{class:"list_item_main_image",src:"/static/logo.png"}),e.createElementVNode("view",{class:"list_item_main_info"},[e.createElementVNode("text",null,"Puypoodoll - momo"),e.createElementVNode("text",null,"21分钟前"),e.createElementVNode("view",{class:"list_view_and_like_box"},[e.createElementVNode("view",{class:"posion_bottom"},[e.createElementVNode("view",{class:"icon_inline_text"},[e.createElementVNode("image",{class:"icon_image",src:"/static/message.png"}),e.createElementVNode("text",null,"10")]),e.createElementVNode("view",{class:"icon_inline_text"},[e.createElementVNode("image",{class:"icon_image",src:"/static/like.png"}),e.createElementVNode("text",null,"20")])])])])])}],["__scopeId","data-v-a03da0dd"]]),C={__name:"homepage",setup(o){let n=["所有尺寸","一分","二分","三分","四分","六分","八分","十分","十二分","其它大尺寸","棉花娃"],l=e.ref(0),s=[{name:"上新推送"},{name:"BJD整娃"},{name:"单头"},{name:"假发"},{name:"娃衣"},{name:"眼珠"},{name:"鞋子"},{name:"支架"},{name:"其它配件"}];function c(e){t("log","at pages/homepage/homepage.vue:68","picker发送选择改变，携带值为",e.detail.value),l.value=e.detail.value}const r=uni.getSystemInfoSync();function d(){uni.navigateTo({url:"/pages/goods/goods"})}return t("log","at pages/homepage/homepage.vue:74","状态栏高度"+e.ref(r.statusBarHeight).value),i((()=>{t("log","at pages/homepage/homepage.vue:77","onEachBottom!")})),(t,o)=>{const i=a(e.resolveDynamicComponent("common-search"),B),r=a(e.resolveDynamicComponent("homepage-list-item"),S);return e.openBlock(),e.createElementBlock("view",{class:"backbody"},[e.createElementVNode("view",{class:"pageinfo_userinfo"},[e.createElementVNode("image",{mode:"aspectFill",class:"avatar mine_avatar",src:"/static/pixsun.png"}),e.createElementVNode("view",{class:"pageinfo_infobox"},[e.createElementVNode("text",{class:"mine_username font-alimamashuhei"},"用户名"),e.createElementVNode("view",null,[e.createElementVNode("text",{class:"mine_friends"},[e.createTextVNode("好友 "),e.createElementVNode("text",{class:"mine_info_number"},"10")]),e.createElementVNode("text",{class:"mine_message"},[e.createTextVNode("消息 "),e.createElementVNode("text",{class:"mine_info_number"},"10")])])])]),e.createElementVNode("view",{class:"pageinfo_body"},[e.createElementVNode("view",null,[e.createElementVNode("view",null,[e.createElementVNode("view",{class:"uni-list-cell-db pick_size font-alimamashuhei"},[e.createElementVNode("picker",{onChange:c,value:e.unref(l),range:e.unref(n)},[e.createElementVNode("view",{class:"uni-input select_size"},[e.createTextVNode(e.toDisplayString(e.unref(n)[e.unref(l)])+" ",1),e.createElementVNode("image",{class:"icon_image down",src:"/static/arrow_down.png"})])],40,["value","range"])]),e.createElementVNode("icon",{class:""})]),e.createElementVNode("view",{class:"left_menu"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),((t,a)=>(e.openBlock(),e.createElementBlock("view",null,[(e.openBlock(),e.createElementBlock("text",{class:"menu_text font-alimamashuhei",key:a},e.toDisplayString(t.name),1))])))),256))]),e.createElementVNode("view",{class:"right_body"},[e.createVNode(i),e.createElementVNode("view",null,[e.createVNode(r,{onClick:d})])])])])])}}},T=w({__name:"common-modal",props:{visible:Boolean,top:{type:[String,Number],default:"20%"},width:{type:[String,Number],default:"80%"},height:{type:[String,Number],default:"auto"}},emits:["update:visible"],setup(t,{emit:a}){const o=t,n=a,l=e.computed((()=>({top:i(o.top),width:i(o.width),height:i(o.height)}))),i=e=>"number"==typeof e||/\d$/.test(e)?`${e}px`:e,s=()=>{n("update:visible",!1)};return(a,o)=>(e.openBlock(),e.createBlock(e.Transition,{name:"modal-fade"},{default:e.withCtx((()=>[t.visible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask",onClick:s},[e.createElementVNode("view",{class:"modal-container",style:e.normalizeStyle(l.value),onClick:o[0]||(o[0]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-content"},[e.renderSlot(a.$slots,"default",{},void 0,!0)])],4)])):e.createCommentVNode("",!0)])),_:3}))}},[["__scopeId","data-v-f8e04652"]]),D="/static/empty.png",z={__name:"stock",setup(o){const l=uni.getSystemInfoSync();e.ref(l.statusBarHeight);const i=e.ref(1),s=e.ref(1);function c(){return i.value>s.value?"slide_left":"slide_right"}function r(e){switch(s.value=i.value,i.value=e,t("log","at pages/stock/stock.vue:205",`切换到 tab ${e}`),e){case 1:z(),i.value=1;break;case 2:i.value=2,I();break;case 3:i.value=3,$()}}function u(e){return e.filter((e=>1===e.status)).length}const p=e.ref(0),g=e.ref(!1),v=e.ref(""),f=e.ref([]),y=["全部","娃头","娃衣","素体","眼珠","假发","娃鞋"],w=e.computed((()=>[...y,...f.value.map((e=>e.name))])),k=()=>{g.value=!0},_=async()=>{const e=uni.getStorageSync("token");try{const t=await uni.request({url:d+"/with-state/account-types",method:"GET",header:{Authorization:e}});f.value=t.data.data||[]}catch(a){t("error","at pages/stock/stock.vue:259","获取分类失败:",a)}},E=async()=>{if(!v.value.trim())return void uni.showToast({title:"请输入分类名称",icon:"none"});const e=uni.getStorageSync("token");try{await uni.request({url:d+"/with-state/add-account-type",method:"POST",header:{Authorization:e},data:{name:v.value.trim()}}),await _(),v.value="",uni.showToast({title:"添加成功"})}catch(t){uni.showToast({title:"添加失败",icon:"none"})}},b=e.ref({}),x=e.ref({}),B=e.ref({}),S=e.computed((()=>b.value.account_books?b.value.account_books.reduce(((e,t)=>e+(parseFloat(t.price)||0)),0).toFixed(2):0));function C(e){p.value=e.detail.value;const t=w.value[p.value];z("全部"===t?"":t)}function z(e){if(t("log","at pages/stock/stock.vue:368",m),!m.isLogin)return;let a=uni.getStorageSync("token"),o=d+"/with-state/account-book";e&&"全部"!==e&&(o=d+"/with-state/account-book?type="+e),b.value={},uni.request({url:o,method:"GET",header:{Authorization:a},success:e=>{t("log","at pages/stock/stock.vue:387",e.data.data),b.value=e.data.data},fail:e=>{t("log","at pages/stock/stock.vue:391",e)}})}function I(){if(t("log","at pages/stock/stock.vue:398",m),!m.isLogin)return;let e=uni.getStorageSync("token");x.value={},uni.request({url:d+"/with-state/showcase",method:"GET",header:{Authorization:e},success:e=>{t("log","at pages/stock/stock.vue:412",e.data.data),x.value=e.data.data},fail:e=>{t("log","at pages/stock/stock.vue:416",e)}})}function $(){if(t("log","at pages/stock/stock.vue:423",m),!m.isLogin)return;let e=uni.getStorageSync("token");B.value={},uni.request({url:d+"/with-state/tail-bill",method:"GET",header:{Authorization:e},success:e=>{t("log","at pages/stock/stock.vue:437",e.data.data),B.value=e.data.data},fail:e=>{t("log","at pages/stock/stock.vue:441",e)}})}function F(){uni.navigateTo({url:"/pages/stock/account_book_form/account_book_form"})}function L(){uni.navigateTo({url:"/pages/stock/showcase_form/showcase_form"})}function P(e){0!=e?uni.navigateTo({url:"/pages/stock/bill_form/bill_form?bill_id="+e}):uni.navigateTo({url:"/pages/stock/bill_form/bill_form"})}return n((()=>{h().then((e=>{_(),z(),I(),$()}))})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),N),s=a(e.resolveDynamicComponent("common-modal"),T),m=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"rgb(185 195 253)"}),e.createVNode(m,{head_color:"rgb(185 195 253)"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"container",style:{overflow:"hidden"}},[e.createElementVNode("view",{class:"head_container"},[e.createElementVNode("view",{class:"switch_tab"},[e.createElementVNode("button",{onClick:n[0]||(n[0]=e=>r(1)),class:e.normalizeClass(["font-alimamashuhei",{active:1===i.value}])},[e.createElementVNode("text",null,"我的物品")],2),e.createElementVNode("button",{onClick:n[1]||(n[1]=e=>r(2)),class:e.normalizeClass(["font-alimamashuhei",{active:2===i.value}])},[e.createElementVNode("text",null,"展示柜")],2),e.createElementVNode("button",{onClick:n[2]||(n[2]=e=>r(3)),class:e.normalizeClass(["font-alimamashuhei",{active:3===i.value}])},[e.createElementVNode("text",null,"尾款日历")],2)])]),e.createElementVNode("view",{class:"data_body"},[e.createVNode(e.Transition,{name:c()},{default:e.withCtx((()=>{var a;return[1===i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["tab_body_1st",{none:1!==i.value}])},[e.createElementVNode("view",{class:"type-header"},[e.createElementVNode("picker",{class:"type-picker",mode:"selector",value:p.value,range:w.value,onChange:C},[e.createElementVNode("view",{class:"uni-input"},e.toDisplayString(w.value[p.value]),1)],40,["value","range"]),e.createElementVNode("text",{class:"manage-btn",onClick:k},"管理分类")]),e.createElementVNode("view",{class:"summary-container"},[e.createElementVNode("text",{class:"total-text"},"当前分类合计：¥"+e.toDisplayString(S.value),1)]),e.createVNode(s,{visible:g.value,"onUpdate:visible":n[4]||(n[4]=e=>g.value=e),top:"5%",height:"60%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"type-modal"},[e.createElementVNode("view",{class:"type-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"type-item"},[e.createElementVNode("text",null,e.toDisplayString(a.name),1),e.createVNode(l,{type:"trash",size:"22",color:"#ff6666",onClick:e=>(async e=>{uni.showModal({title:"确认删除",success:async a=>{if(a.confirm){const a=uni.getStorageSync("token");try{const t=(await uni.request({url:d+"/with-state/delete-account-type",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{id:e}})).data;"success"===t.status?(await _(),uni.showToast({title:"删除成功"})):uni.showToast({title:t.msg||"删除失败",icon:"none"})}catch(o){t("error","at pages/stock/stock.vue:330","删除失败:",o),uni.showToast({title:o.errMsg||"请求失败",icon:"none"})}}}})})(a.id)},null,8,["onClick"])])))),128))]),e.createElementVNode("view",{class:"add-type-form"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>v.value=e),placeholder:"输入新分类名称",class:"type-input"},null,512),[[e.vModelText,v.value]]),e.createElementVNode("button",{class:"add-btn",onClick:E},"添加分类")])])])),_:1},8,["visible"]),(null==(a=b.value.account_books)?void 0:a.length)>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"content"},[e.createElementVNode("view",{class:"content-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.value.account_books,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"grid-item",onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/stock/account_book_form/account_book_form?account_book_id="+a});var a}},[e.createElementVNode("image",{src:t.image_url,mode:"aspectFill",class:"item-image"},null,8,["src"]),e.createElementVNode("text",{class:"item-type"},e.toDisplayString(t.type),1),e.createElementVNode("view",{class:"item-info"},[e.createElementVNode("text",{class:"item-price"},e.toDisplayString(t.price)+"￥",1)]),e.createElementVNode("view",{class:"item-info"},[e.createElementVNode("text",{class:"item-name one_line_text"},e.toDisplayString(t.name),1)])],8,["onClick"])))),128))])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:D}),e.createElementVNode("text",{class:"empty-text"},"空空如也～"),e.createElementVNode("text",{class:"empty-tip"},"点击下方按钮添加第一个物品吧！")])),e.createElementVNode("view",null,[e.createElementVNode("button",{class:"jump2addButton",onClick:F},"+")])],2)):e.createCommentVNode("",!0)]})),_:1},8,["name"]),e.createVNode(e.Transition,{name:c()},{default:e.withCtx((()=>[2===i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["tab_body_sec",{none:2!==i.value}])},[x.value.showcases&&x.value.showcases.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"showcase-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.value.showcases,((t,a)=>{return e.openBlock(),e.createElementBlock("view",{key:a,class:"showcase-card",onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/stock/showcase_form/showcase_form?showcase_id="+a});var a}},[1!==t.display?(e.openBlock(),e.createElementBlock("view",{key:0,class:"status-overlay"},[e.createElementVNode("text",{class:"status-text"},e.toDisplayString((o=t.display,{0:"审核中",2:"人工复核中",3:"违规隐藏中"}[o]||"")),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["card-content",{"blur-effect":1!==t.display}])},[e.createElementVNode("image",{src:t.image_url_list[0],mode:"aspectFill",class:"showcase-image"},null,8,["src"]),e.createElementVNode("view",{class:"showcase-info"},[e.createElementVNode("text",{class:"showcase-title one_line_text"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"showcase-description multi_line_text"},e.toDisplayString(t.description),1),e.createElementVNode("view",{class:"interaction-bar"},[e.createElementVNode("view",{class:"interaction-item"},[e.createElementVNode("image",{src:"/static/eye.png",class:"interaction-icon"}),e.createElementVNode("text",{class:"interaction-count"},e.toDisplayString(t.views||0),1)]),e.createElementVNode("view",{class:"interaction-item"},[e.createElementVNode("image",{src:"/static/6.png",class:"interaction-icon"}),e.createElementVNode("text",{class:"interaction-count"},e.toDisplayString(t.likes||0),1)])])])],2)],8,["onClick"]);var o})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:D}),e.createElementVNode("text",{class:"empty-text"},"展示柜空空如也"),e.createElementVNode("text",{class:"empty-tip"},"快来创建你的展示空间吧！")])),e.createElementVNode("view",null,[e.createElementVNode("button",{class:"jump2addButton",onClick:L},"+")])],2)):e.createCommentVNode("",!0)])),_:1},8,["name"]),e.createVNode(e.Transition,{name:c()},{default:e.withCtx((()=>[3===i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["tab_body_3th",{none:3!==i.value}])},[Object.keys(B.value).length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"calendar-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[e.createElementVNode("view",{class:"month-header-container"},[e.createElementVNode("text",{class:"month-header font-alimamashuhei"},e.toDisplayString(a)+" 账单",1),e.createElementVNode("text",{class:"month-stats"}," 已补/总计："+e.toDisplayString(u(t))+"/"+e.toDisplayString(t.length),1)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"bill-item",onClick:e=>P(t.id)},[e.createElementVNode("view",{class:"bill-left"},[e.createElementVNode("view",{class:"bill-name-container"},[e.createElementVNode("text",{class:"bill-name"},e.toDisplayString(t.name),1)]),e.createElementVNode("view",{class:"due-amount-container"},[e.createElementVNode("text",{class:"due-label"},"待补款:"),e.createElementVNode("text",{class:"due-amount"},"¥"+e.toDisplayString(t.price),1)])]),e.createElementVNode("view",{class:"bill-right"},[e.createElementVNode("view",{class:"date-container"},[e.createElementVNode("text",{class:"date-text"},"日期: "+e.toDisplayString(t.ymd),1)]),e.createElementVNode("view",{class:"status-container"},[e.createElementVNode("text",{class:e.normalizeClass(["status-text",{paid:1===t.status}])},e.toDisplayString(0===t.status?"未补款":"已补款"),3)])])],8,["onClick"])))),128))])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:D}),e.createElementVNode("text",{class:"empty-text"},"暂无待补尾款"),e.createElementVNode("text",{class:"empty-tip"},"增加添加一个到账本试试吧～")])),e.createElementVNode("view",null,[e.createElementVNode("button",{class:"jump2addButton",onClick:n[5]||(n[5]=e=>P(!1))},"+")])],2)):e.createCommentVNode("",!0)])),_:1},8,["name"])])])])),_:1})],64)}}},I="/static/right.png",$=w({__name:"mine",setup(o){t("log","at pages/mine/mine.vue:105",m.isLogin),t("log","at pages/mine/mine.vue:106",m.userInfo);let l=e.ref(""),i=e.ref(""),s=e.ref(0),c=e.ref(0),r=e.ref(0);function u(){uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),m.isLogin=!1}function h(){uni.navigateTo({url:"/pages/register/register"})}function v(){uni.navigateTo({url:"/pages/user_like/user_like"})}function f(){uni.navigateTo({url:"/pages/my_comment/my_comment"})}function y(){uni.navigateTo({url:"/pages/message_list/message_list"})}function w(){uni.navigateTo({url:"/pages/reset_password/reset_password"})}function k(){uni.navigateTo({url:"/pages/my_collocation/my_collocation"})}function _(){new Promise((e=>{uni.chooseImage({count:1,success:t=>{e(t.tempFilePaths[0])}})})).then((e=>{uni.navigateTo({url:`/pages/pop_croper/pop_croper?src=${decodeURIComponent(e)}`})}))}function E(e){t("log","at pages/mine/mine.vue:251","croperPath:"+e);let a=uni.getStorageSync("token"),o="";uni.request({url:d+"/with-state/qiniu-token",method:"POST",header:{Authorization:a},success:a=>{if(null==a.data.data||""==a.data.data.token)return void uni.showToast({title:"获取上传凭证失败",icon:"none"});o=a.data.data.token,t("log","at pages/mine/mine.vue:271","获取到的七牛token："+a.data.data.token),t("log","at pages/mine/mine.vue:273",uni.getStorageSync("userInfo"));let n=a.data.data.path;t("log","at pages/mine/mine.vue:276","fileName:"+n),uni.uploadFile({url:"https://up-cn-east-2.qiniup.com",name:"file",method:"POST",filePath:e,fileType:"image",formData:{token:o,key:n,scope:"hobby-box:"+n},success:e=>{t("log","at pages/mine/mine.vue:291","上传成功"),function(e,a){let o=uni.getStorageSync("token");uni.getStorageSync("userInfo"),uni.request({url:d+"/with-state/update-profile",method:"POST",header:{Authorization:o},data:{avatar:a},success:e=>{t("log","at pages/mine/mine.vue:331","更新成功"),g()},fail:e=>{uni.showToast({title:"更新失败",icon:"none"})}})}(0,"https://images1.fantuanpu.com/"+n)},fail:e=>{t("log","at pages/mine/mine.vue:298",e),uni.showToast({title:"上传失败",icon:"none"})}})},fail:e=>{uni.showToast({title:"获取上传凭证失败",icon:"none"})}})}function N(){if(""==i.value||""==l.value)return void uni.showToast({title:"请输入手机号和密码",icon:"none"});if(!/^1[3456789]\d{9}$/.test(l.value))return void uni.showToast({title:"手机号格式错误",icon:"none"});if(i.value.length<6)return void uni.showToast({title:"密码必须大于6位",icon:"none"});let e=l.value,a=i.value;uni.request({url:d+"/login",method:"POST",data:{account:e,password:a},success:e=>{t("log","at pages/mine/mine.vue:383",e);let a=e.data.data;"success"==e.data.status?(uni.setStorageSync("token",a.jwt_token),uni.setStorageSync("openid",a.open_id),uni.setStorageSync("session_key",a.session_key),t("log","at pages/mine/mine.vue:398","jwt:"+a.jwt_token),null!=a.jwt_token&&""!=a.jwt_token&&g()):uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"登录失败",icon:"none"})}})}function x(){uni.navigateTo({url:"/pages/setting/setting"})}return e.watch((()=>m.isLogin),(e=>{t("log","at pages/mine/mine.vue:422","watch",e),e?uni.showTabBar({animation:!1}):uni.hideTabBar({animation:!1})})),n((()=>{g(),m.isLogin?uni.showTabBar({animation:!1}):uni.hideTabBar({animation:!1}),(async()=>{try{const e=await uni.request({url:`${d}/with-state/unread-message-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(s.value=e.data.data.count)}catch(e){t("log","at pages/mine/mine.vue:199",e),uni.showToast({title:"未读数获取失败",icon:"none"})}})(),(async()=>{try{const e=await uni.request({url:`${d}/with-state/user-likes-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(c.value=e.data.data.count)}catch(e){t("log","at pages/mine/mine.vue:220",e),uni.showToast({title:"关注数获取失败",icon:"none"})}})(),(async()=>{try{const e=await uni.request({url:`${d}/with-state/my-collocation-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(r.value=e.data.data)}catch(e){t("log","at pages/mine/mine.vue:242",e),uni.showToast({title:"搭配数获取失败",icon:"none"})}})();const e=getCurrentPages(),a=e[e.length-1];a.returnParam&&E(a.returnParam)})),(t,o)=>{const n=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#e0f3ff"}),e.createVNode(n,{head_color:"#e0f3ff"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"container"},[e.unref(m).isLogin?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"mine"},[e.createElementVNode("view",{class:"full-width"},[e.createElementVNode("view",{class:"avatar-container"},[e.createElementVNode("image",{mode:"aspectFill",class:"mine-page-avatar",src:e.unref(m).userInfo.avatar,onClick:_},null,8,["src"])]),e.createElementVNode("view",{class:"user-info-container"},[e.createElementVNode("text",{class:"username-text font-alimamashuhei"},e.toDisplayString(e.unref(m).userInfo.username),1),e.createElementVNode("text",{class:"user-id-text"},[e.createElementVNode("text",{class:"font-alimamashuhei",style:{color:"#fff","font-size":"22rpx"}},"ID"),e.createTextVNode(" : "+e.toDisplayString(e.unref(m).userInfo.id),1)])]),e.createElementVNode("view",{class:"clearfix"})]),e.createElementVNode("view",{class:"pageinfo-infobox"},[e.createElementVNode("view",{class:"info-item",onClick:v},[e.createElementVNode("image",{src:"/static/pixcollocation.png",class:"icon"}),e.createElementVNode("text",{class:"info-tap font-alimamashuhei"},"关注"),e.createElementVNode("text",{class:"mine-info-number"},e.toDisplayString(e.unref(c)),1)]),e.createElementVNode("view",{class:"info-item",onClick:y},[e.createElementVNode("image",{src:"/static/pixpaperplane.png",class:"icon"}),e.createElementVNode("text",{class:"info-tap font-alimamashuhei"},"消息"),e.createElementVNode("text",{class:"mine-info-number"},e.toDisplayString(e.unref(s)),1)]),e.createElementVNode("view",{class:"info-item",onClick:k},[e.createElementVNode("image",{src:"/static/pixttq2.png",class:"icon"}),e.createElementVNode("text",{class:"info-tap font-alimamashuhei"},"搭配"),e.createElementVNode("text",{class:"mine-info-number"},e.toDisplayString(e.unref(r)),1)])])]),e.createElementVNode("view",{class:"main-padding"},[e.createElementVNode("view",{class:"button-container"},[e.createElementVNode("button",{class:"mine-button",onClick:f},[e.createElementVNode("image",{class:"icon-small",src:"/static/mypost.png"}),e.createElementVNode("text",null,"我的帖子"),e.createElementVNode("image",{class:"right-bar",src:I})]),e.createElementVNode("button",{class:"mine-button",onClick:x},[e.createElementVNode("image",{class:"icon-small",src:"/static/setting.png"}),e.createElementVNode("text",null,"账号设置"),e.createElementVNode("image",{class:"right-bar",src:I})]),e.createElementVNode("button",{class:"mine-button last-button",onClick:u},[e.createElementVNode("image",{class:"icon-small",src:"/static/logout.png"}),e.createElementVNode("text",null,"退出账号"),e.createElementVNode("image",{class:"right-bar",src:I})])])])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"unlogin-container"},[e.createElementVNode("image",{src:b,mode:"aspectFit",style:{width:"300rpx",height:"340rpx",position:"relative",right:"20rpx"}}),e.createElementVNode("text",{class:"welcome-text"},"欢迎使用娃圈狗狗助手"),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-with-icon"},[e.createElementVNode("image",{class:"icon",src:"/static/user.png"}),e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:"请输入手机号",class:"inputer","onUpdate:modelValue":o[0]||(o[0]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]])]),e.createElementVNode("view",{class:"input-with-icon"},[e.createElementVNode("image",{class:"icon",src:"/static/key.png"}),e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"请输入密码",class:"inputer","onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(i)?i.value=t:i=t)},null,512),[[e.vModelText,e.unref(i)]])])]),e.createElementVNode("view",{class:"action-links"},[e.createElementVNode("text",{class:"float-left",onClick:h},"注册账号"),e.createElementVNode("text",{class:"float-right",onClick:w},"忘记密码"),e.createElementVNode("view",{class:"clearfix"})]),e.createElementVNode("button",{class:"submit-btn",onClick:N},"立即登录"),e.createElementVNode("button",{class:"submit-btn",onClick:o[2]||(o[2]=(...t)=>e.unref(p)&&e.unref(p)(...t))},"微信登录")]))])])),_:1})],64)}}},[["__scopeId","data-v-b960178f"]]),F={__name:"watch_demo",setup(a){const o=e.ref({name:"john",age:18});return e.watch((()=>o.value.name),((e,a)=>{t("log","at pages/watch_demo/watch_demo.vue:14","newVal",e),t("log","at pages/watch_demo/watch_demo.vue:15","oldVal",a)}),{deep:!0}),(t,a)=>(e.openBlock(),e.createElementBlock("view",null,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>o.value.name=e)},null,512),[[e.vModelText,o.value.name]]),e.createElementVNode("text",null,e.toDisplayString(o.value.name),1),e.createElementVNode("footer")]))}},L=w({__name:"attitude-widget",props:{targetId:Number,type:Number,attitudeStatus:{type:Number,default:0},attitudeCounts:{type:Object,default:()=>({})}},emits:["change"],setup(o,{emit:n}){const l=o,i=n,s=e.ref(!1),c=e.ref(l.attitudeStatus),r=e.ref({}),u=e.ref([{emoji:"😝",value:1,label:"很有趣"},{emoji:"😨",value:2,label:"这个..."},{emoji:"🤤",value:3,label:"我也想要"},{emoji:"🤦‍♀️",value:4,label:"难以直视"},{emoji:"🤡",value:5,label:"谁的鼻子掉了?"}]);e.watch((()=>l.attitudeCounts),(e=>{u.value.forEach((t=>{r.value[t.value]=Number(e[t.value]??0)})),r.value={...r.value}}),{immediate:!0,deep:!0});const m=e.computed((()=>u.value.map((e=>({...e,count:r.value[e.value]||0}))).filter((e=>e.count>0||e.value===c.value)).filter((e=>e.count>0)))),p=()=>{s.value=!s.value};return(o,n)=>{const g=a(e.resolveDynamicComponent("uni-icons"),N);return e.openBlock(),e.createElementBlock("view",{class:"attitude-container"},[s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"mask",onClick:e.withModifiers(p,["stop"]),onTouchmove:n[0]||(n[0]=e.withModifiers((()=>{}),["stop","prevent"]))},null,32)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"counts-and-expand"},[e.createElementVNode("view",{class:"global-counts"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.value,class:e.normalizeClass(["count-item",{active:c.value===t.value,"has-count":t.count>0}])},[e.createElementVNode("text",{class:"emoji"},e.toDisplayString(t.emoji),1),e.createElementVNode("text",{class:"count"},e.toDisplayString(t.count),1)],2)))),128))]),e.createElementVNode("view",{class:"expand-btn",onClick:e.withModifiers(p,["stop"])},[e.createVNode(g,{type:s.value?"arrowup":"plus",size:"16",color:"#888"},null,8,["type"]),e.createElementVNode("text",{class:"btn-text"},e.toDisplayString(s.value?"收起":"表态"),1)])]),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"attitude-panel"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.value,class:e.normalizeClass(["attitude-btn",{active:c.value===a.value}]),onClick:e.withModifiers((e=>(async e=>{try{const t=uni.getStorageSync("token");if(!t)return void uni.showToast({title:"请先登录",icon:"none"});const a=c.value===e,o=`${d}/with-state/attitude/${a?"remove":"add"}`;"success"===(await uni.request({url:o,method:"POST",data:{target_id:l.targetId,type:l.type,action_type:e},header:{Authorization:t}})).data.status&&(a?(r.value[e]--,c.value=0):(c.value>0&&r.value[c.value]--,c.value=e,r.value[e]=(r.value[e]||0)+1),i("change",{status:c.value,counts:{...r.value}}),s.value=!1)}catch(a){t("log","at components/attitude-widget/attitude-widget.vue:176",a),uni.showToast({title:"操作失败",icon:"none"})}})(a.value)),["stop"])},[e.createElementVNode("text",{class:"emoji"},e.toDisplayString(a.emoji),1),e.createElementVNode("view",{class:"text-container"},[e.createElementVNode("text",{class:"label"},e.toDisplayString(a.label),1)])],10,["onClick"])))),128))])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-24a972d9"]]),P=w({__name:"comment-list",props:{type:{type:Number,required:!0},relationId:{type:Number,required:!0}},emits:["reply"],setup(o,{expose:n,emit:l}){const i=o,s=e.ref([]),c=e.ref(1),r=e.ref(0),u=e.ref(!0);e.reactive({});const m=l,p=e.ref(!1),g=(e,{status:t,counts:a})=>{e.attitudeStatus=t,e.attitudeCounts=a};n({addNewComment:e=>{s.value.unshift({...e,showAll:!1,localChildren:[],childTotal:0})},addReplyComment:e=>{const t=s.value.find((t=>t.id===e.parent_id));t&&(t.localChildren||(t.localChildren=[]),"number"!=typeof t.childTotal&&(t.childTotal=0),t.localChildren.unshift(e),t.childTotal+=1,!t.showAll&&t.childTotal<=5&&(t.showAll=!0))}}),e.onMounted((()=>{k()}));const h=e=>!e.showAll&&e.localChildren.length>5?e.localChildren.slice(0,5):e.localChildren,v=async()=>{if(!p.value&&u.value)try{p.value=!0,c.value+=1,await k()}finally{p.value=!1}},f=e=>{uni.navigateTo({url:"/pages/user_page/user_page?uid="+e})},y=e=>{const t=new Date(1e3*e);return`${t.getMonth()+1}-${t.getDate()} ${t.getHours()}:${t.getMinutes()}`},w=e=>e.length>12?e.slice(0,12)+"...":e,k=async()=>{try{p.value=!0;let e=uni.getStorageSync("token");const a=await uni.request({url:`${d}/get-comments`,data:{relation_id:i.relationId,type:i.type,page:c.value,page_size:10},header:{Authorization:e}});if("success"===a.data.status){const e=a.data.data,o=e.comment_list.map((e=>({...e,showAll:!1,localChildren:e.children||[],childTotal:e.childTotal||(e.children?e.children.length:0),attitudeStatus:e.user_attitude||0,attitudeCounts:e.attitude_counts||{1:e.count_1||0,2:e.count_2||0,3:e.count_3||0,4:e.count_4||0,5:e.count_5||0}})));1===c.value?s.value=o:s.value.push(...o),t("log","at components/comment-list/comment-list.vue:266","total",e.total),u.value=e.total>s.value.length,r.value=e.total,t("log","at components/comment-list/comment-list.vue:270","是否还有更多?",u.value)}}catch(e){uni.showToast({title:"加载失败",icon:"none"})}finally{p.value=!1}},_=(e,t=null)=>{m("reply",{parent:e,target:t,relationId:i.relationId})},E=e=>e.childTotal>5&&!e.showAll,V=e=>e.childTotal-Math.min(e.localChildren.length,5);return(t,o)=>{const n=a(e.resolveDynamicComponent("attitude-widget"),L),l=a(e.resolveDynamicComponent("uni-icons"),N);return e.openBlock(),e.createElementBlock("view",{class:"comment-container"},[s.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"comment-count"}," 共"+e.toDisplayString(r.value)+"条回复 ",1)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-tips"},[e.createElementVNode("text",null,"-- 暂无回复 --")])),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"comment-card"},[e.createElementVNode("view",{class:"main-comment"},[e.createElementVNode("image",{onClick:e=>f(t.uid),src:t.avatar,class:"avatar",mode:"aspectFill"},null,8,["onClick","src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"username",onClick:e=>f(t.uid)},e.toDisplayString(w(t.username)),9,["onClick"]),e.createElementVNode("text",{class:"floor"},"#"+e.toDisplayString(t.floor),1)]),e.createElementVNode("text",{class:"comment-text",onClick:e=>_(t)},e.toDisplayString(t.comment),9,["onClick"]),e.createVNode(n,{"target-id":t.id,type:6,"attitude-status":t.attitudeStatus,"attitude-counts":t.attitudeCounts,onChange:e=>g(t,e)},null,8,["target-id","attitude-status","attitude-counts","onChange"]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("text",{class:"time"},e.toDisplayString(y(t.created_at)),1),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("text",{class:"reply-btn",onClick:e=>_(t)},"回复",8,["onClick"])])])])]),t.localChildren&&t.localChildren.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"sub-comments"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h(t),((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"sub-comment"},[e.createElementVNode("image",{onClick:e=>f(a.uid),src:a.avatar,class:"avatar",mode:"aspectFill"},null,8,["onClick","src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{onClick:e=>f(a.uid),class:"username"},e.toDisplayString(w(a.username)),9,["onClick"]),a.reply_for?(e.openBlock(),e.createElementBlock("text",{key:0,class:"reply-to"},"@"+e.toDisplayString(a.reply_for),1)):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"comment-text",onClick:e=>_(t)},e.toDisplayString(a.comment),9,["onClick"]),e.createVNode(n,{"target-id":a.id,type:6,"attitude-status":t.attitudeStatus,"attitude-counts":t.attitudeCounts,onChange:e=>g(t,e)},null,8,["target-id","attitude-status","attitude-counts","onChange"]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("text",{class:"time"},e.toDisplayString(y(a.created_at)),1),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("text",{class:"reply-btn",onClick:e=>_(t,a)},"回复",8,["onClick"])])])])])))),128)),E(t)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"load-more",onClick:e=>(async e=>{if(e.localChildren.length<e.childTotal){const a=Math.ceil(e.localChildren.length/5)+1;try{const t=await uni.request({url:`${d}/get-comments-by-parent-id`,data:{parent_id:e.id,page:a}});"success"===t.data.status&&(e.localChildren=[...e.localChildren,...t.data.data.comment_list],e.childTotal=t.data.data.total,e.localChildren.length>=5&&!e.showAll&&(e.showAll=!0))}catch(t){uni.showToast({title:"加载失败",icon:"none"})}}else e.showAll=!e.showAll})(t)},[e.createElementVNode("text",null,"展开"+e.toDisplayString(V(t))+"条回复",1),e.createVNode(l,{type:"arrow-down",size:"18",color:"#007AFF"})],8,["onClick"])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])))),128)),s.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"load-more-box"},[u.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["load-more-btn",{loading:p.value}]),onClick:v},[p.value?(e.openBlock(),e.createElementBlock("view",{key:1},[e.createVNode(l,{type:"spinner-cycle",size:"16",color:"#888"})])):(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("text",null," 加载更多 "),e.createVNode(l,{type:"arrow-down",size:"18",color:"#007AFF"})]))],2)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},[e.createElementVNode("text",null,"-- 没有更多了 --")]))])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-ce40de45"]]),R=w({__name:"comment-input",props:{replyInfo:{type:Object,default:()=>({})},targetId:{type:String,required:!0},safeBottom:{type:Number,default:10}},emits:["submit","update:replyInfo"],setup(a,{expose:o,emit:l}){const i=a,s=e.ref(null),c=e.ref(!1),r=l;e.getCurrentInstance();const d=e.ref(""),u=e.ref(!1),m=e.ref(0),p=uni.getSystemInfoSync(),g=e.computed((()=>{var e,a;let o=(null==(e=p.safeAreaInsets)?void 0:e.bottom)||10;t("log","at components/comment-input/comment-input.vue:59","底部安全距离1:",null==(a=p.safeAreaInsets)?void 0:a.bottom,"=>",o);return`${o+m.value}px`})),h=e=>{t("log","at components/comment-input/comment-input.vue:66","键盘高度变化",e),m.value=e.height},v=()=>{u.value=!0,c.value=!0},f=()=>{u.value=!1,c.value=!1},y=()=>{u.value=!1,c.value=!1,uni.hideKeyboard()},w=()=>{if(!d.value.trim())return void uni.showToast({title:"请输入评论内容",icon:"none"});t("log","at components/comment-input/comment-input.vue:95","scene",1),r("submit",{content:d.value,target_id:i.targetId,type:4,replyInfo:i.replyInfo,origin:1}),d.value="",r("update:replyInfo",{})};return o({focusInput:()=>{c.value=!0}}),n((()=>{t("log","at components/comment-input/comment-input.vue:123","注册键盘弹出事件"),uni.onKeyboardHeightChange(h)})),(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("view",{class:"mask",onClick:y},null,512),[[e.vShow,u.value]]),e.createElementVNode("view",{class:"bottom_tab","adjust-position":!1,style:e.normalizeStyle({paddingBottom:g.value})},[e.withDirectives(e.createElementVNode("textarea",{"disable-default-padding":!0,focus:c.value,class:e.normalizeClass(["comment_input unified-textarea",{expanded:c.value}]),ref_key:"inputRef",ref:s,"onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),onFocus:v,onBlur:f,"adjust-position":!1,placeholder:a.replyInfo.username?"回复@"+a.replyInfo.username+" ":"写评论..."},null,42,["focus","placeholder"]),[[e.vModelText,d.value]]),e.createElementVNode("button",{onClick:w},"写评论")],4)],64))}},[["__scopeId","data-v-91e0e6b1"]]),q="/static/right2.png",M=w({__name:"goods",props:["goods_id"],setup(o){const n=o;uni.getSystemInfoSync();const l=e.ref(!1),i=e.ref(!1),s=e.ref(""),c=e.ref(null),r=e.ref(null);e.ref(1);let u=e.ref({}),p=e.ref({}),g=e.ref(1),v=e.ref(!1),f=e.ref(!1);const y=e.ref(400),w=e.ref([]),k=({parent:e,target:a})=>{var o;t("log","at pages/goods/goods.vue:221","parent",e),t("log","at pages/goods/goods.vue:222","target",a);let n=e;null!=a&&(n=a),u.value.id!=n.id?(t("log","at pages/goods/goods.vue:233","item",n),u.value=n,null==(o=r.value)||o.focusInput()):u.value={}},_=({content:e,replyInfo:a,origin:o})=>{let l=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/goods/goods.vue:251","reply_info",a);const i={content:e,origin:o,target_id:parseInt(n.goods_id),type:2,...a.id&&{reply_id:a.id,reply_for:a.comment,reply_user_id:a.user_id,parent_id:a.parent_id>0?a.parent_id:a.id}};uni.request({url:d+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:i,success:e=>{var t,a;if("success"==e.data.status){const o=e.data.data;0===o.parent_id?null==(t=c.value)||t.addNewComment(o):null==(a=c.value)||a.addReplyComment(o),uni.showToast({title:"评论成功",icon:"success"})}else uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})}})};function E(e){t("log","at pages/goods/goods.vue:356",e.detail.current),g.value=e.detail.current+1}function V(){uni.request({url:d+"/goods?id="+n.goods_id,method:"GET",timeout:5e3,success:e=>{t("log","at pages/goods/goods.vue:366",e.data.data),p.value=e.data.data},fail:e=>{t("log","at pages/goods/goods.vue:370",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{uni.hideLoading()}})}function b(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}function x(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${i}`}function B(){let e=uni.getStorageSync("token");""!=e&&uni.request({url:d+"/with-state/hasLike?id="+n.goods_id+"&type=1",method:"POST",header:{Authorization:e},success:e=>{t("log","at pages/goods/goods.vue:481",e.data),"success"==e.data.status?e.data.data.id>0?v.value=!0:v.value=!1:uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t("log","at pages/goods/goods.vue:499",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}function S(){uni.navigateTo({url:"/pages/collocation/collocation?goods_id="+n.goods_id+"&brand_id="+p.value.brand_id+"&goods_name="+p.value.name+"&brand_name="+p.value.brand_name+"&type="+p.value.type})}function C(e){if(!e)return"";return e.split(",")[0].trim()}return uni.showLoading({title:"加载中"}),V(),uni.request({url:d+"/goods-collocation?goods_id="+n.goods_id,method:"GET",timeout:5e3,success:e=>{t("log","at pages/goods/goods.vue:530",e.data.data),f.value=e.data.data},fail:e=>{t("log","at pages/goods/goods.vue:534",e),uni.showToast({title:"网络请求失败",icon:"none"})}}),h().then((e=>{t("log","at pages/goods/goods.vue:573",e),B()})),(o,h)=>{const T=a(e.resolveDynamicComponent("uni-icons"),N),D=a(e.resolveDynamicComponent("comment-list"),P),z=a(e.resolveDynamicComponent("comment-input"),R);return e.unref(p).name?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",null,[e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("view",{class:"heart",onClick:h[0]||(h[0]=e=>function(){let e=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});let a={id:parseInt(n.goods_id),type:1},o=v.value?"/with-state/unlike":"/with-state/add-like";uni.request({url:d+o,method:"POST",header:{Authorization:e},data:a,success:e=>(t("log","at pages/goods/goods.vue:440",e.data),"success"==e.data.status?(uni.showToast({title:"操作成功",icon:"success"}),v.value=!v.value,B(),void V()):void uni.showToast({title:e.data.msg,icon:"none"})),fail:e=>{t("log","at pages/goods/goods.vue:459",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}())},[e.unref(v)?(e.openBlock(),e.createBlock(T,{key:1,type:"heart-filled",size:"28",color:"#ff4d4f"})):(e.openBlock(),e.createBlock(T,{key:0,type:"heart",size:"28",color:"#ff4d4f"})),e.createElementVNode("text",{class:"num",style:{color:"#ff4d4f"}},e.toDisplayString(b(e.unref(p).goods_like_count)),1)]),e.createElementVNode("swiper",{interval:3e3,duration:200,onChange:E,class:"banner_swiper",style:e.normalizeStyle([{"max-height":"800px"},{height:y.value+"px"}])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p).goods_images,((a,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o,class:"banner_swiper_item"},[e.createElementVNode("view",{class:"swiper-item"},[e.createElementVNode("image",{src:a,mode:"widthFix",style:{width:"100%",display:"block"},class:e.normalizeClass("swiper-image-"+o),onClick:e=>{uni.previewImage({current:p.value.goods_images.index,urls:p.value.goods_images})},onLoad:e=>function(e){t("log","at pages/goods/goods.vue:322","图片加载完成",e);const a=uni.createSelectorQuery();setTimeout((()=>{a.select(`.swiper-image-${e}`).boundingClientRect((a=>{try{if(!a)return void t("warn","at pages/goods/goods.vue:329","未找到图片元素");t("log","at pages/goods/goods.vue:332",a),w.value[e]=a.height;const o=w.value.filter((e=>e>0));if(0===o.length)return;y.value=Math.max(...o)}catch(o){t("error","at pages/goods/goods.vue:338","高度计算异常:",o)}})).exec()}),20)}(o)},null,42,["src","onClick","onLoad"])])])))),128))],36),e.createElementVNode("view",{class:"swiper-index-box"},[e.createElementVNode("text",{class:"font-alimamashuhei"},e.toDisplayString(e.unref(g))+" / "+e.toDisplayString(e.unref(p).goods_images.length),1)])])]),e.createElementVNode("view",{class:"msg_body"},[e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"名称"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).name),1)]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"类型"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).type),1)]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"初贩定价"),e.unref(p).total_amount?(e.openBlock(),e.createElementBlock("text",{key:0,class:"msg_text"},e.toDisplayString(e.unref(p).total_amount+" "+e.unref(p).currency),1)):e.unref(p).goods_sales&&e.unref(p).goods_sales.length>0?(e.openBlock(),e.createElementBlock("text",{key:1,class:"msg_text"},e.toDisplayString(e.unref(p).goods_sales[0].sub_amount+e.unref(p).goods_sales[0].fin_amount)+" "+e.toDisplayString(e.unref(p).goods_sales[0].currency),1)):(e.openBlock(),e.createElementBlock("text",{key:2},"未知"))]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"初贩时间"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).sub_time1>0?x(e.unref(p).sub_time1):"未知"),1)]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"尺寸"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).size)+" / "+e.toDisplayString(e.unref(p).size_detail),1)]),"单体"===e.unref(p).type||"整体"===e.unref(p).type||"单头"===e.unref(p).type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"可选体型"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).body_size||"未知"),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"可选颜色"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).skin),1)]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"贩售情报"),null==e.unref(p).goods_sales?(e.openBlock(),e.createElementBlock("text",{key:0},"暂无收录贩售详细信息")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"msg_text"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p).goods_sales,(t=>(e.openBlock(),e.createElementBlock("text",{key:t.id,style:{width:"100%",display:"block","margin-bottom":"10px"}},e.toDisplayString(x(t.sub_time))+", "+e.toDisplayString(t.sale_type)+", 总价: "+e.toDisplayString(t.sub_amount+t.fin_amount)+" ("+e.toDisplayString(t.currency)+") ",1)))),128))])]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"制作方"),e.createElementVNode("text",{class:"msg_text",style:{color:"#55aae5"},onClick:h[1]||(h[1]=t=>{return a=e.unref(p).brand_id,void uni.navigateTo({url:"/pages/brand/brand?brand_id="+a});var a})},e.toDisplayString(e.unref(p).brand_name),1)]),e.createElementVNode("view",{class:"msg_block"},[e.createElementVNode("text",{class:"lable_text"},"备注"),e.createElementVNode("text",{class:"msg_text"},e.toDisplayString(e.unref(p).desc_content),1)])]),e.createElementVNode("view",{style:{padding:"40rpx"}},[e.createElementVNode("view",{style:{display:"flex",margin:"30px 5px 10px 5px"}},[e.createElementVNode("text",{style:{color:"rgb(100, 198, 220)","font-weight":"bold",display:"block",width:"calc(100% - 130rpx)"}},"搭配参考"),e.createElementVNode("view",{style:{display:"flex"}},[e.createElementVNode("text",{style:{width:"110rpx",display:"inline-block",color:"#888"}},"查看更多"),e.createElementVNode("image",{src:q,style:{width:"30rpx",height:"30rpx",display:"inline-block",position:"relative",top:"3rpx"}})])]),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"collocationBox","ll-with-animation":"true","show-scrollbar":!1},[e.unref(f)&&e.unref(f).collocation_relation_list.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(e.unref(f).collocation_relation_list,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.collocation_id,style:{},class:"collocationItem square",onClick:e=>{return a=t.collocation_id,o=t.relation_origin,void uni.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+a+"&origin="+o});var a,o}},[e.createElementVNode("image",{src:C(t.image_urls),mode:"aspectFill",style:{width:"100%",height:"100%"}},null,8,["src"])],8,["onClick"])))),128)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{onClick:S,style:{border:"1px solid #eaeaea",display:"flex",margin:"20rpx auto","border-radius":"15rpx",width:"400rpx"}},[e.createElementVNode("image",{src:"/static/paper_plane.png",style:{width:"45rpx",height:"45rpx",margin:"18rpx"}}),e.createElementVNode("text",{style:{color:"rgb(184 184 184)",margin:"12px auto"}},"上传搭配参考帮助他人")])]),e.createElementVNode("view",{style:{padding:"10px"}},[e.createVNode(D,{ref_key:"commentListRef",ref:c,type:2,"relation-id":parseInt(n.goods_id),onReply:k},null,8,["relation-id"])]),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error"},e.toDisplayString(s.value),1)):e.createCommentVNode("",!0),e.createVNode(z,{ref_key:"commentInputRef",ref:r,"reply-info":e.unref(u),"target-id":n.goods_id,onSubmit:_,"onUpdate:replyInfo":h[2]||(h[2]=t=>e.isRef(u)?u.value=t:u=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{height:"80px"}})])):e.createCommentVNode("",!0)}}},[["__scopeId","data-v-dcfb31f2"]]);const A=w({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),o=Math.ceil(e);for(let n=0;n<this.max;n++)a>n?t.push({activeWitch:"100%"}):o-1===n?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100)},methods:{touchstart(e){if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){},mousemove(e){},mouseleave(e){},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let o=parseInt(a/(t+this.marginNumber));o=o<0?0:o,o=o>this.max?this.max:o;const n=parseInt(a-(t+this.marginNumber)*o);let l=0;(this._oldValue!==o||this.PC)&&(this._oldValue=o,l=this.allowHalf?n>t/2?o+1:o+.5:o+1,l=Math.max(.5,Math.min(l,this.max)),this.valueSync=l,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){uni.createSelectorQuery().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(t,o,n,l,i,s){const c=a(e.resolveDynamicComponent("uni-icons"),N);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{ref:"uni-rate",class:"uni-rate"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.stars,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-rate__icon",{"uni-cursor-not-allowed":n.disabled}]),style:e.normalizeStyle({"margin-right":s.marginNumber+"px"}),key:a,onTouchstart:o[0]||(o[0]=e.withModifiers(((...e)=>s.touchstart&&s.touchstart(...e)),["stop"])),onTouchmove:o[1]||(o[1]=e.withModifiers(((...e)=>s.touchmove&&s.touchmove(...e)),["stop"])),onMousedown:o[2]||(o[2]=e.withModifiers(((...e)=>s.mousedown&&s.mousedown(...e)),["stop"])),onMousemove:o[3]||(o[3]=e.withModifiers(((...e)=>s.mousemove&&s.mousemove(...e)),["stop"])),onMouseleave:o[4]||(o[4]=(...e)=>s.mouseleave&&s.mouseleave(...e))},[e.createVNode(c,{color:n.color,size:n.size,type:n.isFill?"star-filled":"star"},null,8,["color","size","type"]),e.createElementVNode("view",{style:e.normalizeStyle({width:t.activeWitch}),class:"uni-rate__icon-on"},[e.createVNode(c,{color:n.disabled?n.disabledColor:n.activeColor,size:n.size,type:"star-filled"},null,8,["color","size"])],4)],38)))),128))],512)])}],["__scopeId","data-v-1fbe22c2"]]),j=w({__name:"brand",props:["brand_id"],setup(o){const n=o;t("log","at pages/brand/brand.vue:103",n);const l=e.ref(!1),i=e.ref(!1);uni.showLoading({title:"加载中"}),uni.getSystemInfoSync();let s=e.ref(0);const c=e.ref(null),r=e.ref(null);e.ref(1);let u=e.ref({});const p=({parent:e,target:a})=>{var o;t("log","at pages/brand/brand.vue:131","parent",e),t("log","at pages/brand/brand.vue:132","target",a);let n=e;null!=a&&(n=a),u.value.id!=n.id?(t("log","at pages/brand/brand.vue:143","item",n),u.value=n,null==(o=r.value)||o.focusInput()):u.value={}},g=({content:e,replyInfo:a,origin:o})=>{let n=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/brand/brand.vue:161","reply_info",a);const l={content:e,origin:o,target_id:parseInt(pageId.value),type:1,...a.id&&{reply_id:a.id,reply_for:a.comment,reply_user_id:a.user_id,parent_id:a.parent_id>0?a.parent_id:a.id}};uni.request({url:d+"/with-state/add-comment",method:"POST",header:{Authorization:n},data:l,success:e=>{var t,a;if("success"==e.data.status){const o=e.data.data;0===o.parent_id?null==(t=c.value)||t.addNewComment(o):null==(a=c.value)||a.addReplyComment(o),uni.showToast({title:"评论成功",icon:"success"})}else uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})}})};function h(){0!=s.value?s.value>5?uni.showToast({title:"评分不能大于5",icon:"none"}):(t("log","at pages/brand/brand.vue:230",s.value,n.brand_id),async function(e,a,o){let n=uni.getStorageSync("token");n?uni.request({url:d+"/with-state/add-vote-score",method:"POST",header:{Authorization:n},data:{target_id:parseInt(o),score:parseInt(a),type:e},success:e=>(t("log","at common/config.js:170",e.data),"success"==e.data.status?(uni.showToast({title:"评分成功",icon:"success"}),activeModal.value=!1,0):(uni.showToast({title:e.data.msg,icon:"none"}),0)),fail:e=>{t("log","at common/config.js:188",e),uni.showToast({title:"网络请求失败",icon:"none"})}}):uni.showToast({title:"请先登录",icon:"none"})}(1,s.value,n.brand_id)):uni.showToast({title:"请先评分",icon:"none"})}function v(){uni.request({url:d+"/brand-info?id="+n.brand_id,method:"GET",timeout:5e3,success:e=>{t("log","at pages/brand/brand.vue:255",e.data.data),N.value=e.data.data,uni.setNavigationBarTitle({title:e.data.data.brand_name}),y()},fail:e=>{t("log","at pages/brand/brand.vue:265",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{uni.hideLoading()}})}const f=async()=>{let e=uni.getStorageSync("token");if(m.isLogin)try{const t=`${d}/with-state/${l.value?"unlike":"add-like"}`,a=await uni.request({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(n.brand_id),type:2}});"success"===a.data.status?(l.value=!l.value,uni.showToast({title:l.value?"关注成功":"已取消关注",icon:"none"}),v()):uni.showToast({title:a.data.msg,icon:"none"})}catch(a){t("error","at pages/brand/brand.vue:306",a),uni.showToast({title:"操作失败",icon:"none"})}else uni.showToast({title:"请先登录",icon:"none"})},y=async()=>{var e;try{const t=await uni.request({url:`${d}/with-state/hasLike?id=${parseInt(n.brand_id)}&type=2`,method:"POST",header:{Authorization:uni.getStorageSync("token")}});l.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(a){t("error","at pages/brand/brand.vue:323","获取关注状态失败:",a)}};function w(){uni.request({url:d+"/brand-goods?brand_id="+n.brand_id+"&page="+E.value,method:"GET",timeout:5e3,success:e=>{t("log","at pages/brand/brand.vue:347",e.data.data),_.value.page_index=e.data.data.page_index,_.value.total=e.data.data.total,_.value.goods_list=_.value.goods_list?_.value.goods_list.concat(e.data.data.goods_list):e.data.data.goods_list,e.data.data.goods_list.length>0&&(E.value+=1),0==e.data.data.goods_list.length&&E.value>1&&uni.showToast({title:"没有更多数据了",icon:"none"})},fail:e=>{t("log","at pages/brand/brand.vue:364",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}function k(e){i.value=!i.value}let _=e.ref({}),E=e.ref(1),N=e.ref({});return v(),w(),function(e,a){let o=uni.getStorageSync("token");o&&m.isLogin&&uni.request({url:d+"/with-state/my-vote-record",method:"GET",header:{Authorization:o,"Content-Type":"application/json"},data:{target_id:parseInt(a),type:e},success:e=>(t("log","at pages/brand/brand.vue:466",e.data.data),"success"==e.data.status?(s.value=e.data.data.score,e.data.data.score):(uni.showToast({title:e.data.msg,icon:"none"}),0)),fail:e=>(t("log","at pages/brand/brand.vue:479",e),uni.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,n.brand_id),(t,o)=>{const d=a(e.resolveDynamicComponent("uni-rate"),A),m=a(e.resolveDynamicComponent("comment-list"),P),v=a(e.resolveDynamicComponent("comment-input"),R);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("image",{src:e.unref(N).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),e.createElementVNode("view",{class:"body"},[e.createElementVNode("view",null,[e.createElementVNode("text",{style:{float:"left","font-size":"20px"},selectable:"true","user-select":"true"},e.toDisplayString(e.unref(N).brand_name),1),e.createElementVNode("text",{style:{float:"right",margin:"5px 0px"}},e.toDisplayString(e.unref(N).country_name)+" / "+e.toDisplayString(e.unref(N).type),1),e.createElementVNode("view",{style:{clear:"both"}})]),e.createElementVNode("view",{style:{margin:"20rpx 0rpx",display:"flex","justify-content":"space-between"}},[e.createElementVNode("view",{onClick:o[0]||(o[0]=e=>k()),style:{display:"inline-block",position:"relative",left:"-8rpx"}},[e.createVNode(d,{style:{"margin-top":"5px",float:"left"},value:e.unref(N).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"},null,8,["value"]),e.createElementVNode("text",{style:{float:"left",position:"relative",top:"5px"}},e.toDisplayString(e.unref(N).score)+"（"+e.toDisplayString(e.unref(N).vote_number)+"次评分）",1),e.createElementVNode("view",{style:{clear:"both"}})]),e.createElementVNode("text",{class:"follow",onClick:f,style:e.normalizeStyle({background:l.value?"#ff6a6c":"#65C3D6"})},e.toDisplayString(l.value?"已关注":"+ 关注品牌"),5)]),e.createElementVNode("view",{style:{"margin-top":"15px"}},[e.createElementVNode("text",null,"别名："+e.toDisplayString(e.unref(N).nickname_list),1)]),e.createElementVNode("view",{style:{"margin-top":"10px"}},[e.createElementVNode("text",null,"简介："+e.toDisplayString(e.unref(N).description),1)]),e.createElementVNode("div",{style:{clear:"both"}}),e.createElementVNode("text",{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},"收录作品 ("+e.toDisplayString(e.unref(_).total)+")",1),e.createElementVNode("view",{class:"brand_goods"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_).goods_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"brand_goods_item",style:{},key:t.id},[e.createElementVNode("navigator",{onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},[e.createElementVNode("view",{style:{width:"100%",height:"calc(100% - 20px)"}},[e.createElementVNode("image",{style:{width:"100%",height:"100%"},src:t.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])]),e.createElementVNode("text",{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},e.toDisplayString(t.name),1)],8,["onClick"])])))),128))]),e.createElementVNode("button",{class:"load_more",onClick:w},"加载更多"),e.createElementVNode("view",null,[e.createVNode(m,{ref_key:"commentListRef",ref:c,type:1,"relation-id":parseInt(n.brand_id),onReply:p},null,8,["relation-id"]),t.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),t.error?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error"},e.toDisplayString(t.errorMsg),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{style:{height:"80px"}}),e.createElementVNode("view",{class:e.normalizeClass(["modal_shadow",{none:!i.value}]),onClick:o[2]||(o[2]=e=>k())},[e.createElementVNode("view",{class:"modal_box"},[e.createElementVNode("view",null,[e.createElementVNode("text",{style:{"font-size":"25px",color:"#7b6d6d",width:"100%","text-align":"center","margin-bottom":"13px",display:"block"}},"您的评分 "+e.toDisplayString(e.unref(s)),1),e.createVNode(d,{modelValue:e.unref(s),"onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(s)?s.value=t:s=t),"allow-half":"true",style:{"margin-top":"5px",float:"left"},size:"45"},null,8,["modelValue"])]),e.createElementVNode("view",{style:{clear:"both"}}),e.createElementVNode("button",{style:{display:"block",width:"100px",position:"absolute",bottom:"0px",right:"20px"},class:"light_button",onClick:h},[e.createElementVNode("text",{style:{color:"#fff"}},"提交")])])],2),e.createVNode(v,{ref_key:"commentInputRef",ref:r,"reply-info":e.unref(u),"target-id":n.brand_id,onSubmit:g,"onUpdate:replyInfo":o[3]||(o[3]=t=>e.isRef(u)?u.value=t:u=t)},null,8,["reply-info","target-id"])])}}},[["__scopeId","data-v-46b651ad"]]),O=w({__name:"calendar",setup(o){const n=e.ref(["全部","整体","单头","单体","娃衣","眼珠","娃鞋","手型","脚型","袜子","配饰"]);let l=e.ref("全部"),i=e.ref({}),s=e.ref({});const c=new Date,r=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,u=e.ref(null),m=uni.getSystemInfoSync(),p=m.screenWidth/7;let g=e.ref(0);t("log","at pages/calendar/calendar.vue:138","状态栏高度"+e.ref(m.statusBarHeight).value);let h=e.ref(r),v=e.ref({});function f(e){const t={};return Object.entries(i.value).forEach((([a,o])=>{const n={...o};n.goods&&(n.goods="全部"===e?n.goods:n.goods.filter((t=>t.type===e)),0===n.goods.length&&(n.goods=null)),t[a]=n})),t}uni.showLoading({title:"加载中"});function y(e){const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}function w(e){uni.navigateTo({url:"/pages/goods/goods?goods_id="+e})}return uni.request({url:d+"/goods-news",method:"GET",timeout:5e3,success:e=>{t("log","at pages/calendar/calendar.vue:167",e.data.data),i.value=e.data.data,s.value=f("全部");for(let[t,a]of Object.entries(s.value))t===r&&(v.value=a)},fail:e=>{t("log","at pages/calendar/calendar.vue:179",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{g.value=7*p-5,t("log","at pages/calendar/calendar.vue:187","left:"+g.value),uni.hideLoading()}}),(o,i)=>{const c=a(e.resolveDynamicComponent("common-search"),B),r=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"rgb(185 195 253)"}),e.createVNode(r,{head_color:"rgb(185 195 253)"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"goods_renew_header_content"},[e.createElementVNode("view",{style:e.normalizeStyle([{width:"80%",margin:"40rpx auto 20rpx auto"},""])},[e.createVNode(c,{width:"560rpx"})],4),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"choose_tab","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>(e.openBlock(),e.createElementBlock("text",{key:a,class:e.normalizeClass({active:e.unref(l)===t}),onClick:e=>(e=>{l.value=e;const t=f(e);s.value={...t};const a=Object.entries(t).find((([e,t])=>t.goods));a?(h.value=a[0],v.value=a[1]):v.value={goods:null}})(t)},e.toDisplayString(t),11,["onClick"])))),128))])]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("scroll-view",{class:"scroll-view_H","scroll-x":"true",ref_key:"scrollView",ref:u,"scroll-left":e.unref(g),"show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"scroll-view-item_H",onClick:e=>function(e,a){t("log","at pages/calendar/calendar.vue:237",a),h.value=e,v.value=a}(o,a)},[a.goods_number>0?(e.openBlock(),e.createElementBlock("view",{key:0},["周日"===a.weekday||"周六"===a.weekday?(e.openBlock(),e.createElementBlock("view",{key:0,class:"float-number-red"},e.toDisplayString(a.goods_number),1)):e.createCommentVNode("",!0),"周日"!==a.weekday&&"周六"!==a.weekday?(e.openBlock(),e.createElementBlock("view",{key:1,class:"float-number-blue"},e.toDisplayString(a.goods_number),1)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),"周日"===a.weekday||"周六"===a.weekday?(e.openBlock(),e.createElementBlock("text",{key:1,style:{display:"block",margin:"10px 0px 15px",color:"#e65555"}},e.toDisplayString(a.weekday),1)):e.createCommentVNode("",!0),"周日"!==a.weekday&&"周六"!==a.weekday?(e.openBlock(),e.createElementBlock("text",{key:2,style:{display:"block",margin:"10px 0px 15px"}},e.toDisplayString(a.weekday),1)):e.createCommentVNode("",!0),e.unref(h)!==o?(e.openBlock(),e.createElementBlock("text",{key:3,style:{display:"block","border-radius":"100%",padding:"10px","box-sizing":"border-box",width:"60px",height:"47px"}},e.toDisplayString(a.day_number),1)):(e.openBlock(),e.createElementBlock("text",{key:4,style:{display:"block",background:"#7dc3d3",color:"#fff","border-radius":"5px",padding:"10px","box-sizing":"border-box",width:"60px",height:"45px"}},e.toDisplayString(a.day_number),1))],8,["onClick"])))),128))],8,["scroll-left"]),e.createElementVNode("view",{style:{padding:"5px 0px"}},[e.createElementVNode("text",{class:"font-alimamashuhei",style:{color:"#7dc3d3",margin:"15px 0px 15px 0px",display:"block"}},e.toDisplayString(e.unref(h))+" 日 星期"+e.toDisplayString(e.unref(v).weekday)+"上新",1),null==e.unref(v).goods?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("text",null,"这天没有上新呢...")])):e.createCommentVNode("",!0)]),e.unref(v).goods?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(e.unref(v).goods,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,style:{margin:"10px 0px 10px 0px","box-sizing":"border-box",padding:"10px 0px"}},[e.createElementVNode("view",{style:{width:"30vw",float:"left",position:"relative"}},[e.createElementVNode("navigator",{onClick:e=>w(t.goods_id)},[e.createElementVNode("image",{src:t.goods_image,mode:"aspectFill",style:{width:"30vw",height:"auto","aspect-ratio":"1"}},null,8,["src"]),e.createElementVNode("text",{style:{left:"0px",position:"absolute",top:"5px",width:"100px",background:"rgb(82 104 138)",color:"#fff","text-align":"center",opacity:"0.8","font-size":"13px",padding:"5rpx"}},e.toDisplayString(t.sale_type),1)],8,["onClick"])]),e.createElementVNode("view",{class:"brand_goods_item",style:{width:"calc(70vw - 70px)",float:"left","margin-left":"15px"}},[e.createElementVNode("navigator",{onClick:e=>w(t.goods_id)},[e.createElementVNode("text",{class:"font-alimamashuhei"},e.toDisplayString(t.brand_name)+" "+e.toDisplayString(t.goods_name),1),e.createElementVNode("view",null,[e.createElementVNode("text",{class:"line-height"},e.toDisplayString(t.size)+"·"+e.toDisplayString(t.size_detail)+"·"+e.toDisplayString(t.type),1)]),e.createElementVNode("view",null,[e.createElementVNode("text",{class:"line-height"},"开定时间 "+e.toDisplayString(y(t.sub_time)),1)]),"限量现货"!=t.sale_type&&"不限量现货"!=t.sale_type?(e.openBlock(),e.createElementBlock("text",{key:0,class:"line-height",style:{color:"rgb(255 150 178)"}},[e.createTextVNode(" 定金 "),e.createElementVNode("text",{style:{"font-size":"25px",color:"rgb(255 150 178)","font-weight":"900"}},e.toDisplayString(t.sub_amount),1),e.createTextVNode(" ("+e.toDisplayString(t.currency)+") 尾款 ",1),e.createElementVNode("text",{style:{color:"rgb(255 150 178)","font-weight":"900"}},e.toDisplayString(t.fin_amount),1)])):e.createCommentVNode("",!0),"限量现货"==t.sale_type||"不限量现货"==t.sale_type?(e.openBlock(),e.createElementBlock("text",{key:1,class:"line-height",style:{color:"rgb(255 150 178)"}},[e.createTextVNode(" 全款 "),e.createElementVNode("text",{style:{"font-size":"25px",color:"rgb(255 150 178)","font-weight":"900"}},e.toDisplayString(t.sub_amount+t.fin_amount),1),e.createTextVNode(" ("+e.toDisplayString(t.currency)+") ",1)])):e.createCommentVNode("",!0)],8,["onClick"])]),e.createElementVNode("view",{style:{clear:"both"}})])))),128)):e.createCommentVNode("",!0)])])),_:1})],64)}}},[["__scopeId","data-v-83123a10"]]),U=uni.getSystemInfoSync();function H(e){if("number"==typeof e||!isNaN(Number(e)))return uni.upx2px(e);if("string"==typeof e){if(e.endsWith("rpx"))return H(e.replace("rpx",""));if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("vw"))return Number(e.replace("vw",""))*U.screenWidth/100;if(e.endsWith("vh"))return Number(e.replace("vh",""))*U.screenHeight/100}return 0}const G=e=>{(e.$wxs||(e.$wxs=[])).push("wxsModule"),(e.$wxsModules||(e.$wxsModules={})).wxsModule="8ab5efd6"},W={name:"bt-cropper",props:{imageSrc:{type:String,default:"",required:!0},mask:{type:String,default:""},containerSize:{type:Object,default:null},fileType:{type:String,default:"png"},dWidth:Number,maxWidth:{type:Number,default:2e3},ratio:{type:Number,default:0,validator:e=>"number"==typeof e&&!(e<0)},rotate:Number,showGrid:{type:Boolean,default:!1},quality:{type:Number,default:1},canvas2d:{type:Boolean,default:!1},initPosition:{type:Object,default:()=>null},autoZoom:{type:Boolean,default:!0}},data:()=>({canvasId:"bt-cropper",containerRect:null,imageInfo:null,operationHistory:[],operationIndex:0,anim:!1,timer:null,type2d:!1,pixel:1,imageRect:null,cropperRect:null,target:{width:0,height:0}}),watch:{imageSrc:{handler(e){"string"==typeof e&&""!==e?this.imageInit(e):this.imageInfo=null},immediate:!0},ratio(){0!=this.ratio&&(this.startAnim(),this.init())}},computed:{containerStyle(){return this.containerSize&&this.containerRect?{width:this.containerRect.width+"px",height:this.containerRect.height+"px"}:{}},rotateAngle(){const e=Number(this.rotate);return isNaN(e)?0:e%360}},methods:{startAnim(){this.stopAnim(),this.anim=!0,this.timer=setTimeout((()=>{this.anim=!1}),200)},stopAnim(){this.anim=!1,clearTimeout(this.timer)},imageInit(e){uni.showLoading({title:"载入中..."}),uni.getImageInfo({src:e,success:e=>{this.imageInfo=e,this.$nextTick((()=>{this.getContainer().then((e=>{this.containerRect=e,this.init()}))}))},fail:e=>{this.$emit("loadFail",e),uni.showToast({title:"图片下载失败!",icon:"none"})},complete(e){uni.hideLoading()}})},initCropper(){const e=this.imageInfo.width/this.imageInfo.height,t=this.containerRect.width/this.containerRect.height,a={};let o=this.ratio;0==o&&(o=this.cropperRect?this.cropperRect.width/this.cropperRect.height:1);const n={};return t>o?(n.height=.85*this.containerRect.height,n.width=n.height*o):(n.width=.85*this.containerRect.width,n.height=n.width/o),o>e?(a.width=n.width,a.height=a.width/e):(a.height=n.height,a.width=a.height*e),a.left=(this.containerRect.width-a.width)/2,a.top=(this.containerRect.height-a.height)/2,n.left=a.left+(a.width-n.width)/2,n.top=a.top+(a.height-n.height)/2,{imageRect:a,cropperRect:n}},init(){const{imageRect:e,cropperRect:t}=this.initCropper();if(this.initPosition){const a=this.imageInfo.width/e.width,{left:o,top:n,width:l,height:i}=this.initPosition;void 0!==o&&void 0!==n&&void 0!==l&&void 0!==i&&(t.width=l/a,t.height=i/a,t.left=o/a,t.top=n/a,this.$nextTick(this.zoomToFill))}this.imageRect=e,this.cropperRect=t,this.operationHistory=[{imageRect:e,cropperRect:t}],this.operationIndex=0,this.setTarget(),this.type2d=!1},setTarget(){const e=this.cropperRect.width/this.cropperRect.height;if(this.dWidth)this.target={width:this.dWidth,height:this.dWidth/(e||1)};else{const t=Math.min(this.maxWidth,this.cropperRect.width*(this.imageInfo.width/this.imageRect.width));this.target={width:t,height:t/(e||1)}}},addHistory({imageRect:e,cropperRect:t}){this.operationIndex!==this.operationHistory.length-1&&(this.operationHistory=this.operationHistory.slice(0,this.operationIndex)),this.operationHistory.push({imageRect:e,cropperRect:t}),this.operationHistory.length>10&&this.operationHistory.shift(),this.operationIndex=this.operationHistory.length-1},updateData(e){this.imageRect=e.imageRect,this.cropperRect=e.cropperRect,this.addHistory(e),this.setTarget(),this.autoZoom&&(this.timer=setTimeout((()=>{this.zoomToFill()}),600));const{imageRect:t,cropperRect:a}=e,o=t.width/this.imageInfo.width;this.$emit("change",{left:(a.left-t.left)/o,top:(a.top-t.top)/o,width:a.width/o,height:a.height/o})},getContainer(){if(null!==this.containerSize&&"object"==typeof this.containerSize){const{width:e,height:t}=this.containerSize;return Promise.resolve({width:H(e),height:H(t)})}return new Promise((e=>{uni.createSelectorQuery().in(this).select(".mainContent").boundingClientRect((t=>{e(t)})).exec()}))},zoomToFill(){this.startAnim();const e={...this.cropperRect};this.imageRect,this.cropperRect,this.cropperRect=this.initCropper().cropperRect;const t=this.cropperRect.width/e.width,a=e.left-this.imageRect.left,o=e.top-this.imageRect.top;this.imageRect={width:this.imageRect.width*t,height:this.imageRect.height*t,left:this.imageRect.left+(this.cropperRect.left-e.left)-(t-1)*a,top:this.imageRect.top+(this.cropperRect.top-e.top)-(t-1)*o}},onTouchStart(){this.stopAnim()},undo(){return this.operationIndex>0&&(this.operationIndex--,this.imageRect=this.operationHistory[this.operationIndex].imageRect,this.cropperRect=this.operationHistory[this.operationIndex].cropperRect,!0)},resume(){return this.operationIndex<this.operationHistory.length-1&&(this.operationIndex++,this.imageRect=this.operationHistory[this.operationIndex].imageRect,this.cropperRect=this.operationHistory[this.operationIndex].cropperRect,!0)},async drawImage(e,t,a,o,n,l){if(this.type2d)await new Promise((e=>t.onload=e)),e.drawImage(t,a*this.pixel,o*this.pixel,n*this.pixel,l*this.pixel);else{const i=await new Promise((e=>{uni.getImageInfo({src:t,success({path:t}){e(t)}})}));e.drawImage(i,a*this.pixel,o*this.pixel,n*this.pixel,l*this.pixel),await new Promise((t=>e.draw(!1,t)))}},async crop(){let e,a;if(this.$emit("cropStart"),this.setTarget(),this.type2d){const t=uni.createSelectorQuery().in(this);a=await new Promise((e=>t.select(".bt-canvas").node((({node:t})=>e(t))).exec())),a.width=this.target.width*this.pixel,a.height=this.target.height*this.pixel,e=a.getContext("2d")}else e=uni.createCanvasContext(this.canvasId,this);const o=this.cropperRect.width/this.target.width,n=(this.cropperRect.left-this.imageRect.left)/o,l=(this.cropperRect.top-this.imageRect.top)/o;let i;this.type2d?(i=a.createImage(),i.src=this.imageSrc):i=this.imageSrc;const s=-n,c=-l,r=this.imageRect.width/o,d=this.imageRect.height/o;if(e.save(),e.translate(s+r/2,c+d/2),e.rotate(this.rotateAngle*Math.PI/180),e.translate(-(s+r/2),-(c+d/2)),await this.drawImage(e,i,s,c,r,d),e.restore(),""!==this.mask){let t,a;t=this.type2d?e.getImageData(0,0,this.target.width,this.target.height):await new Promise((e=>{uni.canvasGetImageData({canvasId:this.canvasId,x:0,y:0,width:this.target.width,height:this.target.height,success(t){e(t)}},this)})),e.clearRect(0,0,this.target.width,this.target.height),this.type2d?i.src=this.mask:i=this.mask,await this.drawImage(e,i,0,0,this.target.width,this.target.height),a=this.type2d?e.getImageData(0,0,this.target.width,this.target.height):await new Promise(((e,t)=>{uni.canvasGetImageData({canvasId:this.canvasId,x:0,y:0,width:this.target.width,height:this.target.height,success(t){e(t)}},this)})),e.clearRect(0,0,this.target.width,this.target.height);for(let e=3;e<a.data.length;e+=4){0!==a.data[e]&&(t.data[e]=0)}this.type2d?e.putImageData(t,0,0):await new Promise((e=>{uni.canvasPutImageData({canvasId:this.canvasId,x:0,y:0,width:t.width,height:t.height,data:t.data,complete:t=>{e(t)}},this)}))}return new Promise(((e,o)=>{const n={};this.type2d?n.canvas=a:n.canvasId=this.canvasId,uni.canvasToTempFilePath({...n,destWidth:this.target.width,destHeight:this.target.height,quality:Number(this.quality)||1,fileType:this.fileType,success:({tempFilePath:t})=>{e(t)},fail(e){t("log","at uni_modules/bt-cropper/components/bt-cropper/bt-cropper.vue:593","保存失败，错误信息：",e),o(e)}},this)}))}}};G(W);const Y=w(W,[["render",function(t,a,o,n,l,i){return e.openBlock(),e.createElementBlock("view",{class:"bt-container",style:e.normalizeStyle([i.containerStyle])},[e.createElementVNode("view",{class:"mainContent","data-type":"image",onTouchstart:a[8]||(a[8]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),onTouchmove:a[9]||(a[9]=(...e)=>t.wxsModule.touchMove&&t.wxsModule.touchMove(...e)),onTouchend:a[10]||(a[10]=(...e)=>t.wxsModule.touchEnd&&t.wxsModule.touchEnd(...e))},[l.imageRect&&l.cropperRect?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("image",{mode:"aspectFit",src:o.imageSrc,class:e.normalizeClass(["image",{anim:l.anim}]),rotateAngle:e.wp(i.rotateAngle),"change:rotateAngle":t.wxsModule.changeRotateAngle,"change:imageRect":t.wxsModule.changeImageRect,imageRect:e.wp(l.imageRect)},null,10,["src","rotateAngle","change:rotateAngle","change:imageRect","imageRect"]),e.createElementVNode("view",{class:e.normalizeClass(["cropper",{anim:l.anim}]),"change:cropperRect":t.wxsModule.changeCropper,cropperRect:e.wp(l.cropperRect),"change:ratio":t.wxsModule.changeRatio,ratio:e.wp(o.ratio)},[e.createElementVNode("image",{class:"mask",src:o.mask},null,8,["src"]),o.showGrid?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"line row row1"}),e.createElementVNode("view",{class:"line row row2"}),e.createElementVNode("view",{class:"line col col1"}),e.createElementVNode("view",{class:"line col col2"})],64)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"controller vertical left",onTouchstart:a[0]||(a[0]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller vertical right",onTouchstart:a[1]||(a[1]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller horizon top",onTouchstart:a[2]||(a[2]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller horizon bottom",onTouchstart:a[3]||(a[3]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller left top",onTouchstart:a[4]||(a[4]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller left bottom",onTouchstart:a[5]||(a[5]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller right top",onTouchstart:a[6]||(a[6]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller right bottom",onTouchstart:a[7]||(a[7]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32)],10,["change:cropperRect","cropperRect","change:ratio","ratio"])],64)):e.createCommentVNode("",!0)],32),l.type2d?(e.openBlock(),e.createElementBlock("canvas",{key:0,type:"2d",class:"bt-canvas",width:l.target.width,height:l.target.height},null,8,["width","height"])):(e.openBlock(),e.createElementBlock("canvas",{key:1,"canvas-id":l.canvasId,class:"bt-canvas",style:e.normalizeStyle({width:l.target.width+"px",height:l.target.height+"px"}),width:l.target.width*l.pixel,height:l.target.height*l.pixel},null,12,["canvas-id","width","height"]))],4)}],["__scopeId","data-v-339decdf"]]);const Q=w({data:()=>({imageSrc:"",dist:"",mask:"",ratio:1,containerSize:{width:600,height:600},initPosition:null}),onLoad(e){this.imageSrc=decodeURIComponent(e.src)},onPullDownRefresh(){uni.stopPullDownRefresh()},methods:{openPopup(){this.$refs.pop.open()},change(){uni.chooseImage({count:1,sizeType:["original"],success:e=>{let t=e.tempFilePaths[0];this.src=t,this.initPosition=null}})},close(){this.$refs.pop.close()},onChange(e){this.initPosition=e},undo(){this.$refs.cropper.undo()},resume(){this.$refs.cropper.resume()},crop(){this.$refs.cropper.crop().then((e=>{this.dist=e;const a=getCurrentPages(),o=a[a.length-2];t("log","at pages/pop_croper/pop_croper.vue:82",o),o.returnParam=e,uni.navigateBack({delta:1})}))}}},[["render",function(t,o,n,l,i,s){const c=a(e.resolveDynamicComponent("bt-cropper"),Y),r=e.resolveComponent("uni-popup");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(r,{ref:"pop"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"content"},[e.createVNode(c,{ref:"cropper",imageSrc:i.imageSrc,mask:i.mask,ratio:i.ratio,initPosition:i.initPosition,dWidth:800,fileType:"png",containerSize:i.containerSize,onChange:s.onChange},null,8,["imageSrc","mask","ratio","initPosition","containerSize","onChange"]),e.createElementVNode("view",{class:"btns"},[e.createElementVNode("button",{class:"button",onClick:o[0]||(o[0]=(...e)=>s.crop&&s.crop(...e))},"裁剪"),e.createElementVNode("button",{class:"button",onClick:o[1]||(o[1]=(...e)=>s.undo&&s.undo(...e))},"撤销")])])])),_:1},512)])}],["__scopeId","data-v-a1faecd2"]]),X=w({__name:"setting",setup(a){uni.setNavigationBarTitle({title:"设置"});const o=e.computed((()=>[{label:"更改用户名",action:i,status:!!m.userInfo.password,displayValue:m.userInfo.password?"去修改":"未设置"},{label:"更改密码",action:n,status:!!m.userInfo.password,displayValue:m.userInfo.password?"去修改":"未设置"},{label:"绑定手机号",action:l,status:!!m.userInfo.tel_phone,displayValue:m.userInfo.tel_phone?m.userInfo.tel_phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"去绑定"},{label:"绑定微信",action:s,status:!!m.userInfo.wechat_open_id,displayValue:m.userInfo.wechat_open_id?"已绑定":"去绑定"},{label:"检查更新",action:c,status:!1,displayValue:"无需更新"}]));function n(){uni.navigateTo({url:"/pages/setting/password/password"})}function l(){uni.navigateTo({url:"/pages/setting/tel_phone/tel_phone"})}function i(){uni.navigateTo({url:"/pages/setting/username/username"})}function s(){m.userInfo.wechat_open_id?uni.showToast({title:"已绑定微信",icon:"none"}):p().then((e=>{uni.showToast({title:"绑定成功"}),g()}))}function c(){if("app"===uni.getSystemInfoSync().platform){t("log","at pages/setting/setting.vue:108","App version from manifest:",plus.runtime.version)}else uni.showToast({title:"您所使用的平台无需更新",icon:"none"})}return e.ref({}),e.ref(!1),g(),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"settings-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"menu-item",onClick:e=>t.action(t)},[e.createElementVNode("text",{class:"menu-label"},e.toDisplayString(t.label),1),e.createElementVNode("view",{class:"menu-value"},[e.createElementVNode("text",{class:e.normalizeClass(t.status?"active":"inactive")},e.toDisplayString(t.displayValue),3),e.createElementVNode("image",{class:"arrow-icon",src:I})])],8,["onClick"])))),128))]))}},[["__scopeId","data-v-9a130153"]]),J=w({__name:"password",setup(o){uni.setNavigationBarTitle({title:"设置密码"});let n=e.ref(""),l=e.ref(""),i=e.ref("");const s=e.computed((()=>l.value&&i.value&&l.value===i.value)),c=e.computed((()=>l.value.length<6?"密码过于简单":l.value.length<10?"密码强度一般":"密码强度较高")),r=e=>l.value.length<6?"weak":l.value.length<10?"medium":"strong";function u(){l.value==i.value?m.userInfo.password||n.value?uni.request({url:d+"/with-state/setting-password",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{old_password:n.value,new_password:l.value},success:e=>{t("log","at pages/setting/password/password.vue:133",e.data),"success"==e.data.status?uni.showToast({title:"修改成功",icon:"success"}):uni.showToast({title:e.data.msg,icon:"none"})}}):uni.showToast({title:"请输入原密码",icon:"none"}):uni.showToast({title:"两次密码输入不一致",icon:"none"})}return g(),(t,o)=>{const d=a(e.resolveDynamicComponent("uni-icons"),N);return e.openBlock(),e.createElementBlock("view",{class:"password-container"},[e.createElementVNode("view",{class:"form-wrapper"},[e.unref(m).userInfo.password?(e.openBlock(),e.createElementBlock("view",{key:0,class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[0]||(o[0]=t=>e.isRef(n)?n.value=t:n=t)},null,512),[[e.vModelText,e.unref(n)]]),e.createElementVNode("label",{class:"floating-label"},"原密码"),e.createVNode(d,{class:"input-icon",type:"locked",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]]),e.createElementVNode("label",{class:"floating-label"},"新密码"),e.createVNode(d,{class:"input-icon",type:"gear",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[2]||(o[2]=t=>e.isRef(i)?i.value=t:i=t)},null,512),[[e.vModelText,e.unref(i)]]),e.createElementVNode("label",{class:"floating-label"},"确认新密码"),e.createVNode(d,{class:"input-icon",type:"checkmarkempty",size:"18",color:"#999"})])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[3]||(o[3]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]]),e.createElementVNode("label",{class:"floating-label"},"设置密码"),e.createVNode(d,{class:"input-icon",type:"locked",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[4]||(o[4]=t=>e.isRef(i)?i.value=t:i=t)},null,512),[[e.vModelText,e.unref(i)]]),e.createElementVNode("label",{class:"floating-label"},"确认密码"),e.createVNode(d,{class:"input-icon",type:"checkmarkempty",size:"18",color:"#999"})])])),e.unref(l)?(e.openBlock(),e.createElementBlock("view",{key:2,class:"password-strength"},[e.createElementVNode("view",{class:e.normalizeClass(["strength-bar",r()])},null,2),e.createElementVNode("view",{class:e.normalizeClass(["strength-bar",r()])},null,2),e.createElementVNode("view",{class:e.normalizeClass(["strength-bar",r()])},null,2),e.createElementVNode("text",{class:"strength-text"},e.toDisplayString(c.value),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{active:s.value}]),onClick:u,disabled:!s.value},e.toDisplayString(e.unref(m).userInfo.password?"更新密码":"设置密码"),11,["disabled"])]),e.createElementVNode("view",{class:"security-tips"},[e.createVNode(d,{type:"info",size:"16",color:"#666"}),e.createElementVNode("text",null,"建议使用8位以上包含字母和数字的组合")])])}}},[["__scopeId","data-v-5a6ada3f"]]),Z=w({__name:"tel_phone",setup(a){uni.setNavigationBarTitle({title:"手机号"});let o=e.ref(""),n=e.ref(""),l=e.ref("发送验证码");function i(){uni.request({url:d+"/with-state/update-profile",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{tel_phone:o.value,code:n.value},success:e=>{t("log","at pages/setting/tel_phone/tel_phone.vue:57",e.data),"success"==e.data.status?(uni.showToast({title:"修改成功",icon:"success"}),g()):uni.showToast({title:e.data.msg,icon:"none"})}})}function s(){"发送验证码"==l.value?""!=o.value&&""!=o.value?/^1[3456789]\d{9}$/.test(o.value)?(l.value="发送中",uni.request({url:d+"/send-sms-code",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{tel_phone:o.value},success:e=>{t("log","at pages/setting/tel_phone/tel_phone.vue:110",e.data),"success"==e.data.status?(l.value="已发送",uni.showToast({title:"发送成功",icon:"success"})):(uni.showToast({title:e.data.msg,icon:"none"}),l.value="发送验证码")}})):uni.showToast({title:"手机号格式错误",icon:"none"}):uni.showToast({title:"请输入手机号和密码",icon:"none"}):uni.showToast({title:"请点击发送验证码",icon:"none"})}return g(),(t,a)=>(e.openBlock(),e.createElementBlock("view",{style:{padding:"15px"}},[e.unref(m).userInfo.tel_phone?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("input",{type:"text",class:"inputer",value:e.unref(m).userInfo.tel_phone,disabled:""},null,8,["value"]),e.createElementVNode("text",{style:{padding:"10px","font-size":"20px",color:"rgb(190 190 190)"}},"已绑定，如需修改请联系管理员操作。")])):(e.openBlock(),e.createElementBlock("view",{key:1},[e.withDirectives(e.createElementVNode("input",{class:"inputer",type:"text",placeholder:"请输入手机号","onUpdate:modelValue":a[0]||(a[0]=t=>e.isRef(o)?o.value=t:o=t)},null,512),[[e.vModelText,e.unref(o)]]),e.createElementVNode("view",{style:{position:"relative"}},[e.withDirectives(e.createElementVNode("input",{class:"inputer",type:"text",placeholder:"请输入验证码","onUpdate:modelValue":a[1]||(a[1]=t=>e.isRef(n)?n.value=t:n=t)},null,512),[[e.vModelText,e.unref(n)]]),e.createElementVNode("button",{style:{position:"absolute",right:"0px",width:"110px","font-size":"16px",bottom:"10px"},onClick:s},[e.createElementVNode("text",null,e.toDisplayString(e.unref(l)),1)])])])),e.unref(m).userInfo.tel_phone?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:2,class:"light_button",onClick:i},"提交"))]))}},[["__scopeId","data-v-8e647c70"]]),K="/static/info-circle.png";function ee(){return new Promise((e=>{uni.chooseImage({count:1,success:t=>{e(t.tempFilePaths[0])}})}))}function te(e=9){return new Promise(((t,a)=>{uni.chooseImage({count:e,success:e=>{t(e.tempFilePaths)},fail:e=>{a(e)}})}))}function ae(){return new Promise(((e,a)=>{let o=uni.getStorageSync("token");uni.request({url:d+"/with-state/qiniu-token",method:"POST",header:{Authorization:o},success:o=>{o.data.data&&o.data.data.token?(t("log","at common/image.js:54","获取到的七牛token："+o.data.data.token),e(o.data.data)):(uni.showToast({title:"获取上传凭证失败",icon:"none"}),a("获取上传凭证失败"))},fail:e=>{uni.showToast({title:"获取上传凭证失败",icon:"none"}),a("获取上传凭证失败")}})}))}function oe(e,a,o){let n=uni.getStorageSync("token");return new Promise(((l,i)=>{uni.uploadFile({url:"https://up-cn-east-2.qiniup.com",name:"file",method:"POST",filePath:e,fileType:"image",formData:{token:a,key:o,scope:"hobby-box:"+o},success:async e=>{try{const a=u+o,i=await uni.request({url:`${d}/with-state/add-image-log`,method:"POST",header:{"Content-Type":"application/json",Authorization:n},data:{image_url:a}});if(t("log","at common/image.js:108",i),"success"!==i.data.status)throw new Error("上传图片失败");l({qiniuRes:e,imageUrl:a})}catch(a){t("error","at common/image.js:115","日志记录失败:",a),uni.showToast({title:"日志记录失败",icon:"none"}),i("日志记录失败")}},fail:e=>{uni.showToast({title:"上传失败",icon:"none"}),i("上传失败")}})}))}const ne=w({__name:"account_book_form",props:["account_book_id"],setup(o){const l=o,i=!!l.account_book_id,s=uni.getSystemInfoSync();e.ref(s.statusBarHeight);let c=e.ref(""),r=e.ref("");e.ref(1);const m=e.ref(!1),p=e.ref(""),g=e.ref([]),v=["请选择","娃衣","娃头","眼珠","假发","娃鞋","其它"],f=e.computed((()=>[...v,...g.value.map((e=>e.name))])),y=e.ref({isRemind:!1,finalPrice:0,finalTime:""}),w=async()=>{const e=uni.getStorageSync("token");try{const t=await uni.request({url:d+"/with-state/account-types",method:"GET",header:{Authorization:e}});g.value=t.data.data||[]}catch(a){t("error","at pages/stock/account_book_form/account_book_form.vue:190","获取分类失败:",a)}},_=async()=>{if(!p.value.trim())return void uni.showToast({title:"请输入分类名称",icon:"none"});const e=uni.getStorageSync("token");try{await uni.request({url:d+"/with-state/add-account-type",method:"POST",header:{Authorization:e},data:{name:p.value.trim()}}),await w(),p.value="",uni.showToast({title:"添加成功"})}catch(t){uni.showToast({title:"添加失败",icon:"none"})}},E=e.ref(0);e.ref(["请选择","娃衣","娃头","眼珠","假发","娃鞋","其它"]),e.ref({});const V=e.ref("");function b(e){E.value=e.detail.value}const x=async e=>{var a;try{const t=await uni.request({url:`http://localhost:8080/goods?id=${e.id}`,method:"GET"});if("success"===t.data.status){const e=t.data.data;c.value=e.name,r.value=e.fin_amount+e.sub_amount,(null==(a=e.goods_images)?void 0:a[0])&&(V.value=e.goods_images[0])}}catch(o){t("error","at pages/stock/account_book_form/account_book_form.vue:351","获取商品详情失败:",o),uni.showToast({title:"获取商品信息失败",icon:"none"})}};function B(){uni.showModal({title:"提示",content:"确定删除该账本吗？",success:e=>{if(e.confirm){const e=Number(l.account_book_id);if(isNaN(e)||e<=0)return void uni.showToast({title:"参数错误",icon:"none"});uni.request({url:d+"/with-state/delete-account-book",method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{id:e},success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:384",e.data.status),"success"===e.data.status?(uni.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>uni.navigateBack()),500)):uni.showToast({title:e.data.msg||"删除失败",icon:"none"})},fail:e=>{t("error","at pages/stock/account_book_form/account_book_form.vue:396","请求失败:",e),uni.showToast({title:"网络错误",icon:"none"})}})}}})}function S(){ee().then((e=>{ae().then((a=>{t("log","at pages/stock/account_book_form/account_book_form.vue:408",a),oe(e,a.token,a.path).then((e=>{200!=e.statusCode&&uni.showToast({title:"上传失败",icon:"none"}),t("log","at pages/stock/account_book_form/account_book_form.vue:417",u+a.path),V.value=u+a.path,uni.showToast({title:"上传成功",icon:"success"})}))}))}))}function C(){D()&&(i?function(){let e={name:c.value,price:parseInt(r.value,10),type:f.value[E.value],image_url:V.value,id:parseInt(l.account_book_id,10),is_remind:y.value.isRemind,final_price:parseInt(y.value.finalPrice,10),final_time:y.value.finalTime};uni.request({url:d+"/with-state/update-account-book",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:544",e.data),"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}():function(){let e={name:c.value,price:parseInt(r.value,10),type:f.value[E.value],image_url:V.value,is_remind:y.value.isRemind,final_price:parseInt(y.value.finalPrice,10),final_time:y.value.finalTime};t("log","at pages/stock/account_book_form/account_book_form.vue:493","提交数据:",e),uni.request({url:d+"/with-state/add-account-book",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:503",e.data),"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}())}h().then((e=>{i?(!function(e){let a=uni.getStorageSync("token");uni.request({url:d+"/with-state/account-book-detail",method:"GET",header:{Authorization:a},data:{id:e},success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:313",e.data.data),c.value=e.data.data.name,r.value=parseInt(e.data.data.price),E.value=f.value.indexOf(e.data.data.type),V.value=e.data.data.image_url,y.value={isRemind:e.data.data.is_remind,finalPrice:e.data.data.final_price,finalTime:e.data.data.final_time},t("log","at pages/stock/account_book_form/account_book_form.vue:324","f:",y)},fail:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:327",e)}})}(l.account_book_id),uni.setNavigationBarTitle({title:"编辑账本"})):uni.setNavigationBarTitle({title:"新增账本"})}));const D=()=>{if(y.value.isRemind){if(!y.value.finalPrice||y.value.finalPrice<=0)return uni.showToast({title:"请输入正确的尾款金额",icon:"none"}),!1;if(!y.value.finalTime||new Date(y.value.finalTime)<new Date)return uni.showToast({title:"请选择未来的日期",icon:"none"}),!1}return!0};return n((()=>{h().then((()=>{w()}))})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),N),s=a(e.resolveDynamicComponent("common-modal"),T),u=a(e.resolveDynamicComponent("goods-search"),k);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(s,{visible:m.value,"onUpdate:visible":n[1]||(n[1]=e=>m.value=e),top:"5%",height:"60%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"type-modal"},[e.createElementVNode("view",{class:"add-type-form"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>p.value=e),placeholder:"输入新分类名称",class:"type-input"},null,512),[[e.vModelText,p.value]]),e.createElementVNode("button",{class:"add-btn",onClick:_},"添加分类")]),e.createElementVNode("view",{class:"type-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"type-item"},[e.createElementVNode("text",null,e.toDisplayString(a.name),1),e.createVNode(l,{type:"trash",size:"22",color:"#ff6666",onClick:e=>(async e=>{uni.showModal({title:"确认删除",success:async a=>{if(a.confirm){const a=uni.getStorageSync("token");try{const t=(await uni.request({url:d+"/with-state/delete-account-type",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{id:e}})).data;"success"===t.status?(await w(),uni.showToast({title:"删除成功"})):uni.showToast({title:t.msg||"删除失败",icon:"none"})}catch(o){t("error","at pages/stock/account_book_form/account_book_form.vue:260","删除失败:",o),uni.showToast({title:o.errMsg||"请求失败",icon:"none"})}}}})})(a.id)},null,8,["onClick"])])))),128))])])])),_:1},8,["visible"]),e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"分类"),e.createElementVNode("view",{class:"type-selector"},[e.createElementVNode("picker",{mode:"selector",class:"form-input",value:E.value,range:f.value,onChange:b},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(f.value[E.value]||"请选择分类"),1)],40,["value","range"]),e.createElementVNode("text",{class:"manage-type",onClick:n[2]||(n[2]=e=>m.value=!0)},"管理分类")])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"名称"),e.createElementVNode("view",{class:"form-input",style:{padding:"0"}},[e.createVNode(u,{"font-size":"24rpx",mode:"fill",onSelect:x,modelValue:e.unref(c),"onUpdate:modelValue":n[3]||(n[3]=t=>e.isRef(c)?c.value=t:c=t),background:"#fff",width:"640rpx","show-icon":!1,class:"custom-search"},null,8,["modelValue"])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"价值"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit",placeholder:"请输入价值","placeholder-class":"placeholder-style","onUpdate:modelValue":n[4]||(n[4]=t=>e.isRef(r)?r.value=t:r=t)},null,512),[[e.vModelText,e.unref(r)]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"物品图片"),e.createElementVNode("view",{class:"upload-wrapper"},[V.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"preview-image",onClick:e.withModifiers(S,["stop"])},[e.createElementVNode("image",{mode:"aspectFill",src:V.value,class:"image-preview"},null,8,["src"]),e.createElementVNode("text",{class:"image-tip"},"点击更换图片")])):(e.openBlock(),e.createElementBlock("button",{key:1,class:"upload-button",onClick:S},[e.createElementVNode("text",{class:"iconfont icon-camera"}),e.createTextVNode(" 选择图片 ")]))])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("label",{class:"remind-label",onClick:n[5]||(n[5]=e=>(y.value.isRemind=!y.value.isRemind,void(y.value.isRemind||(y.value.finalPrice=0,y.value.finalTime=""))))},[y.value.isRemind?(e.openBlock(),e.createBlock(l,{key:1,type:"down",size:"20",color:"#888"})):(e.openBlock(),e.createBlock(l,{key:0,type:"right",size:"20",color:"#888"})),e.createElementVNode("text",null,"需要补款提醒"),y.value.finalPrice>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"remind-dot"})):e.createCommentVNode("",!0)])]),y.value.isRemind?(e.openBlock(),e.createElementBlock("view",{key:0,class:"remind-form",style:{"margin-bottom":"40rpx"}},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"尾款金额"),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":n[6]||(n[6]=e=>y.value.finalPrice=e),placeholder:"请输入待补款金额",class:"form-input"},null,512),[[e.vModelText,y.value.finalPrice]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"补款日期"),e.createElementVNode("picker",{mode:"date",value:y.value.finalTime,onChange:n[7]||(n[7]=e=>y.value.finalTime=e.detail.value),class:"form-input"},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(y.value.finalTime||"选择截止日期"),1)],40,["value"])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{overflow:"hidden"}},[e.createElementVNode("image",{src:K,mode:"aspectFill",style:{width:"28rpx",height:"28rpx","margin-right":"10rpx",position:"relative",top:"3rpx"}}),e.createElementVNode("text",{style:{color:"#888"}},"仅用于记录您所购买过的物品，其他人不会看到")]),e.createElementVNode("view",{class:"button-group"},[e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"delete-button",onClick:B}," 删除账本 ")):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"submit-button",onClick:C}," 记录"+e.toDisplayString(e.unref(i)?"修改":"新增"),1)])])])}}},[["__scopeId","data-v-422c9f72"]]),le=w({__name:"common-name-picker",props:{dataList:{type:Array,default:()=>[]},placeholder:{type:String,default:"请选择"}},emits:["select"],setup(t,{emit:a}){const o=a,n=e.ref(!1),l=e.ref(""),i=()=>{n.value=!n.value};return(a,s)=>(e.openBlock(),e.createElementBlock("view",{class:"select-container",ref:"containerRef"},[e.createElementVNode("view",{class:"select-input",onClick:i},e.toDisplayString(l.value||t.placeholder),1),e.createVNode(e.Transition,{name:"slide-fade"},{default:e.withCtx((()=>[n.value?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"mask",onClick:s[0]||(s[0]=e=>n.value=!1)}),e.createElementVNode("view",{class:"options-wrapper"},[e.createElementVNode("ul",{class:"select-options"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.dataList,((t,a)=>(e.openBlock(),e.createElementBlock("li",{key:a,class:"option-item",onClick:e=>(e=>{l.value=e,n.value=!1,o("select",e)})(t)},e.toDisplayString(t),9,["onClick"])))),128))])])])):e.createCommentVNode("",!0)])),_:1})],512))}},[["__scopeId","data-v-763ca16b"]]),ie=w({__name:"custom-picker",props:{dataList:{type:Array,required:!0},margin:{type:String,default:"0"}},emits:["select"],setup(t,{emit:a}){const o=t,n=a,l=e.ref(""),i=e.ref(!1),s=e.computed((()=>o.dataList.filter((e=>e.name.toLowerCase().includes(l.value.toLowerCase()))))),c=()=>{n("select",0,l.value)},r=()=>{i.value=!i.value};return(a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"custom-select"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),onClick:r,onInput:c,placeholder:"请选择或输入",class:"select-input",style:e.normalizeStyle({margin:t.margin})},null,36),[[e.vModelText,l.value]]),e.createVNode(e.Transition,{name:"slide-fade"},{default:e.withCtx((()=>[i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"dropdown"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,onClick:e=>(e=>{l.value=e.name,i.value=!1,n("select",e.id,e.name)})(t),class:"dropdown-item"},e.toDisplayString(t.name),9,["onClick"])))),128))])):e.createCommentVNode("",!0)])),_:1})]))}},[["__scopeId","data-v-b13a175d"]]),se=w({__name:"relation-picker",props:{typeList:{type:Array,default:()=>[]},visible:{type:Boolean,default:!1}},emits:["update:visible","confirm","cancel"],setup(o,{emit:n}){const l=o,i=n,s=e.ref([]),c=e.ref(),r=e.ref(),u=e.ref(),m=e.ref(),p=e.ref(!1),g=e.ref(!0),h=e.ref({type:null,brand:{id:0,name:""},goods:{id:0,name:"",image:""}}),v=e.ref(""),f=e=>{g.value=e,w(),h.value={type:null,brand:{id:0,name:""},goods:{id:0,name:"",image:""}}},y=e=>{const t={type:c,brand:r,goods:u,fuzzy:m};Object.entries(t).forEach((([t,a])=>{var o;t!==e&&(null==(o=a.value)?void 0:o.close)&&a.value.close()}))},w=()=>{[c,r,u,m].forEach((e=>{var t;(null==(t=e.value)?void 0:t.reset)&&e.value.reset()}))},_=async e=>{var a;try{if(!(null==e?void 0:e.id))return v.value=e.name,void(h.value={type:"未知类型",brand:{id:0,name:""},goods:{id:0,name:e.name,image:""}});const t=await x(e.id);v.value=e.name,h.value={type:t.type||"未知类型",brand:{id:t.brand_id||0,name:t.brand_name||""},goods:{id:e.id,name:e.name,image:(null==(a=null==t?void 0:t.goods_images)?void 0:a[0])||""}}}catch(o){t("error","at components/relation-picker/relation-picker.vue:202","商品信息获取失败",o),uni.showToast({title:"详细信息获取失败，已保存基本信息",icon:"none"}),v.value=e.name,h.value={type:"未知类型",brand:{id:0,name:""},goods:{id:(null==e?void 0:e.id)||0,name:e.name,image:""}}}},E=()=>{p.value=!1,v.value="",w(),e.nextTick((()=>{h.value={type:null,brand:{id:0,name:""},goods:{id:0,name:"",image:""}}}))};e.watch((()=>l.visible),(e=>{p.value=e})),e.watch(p,(e=>{i("update:visible",e)}));const V=e=>{p.value=e,e||E()},b=e=>{h.value.type=e},x=e=>new Promise(((a,o)=>{uni.request({url:d+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{a(e.data.data)},fail:e=>{t("error","at components/relation-picker/relation-picker.vue:286","商品详情获取失败",e),o(e)}})})),S=(e,a)=>{h.value.brand={id:e||0,name:a},e&&function(e){uni.request({url:d+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{t("log","at components/relation-picker/relation-picker.vue:367",e.data.data),s.value=e.data.data,t("log","at components/relation-picker/relation-picker.vue:369",s.value)},fail:e=>{t("log","at components/relation-picker/relation-picker.vue:373",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}(e)},C=async(e,a)=>{var o;try{if(h.value.goods={id:e||0,name:a,image:""},e&&0!==e){const t=await x(e);h.value.goods.image=(null==(o=null==t?void 0:t.goods_images)?void 0:o[0])||""}}catch(n){t("error","at components/relation-picker/relation-picker.vue:352","商品信息获取失败",n),uni.showToast({title:"图片信息获取失败，已保存基本信息",icon:"none"})}};const D=async()=>{var e,a;try{let n=null;if(g.value)if(h.value.goods.id&&0!==h.value.goods.id)try{const t=await x(h.value.goods.id);n={isFuzzy:!0,keyword:v.value,goods:{id:t.id||h.value.goods.id,name:t.goods_name||h.value.goods.name,image:(null==(e=null==t?void 0:t.goods_images)?void 0:e[0])||""},brand:{id:t.brand_id||0,name:t.brand_name||""},type:t.type||"未知类型"}}catch(o){t("error","at components/relation-picker/relation-picker.vue:435","商品信息获取失败，使用缓存数据",o),n={isFuzzy:!0,keyword:v.value,goods:h.value.goods,brand:h.value.brand,type:h.value.type||"未知类型"}}else n={isFuzzy:!0,keyword:v.value,goods:{id:0,name:v.value,image:""},brand:{id:0,name:""},type:"未知类型"};else{if(t("log","at components/relation-picker/relation-picker.vue:465","jjjjjjjjjjjjjjjj"),h.value.goods.id&&0!==h.value.goods.id)try{const e=await x(h.value.goods.id);h.value.goods.image=(null==(a=null==e?void 0:e.goods_images)?void 0:a[0])||"",h.value.type=e.type||h.value.type}catch(o){t("error","at components/relation-picker/relation-picker.vue:474","商品信息获取失败，使用缓存数据",o)}if(!h.value.type)throw new Error("请选择商品类型");if(!h.value.brand.name)throw new Error("请填写或选择品牌");if(!h.value.goods.name)throw new Error("请填写或选择商品");n={isFuzzy:!1,type:h.value.type,brand:h.value.brand,goods:h.value.goods}}t("log","at components/relation-picker/relation-picker.vue:490","确认数据:",n),i("confirm",n),E()}catch(o){uni.showToast({title:o.message,icon:"none"})}},z=()=>{i("cancel"),E()};return(t,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),N),i=a(e.resolveDynamicComponent("common-name-picker"),le),d=a(e.resolveDynamicComponent("common-search"),B),h=a(e.resolveDynamicComponent("custom-picker"),ie),w=a(e.resolveDynamicComponent("goods-search"),k),E=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createBlock(E,{visible:p.value,"onUpdate:visible":V,top:"3%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"relation-picker-container"},[e.createElementVNode("view",{class:"picker-header"},[e.createElementVNode("view",{class:"mode-switch"},[g.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"switch-btn precision-mode",onClick:n[0]||(n[0]=e=>f(!1))},[e.createVNode(l,{type:"search",size:"18",color:"#fff"}),e.createElementVNode("text",null,"切换到精确关联")])):e.createCommentVNode("",!0),g.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"switch-btn fuzzy-mode",onClick:n[1]||(n[1]=e=>f(!0))},[e.createVNode(l,{type:"list",size:"18",color:"#fff"}),e.createElementVNode("text",null,"切换到模糊关联")]))])]),e.createElementVNode("view",{class:"picker-body"},[g.value?(e.openBlock(),e.createBlock(w,{key:1,ref_key:"fuzzySearch",ref:m,mode:"fill",onSelect:_,modelValue:v.value,"onUpdate:modelValue":n[5]||(n[5]=e=>v.value=e),onToggle:n[6]||(n[6]=e=>y("fuzzy")),class:"fuzzy-search"},null,8,["modelValue"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(i,{ref_key:"typePicker",ref:c,dataList:o.typeList,onSelect:b,onToggle:n[2]||(n[2]=e=>y("type")),class:"type-picker"},null,8,["dataList"]),e.createVNode(d,{ref_key:"brandSearch",ref:r,mode:"fill",onSelect:S,onToggle:n[3]||(n[3]=e=>y("brand")),class:"brand-search"},null,512),e.createVNode(h,{ref_key:"goodsPicker",ref:u,dataList:s.value,onSelect:C,onToggle:n[4]||(n[4]=e=>y("goods")),class:"goods-picker"},null,8,["dataList"])],64))]),e.createElementVNode("view",{class:"picker-footer"},[e.createElementVNode("button",{class:"cancel-btn",onClick:z},"取消"),e.createElementVNode("button",{class:"confirm-btn",onClick:D},"确认")])])])),_:1},8,["visible"])}}},[["__scopeId","data-v-af93ed54"]]),ce="/static/add2.png",re={__name:"showcase_form",props:["showcase_id"],setup(o){const n=o,l=e.ref([]),i=e.ref([]),s=e.ref([]),c=e.ref(!1);e.ref(""),e.ref(0),e.ref(""),e.ref(0),e.ref("");const m=e=>{try{const t={goods_id:e.goods.id||0,goods_name:e.goods.name,goods_image:e.goods.image||"",brand_id:e.brand.id||0,brand_name:e.brand.name||(e.isFuzzy?"":"未知品牌"),type:e.type||(e.isFuzzy?"未知类型":"")};k.value.some((e=>0!==e.goods_id&&e.goods_id===t.goods_id||e.goods_name===t.goods_name))?uni.showToast({title:"已存在相同关联项",icon:"none"}):k.value.push(t)}catch(a){t("error","at pages/stock/showcase_form/showcase_form.vue:148","保存关联数据失败:",a),uni.showToast({title:"保存关联信息失败",icon:"none"})}},p=()=>{t("log","at pages/stock/showcase_form/showcase_form.vue:157","用户取消选择")},g=()=>{c.value=!0},h=e.computed((()=>[-1,1,3].includes(w.value))),v=e.computed((()=>n.showcase_id>0)),f=e.ref(""),y=e.ref(""),w=e.ref(-1),k=e.ref([]);function _(e){uni.previewImage({current:l.value[e],urls:l.value})}async function E(){uni.showModal({title:"确认删除",content:"确定要删除这个展示吗？",success:async e=>{if(e.confirm)try{"success"===(await uni.request({url:`${d}/with-state/delete-showcase?id=`+n.showcase_id,method:"POST",header:{Authorization:uni.getStorageSync("token")}})).data.status&&(uni.showToast({title:"删除成功"}),setTimeout((()=>uni.navigateBack()),1e3))}catch(t){uni.showToast({title:"删除失败",icon:"none"})}}})}async function N(){if(!uni.getStorageSync("token"))return void uni.showToast({title:"请先登录",icon:"none"});if(!f.value.trim()||!y.value.trim())return void uni.showToast({title:"标题和正文不能为空",icon:"none"});if(0===l.value.length)return void uni.showToast({title:"请至少上传一张图片",icon:"none"});let e={name:f.value,description:y.value,image_urls:l.value.join(","),display:w.value,origin:1,relations:k.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:2})))};try{let t=`${d}/with-state/add-showcase`;n.showcase_id&&(t=`${d}/with-state/update-showcase`,e={...e,id:parseInt(n.showcase_id,10)});if("failed"===(await uni.request({url:t,method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:uni.getStorageSync("token")}})).data.code)return void uni.showToast({title:"提交失败",icon:"none"});uni.showToast({title:"提交成功"}),setTimeout((()=>uni.navigateBack()),1500)}catch(a){t("log","at pages/stock/showcase_form/showcase_form.vue:392",a),uni.showToast({title:"提交失败",icon:"none"})}}return uni.setNavigationBarTitle({title:"展示柜"}),e.onMounted((()=>{uni.request({url:d+"/goods-types",method:"GET",timeout:5e3,success:e=>{t("log","at pages/stock/showcase_form/showcase_form.vue:412",e.data.data),s.value=e.data.data},fail:e=>{t("log","at pages/stock/showcase_form/showcase_form.vue:416",e),uni.showToast({title:"网络请求失败",icon:"none"})}}),async function(){var e;if(n.showcase_id)try{const a=(await uni.request({url:`${d}/with-state/showcase-detail?id=${n.showcase_id}`,method:"GET",header:{Authorization:uni.getStorageSync("token")}})).data.data;f.value=a.name,y.value=a.description,w.value=a.display,l.value=(null==(e=a.image_urls)?void 0:e.split(","))||[],t("log","at pages/stock/showcase_form/showcase_form.vue:230",a),a.relations&&(k.value=a.relations.map((e=>({goods_id:e.relation_goods_id,goods_name:e.relation_goods_name,brand_id:e.relation_brand_id,brand_name:e.relation_brand_name,type:e.type,goods_image:e.relation_goods_image}))))}catch(a){uni.showToast({title:"加载失败",icon:"none"})}}()})),(o,n)=>{const d=a(e.resolveDynamicComponent("relation-picker"),se);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),h.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"edit-tip"},[e.createElementVNode("text",null,"当前状态不可编辑")])),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload_item",key:a},[e.createElementVNode("image",{src:t,class:"uploaded_image",onClick:_,mode:"aspectFill"},null,8,["src"]),h.value?(e.openBlock(),e.createElementBlock("image",{key:0,src:r,class:"close_icon",onClick:e=>function(e){l.value.splice(e,1)}(a)},null,8,["onClick"])):e.createCommentVNode("",!0)])))),128)),h.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},[e.createElementVNode("image",{src:ce,class:"upload_img",onClick:n[0]||(n[0]=e=>async function(){try{const e=await te(9);for(const t of e){const e=await ae();await oe(t,e.token,e.path),l.value.push(u+e.path)}uni.showToast({title:`成功上传${e.length}张图片`,icon:"success"})}catch(e){t("error","at pages/stock/showcase_form/showcase_form.vue:277","上传出错:",e),uni.showToast({title:"部分图片上传失败",icon:"none"})}}(o.index)),style:{width:"50px",height:"50px",margin:"25px"}})])):e.createCommentVNode("",!0)]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>f.value=e),type:"text",disabled:!h.value,placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["disabled"]),[[e.vModelText,f.value]]),e.createElementVNode("view",{class:"oneLine"}),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>y.value=e),disabled:!h.value,placeholder:"请输入描述",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["disabled"]),[[e.vModelText,y.value]]),e.createElementVNode("view",{class:"oneLine"}),e.createElementVNode("view",{class:""},[h.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"relation-trigger",onClick:g},[e.createElementVNode("text",{class:"placeholder"},"点击关联娃物"),e.createElementVNode("image",{src:q,class:"arrow-icon"})])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"saveCollocationDataList"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[e.createElementVNode("view",{class:"saveCollocationDataItem"},[t.goods_image?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-image"},"?")),e.createElementVNode("text",{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},e.toDisplayString(t.type)+" "+e.toDisplayString(t.brand_name)+" - "+e.toDisplayString(t.goods_name),1),h.value?(e.openBlock(),e.createElementBlock("image",{key:2,src:r,class:"close_icon",onClick:e=>function(e){k.value.splice(e,1)}(a)},null,8,["onClick"])):e.createCommentVNode("",!0)])])))),128))]),e.createVNode(d,{visible:c.value,"onUpdate:visible":n[3]||(n[3]=e=>c.value=e),typeList:s.value,goodsList:i.value,onConfirm:m,onCancel:p},null,8,["visible","typeList","goodsList"]),e.createElementVNode("view",{class:"footer"},[v.value?(e.openBlock(),e.createElementBlock("button",{key:0,onClick:E,class:"delete-btn"},"删除")):e.createCommentVNode("",!0),e.createElementVNode("button",{onClick:N},"发表")])])}}},de=w({__name:"bill_form",props:["bill_id"],setup(a){const o=a,n=!!o.bill_id,l=e.ref(""),i=e.ref(""),s=e.ref(""),c=e.ref(0),r=["未补款","已补款"];const u=e.ref("");function m(e){const t=e.detail.value;s.value=t,u.value=g(t)}function p(){uni.showModal({title:"提示",content:"确定删除该账单吗？",success:e=>{e.confirm&&uni.request({url:d+"/with-state/delete-tail-bill?id="+parseInt(o.bill_id,10),method:"POST",header:{Authorization:uni.getStorageSync("token")},success:e=>{"success"==e.data.status?(uni.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}})}function g(e){let t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}function h(e){c.value=e.detail.value}function v(){n?function(){let e={id:parseInt(o.bill_id,10),name:l.value,price:parseFloat(i.value),ymd:s.value,status:c.value};uni.request({url:d+"/with-state/update-tail-bill",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}():function(){let e={name:l.value,price:parseFloat(i.value),ymd:s.value,status:c.value};uni.request({url:d+"/with-state/add-tail-bill",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}()}return e.onMounted((()=>{n?(!function(e){let a=uni.getStorageSync("token");uni.request({url:d+"/with-state/tail-bill-detail",method:"GET",header:{Authorization:a},data:{id:e},success:e=>{l.value=e.data.data.name,i.value=e.data.data.price,s.value=e.data.data.ymd,c.value=e.data.data.status,u.value=g(e.data.data.ymd)},fail:e=>{t("log","at pages/stock/bill_form/bill_form.vue:113",e)}})}(o.bill_id),uni.setNavigationBarTitle({title:"编辑账单"})):uni.setNavigationBarTitle({title:"新增账单"})})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单名称"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"text",placeholder:"请输入名称","placeholder-class":"placeholder-style","onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e)},null,512),[[e.vModelText,l.value]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单金额"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit",placeholder:"请输入金额","placeholder-class":"placeholder-style","onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e)},null,512),[[e.vModelText,i.value]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单日期"),e.createElementVNode("picker",{mode:"date",class:"form-input",value:u.value,onChange:m},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(u.value||"请选择日期"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单状态"),e.createElementVNode("picker",{mode:"selector",class:"form-input",value:c.value,range:r,onChange:h},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(r[c.value]||"请选择状态"),1)],40,["value"])]),e.createElementVNode("view",{style:{overflow:"hidden"}},[e.createElementVNode("image",{src:K,mode:"aspectFill",style:{width:"28rpx",height:"28rpx","margin-right":"10rpx",position:"relative",top:"3rpx"}}),e.createElementVNode("text",{style:{color:"#888"}},"仅用于您的记账，其他人不会看到")])]),e.createElementVNode("view",{class:"button-group"},[e.createElementVNode("button",{class:"submit-button",onClick:v}," 记录"+e.toDisplayString(e.unref(n)?"修改":"新增"),1),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"delete-button",onClick:p}," 删除账单 ")):e.createCommentVNode("",!0)])]))}},[["__scopeId","data-v-d60a41d5"]]),ue={__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(o){const n=o,l=e.ref([]),i=e.ref([]),s=e.ref([]),c=e.ref(!1);e.ref(""),e.ref(0),e.ref(""),e.ref(0),e.ref("");const m=e=>{try{const t={goods_id:e.goods.id||0,goods_name:e.goods.name,goods_image:e.goods.image||"",brand_id:e.brand.id||0,brand_name:e.brand.name||(e.isFuzzy?"":"未知品牌"),type:e.type||(e.isFuzzy?"未知类型":"")};h.value.some((e=>0!==e.goods_id&&e.goods_id===t.goods_id||e.goods_name===t.goods_name))?uni.showToast({title:"已存在相同关联项",icon:"none"}):h.value.push(t)}catch(a){t("error","at pages/collocation/collocation.vue:121","保存关联数据失败:",a),uni.showToast({title:"保存关联信息失败",icon:"none"})}},p=()=>{t("log","at pages/collocation/collocation.vue:130","用户取消选择")},g=()=>{c.value=!0};const h=e.ref([]);var v;n.goods_id&&n.goods_name&&n.brand_id&&n.brand_name&&n.type&&(v=n.goods_id,new Promise(((e,a)=>{uni.request({url:d+"/goods?id="+v,method:"GET",timeout:5e3,success:a=>{t("log","at pages/collocation/collocation.vue:145",a.data.data),e(a.data)},fail:e=>{t("log","at pages/collocation/collocation.vue:149",e),uni.showToast({title:"网络请求失败",icon:"none"}),a(e)},complete:()=>{uni.hideLoading()}})}))).then((e=>{let a={brand_id:parseInt(n.brand_id,10),goods_id:parseInt(n.goods_id,10),brand_name:n.brand_name,goods_name:n.goods_name,goods_image:e.data.goods_images[0],type:n.type};t("log","at pages/collocation/collocation.vue:176",a),h.value.push(a)}));const f=e.ref(""),y=e.ref("");function w(e){uni.previewImage({current:l.value[e],urls:l.value})}function k(){const e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});if(!f.value.trim())return void uni.showToast({title:"标题不能为空",icon:"none"});if(0===l.value.length)return void uni.showToast({title:"请至少上传一张图片",icon:"none"});const a={title:f.value,content:y.value,image_url_list:l.value,scene:1,relations:h.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:1})))};t("log","at pages/collocation/collocation.vue:266",a),uni.request({url:d+"/with-state/add-collocation",method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:e},timeout:5e3,success:e=>{"success"===e.data.status?(uni.showToast({title:"提交成功"}),f.value="",y.value="",l.value=[],h.value=[],uni.navigateBack()):uni.showToast({title:e.data.msg||"提交失败",icon:"none"})},fail:e=>{t("log","at pages/collocation/collocation.vue:297",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}return uni.request({url:d+"/goods-types",method:"GET",timeout:5e3,success:e=>{t("log","at pages/collocation/collocation.vue:343",e.data.data),s.value=e.data.data},fail:e=>{t("log","at pages/collocation/collocation.vue:347",e),uni.showToast({title:"网络请求失败",icon:"none"})}}),(o,n)=>{const d=a(e.resolveDynamicComponent("relation-picker"),se),v=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createBlock(v,null,{default:e.withCtx((()=>[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload_item",key:a},[e.createElementVNode("image",{src:t,class:"uploaded_image",onClick:w,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("image",{src:r,class:"close_icon",onClick:e=>function(e){l.value.splice(e,1)}(a)},null,8,["onClick"])])))),128)),e.createElementVNode("view",{class:"uploadImageBox",style:{background:"#f8f8f8"}},[e.createElementVNode("image",{src:ce,class:"upload_img",onClick:n[0]||(n[0]=e=>async function(){try{const e=await te(9);for(const t of e){const e=await ae();await oe(t,e.token,e.path),l.value.push(u+e.path)}uni.showToast({title:`成功上传${e.length}张图片`,icon:"success"})}catch(e){t("error","at pages/collocation/collocation.vue:214","上传出错:",e),uni.showToast({title:"部分图片上传失败",icon:"none"})}}(o.index)),style:{width:"50px",height:"50px",margin:"25px"}})])]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>f.value=e),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,512),[[e.vModelText,f.value]]),e.createElementVNode("view",{class:"oneLine"}),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>y.value=e),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,512),[[e.vModelText,y.value]]),e.createElementVNode("view",{class:"oneLine"}),e.createElementVNode("view",{class:""},[e.createElementVNode("view",{class:"relation-trigger",onClick:g},[e.createElementVNode("text",{class:"placeholder"},"点击关联娃物"),e.createElementVNode("image",{src:q,class:"arrow-icon"})])]),e.createElementVNode("view",{class:"saveCollocationDataList"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[e.createElementVNode("view",{class:"saveCollocationDataItem"},[t.goods_image?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-image"},"?")),e.createElementVNode("text",{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},e.toDisplayString(t.type)+" "+e.toDisplayString(t.brand_name)+" - "+e.toDisplayString(t.goods_name),1),e.createElementVNode("image",{src:r,class:"close_icon",onClick:e=>function(e){h.value.splice(e,1)}(a)},null,8,["onClick"])])])))),128))]),e.createVNode(d,{visible:c.value,"onUpdate:visible":n[3]||(n[3]=e=>c.value=e),typeList:s.value,goodsList:i.value,onConfirm:m,onCancel:p},null,8,["visible","typeList","goodsList"]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("button",{onClick:k},"提交")])])),_:1})}}},me=w({__name:"collocation_share",props:{collocation_id:{type:String,default:0},origin:{type:String,default:0}},setup(o){const i=e.ref({title:"",content:"",image_url_list:[],collocation_relation_list:[]}),s=e.ref({userName:"",avatar:""});uni.getSystemInfoSync();const c=e.ref(!0),r=e.ref(!1),u=e.ref(""),p=o,g=e.ref(0),v=e.ref(0);let f=e.ref(!1);const y=e.ref(null),w=e.ref(null);e.ref(1);let k=e.ref({});uni.setNavigationBarTitle({title:"搭配详情"});const _=async(e,a)=>{var o;try{const n=await uni.request({url:`http://localhost:8080/view-collocation?collocation_id=${e}&origin=${a}`});if("success"!==n.data.status)return void V(n.data.msg||"数据加载失败");const l={...n.data.data,image_url_list:Array.isArray(n.data.data.image_url_list)?n.data.data.image_url_list:[n.data.data.image_urls],collocation_relation_list:await Promise.all(n.data.data.collocation_relation_list.map((async e=>{try{const a=e.relation_goods_id>0?await(e=>new Promise(((a,o)=>{e&&0!==e?uni.request({url:`${d}/goods?id=${e}`,method:"GET",timeout:5e3,success:e=>{"success"===e.data.status?a(e.data.data):o(e.data.msg||"获取商品信息失败")},fail:e=>{t("error","at pages/collocation_share/collocation_share.vue:206",e),uni.showToast({title:"网络请求失败",icon:"none"}),o(e)}}):o("无效的商品ID")})))(e.relation_goods_id):null;return{...e,goodsInfo:a,imageLoaded:!!a,imageError:!a}}catch(a){return t("error","at pages/collocation_share/collocation_share.vue:258","商品信息获取失败:",a),{...e,goodsInfo:null,imageLoaded:!1,imageError:!0}}})))};i.value=l,(null==(o=n.data.data)?void 0:o.uid)&&await E(n.data.data.uid)}catch(n){V("数据加载失败")}finally{c.value=!1}},E=async e=>{try{const a=await uni.request({url:`${d}/user-info?uid=${e}`,method:"GET"});"success"===a.data.status?s.value=a.data.data:t("error","at pages/collocation_share/collocation_share.vue:309","获取用户信息失败:",a.data.msg)}catch(a){t("error","at pages/collocation_share/collocation_share.vue:312","用户信息请求失败:",a),uni.showToast({title:"作者信息加载失败",icon:"none"})}},V=e=>{r.value=!0,u.value=e,uni.showToast({title:e,icon:"none"})};function b(e){let a=uni.getStorageSync("token");if(""==a)return;let o=1==v.value?3:4;uni.request({url:d+"/with-state/hasLike?id="+e+"&type="+o,method:"POST",header:{Authorization:a},success:e=>{"success"==e.data.status?e.data.data.id>0?f.value=!0:f.value=!1:uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t("log","at pages/collocation_share/collocation_share.vue:426",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}function x(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}const B=({parent:e,target:a})=>{var o;t("log","at pages/collocation_share/collocation_share.vue:450","parent",e),t("log","at pages/collocation_share/collocation_share.vue:451","target",a);let n=e;null!=a&&(n=a),k.value.id!=n.id?(t("log","at pages/collocation_share/collocation_share.vue:462","item",n),k.value=n,null==(o=w.value)||o.focusInput()):k.value={}},S=({content:e,replyInfo:a,origin:o})=>{let n=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/collocation_share/collocation_share.vue:494","reply_info",a);const l={content:e,origin:o,target_id:parseInt(g.value),type:1==p.origin?3:6,...a.id&&{reply_id:a.id,reply_for:a.comment,reply_user_id:a.user_id,parent_id:a.parent_id>0?a.parent_id:a.id}};uni.request({url:d+"/with-state/add-comment",method:"POST",header:{Authorization:n},data:l,success:e=>{var t,a;if("success"==e.data.status){const o=e.data.data;0===o.parent_id?null==(t=y.value)||t.addNewComment(o):null==(a=y.value)||a.addReplyComment(o),uni.showToast({title:"评论成功",icon:"success"})}else uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})}})};function C(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${i}`}return n((()=>{t("log","at pages/collocation_share/collocation_share.vue:568","注册键盘弹出事件"),uni.onKeyboardHeightChange(keyboardHeightChangeHandler)})),l((e=>{try{if(!e.collocation_id)return r.value=!0,void(u.value="缺少必要参数Id");if(!e.origin)return r.value=!0,void(u.value="缺少必要参数Origin");g.value=e.collocation_id,v.value=e.origin,_(e.collocation_id,e.origin),h().then((a=>{t("log","at pages/collocation_share/collocation_share.vue:591",a),b(e.collocation_id)}))}catch(a){t("error","at pages/collocation_share/collocation_share.vue:597","onLoad Error:",a),uni.showToast({title:"加载失败",icon:"none"})}})),(o,n)=>{var l;const p=a(e.resolveDynamicComponent("uni-icons"),N),h=a(e.resolveDynamicComponent("comment-list"),P),E=a(e.resolveDynamicComponent("comment-input"),R);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("view",{class:"heart",onClick:n[0]||(n[0]=e=>function(){let e=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});let a=1==v.value?3:4,o={id:parseInt(i.value.id),type:a},n=f.value?"/with-state/unlike":"/with-state/add-like";uni.request({url:d+n,method:"POST",header:{Authorization:e},data:o,success:e=>(t("log","at pages/collocation_share/collocation_share.vue:367",e.data),"success"==e.data.status?(uni.showToast({title:"操作成功",icon:"success"}),f.value=!f.value,b(i.value.id),void _(i.value.id,v.value)):void uni.showToast({title:e.data.msg,icon:"none"})),fail:e=>{t("log","at pages/collocation_share/collocation_share.vue:386",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}())},[e.unref(f)?(e.openBlock(),e.createBlock(p,{key:1,type:"heart-filled",size:"28",color:"#ff4d4f"})):(e.openBlock(),e.createBlock(p,{key:0,type:"heart",size:"28",color:"#ff4d4f"})),e.createElementVNode("text",{class:"num"},e.toDisplayString((null==(l=i.value)?void 0:l.like_count)?x(i.value.like_count):0),1)]),e.createElementVNode("swiper",{class:"swiper-box","indicator-dots":!0,autoplay:!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value.image_url_list,((a,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o},[e.createElementVNode("image",{src:a,mode:"aspectFill",class:"swiper-image",onClick:e=>function(e){t("log","at pages/collocation_share/collocation_share.vue:219",i),uni.previewImage({current:i.value.image_url_list[e],urls:i.value.image_url_list})}(o)},null,8,["src","onClick"])])))),128))])]),e.createElementVNode("view",{class:"author-info",onClick:n[1]||(n[1]=e=>{return t=i.value.uid,void uni.navigateTo({url:"/pages/user_page/user_page?uid="+t});var t})},[e.createElementVNode("image",{class:"avatar",src:s.value.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-meta"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(s.value.user_name||"未知用户"),1),e.createElementVNode("text",{class:"publish-time"},"发布于 "+e.toDisplayString(C(i.value.created_at)),1)])]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(i.value.title),1),e.createElementVNode("text",{class:"content"},e.toDisplayString(i.value.content),1)]),e.createElementVNode("view",{class:"goods-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value.collocation_relation_list,(t=>{var a,o;return e.openBlock(),e.createElementBlock("view",{key:t.id,class:"goods-item",onClick:e=>{return t.relation_goods_id>0?void(0!=(a=t.relation_goods_id)?uni.navigateTo({url:`/pages/goods/goods?goods_id=${a}`}):uni.showToast({title:"商品暂时没有录入",icon:"none"})):null;var a}},[e.createElementVNode("view",{class:"image-container"},[0===t.relation_goods_id?(e.openBlock(),e.createElementBlock("view",{key:0,class:"placeholder-box"},[e.createElementVNode("text",{style:{color:"#fff","font-size":"45px"}},"?")])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[t.imageLoaded?(e.openBlock(),e.createElementBlock("image",{key:0,src:(null==(o=null==(a=t.goodsInfo)?void 0:a.goods_images)?void 0:o[0])||"/static/goods-default.png",mode:"aspectFill",class:"goods-image"},null,8,["src"])):t.imageError?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-box"},[e.createElementVNode("text",null,"图片加载失败")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"loading-box"},[e.createElementVNode("text",null,"加载中...")]))],64))]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("text",{class:"brand"},e.toDisplayString(t.relation_brand_name)+" - "+e.toDisplayString(t.relation_goods_name),1),e.createElementVNode("view",null,[e.createElementVNode("text",{class:"category"},e.toDisplayString(t.type),1),e.createElementVNode("text",{class:"price"}," （"+e.toDisplayString(t.goodsInfo&&t.goodsInfo.total_amount?t.goodsInfo.total_amount+t.goodsInfo.currency:"贩售价格未收录")+"）",1)]),e.createElementVNode("view",{class:"see font-alimamashuhei"}," 去看看 → ")])],8,["onClick"])})),128))]),v.value>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{padding:"10px"}},[e.createVNode(h,{ref_key:"commentListRef",ref:y,type:1==v.value?3:6,"relation-id":parseInt(g.value),onReply:B},null,8,["type","relation-id"])])):e.createCommentVNode("",!0),e.createVNode(E,{ref_key:"commentInputRef",ref:w,"reply-info":e.unref(k),"target-id":g.value,onSubmit:S,"onUpdate:replyInfo":n[2]||(n[2]=t=>e.isRef(k)?k.value=t:k=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}}),c.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading"},"加载中...")):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"error"},e.toDisplayString(u.value),1)):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-bcf57b45"]]),pe=w({__name:"user_page",props:["uid"],setup(a){const o=e.ref(0),l=e.ref(["搭配","娃柜","点评"]),s=a,c=e.ref({avatar:"",user_name:"加载中..."}),r=e.ref([]),u=e.ref([]),m=e.ref([]),p=e.ref([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e.watch(o,(e=>{p.value[e];0===[r,u,m][e].value.length&&g()}));const g=async()=>{const e=p.value[o.value];if(!e.loading&&!e.finished){e.loading=!0;try{let a,n;switch(o.value){case 0:a=`/user-info/collection?user_id=${s.uid}&page=${e.page}`,n="List";break;case 1:a=`/user-info/show-case?user_id=${s.uid}&page=${e.page}`,n="List";break;case 2:a=`/user-info/posts?user_id=${s.uid}&page=${e.page}`,n="comment_list"}t("log","at pages/user_page/user_page.vue:151",`${d}${a}`);const l=await uni.request({url:`${d}${a}`});if("success"===l.data.status){const t=l.data.data,a=t[n].map((e=>{var t,a,n;switch(o.value){case 0:return{id:e.id,cover:(null==(t=e.image_urls)?void 0:t.split(",")[0])||"",images:(null==(a=e.image_urls)?void 0:a.split(","))||[],title:e.title,time:e.created_at};case 1:return{id:e.id,cover:(null==(n=e.image_urls)?void 0:n.split(",")[0])||"",title:e.name,desc:e.description,time:e.created_at};case 2:return{id:e.id,product_thumb:e.target_image,product_name:e.target_name,content:e.comment,create_time:h(e.created_at)}}})),i=[r,u,m][o.value];i.value=[...i.value,...a],e.total=t.total,e.finished=i.value.length>=t.total,e.page++}}catch(a){t("log","at pages/user_page/user_page.vue:200",a),uni.showToast({title:"数据加载失败",icon:"none"})}finally{e.loading=!1}}},h=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`};return uni.setNavigationBarTitle({title:"用户主页"}),n((()=>{(async()=>{try{const e=await uni.request({url:`${d}/user-info?uid=${s.uid}`});"success"===e.data.status&&(c.value=e.data.data)}catch(e){uni.showToast({title:"用户信息加载失败",icon:"none"})}})(),g()})),i((()=>{g()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{class:"header_container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("image",{class:"avatar",src:c.value.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"username"},e.toDisplayString(c.value.user_name),1)]),e.createElementVNode("view",{class:"tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item font-alimamashuhei",{active:o.value===a}]),onClick:e=>o.value=a},e.toDisplayString(t),11,["onClick"])))),128))])]),e.createElementVNode("view",{class:"content"},[0===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"collocation-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"collocation-item item-image-container",onClick:e=>t.navigateTo(`/pages/collocation_share/collocation_share?collocation_id=${a.id}`)},[e.createElementVNode("image",{class:"item-image",src:a.cover,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(a.title),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),1===o.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"doll-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"doll-item item-image-container",onClick:e=>t.navigateTo(`/pages/user_doll/user_doll?id=${a.id}`)},[e.createElementVNode("image",{class:"item-image",src:a.cover,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(a.title),1),e.createElementVNode("text",{class:"item-price"},"¥"+e.toDisplayString(a.price),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),2===o.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"review-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"review-item"},[e.createElementVNode("image",{class:"product-thumb",src:t.product_thumb,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"review-content"},[e.createElementVNode("text",{class:"product-name"},e.toDisplayString(t.product_name),1),e.createElementVNode("text",{class:"review-text"},e.toDisplayString(t.content),1),e.createElementVNode("text",{class:"review-time"},e.toDisplayString(t.create_time),1)])])))),128))])):e.createCommentVNode("",!0)])]))}},[["__scopeId","data-v-40f3422e"]]);let ge={};ge={data:()=>({is_show:"none"}),watch:{show(e){this.is_show=this.show}},created(){this.swipeaction=this.getSwipeAction(),this.swipeaction&&Array.isArray(this.swipeaction.children)&&this.swipeaction.children.push(this)},mounted(){this.is_show=this.show},methods:{closeSwipe(e){this.autoClose&&this.swipeaction&&this.swipeaction.closeOther(this)},change(e){this.$emit("change",e.open),this.is_show!==e.open&&(this.is_show=e.open)},appTouchStart(e){const{clientX:t}=e.changedTouches[0];this.clientX=t,this.timestamp=(new Date).getTime()},appTouchEnd(e,t,a,o){const{clientX:n}=e.changedTouches[0];let l=Math.abs(this.clientX-n),i=(new Date).getTime()-this.timestamp;l<40&&i<300&&this.$emit("click",{content:a,index:t,position:o})},onClickForPC(e,t,a){}}};const he=e=>{(e.$wxs||(e.$wxs=[])).push("wxsswipe"),(e.$wxsModules||(e.$wxsModules={})).wxsswipe="afd46426"},ve=e=>{(e.$renderjs||(e.$renderjs=[])).push("renderswipe"),(e.$renderjsModules||(e.$renderjsModules={})).renderswipe="5a1e922e"},fe={mixins:[ge,{},{}],emits:["click","change"],props:{show:{type:String,default:"none"},disabled:{type:Boolean,default:!1},autoClose:{type:Boolean,default:!0},threshold:{type:Number,default:20},leftOptions:{type:Array,default:()=>[]},rightOptions:{type:Array,default:()=>[]}},unmounted(){this.__isUnmounted=!0,this.uninstall()},methods:{uninstall(){this.swipeaction&&this.swipeaction.children.forEach(((e,t)=>{e===this&&this.swipeaction.children.splice(t,1)}))},getSwipeAction(e="uniSwipeAction"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t}}};he(fe),ve(fe);const ye=w(fe,[["render",function(t,a,o,n,l,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-swipe"},[e.createElementVNode("view",{class:"uni-swipe_box","change:prop":t.wxsswipe.showWatch,prop:e.wp(t.is_show),"data-threshold":o.threshold,"data-disabled":o.disabled,onTouchstart:a[2]||(a[2]=(...e)=>t.wxsswipe.touchstart&&t.wxsswipe.touchstart(...e)),onTouchmove:a[3]||(a[3]=(...e)=>t.wxsswipe.touchmove&&t.wxsswipe.touchmove(...e)),onTouchend:a[4]||(a[4]=(...e)=>t.wxsswipe.touchend&&t.wxsswipe.touchend(...e))},[e.createElementVNode("view",{class:"uni-swipe_button-group button-group--left"},[e.renderSlot(t.$slots,"left",{},(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.leftOptions,((o,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,style:e.normalizeStyle({backgroundColor:o.style&&o.style.backgroundColor?o.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:a[0]||(a[0]=e.withModifiers(((...e)=>t.appTouchStart&&t.appTouchStart(...e)),["stop"])),onTouchend:e.withModifiers((e=>t.appTouchEnd(e,n,o,"left")),["stop"]),onClick:e.withModifiers((e=>t.onClickForPC(n,o,"left")),["stop"])},[e.createElementVNode("text",{class:"uni-swipe_button-text",style:e.normalizeStyle({color:o.style&&o.style.color?o.style.color:"#FFFFFF",fontSize:o.style&&o.style.fontSize?o.style.fontSize:"16px"})},e.toDisplayString(o.text),5)],44,["onTouchend","onClick"])))),128))]),!0)]),e.createElementVNode("view",{class:"uni-swipe_text--center"},[e.renderSlot(t.$slots,"default",{},void 0,!0)]),e.createElementVNode("view",{class:"uni-swipe_button-group button-group--right"},[e.renderSlot(t.$slots,"right",{},(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.rightOptions,((o,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,style:e.normalizeStyle({backgroundColor:o.style&&o.style.backgroundColor?o.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:a[1]||(a[1]=e.withModifiers(((...e)=>t.appTouchStart&&t.appTouchStart(...e)),["stop"])),onTouchend:e.withModifiers((e=>t.appTouchEnd(e,n,o,"right")),["stop"]),onClick:e.withModifiers((e=>t.onClickForPC(n,o,"right")),["stop"])},[e.createElementVNode("text",{class:"uni-swipe_button-text",style:e.normalizeStyle({color:o.style&&o.style.color?o.style.color:"#FFFFFF",fontSize:o.style&&o.style.fontSize?o.style.fontSize:"16px"})},e.toDisplayString(o.text),5)],44,["onTouchend","onClick"])))),128))]),!0)])],40,["change:prop","prop","data-threshold","data-disabled"])])}],["__scopeId","data-v-20868213"]]);const we=w({name:"uniSwipeAction",data:()=>({}),created(){this.children=[]},methods:{resize(){},closeAll(){this.children.forEach((e=>{e.is_show="none"}))},closeOther(e){this.openItem&&this.openItem!==e&&(this.openItem.is_show="none"),this.openItem=e}}},[["render",function(t,a,o,n,l,i){return e.openBlock(),e.createElementBlock("view",null,[e.renderSlot(t.$slots,"default")])}]]),ke={__name:"message_list",setup(o){const n=e.ref([]),l=e.ref(0),i=e.ref(1),s=e.ref(!1),c=e.ref(!0),r=e.ref(!1),u=e=>[{text:"删除",style:{backgroundColor:"#dd524d"},data:{type:"delete",id:e.id}},{text:e.is_read?"已读":"标记已读",style:{backgroundColor:"#6fd0d4"},data:{type:"read",id:e.id}}];e.onMounted((async()=>{await h(),m(),g(),uni.setNavigationBarTitle({title:"消息"})}));const m=async(e=!1)=>{try{r.value=!0;const t=e?i.value:1,a=await uni.request({url:`${d}/with-state/user-messages?page=${t}`,header:{Authorization:uni.getStorageSync("token")}});if("success"===a.data.status){const o=a.data.data.message_list;n.value=e?[...n.value,...o]:o,c.value=o.length>=10,i.value=t+(c.value?1:0)}}catch(t){uni.showToast({title:"消息加载失败",icon:"none"})}finally{r.value=!1,s.value=!1}},p=()=>{t("log","at pages/message_list/message_list.vue:137","触发加载更多",r.value,c.value),!r.value&&c.value&&m(!0)},g=async()=>{try{const e=await uni.request({url:`${d}/with-state/unread-message-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(l.value=e.data.data.count)}catch(e){uni.showToast({title:"未读数获取失败",icon:"none"})}},v=e=>{const{type:t,id:a}=e.content.data;"delete"===t?f(a):"read"===t&&w(a)},f=e=>{uni.showModal({title:"删除确认",content:"确定要删除这条消息吗？",success:t=>{t.confirm&&y(e)}})},y=async e=>{try{await uni.request({url:`${d}/with-state/delete-message`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{message_id:e}}),n.value=n.value.filter((t=>t.id!==e)),g(),uni.showToast({title:"删除成功"})}catch(t){uni.showToast({title:"删除失败",icon:"none"})}},w=async e=>{try{await uni.request({url:`${d}/with-state/mark-message-read`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{message_id:e}});const t=n.value.find((t=>t.id===e));t&&!t.is_read&&(t.is_read=1,l.value--)}catch(t){uni.showToast({title:"标记失败",icon:"none"})}},k=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`};return(t,o)=>{const l=a(e.resolveDynamicComponent("uni-swipe-action-item"),ye),i=a(e.resolveDynamicComponent("uni-swipe-action"),we);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("scroll-view",{class:"message-list","scroll-y":"",onScrolltolower:p,"show-scrollbar":!1},[e.createVNode(i,null,{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t=>(e.openBlock(),e.createBlock(l,{key:t.id,"right-options":u(t),threshold:.4,onClick:v},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"message-item",onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/message_info/message_info?message_id=${a}`});var a}},[e.createElementVNode("image",{class:"cover-image",src:t.cover_image,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:e.normalizeClass(["msg",{unread:!t.is_read}])},e.toDisplayString(t.msg),3)]),e.createElementVNode("text",{class:"time"},e.toDisplayString(k(t.created_at)),1)],8,["onClick"])])),_:2},1032,["right-options"])))),128))])),_:1}),e.createElementVNode("view",{class:"loading-wrapper"},[r.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},"加载中...")):e.createCommentVNode("",!0),c.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1,class:"loading-text"},"没有更多数据了"))])],32)])}}},_e={__name:"message_info",props:["message_id"],setup(o){const n=o,l=e.ref(null),i=e.ref(!0),s=e.ref(""),c=e.ref(""),r=async()=>{try{if(i.value=!0,s.value="",!c.value)return void(s.value="无效的消息ID");if(!(await h()))return void(s.value="请先登录");const e=await uni.request({url:`${d}/with-state/message-detail`,method:"GET",data:{id:c.value},header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status?(l.value=e.data.data,uni.$emit("message-status-update",{id:c.value,is_read:1})):s.value=e.data.msg||"获取详情失败"}catch(e){s.value="请求失败，请检查网络",t("error","at pages/message_info/message_info.vue:96","详情请求失败:",e)}finally{i.value=!1}};return e.onMounted((()=>{uni.setNavigationBarTitle({title:"消息详情"}),c.value=n.message_id,r()})),(t,o)=>{const n=e.resolveComponent("uni-load-more"),c=a(e.resolveDynamicComponent("uni-icons"),N);return e.openBlock(),e.createElementBlock("view",{class:"container"},[i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-wrapper"},[e.createVNode(n,{status:"loading"})])):s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-wrapper"},[e.createVNode(c,{type:"info",size:"24",color:"#ff4d4f"}),e.createElementVNode("text",{class:"error-text"},e.toDisplayString(s.value),1),e.createElementVNode("button",{class:"retry-btn",onClick:r},"重试")])):(e.openBlock(),e.createElementBlock("scroll-view",{key:2,class:"content-wrapper","scroll-y":""},[e.createElementVNode("image",{class:"cover-image",src:l.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),e.createElementVNode("view",{class:"main-content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(l.value.title),1),e.createElementVNode("text",{class:"time"},e.toDisplayString((d=l.value.created_at,new Date(1e3*d).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("text",{class:"message-text"},e.toDisplayString(l.value.msg),1)])])]))]);var d}}},Ee=w({__name:"register",setup(t){const a=e.ref({telephone:"",code:"",password:"",rePassword:""}),o=e.ref({phone:"",code:"",password:"",rePassword:""}),n=e.ref(0),l=e.computed((()=>n.value>0)),i=e.computed((()=>n.value>0?`${n.value}秒后重发`:"获取验证码")),s=e.ref(!1),c=()=>a.value.telephone?/^1[3-9]\d{9}$/.test(a.value.telephone)?(o.value.phone="",!0):(o.value.phone="手机号格式不正确",!1):(o.value.phone="手机号不能为空",!1),r=async()=>{if(c())try{const e=await uni.request({url:`${d}/send-sms-code`,method:"POST",data:{tel_phone:a.value.telephone}});"success"===e.data.status?(u(),uni.showToast({title:"验证码已发送",icon:"none"})):uni.showToast({title:e.data.msg||"发送失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}},u=()=>{n.value=60;const e=setInterval((()=>{n.value<=0?clearInterval(e):n.value--}),1e3)},m=()=>a.value.password.length<6?(o.value.password="密码至少需要6位",!1):(o.value.password="",!0),p=()=>a.value.password!==a.value.rePassword?(o.value.rePassword="两次密码输入不一致",!1):(o.value.rePassword="",!0),g=()=>a.value.code?6!==a.value.code.length?(o.value.code="验证码格式不正确",!1):(o.value.code="",!0):(o.value.code="验证码不能为空",!1),h=async()=>{if([c(),g(),m(),p()].every((e=>e)))try{s.value=!0;const e=await uni.request({url:`${d}/register`,method:"POST",data:{telephone:a.value.telephone,code:a.value.code,password:a.value.password,re_password:a.value.rePassword}});"success"===e.data.status?(uni.setStorageSync("token",e.data.data.jwt_token),uni.showToast({title:"注册成功",icon:"success",complete:()=>{setTimeout((()=>{uni.switchTab({url:"/pages/mine/mine"})}),1500)}})):uni.showToast({title:e.data.msg||"注册失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}finally{s.value=!1}},v=()=>{uni.navigateTo({url:"/pages/login/login"})};return(t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"手机号注册")]),e.createElementVNode("view",{class:"form-box"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("text",{class:"prefix"},"+86"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>a.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:c},null,544),[[e.vModelText,a.value.telephone]])]),o.value.phone?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.phone),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"code-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>a.value.code=e),type:"number",autocomplete:"new-password",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:g},null,544),[[e.vModelText,a.value.code]]),e.createElementVNode("button",{class:e.normalizeClass(["code-btn",{disabled:l.value}]),disabled:l.value,onClick:r},e.toDisplayString(i.value),11,["disabled"])]),o.value.code?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.code),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>a.value.password=e),autocomplete:"new-password",type:"password",placeholder:"请输入密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:m},null,544),[[e.vModelText,a.value.password]])]),o.value.password?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.password),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>a.value.rePassword=e),type:"password",placeholder:"请再次输入密码",class:"input","placeholder-class":"placeholder",onBlur:p},null,544),[[e.vModelText,a.value.rePassword]])]),o.value.rePassword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.rePassword),1)):e.createCommentVNode("",!0)]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{loading:s.value}]),disabled:s.value,onClick:h},e.toDisplayString(s.value?"注册中...":"立即注册"),11,["disabled"]),e.createElementVNode("view",{class:"bottom-tips"},[e.createTextVNode(" 已有账号？ "),e.createElementVNode("text",{class:"link-text",onClick:v},"去登录")])])]))}},[["__scopeId","data-v-c20f9fc8"]]),Ne=w({__name:"user_like",setup(a){const o=e.ref([{type:1,name:"商品"},{type:2,name:"品牌"},{type:3,name:"搭配"},{type:4,name:"展示柜"}]),n=e.ref(1),l=e.ref([]),i=e.ref(!1),s=e.ref(!1),c=e.reactive({page:1,page_size:8,total:0});e.onMounted((async()=>{await r(),u()}));const r=async()=>{await h()||uni.navigateTo({url:"/pages/login/login"})},u=async()=>{if(!i.value&&!s.value){i.value=!0;try{const e=await uni.request({url:`${d}/with-state/user-likes`,method:"GET",data:{type:n.value,page:c.page,page_size:c.page_size},header:{Authorization:uni.getStorageSync("token")}});if("success"===e.data.status){const t=e.data.data.list;l.value=[...l.value,...t],c.total=e.data.data.total,e.data.data.list.length?s.value=!1:s.value=!0,c.page+=1}}catch(e){uni.showToast({title:"加载失败",icon:"none"})}finally{i.value=!1}}},m=()=>{s.value?t("log","at pages/user_like/user_like.vue:202","no more"):u()},p=()=>{c.page=1,l.value=[],s.value=!1},g=e=>(null==e?void 0:e.length)>0?e[0]:"",v=e=>{const t=(null==e?void 0:e.split(",")[0])||"";return t||""};return uni.setNavigationBarTitle({title:"我的关注"}),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{class:"nav-bar"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["nav-item",{active:n.value===t.type}]),onClick:e=>{return a=t.type,void(n.value!==a&&(n.value=a,p(),u()));var a}},e.toDisplayString(t.name),11,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"scroll-view","scroll-y":"",onScrolltolower:m,"show-scrollbar":!1},[e.createElementVNode("view",{class:"list-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((a,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:a.id},[1===n.value&&a.goods?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list-item goods-item",onClick:e=>{return t=a.goods.id,void uni.navigateTo({url:`/pages/goods/goods?goods_id=${t}`});var t}},[e.createElementVNode("view",{class:"goods-left"},[e.createElementVNode("image",{class:"goods-thumb",src:g(a.goods.goods_images),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"price-tag"},"¥"+e.toDisplayString(a.goods.total_amount),1)]),e.createElementVNode("view",{class:"goods-right"},[e.createElementVNode("view",{class:"goods-header"},[e.createElementVNode("text",{class:"goods-title line-clamp-2"},e.toDisplayString(a.goods.name),1),e.createElementVNode("button",{class:"unfollow-btn",onClick:e.withModifiers((e=>(async e=>{try{"success"===(await uni.request({url:`${d}/user/unfollow`,method:"POST",data:{id:e},header:{Authorization:uni.getStorageSync("token")}})).data.status&&(l.value=l.value.filter((t=>t.id!==e)),uni.showToast({title:"已取消关注",icon:"success"}))}catch(t){uni.showToast({title:"操作失败",icon:"none"})}})(a.id)),["stop"])},"取消关注",8,["onClick"])]),e.createElementVNode("view",{class:"goods-specs"},[e.createElementVNode("text",{class:"spec-item"},e.toDisplayString(a.goods.brand_name),1),e.createElementVNode("text",{class:"spec-item"},e.toDisplayString(a.goods.size),1),e.createElementVNode("text",{class:"spec-item"},e.toDisplayString(a.goods.skin.split(" ")[0]),1)]),e.createElementVNode("view",{class:"goods-footer"},[e.createElementVNode("text",{class:"goods-type"},e.toDisplayString(a.goods.type),1),e.createElementVNode("text",{class:"goods-material"},e.toDisplayString(a.goods.doll_material),1)])])],8,["onClick"])):e.createCommentVNode("",!0),2===n.value&&a.brand?(e.openBlock(),e.createElementBlock("view",{key:1,class:"list-item brand-item",onClick:e=>{return t=a.brand.id,void uni.navigateTo({url:`/pages/brand/brand?brand_id=${t}`});var t}},[e.createElementVNode("view",{class:"brand-content"},[e.createElementVNode("image",{class:"brand-logo",src:a.brand.logo_image,mode:"aspectFit"},null,8,["src"]),e.createElementVNode("view",{class:"brand-info"},[e.createElementVNode("view",{class:"brand-header"},[e.createElementVNode("text",{class:"brand-name"},e.toDisplayString(a.brand.brand_name),1),e.createElementVNode("text",{class:"brand-country"},e.toDisplayString(a.brand.country_name),1)]),e.createElementVNode("text",{class:"brand-description line-clamp-2"},e.toDisplayString(a.brand.description),1),e.createElementVNode("view",{class:"brand-actions"},[e.createElementVNode("button",{class:"action-btn",onClick:e.withModifiers((e=>t.unfollowBrand(a.id)),["stop"])},"取消关注",8,["onClick"])])])])],8,["onClick"])):e.createCommentVNode("",!0),3===n.value&&a.collocation?(e.openBlock(),e.createElementBlock("view",{key:2,class:"list-item",onClick:e=>{return t=a.collocation.id,void uni.navigateTo({url:`/pages/collocation/detail?id=${t}`});var t}},[e.createElementVNode("image",{class:"item-image",src:v(a.collocation.image_urls),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(a.collocation.title),1)],8,["onClick"])):e.createCommentVNode("",!0),4===n.value&&a.showcase?(e.openBlock(),e.createElementBlock("view",{key:3,class:"list-item",onClick:e=>{return t=a.showcase.id,void uni.navigateTo({url:`/pages/showcase/detail?id=${t}`});var t}},[e.createElementVNode("image",{class:"item-image",src:g(a.showcase.image_urls),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(a.showcase.name),1)],8,["onClick"])):e.createCommentVNode("",!0)],64)))),128)),e.createElementVNode("view",{class:"loading-status"},[i.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},"加载中...")):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more-text"},"没有更多了")):e.createCommentVNode("",!0)])])],32)]))}},[["__scopeId","data-v-57efdf20"]]),Ve=w({__name:"collocation_square",setup(o){const n=e.ref([]),l=e.ref(!1),i=e.ref(!1),s=e.ref(1),c=e.ref(0),r=e.ref(0),u=e.reactive([0,0]),m=e.ref(!1),p=e.ref(""),g=e.ref([]),h=e.getCurrentInstance(),v=e.ref(null),f=e.ref([]);e.ref(null);const y=e=>{const t=n.value[e];return t.position?{left:`${t.position.left}px`,top:`${t.position.top}px`,width:`${r.value}px`}:{}},w=e=>{if(t("log","at pages/collocation_square/collocation_square.vue:145","进入计算布局逻辑"),!e)return void t("log","at pages/collocation_square/collocation_square.vue:147","无法获取instance");if(t("log","at pages/collocation_square/collocation_square.vue:150","获取成功"),!n.value)return void t("log","at pages/collocation_square/collocation_square.vue:152","无列表数据，不需要计算布局");t("log","at pages/collocation_square/collocation_square.vue:155","获取成功，准备createSelectorQuery"),t("log","at pages/collocation_square/collocation_square.vue:156",e);const a=uni.createSelectorQuery().in(e.proxy);t("log","at pages/collocation_square/collocation_square.vue:158","获取到query");const o=n.value.map(((e,t)=>new Promise((e=>{a.select(`#card-${t}`).boundingClientRect((a=>{e({index:t,rect:a})}))}))));a.exec((async()=>{t("log","at pages/collocation_square/collocation_square.vue:173","进入Query"),u[0]=0,u[1]=0;const e=await Promise.all(o);e.length?(e.forEach((({index:e,rect:a})=>{if(!a)return void t("error","at pages/collocation_square/collocation_square.vue:189",`卡片${e}元素查询失败`);const o=n.value[e],l=u[0]<=u[1]?0:1,i=l*(r.value+10),s=u[l]+10;u[l]=s+a.height,o.position={left:i,top:s}})),c.value=Math.max(...u)+20):t("warn","at pages/collocation_square/collocation_square.vue:181","未查询到任何卡片元素")}))};e.onMounted((()=>{const e=uni.getSystemInfoSync();r.value=(e.windowWidth-30)/2}));const _=async(a=!1)=>{if(a&&(n.value=[],s.value=1,i.value=!1,l.value=!1),l.value||i.value)t("log","at pages/collocation_square/collocation_square.vue:227","正在加载或没有更多数据，停止请求");else try{l.value=!0;const o={page:s.value,page_size:10,filter_goods_id_list:f.value.map((e=>e.goods_id))};t("log","at pages/collocation_square/collocation_square.vue:241","请求参数:",JSON.stringify(o,null,2));const c=await uni.request({url:`${d}/collocation-list`,method:"POST",data:o,header:{"content-type":"application/json"}});if(t("log","at pages/collocation_square/collocation_square.vue:252","接口响应:",c),"success"===c.data.status){const o=c.data.data||{},l=Array.isArray(o.collocation_relation_list)?o.collocation_relation_list:[];n.value=a?l:[...n.value,...l],i.value=l.length<10,s.value++,a&&0===l.length&&uni.showToast({title:"暂无相关搭配",icon:"none"}),t("log","at pages/collocation_square/collocation_square.vue:277","等待next tick"),await e.nextTick(),t("log","at pages/collocation_square/collocation_square.vue:279","等待完成"),w(h),setTimeout((()=>{t("log","at pages/collocation_square/collocation_square.vue:283","二次计算布局"),w(h)}),500)}}catch(o){t("error","at pages/collocation_square/collocation_square.vue:288","请求失败:",o),uni.showToast({title:"加载失败",icon:"none"})}finally{l.value=!1}},E=()=>{m.value=!0},b=e=>{if(t("log","at pages/collocation_square/collocation_square.vue:333","选择商品:",e),!(null==e?void 0:e.id))return;const a={goods_id:e.id,goods_name:`${e.brand_name?e.brand_name+"·":""}${e.name}`};f.value.some((e=>e.goods_id===a.goods_id))||(f.value=[...f.value,a])},x=async()=>{m.value=!1,await _(!0)},B=()=>{m.value=!1},S=(e,t)=>{var a;null==(a=null==t?void 0:t.stopPropagation)||a.call(t),f.value=f.value.filter((t=>t.goods_id!==e)),i.value=!1,_(!0)},C=()=>{v.value=null,p.value="",f.value=[],g.value=[]};const D=()=>{i.value||_()};return e.onMounted(_),(t,o)=>{const s=a(e.resolveDynamicComponent("uni-icons"),N),r=a(e.resolveDynamicComponent("goods-search"),k),d=a(e.resolveDynamicComponent("common-modal"),T),u=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#f5f5f5"}),e.createVNode(u,{head_color:"#f5f5f5"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"filter-bar",style:e.normalizeStyle("")},[e.createElementVNode("view",{class:"filter-tags",onClick:E},[e.createElementVNode("view",{class:"selected-goods"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.goods_id,class:"tag",onClick:e.withModifiers((e=>S(t.goods_id,e)),["stop"])},[e.createTextVNode(e.toDisplayString(t.goods_name)+" ",1),e.createElementVNode("text",{class:"remove"},"×")],8,["onClick"])))),128))]),f.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:0,class:"tip"},"当前无筛选条件"))]),e.createElementVNode("button",{class:"submit-btn",onClick:o[0]||(o[0]=e=>_(!0))},"筛选")],4),e.createElementVNode("scroll-view",{class:"card-list","scroll-y":"",onScrolltolower:D,"show-scrollbar":!1},[e.createElementVNode("view",{class:"cards-container",style:e.normalizeStyle({height:c.value+"px"})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>{var o,n;return e.openBlock(),e.createElementBlock("view",{key:t.collocation_id,class:"card",id:"card-"+a,style:e.normalizeStyle(y(a)),onClick:e=>{return a=t.collocation_id,o=t.origin,void uni.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+a+"&origin="+o});var a,o}},[e.createElementVNode("view",{class:"user-info",onClick:e.withModifiers((e=>{return a=t.uid,void uni.navigateTo({url:`/pages/user_page/user_page?uid=${a}`});var a}),["stop"])},[e.createElementVNode("image",{src:t.avatar||"/default_avatar.jpg",class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-meta"},[e.createElementVNode("text",{class:"username"},e.toDisplayString((n=t.username,n.length>10?`${n.toString().slice(-8)}...`:n)),1),e.createElementVNode("view",{class:"like-count"},[e.createVNode(s,{type:"hand-up",size:"18",color:"#5f85a3"}),e.createElementVNode("text",{style:{margin:"0 5rpx",color:"#5f85a3"}},e.toDisplayString(t.like_count),1)])])],8,["onClick"]),(null==(o=t.image_urls)?void 0:o.length)>0?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.image_urls[0],mode:"aspectFill",class:"card-image","lazy-load":""},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"desc"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"goods-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.relation_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"tag-box",key:a},[e.createElementVNode("text",{class:"goods-tag"},e.toDisplayString(t.relation_goods_name||"未命名商品"),1)])))),128))])])],12,["id","onClick"])})),128))],4),e.createElementVNode("view",{class:"loading-state"},[l.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)])],32),e.createVNode(d,{visible:m.value,"onUpdate:visible":o[1]||(o[1]=e=>m.value=e),top:"0",width:"100%",height:"100%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"modal-mask",onClick:e.withModifiers(B,["stop"])}),e.createElementVNode("view",{class:"filter-modal"},[e.createElementVNode("view",{class:"modal-header",style:e.normalizeStyle("margin-top:0rpx")},[e.createElementVNode("text",{class:"title"},"筛选看想要的娃物搭配吧！"),e.createElementVNode("text",{class:"close",onClick:B},"×")],4),e.createVNode(r,{mode:"fill",onSelect:b,background:"#f8f8f8",width:"100%"}),e.createElementVNode("view",{class:"selected-goods"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.goods_id,class:"goods-tag",onClick:e.withModifiers((e=>S(t.goods_id,e)),["stop"])},[e.createTextVNode(e.toDisplayString(t.goods_name)+" ",1),e.createElementVNode("text",{class:"remove"},"×")],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"action-btns"},[e.createElementVNode("button",{class:"btn reset",onClick:C},"重置"),e.createElementVNode("button",{class:"btn confirm",onClick:x},"应用筛选")])])])),_:1},8,["visible"])])])),_:1})],64)}}},[["__scopeId","data-v-15709509"]]),be=w({__name:"sale_news",setup(o){const n=e.ref({title:"",content:"",image_list:[],created_at:0}),i=e.ref({brand_name:"",logo:""}),s=e.ref(!0),c=e.ref(!1),r=e.ref(""),u=e.ref(0),p=e.ref(0),g=e.ref(!1),v=e.ref(null),f=e.ref(null);e.ref(1);let y=e.ref({});uni.getSystemInfoSync();const w=({parent:e,target:a})=>{var o;t("log","at pages/sale_news/sale_news.vue:108","parent",e),t("log","at pages/sale_news/sale_news.vue:109","target",a);let n=e;null!=a&&(n=a),y.value.id!=n.id?(t("log","at pages/sale_news/sale_news.vue:120","item",n),y.value=n,null==(o=f.value)||o.focusInput()):y.value={}};function k(e){uni.navigateTo({url:"/pages/brand/brand?brand_id="+e})}uni.setNavigationBarTitle({title:"图透详情"});const _=({content:e,replyInfo:a,origin:o})=>{let n=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/sale_news/sale_news.vue:205","reply_info",a);const l={content:e,origin:o,target_id:parseInt(u.value),type:4,...a.id&&{reply_id:a.id,reply_for:a.comment,reply_user_id:a.user_id,parent_id:a.parent_id>0?a.parent_id:a.id}};uni.request({url:d+"/with-state/add-comment",method:"POST",header:{Authorization:n},data:l,success:e=>{var t,a;if("success"==e.data.status){const o=e.data.data;0===o.parent_id?null==(t=v.value)||t.addNewComment(o):null==(a=v.value)||a.addReplyComment(o),uni.showToast({title:"评论成功",icon:"success"})}else uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})}})};function E(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${i}`}const N=()=>{uni.request({url:d+"/brand-info?id="+p.value,success:e=>{"success"===e.data.status&&(i.value=e.data.data,uni.setNavigationBarTitle({title:e.data.data.brand_name}),b())},fail:()=>handleError("品牌信息加载失败")})},V=async()=>{if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});const e="/with-state/"+(g.value?"unlike":"add-like");uni.request({url:d+e,method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{id:parseInt(p.value),type:2},success:e=>{"success"===e.data.status&&(g.value=!g.value,uni.showToast({title:g.value?"关注成功":"已取消关注",icon:"none"}))}})},b=()=>{m.isLogin&&uni.request({url:`${d}/with-state/hasLike?id=${p.value}&type=2`,method:"POST",header:{Authorization:uni.getStorageSync("token")},success:e=>{var t;g.value=(null==(t=e.data.data)?void 0:t.id)>0}})};return l((e=>{e.id&&e.brand_id?(u.value=e.id,p.value=e.brand_id,(async e=>{try{const t=await uni.request({url:`${d}/sale-news-detail?id=${e}`,timeout:5e3});"success"===t.data.status?(n.value={...t.data.data,image_list:t.data.data.image_list||[]},N()):handleError(t.data.msg||"数据加载失败")}catch(t){handleError("网络请求失败")}finally{s.value=!1}})(e.id),h().then(b)):handleError("缺少必要参数")})),(t,o)=>{const l=a(e.resolveDynamicComponent("comment-list"),P),d=a(e.resolveDynamicComponent("comment-input"),R);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("swiper",{class:"swiper-box","indicator-dots":!0,autoplay:!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.image_list,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"swiper-image",onClick:e=>{uni.previewImage({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])))),128))])]),e.createElementVNode("view",{class:"brand-info"},[e.createElementVNode("image",{class:"brand-logo",src:i.value.logo_image,mode:"aspectFill",onClick:o[0]||(o[0]=e=>k(i.value.id))},null,8,["src"]),e.createElementVNode("view",{class:"brand-details",onClick:o[1]||(o[1]=e=>k(i.value.id))},[e.createElementVNode("text",{class:"brand-name"},e.toDisplayString(i.value.brand_name),1),e.createElementVNode("text",{class:"publish-time"},e.toDisplayString(E(n.value.created_at)),1)]),e.createElementVNode("text",{class:"follow",onClick:V,style:e.normalizeStyle({background:g.value?"#ff6a6c":"#65C3D6"})},e.toDisplayString(g.value?"已关注":"+ 关注品牌"),5)]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"title"},e.toDisplayString(n.value.title),1)]),e.createElementVNode("view",{style:{margin:"20rpx 0rpx"}},[e.createElementVNode("text",{class:"content"},e.toDisplayString(n.value.content),1)])]),e.createElementVNode("view",{style:{padding:"10px"}},[e.createVNode(l,{ref_key:"commentListRef",ref:v,type:4,"relation-id":parseInt(u.value),onReply:w},null,8,["relation-id"])]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error"},e.toDisplayString(r.value),1)):e.createCommentVNode("",!0),e.createVNode(d,{ref_key:"commentInputRef",ref:f,"reply-info":e.unref(y),"target-id":u.value,onSubmit:_,"onUpdate:replyInfo":o[2]||(o[2]=t=>e.isRef(y)?y.value=t:y=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}})])}}},[["__scopeId","data-v-4974fdb1"]]),xe=w({__name:"treehole_publish",setup(o){const n=e.ref(""),l=e.ref(0),i=e.ref([]),s=e.ref({}),c=e.ref(""),m=e.ref(-1),p=e.ref("");function g(e){uni.previewImage({current:i.value[e],urls:i.value})}function h(e){l.value=e.detail.value.length>0?1:0}uni.setNavigationBarTitle({title:"投稿树洞"});function v(e){const t=e.detail.value;t>=0&&s.value[t]&&(m.value=t,c.value=s.value[t].value,p.value=s.value[t].label)}const f=e.computed((()=>n.value.trim().length>0&&null!==c.value));async function y(){if(f.value)if(c.value)try{uni.showLoading({title:"提交中..."});const e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});const t={content:n.value.trim(),images:i.value,is_anonymous:l.value,category_id:c.value},a=await uni.request({url:d+"/with-state/add-submission",method:"POST",data:t,header:{"Content-Type":"application/json",Authorization:e}});uni.hideLoading(),"success"==a.data.status?(uni.showToast({title:"我们很快审核完成",icon:"success"}),setTimeout((()=>{n.value="",i.value=[],l.value=0,uni.navigateBack()}),1500)):uni.showToast({title:a.data.msg||"提交失败",icon:"none"})}catch(e){uni.hideLoading(),t("error","at pages/treehole_publish/treehole_publish.vue:236","提交失败:",e),uni.showToast({title:"网络请求失败",icon:"none"})}else uni.showToast({title:"请选择分类",icon:"none"})}return e.onMounted((()=>{(async()=>{try{const e=await uni.request({url:d+"/treehole-typelist",method:"GET"});"success"===e.data.status&&(s.value=Object.entries(e.data.data).map((([e,t])=>({value:Number(e),label:t}))))}catch(e){t("error","at pages/treehole_publish/treehole_publish.vue:150","获取分类失败:",e)}})()})),(o,d)=>{const w=a(e.resolveDynamicComponent("uni-icons"),N),k=a(e.resolveDynamicComponent("common-page"),V);return e.openBlock(),e.createBlock(k,{title:"发布树洞"},{default:e.withCtx((()=>[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{class:"publish-box"},[e.createElementVNode("picker",{class:"category-picker",range:s.value,"range-key":"label",onChange:v,value:m.value},[e.createElementVNode("view",{class:"picker-content"},[e.createElementVNode("text",{class:e.normalizeClass(["picker-text",c.value?"":"placeholder"])},e.toDisplayString(p.value||"请选择分类（必选）"),3),e.createVNode(w,{type:"right",size:"22",color:"#888"})])],40,["range","value"]),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload_item",key:a},[e.createElementVNode("image",{src:t,class:"uploaded_image",onClick:g,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("image",{src:r,class:"close_icon",onClick:e=>o.deleteImage(a)},null,8,["onClick"])])))),128)),e.createElementVNode("view",{class:"uploadImageBox",style:{background:"#f8f8f8"}},[e.createElementVNode("image",{src:ce,class:"upload_img",onClick:d[0]||(d[0]=e=>(o.index,t("log","at pages/treehole_publish/treehole_publish.vue:108","openSelect"),void ee().then((e=>{ae().then((a=>{t("log","at pages/treehole_publish/treehole_publish.vue:111",a),oe(e,a.token,a.path).then((e=>{200!=e.statusCode&&uni.showToast({title:"上传失败",icon:"none"}),t("log","at pages/treehole_publish/treehole_publish.vue:120",u+a.path),i.value.push(u+a.path),uni.showToast({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])]),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":d[1]||(d[1]=e=>n.value=e),placeholder:"写下你想说的话...",class:"textarea",maxlength:"500"},null,512),[[e.vModelText,n.value]]),e.createElementVNode("view",{class:"anonymous"},[e.createElementVNode("checkbox-group",{onChange:h},[e.createElementVNode("label",null,[e.createElementVNode("checkbox",{checked:1===l.value,color:"#4cbbd0"},null,8,["checked"]),e.createElementVNode("text",null,"匿名发布")])],32)]),e.createElementVNode("view",{class:"publish-detail"},[e.createElementVNode("text",null,"* 目前树洞为审稿发布，只接受娃圈相关投稿，不接受包含人身攻击或违反法律法规的投稿。"),e.createElementVNode("text",null,"* 我们会在工作时间进行审稿，您可以在个人投稿中心查看投稿状态，审核通过后稿件才被可见。"),e.createElementVNode("text",null,"* 如果勾选匿名发布，他人将无法通过稿件进入您的主页。如果稿件遭到过多点踩或投诉，我们可能会隐藏这封稿件。")]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{disabled:!f.value}]),onClick:y}," 提交 ",2)])])),_:1})}}},[["__scopeId","data-v-608341f7"]]),Be={__name:"treehole_detail",props:{id:{type:String,required:!0}},setup(o){e.ref(!0),e.ref(!1),e.ref("");const n=e.ref(0),l=e.ref(null),i=e.ref(null),s=e.ref(null);e.ref(1);let c=e.ref({});const r=e.ref(!1),u=o,p=({parent:e,target:a})=>{var o;t("log","at pages/treehole_detail/treehole_detail.vue:110","parent",e),t("log","at pages/treehole_detail/treehole_detail.vue:111","target",a);let n=e;null!=a&&(n=a),c.value.id!=n.id?(t("log","at pages/treehole_detail/treehole_detail.vue:122","item",n),c.value=n,null==(o=s.value)||o.focusInput()):c.value={}},g=({content:e,replyInfo:a,origin:o})=>{let l=uni.getStorageSync("token");if(!m.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/treehole_detail/treehole_detail.vue:140","reply_info",a);const s={content:e,origin:o,target_id:parseInt(n.value),type:5,...a.id&&{reply_id:a.id,reply_for:a.comment,reply_user_id:a.user_id,parent_id:a.parent_id>0?a.parent_id:a.id}};uni.request({url:d+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:e=>{var a,o;if("success"==e.data.status){const n=e.data.data;0===n.parent_id?(t("log","at pages/treehole_detail/treehole_detail.vue:165","添加主评论"),null==(a=i.value)||a.addNewComment(n)):(t("log","at pages/treehole_detail/treehole_detail.vue:169","添加子评论"),null==(o=i.value)||o.addReplyComment(n)),uni.showToast({title:"评论成功",icon:"success"})}else uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})}})};const v=()=>{if(!m.isLogin)return void uni.showModal({title:"提示",content:"需要登录后才能点赞",success:e=>{e.confirm&&uni.navigateTo({url:"/pages/login/login"})}});const e=uni.getStorageSync("token"),t=d+(r.value?"/with-state/unlike":"/with-state/add-like");uni.request({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(u.id),type:5},success:e=>{"success"===e.data.status&&(r.value=!r.value,l.value.like_count+=r.value?1:-1)}})};const f=e.computed((()=>{var e,t;return(null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.slice(0,9))||[]})),y=e.computed((()=>{var e,t;return((null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.length)||0)-9})),w=e.computed((()=>{var e,t;return((null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.length)||0)>9}));uni.setNavigationBarTitle({title:"投稿详情"});const k=e.computed((()=>{const e=f.value.length;return 1===e?"single":2===e?"double":"multi"})),_=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return e.onMounted((async()=>{n.value=u.id,t("log","at pages/treehole_detail/treehole_detail.vue:347","pageId",n.value);try{const e=await uni.request({url:`${d}/treehole-detail?id=${u.id}`});"success"===e.data.status&&(l.value=e.data.data)}catch(e){t("log","at pages/treehole_detail/treehole_detail.vue:358",e),uni.showToast({title:"加载失败",icon:"none"})}h(),function(){let e=uni.getStorageSync("token");""!=e&&uni.request({url:d+"/with-state/hasLike?id="+u.id+"&type=5",method:"POST",header:{Authorization:e},success:e=>{t("log","at pages/treehole_detail/treehole_detail.vue:263",e.data),"success"==e.data.status?e.data.data.id>0?r.value=!0:r.value=!1:uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t("log","at pages/treehole_detail/treehole_detail.vue:281",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}()})),(t,o)=>{const d=a(e.resolveDynamicComponent("uni-icons"),N),m=a(e.resolveDynamicComponent("comment-list"),P),h=a(e.resolveDynamicComponent("comment-input"),R);return e.openBlock(),e.createElementBlock(e.Fragment,null,[l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"author-info"},[e.createElementVNode("image",{src:l.value.avatar||"/static/noname.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{style:{width:"500rpx"}},[e.createElementVNode("text",{class:"author-name"},e.toDisplayString(l.value.author_name),1),e.createElementVNode("view",{class:"time"},e.toDisplayString(_(l.value.created_at)),1)])])]),e.createElementVNode("view",{class:"content"},e.toDisplayString(l.value.content),1),e.createElementVNode("view",{class:e.normalizeClass(["image-container",k.value])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"image-wrapper"},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"image-item",onClick:e=>(e=>{uni.previewImage({current:e,urls:l.value.images})})(a)},null,8,["src","onClick"]),w.value&&8===a?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-overlay"}," +"+e.toDisplayString(y.value),1)):e.createCommentVNode("",!0)])))),128))],2),e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("view",{class:"action-group"},[e.createElementVNode("view",{class:"action-item",onClick:v},[e.createVNode(d,{type:r.value?"hand-up-filled":"hand-up",size:"24",color:r.value?"#ff4d4f":"#666"},null,8,["type","color"]),e.createElementVNode("text",{class:"action-text"},e.toDisplayString(l.value.like_count||0),1)]),e.createElementVNode("view",{class:"action-item",onClick:o[0]||(o[0]=e=>function(e){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+e.id;uni.setClipboardData({data:t,success:function(){uni.showToast({title:"复制链接成功",icon:"none"})}})}(l.value))},[e.createVNode(d,{type:"redo",size:"24",color:"#666"}),e.createElementVNode("text",{class:"action-text"},"分享")])]),e.createElementVNode("text",{class:"time-text"},"审核于 "+e.toDisplayString(_(l.value.approve_time)),1)])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading"},"加载中...")),e.createElementVNode("view",{style:{padding:"10px"}},[e.createVNode(m,{ref_key:"commentListRef",ref:i,type:5,"relation-id":parseInt(u.id),onReply:p},null,8,["relation-id"])]),e.createVNode(h,{ref_key:"commentInputRef",ref:s,"reply-info":e.unref(c),"target-id":n.value,onSubmit:g,"onUpdate:replyInfo":o[1]||(o[1]=t=>e.isRef(c)?c.value=t:c=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}})],64)}}},Se=w({__name:"reset_password",setup(t){const a=e.ref({telephone:"",code:"",newPassword:"",reNewPassword:""}),o=e.ref({phone:"",code:"",newPassword:"",reNewPassword:""}),n=e.ref(0),l=e.computed((()=>n.value>0)),i=e.computed((()=>n.value>0?`${n.value}秒后重发`:"获取验证码")),s=e.ref(!1),c=()=>a.value.telephone?/^1[3-9]\d{9}$/.test(a.value.telephone)?(o.value.phone="",!0):(o.value.phone="手机号格式不正确",!1):(o.value.phone="手机号不能为空",!1),r=async()=>{if(c())try{const e=await uni.request({url:`${d}/send-sms-code`,method:"POST",data:{tel_phone:a.value.telephone}});"success"===e.data.status?(h(),uni.showToast({title:"验证码已发送",icon:"none"})):uni.showToast({title:e.data.msg||"发送失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}},u=()=>a.value.newPassword.length<6?(o.value.newPassword="密码至少需要6位",!1):(o.value.newPassword="",!0),m=()=>a.value.newPassword!==a.value.reNewPassword?(o.value.reNewPassword="两次密码输入不一致",!1):(o.value.reNewPassword="",!0),p=()=>a.value.code?6!==a.value.code.length?(o.value.code="验证码格式不正确",!1):(o.value.code="",!0):(o.value.code="验证码不能为空",!1),g=async()=>{if([c(),p(),u(),m()].every((e=>e)))try{s.value=!0;const e=await uni.request({url:`${d}/reset-password`,method:"POST",data:{telephone:a.value.telephone,code:a.value.code,password:a.value.newPassword,re_password:a.value.reNewPassword}});"success"===e.data.status?uni.showToast({title:"密码重置成功",icon:"success",complete:()=>{setTimeout((()=>{uni.navigateBack()}),1500)}}):uni.showToast({title:e.data.msg||"重置失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}finally{s.value=!1}},h=()=>{n.value=60;const e=setInterval((()=>{n.value<=0?clearInterval(e):n.value--}),1e3)},v=()=>{uni.navigateBack()};return(t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"重置密码")]),e.createElementVNode("view",{class:"form-box"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("text",{class:"prefix"},"+86"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>a.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:c},null,544),[[e.vModelText,a.value.telephone]])]),o.value.phone?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.phone),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"code-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>a.value.code=e),type:"number",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:p},null,544),[[e.vModelText,a.value.code]]),e.createElementVNode("button",{class:e.normalizeClass(["code-btn",{disabled:l.value}]),disabled:l.value,onClick:r},e.toDisplayString(i.value),11,["disabled"])]),o.value.code?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.code),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>a.value.newPassword=e),type:"password",placeholder:"请输入新密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:u},null,544),[[e.vModelText,a.value.newPassword]])]),o.value.newPassword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.newPassword),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>a.value.reNewPassword=e),type:"password",placeholder:"请再次输入新密码",class:"input","placeholder-class":"placeholder",onBlur:m},null,544),[[e.vModelText,a.value.reNewPassword]])]),o.value.reNewPassword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(o.value.reNewPassword),1)):e.createCommentVNode("",!0)]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{loading:s.value}]),disabled:s.value,onClick:g},e.toDisplayString(s.value?"提交中...":"重置密码"),11,["disabled"]),e.createElementVNode("view",{class:"bottom-tips"},[e.createElementVNode("text",{class:"link-text",onClick:v},"返回登录")])])]))}},[["__scopeId","data-v-418709da"]]),Ce=w({__name:"username",setup(t){uni.setNavigationBarTitle({title:"修改用户名"});const o=e.ref(m.userInfo.username||""),n=e.ref(!1),l=e.computed((()=>o.value.length>=2&&o.value!==m.userInfo.username));async function i(){if(l.value)try{n.value=!0;const e=await uni.request({url:d+"/with-state/update-profile",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{username:o.value}});"success"===e.data.status?(uni.showToast({title:"更新成功",icon:"success"}),await g(),setTimeout((()=>uni.navigateBack()),1500)):uni.showToast({title:e.data.msg||"更新失败",icon:"none"})}catch(e){uni.showToast({title:"请求失败，请稍后重试",icon:"none"})}finally{n.value=!1}}return(t,s)=>{const c=a(e.resolveDynamicComponent("uni-icons"),N);return e.openBlock(),e.createElementBlock("view",{class:"password-container"},[e.createElementVNode("view",{class:"form-wrapper"},[e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:" ","onUpdate:modelValue":s[0]||(s[0]=e=>o.value=e),maxlength:"20"},null,512),[[e.vModelText,o.value]]),e.createElementVNode("label",{class:"floating-label"},"用户名"),e.createVNode(c,{class:"input-icon",type:"person",size:"18",color:"#999"})])]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{active:l.value}]),onClick:i,disabled:!l.value},[e.createTextVNode(e.toDisplayString(n.value?"提交中...":"更新用户名")+" ",1),n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"})):e.createCommentVNode("",!0)],10,["disabled"])]),e.createElementVNode("view",{class:"security-tips"},[e.createVNode(c,{type:"info",size:"16",color:"#666"}),e.createElementVNode("text",null,"用户名2-20个字符，支持中英文、数字和下划线")])])}}},[["__scopeId","data-v-960efc4b"]]),Te=w({__name:"my_comment",setup(t){const a=e.ref([]),o=e.ref(1),n=e.ref(10),l=e.ref(0),i=e.ref(!1),s=e.ref(!1),c={1:{name:"品牌",class:"brand"},2:{name:"商品",class:"goods"},3:{name:"搭配",class:"collocation"},4:{name:"资讯",class:"news"},5:{name:"树洞",class:"treehole"},6:{name:"展示柜",class:"collocation"},7:{name:"文章",class:"collocation"}};e.onMounted((()=>{r()}));const r=async(e=!1)=>{if(!i.value&&!s.value){i.value=!0;try{const t=await uni.request({url:`${d}/with-state/my-comment`,method:"GET",header:{Authorization:uni.getStorageSync("token")},data:{page:o.value,page_size:n.value}});if("success"===t.data.status){const n=t.data.data;a.value=e?[...a.value,...n.comment_list]:n.comment_list,l.value=n.total,o.value++,s.value=a.value.length>=l.value}}finally{i.value=!1}}},u=()=>{s.value||r(!0)},m=e=>{let t="";const a=e.relation_id;switch(e.type){case 1:t=`/pages/brand/brand?brand_id=${a}`;break;case 2:t=`/pages/goods/goods?goods_id=${a}`;break;case 3:t=`/pages/collocation_share/collocation_share?collocation_id=${a}&origin=1`;break;case 4:t=`/pages/sale_news/sale_news?newsId=${a}`;break;case 5:t=`/pages/treehole_detail/treehole_detail?id=${a}`;break;case 6:t=`/pages/collocation_share/collocation_share?collocation_id=${a}&origin=2`;break;default:return void uni.showToast({title:"未知类型",icon:"none"})}t&&uni.navigateTo({url:t})},p=e=>{var t;return(null==(t=c[e])?void 0:t.name)||"未知"};function g(e){const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}return uni.setNavigationBarTitle({title:"我的评论"}),(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("scroll-view",{class:"comment-list","scroll-y":"",onScrolltolower:u,"show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,a)=>{return e.openBlock(),e.createElementBlock("view",{key:a,class:"comment-item",onClick:e=>m(t)},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{class:"avatar",src:t.avatar||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-meta"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(t.username),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(g(t.created_at)),1)])]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"content"},e.toDisplayString(t.comment),1)]),e.createElementVNode("view",{class:"target-box",onClick:e=>m(t)},[t.target_image?(e.openBlock(),e.createElementBlock("image",{key:0,class:"target-image",src:t.target_image,mode:"aspectFill"},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"target-info"},[e.createElementVNode("view",{class:e.normalizeClass(["type-tag",(o=t.type,(null==(n=c[o])?void 0:n.class)||"")])},e.toDisplayString(p(t.type)),3),e.createElementVNode("text",{class:"target-name"},e.toDisplayString(t.target_name),1)])],8,["onClick"])],8,["onClick"]);var o,n})),128)),e.createElementVNode("view",{class:"loading-status"},[i.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},"加载中...")):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more-text"},"没有更多了")):e.createCommentVNode("",!0)])],32)]))}},[["__scopeId","data-v-d64b0f97"]]),De=w({__name:"my_collocation",setup(t){const a=e.ref([]),o=e.ref(1),n=e.ref(10),l=e.ref(0),i=e.ref(!1),s=e.ref(!1),c=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`},r=async()=>{if(!s.value&&!i.value){i.value=!0;try{if(!(await h()))return;const e=await uni.request({url:`${d}/with-state/my-collocation`,method:"GET",header:{Authorization:uni.getStorageSync("token")},data:{page:o.value,page_size:n.value}});"success"===e.data.status&&(a.value=[...a.value,...e.data.data.collocation_relation_list],l.value=e.data.data.total,s.value=a.value.length>=l.value,o.value++)}catch(e){uni.showToast({title:"加载失败",icon:"none"})}finally{i.value=!1}}},m=()=>{s.value||r()};return uni.setNavigationBarTitle({title:"我的搭配"}),e.onMounted((()=>{r()})),(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("scroll-view",{class:"scroll-content","scroll-y":"",onScrolltolower:m,"show-scrollbar":!1},[0!==a.value.length||i.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"}," 暂无发布的搭配，快去创建吧~ ")),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"collocation-card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("image",{class:"avatar",src:t.avatar||`${e.unref(u)}/default-avatar.png`,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"time"},e.toDisplayString(c(t.created_at)),1)]),e.createElementVNode("view",{class:"image-container"},[t.image_urls.length>1?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"swiper-box",autoplay:!1,circular:!0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.image_urls,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{class:"swiper-image",src:t,mode:"aspectFill","lazy-load":"",style:{aspectRatio:"3/4"}},null,8,["src"])])))),128))])):(e.openBlock(),e.createElementBlock("image",{key:1,class:"single-image",src:t.image_urls[0],mode:"aspectFill","lazy-load":"",style:{aspectRatio:"3/4"}},null,8,["src"]))]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"content"},e.toDisplayString(t.content),1)]),t.relation_list.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"relation-box"},[e.createElementVNode("text",{class:"relation-label"},"搭配包含："),e.createElementVNode("scroll-view",{"scroll-x":"",class:"tag-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.relation_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"relation-tag"},e.toDisplayString(t.type)+"·"+e.toDisplayString(t.relation_goods_name||t.relation_brand_name),1)))),128))])])):e.createCommentVNode("",!0)])))),128)),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-box"},[e.createElementVNode("image",{src:"/static/images/loading.gif",class:"loading-icon"}),e.createElementVNode("text",null,"加载中...")])):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"no-more"},"没有更多了～")):e.createCommentVNode("",!0)],32)]))}},[["__scopeId","data-v-c0888068"]]),ze=e=>{(e.$wxs||(e.$wxs=[])).push("handler"),(e.$wxsModules||(e.$wxsModules={})).handler="2f992f8c"},Ie={name:"node",options:{},data:()=>({ctrl:{}}),props:{name:String,attrs:{type:Object,default:()=>({})},childs:Array,opts:Array},components:{},mounted(){if(this.$nextTick((()=>{for(this.root=this.$parent;"mp-html"!==this.root.$options.name;this.root=this.root.$parent);})),this.opts[0]){let e;for(e=this.childs.length;e--&&"img"!==this.childs[e].name;);-1!==e&&(this.observer=uni.createIntersectionObserver(this).relativeToViewport({top:500,bottom:500}),this.observer.observe("._img",(e=>{e.intersectionRatio&&(this.$set(this.ctrl,"load",1),this.observer.disconnect())})))}},beforeDestroy(){this.observer&&this.observer.disconnect()},methods:{play(e){const t=e.currentTarget.dataset.i,a=this.childs[t];this.root.$emit("play",{source:a.name,attrs:{...a.attrs,src:a.src[this.ctrl[t]||0]}})},imgTap(e){const t=this.childs[e.currentTarget.dataset.i];t.a?this.linkTap(t.a):t.attrs.ignore||(t.attrs.src=t.attrs.src||t.attrs["data-src"],this.root.$emit("imgtap",t.attrs),this.root.previewImg&&uni.previewImage({current:parseInt(t.attrs.i),urls:this.root.imgList}))},imgLongTap(e){const t=this.childs[e.currentTarget.dataset.i].attrs;this.opts[3]&&!t.ignore&&uni.showActionSheet({itemList:["保存图片"],success:()=>{const e=e=>{uni.saveImageToPhotosAlbum({filePath:e,success(){uni.showToast({title:"保存成功"})}})};this.root.imgList[t.i].startsWith("http")?uni.downloadFile({url:this.root.imgList[t.i],success:t=>e(t.tempFilePath)}):e(this.root.imgList[t.i])}})},imgLoad(e){const t=e.currentTarget.dataset.i;this.childs[t].w?(this.opts[1]&&!this.ctrl[t]||-1===this.ctrl[t])&&this.$set(this.ctrl,t,1):this.$set(this.ctrl,t,e.detail.width),this.checkReady()},checkReady(){this.root&&!this.root.lazyLoad&&(this.root._unloadimgs-=1,this.root._unloadimgs||setTimeout((()=>{this.root.getRect().then((e=>{this.root.$emit("ready",e)})).catch((()=>{this.root.$emit("ready",{})}))}),350))},linkTap(e){const t=e.currentTarget?this.childs[e.currentTarget.dataset.i]:{},a=t.attrs||e,o=a.href;this.root.$emit("linktap",Object.assign({innerText:this.root.getText(t.children||[])},a)),o&&("#"===o[0]?this.root.navigateTo(o.substring(1)).catch((()=>{})):o.split("?")[0].includes("://")?this.root.copyLink&&plus.runtime.openWeb(o):uni.navigateTo({url:o,fail(){uni.switchTab({url:o,fail(){}})}}))},mediaError(e){const t=e.currentTarget.dataset.i,a=this.childs[t];if("video"===a.name||"audio"===a.name){let e=(this.ctrl[t]||0)+1;if(e>a.src.length&&(e=0),e<a.src.length)return void this.$set(this.ctrl,t,e)}else"img"===a.name&&(this.opts[2]&&this.$set(this.ctrl,t,-1),this.checkReady());this.root&&this.root.$emit("error",{source:a.name,attrs:a.attrs,errMsg:e.detail.errMsg})}}};ze(Ie);const $e=w(Ie,[["render",function(t,a,o,n,l,i){const s=e.resolveComponent("node",!0);return e.openBlock(),e.createElementBlock("view",{id:o.attrs.id,class:e.normalizeClass("_block _"+o.name+" "+o.attrs.class),style:e.normalizeStyle(o.attrs.style)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.childs,((t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:n},["img"===t.name&&!t.t&&(o.opts[1]&&!l.ctrl[n]||l.ctrl[n]<0)?(e.openBlock(),e.createElementBlock("image",{key:0,class:"_img",style:e.normalizeStyle(t.attrs.style),src:l.ctrl[n]<0?o.opts[2]:o.opts[1],mode:"widthFix"},null,12,["src"])):e.createCommentVNode("",!0),"img"===t.name&&t.t?(e.openBlock(),e.createElementBlock("rich-text",{key:1,style:e.normalizeStyle("display:"+t.t),nodes:[{attrs:{style:t.attrs.style||"",src:t.attrs.src},name:"img"}],"data-i":n,onClick:a[0]||(a[0]=e.withModifiers(((...e)=>i.imgTap&&i.imgTap(...e)),["stop"]))},null,12,["nodes","data-i"])):"img"===t.name?(e.openBlock(),e.createElementBlock("image",{key:2,id:t.attrs.id,class:e.normalizeClass("_img "+t.attrs.class),style:e.normalizeStyle((-1===l.ctrl[n]?"display:none;":"")+"width:"+(l.ctrl[n]||1)+"px;"+t.attrs.style),src:t.attrs.src||(l.ctrl.load?t.attrs["data-src"]:""),mode:t.h?t.w?t.m||"":"heightFix":"widthFix","data-i":n,onLoad:a[1]||(a[1]=(...e)=>i.imgLoad&&i.imgLoad(...e)),onError:a[2]||(a[2]=(...e)=>i.mediaError&&i.mediaError(...e)),onClick:a[3]||(a[3]=e.withModifiers(((...e)=>i.imgTap&&i.imgTap(...e)),["stop"])),onLongpress:a[4]||(a[4]=(...e)=>i.imgLongTap&&i.imgLongTap(...e))},null,46,["id","src","mode","data-i"])):t.text?(e.openBlock(),e.createElementBlock("text",{key:3,decode:""},e.toDisplayString(t.text),1)):"br"===t.name?(e.openBlock(),e.createElementBlock("text",{key:4},"\\n")):"a"===t.name?(e.openBlock(),e.createElementBlock("view",{key:5,id:t.attrs.id,class:e.normalizeClass((t.attrs.href?"_a ":"")+t.attrs.class),"hover-class":"_hover",style:e.normalizeStyle("display:inline;"+t.attrs.style),"data-i":n,onClick:a[5]||(a[5]=e.withModifiers(((...e)=>i.linkTap&&i.linkTap(...e)),["stop"]))},[e.createVNode(s,{name:"span",childs:t.children,opts:o.opts,style:{display:"inherit"}},null,8,["childs","opts"])],14,["id","data-i"])):t.html?(e.openBlock(),e.createElementBlock("view",{key:6,id:t.attrs.id,class:e.normalizeClass("_video "+t.attrs.class),style:e.normalizeStyle(t.attrs.style),innerHTML:t.html,"data-i":n,onVplay:a[6]||(a[6]=e.withModifiers(((...e)=>i.play&&i.play(...e)),["stop"]))},null,46,["id","innerHTML","data-i"])):"iframe"===t.name?(e.openBlock(),e.createElementBlock("iframe",{key:7,style:e.normalizeStyle(t.attrs.style),allowfullscreen:t.attrs.allowfullscreen,frameborder:t.attrs.frameborder,src:t.attrs.src},null,12,["allowfullscreen","frameborder","src"])):"embed"===t.name?(e.openBlock(),e.createElementBlock("embed",{key:8,style:e.normalizeStyle(t.attrs.style),src:t.attrs.src},null,12,["src"])):"table"===t.name&&t.c||"li"===t.name?(e.openBlock(),e.createElementBlock("view",{key:9,id:t.attrs.id,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},["li"===t.name?(e.openBlock(),e.createBlock(s,{key:0,childs:t.children,opts:o.opts},null,8,["childs","opts"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(t.children,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},["td"===t.name||"th"===t.name?(e.openBlock(),e.createBlock(s,{key:0,childs:t.children,opts:o.opts},null,8,["childs","opts"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(t.children,((t,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:a},["td"===t.name||"th"===t.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},[e.createVNode(s,{childs:t.children,opts:o.opts},null,8,["childs","opts"])],6)):(e.openBlock(),e.createElementBlock("view",{key:1,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.children,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},[e.createVNode(s,{childs:t.children,opts:o.opts},null,8,["childs","opts"])],6)))),128))],6))],64)))),128))],6)))),128))],14,["id"])):t.c?2===t.c?(e.openBlock(),e.createElementBlock("view",{key:11,id:t.attrs.id,class:e.normalizeClass("_block _"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.f+";"+t.attrs.style)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.children,((t,a)=>(e.openBlock(),e.createBlock(s,{key:a,style:e.normalizeStyle(t.f),name:t.name,attrs:t.attrs,childs:t.children,opts:o.opts},null,8,["style","name","attrs","childs","opts"])))),128))],14,["id"])):(e.openBlock(),e.createBlock(s,{key:12,style:e.normalizeStyle(t.f),name:t.name,attrs:t.attrs,childs:t.children,opts:o.opts},null,8,["style","name","attrs","childs","opts"])):(e.openBlock(),e.createElementBlock("rich-text",{key:10,id:t.attrs.id,style:e.normalizeStyle("display:inline;"+t.f),preview:!1,selectable:o.opts[4],"user-select":o.opts[4],nodes:[t]},null,12,["id","selectable","user-select","nodes"]))],64)))),128))],14,["id"])}],["__scopeId","data-v-39dba710"]]),Fe={trustTags:Ae("a,abbr,ad,audio,b,blockquote,br,code,col,colgroup,dd,del,dl,dt,div,em,fieldset,h1,h2,h3,h4,h5,h6,hr,i,img,ins,label,legend,li,ol,p,q,ruby,rt,source,span,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,title,ul,video"),blockTags:Ae("address,article,aside,body,caption,center,cite,footer,header,html,nav,pre,section"),inlineTags:Ae("abbr,b,big,code,del,em,i,ins,label,q,small,span,strong,sub,sup"),ignoreTags:Ae("area,base,canvas,embed,frame,head,iframe,input,link,map,meta,param,rp,script,source,style,textarea,title,track,wbr"),voidTags:Ae("area,base,br,col,circle,ellipse,embed,frame,hr,img,input,line,link,meta,param,path,polygon,rect,source,track,use,wbr"),entities:{lt:"<",gt:">",quot:'"',apos:"'",ensp:" ",emsp:" ",nbsp:" ",semi:";",ndash:"–",mdash:"—",middot:"·",lsquo:"‘",rsquo:"’",ldquo:"“",rdquo:"”",bull:"•",hellip:"…",larr:"←",uarr:"↑",rarr:"→",darr:"↓"},tagStyle:{address:"font-style:italic",big:"display:inline;font-size:1.2em",caption:"display:table-caption;text-align:center",center:"text-align:center",cite:"font-style:italic",dd:"margin-left:40px",mark:"background-color:yellow",pre:"font-family:monospace;white-space:pre",s:"text-decoration:line-through",small:"display:inline;font-size:0.8em",strike:"text-decoration:line-through",u:"text-decoration:underline"},svgDict:{animatetransform:"animateTransform",lineargradient:"linearGradient",viewbox:"viewBox",attributename:"attributeName",repeatcount:"repeatCount",repeatdur:"repeatDur",foreignobject:"foreignObject"}},Le={};let Pe;const Re=uni.getSystemInfoSync();Pe=Re.windowWidth;const qe=Ae(" ,\r,\n,\t,\f");let Me=0;function Ae(e){const t=Object.create(null),a=e.split(",");for(let o=a.length;o--;)t[a[o]]=!0;return t}function je(e,t){let a=e.indexOf("&");for(;-1!==a;){const o=e.indexOf(";",a+3);let n;if(-1===o)break;"#"===e[a+1]?(n=parseInt(("x"===e[a+2]?"0":"")+e.substring(a+2,o)),isNaN(n)||(e=e.substr(0,a)+String.fromCharCode(n)+e.substr(o+1))):(n=e.substring(a+1,o),(Fe.entities[n]||"amp"===n&&t)&&(e=e.substr(0,a)+(Fe.entities[n]||"&")+e.substr(o+1))),a=e.indexOf("&",a+1)}return e}function Oe(e){let t=e.length-1;for(let a=t;a>=-1;a--)(-1===a||e[a].c||!e[a].name||"div"!==e[a].name&&"p"!==e[a].name&&"h"!==e[a].name[0]||(e[a].attrs.style||"").includes("inline"))&&(t-a>=5&&e.splice(a+1,t-a,{name:"div",attrs:{},children:e.slice(a+1,t+1)}),t=a-1)}function Ue(e){this.options=e||{},this.tagStyle=Object.assign({},Fe.tagStyle,this.options.tagStyle),this.imgList=e.imgList||[],this.imgList._unloadimgs=0,this.plugins=e.plugins||[],this.attrs=Object.create(null),this.stack=[],this.nodes=[],this.pre=(this.options.containerStyle||"").includes("white-space")&&this.options.containerStyle.includes("pre")?2:0}function He(e){this.handler=e}Fe.ignoreTags.iframe=void 0,Fe.trustTags.iframe=!0,Fe.ignoreTags.embed=void 0,Fe.trustTags.embed=!0,Ue.prototype.parse=function(e){for(let t=this.plugins.length;t--;)this.plugins[t].onUpdate&&(e=this.plugins[t].onUpdate(e,Fe)||e);for(new He(this).parse(e);this.stack.length;)this.popNode();return this.nodes.length>50&&Oe(this.nodes),this.nodes},Ue.prototype.expose=function(){for(let e=this.stack.length;e--;){const t=this.stack[e];if(t.c||"a"===t.name||"video"===t.name||"audio"===t.name)return;t.c=1}},Ue.prototype.hook=function(e){for(let t=this.plugins.length;t--;)if(this.plugins[t].onParse&&!1===this.plugins[t].onParse(e,this))return!1;return!0},Ue.prototype.getUrl=function(e){const t=this.options.domain;return"/"===e[0]?e="/"===e[1]?(t?t.split("://")[0]:"http")+":"+e:t?t+e:plus.io.convertLocalFileSystemURL(e):e.includes("data:")||e.includes("://")||(e=t?t+"/"+e:plus.io.convertLocalFileSystemURL(e)),e},Ue.prototype.parseStyle=function(e){const t=e.attrs,a=(this.tagStyle[e.name]||"").split(";").concat((t.style||"").split(";")),o={};let n="";t.id&&!this.xml&&(this.options.useAnchor?this.expose():"img"!==e.name&&"a"!==e.name&&"video"!==e.name&&"audio"!==e.name&&(t.id=void 0)),t.width&&(o.width=parseFloat(t.width)+(t.width.includes("%")?"%":"px"),t.width=void 0),t.height&&(o.height=parseFloat(t.height)+(t.height.includes("%")?"%":"px"),t.height=void 0);for(let l=0,i=a.length;l<i;l++){const e=a[l].split(":");if(e.length<2)continue;const t=e.shift().trim().toLowerCase();let i=e.join(":").trim();if("-"===i[0]&&i.lastIndexOf("-")>0||i.includes("safe"))n+=`;${t}:${i}`;else if(!o[t]||i.includes("import")||!o[t].includes("import")){if(i.includes("url")){let e=i.indexOf("(")+1;if(e){for(;'"'===i[e]||"'"===i[e]||qe[i[e]];)e++;i=i.substr(0,e)+this.getUrl(i.substr(e))}}else i.includes("rpx")&&(i=i.replace(/[0-9.]+\s*rpx/g,(e=>parseFloat(e)*Pe/750+"px")));o[t]=i}}return e.attrs.style=n,o},Ue.prototype.onTagName=function(e){this.tagName=this.xml?e:e.toLowerCase(),"svg"===this.tagName&&(this.xml=(this.xml||0)+1,Fe.ignoreTags.style=void 0)},Ue.prototype.onAttrName=function(e){(e=this.xml?e:e.toLowerCase()).includes("?")||e.includes(";")?this.attrName=void 0:"data-"===e.substr(0,5)?"data-src"!==e||this.attrs.src?"img"===this.tagName||"a"===this.tagName?this.attrName=e:this.attrName=void 0:this.attrName="src":(this.attrName=e,this.attrs[e]="T")},Ue.prototype.onAttrVal=function(e){const t=this.attrName||"";"style"===t||"href"===t?this.attrs[t]=je(e,!0):t.includes("src")?this.attrs[t]=this.getUrl(je(e,!0)):t&&(this.attrs[t]=e)},Ue.prototype.onOpenTag=function(e){const t=Object.create(null);t.name=this.tagName,t.attrs=this.attrs,this.options.nodes.length&&(t.type="node"),this.attrs=Object.create(null);const a=t.attrs,o=this.stack[this.stack.length-1],n=o?o.children:this.nodes,l=this.xml?e:Fe.voidTags[t.name];if(Le[t.name]&&(a.class=Le[t.name]+(a.class?" "+a.class:"")),"embed"===t.name&&this.expose(),"video"!==t.name&&"audio"!==t.name||("video"!==t.name||a.id||(a.id="v"+Me++),a.controls||a.autoplay||(a.controls="T"),t.src=[],a.src&&(t.src.push(a.src),a.src=void 0),this.expose()),l){if(!this.hook(t)||Fe.ignoreTags[t.name])return void("base"!==t.name||this.options.domain?"source"===t.name&&o&&("video"===o.name||"audio"===o.name)&&a.src&&o.src.push(a.src):this.options.domain=a.href);const e=this.parseStyle(t);if("img"===t.name){if(a.src&&(a.src.includes("webp")&&(t.webp="T"),a.src.includes("data:")&&"all"!==this.options.previewImg&&!a["original-src"]&&(a.ignore="T"),!a.ignore||t.webp||a.src.includes("cloud://"))){for(let n=this.stack.length;n--;){const o=this.stack[n];"a"===o.name&&(t.a=o.attrs),"table"!==o.name||t.webp||a.src.includes("cloud://")||(!e.display||e.display.includes("inline")?t.t="inline-block":t.t=e.display,e.display=void 0),o.c=1}a.i=this.imgList.length.toString();let o=a["original-src"]||a.src;this.imgList.push(o),t.t||(this.imgList._unloadimgs+=1),this.options.lazyLoad&&(a["data-src"]=a.src,a.src=void 0)}"inline"===e.display&&(e.display=""),a.ignore&&(e["max-width"]=e["max-width"]||"100%",a.style+=";-webkit-touch-callout:none"),parseInt(e.width)>Pe&&(e.height=void 0),isNaN(parseInt(e.width))||(t.w="T"),!isNaN(parseInt(e.height))&&(!e.height.includes("%")||o&&(o.attrs.style||"").includes("height"))&&(t.h="T"),t.w&&t.h&&e["object-fit"]&&("contain"===e["object-fit"]?t.m="aspectFit":"cover"===e["object-fit"]&&(t.m="aspectFill"))}else if("svg"===t.name)return n.push(t),this.stack.push(t),void this.popNode();for(const t in e)e[t]&&(a.style+=`;${t}:${e[t].replace(" !important","")}`);a.style=a.style.substr(1)||void 0}else("pre"===t.name||(a.style||"").includes("white-space")&&a.style.includes("pre"))&&2!==this.pre&&(this.pre=t.pre=1),t.children=[],this.stack.push(t);n.push(t)},Ue.prototype.onCloseTag=function(e){let t;for(e=this.xml?e:e.toLowerCase(),t=this.stack.length;t--&&this.stack[t].name!==e;);if(-1!==t)for(;this.stack.length>t;)this.popNode();else if("p"===e||"br"===e){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push({name:e,attrs:{class:Le[e]||"",style:this.tagStyle[e]||""}})}},Ue.prototype.popNode=function(){const e=this.stack.pop();let t=e.attrs;const a=e.children,o=this.stack[this.stack.length-1],n=o?o.children:this.nodes;if(!this.hook(e)||Fe.ignoreTags[e.name])return"title"===e.name&&a.length&&"text"===a[0].type&&this.options.setTitle&&uni.setNavigationBarTitle({title:a[0].text}),void n.pop();if(e.pre&&2!==this.pre){this.pre=e.pre=void 0;for(let e=this.stack.length;e--;)this.stack[e].pre&&(this.pre=1)}const l={};if("svg"===e.name){if(this.xml>1)return void this.xml--;let a="";const o=t.style;return t.style="",t.xmlns="http://www.w3.org/2000/svg",function e(t){if("text"===t.type)return void(a+=t.text);const o=Fe.svgDict[t.name]||t.name;if("foreignObject"===o)for(const a of t.children||[])if(a.attrs&&!a.attrs.xmlns){a.attrs.xmlns="http://www.w3.org/1999/xhtml";break}a+="<"+o;for(const n in t.attrs){const e=t.attrs[n];e&&(a+=` ${Fe.svgDict[n]||n}="${e.replace(/"/g,"")}"`)}if(t.children){a+=">";for(let a=0;a<t.children.length;a++)e(t.children[a]);a+="</"+o+">"}else a+="/>"}(e),e.name="img",e.attrs={src:"data:image/svg+xml;utf8,"+a.replace(/#/g,"%23"),style:o,ignore:"T"},e.children=void 0,this.xml=!1,void(Fe.ignoreTags.style=!0)}if(t.align&&("table"===e.name?"center"===t.align?l["margin-inline-start"]=l["margin-inline-end"]="auto":l.float=t.align:l["text-align"]=t.align,t.align=void 0),t.dir&&(l.direction=t.dir,t.dir=void 0),"font"===e.name&&(t.color&&(l.color=t.color,t.color=void 0),t.face&&(l["font-family"]=t.face,t.face=void 0),t.size)){let e=parseInt(t.size);isNaN(e)||(e<1?e=1:e>7&&(e=7),l["font-size"]=["x-small","small","medium","large","x-large","xx-large","xxx-large"][e-1]),t.size=void 0}if((t.class||"").includes("align-center")&&(l["text-align"]="center"),Object.assign(l,this.parseStyle(e)),"table"!==e.name&&parseInt(l.width)>Pe&&(l["max-width"]="100%",l["box-sizing"]="border-box"),Fe.blockTags[e.name]?e.name="div":Fe.trustTags[e.name]||this.xml||(e.name="span"),"a"===e.name||"ad"===e.name||"iframe"===e.name)this.expose();else if("video"===e.name){(l.height||"").includes("auto")&&(l.height=void 0);let a='<video style="width:100%;height:100%"';for(const e in t)t[e]&&(a+=" "+e+'="'+t[e]+'"');this.options.pauseVideo&&(a+=" onplay=\"this.dispatchEvent(new CustomEvent('vplay',{bubbles:!0}));for(var e=document.getElementsByTagName('video'),t=0;t<e.length;t++)e[t]!=this&&e[t].pause()\""),a+=">";for(let t=0;t<e.src.length;t++)a+='<source src="'+e.src[t]+'">';a+="</video>",e.html=a}else if("ul"!==e.name&&"ol"!==e.name||!e.c)if("table"===e.name){let o=parseFloat(t.cellpadding),n=parseFloat(t.cellspacing);const i=parseFloat(t.border),s=l["border-color"],c=l["border-style"];if(e.c&&(isNaN(o)&&(o=2),isNaN(n)&&(n=2)),i&&(t.style+=`;border:${i}px ${c||"solid"} ${s||"gray"}`),e.flag&&e.c){l.display="grid","collapse"===l["border-collapse"]&&(l["border-collapse"]=void 0,n=0),n?(l["grid-gap"]=n+"px",l.padding=n+"px"):i&&(t.style+=";border-left:0;border-top:0");const r=[],d=[],u=[],m={};!function e(t){for(let a=0;a<t.length;a++)if("tr"===t[a].name)d.push(t[a]);else if("colgroup"===t[a].name){let e=1;for(const o of t[a].children||[])if("col"===o.name){const t=o.attrs.style||"",a=t.indexOf("width")?t.indexOf(";width"):0;if(-1!==a){let o=t.indexOf(";",a+6);-1===o&&(o=t.length),r[e]=t.substring(a?a+7:6,o)}e+=1}}else e(t[a].children||[])}(a);for(let e=1;e<=d.length;e++){let t=1;for(let a=0;a<d[e-1].children.length;a++){const l=d[e-1].children[a];if("td"===l.name||"th"===l.name){for(;m[e+"."+t];)t++;let a=l.attrs.style||"",d=a.indexOf("width")?a.indexOf(";width"):0;if(-1!==d){let e=a.indexOf(";",d+6);-1===e&&(e=a.length),l.attrs.colspan||(r[t]=a.substring(d?d+7:6,e)),a=a.substr(0,d)+a.substr(e)}if(a+=";display:flex",d=a.indexOf("vertical-align"),-1!==d){const e=a.substr(d+15,10);e.includes("middle")?a+=";align-items:center":e.includes("bottom")&&(a+=";align-items:flex-end")}else a+=";align-items:center";if(d=a.indexOf("text-align"),-1!==d){const e=a.substr(d+11,10);e.includes("center")?a+=";justify-content: center":e.includes("right")&&(a+=";justify-content: right")}if(a=(i?`;border:${i}px ${c||"solid"} ${s||"gray"}`+(n?"":";border-right:0;border-bottom:0"):"")+(o?`;padding:${o}px`:"")+";"+a,l.attrs.colspan&&(a+=`;grid-column-start:${t};grid-column-end:${t+parseInt(l.attrs.colspan)}`,l.attrs.rowspan||(a+=`;grid-row-start:${e};grid-row-end:${e+1}`),t+=parseInt(l.attrs.colspan)-1),l.attrs.rowspan){a+=`;grid-row-start:${e};grid-row-end:${e+parseInt(l.attrs.rowspan)}`,l.attrs.colspan||(a+=`;grid-column-start:${t};grid-column-end:${t+1}`);for(let a=1;a<l.attrs.rowspan;a++)for(let o=0;o<(l.attrs.colspan||1);o++)m[e+a+"."+(t-o)]=1}a&&(l.attrs.style=a),u.push(l),t++}}if(1===e){let e="";for(let a=1;a<t;a++)e+=(r[a]?r[a]:"auto")+" ";l["grid-template-columns"]=e}}e.children=u}else e.c&&(l.display="table"),isNaN(n)||(l["border-spacing"]=n+"px"),(i||o)&&function e(t){for(let a=0;a<t.length;a++){const n=t[a];"th"===n.name||"td"===n.name?(i&&(n.attrs.style=`border:${i}px ${c||"solid"} ${s||"gray"};${n.attrs.style||""}`),o&&(n.attrs.style=`padding:${o}px;${n.attrs.style||""}`)):n.children&&e(n.children)}}(a);if(this.options.scrollTable&&!(t.style||"").includes("inline")){const a=Object.assign({},e);e.name="div",e.attrs={style:"overflow:auto"},e.children=[a],t=a.attrs}}else if(("tbody"===e.name||"tr"===e.name)&&e.flag&&e.c)e.flag=void 0,function e(t){for(let a=0;a<t.length;a++)if("td"===t[a].name)for(const e of["color","background","background-color"])l[e]&&(t[a].attrs.style=e+":"+l[e]+";"+(t[a].attrs.style||""));else e(t[a].children||[])}(a);else if("td"!==e.name&&"th"!==e.name||!t.colspan&&!t.rowspan)if("ruby"===e.name){e.name="span";for(let e=0;e<a.length-1;e++)"text"===a[e].type&&"rt"===a[e+1].name&&(a[e]={name:"div",attrs:{style:"display:inline-block;text-align:center"},children:[{name:"div",attrs:{style:"font-size:50%;"+(a[e+1].attrs.style||"")},children:a[e+1].children},a[e]]},a.splice(e+1,1))}else e.c&&function e(t){t.c=2;for(let a=t.children.length;a--;){const o=t.children[a];o.name&&(Fe.inlineTags[o.name]||(o.attrs.style||"").includes("inline")&&o.children)&&!o.c&&e(o),o.c&&"table"!==o.name||(t.c=1)}}(e);else for(let s=this.stack.length;s--;)"table"!==this.stack[s].name&&"tbody"!==this.stack[s].name&&"tr"!==this.stack[s].name||(this.stack[s].flag=1);else{const e={a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"};e[t.type]&&(t.style+=";list-style-type:"+e[t.type],t.type=void 0);for(let t=a.length;t--;)"li"===a[t].name&&(a[t].c=1)}if((l.display||"").includes("flex")&&!e.c)for(let s=a.length;s--;){const e=a[s];e.f&&(e.attrs.style=(e.attrs.style||"")+e.f,e.f=void 0)}const i=o&&((o.attrs.style||"").includes("flex")||(o.attrs.style||"").includes("grid"))&&!e.c;i&&(e.f=";max-width:100%"),a.length>=50&&e.c&&!(l.display||"").includes("flex")&&Oe(a);for(const s in l)if(l[s]){const a=`;${s}:${l[s].replace(" !important","")}`;i&&(s.includes("flex")&&"flex-direction"!==s||"align-self"===s||s.includes("grid")||"-"===l[s][0]||s.includes("width")&&a.includes("%"))?(e.f+=a,"width"===s&&(t.style+=";width:100%")):t.style+=a}t.style=t.style.substr(1)||void 0},Ue.prototype.onText=function(e){if(!this.pre){let t,a="";for(let o=0,n=e.length;o<n;o++)qe[e[o]]?(" "!==a[a.length-1]&&(a+=" "),"\n"!==e[o]||t||(t=!0)):a+=e[o];if(" "===a){if(t)return;{const e=this.stack[this.stack.length-1];if(e&&"t"===e.name[0])return}}e=a}const t=Object.create(null);if(t.type="text",t.text=je(e),this.hook(t)){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push(t)}},He.prototype.parse=function(e){this.content=e||"",this.i=0,this.start=0,this.state=this.text;for(let t=this.content.length;-1!==this.i&&this.i<t;)this.state()},He.prototype.checkClose=function(e){const t="/"===this.content[this.i];return!!(">"===this.content[this.i]||t&&">"===this.content[this.i+1])&&(e&&this.handler[e](this.content.substring(this.start,this.i)),this.i+=t?2:1,this.start=this.i,this.handler.onOpenTag(t),"script"===this.handler.tagName?(this.i=this.content.indexOf("</",this.i),-1!==this.i&&(this.i+=2,this.start=this.i),this.state=this.endTag):this.state=this.text,!0)},He.prototype.text=function(){if(this.i=this.content.indexOf("<",this.i),-1===this.i)return void(this.start<this.content.length&&this.handler.onText(this.content.substring(this.start,this.content.length)));const e=this.content[this.i+1];if(e>="a"&&e<="z"||e>="A"&&e<="Z")this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i)),this.start=++this.i,this.state=this.tagName;else if("/"===e||"!"===e||"?"===e){this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i));const t=this.content[this.i+2];if("/"===e&&(t>="a"&&t<="z"||t>="A"&&t<="Z"))return this.i+=2,this.start=this.i,void(this.state=this.endTag);let a="--\x3e";"!"===e&&"-"===this.content[this.i+2]&&"-"===this.content[this.i+3]||(a=">"),this.i=this.content.indexOf(a,this.i),-1!==this.i&&(this.i+=a.length,this.start=this.i)}else this.i++},He.prototype.tagName=function(){if(qe[this.content[this.i]]){for(this.handler.onTagName(this.content.substring(this.start,this.i));qe[this.content[++this.i]];);this.i<this.content.length&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)}else this.checkClose("onTagName")||this.i++},He.prototype.attrName=function(){let e=this.content[this.i];if(qe[e]||"="===e){this.handler.onAttrName(this.content.substring(this.start,this.i));let t="="===e;const a=this.content.length;for(;++this.i<a;)if(e=this.content[this.i],!qe[e]){if(this.checkClose())return;if(t)return this.start=this.i,void(this.state=this.attrVal);if("="!==this.content[this.i])return this.start=this.i,void(this.state=this.attrName);t=!0}}else this.checkClose("onAttrName")||this.i++},He.prototype.attrVal=function(){const e=this.content[this.i],t=this.content.length;if('"'===e||"'"===e){if(this.start=++this.i,this.i=this.content.indexOf(e,this.i),-1===this.i)return;this.handler.onAttrVal(this.content.substring(this.start,this.i))}else for(;this.i<t;this.i++){if(qe[this.content[this.i]]){this.handler.onAttrVal(this.content.substring(this.start,this.i));break}if(this.checkClose("onAttrVal"))return}for(;qe[this.content[++this.i]];);this.i<t&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)},He.prototype.endTag=function(){const e=this.content[this.i];if(qe[e]||">"===e||"/"===e){if(this.handler.onCloseTag(this.content.substring(this.start,this.i)),">"!==e&&(this.i=this.content.indexOf(">",this.i),-1===this.i))return;this.start=++this.i,this.state=this.text}else this.i++};const Ge=[];const We=w({name:"mp-html",data:()=>({nodes:[]}),props:{containerStyle:{type:String,default:""},content:{type:String,default:""},copyLink:{type:[Boolean,String],default:!0},domain:String,errorImg:{type:String,default:""},lazyLoad:{type:[Boolean,String],default:!1},loadingImg:{type:String,default:""},pauseVideo:{type:[Boolean,String],default:!0},previewImg:{type:[Boolean,String],default:!0},scrollTable:[Boolean,String],selectable:[Boolean,String],setTitle:{type:[Boolean,String],default:!0},showImgMenu:{type:[Boolean,String],default:!0},tagStyle:Object,useAnchor:[Boolean,Number]},emits:["load","ready","imgtap","linktap","play","error"],components:{node:$e},watch:{content(e){this.setContent(e)}},created(){this.plugins=[];for(let e=Ge.length;e--;)this.plugins.push(new Ge[e](this))},mounted(){this.content&&!this.nodes.length&&this.setContent(this.content)},beforeDestroy(){this._hook("onDetached")},methods:{in(e,t,a){e&&t&&a&&(this._in={page:e,selector:t,scrollTop:a})},navigateTo(e,t){return new Promise(((a,o)=>{if(!this.useAnchor)return void o(Error("Anchor is disabled"));t=t||parseInt(this.useAnchor)||0;const n=uni.createSelectorQuery().in(this._in?this._in.page:this).select((this._in?this._in.selector:"._root")+(e?` #${e}`:"")).boundingClientRect();this._in?n.select(this._in.selector).scrollOffset().select(this._in.selector).boundingClientRect():n.selectViewport().scrollOffset(),n.exec((e=>{if(!e[0])return void o(Error("Label not found"));const n=e[1].scrollTop+e[0].top-(e[2]?e[2].top:0)+t;this._in?this._in.page[this._in.scrollTop]=n:uni.pageScrollTo({scrollTop:n,duration:300}),a()}))}))},getText(e){let t="";return function e(a){for(let o=0;o<a.length;o++){const n=a[o];if("text"===n.type)t+=n.text.replace(/&amp;/g,"&");else if("br"===n.name)t+="\n";else{const a="p"===n.name||"div"===n.name||"tr"===n.name||"li"===n.name||"h"===n.name[0]&&n.name[1]>"0"&&n.name[1]<"7";a&&t&&"\n"!==t[t.length-1]&&(t+="\n"),n.children&&e(n.children),a&&"\n"!==t[t.length-1]?t+="\n":"td"!==n.name&&"th"!==n.name||(t+="\t")}}}(e||this.nodes),t},getRect(){return new Promise(((e,t)=>{uni.createSelectorQuery().in(this).select("#_root").boundingClientRect().exec((a=>a[0]?e(a[0]):t(Error("Root label not found"))))}))},pauseMedia(){for(let t=(this._videos||[]).length;t--;)this._videos[t].pause();let e=this.$parent;for(;!e.$scope;)e=e.$parent;e.$scope.$getAppWebview().evalJS('for(var e=document.getElementsByTagName("video"),i=e.length;i--;)e[i].pause()')},setPlaybackRate(e){this.playbackRate=e;for(let o=(this._videos||[]).length;o--;)this._videos[o].playbackRate(e);const t='for(var e=document.getElementsByTagName("video"),i=e.length;i--;)e[i].playbackRate='+e;let a=this.$parent;for(;!a.$scope;)a=a.$parent;a.$scope.$getAppWebview().evalJS(t)},setContent(e,t){t&&this.imgList||(this.imgList=[]);const a=new Ue(this).parse(e);if(this.$set(this,"nodes",t?(this.nodes||[]).concat(a):a),this._videos=[],this.$nextTick((()=>{this._hook("onLoad"),this.$emit("load")})),this.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){let e=0;const t=a=>{a&&a.height||(a={}),a.height===e?this.$emit("ready",a):(e=a.height,setTimeout((()=>{this.getRect().then(t).catch(t)}),350))};this.getRect().then(t).catch(t)}else this.imgList._unloadimgs||this.getRect().then((e=>{this.$emit("ready",e)})).catch((()=>{this.$emit("ready",{})}))},_hook(e){for(let t=Ge.length;t--;)this.plugins[t][e]&&this.plugins[t][e]()}}},[["render",function(t,a,o,n,l,i){const s=e.resolveComponent("node");return e.openBlock(),e.createElementBlock("view",{id:"_root",class:e.normalizeClass((o.selectable?"_select ":"")+"_root"),style:e.normalizeStyle(o.containerStyle)},[l.nodes[0]?(e.openBlock(),e.createBlock(s,{key:1,childs:l.nodes,opts:[o.lazyLoad,o.loadingImg,o.errorImg,o.showImgMenu,o.selectable],name:"span"},null,8,["childs","opts"])):e.renderSlot(t.$slots,"default",{key:0},void 0,!0)],6)}],["__scopeId","data-v-864c11a0"]]),Ye=w({__name:"article_detail",setup(t){const o=e.ref({title:"",content:"",banner:"",created_at:0});e.ref(1),e.ref(!1),e.ref(!1),e.ref(null);const n=e.ref(null),i=e.ref(null),s=e.ref({}),c=async({content:e,replyInfo:t,origin:a})=>{var l,i;if(!(await p(!0)))return;const s={content:e,origin:a,target_id:parseInt(o.value.id),type:7,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};try{const{data:e}=await uni.request({url:`${d}/with-state/add-comment`,method:"POST",header:{Authorization:uni.getStorageSync("token")},data:s});"success"===e.status&&(0===e.data.parent_id?null==(l=n.value)||l.addNewComment(e.data):null==(i=n.value)||i.addReplyComment(e.data),uni.showToast({title:"评论成功"}))}catch(c){uni.showToast({title:"评论失败",icon:"none"})}},r=({parent:e,target:t})=>{var a;const o=t||e;s.value=o,null==(a=i.value)||a.focusInput()};l((async e=>{if(!e.id)return uni.navigateBack();h(),await u(e.id)}));const u=async e=>{try{const{data:t}=await uni.request({url:`${d}/article-detail?id=${e}`});"success"===t.status&&(o.value=t.data,uni.setNavigationBarTitle({title:t.data.title}))}catch(t){uni.showToast({title:"加载失败",icon:"none"})}},p=async(e=!1)=>!!m.isLogin||(e&&uni.showToast({title:"请先登录",icon:"none"}),!1);return(t,l)=>{const d=a(e.resolveDynamicComponent("mp-html"),We),u=a(e.resolveDynamicComponent("comment-list"),P),m=a(e.resolveDynamicComponent("comment-input"),R);return e.openBlock(),e.createElementBlock("view",{class:"article-container"},[o.value.banner?(e.openBlock(),e.createElementBlock("image",{key:0,src:o.value.banner,mode:"widthFix",class:"banner"},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(o.value.title),1),e.createVNode(d,{content:o.value.content,class:"content-html"},null,8,["content"]),o.value.id>0?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",null,[e.createVNode(u,{ref_key:"commentListRef",ref:n,type:7,"relation-id":parseInt(o.value.id),onReply:r},null,8,["relation-id"])]),e.createVNode(m,{ref_key:"commentInputRef",ref:i,"reply-info":s.value,"target-id":o.value.id.toString(),onSubmit:c,"onUpdate:replyInfo":l[0]||(l[0]=e=>s.value=e)},null,8,["reply-info","target-id"])])):e.createCommentVNode("",!0)])])}}},[["__scopeId","data-v-6b25dede"]]);__definePage("pages/index/index",x),__definePage("pages/homepage/homepage",C),__definePage("pages/stock/stock",z),__definePage("pages/mine/mine",$),__definePage("pages/watch_demo/watch_demo",F),__definePage("pages/goods/goods",M),__definePage("pages/brand/brand",j),__definePage("pages/calendar/calendar",O),__definePage("pages/pop_croper/pop_croper",Q),__definePage("pages/setting/setting",X),__definePage("pages/setting/password/password",J),__definePage("pages/setting/tel_phone/tel_phone",Z),__definePage("pages/stock/account_book_form/account_book_form",ne),__definePage("pages/stock/showcase_form/showcase_form",re),__definePage("pages/stock/bill_form/bill_form",de),__definePage("pages/collocation/collocation",ue),__definePage("pages/collocation_share/collocation_share",me),__definePage("pages/user_page/user_page",pe),__definePage("pages/message_list/message_list",ke),__definePage("pages/message_info/message_info",_e),__definePage("pages/register/register",Ee),__definePage("pages/user_like/user_like",Ne),__definePage("pages/collocation_square/collocation_square",Ve),__definePage("pages/sale_news/sale_news",be),__definePage("pages/treehole_publish/treehole_publish",xe),__definePage("pages/treehole_detail/treehole_detail",Be),__definePage("pages/reset_password/reset_password",Se),__definePage("pages/setting/username/username",Ce),__definePage("pages/my_comment/my_comment",Te),__definePage("pages/my_collocation/my_collocation",De),__definePage("pages/article_detail/article_detail",Ye);const Qe={__name:"App",setup:e=>()=>{}};uni.loadFontFace({family:"alimamamshuhei",source:'url("https://images1.fantuanpu.com/font/AlimamaShuHeiTi-Bold.ttf")',success(){t("log","at main.js:21","load font success")},fail(e){t("log","at main.js:24","load font fail",e)}});const{app:Xe,Vuex:Je,Pinia:Ze}={app:e.createVueApp(Qe)};uni.Vuex=Je,uni.Pinia=Ze,Xe.provide("__globalStyles",__uniConfig.styles),Xe._component.mpType="app",Xe._component.render=()=>{},Xe.mount("#app")}(Vue);
