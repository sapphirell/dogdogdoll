if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a(e,t){return"string"==typeof e?t:e}const o=(t,a=0)=>(a,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,o)},n=o("onShow",3),l=o("onHide",3),s=o("onLaunch",1),i=o("onLoad",2),r=o("onReachBottom",2),c=o("onPullDownRefresh",2),u=e.ref("https://api.fantuanpu.com"),d="https://api.fantuanpu.com",m="https://images1.fantuanpu.com/",p="1.1.2";let h=e.reactive({isLogin:!1,userInfo:{}});function g(){uni.showToast({title:"请在微信小程序中登录",icon:"none"})}function v(){const e=uni.getStorageSync("token");if(t("log","at common/config.js:174","token:",e),!e)return t("log","at common/config.js:176","没有token，无法获取用户信息"),void _();t("log","at common/config.js:180","请求接口"),uni.request({url:`${u.value}/with-state/mine`,method:"GET",header:{Authorization:e},success:e=>{const a=e.data.data;a?(t("log","at common/config.js:190","获取用户信息成功,进行存储",a),w(a)):(t("log","at common/config.js:193","无法获取，清理用户状态"),_())},fail:e=>{k(e,"获取用户信息失败")}})}function f(){return new Promise(((e,a)=>{const o=uni.getStorageSync("token");if(!o)return _(),void e(null);uni.request({url:`${u.value}/with-state/mine`,method:"GET",header:{Authorization:o},success:a=>{const o=a.data.data;return o?(t("log","at common/config.js:224","返回：",o),w(o),e(o)):(_(),e(null)),o},fail:t=>{k(t,"获取用户信息失败"),e(null)}})}))}function y(){t("log","at common/config.js:297","platform:","app");{const e=uni.getSystemInfoSync();if("ios"===e.osName)return 2;if("android"===e.osName)return 3}return 1}function w(e){uni.setStorageSync("userInfo",e),uni.setStorageSync("token",e.last_token),h.userInfo=e,h.isLogin=!0}function _(){uni.removeStorageSync("userInfo"),h.userInfo={},h.isLogin=!1}function k(e,a="请求失败"){t("error","at common/config.js:394",e),uni.showToast({title:a,icon:"none"})}const E={__name:"view-logs",setup(a){const o=()=>{let e=uni.getStorageSync("ft_uvid");return e||(e=Math.floor(2147483647*Math.random())+1,uni.setStorageSync("ft_uvid",e)),e},n=()=>{const e=getCurrentPages();return 0===e.length?"":e[e.length-1].route||""};return e.onMounted((()=>{(async()=>{let e=uni.getStorageSync("userInfo");const a={scene:y(),path:n(),uid:e?e.id:0,uvid:o(),version:p};if(t("log","at components/view-logs/view-logs.vue:40","logData:",a),a.path)try{await uni.request({url:`${u.value}/log/view`,method:"POST",data:a,header:{"content-type":"application/json"}})}catch(l){t("error","at components/view-logs/view-logs.vue:58","日志发送错误:",l)}else t("warn","at components/view-logs/view-logs.vue:44","无法获取当前页面路径")})()})),(e,t)=>null}},N=[{font_class:"arrow-down",unicode:""},{font_class:"arrow-left",unicode:""},{font_class:"arrow-right",unicode:""},{font_class:"arrow-up",unicode:""},{font_class:"auth",unicode:""},{font_class:"auth-filled",unicode:""},{font_class:"back",unicode:""},{font_class:"bars",unicode:""},{font_class:"calendar",unicode:""},{font_class:"calendar-filled",unicode:""},{font_class:"camera",unicode:""},{font_class:"camera-filled",unicode:""},{font_class:"cart",unicode:""},{font_class:"cart-filled",unicode:""},{font_class:"chat",unicode:""},{font_class:"chat-filled",unicode:""},{font_class:"chatboxes",unicode:""},{font_class:"chatboxes-filled",unicode:""},{font_class:"chatbubble",unicode:""},{font_class:"chatbubble-filled",unicode:""},{font_class:"checkbox",unicode:""},{font_class:"checkbox-filled",unicode:""},{font_class:"checkmarkempty",unicode:""},{font_class:"circle",unicode:""},{font_class:"circle-filled",unicode:""},{font_class:"clear",unicode:""},{font_class:"close",unicode:""},{font_class:"closeempty",unicode:""},{font_class:"cloud-download",unicode:""},{font_class:"cloud-download-filled",unicode:""},{font_class:"cloud-upload",unicode:""},{font_class:"cloud-upload-filled",unicode:""},{font_class:"color",unicode:""},{font_class:"color-filled",unicode:""},{font_class:"compose",unicode:""},{font_class:"contact",unicode:""},{font_class:"contact-filled",unicode:""},{font_class:"down",unicode:""},{font_class:"bottom",unicode:""},{font_class:"download",unicode:""},{font_class:"download-filled",unicode:""},{font_class:"email",unicode:""},{font_class:"email-filled",unicode:""},{font_class:"eye",unicode:""},{font_class:"eye-filled",unicode:""},{font_class:"eye-slash",unicode:""},{font_class:"eye-slash-filled",unicode:""},{font_class:"fire",unicode:""},{font_class:"fire-filled",unicode:""},{font_class:"flag",unicode:""},{font_class:"flag-filled",unicode:""},{font_class:"folder-add",unicode:""},{font_class:"folder-add-filled",unicode:""},{font_class:"font",unicode:""},{font_class:"forward",unicode:""},{font_class:"gear",unicode:""},{font_class:"gear-filled",unicode:""},{font_class:"gift",unicode:""},{font_class:"gift-filled",unicode:""},{font_class:"hand-down",unicode:""},{font_class:"hand-down-filled",unicode:""},{font_class:"hand-up",unicode:""},{font_class:"hand-up-filled",unicode:""},{font_class:"headphones",unicode:""},{font_class:"heart",unicode:""},{font_class:"heart-filled",unicode:""},{font_class:"help",unicode:""},{font_class:"help-filled",unicode:""},{font_class:"home",unicode:""},{font_class:"home-filled",unicode:""},{font_class:"image",unicode:""},{font_class:"image-filled",unicode:""},{font_class:"images",unicode:""},{font_class:"images-filled",unicode:""},{font_class:"info",unicode:""},{font_class:"info-filled",unicode:""},{font_class:"left",unicode:""},{font_class:"link",unicode:""},{font_class:"list",unicode:""},{font_class:"location",unicode:""},{font_class:"location-filled",unicode:""},{font_class:"locked",unicode:""},{font_class:"locked-filled",unicode:""},{font_class:"loop",unicode:""},{font_class:"mail-open",unicode:""},{font_class:"mail-open-filled",unicode:""},{font_class:"map",unicode:""},{font_class:"map-filled",unicode:""},{font_class:"map-pin",unicode:""},{font_class:"map-pin-ellipse",unicode:""},{font_class:"medal",unicode:""},{font_class:"medal-filled",unicode:""},{font_class:"mic",unicode:""},{font_class:"mic-filled",unicode:""},{font_class:"micoff",unicode:""},{font_class:"micoff-filled",unicode:""},{font_class:"minus",unicode:""},{font_class:"minus-filled",unicode:""},{font_class:"more",unicode:""},{font_class:"more-filled",unicode:""},{font_class:"navigate",unicode:""},{font_class:"navigate-filled",unicode:""},{font_class:"notification",unicode:""},{font_class:"notification-filled",unicode:""},{font_class:"paperclip",unicode:""},{font_class:"paperplane",unicode:""},{font_class:"paperplane-filled",unicode:""},{font_class:"person",unicode:""},{font_class:"person-filled",unicode:""},{font_class:"personadd",unicode:""},{font_class:"personadd-filled",unicode:""},{font_class:"personadd-filled-copy",unicode:""},{font_class:"phone",unicode:""},{font_class:"phone-filled",unicode:""},{font_class:"plus",unicode:""},{font_class:"plus-filled",unicode:""},{font_class:"plusempty",unicode:""},{font_class:"pulldown",unicode:""},{font_class:"pyq",unicode:""},{font_class:"qq",unicode:""},{font_class:"redo",unicode:""},{font_class:"redo-filled",unicode:""},{font_class:"refresh",unicode:""},{font_class:"refresh-filled",unicode:""},{font_class:"refreshempty",unicode:""},{font_class:"reload",unicode:""},{font_class:"right",unicode:""},{font_class:"scan",unicode:""},{font_class:"search",unicode:""},{font_class:"settings",unicode:""},{font_class:"settings-filled",unicode:""},{font_class:"shop",unicode:""},{font_class:"shop-filled",unicode:""},{font_class:"smallcircle",unicode:""},{font_class:"smallcircle-filled",unicode:""},{font_class:"sound",unicode:""},{font_class:"sound-filled",unicode:""},{font_class:"spinner-cycle",unicode:""},{font_class:"staff",unicode:""},{font_class:"staff-filled",unicode:""},{font_class:"star",unicode:""},{font_class:"star-filled",unicode:""},{font_class:"starhalf",unicode:""},{font_class:"trash",unicode:""},{font_class:"trash-filled",unicode:""},{font_class:"tune",unicode:""},{font_class:"tune-filled",unicode:""},{font_class:"undo",unicode:""},{font_class:"undo-filled",unicode:""},{font_class:"up",unicode:""},{font_class:"top",unicode:""},{font_class:"upload",unicode:""},{font_class:"upload-filled",unicode:""},{font_class:"videocam",unicode:""},{font_class:"videocam-filled",unicode:""},{font_class:"vip",unicode:""},{font_class:"vip-filled",unicode:""},{font_class:"wallet",unicode:""},{font_class:"wallet-filled",unicode:""},{font_class:"weibo",unicode:""},{font_class:"weixin",unicode:""}],V=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a};const b=V({name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:N}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(){this.$emit("click")}}},[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(s.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+o.type,o.customPrefix,o.customPrefix?o.type:""]]),onClick:a[0]||(a[0]=(...e)=>s._onClick&&s._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-1320ff52"]]);class x{constructor(e,t){this.options=e,this.animation=uni.createAnimation({...e}),this.currentStepAnimates={},this.next=0,this.$=t}_nvuePushAnimates(e,t){let a=this.currentStepAnimates[this.next],o={};if(o=a||{styles:{},config:{}},S.includes(e)){o.styles.transform||(o.styles.transform="");let a="";"rotate"===e&&(a="deg"),o.styles.transform+=`${e}(${t+a}) `}else o.styles[e]=`${t}`;this.currentStepAnimates[this.next]=o}_animateRun(e={},t={}){let a=this.$.$refs.ani.ref;if(a)return new Promise(((o,n)=>{nvueAnimation.transition(a,{styles:e,...t},(e=>{o()}))}))}_nvueNextAnimate(e,t=0,a){let o=e[t];if(o){let{styles:n,config:l}=o;this._animateRun(n,l).then((()=>{t+=1,this._nvueNextAnimate(e,t,a)}))}else this.currentStepAnimates={},"function"==typeof a&&a(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const S=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function C(e,t){if(t)return clearTimeout(t.timer),new x(e,t)}S.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{x.prototype[e]=function(...t){return this.animation[e](...t),this}}));const B=V({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:0,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let e={...this.styles,"transition-duration":this.duration/1e3+"s"},t="";for(let a in e){t+=this.toLine(a)+":"+e[a]+";"}return t},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=C(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,t={}){return this.animation?(Object.keys(e).forEach((t=>{const a=e[t];"function"==typeof this.animation[t]&&(Array.isArray(a)?this.animation[t](...a):this.animation[t](a))})),this.animation.step(t),this):this},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.isShow=!0,this.transform=this.styleInit(!1).transform||"",this.opacity=this.styleInit(!1).opacity||0,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=C(this.config,this),this.tranfromInit(!1).step(),this.animation.run((()=>{this.transform="",this.opacity=this.styleInit(!1).opacity||1,this.$emit("change",{detail:this.isShow})}))}),80)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:"",opacity:1};const a=(e,a)=>{const o=this.animationType(e)[a];a.startsWith("fade")?t.opacity=o:t.transform+=o+" "};return"string"==typeof this.modeClass?a(e,this.modeClass):this.modeClass.forEach((t=>a(e,t))),t},tranfromInit(e){let t=(e,t)=>{let a=null;"fade"===t?a=e?0:1:(a=e?"-100%":"0","zoom-in"===t&&(a=e?.8:1),"zoom-out"===t&&(a=e?1.2:1),"slide-right"===t&&(a=e?"100%":"0"),"slide-bottom"===t&&(a=e?"100%":"0")),this.animation[this.animationMode()[t]](a)};return"string"==typeof this.modeClass?t(e,this.modeClass):this.modeClass.forEach((a=>{t(e,a)})),this.animation},animationType:e=>({fade:e?1:0,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,a,o,n,l,s){return e.withDirectives((e.openBlock(),e.createElementBlock("view",{ref:"ani",animation:l.animationData,class:e.normalizeClass(o.customClass),style:e.normalizeStyle(s.transformStyles),onClick:a[0]||(a[0]=(...e)=>s.onClick&&s.onClick(...e))},[e.renderSlot(t.$slots,"default")],14,["animation"])),[[e.vShow,l.isShow]])}]]),T=V({__name:"common-modal",props:{visible:Boolean,top:{type:[String,Number],default:"30%"},width:{type:[String,Number],default:"80%"},height:{type:[String,Number],default:"auto"},closeable:{type:Boolean,default:!0}},emits:["update:visible"],setup(t,{emit:o}){const n=e.ref(!1),l=t;let s=e.ref(["fade","zoom-in"]);const i=o,r=e.computed((()=>({backgroundColor:n.value?"rgba(0, 0, 0, 0)":"rgba(0, 0, 0, 0.5)"}))),c=e.computed((()=>({top:d(l.top),height:d(l.height)}))),u=()=>!1,d=e=>"number"==typeof e||/\d$/.test(e)?`${e}px`:e,m=()=>{l.closeable&&i("update:visible",!1)};return e.onMounted((()=>{const e=y();n.value=2===e||3===e})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-transition"),B);return t.visible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask",onClick:e.withModifiers(m,["stop"]),onTouchmove:e.withModifiers(u,["stop","prevent"]),style:e.normalizeStyle(r.value)},[e.createVNode(l,{"mode-class":e.unref(s),show:t.visible},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"modal-container",style:e.normalizeStyle(c.value),onClick:n[0]||(n[0]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-content"},[e.renderSlot(o.$slots,"default",{},void 0,!0)])],4)])),_:3},8,["mode-class","show"])],36)):e.createCommentVNode("",!0)}}},[["__scopeId","data-v-8ac040e3"]]),D="/static/new-icon/write.gif",I="privacyAgreementStatus",z=V({__name:"privacy-permission-modal",setup(o){const n=e.ref(!1),l=()=>{if((()=>{let e=uni.getStorageSync(I);return t("log","at components/privacy-permission-modal/privacy-permission-modal.vue:53",e),"agreed"===e})())return void t("log","at components/privacy-permission-modal/privacy-permission-modal.vue:60","用户已经同意过隐私政策");const e=y();2===e||3===e?setTimeout((()=>{n.value=!0}),1e3):t("log","at components/privacy-permission-modal/privacy-permission-modal.vue:65","并非安卓或iOS客户端：",e)},s=()=>{uni.navigateTo({url:"/pages/private/private"})},i=()=>{uni.navigateTo({url:"/pages/permission/permission"})},r=()=>{uni.setStorageSync(I,"agreed"),n.value=!1},c=()=>{uni.exitApp()};return e.onMounted((()=>{l()})),(t,o)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createBlock(u,{visible:n.value,"onUpdate:visible":o[0]||(o[0]=e=>n.value=e),top:"20vh",height:"auto",closeable:!1},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"privacy-container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("image",{src:D,class:"logo"}),e.createElementVNode("text",{class:"title"},"隐私与权限说明")]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("text",{class:"desc"},"欢迎使用我们的应用，为了提供更好的服务，我们需要获取相关权限并说明隐私政策："),e.createElementVNode("view",{class:"policy-item",onClick:s},[e.createVNode(l,{type:"info",size:"18",color:"#80afff"}),e.createElementVNode("text",{class:"policy-text"},"《隐私政策》"),e.createVNode(l,{type:"arrowright",size:"16",color:"#999"})]),e.createElementVNode("view",{class:"policy-item",onClick:i},[e.createVNode(l,{type:"locked",size:"18",color:"#80afff"}),e.createElementVNode("text",{class:"policy-text"},"《权限说明》"),e.createVNode(l,{type:"arrowright",size:"16",color:"#999"})])]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("button",{class:"btn refuse",onClick:c},"拒绝并退出"),e.createElementVNode("button",{class:"btn agree",onClick:r},"同意并继续")])])])),_:1},8,["visible"])}}},[["__scopeId","data-v-3bfa10d5"]]),A=V({__name:"version-check",props:{showUpToDateToast:{type:Boolean,default:!1},currentVersion:{type:String,required:!1},autoCheck:{type:Boolean,default:!0}},setup(o,{expose:n}){const l=o,s=e.ref(!1),i=e.ref(null),r=e.ref(!1),c=e.ref("1.0.0"),d=e.computed((()=>uni.getSystemInfoSync().platform||"unknown")),m=e=>{if(!e)return"未知日期";const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},h=async()=>{try{let e=y();if(1===e||4===e)return void t("log","at components/version-check/version-check.vue:103","不检查版本原因scene:",e);if((()=>{const e=uni.getStorageSync("ignoreUpdateTime");if(t("log","at components/version-check/version-check.vue:88","忽略时间：",e),!e)return!1;const a=Date.now();return t("log","at components/version-check/version-check.vue:93","当前时间",a),a-e<2592e5})())return void t("log","at components/version-check/version-check.vue:108","在忽略期内，不显示更新提示 ");uni.getAppBaseInfo().appVersion;const a=await uni.request({url:`${u.value}/latest-version?version=1.1.2`,method:"GET"});a&&a.data&&(t("log","at components/version-check/version-check.vue:118",`${u.value}/latest-version?version=1.1.2`),t("log","at components/version-check/version-check.vue:119",a.data),"success"===a.data.status&&a.data.data?(i.value=a.data.data,s.value=!0):"failed"===a.data.status&&l.showUpToDateToast&&(r.value=!0,setTimeout((()=>{r.value=!1}),2e3)))}catch(e){t("error","at components/version-check/version-check.vue:133","版本检查失败:",e)}},g=()=>{uni.setStorageSync("ignoreUpdateTime",Date.now()),s.value=!1;t("log","at components/version-check/version-check.vue:146",d.value.toLowerCase());let e=y();2===e?plus.runtime.openURL("https://apps.apple.com/app/id6747564362"):3===e?plus.runtime.openURL("https://www.dogdogdoll.com/"):uni.showModal({title:"更新提示",content:"请前往应用商店更新最新版本",showCancel:!1})},v=()=>{uni.setStorageSync("ignoreUpdateTime",Date.now()),s.value=!1};return n({checkVersion:h}),e.onMounted((()=>{c.value=uni.getAppBaseInfo().appVersion,l.autoCheck&&setTimeout((()=>{h()}),1500)})),(t,o)=>{const n=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(n,{visible:s.value,"onUpdate:visible":o[0]||(o[0]=e=>s.value=e),top:"15vh"},{default:e.withCtx((()=>{var t,a,o;return[e.createElementVNode("view",{class:"version-update-container"},[e.createElementVNode("view",{class:"update-title"},"发现新版本 v"+e.toDisplayString(null==(t=i.value)?void 0:t.version)+" 当前 v"+e.toDisplayString(e.unref(p)),1),e.createElementVNode("scroll-view",{class:"update-content","scroll-y":""},[e.createElementVNode("view",{class:"update-section"},[e.createElementVNode("view",{class:"section-title"},"更新内容"),e.createElementVNode("view",{class:"section-content"},e.toDisplayString((null==(a=i.value)?void 0:a.note)||"优化用户体验，修复已知问题"),1)]),e.createElementVNode("view",{class:"update-section"},[e.createElementVNode("view",{class:"section-title"},"更新日期"),e.createElementVNode("view",{class:"section-content"},e.toDisplayString(m(null==(o=i.value)?void 0:o.created_at)),1)])]),e.createElementVNode("view",{class:"update-buttons"},[e.createElementVNode("button",{class:"update-btn ignore",onClick:v},"暂不更新"),e.createElementVNode("button",{class:"update-btn confirm",onClick:g},"立即更新")])])]})),_:1},8,["visible"]),r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"toast-message"},[e.createElementVNode("text",null,"已是最新版本")])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-225b8ebb"]]),P=V({__name:"loading-toast",props:{show:{type:Boolean,default:!1},text:{type:String,default:"To Connect The Love..."}},setup(t){const a=t;return(o,n)=>a.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createElementVNode("view",{class:"loading-mask"}),e.createElementVNode("view",{class:"loading-content"},[e.createElementVNode("image",{class:"loading-gif",src:"/static/loading.gif",mode:"aspectFit"}),t.text?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},e.toDisplayString(t.text),1)):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)}},[["__scopeId","data-v-841ed311"]]),L=V({__name:"server-selector",emits:["server-change"],setup(t,{emit:o}){const n=e.reactive([{name:"中国",url:d,ping:-1},{name:"美国",url:"https://us-api.dogdogdoll.com",ping:-1},{name:"Localhost",url:"http://localhost:8080",ping:-1}]),l=e.ref(!1),s=e.ref(""),i=e.ref(-1);let r=null;const c=o;e.onMounted((()=>{const e=uni.getStorageSync("selectedServer");s.value=e||d,u.value=s.value,p(),m()})),e.onUnmounted((()=>{clearInterval(r)}));const m=()=>{r=setInterval((()=>{p()}),5e3)},p=async()=>{try{const e=Date.now();await g(s.value),i.value=Date.now()-e}catch(e){i.value=-2}};e.watch(l,(e=>{e&&h()}));const h=async()=>{for(const t of n){t.ping=-1;try{const e=Date.now();await g(t.url),t.ping=Date.now()-e,t.url===s.value&&(i.value=t.ping)}catch(e){t.ping=-2,t.url===s.value&&(i.value=-2)}}},g=e=>new Promise(((t,a)=>{uni.request({url:`${e}/ping`,method:"GET",timeout:5e3,success:()=>t(),fail:()=>a()})}));return(t,o)=>{const r=a(e.resolveDynamicComponent("uni-icons"),b),d=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"server-selector-trigger",onClick:o[0]||(o[0]=e=>l.value=!0)},[e.createVNode(r,{type:"paperplane",size:"24",color:"#5db7ff"}),e.createElementVNode("text",null,e.toDisplayString(i.value>=0?i.value+"ms":"9999ms"),1)]),e.createVNode(d,{visible:l.value,"onUpdate:visible":o[1]||(o[1]=e=>l.value=e),top:"15vh"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"server-modal-content"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"title"},"选择服务器"),e.createElementVNode("text",{class:"subtitle"},"点击服务器可切换，当前延迟："+e.toDisplayString(i.value>=0?i.value+"ms":"-1ms"),1)]),e.createElementVNode("view",{class:"server-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["server-item",{active:t.url===s.value,loading:-1===t.ping}]),onClick:e=>(e=>{-2!==e.ping?(s.value=e.url,u.value=e.url,uni.setStorageSync("selectedServer",e.url),i.value=e.ping,uni.showToast({title:`已切换到${e.name}`,icon:"success"}),l.value=!1,c("server-change",{server:e,ping:e.ping})):uni.showToast({title:"服务器连接失败，无法选择",icon:"none"})})(t)},[e.createElementVNode("view",{class:"server-info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1)]),e.createElementVNode("view",{class:"ping-info"},[-1===t.ping?(e.openBlock(),e.createBlock(r,{key:0,type:"spinner-cycle",size:"16",color:"#999",class:"spinner"})):-2===t.ping?(e.openBlock(),e.createElementBlock("text",{key:1,class:"ping-error"},"请求失败")):(e.openBlock(),e.createElementBlock("text",{key:2,class:"ping-value"},e.toDisplayString(t.ping)+" ms",1))])],10,["onClick"])))),128))])])])),_:1},8,["visible"])],64)}}},[["__scopeId","data-v-52c75c06"]]),$="/static/search.png",F="/static/cancel.png",M={__name:"goods-search",props:{modelValue:{type:String,default:""},width:{type:String,default:"100%"},background:{type:String,default:""},fontSize:{type:String,default:""},tagColor:{type:String,default:"#666"},mode:{type:String,default:"jump",validator:e=>["jump","fill"].includes(e)},hiddenIcon:{type:Boolean,default:!0},brandId:{type:Number,default:0}},emits:["select","update:modelValue"],setup(a,{emit:o}){const n=e.ref(!1),l=a,s=o,i=e.ref([]),r=e.computed({get:()=>l.modelValue,set:e=>s("update:modelValue",e)});e.watch(i,(e=>{n.value=e.length>0}));const c=()=>{i.value=[],n.value=!1},d=async e=>{var a;r.value=e.detail.value;const o=e.detail.value.trim();if(n.value=!0,!o)return void(i.value=[]);let s=`${u.value}/search-goods?search=${encodeURIComponent(o)}`;l.brandId&&0!==l.brandId&&(s+=`&brand_id=${l.brandId}`);try{const e=await uni.request({url:s,method:"GET"});i.value="success"===(null==(a=e.data)?void 0:a.status)&&e.data.data||[]}catch(c){t("error","at components/goods-search/goods-search.vue:120","搜索失败:",c),i.value=[]}},m=()=>{c()};return(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"mask-layer",onClick:c})):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["search_tab",t.$attrs.class]),style:e.normalizeStyle({background:a.background||"#fff"})},[a.hiddenIcon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("image",{key:0,class:"icon_image",src:$})),e.createElementVNode("input",{class:"common_search_input",placeholder:"请输入娃物名称 (ㅇㅅㅇ❀)...",value:r.value,onInput:d,style:e.normalizeStyle({fontSize:a.fontSize||"23rpx"})},null,44,["value"]),i.value.length>0?(e.openBlock(),e.createElementBlock("image",{key:1,class:"icon_image",src:F,onClick:m})):e.createCommentVNode("",!0)],6),i.value.length>0?(e.openBlock(),e.createElementBlock("scroll-view",{key:1,class:"search_results",style:e.normalizeStyle({width:a.width}),"scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"result_item",onClick:e=>{return a=t,"jump"===l.mode&&uni.navigateTo({url:`/pages/goods/goods?goods_id=${a.id}`}),"fill"===l.mode&&(s("select",a),r.value=a.name,i.value=[]),void c();var a}},[t.brand_name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"brand-tag"},e.toDisplayString(t.brand_name),1)):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))],4)):e.createCommentVNode("",!0)],64))}},R=V(M,[["__scopeId","data-v-d809de82"]]),O=Object.assign({inheritAttrs:!1},{__name:"common-search",props:{mode:{type:String,default:"jump",validator:e=>["jump","fill"].includes(e)},width:{type:String,default:"100%"},background:{type:String,default:""},fontSize:{type:String,default:""},hiddenIcon:{type:Boolean,default:!1},showIndexSelector:{type:Boolean,default:!1},indexOptions:{type:Array,default:()=>[{label:"店铺",value:""},{label:"妆师",value:"bjd_artist"},{label:"毛娘",value:"hairstylist"}]},defaultIndex:{type:String,default:""}},emits:["select","close-associate","index-change"],setup(a,{emit:o}){var n;const l=a,s=o,i=e.ref(""),r=e.ref([]),c=e.ref(l.defaultIndex||(null==(n=l.indexOptions[0])?void 0:n.value)||""),d=e.computed((()=>{const e=l.indexOptions.find((e=>e.value===c.value));return e?e.label:"选择类型"})),m=e.computed((()=>l.indexOptions.map((e=>e.label)))),p=e.computed((()=>l.indexOptions.findIndex((e=>e.value===c.value)))),h=()=>{t("log","at components/common-search/common-search.vue:123","开始通知",i.value),r.value=[],s("close-associate",i.value)},g=e=>{var t;const a=e.detail.value;c.value=(null==(t=l.indexOptions[a])?void 0:t.value)||"",s("index-change",c.value),""!==i.value.trim()&&v()},v=async()=>{if(""===i.value.trim())return void(r.value=[]);s("select",0,i.value);let e=`${u.value}/search-brand?search=${encodeURIComponent(i.value)}`;c.value&&(e+=`&index=${c.value}`);try{const a=await uni.request({url:e,method:"GET",header:{"Content-Type":"application/json"}});return t("log","at components/common-search/common-search.vue:165","请求结果:",a.data),"success"==a.data.status?null==a.data.data?void(r.value=[]):void(r.value=a.data.data):void(r.value=[])}catch(a){return t("error","at components/common-search/common-search.vue:180","请求错误:",a),void(r.value=[])}};function f(){i.value="",r.value=[]}return(t,o)=>(e.openBlock(),e.createElementBlock("view",{style:{width:"100%"}},[e.createElementVNode("view",{class:e.normalizeClass(["search_tab",t.$attrs.class]),style:e.normalizeStyle({background:a.background||"#fff"})},[l.hiddenIcon||"jump"!=l.mode?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("image",{key:0,class:"icon_image",src:$})),a.showIndexSelector?(e.openBlock(),e.createElementBlock("view",{key:1,class:"index-selector"},[e.createElementVNode("picker",{mode:"selector",value:p.value,range:m.value,onChange:g},[e.createElementVNode("view",{class:"selector-content"},[e.createElementVNode("text",null,e.toDisplayString(d.value),1)])],40,["value","range"])])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",{class:"common_search_input",placeholder:"可以模糊搜索 o( ❛ᴗ❛ )o …","onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),onInput:v,ignoreCompositionEvent:!1},null,544),[[e.vModelText,i.value]]),r.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"search-info-tap"},[r.value.length>0&&i.value.length<5?(e.openBlock(),e.createElementBlock("text",{key:0},"拼音、缩写、别名都可以搜")):e.createCommentVNode("",!0),e.createElementVNode("image",{class:"icon_image",src:F,onClick:f})])):e.createCommentVNode("",!0)],6),e.createElementVNode("view",{style:{position:"relative"}},[r.value.length>0?(e.openBlock(),e.createElementBlock("scroll-view",{key:0,class:"search_results",style:e.normalizeStyle([{height:"600rpx"},{width:a.width}]),"scroll-y":""},[e.createElementVNode("view",{class:"close-associate result_item",onClick:h,style:{"padding-top":"0","text-align":"center"}},[e.createElementVNode("text",null,"关闭联想")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"result_item",onClick:e=>{return a=t.id,o=t.name,void("jump"===l.mode?uni.navigateTo({url:`/pages/brand/brand?brand_id=${a}`}):"fill"===l.mode&&(i.value=o,r.value=[],s("select",a,o)));var a,o}},e.toDisplayString(t.name),9,["onClick"])))),128))],4)):e.createCommentVNode("",!0)])]))}}),q=V(O,[["__scopeId","data-v-77f1c13f"]]),U=V({__name:"switch-search",props:{mode:{type:String,default:"jump",validator:e=>["jump","fill"].includes(e)},width:{type:String,default:"100%"},background:{type:String,default:"#fff"},fontSize:{type:String,default:"28rpx"}},emits:["submit"],setup(t,{emit:o}){e.useCssVars((e=>({"24e754f2":p.width})));const n=e.ref("goods"),l=e.ref([]),s=e.ref([]),i=e.ref(null),r=e.ref(null),c=e.computed((()=>"goods"===n.value&&l.value.length>0||"brand"===n.value&&s.value.length>0)),u=()=>{"goods"===n.value?l.value=[]:s.value=[],n.value="goods"===n.value?"brand":"goods"},d=e=>{l.value=e?[e]:[],e&&g("submit",{type:"goods",data:e})},m=(e,t)=>{0===e?s.value=[]:(s.value=[{id:e,name:t}],g("submit",{type:"brand",data:{id:e,name:t}}))},p=t,h=e.computed((()=>"700rpx")),g=o;return(o,g)=>{const v=a(e.resolveDynamicComponent("goods-search"),R),f=a(e.resolveDynamicComponent("common-search"),q);return e.openBlock(),e.createElementBlock("view",{class:"integrated-search-container"},[e.createElementVNode("view",{class:"search-header"},[e.createElementVNode("view",{class:"search-wrapper",style:e.normalizeStyle({width:h.value})},["goods"===n.value?(e.openBlock(),e.createBlock(v,{key:0,ref_key:"goodsSearchRef",ref:i,width:h.value,background:t.background,"hidden-icon":!1,mode:t.mode,onSelect:d},null,8,["width","background","mode"])):(e.openBlock(),e.createBlock(f,{key:1,ref_key:"commonSearchRef",ref:r,width:h.value,background:t.background,fontSize:t.fontSize,hiddenIcon:!0,mode:t.mode,onSelect:m,"show-index-selector":""},null,8,["width","background","fontSize","mode"]))],4),e.createElementVNode("view",{class:"toggle-button",onClick:u},[e.createElementVNode("text",null,e.toDisplayString("goods"===n.value?"娃物":"作者"),1)])]),c.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"results-container"},["goods"===n.value&&l.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"goods-results"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"result-item",onClick:e=>{return a=t,void("jump"===p.mode&&uni.navigateTo({url:`/pages/goods/goods?goods_id=${a.id}`}));var a}},[e.createElementVNode("view",{class:"brand-tag"},e.toDisplayString(t.brand_name),1),e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])):"brand"===n.value&&s.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"brand-results"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"result-item",onClick:e=>{return a=t,void("jump"===p.mode&&uni.navigateTo({url:`/pages/brand/brand?brand_id=${a.id}`}));var a}},e.toDisplayString(t.name),9,["onClick"])))),128))])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-485bd003"]]),j=V({__name:"index-brand",props:["brand","key"],setup(t){const a=t;function o(){uni.navigateTo({url:"/pages/brand/brand?brand_id="+a.brand.id})}return(a,n)=>(e.openBlock(),e.createElementBlock("view",{class:"brand-card",key:t.key},[e.createElementVNode("view",{class:"brand-header",onClick:o},[t.brand.logo_image?(e.openBlock(),e.createElementBlock("image",{key:0,class:"brand-logo",src:t.brand.logo_image,mode:"aspectFit"},null,8,["src"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"brand-logo",style:{background:"linear-gradient(180deg, #d8c1b3 0%, #d3f5ff 100%)","align-items":"center"}},[e.createElementVNode("text",{style:{color:"rgb(255, 255, 255)","font-size":"100rpx",display:"block","text-align":"center"}},"?")])),e.createElementVNode("view",{class:"brand-meta"},[e.createElementVNode("view",{class:"title-row"},[e.createElementVNode("image",{src:t.brand.brand_name_image,mode:"heightFix",style:{height:"40rpx"}},null,8,["src"]),e.createElementVNode("text",{class:"brand-tag"},e.toDisplayString(t.brand.country_name)+"·"+e.toDisplayString(t.brand.type),1),e.createElementVNode("text",{class:"goods-count"},"收录"+e.toDisplayString(t.brand.total_goods)+"款",1)]),e.createElementVNode("text",{class:"brand-desc"},e.toDisplayString(t.brand.description),1)])]),e.createElementVNode("scroll-view",{class:"goods-scroll","scroll-x":"","show-scrollbar":!1},[e.createElementVNode("view",{class:"goods-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.brand.goods,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"goods-item",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/goods/goods?goods_id="+a});var a}},[e.createElementVNode("image",{class:"goods-image",src:t.goods_images&&t.goods_images[0],mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])])]))}},[["__scopeId","data-v-3290f0de"]]);const H=V({name:"BottomPopup",props:{show:{type:Boolean,default:!1}},watch:{show(e){if("undefined"==typeof uni)return;const t=uni.getSystemInfoSync().platform;("android"===t||"ios"===t)&&(e?uni.hideTabBar():uni.showTabBar())}},methods:{closePopup(){this.$emit("close")},moveHandle:()=>!1}},[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",null,[o.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["mask",{"mask-show":o.show}]),onClick:a[0]||(a[0]=(...e)=>s.closePopup&&s.closePopup(...e)),onTouchmove:a[1]||(a[1]=e.withModifiers(((...e)=>s.moveHandle&&s.moveHandle(...e)),["stop","prevent"]))},null,34)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["popup-container",{"popup-show":o.show}]),onTouchmove:a[2]||(a[2]=e.withModifiers(((...e)=>s.moveHandle&&s.moveHandle(...e)),["stop","prevent"]))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],34)])}],["__scopeId","data-v-a001089e"]]),G=V({__name:"index-artist",setup(o){const n=e.ref([{label:"全部",value:0},{label:"长期接单",value:1},{label:"限时手速",value:2},{label:"限时抽选",value:3},{label:"黑箱卡",value:4},{label:"关闭接单",value:9}]),l=e.ref([]),s=e.ref([]),i=e.ref(0),d=e.ref(""),m=e.ref(""),p=e.ref(1),h=e.ref(20),g=e.ref(0),v=e.ref(!1),f=e.ref(!0),y=e.ref(!1),w=e.ref(!1);e.onMounted((()=>{_()}));const _=async()=>{try{v.value=!0;const e={page:p.value,size:h.value};0!==i.value&&(e.status=i.value),d.value&&(e.min_price=d.value),m.value&&(e.max_price=m.value);const t=(await uni.request({url:`${u.value}/brand-artist-list`,method:"GET",data:e})).data;"success"===t.status?(1===p.value&&(l.value=[]),l.value=[...l.value,...t.data.list],g.value=t.data.total,V(),f.value=l.value.length<g.value):uni.showToast({title:t.msg||"获取数据失败",icon:"none"})}catch(e){t("error","at components/index-artist/index-artist.vue:251","获取妆师列表失败:",e),uni.showToast({title:"网络请求失败",icon:"none"})}finally{v.value=!1}},k=()=>{w.value=!0},E=()=>{w.value=!1,p.value=1,_()},N=()=>{y.value=!0},V=()=>{s.value=l.value},x=()=>{i.value=0,d.value="",m.value="",p.value=1,_(),w.value=!1},S=e=>{switch(e){case 1:return"status-long-term";case 2:return"status-speed";case 3:return"status-lottery";case 4:return"status-black-card";case 9:return"status-closed";default:return""}};return r((()=>{!v.value&&f.value&&(p.value+=1,_())})),c((()=>{l.value=[],p.value=1,_().then((()=>{uni.stopPullDownRefresh()}))})),(t,o)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b),r=a(e.resolveDynamicComponent("common-modal"),T),c=a(e.resolveDynamicComponent("bottom-popup"),H);return e.openBlock(),e.createElementBlock("view",{class:"artist-list-container"},[e.createElementVNode("view",{class:"top-actions"},[e.createElementVNode("view",{class:"filter-btn",onClick:k},[e.createVNode(l,{type:"tune",size:"18",color:"#fff"}),e.createElementVNode("text",{style:{color:"#fff","font-size":"24rpx"}},"筛选")]),e.createElementVNode("view",{class:"help-btn",onClick:N},[e.createVNode(l,{type:"help",size:"24",color:"#808080"})])]),e.createElementVNode("view",{class:"artist-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"artist-card",onClick:e=>(e=>{uni.navigateTo({url:"/pages/artist_info/artist_info?brand_id="+e.brand_id})})(t)},[e.createElementVNode("view",{class:"artist-info"},[e.createElementVNode("image",{src:t.logo_image,class:"artist-avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"artist-details"},[e.createElementVNode("view",{class:"artist-name"},e.toDisplayString(t.brand_name),1),e.createElementVNode("view",{class:"artist-status"},[e.createElementVNode("text",{class:e.normalizeClass(["status-badge",S(t.status)])},e.toDisplayString(t.status_text),3)]),e.createElementVNode("view",{class:"artist-price"},[e.createElementVNode("text",{class:"price-label"},"基础价格:"),e.createElementVNode("text",{class:"price-value"},"¥"+e.toDisplayString(t.base_price),1)]),t.description?(e.openBlock(),e.createElementBlock("view",{key:0,class:"artist-desc"},e.toDisplayString(t.description),1)):e.createCommentVNode("",!0)])]),t.highlight_img&&t.highlight_img.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"highlight-works"},[e.createElementVNode("scroll-view",{"scroll-x":"",class:"works-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.highlight_img,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"work-item"},[e.createElementVNode("image",{src:t,class:"work-image",mode:"aspectFill"},null,8,["src"])])))),128))])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-works"}," 暂无作品展示 "))],8,["onClick"])))),128))]),f.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"load-more"},[v.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):(e.openBlock(),e.createElementBlock("text",{key:1},"上拉加载更多"))])):e.createCommentVNode("",!0),0!==s.value.length||v.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{src:"/static/empty-artist.png",class:"empty-image"}),e.createElementVNode("text",{class:"empty-text"},"未找到符合条件的妆师"),e.createElementVNode("button",{class:"reset-btn",onClick:x},"重置筛选")])),e.createVNode(r,{visible:y.value,"onUpdate:visible":o[1]||(o[1]=e=>y.value=e),top:"15vh"},{default:e.withCtx((()=>[e.createElementVNode("scroll-view",{"scroll-y":"true",class:"help-modal-content"},[e.createElementVNode("view",{class:"modal-title"},"妆师/毛娘信息说明"),e.createElementVNode("view",{class:"modal-text"},[e.createElementVNode("text",{class:"bold"},"基础妆费说明："),e.createElementVNode("text",null,"基础妆费是妆师妆则中费用最低的一个选项，例如：自由妆200、半指定300、全指定400，选取自由妆费作为展示。")]),e.createElementVNode("view",{class:"modal-text"},[e.createElementVNode("text",{class:"bold"},"价格说明："),e.createElementVNode("text",null,"受限于数据收集困难等原因，妆师妆费价格与实际价格可能存在差距，如有错误请在妆师主页留言订正，我们会很快核对更新。")]),e.createElementVNode("view",{class:"modal-text"},[e.createElementVNode("text",{class:"bold"},"交易说明："),e.createElementVNode("text",null,"当前软件版本暂不支持在线交易，交易详情、责任与规则以联系本人为准。")]),e.createElementVNode("view",{class:"modal-text"},[e.createElementVNode("text",{class:"bold"},"接管词条："),e.createElementVNode("text",null,"在【我的-作者入驻】中申请")]),e.createElementVNode("view",{class:"modal-close",onClick:o[0]||(o[0]=e=>y.value=!1)},"我知道了")])])),_:1},8,["visible"]),e.createVNode(c,{show:w.value,onClose:o[5]||(o[5]=e=>w.value=!1)},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"filter-popup-content"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"筛选条件"),e.createVNode(l,{type:"closeempty",size:"24",color:"#666",onClick:o[2]||(o[2]=e=>w.value=!1)})]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("view",{class:"section-title"},"接单状态"),e.createElementVNode("view",{class:"status-buttons"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["status-btn",{active:i.value===t.value}]),onClick:e=>i.value=t.value},e.toDisplayString(t.label),11,["onClick"])))),128))])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("view",{class:"section-title"},"价格区间"),e.createElementVNode("view",{class:"price-inputs"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>d.value=e),type:"number",placeholder:"最低价",class:"price-input"},null,512),[[e.vModelText,d.value]]),e.createElementVNode("text",{class:"price-separator"},"-"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[4]||(o[4]=e=>m.value=e),type:"number",placeholder:"最高价",class:"price-input"},null,512),[[e.vModelText,m.value]])])]),e.createElementVNode("view",{class:"popup-actions"},[e.createElementVNode("button",{class:"popup-btn reset",onClick:x},"重置"),e.createElementVNode("button",{class:"popup-btn apply",onClick:E},"应用")])])])),_:1},8,["show"])])}}},[["__scopeId","data-v-865a8fdd"]]),W={name:"uniPopup",components:{},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},borderRadius:{type:String}},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(e){this.mkclick=e},immediate:!0},isMaskClick:{handler:function(e){this.mkclick=e},immediate:!0},showPopup(e){}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{backgroundColor:"transparent",borderRadius:this.borderRadius||"0",position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:"top"}},computed:{getStyles(){let e={backgroundColor:this.bg};return this.borderRadius,e=Object.assign(e,{borderRadius:this.borderRadius}),e},isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:e,windowHeight:t,windowTop:a,safeArea:o,screenHeight:n,safeAreaInsets:l}=uni.getSystemInfoSync();this.popupWidth=e,this.popupHeight=t+(a||0),o&&this.safeArea?this.safeAreaInsets=l.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},activated(){this.setH5Visible(!this.showPopup)},deactivated(){this.setH5Visible(!0)},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(e=!0){},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){if(this.showPopup)return;e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)||(e=this.type),this.config[e]?(this[this.config[e]](),this.$emit("change",{show:!0,type:e})):t("error","at uni_modules/uni-popup/components/uni-popup/uni-popup.vue:310","缺少类型：",e)},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(e){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.showPoptrans(),this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(e){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||this.showPoptrans()},center(e){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius||"0"},e||this.showPoptrans()},left(e){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||this.showPoptrans()},right(e){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||this.showPoptrans()},showPoptrans(){this.$nextTick((()=>{this.showPopup=!0,this.showTrans=!0}))}}};const J=V(W,[["render",function(t,o,n,l,s,i){const r=a(e.resolveDynamicComponent("uni-transition"),B);return s.showPopup?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uni-popup",[s.popupstyle,i.isDesktop?"fixforpc-z-index":""]])},[e.createElementVNode("view",{onTouchstart:o[1]||(o[1]=(...e)=>i.touchstart&&i.touchstart(...e))},[s.maskShow?(e.openBlock(),e.createBlock(r,{key:"1",name:"mask","mode-class":"fade",styles:s.maskClass,duration:s.duration,show:s.showTrans,onClick:i.onTap},null,8,["styles","duration","show","onClick"])):e.createCommentVNode("",!0),e.createVNode(r,{key:"2","mode-class":s.ani,name:"content",styles:s.transClass,duration:s.duration,show:s.showTrans,onClick:i.onTap},{default:e.withCtx((()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-popup__wrapper",[s.popupstyle]]),style:e.normalizeStyle(i.getStyles),onClick:o[0]||(o[0]=(...e)=>i.clear&&i.clear(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)])),_:3},8,["mode-class","styles","duration","show","onClick"])],32)],2)):e.createCommentVNode("",!0)}],["__scopeId","data-v-73d3b141"]]),K=V({__name:"index",setup(o){e.useCssVars((e=>({c484a4e4:K.value})));let n=e.ref([]),l=e.ref({}),s=e.ref(""),d=e.ref(!1);const m=e.ref([{label:"中国娃社",value:1},{label:"个人作者",value:2},{label:"外国娃社",value:3}]),p=e.ref(1);e.ref(0);const g=uni.getSystemInfoSync();e.ref(0);const f=e.ref(1),y=e.ref(10),w=e.ref(!0),_=e.ref(!1);let k=e.ref([]);const N=e.ref(1),V=e.ref(10),x=e.ref(!0),S=e.ref(!1);let C=e.ref([]);const T=e.ref(1),I=e.ref(10),$=e.ref(!0),F=e.ref(!1);let M=e.ref([]);const R=e.ref(1),O=e.ref(10),q=e.ref(!0),H=e.ref(!1),W=e.ref("news"),J=e=>{W.value=e};e.computed((()=>0));const K=e.computed((()=>`${g.statusBarHeight||0}px`));c((async()=>{try{await Y(),uni.stopPullDownRefresh()}catch(e){uni.stopPullDownRefresh(),uni.showToast({title:"刷新失败",icon:"none"})}}));const Y=async()=>{d.value=!0,setTimeout((async()=>{const e={brands:()=>{f.value=1,n.value=[],w.value=!0,Z(!0)},news:()=>{N.value=1,k.value=[],x.value=!0,Q(!0)},hot:()=>{T.value=1,C.value=[],$.value=!0,X(!0)},second:()=>{R.value=1,M.value=[],q.value=!0,ee(!0)}};await e[W.value]()}),800)};e.ref(null);const Q=async(e=!1)=>{e&&(N.value=1),x.value&&!S.value&&(S.value=!0,d.value=!0,uni.request({url:u.value+"/sale-news",data:{page:N.value,pageSize:V.value},success:e=>{const t=e.data.data.news_list.map((e=>({...e,imagesLoaded:!1,loadCount:0})));0!==t.length?(k.value=[...k.value,...t],x.value=e.data.data.news_list.length===V.value,N.value++):x.value=!1},fail:e=>{t("log","at pages/index/index.vue:599",e),uni.showToast({title:"加载失败",icon:"none"})},complete:()=>{S.value=!1,d.value=!1}}))};const X=async(e=!1)=>{e&&(T.value=1),$.value&&!F.value&&(F.value=!0,d.value=!0,uni.request({url:u.value+"/hot-collocation",data:{page:T.value,pageSize:I.value},success:e=>{const t=e.data.data.collocation_relation_list;0!==t.length?(C.value=[...C.value,...t.map((e=>({...e})))],$.value=C.value.length<e.data.data.total,T.value++):$.value=!1},fail:e=>{t("log","at pages/index/index.vue:645",e),uni.showToast({title:"加载失败",icon:"none"})},complete:()=>{F.value=!1,d.value=!1}}))},Z=async(e=!1)=>{if(e&&(f.value=1,n.value=[],w.value=!0,s.value=""),!w.value||_.value)return;_.value=!0,d.value=!0;const a={pageSize:y.value};s.value?a.cursor=s.value:p.value&&(a.searchType=p.value),uni.request({url:u.value+"/brands-info-list",data:a,success:e=>{if("success"!==e.data.status)return void uni.showToast({title:"加载失败: "+e.data.message,icon:"none"});const a=e.data.data,o=a.data;t("log","at pages/index/index.vue:706","newData:",o),s.value=a.next_cursor||"",0!==o.length?(n.value=[...n.value,...o],w.value=a.has_more):w.value=!1},fail:e=>{t("log","at pages/index/index.vue:719",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{_.value=!1,d.value=!1}})},ee=async(e=!1)=>{e&&(R.value=1),q.value&&!H.value&&(H.value=!0,d.value=!0,uni.request({url:u.value+"/treehole-submissions",data:{page:R.value,pageSize:O.value},success:e=>{const t=e.data.data.submission_list.map((e=>({...e,images:e.images||[],imagesLoaded:!1,loadCount:0})));0!==t.length?(M.value=[...M.value,...t],q.value=M.value.length<e.data.data.total,R.value++):q.value=!1},fail:e=>{uni.showToast({title:"加载失败",icon:"none"})},complete:()=>{H.value=!1,d.value=!1}}))};function te(){h.isLogin?uni.navigateTo({url:"/pages/treehole_publish/treehole_publish"}):uni.showModal({title:"提示",content:"需要登录后才能发布树洞",success:e=>{e.confirm&&uni.navigateTo({url:"/pages/login/login"})}})}const ae=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`},oe=e=>{switch(t("log","at pages/index/index.vue:922","服务器已切换",e.server),Y(),W.value){case"brands":f.value=1,n.value=[],w.value=!0,Z(!0);break;case"news":N.value=1,k.value=[],x.value=!0,Q(!0);break;case"hot":T.value=1,C.value=[],$.value=!0,X(!0);break;case"second":R.value=1,M.value=[],q.value=!0,ee(!0)}};return i((()=>{v(),Z(),Q(),X(),ee(),uni.request({url:u.value+"/articles",data:{page:1,page_size:10,status:1},success:e=>{"success"===e.data.status&&(l.value=e.data.data.list)},fail:e=>{t("error","at pages/index/index.vue:514","获取Banner失败:",e),l.value={}}})})),r((()=>{"brands"===W.value&&w.value?Z():"news"===W.value&&x.value?Q():"second"===W.value&&q.value&&ee()})),(o,i)=>{const r=a(e.resolveDynamicComponent("view-logs"),E),c=a(e.resolveDynamicComponent("privacy-permission-modal"),z),g=a(e.resolveDynamicComponent("version-check"),A),v=a(e.resolveDynamicComponent("loading-toast"),P),y=a(e.resolveDynamicComponent("server-selector"),L),N=a(e.resolveDynamicComponent("switch-search"),U),V=a(e.resolveDynamicComponent("uni-icons"),b),C=a(e.resolveDynamicComponent("uni-transition"),B),T=a(e.resolveDynamicComponent("index-brand"),j),I=a(e.resolveDynamicComponent("index-artist"),G);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#def9ff"}),e.createVNode(r),e.createElementVNode("view",null,[e.createVNode(c),e.createVNode(g,{"show-up-to-date-toast":!0}),e.createVNode(v,{show:e.unref(d)},null,8,["show"]),e.createVNode(r),e.createElementVNode("view",{class:"body"},[e.createElementVNode("view",{class:"index_header"},[e.createElementVNode("view",{class:"header-placeholders"}),e.createElementVNode("view",null,[e.createElementVNode("view",{style:{display:"inline-block","margin-left":"20rpx"}},[e.createElementVNode("image",{src:"/static/new-icon/title.gif",mode:"widthFix",style:{width:"400rpx","max-height":"180rpx",position:"relative",left:"-20rpx","margin-bottom":"10rpx"}}),e.createVNode(y,{onServerChange:oe})]),e.createVNode(N,{onSelect:o.handleSearchSelect,mode:"jump",width:"95%",background:"#f8f8f8"},null,8,["onSelect"])]),e.createElementVNode("view",{style:{margin:"20rpx 0rpx 0rpx 0rpx",padding:"5px 10px 0px 10px","border-radius":"20px 20px 0 0"}},[e.createElementVNode("view",{class:"index_page_article"},[e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"news"===W.value}]),onClick:i[0]||(i[0]=e=>J("news"))},[e.createElementVNode("image",{src:"/static/new-icon/telphone.gif",mode:"aspectFill"}),e.createElementVNode("text",{class:"font-cute"},"新情报！")],2),e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"brands"===W.value}]),onClick:i[1]||(i[1]=e=>J("brands"))},[e.createElementVNode("image",{src:"/static/new-icon/read.gif",mode:"aspectFill"}),e.createElementVNode("text",{class:"font-cute"},"娃物图鉴")],2),e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"hot"===W.value}]),onClick:i[2]||(i[2]=e=>J("hot"))},[e.createElementVNode("image",{src:"/static/new-icon/collocation.gif",mode:"aspectFill",style:{width:"90rpx",height:"90rpx",position:"relative",bottom:"0rpx"}}),e.createElementVNode("text",{class:"font-cute",style:{position:"relative",bottom:"5rpx"}},"妆师毛娘")],2),e.createElementVNode("view",{class:e.normalizeClass(["swich_box",{active:"second"===W.value}]),onClick:i[3]||(i[3]=e=>J("second"))},[e.createElementVNode("image",{src:D,mode:"aspectFill"}),e.createElementVNode("text",{class:"font-cute"},"匿名版")],2)])])]),e.createElementVNode("view",{class:"body_container"},[e.createElementVNode("view",{style:{height:"40rpx"}}),e.createVNode(C,{"mode-class":["fade"],show:"news"===W.value},{default:e.withCtx((()=>["news"===W.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list news-box"},[e.createElementVNode("view",{style:{position:"relative",height:"250rpx","margin-bottom":"20rpx",display:"none"}},[e.createElementVNode("swiper",{interval:3e3,duration:200,class:"banner_swiper","indicator-active-color":"#4cbbd0","indicator-color":"rgba(255,255,255,0.5)"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(t=>(e.openBlock(),e.createElementBlock("swiper-item",{key:t.id,class:"banner_swiper_item"},[e.createElementVNode("view",{class:"swiper-item"},[e.createElementVNode("image",{src:t.banner,mode:"aspectFill",style:{width:"100%",height:"250rpx"},onClick:e=>(e=>{uni.navigateTo({url:`/pages/article_detail/article_detail?id=${e.id}`})})(t)},null,8,["src","onClick"])])])))),128)),0===e.unref(l).length?(e.openBlock(),e.createElementBlock("swiper-item",{key:0},[e.createElementVNode("view",{class:"empty-banner"},[e.createElementVNode("image",{src:"/static/default-banner.jpg",mode:"aspectFill",style:{width:"100%",height:"250rpx"}})])])):e.createCommentVNode("",!0)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(k),(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"news-item",onClick:e=>function(e){uni.navigateTo({url:"/pages/sale_news/sale_news?id="+e.id+"&brand_id="+e.brand_id})}(a)},[e.createElementVNode("view",{class:"news-images"},[a.image_list.length>0?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"image-swiper",autoplay:a.imagesLoaded,circular:!0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.image_list,((o,n)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:n},[e.createElementVNode("view",{class:"image-container"},[e.createElementVNode("image",{src:o,mode:"aspectFill",class:e.normalizeClass(["swiper-image",{loaded:a.imagesLoaded}]),onLoad:e=>(e=>{e.loadCount++,e.loadCount>=e.image_list.length&&(e.imagesLoaded=!0)})(a),onError:e=>((e,a)=>{t("error","at pages/index/index.vue:830",`新闻图片加载失败: ${e.image_list[a]}`),e.loadCount||(e.loadCount=0),e.loadCount++,e.loadCount>=e.image_list.length&&(e.imagesLoaded=!0)})(a,n)},null,42,["src","onLoad","onError"]),a.imagesLoaded?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-overlay"},[e.createVNode(V,{type:"loop",size:"28",color:"rgb(185 185 185)",class:"loading-icon"})]))])])))),128))],8,["autoplay"])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"news-content"},[e.createElementVNode("text",{class:"news-title"},e.toDisplayString(a.title),1),e.createElementVNode("text",{class:"news-desc"},e.toDisplayString(a.content),1),e.createElementVNode("view",{class:"news-footer"},[e.createElementVNode("text",{class:"brand-tag"},e.toDisplayString(a.brand_name),1),e.createElementVNode("text",{class:"news-time"},e.toDisplayString(ae(a.created_at)),1)])])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"loading-more"},[S.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),x.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多了~"))])])):e.createCommentVNode("",!0)])),_:1},8,["show"]),e.createVNode(C,{"mode-class":["fade"],show:"brands"===W.value},{default:e.withCtx((()=>["brands"===W.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list brand_box",style:{position:"relative"}},[e.createElementVNode("view",{class:"filter-tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item",{active:p.value===t.value}]),onClick:e=>{return a=t.value,p.value===a?p.value=null:p.value=a,f.value=1,w.value=!0,n.value=[],s.value="",void Z();var a}},e.toDisplayString(t.label),11,["onClick"])))),128))]),e.createElementVNode("view",{class:"brand_type_description",style:{display:"block"}},[1==p.value?(e.openBlock(),e.createElementBlock("text",{key:0},"中国公司制作的BJD在打磨、分模线等工艺的处理上比较优秀，价格也比外社低很多。")):e.createCommentVNode("",!0),2==p.value?(e.openBlock(),e.createElementBlock("text",{key:1},"个人作者在贩售娃物前基本都是圈内玩家，在设计方面花的心思很多。")):e.createCommentVNode("",!0),3==p.value?(e.openBlock(),e.createElementBlock("text",{key:2},"国外娃社起步较早，风格设计也比较多样化。")):e.createCommentVNode("",!0)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id},[e.createVNode(T,{brand:t},null,8,["brand"])])))),128)),e.createElementVNode("view",{class:"loading-more"},[_.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),w.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多数据了"))])])):e.createCommentVNode("",!0)])),_:1},8,["show"]),e.createVNode(C,{"mode-class":["fade"],show:"hot"===W.value},{default:e.withCtx((()=>["hot"===W.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list hot-box"},[e.createVNode(I)])):e.createCommentVNode("",!0)])),_:1},8,["show"]),e.createVNode(C,{"mode-class":["fade"],show:"second"===W.value},{default:e.withCtx((()=>["second"===W.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"body_list treehole-box"},[e.createElementVNode("view",{class:"publish-btn",onClick:te},[e.createVNode(V,{type:"plusempty",size:"30",color:"#fff"})]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(M),(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"treehole-item",onClick:e=>function(e){uni.navigateTo({url:"/pages/treehole_detail/treehole_detail?id="+e.id})}(a)},[e.createElementVNode("view",{class:"user-info",onClick:e.withModifiers((e=>function(e){1!=e.is_anonymous&&uni.navigateTo({url:"/pages/user_page/user_page?uid="+e.uid})}(a)),["stop"])},[""!==a.avatar?(e.openBlock(),e.createElementBlock("image",{key:0,src:a.avatar,class:"avatar",mode:"aspectFill"},null,8,["src"])):(e.openBlock(),e.createElementBlock("image",{key:1,src:"/static/noname.png",class:"avatar",mode:"scaleToFill"})),e.createElementVNode("text",{class:"username"},e.toDisplayString(a.is_anonymous?"匿名用户":a.author_name),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(ae(a.created_at)),1),e.createElementVNode("text",{class:"cid"},"【"+e.toDisplayString(a.id)+"】",1)],8,["onClick"]),e.createElementVNode("text",{class:"content"},e.toDisplayString(a.content),1),a.images.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-grid"},[e.createElementVNode("swiper",{class:"image-swiper",autoplay:a.imagesLoaded,circular:!0,"indicator-dots":a.images.length>1,duration:300},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.images,((o,n)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:n},[e.createElementVNode("view",{class:"image-container"},[e.createElementVNode("image",{src:o,mode:"aspectFill",class:e.normalizeClass(["swiper-image",{loaded:a.imagesLoaded}]),onClick:e.withModifiers((e=>{return t=a.images,o=n,void uni.previewImage({current:o,urls:t});var t,o}),["stop"]),onLoad:e=>(e=>{e.loadCount++,e.loadCount>=e.images.length&&(e.imagesLoaded=!0)})(a),onError:e=>((e,a)=>{t("error","at pages/index/index.vue:808",`图片加载失败: ${e.images[a]}`),e.loadCount++,e.loadCount>=e.images.length&&(e.imagesLoaded=!0)})(a,n)},null,42,["src","onClick","onLoad","onError"]),a.imagesLoaded?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-overlay"},[e.createVNode(V,{type:"spinner-cycle",size:"28",color:"#4cbbd0",class:"loading-icon"})]))])])))),128))],8,["autoplay","indicator-dots"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("view",{class:"action-item",onClick:e=>function(e){if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});let t=uni.getStorageSync("token");t?uni.request({url:u.value+(e.has_liked?"/with-state/unlike":"/with-state/add-like"),method:"POST",header:{Authorization:t},data:{id:e.id,type:5},success:t=>{"success"===t.data.status?(e.has_liked=!e.has_liked,e.like_count+=e.has_liked?1:-1):uni.showD}}):uni.showToast({title:"请先登录",icon:"none"})}(a)},[e.createVNode(V,{type:a.has_liked?"hand-up-filled":"hand-up",size:"18",color:a.has_liked?"#ff4d4f":"#666"},null,8,["type","color"]),e.createElementVNode("text",{class:"count"},e.toDisplayString(a.like_count||0),1)],8,["onClick"]),e.createElementVNode("view",{class:"action-item"},[e.createVNode(V,{type:"chat",size:"18",color:"#666"}),e.createElementVNode("text",{class:"count"},e.toDisplayString(a.comment_count||0),1)]),e.createElementVNode("view",{class:"action-item",onClick:e.withModifiers((e=>function(e){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+e.id;uni.setClipboardData({data:t,success:function(){uni.showToast({title:"复制链接成功",icon:"none"})}})}(a)),["stop"])},[e.createVNode(V,{type:"redo",size:"18",color:"#666"}),e.createElementVNode("text",{class:"count"},"分享")],8,["onClick"])])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"loading-more"},[H.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),q.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1},"没有更多了~"))])])):e.createCommentVNode("",!0)])),_:1},8,["show"])])])])],64)}}},[["__scopeId","data-v-d6723f48"]]);const Y=V({},[["render",function(t,a){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{class:"list_item_main_info"},[e.createElementVNode("text",null,"Puypoodoll - momo"),e.createElementVNode("text",null,"21分钟前"),e.createElementVNode("view",{class:"list_view_and_like_box"},[e.createElementVNode("view",{class:"posion_bottom"},[e.createElementVNode("view",{class:"icon_inline_text"},[e.createElementVNode("image",{class:"icon_image",src:"/static/message.png"}),e.createElementVNode("text",null,"10")]),e.createElementVNode("view",{class:"icon_inline_text"},[e.createElementVNode("image",{class:"icon_image",src:"/static/like.png"}),e.createElementVNode("text",null,"20")])])])])])}],["__scopeId","data-v-a238f5d8"]]),Q={__name:"homepage",setup(o){let n=["所有尺寸","一分","二分","三分","四分","六分","八分","十分","十二分","其它大尺寸","棉花娃"],l=e.ref(0),s=[{name:"上新推送"},{name:"BJD整娃"},{name:"单头"},{name:"假发"},{name:"娃衣"},{name:"眼珠"},{name:"鞋子"},{name:"支架"},{name:"其它配件"}];function i(e){t("log","at pages/homepage/homepage.vue:69","picker发送选择改变，携带值为",e.detail.value),l.value=e.detail.value}const c=uni.getSystemInfoSync();function u(){uni.navigateTo({url:"/pages/goods/goods"})}return t("log","at pages/homepage/homepage.vue:75","状态栏高度"+e.ref(c.statusBarHeight).value),r((()=>{t("log","at pages/homepage/homepage.vue:78","onEachBottom!")})),(t,o)=>{const r=a(e.resolveDynamicComponent("view-logs"),E),c=a(e.resolveDynamicComponent("common-search"),q),d=a(e.resolveDynamicComponent("homepage-list-item"),Y);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(r),e.createElementVNode("view",{class:"backbody"},[e.createElementVNode("view",{class:"pageinfo_userinfo"},[e.createElementVNode("image",{mode:"aspectFill",class:"avatar mine_avatar",src:"/static/pixsun.png"}),e.createElementVNode("view",{class:"pageinfo_infobox"},[e.createElementVNode("text",{class:"mine_username font-alimamashuhei"},"用户名"),e.createElementVNode("view",null,[e.createElementVNode("text",{class:"mine_friends"},[e.createTextVNode("好友 "),e.createElementVNode("text",{class:"mine_info_number"},"10")]),e.createElementVNode("text",{class:"mine_message"},[e.createTextVNode("消息 "),e.createElementVNode("text",{class:"mine_info_number"},"10")])])])]),e.createElementVNode("view",{class:"pageinfo_body"},[e.createElementVNode("view",null,[e.createElementVNode("view",null,[e.createElementVNode("view",{class:"uni-list-cell-db pick_size font-alimamashuhei"},[e.createElementVNode("picker",{onChange:i,value:e.unref(l),range:e.unref(n)},[e.createElementVNode("view",{class:"uni-input select_size"},[e.createTextVNode(e.toDisplayString(e.unref(n)[e.unref(l)])+" ",1),e.createElementVNode("image",{class:"icon_image down",src:"/static/arrow_down.png"})])],40,["value","range"])]),e.createElementVNode("icon",{class:""})]),e.createElementVNode("view",{class:"left_menu"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),((t,a)=>(e.openBlock(),e.createElementBlock("view",null,[(e.openBlock(),e.createElementBlock("text",{class:"menu_text font-alimamashuhei",key:a},e.toDisplayString(t.name),1))])))),256))]),e.createElementVNode("view",{class:"right_body"},[e.createVNode(c),e.createElementVNode("view",null,[e.createVNode(d,{onClick:u})])])])])])],64)}}},X={__name:"shmily-drag-image",props:{value:{type:Array,default:()=>[]},customClick:{type:Boolean,default:!1},modelValue:{type:Array,default:()=>[]},keyName:{type:String,default:"image_url"},number:{type:Number,default:6},imageWidth:{type:Number,default:0},cols:{type:Number,default:3},borderRadius:{type:String,default:0},padding:{type:Number,default:10},scale:{type:Number,default:1.1},opacity:{type:Number,default:.7},itemMargin:{type:Number,default:10},imageRatio:{type:Number,default:.7},showItemInfo:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!1}},emits:["input","update:modelValue","sort-change","delete","item-click"],setup(o,{emit:n}){const l=o,s=n,i=e.ref([]),r=e.ref(0),c=e.ref({x:0,y:0}),u=e.ref(0),d=e.ref(0),m=e.ref(0),p=e.ref(null),h=e.ref(null),g=e.ref(!0);e.ref(!0);const v=e.ref(!0),f=e.ref(0),y=e.ref(null),w=e.ref(!1),_=e.ref(!1),k=e.computed((()=>i.value.length<l.number?Math.ceil((i.value.length+1)/u.value)*m.value+"px":Math.ceil(i.value.length/u.value)*m.value+"px")),E=e.computed((()=>d.value-2*P(l.padding)+"px")),N=e.computed((()=>m.value-2*P(l.padding)+"px")),V=e=>null!==l.keyName?e[l.keyName]:e,x=e=>({id:e.id,src:V(e),name:e.name,price:e.price,type:e.type}),S=(e,t)=>{const a=i.value.findIndex((t=>t.id===e.id));-1!==a&&a!==t&&(i.value.splice(t,0,i.value.splice(a,1)[0]),i.value.forEach(((e,t)=>{e.index=t})),A())},C=(t,a)=>{t.index+=a,t.offset=0,t.x=t.oldX,t.y=t.oldY,t.absX=t.index%u.value,t.absY=Math.floor(t.index/u.value),setTimeout((()=>{e.nextTick((()=>{t.x=t.absX*d.value,t.y=t.absY*m.value}))}),0)},B=(e,a)=>{t("log","at components/shmily-drag-image/shmily-drag-image.vue:311","进入touchstart"),i.value.forEach((e=>{e.zIndex=e.index+9})),e.zIndex=99,e.moveEnd=!0,p.value=e,h.value=setTimeout((()=>{e.scale=l.scale,e.opacity=l.opacity,clearTimeout(h.value),h.value=null}),200)},T=e=>{var t;if(!e)return"";const a=(null==(t=e.split(",")[0])?void 0:t.trim())||"";return a.startsWith("http")?a:""},D=()=>{},I=()=>{},z=e=>{var t;s("item-click",e),l.customClick||(t=e.id,uni.navigateTo({url:"/pages/account_book_preview/account_book_preview?account_book_id="+t}))};const A=()=>{const e=[],t=l.modelValue.length?l.modelValue:l.value,a=[...i.value].sort(((e,t)=>e.index-t.index));for(let o of a){const a=t.find((e=>V(e)===o.src));a?e.push(a):null!==l.keyName?e.push({[l.keyName]:o.src}):e.push(o.src)}s("input",e),s("update:modelValue",e)},P=e=>r.value*e/750,L=e.ref(null);e.onMounted((()=>{r.value=uni.getSystemInfoSync().windowWidth,L.value=e.getCurrentInstance(),e.nextTick((()=>{uni.createSelectorQuery().in(L.value.proxy).select(".con").boundingClientRect((e=>{if(!e)return void t("error","at components/shmily-drag-image/shmily-drag-image.vue:630","未找到 .con 元素");u.value=l.cols,d.value=e.width/l.cols,m.value=1.3*d.value,l.imageWidth>0&&(d.value=P(l.imageWidth),m.value=1.3*d.value,u.value=Math.floor(e.width/d.value));(l.modelValue.length?l.modelValue:l.value).forEach((e=>{(e=>{const t=x(e),a=i.value.length%u.value,o=Math.floor(i.value.length/u.value),n=a*d.value,l=o*m.value;i.value.push({...t,x:n,y:l,oldX:n,oldY:l,absX:a,absY:o,scale:1,zIndex:9,opacity:1,index:i.value.length,id:e.id,disable:!1,offset:0,moveEnd:!1}),c.value.x=i.value.length%u.value*d.value,c.value.y=Math.floor(i.value.length/u.value)*m.value})(e)})),v.value=!1})).exec()})),_.value=!0}));const $=()=>{i.value.forEach(((e,t)=>{e.index=t;const a=t%u.value,o=Math.floor(t/u.value);e.x=a*d.value,e.y=o*m.value,e.oldX=e.x,e.oldY=e.y,e.absX=a,e.absY=o}))};e.watch((()=>l.modelValue),(a=>{w.value||_.value&&e.nextTick((()=>{new Promise((e=>{if(!L.value||!L.value.proxy)return t("warn","at components/shmily-drag-image/shmily-drag-image.vue:681","Component instance not available for selector query"),e();uni.createSelectorQuery().in(L.value.proxy).select(".con").boundingClientRect((t=>{if(!t)return e();u.value=l.cols,d.value=t.width/l.cols,m.value=1.3*d.value,l.imageWidth>0&&(d.value=P(l.imageWidth),m.value=1.3*d.value,u.value=Math.floor(t.width/d.value)),e()})).exec()})).then((()=>{F(a)}))}))}),{deep:!0,immediate:!0});const F=e=>{const t=i.value.reduce(((e,t)=>(e[t.id]=t,e)),{});i.value=e.map((e=>{const a=t[e.id];return a?{...a,...x(e)}:M(e)})),$()},M=e=>{const t=x(e),a=i.value.length%u.value,o=Math.floor(i.value.length/u.value);return{...t,x:a*d.value,y:o*m.value,oldX:a*d.value,oldY:o*m.value,absX:a,absY:o,scale:1,zIndex:9,opacity:1,index:i.value.length,disable:!1,offset:0,moveEnd:!1,ready:!1}};return(n,r)=>{const c=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"con"},[d.value?(e.openBlock(),e.createElementBlock("movable-area",{key:0,class:"area",style:e.normalizeStyle({height:k.value}),onMouseenter:D,onMouseleave:I},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((a,n)=>(e.openBlock(),e.createElementBlock("movable-view",{key:a.id,class:"view",direction:"all",y:a.y,x:a.x,damping:40,disabled:a.disable||!a.ready,onChange:t=>((t,a)=>{if(a&&(a.oldX=t.detail.x,a.oldY=t.detail.y,"touch"===t.detail.source)){a.moveEnd&&(a.offset=Math.sqrt(Math.pow(a.oldX-a.absX*d.value,2)+Math.pow(a.oldY-a.absY*m.value,2)));let o=Math.floor((t.detail.x+d.value/2)/d.value);if(o>=u.value)return;let n=Math.floor((t.detail.y+m.value/2)/m.value),l=u.value*n+o;a.index!==l&&l<i.value.length&&(g.value=!1,i.value.forEach((t=>{a.index>l&&t.index>=l&&t.index<a.index?C(t,1):a.index<l&&t.index<=l&&t.index>a.index?C(t,-1):t.id!==a.id&&(t.offset=0,t.x=t.oldX,t.y=t.oldY,setTimeout((()=>{e.nextTick((()=>{t.x=t.absX*d.value,t.y=t.absY*m.value}))}),0))})),S(a,l),a.index=l,a.absX=o,a.absY=n,a.moveEnd||setTimeout((()=>{e.nextTick((()=>{a.x=a.absX*d.value,a.y=a.absY*m.value}))}),0),A())}})(t,a),onTouchstart:e=>((e,a)=>{f.value=a.touches[0].clientY,y.value&&(clearTimeout(y.value),y.value=null),i.value.forEach((e=>{e.ready=!1,e.disable=!0})),t("log","at components/shmily-drag-image/shmily-drag-image.vue:293","长按开始"),y.value=setTimeout((()=>{t("log","at components/shmily-drag-image/shmily-drag-image.vue:297","长按成功！"),uni.vibrateShort({success:()=>{t("log","at components/shmily-drag-image/shmily-drag-image.vue:300","触感反馈")}}),e.ready=!0,e.disable=!1,w.value=!0,B(e)}),240)})(a,e),onTouchend:o=>(a=>{if(a.scale=1,a.opacity=1,a.x=a.oldX,a.y=a.oldY,a.offset=0,a.moveEnd=!1,t("log","at components/shmily-drag-image/shmily-drag-image.vue:336","结束点击，清理ready"),i.value.forEach((e=>{e.ready=!1,e.disable=!0})),1==w.value){t("log","at components/shmily-drag-image/shmily-drag-image.vue:342","来自于拖拽的结束,上报排序事件");const e=i.value.map((e=>e.id));s("sort-change",e),t("log","at components/shmily-drag-image/shmily-drag-image.vue:348","排序后的ID",e)}w.value=!1,y.value&&(clearTimeout(y.value),y.value=null),setTimeout((()=>{i.value.forEach((e=>{e.ready||(e.x=e.absX*d.value,e.y=e.absY*m.value,e.offset=0,e.moveEnd=!1)})),e.nextTick((()=>{a.x=a.absX*d.value,a.y=a.absY*m.value,p.value=null,g.value=!0}))}),50)})(a),onClick:e=>z(a),onTouchmove:e=>((e,t)=>{if(w.value)return;const a=e.touches[0].clientY;Math.abs(a-f.value)>10&&y.value&&(clearTimeout(y.value),y.value=null)})(e),style:e.normalizeStyle({width:d.value+"px",height:m.value+"px","z-index":a.zIndex,opacity:a.opacity})},[e.createElementVNode("view",{class:e.normalizeClass(["area-con",{ready:!a.disable&&a.ready}]),style:e.normalizeStyle({width:E.value,height:N.value,borderRadius:o.borderRadius+"rpx",transform:"scale("+a.scale+")",margin:o.itemMargin+"px"})},[l.showDelete?(e.openBlock(),e.createElementBlock("view",{key:0,class:"delete-btn",onClick:e.withModifiers((e=>(e=>{s("delete",e.id);const t=i.value.findIndex((t=>t.id===e.id));-1!==t&&(i.value.splice(t,1),$(),A())})(a)),["stop"])},[e.createVNode(c,{type:"clear",color:"#9b9b9b",size:"30"})],8,["onClick"])):e.createCommentVNode("",!0),e.createElementVNode("image",{class:"pre-image",src:T(a.src),mode:"aspectFill"},null,8,["src"]),l.showItemInfo?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-container"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"price"},e.toDisplayString(a.price),1),e.createElementVNode("text",{class:"type"},e.toDisplayString(a.type),1)])):e.createCommentVNode("",!0)],6)],44,["y","x","disabled","onChange","onTouchstart","onTouchend","onClick","onTouchmove"])))),128))],36)):e.createCommentVNode("",!0)])}}},Z=V(X,[["__scopeId","data-v-76c34f66"]]),ee="/static/empty.jpg",te="accountBookPriceVisible",ae="accountBookSelectedType",oe={__name:"stock-myitems",props:{accountBookData:Object},emits:["go2editor","update-type","init-request","update:accountBookData"],setup(o,{emit:l}){const s=o,i=l,r=e.ref(!0),c=e.ref(!1),d=e.ref(""),m=e.ref([]),p=e.ref(0),h=e.ref("全部"),g=e.ref(null),v=e.ref(""),f=e.ref(!1),y=e.ref(!1),w=e.ref([]),_=["全部"],k=e.computed((()=>[..._,...m.value.map((e=>e.name))]));e.watch([m,h],(()=>{const e=k.value,t=h.value||"全部",a=e.findIndex((e=>e===t));p.value=a>=0?a:0}));const E=e.computed((()=>s.accountBookData.account_books?s.accountBookData.account_books.reduce(((e,t)=>e+(parseFloat(t.price)||0)),0).toFixed(2):0)),N=async()=>{const e=uni.getStorageSync("token");try{const t=await uni.request({url:u.value+"/with-state/account-types",method:"GET",header:{Authorization:e}});m.value=t.data.data||[],w.value=m.value.map((e=>e.id))}catch(a){t("error","at components/stock-myitems/stock-myitems.vue:204","获取分类失败:",a)}},V=async()=>{if(!d.value)return void uni.showToast({title:"请输入分类名称",icon:"none"});if(d.value.length>10)return void uni.showToast({title:"不能超过10个字符",icon:"none"});const e=uni.getStorageSync("token");try{await uni.request({url:u.value+"/with-state/add-account-type",method:"POST",header:{Authorization:e},data:{name:d.value}}),d.value="",await N(),uni.showToast({title:"添加成功"})}catch(t){uni.showToast({title:"添加失败",icon:"none"})}},x=e=>{const a=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/sort-account-book",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{sorted_ids:e},success:e=>{},fail:e=>{t("error","at components/stock-myitems/stock-myitems.vue:279","排序失败:",e)}})},S=()=>{g.value=null,v.value=""},C=async e=>{var t,a;if(f.value)return;const o=(v.value||"").trim();if(!o)return void uni.showToast({title:"请输入分类名称",icon:"none"});if(o.length>10)return void uni.showToast({title:"不能超过10个字符",icon:"none"});f.value=!0;const n=uni.getStorageSync("token"),l=e.name;try{const s=await uni.request({url:u.value+"/with-state/update-account-book-type",method:"POST",header:{Authorization:n,"Content-Type":"application/json"},data:{id:e.id,name:o}});if((null==(t=s.data)?void 0:t.status)&&"success"!==s.data.status)throw new Error((null==(a=s.data)?void 0:a.msg)||"更新失败");h.value===l&&(h.value=o,i("update-type",o)),await N(),uni.showToast({title:"修改成功"})}catch(s){uni.showToast({title:(null==s?void 0:s.message)||"修改失败",icon:"none"})}finally{f.value=!1,S()}},B=(e,t,a)=>{if(t===a)return;const o=e.splice(t,1)[0];e.splice(a,0,o)},D=e.computed((()=>{const e=m.value.map((e=>e.id));if(e.length!==w.value.length)return!0;for(let t=0;t<e.length;t++)if(e[t]!==w.value[t])return!0;return!1})),I=async()=>{var e,t;if(!D.value||y.value)return;y.value=!0;const a=uni.getStorageSync("token"),o=m.value.map((e=>e.id));try{const n=await uni.request({url:u.value+"/with-state/sort-account-book-type",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{sorted_ids:o}});if((null==(e=n.data)?void 0:e.status)&&"success"!==n.data.status)throw new Error((null==(t=n.data)?void 0:t.msg)||"保存失败");w.value=[...o],uni.showToast({title:"排序已保存"})}catch(n){uni.showToast({title:(null==n?void 0:n.message)||"保存失败",icon:"none"})}finally{y.value=!1}},z=e=>{p.value=e.detail.value,h.value=k.value[p.value],uni.setStorageSync(ae,h.value),i("update-type","全部"===h.value?"":h.value)};return e.watch(r,(e=>uni.setStorageSync(te,String(e)))),n((async()=>{const e=uni.getStorageSync(te);""!==e&&(r.value="true"===e),(()=>{const e=uni.getStorageSync(ae);h.value=e&&""!==e?e:"全部"})(),await N(),i("update-type","全部"===h.value?"":h.value)})),(n,l)=>{var s;const w=a(e.resolveDynamicComponent("uni-icons"),b),_=a(e.resolveDynamicComponent("shmily-drag-image"),Z),A=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"tab_body_1st"},[e.createElementVNode("view",{class:"type-header"},[e.createElementVNode("view",{class:"selector-container"},[e.createElementVNode("picker",{class:"type-picker",mode:"selector",value:p.value,range:k.value,onChange:z},[e.createElementVNode("view",{class:"selector-content"},[e.createElementVNode("text",{class:"selector-label"},"分类:"),e.createElementVNode("text",{class:"selector-value"},e.toDisplayString(k.value[p.value]),1),e.createVNode(w,{type:"arrowdown",size:"14",color:"#747EE5",class:"selector-icon"})])],40,["value","range"]),e.createElementVNode("text",{class:"manage-btn",onClick:l[0]||(l[0]=e=>c.value=!0)},[e.createVNode(w,{type:"gear",size:"16",color:"#fff"}),e.createElementVNode("text",null,"管理分类")])])]),e.createElementVNode("view",{class:"summary-container"},[e.createElementVNode("view",{class:"summary-content"},[e.createVNode(w,{type:"money",size:"18",color:"#74c9e5"}),e.createElementVNode("text",{class:"total-text"},[e.createTextVNode("当前分类合计： "),r.value?(e.openBlock(),e.createElementBlock("text",{key:0},"¥"+e.toDisplayString(E.value),1)):(e.openBlock(),e.createElementBlock("text",{key:1},"******"))]),e.createVNode(w,{type:r.value?"eye":"eye-slash",size:"18",color:"#74c9e5",class:"toggle-eye",onClick:l[1]||(l[1]=e=>r.value=!r.value)},null,8,["type"]),e.createElementVNode("text",{style:{position:"absolute",right:"30px"}},"长按排序")])]),(null==(s=o.accountBookData.account_books)?void 0:s.length)>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"content"},[e.createVNode(_,{modelValue:o.accountBookData.account_books,"onUpdate:modelValue":l[2]||(l[2]=e=>o.accountBookData.account_books=e),"border-radius":"20",onSortChange:x},null,8,["modelValue"])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:ee}),e.createElementVNode("text",{class:"empty-text"},"空空如也～"),e.createElementVNode("text",{class:"empty-tip"},"点击下方按钮添加第一个物品吧！")]))]),e.createVNode(A,{visible:c.value,"onUpdate:visible":l[5]||(l[5]=e=>c.value=e),top:"10%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"type-modal"},[e.createElementVNode("scroll-view",{"scroll-y":"",style:{height:"600rpx"}},[e.createElementVNode("view",{class:"type-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"type-item"},[g.value===a.id?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value=e),class:"type-input",maxlength:"10","confirm-type":"done",onConfirm:e=>C(a),onBlur:e=>(e=>{g.value===e.id&&C(e)})(a),placeholder:"输入分类名称"},null,40,["onConfirm","onBlur"])),[[e.vModelText,v.value,void 0,{trim:!0}]]):(e.openBlock(),e.createElementBlock("text",{key:1,class:"type-name"},e.toDisplayString(a.name),1)),g.value!==a.id?(e.openBlock(),e.createElementBlock("view",{key:2,class:"sort-actions"},[e.createElementVNode("button",{class:"mini-btn",size:"mini",disabled:0===o||y.value,onClick:e=>{var t;(t=o)>0&&B(m.value,t,t-1)}},"上移",8,["disabled","onClick"]),e.createElementVNode("button",{class:"mini-btn",size:"mini",disabled:o===m.value.length-1||y.value,onClick:e=>{var t;(t=o)<m.value.length-1&&B(m.value,t,t+1)}},"下移",8,["disabled","onClick"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"type-actions"},[g.value===a.id?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("button",{class:"act-btn primary",size:"mini",loading:f.value,disabled:f.value,onClick:e=>C(a)},"保存",8,["loading","disabled","onClick"]),e.createElementVNode("button",{class:"act-btn",size:"mini",disabled:f.value,onClick:S},"取消",8,["disabled"])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(w,{type:"compose",size:"20",color:"#74c9e5",onClick:e=>(e=>{g.value=e.id,v.value=e.name})(a)},null,8,["onClick"]),e.createVNode(w,{type:"trash",size:"20",color:"#ff6666",onClick:e=>(async e=>{uni.showModal({title:"确认删除",success:async a=>{if(!a.confirm)return;const o=uni.getStorageSync("token");try{const t=(await uni.request({url:u.value+"/with-state/delete-account-type",method:"POST",header:{Authorization:o,"Content-Type":"application/json"},data:{id:e}})).data;if((null==t?void 0:t.status)&&"success"!==t.status)return void uni.showToast({title:(null==t?void 0:t.msg)||"删除失败",icon:"none"});await N(),"全部"===h.value||m.value.some((e=>e.name===h.value))||(h.value="全部",i("update-type","")),uni.showToast({title:"删除成功"})}catch(n){t("error","at components/stock-myitems/stock-myitems.vue:456","删除失败:",n),uni.showToast({title:n.errMsg||"请求失败",icon:"none"})}}})})(a.id)},null,8,["onClick"])],64))])])))),128)),0===m.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-types"},[e.createElementVNode("image",{class:"empty-folder",src:"/static/folder-empty.png"}),e.createElementVNode("text",{class:"empty-text"},"暂无自定义分类"),e.createElementVNode("text",{class:"empty-tip"},"请在下方添加新分类")])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{style:{height:"120rpx"}})]),e.createElementVNode("view",{class:"add-type-container"},[e.createElementVNode("view",{class:"add-type-form"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>d.value=e),placeholder:"输入新分类名称（≤10字）",class:"type-input",maxlength:"10"},null,512),[[e.vModelText,d.value,void 0,{trim:!0}]]),e.createElementVNode("button",{class:"add-btn",onClick:V},[e.createVNode(w,{type:"plus",size:"16",color:"#fff"}),e.createElementVNode("text",null,"添加分类")])]),D.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:"add-btn",style:{"margin-top":"10rpx"},loading:y.value,disabled:y.value||!D.value,onClick:I},[e.createVNode(w,{type:"save",size:"16",color:"#fff"}),e.createElementVNode("text",null,"保存排序")],8,["loading","disabled"])):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"hint-text"},"提示：用「上移/下移/置顶/置底」调整顺序，然后点“保存排序”。")])])])),_:1},8,["visible"])],64)}}},ne=V(oe,[["__scopeId","data-v-13998dd7"]]),le={__name:"common-page",props:{head_color:{type:String,default:"#ffffff"}},emits:["scroll"],setup(t,{emit:a}){e.useCssVars((e=>({"7c80f57e":s.value,"2db483a4":t.head_color,"435073e8":i.value})));const o=a,n=e=>{o("scroll",e.detail)},l=uni.getSystemInfoSync();e.computed((()=>0));const s=e.computed((()=>`${l.statusBarHeight||0}px`)),i=e.computed((()=>{var e;return`${((null==(e=l.safeAreaInsets)?void 0:e.bottom)||0)+20}px`}));return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"header-placeholder"}),e.createElementVNode("view",{class:"content-container"},[e.createElementVNode("view",{class:"main-content","scroll-y":"",onScroll:n},[e.renderSlot(t.$slots,"default",{},void 0,!0)],32)]),e.createElementVNode("view",{class:"footer-placeholder"})]))}},se=V(le,[["__scopeId","data-v-a407fc63"]]),ie=V({__name:"stock",setup(o){const l=uni.getSystemInfoSync();e.ref(l.statusBarHeight);const s=e.ref(1),i=e.ref(1);function r(){return s.value>1?["fade","slide-left"]:["fade","slide-right"]}function c(e){const a=s.value;switch(i.value=a,s.value=e,t("log","at pages/stock/stock.vue:190",`从 tab ${a} 切换到 tab ${e}，方向: ${r()}`),e){case 1:w();break;case 2:_();break;case 3:k()}}function d(e){let t=0,a=0;return e.forEach((e=>{const o=parseFloat(e.price)||0;t+=o,1===e.status&&(a+=o)})),`${a.toFixed(1)}/${t.toFixed(1)}`}const m=e=>{t("log","at pages/stock/stock.vue:230","更新账本列表"),w(e)};function p(){switch(s.value){case 1:uni.navigateTo({url:"/pages/stock/account_book_form/account_book_form"});break;case 2:uni.navigateTo({url:"/pages/stock/showcase_form/showcase_form"});break;case 3:V(!1)}}const g=e.ref({}),v=e.ref({}),y=e.ref({});function w(e){if(t("log","at pages/stock/stock.vue:264",h),!h.isLogin)return g.value={},v.value={},void(y.value={});let a=uni.getStorageSync("token"),o=u.value+"/with-state/account-book";e&&"全部"!==e&&(o=u.value+"/with-state/account-book?type="+e),uni.request({url:o,method:"GET",header:{Authorization:a},success:e=>{t("log","at pages/stock/stock.vue:286",e.data.data),g.value=e.data.data},fail:e=>{t("log","at pages/stock/stock.vue:290",e)}})}function _(){if(t("log","at pages/stock/stock.vue:297",h),!h.isLogin)return;let e=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/showcase",method:"GET",header:{Authorization:e},success:e=>{t("log","at pages/stock/stock.vue:311",e.data.data),v.value=e.data.data},fail:e=>{t("log","at pages/stock/stock.vue:315",e)}})}function k(){if(t("log","at pages/stock/stock.vue:324",h),!h.isLogin)return;let e=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/tail-bill",method:"GET",header:{Authorization:e},success:e=>{t("log","at pages/stock/stock.vue:338",e.data.data),y.value=e.data.data},fail:e=>{t("log","at pages/stock/stock.vue:342",e)}})}function N(e){uni.navigateTo({url:"/pages/stock/account_book_form/account_book_form?account_book_id="+e})}function V(e){0!=e?uni.navigateTo({url:"/pages/stock/bill_form/bill_form?bill_id="+e}):uni.navigateTo({url:"/pages/stock/bill_form/bill_form"})}return n((()=>{f().then((e=>{switch(s.value){case 1:w();break;case 2:_();break;case 3:k()}}))})),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E),l=a(e.resolveDynamicComponent("stock-myitems"),ne),i=a(e.resolveDynamicComponent("uni-transition"),B),u=a(e.resolveDynamicComponent("uni-icons"),b),h=a(e.resolveDynamicComponent("common-modal"),T),f=a(e.resolveDynamicComponent("common-page"),se);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#d8deff"}),e.createVNode(n),e.createVNode(f,{head_color:"#d8deff"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"container",style:{overflow:"hidden"}},[e.createElementVNode("view",{class:"head_container"},[e.createElementVNode("view",{class:"switch_tab"},[e.createElementVNode("button",{onClick:o[0]||(o[0]=e=>c(1)),class:e.normalizeClass(["font-alimamashuhei",{active:1===s.value}])},[e.createElementVNode("image",{class:"tab_img",src:"/static/new-icon/myitems.png",mode:"widthFix",style:{width:"160rpx",opacity:"0.9"}})],2),e.createElementVNode("button",{onClick:o[1]||(o[1]=e=>c(2)),class:e.normalizeClass(["font-alimamashuhei",{active:2===s.value}])},[e.createElementVNode("image",{class:"tab_img",src:"/static/new-icon/showcase.png",mode:"widthFix",style:{width:"130rpx",opacity:"0.9"}})],2),e.createElementVNode("button",{onClick:o[2]||(o[2]=e=>c(3)),class:e.normalizeClass(["font-alimamashuhei",{active:3===s.value}])},[e.createElementVNode("image",{class:"tab_img",src:"/static/new-icon/calendar.png",mode:"widthFix",style:{width:"160rpx",opacity:"0.9"}})],2)])]),e.createElementVNode("view",{class:"data_body"},[e.createVNode(i,{name:r(),"mode-class":["fade","slide-bottom"],duration:300,show:1===s.value},{default:e.withCtx((()=>[e.createVNode(l,{accountBookData:g.value,onGo2editor:N,onUpdateType:m},null,8,["accountBookData"])])),_:1},8,["name","show"]),e.createVNode(i,{name:r(),"mode-class":["fade","slide-bottom"],duration:300,show:2===s.value},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tab_body_sec"},[v.value.showcases&&v.value.showcases.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"showcase-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value.showcases,((t,a)=>{return e.openBlock(),e.createElementBlock("view",{key:a,class:"showcase-card",onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/stock/showcase_form/showcase_form?showcase_id="+a});var a}},[1!==t.display?(e.openBlock(),e.createElementBlock("view",{key:0,class:"status-overlay"},[e.createElementVNode("text",{class:"status-text"},e.toDisplayString((o=t.display,{0:"审核中",2:"人工复核中",3:"违规隐藏中"}[o]||"")),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["card-content",{"blur-effect":1!==t.display}])},[e.createElementVNode("image",{src:t.image_url_list[0],mode:"aspectFill",class:"showcase-image"},null,8,["src"]),e.createElementVNode("view",{class:"showcase-info"},[e.createElementVNode("text",{class:"showcase-title one_line_text"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"showcase-description multi_line_text"},e.toDisplayString(t.description),1),e.createElementVNode("view",{class:"interaction-bar"},[e.createElementVNode("view",{class:"interaction-item"},[e.createElementVNode("image",{src:"/static/eye.png",class:"interaction-icon"}),e.createElementVNode("text",{class:"interaction-count"},e.toDisplayString(t.views||0),1)]),e.createElementVNode("view",{class:"interaction-item"},[e.createElementVNode("image",{src:"/static/6.png",class:"interaction-icon"}),e.createElementVNode("text",{class:"interaction-count"},e.toDisplayString(t.like_count||0),1)])])])],2)],8,["onClick"]);var o})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:ee}),e.createElementVNode("text",{class:"empty-text"},"展示柜空空如也"),e.createElementVNode("text",{class:"empty-tip"},"快来创建你的展示空间吧！")]))])])),_:1},8,["name","show"]),e.createVNode(i,{name:r(),"mode-class":["fade","slide-bottom"],duration:300,show:3===s.value},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tab_body_3th"},[Object.keys(y.value).length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"calendar-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[e.createElementVNode("view",{class:"month-header-container"},[e.createElementVNode("text",{class:"month-header font-alimamashuhei"},e.toDisplayString(a)+" 账单",1),e.createElementVNode("text",{class:"month-stats"},e.toDisplayString(d(t)),1)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"bill-item",onClick:e=>V(t.id)},[e.createElementVNode("view",{class:"bill-left"},[e.createElementVNode("view",{class:"bill-name-container"},[e.createElementVNode("text",{class:"bill-name"},e.toDisplayString(t.name),1)]),e.createElementVNode("view",{class:"due-amount-container"},[e.createElementVNode("text",{class:"due-label"},"待补款:"),e.createElementVNode("text",{class:"due-amount"},"¥"+e.toDisplayString(t.price),1)])]),e.createElementVNode("view",{class:"bill-right"},[e.createElementVNode("view",{class:"date-container"},[e.createElementVNode("text",{class:"date-text"},"日期: "+e.toDisplayString(t.ymd),1)]),e.createElementVNode("view",{class:"status-container"},[e.createElementVNode("text",{class:e.normalizeClass(["status-text",{paid:1===t.status}])},e.toDisplayString(0===t.status?"未补款":"已补款"),3)])])],8,["onClick"])))),128))])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:ee}),e.createElementVNode("text",{class:"empty-text"},"暂无待补尾款"),e.createElementVNode("text",{class:"empty-tip"},"增加添加一个到账本试试吧～")]))])])),_:1},8,["name","show"])])]),e.createVNode(h,{visible:t.typeModalVisible,"onUpdate:visible":o[5]||(o[5]=e=>t.typeModalVisible=e),top:"300rpx",height:"60%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"type-modal"},[e.createElementVNode("view",{class:"type-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.customTypes,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"type-item"},[e.createElementVNode("text",null,e.toDisplayString(a.name),1),e.createVNode(u,{type:"trash",size:"22",color:"#ff6666",onClick:e=>t.deleteType(a.id)},null,8,["onClick"])])))),128))]),e.createElementVNode("view",{class:"add-type-form"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>t.newTypeName=e),placeholder:"输入新分类名称",class:"type-input"},null,512),[[e.vModelText,t.newTypeName]]),e.createElementVNode("button",{class:"add-btn",onClick:o[4]||(o[4]=(...e)=>t.addNewType&&t.addNewType(...e))},"添加分类")])])])),_:1},8,["visible"]),e.createElementVNode("view",{class:"unified-floating-button",onClick:p},[e.createVNode(u,{type:"plusempty",size:"30",color:"#fff"})])])),_:1})],64)}}},[["__scopeId","data-v-df461b97"]]),re={__name:"mine",setup(o){e.useCssVars((e=>({30747768:L.value}))),t("log","at pages/mine/mine.vue:181",h.isLogin),t("log","at pages/mine/mine.vue:182",h.userInfo);let l=e.ref(""),s=e.ref(""),i=e.ref(0),r=e.ref(0),c=e.ref(0);e.ref(!1);let d=y(),m=e.ref(!1);function p(e){m.value=e.detail.value.length>0}function f(){uni.navigateTo({url:"/pages/private/private"})}function w(){uni.navigateTo({url:"/pages/permission/permission"})}function _(){uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),h.isLogin=!1}function k(){uni.navigateTo({url:"/pages/register/register"})}function N(){uni.navigateTo({url:"/pages/user_like/user_like"})}function V(){uni.showTabBar({animation:!1}),uni.switchTab({url:"/pages/index/index"})}function x(){uni.navigateTo({url:"/pages/my_comment/my_comment"})}function S(){uni.navigateTo({url:"/pages/message_list/message_list"})}function C(){uni.navigateTo({url:"/pages/reset_password/reset_password"})}function B(){uni.navigateTo({url:"/pages/my_collocation/my_collocation"})}function T(){new Promise((e=>{uni.chooseImage({count:1,success:t=>{e(t.tempFilePaths[0])}})})).then((e=>{uni.navigateTo({url:`/pages/pop_croper/pop_croper?src=${decodeURIComponent(e)}`})}))}const D=async()=>{uni.navigateTo({url:"/pages/creator_base/creator_base"})};function I(e){t("log","at pages/mine/mine.vue:365","croperPath:"+e);let a=uni.getStorageSync("token"),o="";uni.request({url:u.value+"/with-state/qiniu-token",method:"POST",header:{Authorization:a},success:a=>{if(null==a.data.data||""==a.data.data.token)return void uni.showToast({title:"获取上传凭证失败",icon:"none"});o=a.data.data.token,t("log","at pages/mine/mine.vue:385","获取到的七牛token："+a.data.data.token),t("log","at pages/mine/mine.vue:387",uni.getStorageSync("userInfo"));let n=a.data.data.path;t("log","at pages/mine/mine.vue:390","fileName:"+n),uni.uploadFile({url:"https://up-cn-east-2.qiniup.com",name:"file",method:"POST",filePath:e,fileType:"image",formData:{token:o,key:n,scope:"hobby-box:"+n},success:e=>{t("log","at pages/mine/mine.vue:405","上传成功"),function(e,a){let o=uni.getStorageSync("token");uni.getStorageSync("userInfo"),uni.request({url:u.value+"/with-state/update-profile",method:"POST",header:{Authorization:o},data:{avatar:a},success:e=>{t("log","at pages/mine/mine.vue:445","更新成功"),v()},fail:e=>{uni.showToast({title:"更新失败",icon:"none"})}})}(0,"https://images1.fantuanpu.com/"+n)},fail:e=>{t("log","at pages/mine/mine.vue:412",e),uni.showToast({title:"上传失败",icon:"none"})}})},fail:e=>{uni.showToast({title:"获取上传凭证失败",icon:"none"})}})}function z(){if(!m.value)return void uni.showToast({title:"请先阅读并同意协议",icon:"none"});if(""==s.value||""==l.value)return void uni.showToast({title:"请输入手机号和密码",icon:"none"});if(!/^1[3456789]\d{9}$/.test(l.value))return void uni.showToast({title:"手机号格式错误",icon:"none"});if(s.value.length<6)return void uni.showToast({title:"密码必须大于6位",icon:"none"});let e=l.value,a=s.value;uni.request({url:u.value+"/login",method:"POST",data:{account:e,password:a},success:e=>{t("log","at pages/mine/mine.vue:505",e);let a=e.data.data;"success"==e.data.status?(uni.setStorageSync("token",a.jwt_token),uni.setStorageSync("openid",a.open_id),uni.setStorageSync("session_key",a.session_key),t("log","at pages/mine/mine.vue:520","jwt:"+a.jwt_token),null!=a.jwt_token&&""!=a.jwt_token&&v()):uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{uni.showToast({title:"登录失败",icon:"none"})}})}function A(){uni.navigateTo({url:"/pages/setting/setting"})}const P=uni.getSystemInfoSync();e.computed((()=>0));const L=e.computed((()=>`${P.statusBarHeight||0}px`));function $(){uni.navigateTo({url:"/pages/article_detail/article_detail?id=3"})}return e.watch((()=>h.isLogin),(e=>{t("log","at pages/mine/mine.vue:582","watch",e),e?uni.showTabBar({animation:!1}):uni.hideTabBar({animation:!1})})),n((()=>{v(),h.isLogin?uni.showTabBar({animation:!1}):uni.hideTabBar({animation:!1}),(async()=>{try{const e=await uni.request({url:`${u.value}/with-state/unread-message-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(i.value=e.data.data.count)}catch(e){t("log","at pages/mine/mine.vue:307",e),uni.showToast({title:"未读数获取失败",icon:"none"})}})(),(async()=>{try{const e=await uni.request({url:`${u.value}/with-state/user-likes-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(r.value=e.data.data.count)}catch(e){t("log","at pages/mine/mine.vue:334",e),uni.showToast({title:"关注数获取失败",icon:"none"})}})(),(async()=>{try{const e=await uni.request({url:`${u.value}/with-state/my-collocation-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(c.value=e.data.data)}catch(e){t("log","at pages/mine/mine.vue:356",e),uni.showToast({title:"搭配数获取失败",icon:"none"})}})();const e=getCurrentPages(),a=e[e.length-1];a.returnParam&&I(a.returnParam)})),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E),u=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#e0f3ff"}),e.createVNode(n),e.createElementVNode("view",{head_color:"url('/static/bg/bg2.jpg')"},[e.createElementVNode("view",{class:"container"},[e.unref(h).isLogin?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"mine"},[e.createElementVNode("view",{class:"header-placeholders"}),e.createElementVNode("view",{class:"full-width"},[e.createElementVNode("view",{class:"avatar-container"},[e.createElementVNode("image",{mode:"aspectFill",class:"mine-page-avatar",src:e.unref(h).userInfo.avatar,onClick:T},null,8,["src"])]),e.createElementVNode("view",{class:"user-info-container"},[e.createElementVNode("text",{class:"username-text font-alimamashuhei"},e.toDisplayString(e.unref(h).userInfo.username),1),e.createElementVNode("text",{class:"user-id-text"},[e.createElementVNode("text",{class:"font-alimamashuhei",style:{color:"#fff","font-size":"22rpx"}},"ID"),e.createTextVNode(" : "+e.toDisplayString(e.unref(h).userInfo.id),1)])]),e.createElementVNode("view",{class:"clearfix"})]),e.createElementVNode("view",{class:"pageinfo-infobox"},[e.createElementVNode("view",{class:"info-item",onClick:N},[e.createElementVNode("text",{class:"mine-info-number font-alimamashuhei"},e.toDisplayString(e.unref(r)),1),e.createElementVNode("text",{class:"info-tap font-alimamashuhei"},"关注")]),e.createElementVNode("view",{class:"info-item",onClick:S},[e.createElementVNode("text",{class:"mine-info-number font-alimamashuhei"},e.toDisplayString(e.unref(i)),1),e.createElementVNode("text",{class:"info-tap font-alimamashuhei"},"消息")]),e.createElementVNode("view",{class:"info-item",onClick:B},[e.createElementVNode("text",{class:"mine-info-number font-alimamashuhei"},e.toDisplayString(e.unref(c)),1),e.createElementVNode("text",{class:"info-tap font-alimamashuhei"},"搭配")])])]),e.createElementVNode("view",{class:"main-padding"},[e.createElementVNode("view",{class:"button-container"},[e.createElementVNode("view",{class:"mine-button-item",onClick:x},[e.createElementVNode("view",{class:"button-content"},[e.createVNode(u,{type:"chatboxes",size:"24",color:"#606060"}),e.createElementVNode("text",{class:"button-text"},"我的帖子")]),e.createVNode(u,{type:"right",size:"24",color:"#c0c0c0"})]),e.createElementVNode("view",{class:"mine-button-item",onClick:A},[e.createElementVNode("view",{class:"button-content"},[e.createVNode(u,{type:"gear",size:"24",color:"#606060"}),e.createElementVNode("text",{class:"button-text"},"账号设置")]),e.createVNode(u,{type:"right",size:"24",color:"#c0c0c0"})]),e.createElementVNode("view",{class:"mine-button-item",onClick:D},[e.createElementVNode("view",{class:"button-content"},[e.createVNode(u,{type:"shop",size:"24",color:"#606060"}),e.createElementVNode("text",{class:"button-text"},"作者入驻")]),e.createVNode(u,{type:"right",size:"24",color:"#c0c0c0"})]),e.createElementVNode("view",{class:"mine-button-item last-button",onClick:_},[e.createElementVNode("view",{class:"button-content"},[e.createVNode(u,{type:"arrow-right",size:"24",color:"#606060"}),e.createElementVNode("text",{class:"button-text"},"退出账号")]),e.createVNode(u,{type:"right",size:"24",color:"#c0c0c0"})])])]),e.createElementVNode("view",{class:"platform-announcement",onClick:$},[e.createElementVNode("text",{class:"announcement-text"},"平台公告")])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"unlogin-container"},[e.createElementVNode("view",{class:"header-placeholders"}),e.createElementVNode("image",{src:"https://images1.fantuanpu.com/home/jpt.gif",mode:"aspectFit",style:{width:"360rpx",height:"380rpx",position:"relative",right:"20rpx"}}),e.createElementVNode("text",{class:"welcome-text"},"欢迎使用娃圈狗狗助手"),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-with-icon"},[e.createElementVNode("image",{class:"icon",src:"/static/user.png"}),e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:"请输入手机号",class:"inputer","onUpdate:modelValue":o[0]||(o[0]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]])]),e.createElementVNode("view",{class:"input-with-icon"},[e.createElementVNode("image",{class:"icon",src:"/static/key.png"}),e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"请输入密码",class:"inputer","onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(s)?s.value=t:s=t)},null,512),[[e.vModelText,e.unref(s)]])])]),e.createElementVNode("view",{class:"action-links"},[e.createElementVNode("text",{class:"float-left",onClick:k},"注册账号"),e.createElementVNode("text",{class:"float-right",onClick:C},"忘记密码"),e.createElementVNode("view",{class:"clearfix"})]),e.createElementVNode("button",{class:"submit-btn",onClick:z},"立即登录"),4==e.unref(d)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"submit-btn",onClick:o[2]||(o[2]=(...t)=>e.unref(g)&&e.unref(g)(...t))},"微信登录")):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"submit-btn",onClick:V,style:{background:"linear-gradient(135deg, #cdcdcd, #b1b1b1)"}},"随便看看→"),e.createElementVNode("view",{class:"agreement-container"},[e.createElementVNode("checkbox-group",{onChange:p},[e.createElementVNode("label",{class:"agreement-label"},[e.createElementVNode("checkbox",{checked:e.unref(m),color:"#65C3D6",style:{transform:"scale(0.8)"}},null,8,["checked"]),e.createElementVNode("text",{class:"agreement-text"},"我已阅读并同意")])],32),e.createElementVNode("view",{class:"agreement-links"},[e.createElementVNode("text",{class:"agreement-link",onClick:f},"《隐私政策》"),e.createElementVNode("text",{class:"agreement-link",onClick:w},"《用户协议》")])])]))])])],64)}}},ce=V(re,[["__scopeId","data-v-1674d1e8"]]),ue={__name:"watch_demo",setup(a){const o=e.ref({name:"john",age:18});return e.watch((()=>o.value.name),((e,a)=>{t("log","at pages/watch_demo/watch_demo.vue:14","newVal",e),t("log","at pages/watch_demo/watch_demo.vue:15","oldVal",a)}),{deep:!0}),(t,a)=>(e.openBlock(),e.createElementBlock("view",null,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>o.value.name=e)},null,512),[[e.vModelText,o.value.name]]),e.createElementVNode("text",null,e.toDisplayString(o.value.name),1),e.createElementVNode("footer")]))}},de=V({__name:"item-impression",props:{target_id:{type:String,required:!0},type:{type:String,required:!0},goodsType:{type:Number,required:!0}},setup(o){const n=o,l=e.ref([]),s=e.ref([]),i=e.ref(0),r=e.ref(""),c=e.ref(!1),d=e.ref(null),m=e.computed((()=>{const e={};l.value.forEach((t=>{e[t.content]=t}));return[...s.value.map((t=>e[t]?{...e[t],isDefault:!0}:{content:t,count:0,selected:!1,isDefault:!0})),...l.value.filter((e=>!s.value.includes(e.content)))].sort(((e,t)=>t.count-e.count))})),p=async()=>{try{d.value=await f();const e=await uni.request({url:`${u.value}/impression/counts`,method:"GET",data:{target_id:parseInt(n.target_id,10),type_id:parseInt(n.type,10)}}),t=await uni.request({url:`${u.value}/with-state/impression/status`,method:"GET",data:{target_id:parseInt(n.target_id,10),type_id:parseInt(n.type,10)},header:{Authorization:uni.getStorageSync("token")}});if(200===e.statusCode&&"success"===e.data.status){const a=e.data.data;i.value=a.reduce(((e,t)=>e+t.count),0);const o=200===t.statusCode&&"success"===t.data.status?t.data.data.map((e=>e.id)):[];l.value=a.map((e=>({...e,selected:o.includes(e.id)})))}}catch(e){t("error","at components/item-impression/item-impression.vue:222","获取表态数据失败:",e),uni.showToast({title:"获取表态数据失败",icon:"none"})}},h=(e,t,a=null)=>{const o=l.value.findIndex((t=>t.id===e.id||t.content===e.content));if(-1===o&&t){const t={id:a,content:e.content,count:1,selected:!0};return l.value=[...l.value,t],void i.value++}if(-1!==o){const e=[...l.value],n={...e[o]};t?(n.selected=!0,n.count=(n.count||0)+1,a&&(n.id=a),i.value++):(n.selected=!1,n.count=Math.max(0,n.count-1),i.value--),e[o]=n,l.value=e}},g=()=>{d.value?(r.value="",c.value=!0):uni.showToast({title:"请先登录",icon:"none"})},v=()=>{c.value=!1},y=async()=>{if(r.value.trim())try{const e=await uni.request({url:`${u.value}/with-state/impression/add`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{target_id:parseInt(n.target_id,10),type_id:parseInt(n.type,10),content:r.value.trim()}});200===e.statusCode&&"success"===e.data.status&&(l.value=[...l.value,{id:e.data.data.impression_id,content:r.value.trim(),count:1,selected:!0}],i.value++,c.value=!1,uni.showToast({title:"添加成功",icon:"success"}))}catch(e){t("error","at components/item-impression/item-impression.vue:411","添加表态失败:",e),uni.showToast({title:"添加表态失败",icon:"none"})}else uni.showToast({title:"请输入表态内容",icon:"none"})};return e.watch((()=>[n.target_id,n.type]),p,{immediate:!0}),e.onMounted((()=>{(async()=>{try{let e=9;switch(n.goodsType){case"整体":e=1;break;case"单头":e=2;break;case"娃衣":e=3;break;case"眼珠":e=4;break;case"假发":e=5;break;default:e=9}const a=await uni.request({url:`${u.value}/impression/default`,method:"GET",data:{type:e}});200===a.statusCode&&"success"===a.data.status?s.value=a.data.data:(t("error","at components/item-impression/item-impression.vue:160","获取默认表态失败:",a.data),uni.showToast({title:"获取默认表态失败",icon:"none"}))}catch(e){t("error","at components/item-impression/item-impression.vue:167","获取默认表态失败:",e),uni.showToast({title:"获取默认表态失败",icon:"none"})}})(),p()})),(o,l)=>{const s=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createElementBlock("view",{class:"impression-container"},[e.createElementVNode("view",{class:"impression-header"},[e.createElementVNode("text",{class:"title"},"你对它的印象怎样？"),e.createElementVNode("text",{class:"subtitle"},"（轻触表态）")]),e.createElementVNode("view",{class:"impression-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id||"default-"+a.content,class:e.normalizeClass(["impression-item",{active:a.selected}]),onClick:e=>(async e=>{if(d.value)try{const t={target_id:parseInt(n.target_id,10),type_id:parseInt(n.type,10)};if(e.isDefault&&!e.id?t.content=e.content:t.impression_id=e.id,e.selected){const t=await uni.request({url:`${u.value}/with-state/impression/remove`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{impression_id:e.id}});200===t.statusCode&&"success"===t.data.status&&h(e,!1)}else{const a=await uni.request({url:`${u.value}/with-state/impression/add`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:t});200===a.statusCode&&"success"===a.data.status&&h(e,!0,a.data.data.impression_id)}}catch(a){t("error","at components/item-impression/item-impression.vue:291","操作失败:",a),uni.showToast({title:"操作失败",icon:"none"})}else uni.showToast({title:"请先登录",icon:"none"})})(a)},[e.createElementVNode("text",{class:"impression-text"},e.toDisplayString(a.content),1),e.createElementVNode("text",{class:e.normalizeClass(["impression-count",{highlight:a.count>0}])},e.toDisplayString(a.count),3)],10,["onClick"])))),128)),e.createElementVNode("view",{class:"add-impression",onClick:g},[e.createElementVNode("text",{class:"plus-icon"},"+"),e.createElementVNode("text",{class:"add-text"},"添加表态")])]),e.createVNode(s,{visible:c.value,"onUpdate:visible":l[1]||(l[1]=e=>c.value=e),width:"80%",top:"30%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("text",{class:"modal-title"},"添加新表态"),e.withDirectives(e.createElementVNode("input",{class:"input-field","onUpdate:modelValue":l[0]||(l[0]=e=>r.value=e),placeholder:"请输入表态内容","placeholder-style":"color: #aaa;",onConfirm:y},null,544),[[e.vModelText,r.value]]),e.createElementVNode("view",{class:"modal-actions"},[e.createElementVNode("button",{class:"cancel-btn",onClick:v},"取消"),e.createElementVNode("button",{class:"confirm-btn",onClick:y},"确定")])])])),_:1},8,["visible"])])}}},[["__scopeId","data-v-0c133750"]]),me=V({__name:"report-button",props:{reportType:{type:Number,required:!0},relationId:{type:Number,required:!0},buttonText:{type:String,default:"举报"},iconType:{type:String,default:""},iconSize:{type:String,default:24},iconColor:{type:String,default:"#999"},themeColor:{type:String,default:"#64c6dc"},autoFocus:{type:Boolean,default:!1}},emits:["success","error","cancel","before-submit"],setup(t,{emit:o}){const n=t,l=o,s=e.ref(!1),i=e.ref([]),r=e.ref(""),c=e.ref(""),d=e.ref(!1),m=async()=>{await(async()=>{try{const e=uni.getStorageSync("token"),t=await uni.request({url:`${u.value}/report/reasons?type=${n.reportType}`,method:"GET",header:{Authorization:e}});return"success"===t.data.status?(i.value=t.data.data,!0):(uni.showToast({title:"获取举报原因失败: "+(t.data.msg||""),icon:"none"}),!1)}catch(e){return uni.showToast({title:"网络请求失败",icon:"none"}),!1}})()&&(r.value="",c.value="",s.value=!0)},p=async()=>{if(!d.value){d.value=!0;try{if(!r.value)return void uni.showToast({title:"请选择举报原因",icon:"none"});l("before-submit",{type:n.reportType,relationId:n.relationId,reason:r.value,details:c.value});const e=uni.getStorageSync("token"),t={type:n.reportType,relation_id:n.relationId,reason:r.value,details:c.value};let a=`${u.value}/with-state/report/submit`;""==e&&(a=`${u.value}/report/submit`);const o=await uni.request({url:a,method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:t,timeout:1e4});"success"===o.data.status?(uni.showToast({title:"举报提交成功",icon:"success",duration:2e3}),s.value=!1,l("success",o.data)):(uni.showToast({title:o.data.msg||"举报提交失败",icon:"none"}),l("error",o.data))}catch(e){uni.showToast({title:"举报提交失败: "+(e.errMsg||"网络错误"),icon:"none"}),l("error",e)}finally{d.value=!1}}};return e.watch(s,(e=>{e||l("cancel")})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"report-button",onClick:m},[e.renderSlot(o.$slots,"default",{},(()=>[e.createElementVNode("view",{class:"default-button horizontal"},[e.createVNode(l,{"v-if":""!==t.iconType,type:t.iconType,size:parseInt(t.iconSize),color:t.iconColor},null,8,["v-if","type","size","color"]),e.createElementVNode("text",{class:"button-text"},e.toDisplayString(t.buttonText),1)])]),!0)]),e.createVNode(u,{visible:s.value,"onUpdate:visible":n[3]||(n[3]=e=>s.value=e),top:"10vh"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"report-dialog"},[e.createElementVNode("view",{class:"dialog-header"},[e.createElementVNode("text",{class:"dialog-title"},"举报内容"),e.createVNode(l,{type:"closeempty",size:"24",color:"#999",onClick:n[0]||(n[0]=e=>s.value=!1)})]),e.createElementVNode("view",{class:"reason-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:e.normalizeClass(["reason-item",{selected:r.value===a.label}]),onClick:e=>(e=>{r.value===e?r.value="":r.value=e})(a.label)},[e.createElementVNode("radio",{value:a.label,checked:r.value===a.label,color:t.themeColor},null,8,["value","checked","color"]),e.createElementVNode("text",{class:"reason-label"},e.toDisplayString(a.label),1)],10,["onClick"])))),128))]),e.createElementVNode("view",{class:"details-box"},[e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":n[1]||(n[1]=e=>c.value=e),placeholder:"请详细描述举报原因（选填）",class:"details-input",maxlength:"200",focus:t.autoFocus},null,8,["focus"]),[[e.vModelText,c.value]]),e.createElementVNode("text",{class:"word-count"},e.toDisplayString(c.value.length)+"/200",1)]),e.createElementVNode("view",{class:"button-group"},[e.createElementVNode("button",{class:"cancel-btn",onClick:n[2]||(n[2]=e=>s.value=!1)},"取消"),e.createElementVNode("button",{class:"submit-btn",onClick:p,style:e.normalizeStyle({backgroundColor:t.themeColor})},"提交举报",4)])])])),_:1},8,["visible"])],64)}}},[["__scopeId","data-v-19e1bfb5"]]),pe=V({__name:"attitude-widget",props:{targetId:Number,type:Number,attitudeStatus:{type:Number,default:0},attitudeCounts:{type:Object,default:()=>({})}},emits:["change"],setup(o,{emit:n}){const l=o,s=n,i=e.ref(!1),r=e.ref(l.attitudeStatus),c=e.ref({}),d=e.ref([{emoji:"😝",value:1,label:"很有趣"},{emoji:"😨",value:2,label:"这个..."},{emoji:"🤤",value:3,label:"我也想要"},{emoji:"🤦‍♀️",value:4,label:"难以直视"},{emoji:"🔴",value:5,label:"谁的鼻子掉了?"}]);e.watch((()=>l.attitudeCounts),(e=>{d.value.forEach((t=>{c.value[t.value]=Number(e[t.value]??0)})),c.value={...c.value}}),{immediate:!0,deep:!0});const m=e.computed((()=>d.value.map((e=>({...e,count:c.value[e.value]||0}))).filter((e=>e.count>0||e.value===r.value)).filter((e=>e.count>0)))),p=()=>{i.value=!i.value};return(o,n)=>{const h=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"attitude-container"},[i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"mask",onClick:e.withModifiers(p,["stop"]),onTouchmove:n[0]||(n[0]=e.withModifiers((()=>{}),["stop","prevent"]))},null,32)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"counts-and-expand"},[e.createElementVNode("view",{class:"global-counts"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.value,class:e.normalizeClass(["count-item",{active:r.value===t.value,"has-count":t.count>0}])},[e.createElementVNode("text",{class:"emoji"},e.toDisplayString(t.emoji),1),e.createElementVNode("text",{class:"count"},e.toDisplayString(t.count),1)],2)))),128))]),e.createElementVNode("view",{class:"expand-btn",onClick:e.withModifiers(p,["stop"])},[e.createVNode(h,{type:i.value?"arrowup":"plus",size:"16",color:"#888"},null,8,["type"]),e.createElementVNode("text",{class:"btn-text"},e.toDisplayString(i.value?"收起":"表态"),1)])]),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"attitude-panel"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.value,class:e.normalizeClass(["attitude-btn",{active:r.value===a.value}]),onClick:e.withModifiers((e=>(async e=>{try{const a=uni.getStorageSync("token");if(t("log","at components/attitude-widget/attitude-widget.vue:130",a),!a)return void uni.showToast({title:"请先登录",icon:"none"});const o=r.value===e,n=`${u.value}/with-state/attitude/${o?"remove":"add"}`;"success"===(await uni.request({url:n,method:"POST",data:{target_id:l.targetId,type:l.type,action_type:e},header:{Authorization:a}})).data.status&&(o?(c.value[e]--,r.value=0):(r.value>0&&c.value[r.value]--,r.value=e,c.value[e]=(c.value[e]||0)+1),s("change",{status:r.value,counts:{...c.value}}),i.value=!1)}catch(a){t("log","at components/attitude-widget/attitude-widget.vue:178",a),uni.showToast({title:"操作失败",icon:"none"})}})(a.value)),["stop"])},[e.createElementVNode("text",{class:"emoji"},e.toDisplayString(a.emoji),1),e.createElementVNode("view",{class:"text-container"},[e.createElementVNode("text",{class:"label"},e.toDisplayString(a.label),1)])],10,["onClick"])))),128))])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-dfe59db2"]]),he=V({__name:"comment-list",props:{type:{type:Number,required:!0},relationId:{type:Number,required:!0}},emits:["reply"],setup(o,{expose:n,emit:l}){const s=o,i=e.ref([]),r=e.ref(1),c=e.ref(0),d=e.ref(!0);e.reactive({});const m=l,p=e.ref(!1),g=e.ref({}),v=(e,{status:t,counts:a})=>{e.attitudeStatus=t,e.attitudeCounts=a};n({addNewComment:e=>{const t={...e,isTemp:!0,showAll:!1,localChildren:[],childTotal:0};g.value[e.id]=t,i.value.unshift(t)},addReplyComment:e=>{const t=e.parent_id,a=i.value.find((e=>e.id===t));if(a){const t={...e,isTemp:!0};g.value[e.id]=t,a.localChildren||(a.localChildren=[]),"number"!=typeof a.childTotal&&(a.childTotal=0),a.localChildren.unshift(t),a.childTotal+=1,!a.showAll&&a.childTotal<=5&&(a.showAll=!0)}},updateTempComment:(e,t)=>{const a=i.value.findIndex((t=>t.id===e));if(-1!==a)return i.value[a]={...t,showAll:i.value[a].showAll,localChildren:i.value[a].localChildren||[],childTotal:i.value[a].childTotal||0},void delete g.value[e];for(const o of i.value)if(o.localChildren&&o.localChildren.length){const a=o.localChildren.findIndex((t=>t.id===e));if(-1!==a)return o.localChildren[a]={...t,parent_id:o.localChildren[a].parent_id},void delete g.value[e]}},removeTempComment:e=>{const t=i.value.findIndex((t=>t.id===e));if(-1!==t)return i.value.splice(t,1),void delete g.value[e];for(const a of i.value)if(a.localChildren&&a.localChildren.length){const t=a.localChildren.findIndex((t=>t.id===e));if(-1!==t)return a.localChildren.splice(t,1),a.childTotal=Math.max(0,a.childTotal-1),void delete g.value[e]}}}),e.onMounted((()=>{V()}));const f=e=>!e.showAll&&e.localChildren.length>5?e.localChildren.slice(0,5):e.localChildren,y=async()=>{if(!p.value&&d.value)try{p.value=!0,r.value+=1,await V()}finally{p.value=!1}},w=e=>{uni.previewImage({urls:[e],current:e})},_=async e=>{if(h.isLogin)try{const t=uni.getStorageSync("token"),a=`${u.value}/with-state/${e.user_like?"unlike":"add-like"}`,o=await uni.request({url:a,method:"POST",header:{Authorization:t},data:{id:e.id,type:6}});"success"===o.data.status?(e.user_like=!e.user_like,e.user_like?e.like_count=(e.like_count||0)+1:e.like_count=Math.max(0,(e.like_count||0)-1),uni.showToast({title:e.user_like?"点赞成功":"已取消点赞",icon:"none"})):uni.showToast({title:o.data.msg||"操作失败",icon:"none"})}catch(a){t("error","at components/comment-list/comment-list.vue:398","点赞失败:",a),uni.showToast({title:"操作失败",icon:"none"})}else uni.showToast({title:"请先登录",icon:"none"})},k=e=>{uni.navigateTo({url:"/pages/user_page/user_page?uid="+e})},E=e=>{const t=new Date(1e3*e);return`${t.getMonth()+1}-${t.getDate()} ${t.getHours()}:${t.getMinutes()}`},N=e=>e?e.length>12?e.slice(0,12)+"...":e:"未知用户",V=async()=>{try{p.value=!0;let e=uni.getStorageSync("token");const a=await uni.request({url:`${u.value}/get-comments`,data:{relation_id:s.relationId,type:s.type,page:r.value,page_size:10},header:{Authorization:e}});if("success"===a.data.status){const e=a.data.data,o=e.comment_list.map((e=>({...e,showAll:!1,localChildren:e.children||[],childTotal:e.childTotal||(e.children?e.children.length:0),attitudeStatus:e.user_attitude||0,attitudeCounts:e.attitude_counts||{1:e.count_1||0,2:e.count_2||0,3:e.count_3||0,4:e.count_4||0,5:e.count_5||0}})));1===r.value?i.value=o:i.value.push(...o),t("log","at components/comment-list/comment-list.vue:464","total",e.total),d.value=e.total>i.value.length,c.value=e.total,t("log","at components/comment-list/comment-list.vue:468","是否还有更多?",d.value)}}catch(e){uni.showToast({title:"加载失败",icon:"none"})}finally{p.value=!1}},x=(e,t=null)=>{m("reply",{parent:e,target:t,relationId:s.relationId})},S=e=>1===e?"娃物":2===e?"店铺":"关联内容",C=e=>{e.association_id&&(1===e.association_type?uni.navigateTo({url:`/pages/goods/goods?goods_id=${e.association_id}`}):2===e.association_type&&uni.navigateTo({url:`/pages/brand/brand?brand_id=${e.association_id}`}))},B=e=>e.childTotal>5&&!e.showAll,T=e=>e.childTotal-Math.min(e.localChildren.length,5);return(t,o)=>{const n=a(e.resolveDynamicComponent("report-button"),me),l=a(e.resolveDynamicComponent("uni-icons"),b),s=a(e.resolveDynamicComponent("attitude-widget"),pe);return e.openBlock(),e.createElementBlock("view",{class:"comment-container"},[i.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"comment-count"}," 共"+e.toDisplayString(c.value)+"条回复 ",1)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-tips"},[e.createElementVNode("text",null,"-- 暂无回复 --")])),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"comment-card"},[e.createElementVNode("view",{class:"main-comment"},[e.createElementVNode("image",{onClick:e=>k(t.uid),src:t.avatar,class:"avatar",mode:"aspectFill"},null,8,["onClick","src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"username",onClick:e=>k(t.uid)},e.toDisplayString(N(t.username)),9,["onClick"]),e.createElementVNode("text",{class:"floor"},"#"+e.toDisplayString(t.floor),1)]),e.createVNode(n,{"report-type":5,"relation-id":t.id,"button-text":"举报","icon-color":"#999","theme-color":"#64c6dc","icon-size":"24"},null,8,["relation-id"])]),t.image_url?(e.openBlock(),e.createElementBlock("view",{key:0,class:"comment-images"},[e.createElementVNode("image",{src:t.image_url,mode:"aspectFill",class:"comment-image",onClick:e=>w(t.image_url)},null,8,["src","onClick"])])):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"comment-text",onClick:e=>x(t)},e.toDisplayString(t.comment),9,["onClick"]),t.association_id?(e.openBlock(),e.createElementBlock("view",{key:1,class:"association-card",onClick:e=>C(t)},[e.createElementVNode("image",{src:t.association_image,mode:"aspectFill",class:"association-image"},null,8,["src"]),e.createElementVNode("view",{class:"association-info"},[e.createElementVNode("text",{class:"association-name"},e.toDisplayString(t.association_name),1),e.createElementVNode("text",{class:"association-type"},e.toDisplayString(S(t.association_type)),1)]),e.createVNode(l,{type:"arrow-right",size:"20",color:"#999",class:"association-arrow"})],8,["onClick"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("view",{class:"left-actions"},[e.createElementVNode("text",{class:"time"},e.toDisplayString(E(t.created_at)),1),e.createElementVNode("view",{class:"like-container"},[e.createElementVNode("view",{class:"like-btn",onClick:e=>_(t)},[e.createVNode(l,{type:t.user_like?"hand-up-filled":"hand-up",size:"18",color:t.user_like?"rgb(100 198 220)":"#999"},null,8,["type","color"]),e.createElementVNode("text",{class:e.normalizeClass(["like-count",{liked:t.user_like}])},e.toDisplayString(t.like_count||0),3)],8,["onClick"])])]),e.createElementVNode("view",{class:"right-actions"},[e.createVNode(s,{"target-id":t.id,type:6,"attitude-status":t.attitudeStatus,"attitude-counts":t.attitudeCounts,onChange:e=>v(t,e)},null,8,["target-id","attitude-status","attitude-counts","onChange"]),e.createElementVNode("text",{class:"reply-btn",onClick:e=>x(t)},"回复",8,["onClick"])])])])]),t.localChildren&&t.localChildren.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"sub-comments"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f(t),((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"sub-comment"},[e.createElementVNode("image",{onClick:e=>k(a.uid),src:a.avatar,class:"avatar",mode:"aspectFill"},null,8,["onClick","src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{onClick:e=>k(a.uid),class:"username"},e.toDisplayString(N(a.username)),9,["onClick"]),e.createVNode(n,{"report-type":5,"relation-id":a.id,"button-text":"举报","icon-color":"#999","theme-color":"#64c6dc"},null,8,["relation-id"])]),a.image_url?(e.openBlock(),e.createElementBlock("view",{key:0,class:"comment-images"},[e.createElementVNode("image",{src:a.image_url,mode:"aspectFill",class:"comment-image",onClick:e=>w(a.image_url)},null,8,["src","onClick"])])):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"comment-text",onClick:e=>x(t)},e.toDisplayString(a.comment),9,["onClick"]),a.association_id?(e.openBlock(),e.createElementBlock("view",{key:1,class:"association-card",onClick:e=>C(a)},[e.createElementVNode("image",{src:a.association_image,mode:"aspectFill",class:"association-image"},null,8,["src"]),e.createElementVNode("view",{class:"association-info"},[e.createElementVNode("text",{class:"association-name"},e.toDisplayString(a.association_name),1),e.createElementVNode("text",{class:"association-type"},e.toDisplayString(S(a.association_type)),1)]),e.createVNode(l,{type:"arrow-right",size:"20",color:"#999",class:"association-arrow"})],8,["onClick"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("view",{class:"left-actions"},[e.createElementVNode("text",{class:"time"},e.toDisplayString(E(a.created_at)),1),e.createElementVNode("view",{class:"like-container"},[e.createElementVNode("view",{class:"like-btn",onClick:e=>_(a)},[e.createVNode(l,{type:a.user_like?"hand-up-filled":"hand-up",size:"18",color:a.user_like?"rgb(100 198 220)":"#999"},null,8,["type","color"]),e.createElementVNode("text",{class:e.normalizeClass(["like-count",{liked:a.user_like}])},e.toDisplayString(a.like_count||0),3)],8,["onClick"])])]),e.createElementVNode("view",{class:"right-actions"},[e.createVNode(s,{"target-id":a.id,type:6,"attitude-status":t.attitudeStatus,"attitude-counts":t.attitudeCounts,onChange:e=>v(t,e)},null,8,["target-id","attitude-status","attitude-counts","onChange"]),e.createElementVNode("text",{class:"reply-btn",onClick:e=>x(t,a)},"回复",8,["onClick"])])])])])))),128)),B(t)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"load-more",onClick:e=>(async e=>{if(e.localChildren.length<e.childTotal){const a=Math.ceil(e.localChildren.length/5)+1;try{const t=await uni.request({url:`${u.value}/get-comments-by-parent-id`,data:{parent_id:e.id,page:a}});"success"===t.data.status&&(e.localChildren=[...e.localChildren,...t.data.data.comment_list],e.childTotal=t.data.data.total,e.localChildren.length>=5&&!e.showAll&&(e.showAll=!0))}catch(t){uni.showToast({title:"加载失败",icon:"none"})}}else e.showAll=!e.showAll})(t)},[e.createElementVNode("text",null,"展开"+e.toDisplayString(T(t))+"条回复",1),e.createVNode(l,{type:"arrow-down",size:"18",color:"#007AFF"})],8,["onClick"])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])))),128)),i.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"load-more-box"},[d.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["load-more-btn",{loading:p.value}]),onClick:y},[p.value?(e.openBlock(),e.createElementBlock("view",{key:1},[e.createVNode(l,{type:"spinner-cycle",size:"16",color:"#888"})])):(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("text",null," 加载更多 "),e.createVNode(l,{type:"arrow-down",size:"18",color:"#007AFF"})]))],2)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},[e.createElementVNode("text",null,"-- 没有更多了 --")]))])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-4f3d0f00"]]);function ge(){return new Promise((e=>{uni.chooseImage({count:1,success:t=>{e(t.tempFilePaths[0])}})}))}function ve(e=9){return new Promise(((t,a)=>{uni.chooseImage({count:e,success:e=>{t(e.tempFilePaths)},fail:e=>{a(e)}})}))}function fe(){return new Promise(((e,a)=>{let o=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/qiniu-token",method:"POST",header:{Authorization:o},success:o=>{o.data.data&&o.data.data.token?(t("log","at common/image.js:54","获取到的七牛token："+o.data.data.token),e(o.data.data)):(uni.showToast({title:"获取上传凭证失败",icon:"none"}),a("获取上传凭证失败"))},fail:e=>{uni.showToast({title:"获取上传凭证失败",icon:"none"}),a("获取上传凭证失败")}})}))}function ye(e,a,o){let n=uni.getStorageSync("token");return new Promise(((l,s)=>{uni.uploadFile({url:"https://up-cn-east-2.qiniup.com",name:"file",method:"POST",filePath:e,fileType:"image",formData:{token:a,key:o,scope:"hobby-box:"+o},success:async e=>{try{const a=m+o,s=await uni.request({url:`${u.value}/with-state/add-image-log`,method:"POST",header:{"Content-Type":"application/json",Authorization:n},data:{image_url:a}});if(t("log","at common/image.js:108",s),"success"!==s.data.status)throw new Error("上传图片失败");l({qiniuRes:e,imageUrl:a})}catch(a){t("error","at common/image.js:115","日志记录失败:",a),uni.showToast({title:"日志记录失败",icon:"none"}),s("日志记录失败")}},fail:e=>{uni.showToast({title:"上传失败",icon:"none"}),s("上传失败")}})}))}const we=V({__name:"comment-input",props:{replyInfo:{type:Object,default:()=>({})},targetId:{type:String,required:!0},safeBottom:{type:Number,default:10}},emits:["submit","update:replyInfo"],setup(o,{expose:n,emit:l}){const s=e.ref(!1),i=o,r=e.ref(null),c=e.ref(!1),u=l;e.getCurrentInstance();const d=e.ref(""),p=e.ref(!1),h=e.ref(!1),g=e.ref(!1),v=e.ref(!1),f=e.ref(null),w=e.ref(""),_=e.ref(0),k=uni.getSystemInfoSync(),E=e.computed((()=>{var e,a;let o=(null==(e=k.safeAreaInsets)?void 0:e.bottom)||10;t("log","at components/comment-input/comment-input.vue:138","底部安全距离1:",null==(a=k.safeAreaInsets)?void 0:a.bottom,"=>",o);let n=o+_.value;return t("log","at components/comment-input/comment-input.vue:141","底部最终距离2:",n),`${n}px`})),N=e=>{t("log","at components/comment-input/comment-input.vue:146","键盘高度变化",e),_.value=e.height},V=e=>{t("log","at components/comment-input/comment-input.vue:151","切换匿名状态",v.value),v.value=!v.value,v.value?uni.showToast({title:"进入匿名状态",icon:"none"}):uni.showToast({title:"退出匿名状态",icon:"none"})},x=()=>{p.value=!0,c.value=!0,g.value=!0},S=()=>{setTimeout((()=>{h.value||(g.value||(p.value=!1),c.value=!1),h.value=!1}),200)};async function C(){uni.chooseImage({count:1,success:async e=>{const a=e.tempFilePaths;for(const n of a)try{const e=await fe(),a=await ye(n,e.token,e.path);if(t("log","at components/comment-input/comment-input.vue:203","res:",a),200===a.qiniuRes.statusCode){const t=m+e.path;w.value=t}else t("error","at components/comment-input/comment-input.vue:208","上传失败:",n)}catch(o){t("error","at components/comment-input/comment-input.vue:211","上传错误:",o)}}})}const B=()=>{t("log","at components/comment-input/comment-input.vue:221","蒙版被点击"),p.value=!1,c.value=!1,g.value=!1,uni.hideKeyboard()};function T(e){let a={};"goods"===e.type?(t("log","at components/comment-input/comment-input.vue:235","选择了商品:",e.data),s.value=!1,a.type=1,a.id=e.data.id,a.name=e.data.name):"brand"===e.type&&(t("log","at components/comment-input/comment-input.vue:243","选择了品牌:",e.data),s.value=!1,a.type=2,a.id=e.data.id,a.name=e.data.name),f.value=a}const D=()=>{if(!d.value.trim()&&!w.value)return void uni.showToast({title:"请输入评论内容或上传图片",icon:"none"});let e=y();t("log","at components/comment-input/comment-input.vue:267","scene",e);const a={content:d.value,target_id:i.targetId,type:4,replyInfo:i.replyInfo,origin:e,image_url:w.value||"",association_id:f.value?f.value.id:0,association_type:f.value?f.value.type:0,is_anonymous:v.value?1:0};u("submit",a),d.value="",w.value="",f.value=null,v.value=!1,u("update:replyInfo",{}),B()};return n({focusInput:()=>{c.value=!0}}),e.onMounted((()=>{t("log","at components/comment-input/comment-input.vue:312","注册键盘弹出事件"),uni.onKeyboardHeightChange(N)})),(t,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("switch-search"),U),m=a(e.resolveDynamicComponent("bottom-popup"),H);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("view",{class:"mask",onClick:B},null,512),[[e.vShow,p.value]]),e.createElementVNode("view",{class:"bottom_tab","adjust-position":!1,style:e.normalizeStyle({paddingBottom:E.value})},[e.createElementVNode("view",{class:"about_info"},[f.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"association-container"},[e.createElementVNode("view",{class:"association-item"},[e.createVNode(l,{type:"paperclip",size:"20",color:"#fff"}),e.createElementVNode("text",{class:"association-text"},e.toDisplayString(f.value.name),1),e.createVNode(l,{type:"close",size:"20",color:"#fff",onClick:n[0]||(n[0]=e.withModifiers((e=>f.value=null),["stop"])),class:"close-icon"})])])):e.createCommentVNode("",!0),w.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"image-container"},[e.createElementVNode("view",{class:"image-item"},[e.createElementVNode("image",{src:w.value,mode:"aspectFill",class:"uploaded-image"},null,8,["src"]),e.createElementVNode("view",{class:"delete-icon",onClick:n[1]||(n[1]=e.withModifiers((e=>w.value=""),["stop"]))},[e.createVNode(l,{type:"close",size:"18",color:"#fff"})])])])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"bottom_input"},[e.withDirectives(e.createElementVNode("textarea",{"disable-default-padding":!0,focus:c.value,class:e.normalizeClass(["comment_input unified-textarea",{expanded:c.value}]),ref_key:"inputRef",ref:r,"onUpdate:modelValue":n[2]||(n[2]=e=>d.value=e),onFocus:x,onBlur:S,"adjust-position":!1,placeholder:o.replyInfo.username?"回复@"+o.replyInfo.username+" ":"写评论..."},null,42,["focus","placeholder"]),[[e.vModelText,d.value]]),e.createElementVNode("button",{onClick:D},"写评论")]),e.withDirectives(e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("view",{onClick:e.withModifiers(V,["stop"])},[v.value?(e.openBlock(),e.createBlock(l,{key:0,type:"eye-slash",size:"22",color:v.value?"#007aff":""},null,8,["color"])):(e.openBlock(),e.createBlock(l,{key:1,type:"eye",size:"22",color:"#696a6c"}))]),e.createElementVNode("view",{onClick:n[3]||(n[3]=e.withModifiers((e=>s.value=!0),["stop"]))},[e.createVNode(l,{type:"plus",size:"22",color:"#696a6c"})]),e.createElementVNode("view",{onClick:e.withModifiers(C,["stop"])},[e.createVNode(l,{type:"image",size:"22",color:"#696a6c"})])],512),[[e.vShow,g.value]]),e.createElementVNode("view"),e.createVNode(m,{show:s.value,onClose:n[4]||(n[4]=e=>s.value=!1)},{default:e.withCtx((()=>[s.value?(e.openBlock(),e.createBlock(u,{key:0,"target-id":i.targetId,"reply-info":i.replyInfo,mode:"fill",onSubmit:T},null,8,["target-id","reply-info"])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{height:"900rpx"}})])),_:1},8,["show"])],4)],64)}}},[["__scopeId","data-v-3440d8bf"]]),_e="/static/right2.png",ke={__name:"goods",props:["goods_id"],setup(o){const n=o;uni.getSystemInfoSync(),e.ref(!1),e.ref(!1),e.ref("");const l=e.ref(null),s=e.ref(null);e.ref(1);let i=e.ref({}),r=e.ref({}),c=e.ref(1),d=e.ref(!1),m=e.ref(!1),p=e.ref(!1),g=e.ref(!1),v=e.ref(0);const y=e.ref(400),w=e.ref([]),_=e.ref(uni.upx2px(1e3)),k=e.ref([]),N=e.ref(1),V=e.ref(!1),x=e.computed((()=>"单头"===r.value.type||"整体"===r.value.type)),S=async()=>{if(x.value){V.value=!0;try{const e=await uni.request({url:`${u.value}/rand-bjd-faceup?goods_id=${n.goods_id}&page=${N.value}`,method:"GET",timeout:5e3});"success"===e.data.status?1===N.value?k.value=e.data.data||[]:k.value=[...k.value,...e.data.data||[]]:uni.showToast({title:e.data.msg||"获取妆图失败",icon:"none"})}catch(e){t("log","at pages/goods/goods.vue:345",e),uni.showToast({title:"网络请求失败",icon:"none"})}finally{V.value=!1}}},C=()=>{S()},B=e=>{if(!e)return"";return e.split(",")[0].trim()},T=({parent:e,target:a})=>{var o;t("log","at pages/goods/goods.vue:369","parent",e),t("log","at pages/goods/goods.vue:370","target",a);let n=e;null!=a&&(n=a),i.value.id!=n.id?(t("log","at pages/goods/goods.vue:381","item",n),i.value=n,null==(o=s.value)||o.focusInput()):i.value={}},D=e=>{var a,o,s;let r=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/goods/goods.vue:397","reply_info",i.value);const c={content:e.content,origin:e.origin,target_id:parseInt(n.goods_id),type:2,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...i.value.id&&{reply_id:i.value.id,reply_for:i.value.comment,reply_uid:i.value.user_id,parent_id:i.value.parent_id>0?i.value.parent_id:i.value.id}},d={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0},...e.association_id&&{association_id:e.association_id,association_type:e.association_type},...e.image_url&&{image_url:e.image_url},...i.value.id&&{reply_id:i.value.id,reply_for:i.value.comment,reply_uid:i.value.user_id,parent_id:i.value.parent_id>0?i.value.parent_id:i.value.id,reply_username:i.value.is_anonymous?"匿名用户":i.value.username}};i.value.id?0===i.value.parent_id?null==(o=l.value)||o.addReplyComment({...d,parent_id:i.value.id}):null==(s=l.value)||s.addReplyComment({...d,parent_id:i.value.parent_id}):null==(a=l.value)||a.addNewComment(d),uni.request({url:u.value+"/with-state/add-comment",method:"POST",header:{Authorization:r},data:c,success:t=>{var a,o;if("success"==t.data.status){const o=t.data.data,n={...o,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0}};o.reply_uid&&i.value.is_anonymous&&(n.reply_username="匿名用户"),null==(a=l.value)||a.updateTempComment(d.id,n),uni.showToast({title:"评论成功",icon:"success"})}else null==(o=l.value)||o.removeTempComment(d.id),uni.showToast({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=l.value)||t.removeTempComment(d.id),uni.showToast({title:"网络请求失败",icon:"none"})}})},I=e.computed((()=>{if(!r.value.sizes||0===r.value.sizes.length)return[];const e={};return r.value.sizes.forEach((t=>{const a=t.goods_size;e[a]||(e[a]=[]),t.size_detail&&e[a].push(t.size_detail)})),Object.keys(e).map((t=>({category:t,details:e[t]})))}));function z(e){t("log","at pages/goods/goods.vue:611",e.detail.current),c.value=e.detail.current+1}function A(){uni.request({url:u.value+"/goods?id="+n.goods_id,method:"GET",timeout:5e3,success:e=>{t("log","at pages/goods/goods.vue:621",e.data.data),r.value=e.data.data,function(){let e=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/wish-info?goods_id="+n.goods_id,method:"GET",header:e?{Authorization:e}:{},success:e=>{"success"===e.data.status&&(g.value=e.data.data.user_has_wished,v.value=e.data.data.wish_count)}})}(),x.value&&(N.value=1,S())},fail:e=>{t("log","at pages/goods/goods.vue:632",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{uni.hideLoading()}})}function P(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}function L(e){if(!e||e<=0)return"未知";const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}function $(){let e=uni.getStorageSync("token");""!=e&&uni.request({url:u.value+"/with-state/hasLike?id="+n.goods_id+"&type=1",method:"POST",header:{Authorization:e},success:e=>{t("log","at pages/goods/goods.vue:743",e.data),"success"==e.data.status?e.data.data.id>0?d.value=!0:d.value=!1:uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t("log","at pages/goods/goods.vue:761",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}function F(){uni.navigateTo({url:"/pages/collocation/collocation?goods_id="+n.goods_id+"&brand_id="+r.value.brand_id+"&goods_name="+r.value.name+"&brand_name="+r.value.brand_name+"&type="+r.value.type})}function M(){if(!(r.value.id&&r.value.name&&r.value.brand_id&&r.value.brand_name&&r.value.type))return void uni.showToast({title:"商品信息不完整",icon:"none"});const e={goods_id:r.value.id,goods_name:r.value.name,brand_id:r.value.brand_id,brand_name:r.value.brand_name,type:r.value.type},t=Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&");uni.navigateTo({url:`/pages/stock/showcase_form/showcase_form?${t}`})}function R(e){if(!e)return"";return e.split(",")[0].trim()}function O(){uni.navigateTo({url:`/pages/stock/account_book_form/account_book_form?goods_id=${n.goods_id}`})}function q(){if(p.value)return;let e=uni.getStorageSync("token");h.isLogin?(p.value=!0,uni.request({url:u.value+"/with-state/wish-restock",method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:{goods_id:parseInt(n.goods_id)},success:e=>{"success"===e.data.status?(uni.showToast({title:"许愿成功",icon:"success"}),g.value=!0,v.value=e.data.data.wish_count||v.value+1):uni.showToast({title:e.data.msg||"许愿失败",icon:"none"})},fail:e=>{t("error","at pages/goods/goods.vue:971","许愿请求失败:",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{p.value=!1}})):uni.showToast({title:"请先登录",icon:"none"})}return uni.showLoading({title:"加载中"}),A(),uni.request({url:u.value+"/goods-collocation?goods_id="+n.goods_id,method:"GET",timeout:5e3,success:e=>{t("log","at pages/goods/goods.vue:864",e.data.data),m.value=e.data.data},fail:e=>{t("log","at pages/goods/goods.vue:868",e),uni.showToast({title:"网络请求失败",icon:"none"})}}),f().then((e=>{t("log","at pages/goods/goods.vue:1009",e),$()})),(o,p)=>{const g=a(e.resolveDynamicComponent("view-logs"),E),v=a(e.resolveDynamicComponent("uni-icons"),b),f=a(e.resolveDynamicComponent("item-impression"),de),N=a(e.resolveDynamicComponent("comment-list"),he),V=a(e.resolveDynamicComponent("comment-input"),we);return e.unref(r).name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"goods-detail-container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(g),e.createElementVNode("view",{class:"swiper-container"},[e.createElementVNode("view",{class:"heart",onClick:p[0]||(p[0]=e=>function(){let e=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});let a={id:parseInt(n.goods_id),type:1},o=d.value?"/with-state/unlike":"/with-state/add-like";uni.request({url:u.value+o,method:"POST",header:{Authorization:e},data:a,success:e=>(t("log","at pages/goods/goods.vue:702",e.data),"success"==e.data.status?(uni.showToast({title:"操作成功",icon:"success"}),d.value=!d.value,$(),void A()):void uni.showToast({title:e.data.msg,icon:"none"})),fail:e=>{t("log","at pages/goods/goods.vue:721",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}())},[e.createVNode(v,{type:e.unref(d)?"heart-filled":"heart",size:"28",color:"#ff4d4f",style:{position:"relative",top:"5rpx"}},null,8,["type"]),e.createElementVNode("text",{class:"num",style:{color:"#ff4d4f"}},e.toDisplayString(P(e.unref(r).goods_like_count)),1)]),e.createElementVNode("swiper",{interval:3e3,duration:200,onChange:z,class:"banner-swiper",style:e.normalizeStyle({height:y.value+"px","min-height":"200px","max-height":_.value+"px"})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r).goods_images,((a,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o,class:"swiper-item-container"},[e.createElementVNode("view",{class:"swiper-item"},[e.createElementVNode("image",{src:a,mode:"widthFix",class:e.normalizeClass("swiper-image-"+o),onLoad:e=>function(e){t("log","at pages/goods/goods.vue:575","图片加载完成",e);const a=uni.createSelectorQuery();setTimeout((()=>{a.select(`.swiper-image-${e}`).boundingClientRect((a=>{try{if(!a)return void t("warn","at pages/goods/goods.vue:582","未找到图片元素");t("log","at pages/goods/goods.vue:585",a),w.value[e]=a.height;const o=w.value.filter((e=>e>0));if(0===o.length)return;const n=Math.max(...o);y.value=Math.min(n,_.value)}catch(ma){t("error","at pages/goods/goods.vue:594","高度计算异常:",ma)}})).exec()}),20)}(o)},null,42,["src","onLoad"])])])))),128))],36),e.createElementVNode("view",{class:"swiper-index"},[e.createElementVNode("text",{style:{color:"#fff"}},e.toDisplayString(e.unref(c))+" / "+e.toDisplayString(e.unref(r).goods_images.length),1)])]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("view",{class:"action-buttons"},[e.createElementVNode("button",{class:"action-btn add-to-stock",onClick:O},[e.createElementVNode("view",{class:"btn-content"},[e.createVNode(v,{type:"plus",size:"18",color:"#fff",style:{height:"36rpx","margin-bottom":"10rpx"}}),e.createElementVNode("text",null,"放入物品栏")])]),e.createElementVNode("button",{class:"action-btn wish-resale",onClick:q},[e.createElementVNode("view",{class:"btn-content"},[e.createVNode(v,{type:"star",size:"18",color:"#fff",style:{height:"36rpx","margin-bottom":"10rpx"}}),e.createElementVNode("text",null,"期望再贩")])]),e.createElementVNode("button",{class:"action-btn add-showcase",onClick:M},[e.createElementVNode("view",{class:"btn-content"},[e.createVNode(v,{type:"vip",size:"18",color:"#fff",style:{height:"36rpx","margin-bottom":"10rpx"}}),e.createElementVNode("text",null,"加入展示柜")])])]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"名称"),e.createElementVNode("image",{src:e.unref(r).goods_name_image,mode:"heightFix",class:"img_info"},null,8,["src"])]),e.createElementVNode("view",{class:"info-item",onClick:p[1]||(p[1]=t=>{e.unref(r).type})},[e.createElementVNode("text",{class:"label"},"类型"),e.createElementVNode("text",{class:"value"},e.toDisplayString(e.unref(r).type),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"初贩定价"),e.unref(r).goods_price_image?(e.openBlock(),e.createElementBlock("image",{key:0,src:e.unref(r).goods_price_image,mode:"heightFix",class:"img_info"},null,8,["src"])):e.unref(r).goods_sales&&e.unref(r).goods_sales.length>0?(e.openBlock(),e.createElementBlock("text",{key:1,class:"value"},e.toDisplayString(e.unref(r).goods_sales[0].sub_amount+e.unref(r).goods_sales[0].fin_amount)+" "+e.toDisplayString(e.unref(r).goods_sales[0].currency),1)):(e.openBlock(),e.createElementBlock("text",{key:2,class:"value"},"未知"))]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"初贩时间"),e.createElementVNode("text",{class:"value"},e.toDisplayString(e.unref(r).sub_time1>0?L(e.unref(r).sub_time1):"未知"),1)]),e.createElementVNode("view",{class:"info-item",onClick:p[2]||(p[2]=t=>{e.unref(r).size})},[e.createElementVNode("text",{class:"label"},"尺寸"),e.createElementVNode("view",{class:"value"},[e.unref(r).sizes&&e.unref(r).sizes.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"size-group"},[e.createElementVNode("text",{class:"size-category"},e.toDisplayString(t.category)+"：",1),e.createElementVNode("text",{class:"size-details"},e.toDisplayString(t.details.join("、")),1)])))),128))])):(e.openBlock(),e.createElementBlock("text",{key:1},e.toDisplayString(e.unref(r).size)+" / "+e.toDisplayString(e.unref(r).size_detail),1))])]),"单体"===e.unref(r).type||"整体"===e.unref(r).type||"单头"===e.unref(r).type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-item"},[e.createElementVNode("text",{class:"label"},"可选体型"),e.createElementVNode("text",{class:"value"},e.toDisplayString(e.unref(r).body_size||"未知"),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"可选颜色"),e.createElementVNode("text",{class:"value"},e.toDisplayString(e.unref(r).skin),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"制作方"),e.unref(r).goods_brand_name_image?(e.openBlock(),e.createElementBlock("image",{key:0,onClick:p[3]||(p[3]=t=>{return a=e.unref(r).brand_id,void uni.navigateTo({url:"/pages/brand/brand?brand_id="+a});var a}),src:e.unref(r).goods_brand_name_image,mode:"heightFix",class:"img_info",style:{background:"rgb(169 231 255)",padding:"0rpx 20rpx"}},null,8,["src"])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"材质"),e.createElementVNode("text",{class:"value"},e.toDisplayString(e.unref(r).doll_material),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"备注"),e.createElementVNode("text",{class:"value"},e.toDisplayString(e.unref(r).desc_content||"暂无备注信息"),1)])]),e.unref(r).goods_sales&&e.unref(r).goods_sales.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"sales-info"},[e.createElementVNode("text",{class:"section-title"},"贩售情报"),e.createElementVNode("view",{class:"sales-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r).goods_sales,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"sale-item"},[e.createElementVNode("view",{class:"sale-header"},[e.createElementVNode("text",{class:"sale-type"},e.toDisplayString(t.sale_type),1),e.createElementVNode("text",{class:"sale-price"},e.toDisplayString(t.sub_amount+t.fin_amount)+" "+e.toDisplayString(t.currency),1)]),e.createElementVNode("view",{class:"sale-period"},[e.createElementVNode("text",null,e.toDisplayString(L(t.sub_time)),1),t.sub_time_end>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"separator"},"至")):e.createCommentVNode("",!0),t.sub_time_end>0?(e.openBlock(),e.createElementBlock("text",{key:1},e.toDisplayString(L(t.sub_time_end)),1)):(e.openBlock(),e.createElementBlock("text",{key:2,class:"separator"},"开定"))]),e.createElementVNode("view",{class:"sale-size"},[e.createElementVNode("text",null,e.toDisplayString(t.size)+" · "+e.toDisplayString(t.size_detail),1)]),e.createElementVNode("view",{class:"bill-action",onClick:e=>function(e){const t={amount:e.fin_amount,currency:e.currency,name:r.value.name,sale_id:e.id},a=Object.keys(t).map((e=>`${e}=${t[e]}`)).join("&");uni.navigateTo({url:`/pages/stock/bill_form/bill_form?${a}`})}(t)},[e.createVNode(v,{type:"plus",size:"16",color:"#64c6dc"}),e.createElementVNode("text",null,"创建一个尾款账单")],8,["onClick"])])))),128))])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-sales"},[e.createElementVNode("text",{class:"section-title"},"贩售情报"),e.createElementVNode("text",{class:"empty-text"},"暂无贩售信息")])),e.createVNode(f,{target_id:n.goods_id,type:"2","goods-type":e.unref(r).type},null,8,["target_id","goods-type"]),e.createElementVNode("view",{class:"collocation-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"搭配参考"),e.createElementVNode("view",{class:"more-link",onClick:F},[e.createElementVNode("text",null,"查看更多"),e.createElementVNode("image",{src:_e})])]),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"collocation-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m).collocation_relation_list,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.collocation_id,class:"collocation-item",onClick:e=>{return a=t.collocation_id,o=t.relation_origin,void uni.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+a+"&origin="+o});var a,o}},[e.createElementVNode("image",{src:R(t.image_urls),mode:"aspectFill"},null,8,["src"])],8,["onClick"])))),128))]),e.createElementVNode("view",{onClick:F,class:"upload-collocation"},[e.createElementVNode("text",null,"返图帮助其它娃友?"),e.createVNode(v,{type:"upload",size:"20",color:"#ccc",style:{"margin-left":"10rpx"}})])]),x.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"faceup-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"妆图展示"),e.createElementVNode("view",{class:"refresh-btn",onClick:C},[e.createElementVNode("text",null,"换一批"),e.createVNode(v,{type:"refreshempty",size:"16",color:"#64c6dc",style:{"margin-left":"8rpx"}})])]),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"faceup-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"faceup-item",onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/artwork/artwork?id="+a});var a}},[e.createElementVNode("image",{src:B(t.face_up_image_urls),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"faceup-title"},e.toDisplayString(t.title),1)],8,["onClick"])))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"comment-section"},[e.createVNode(N,{ref_key:"commentListRef",ref:l,type:2,"relation-id":parseInt(n.goods_id),onReply:T},null,8,["relation-id"])]),e.createVNode(V,{ref_key:"commentInputRef",ref:s,"reply-info":e.unref(i),"target-id":n.goods_id,onSubmit:D,"onUpdate:replyInfo":p[4]||(p[4]=t=>e.isRef(i)?i.value=t:i=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{class:"bottom-placeholder"})])):e.createCommentVNode("",!0)}}},Ee=V(ke,[["__scopeId","data-v-0cba7fbd"]]),Ne={name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),o=Math.ceil(e);for(let n=0;n<this.max;n++)a>n?t.push({activeWitch:"100%"}):o-1===n?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100)},methods:{touchstart(e){if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){},mousemove(e){},mouseleave(e){},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let o=parseInt(a/(t+this.marginNumber));o=o<0?0:o,o=o>this.max?this.max:o;const n=parseInt(a-(t+this.marginNumber)*o);let l=0;(this._oldValue!==o||this.PC)&&(this._oldValue=o,l=this.allowHalf?n>t/2?o+1:o+.5:o+1,l=Math.max(.5,Math.min(l,this.max)),this.valueSync=l,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){uni.createSelectorQuery().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}};const Ve=V(Ne,[["render",function(t,o,n,l,s,i){const r=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{ref:"uni-rate",class:"uni-rate"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.stars,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-rate__icon",{"uni-cursor-not-allowed":n.disabled}]),style:e.normalizeStyle({"margin-right":i.marginNumber+"px"}),key:a,onTouchstart:o[0]||(o[0]=e.withModifiers(((...e)=>i.touchstart&&i.touchstart(...e)),["stop"])),onTouchmove:o[1]||(o[1]=e.withModifiers(((...e)=>i.touchmove&&i.touchmove(...e)),["stop"])),onMousedown:o[2]||(o[2]=e.withModifiers(((...e)=>i.mousedown&&i.mousedown(...e)),["stop"])),onMousemove:o[3]||(o[3]=e.withModifiers(((...e)=>i.mousemove&&i.mousemove(...e)),["stop"])),onMouseleave:o[4]||(o[4]=(...e)=>i.mouseleave&&i.mouseleave(...e))},[e.createVNode(r,{color:n.color,size:n.size,type:n.isFill?"star-filled":"star"},null,8,["color","size","type"]),e.createElementVNode("view",{style:e.normalizeStyle({width:t.activeWitch}),class:"uni-rate__icon-on"},[e.createVNode(r,{color:n.disabled?n.disabledColor:n.activeColor,size:n.size,type:"star-filled"},null,8,["color","size"])],4)],38)))),128))],512)])}],["__scopeId","data-v-1fbe22c2"]]),be={__name:"brand",props:["brand_id"],setup(o){const l=o;t("log","at pages/brand/brand.vue:142",l);const s=e.ref(!0),i=e.ref(0),r=e.ref(!1),c=e.ref([{label:"贩售作品"},{label:"消息动态"}]),d=()=>{uni.navigateTo({url:`/pages/artist_info/artist_info?brand_id=${l.brand_id}`})},m=e.ref(!1);let p=e.ref([]),g=e.ref({page_index:1,page_size:10,total:0});uni.showLoading({title:"加载中"}),uni.getSystemInfoSync();let f=e.ref(0);const y=e.ref(0),w=e.ref(null),_=e.ref(null);e.ref(1);let k=e.ref({});const N=({parent:e,target:a})=>{var o;t("log","at pages/brand/brand.vue:199","parent",e),t("log","at pages/brand/brand.vue:200","target",a);let n=e;null!=a&&(n=a),k.value.id!=n.id?(t("log","at pages/brand/brand.vue:211","item",n),k.value=n,null==(o=_.value)||o.focusInput()):k.value={}},V=e=>{var a,o,n;let s=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/brand/brand.vue:267","reply_info",k.value);const i={content:e.content,origin:e.origin,target_id:parseInt(l.brand_id),type:1,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...k.value.id&&{reply_id:k.value.id,reply_for:k.value.comment,reply_uid:k.value.user_id,parent_id:k.value.parent_id>0?k.value.parent_id:k.value.id}},r={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0},...e.association_id&&{association_id:e.association_id,association_type:e.association_type},...e.image_url&&{image_url:e.image_url},...k.value.id&&{reply_id:k.value.id,reply_for:k.value.comment,reply_uid:k.value.user_id,parent_id:k.value.parent_id>0?k.value.parent_id:k.value.id,reply_username:k.value.is_anonymous?"匿名用户":k.value.username}};k.value.id?0===k.value.parent_id?null==(o=w.value)||o.addReplyComment({...r,parent_id:k.value.id}):null==(n=w.value)||n.addReplyComment({...r,parent_id:k.value.parent_id}):null==(a=w.value)||a.addNewComment(r),uni.request({url:u.value+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:i,success:t=>{var a,o;if("success"==t.data.status){const o=t.data.data,n={...o,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0}};o.reply_uid&&k.value.is_anonymous&&(n.reply_username="匿名用户"),null==(a=w.value)||a.updateTempComment(r.id,n),uni.showToast({title:"评论成功",icon:"success"})}else null==(o=w.value)||o.removeTempComment(r.id),uni.showToast({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=w.value)||t.removeTempComment(r.id),uni.showToast({title:"网络请求失败",icon:"none"})}})},x=e=>{if(t("log","at pages/brand/brand.vue:408",e),!h.isLogin)return uni.showToast({title:"请先登录",icon:"none"}),void(f.value=0);f.value=e.value,y.value=e.value,async function(){if(0==f.value)return void uni.showToast({title:"请先评分",icon:"none"});try{let e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});uni.showLoading({title:"提交中..."});const t=await uni.request({url:u.value+"/with-state/add-vote-score",method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:{type:1,score:f.value,target_id:parseInt(l.brand_id)}});uni.hideLoading(),"success"===t.data.status?(S(),uni.showToast({title:"评分成功",icon:"success"})):uni.showToast({title:t.data.msg||"评分失败",icon:"none"})}catch(e){uni.hideLoading(),t("error","at pages/brand/brand.vue:480","评分失败:",e),uni.showToast({title:"评分失败，请重试",icon:"none"})}}()};function S(){uni.request({url:u.value+"/brand-info?id="+l.brand_id,method:"GET",timeout:5e3,success:e=>{t("log","at pages/brand/brand.vue:539",e.data.data),A.value=e.data.data,uni.setNavigationBarTitle({title:e.data.data.brand_name}),B(),r.value||1!=A.value.is_bjd_artist&&1!=A.value.is_bjd_hairstylist||(c.value.push({label:"接单主页"}),r.value=!0)},fail:e=>{t("log","at pages/brand/brand.vue:556",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{uni.hideLoading()}})}const C=async()=>{let e=uni.getStorageSync("token");if(h.isLogin)try{const t=`${u.value}/with-state/${m.value?"unlike":"add-like"}`,a=await uni.request({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(l.brand_id),type:2}});"success"===a.data.status?(m.value=!m.value,uni.showToast({title:m.value?"关注成功":"已取消关注",icon:"none"}),S()):uni.showToast({title:a.data.msg,icon:"none"})}catch(a){t("error","at pages/brand/brand.vue:608",a),uni.showToast({title:"操作失败",icon:"none"})}else uni.showToast({title:"请先登录",icon:"none"})},B=async()=>{var e;try{const t=await uni.request({url:`${u.value}/with-state/hasLike?id=${parseInt(l.brand_id)}&type=2`,method:"POST",header:{Authorization:uni.getStorageSync("token")}});m.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(a){t("error","at pages/brand/brand.vue:630","获取关注状态失败:",a)}};function T(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${s}`}function D(e=!1){uni.request({url:u.value+"/brand-goods?brand_id="+l.brand_id+"&page="+z.value,method:"GET",timeout:5e3,success:a=>{t("log","at pages/brand/brand.vue:655",a.data.data),I.value.page_index=a.data.data.page_index,I.value.total=a.data.data.total,I.value.goods_list=e?I.value.goods_list.concat(a.data.data.goods_list):a.data.data.goods_list,a.data.data.goods_list.length>0&&(z.value+=1),e&&0==a.data.data.goods_list.length&&z.value>1&&uni.showToast({title:"没有更多数据了",icon:"none"}),s.value=!1},fail:e=>{t("log","at pages/brand/brand.vue:684",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}let I=e.ref({}),z=e.ref(1),A=e.ref({});return n((()=>{v(),S(),s.value&&D(),uni.request({url:`${u.value}/brand-news-list?brand_id=${l.brand_id}&page=${g.value.page_index}&page_size=${g.value.page_size}`,method:"GET",success:e=>{if("success"===e.data.status){const t=e.data.data;p.value=[...p.value,...t.news_list],g.value.total=t.total,t.news_list.length>0&&(g.value.page_index+=1)}else uni.showToast({title:e.data.msg||"获取图透失败",icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})}}),h.isLogin?function(e,a){let o=uni.getStorageSync("token");o&&h.isLogin&&uni.request({url:u.value+"/with-state/my-vote-record",method:"GET",header:{Authorization:o,"Content-Type":"application/json"},data:{target_id:parseInt(a),type:e},success:e=>(t("log","at pages/brand/brand.vue:789",e.data.data),"success"==e.data.status?(y.value=e.data.data.score,e.data.data.score):(uni.showToast({title:e.data.msg,icon:"none"}),0)),fail:e=>(t("log","at pages/brand/brand.vue:802",e),uni.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,l.brand_id):f.value=0})),(o,n)=>{const s=a(e.resolveDynamicComponent("view-logs"),E),r=a(e.resolveDynamicComponent("uni-rate"),Ve),u=a(e.resolveDynamicComponent("uni-icons"),b),h=a(e.resolveDynamicComponent("comment-list"),he),g=a(e.resolveDynamicComponent("comment-input"),we);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(s),e.createElementVNode("image",{src:e.unref(A).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),e.createElementVNode("view",{class:"body"},[e.createElementVNode("view",null,[e.createElementVNode("image",{src:e.unref(A).brand_name_image,mode:"heightFix",style:{height:"60rpx"}},null,8,["src"]),e.createElementVNode("text",{style:{float:"right",margin:"5px 0px"}},e.toDisplayString(e.unref(A).country_name)+" / "+e.toDisplayString(e.unref(A).type),1),e.createElementVNode("view",{style:{clear:"both"}})]),e.createElementVNode("view",{style:{margin:"20rpx 0rpx",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},[e.createElementVNode("view",{style:{display:"flex","align-items":"center","flex-grow":"1"}},[e.createVNode(r,{style:{"margin-top":"5px"},value:e.unref(A).score,"allow-half":"true",activeColor:"#65C3D6",onChange:x,"is-fill":"false"},null,8,["value"]),e.createElementVNode("text",{style:{"margin-left":"8rpx",position:"relative",top:"5px"}},e.toDisplayString(e.unref(A).score)+"（"+e.toDisplayString(e.unref(A).vote_number)+"次评分) ",1)]),e.createElementVNode("text",{class:"follow",onClick:C,style:e.normalizeStyle({background:m.value?"#ff6a6c":"#65C3D6"})},e.toDisplayString(m.value?"已关注":"+ 关注品牌"),5)]),e.createElementVNode("view",{style:{"margin-top":"15px"}},[e.createElementVNode("text",null,"别名："+e.toDisplayString(e.unref(A).nickname_list||"暂无设置"),1)]),e.createElementVNode("view",{style:{"margin-top":"10px"}},[e.createElementVNode("text",null,"简介："+e.toDisplayString(e.unref(A).description||"暂未设置"),1)]),e.createElementVNode("view",{style:{"margin-top":"10px"}},[e.createElementVNode("text",{onClick:n[0]||(n[0]=a=>{var o;(o=e.unref(A).website_url)?0!==y.value?uni.setClipboardData({data:o,success:()=>{uni.showToast({title:"已复制贩售地址",icon:"success"})},fail:e=>{t("error","at pages/brand/brand.vue:247","复制失败:",e),uni.showToast({title:"复制失败",icon:"none"})}}):uni.showToast({title:"请先评分后再复制",icon:"none"}):uni.showToast({title:"暂无贩售地址",icon:"none"})})},"贩售地址：点击复制")]),e.createElementVNode("div",{style:{clear:"both"}}),e.createElementVNode("view",{class:"tabs-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item",{"active-tab":i.value===a}]),onClick:e=>(e=>{i.value=e})(a)},[e.createElementVNode("text",null,e.toDisplayString(t.label),1)],10,["onClick"])))),128))]),e.withDirectives(e.createElementVNode("view",null,[e.createElementVNode("view",{class:"brand_goods"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(I).goods_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"brand_goods_item",style:{},key:t.id},[e.createElementVNode("navigator",{onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},[e.createElementVNode("view",{style:{width:"100%",height:"calc(100% - 20px)"}},[e.createElementVNode("image",{style:{width:"100%",height:"100%"},src:t.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])]),e.createElementVNode("text",{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},e.toDisplayString(t.name),1)],8,["onClick"])])))),128))]),e.createElementVNode("button",{class:"load_more",onClick:D},"加载更多")],512),[[e.vShow,0===i.value]]),e.withDirectives(e.createElementVNode("view",null,[e.createElementVNode("view",{class:"news-list",style:{display:"flex","flex-wrap":"wrap","justify-content":"space-between"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"news-item",style:{position:"relative",width:"calc(50% - 10px)","margin-bottom":"20px"},key:t.id},[e.createElementVNode("view",{class:"news-header"},[e.createElementVNode("text",{class:"news-header-title"},e.toDisplayString(t.title),1)]),t.image_list&&t.image_list.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"news-images"},[e.createElementVNode("swiper",{class:"image-swiper",autoplay:!0,circular:!0,"indicator-dots":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.image_list,((a,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o},[e.createElementVNode("image",{src:a,mode:"aspectFill",class:"swiper-image",onClick:e=>function(e){uni.navigateTo({url:`/pages/sale_news/sale_news?id=${e.id}&brand_id=${e.brand_id}`})}(t)},null,8,["src","onClick"])])))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"news-content"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"news-footer"},[e.createElementVNode("text",{class:"news-time"},e.toDisplayString(T(t.created_at)),1)])])))),128))])],512),[[e.vShow,1===i.value]]),e.withDirectives(e.createElementVNode("view",null,[e.createElementVNode("view",{style:{"text-align":"center",padding:"50rpx 0"}},[e.createElementVNode("button",{class:"artist-button",onClick:d},[e.createElementVNode("text",null,"前往接单主页"),e.createVNode(u,{type:"arrow-right",size:"20",color:"#65C3D6"})])])],512),[[e.vShow,2===i.value]]),e.createElementVNode("view",null,[e.createVNode(h,{ref_key:"commentListRef",ref:w,type:1,"relation-id":parseInt(l.brand_id),onReply:N},null,8,["relation-id"])])]),e.createElementVNode("view",{style:{height:"80px"}}),e.createVNode(g,{ref_key:"commentInputRef",ref:_,"reply-info":e.unref(k),"target-id":l.brand_id,onSubmit:V,"onUpdate:replyInfo":n[1]||(n[1]=t=>e.isRef(k)?k.value=t:k=t)},null,8,["reply-info","target-id"])])}}},xe=V(be,[["__scopeId","data-v-54f7b228"]]),Se="/static/empty-box.png",Ce=V({__name:"calendar",setup(o){const n=e.ref("sale"),l=e.ref(["全部","整体","单头","单体","娃衣","眼珠","娃鞋","手型","脚型","袜子","配饰"]),s=e.ref(["全部尺寸","四分","六分","三分","其它大尺寸","八分","十二分","一分","二分","五分","棉花娃","眼珠"]);let r=e.ref("全部"),d=e.ref("全部尺寸");const m=e.ref({}),p=e.ref({}),h=e.ref({}),g=e.ref({}),v=new Date,f=v.getFullYear(),y=String(v.getMonth()+1).padStart(2,"0"),w=String(v.getDate()).padStart(2,"0"),_=e.ref(`${f}-${y}-${w}`);e.ref(null);const k=uni.getSystemInfoSync().screenWidth/7;let N=e.ref(0),V=e.ref(_.value),x=e.ref({}),S=e.ref(!0);const C=e.computed((()=>"sale"===n.value?D.value:p.value)),B=e=>{const t=M(e);if(!t||0===t.length)return"待定";const a=t.map((e=>parseFloat(e.price))).filter((e=>!isNaN(e)));if(0===a.length)return"待定";const o=Math.min(...a),n=Math.max(...a);return o===n?`${o}元`:`${o}-${n}元`},T=e=>{n.value!==e&&(n.value=e,V.value=_.value,"makeup"===e&&0===Object.keys(p.value).length?z():$())},D=e.computed((()=>{const e={};return Object.entries(m.value).forEach((([t,a])=>{const o={...a};o.goods&&(o.goods=o.goods.filter((e=>{const t="全部"===r.value||e.type===r.value;let a="全部尺寸"===d.value;return!a&&e.sizes&&e.sizes.length>0?a=e.sizes.some((e=>e.goods_size===d.value)):a||(a=e.size===d.value),t&&a})),o.goods_number=o.goods.length,0===o.goods.length&&(o.goods=null)),e[t]=o})),e})),I=()=>{S.value=!0,uni.request({url:u.value+"/goods-news",method:"GET",timeout:5e3,success:e=>{m.value=e.data.data,x.value=m.value[_.value]||{goods:null}},fail:e=>{t("log","at pages/calendar/calendar.vue:458",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{N.value=7*k-5,S.value=!1}})},z=()=>{S.value=!0,uni.request({url:u.value+"/bjd-makeup-news",method:"GET",timeout:5e3,success:e=>{p.value=e.data.data,x.value=p.value[_.value]||{plans:null}},fail:e=>{t("log","at pages/calendar/calendar.vue:485",e),uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{S.value=!1}})};function A(e){return e===_.value}const L=e=>{if(!e||0===e.length)return[];const t={};return e.forEach((e=>{const a=e.goods_size;t[a]||(t[a]=[]),e.size_detail&&t[a].push(e.size_detail)})),Object.keys(t).map((e=>({category:e,details:t[e]})))};function $(){const e=C.value;if(e[V.value])return void(x.value=e[V.value]);const t=Object.entries(e).find((([e,t])=>"sale"===n.value&&t.goods||"makeup"===n.value&&t.plans));t?(V.value=t[0],x.value=t[1]):x.value="sale"===n.value?{goods:null}:{plans:null}}function F(e){const t=new Date(1e3*e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}const M=e=>{try{return JSON.parse(e.order_config).tiers||[]}catch{return[]}},R=e=>{try{return JSON.parse(e.order_config).addons||[]}catch{return[]}};return e.watch([D,p],(()=>{$()})),i((()=>{I(),h.value={938:"小圆点儿工作室"}})),c((async()=>{try{"sale"===n.value?I():z(),uni.stopPullDownRefresh()}catch(e){uni.stopPullDownRefresh(),uni.showToast({title:"刷新失败",icon:"none"})}})),(o,i)=>{const c=a(e.resolveDynamicComponent("view-logs"),E),m=a(e.resolveDynamicComponent("uni-icons"),b),p=a(e.resolveDynamicComponent("loading-toast"),P),h=a(e.resolveDynamicComponent("common-page"),se);return e.openBlock(),e.createBlock(h,{head_color:"rgb(185 195 253)"},{default:e.withCtx((()=>[e.createVNode(c),e.createElementVNode("view",{class:"tab-container"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"sale"===n.value}]),onClick:i[0]||(i[0]=e=>T("sale"))},[e.createElementVNode("text",null,"贩售"),"sale"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-indicator"})):e.createCommentVNode("",!0)],2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"makeup"===n.value}]),onClick:i[1]||(i[1]=e=>T("makeup"))},[e.createElementVNode("text",null,"约妆"),"makeup"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-indicator"})):e.createCommentVNode("",!0)],2)]),"sale"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"category-container"},[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"category-scroll","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["category-item",{active:e.unref(r)===t}]),key:a,onClick:e=>{return a=t,void(r.value=a);var a}},e.toDisplayString(t),11,["onClick"])))),128))])])):e.createCommentVNode("",!0),"sale"===n.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"size-container"},[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"size-scroll","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["size-item",{active:e.unref(d)===t}]),key:a,onClick:e=>{return a=t,void(d.value=a);var a}},e.toDisplayString(t),11,["onClick"])))),128))])])):e.createCommentVNode("",!0),"makeup"===n.value?(e.openBlock(),e.createElementBlock("view",{key:2,style:{height:"50rpx",background:"rgb(211 245 255)"}})):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"date-picker-container"},[e.createElementVNode("scroll-view",{class:"date-scroll","scroll-x":"true","scroll-left":e.unref(N),"show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"date-item",onClick:e=>function(e,t){V.value=e,x.value=t}(a,t)},["sale"===n.value&&t.goods_number>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"date-badge"},e.toDisplayString(t.goods_number),1)):"makeup"===n.value&&t.plans_number>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"date-badge"},e.toDisplayString(t.plans_number),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["weekday",{weekend:"周日"===t.weekday||"周六"===t.weekday}])},e.toDisplayString(t.weekday),3),e.createElementVNode("view",{class:e.normalizeClass(["day-number",{selected:e.unref(V)===a}])},e.toDisplayString(A(a)?"今天":t.day_number),3)],8,["onClick"])))),128))],8,["scroll-left"])]),e.createElementVNode("view",{class:"goods-container"},["sale"===n.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"date-title"},[e.createElementVNode("text",{class:"highlight"},e.toDisplayString(e.unref(V))+" 日",1),e.createElementVNode("text",null," 星期"+e.toDisplayString(e.unref(x).weekday)+"上新",1)]),null==e.unref(x).goods?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},[e.createElementVNode("image",{src:Se,class:"empty-icon"}),e.createElementVNode("text",null,"这天没有上新呢...")])):(e.openBlock(),e.createElementBlock("view",{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x).goods,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"goods-card",onClick:e=>{return o=a.id,n=a.goods_id,uni.request({url:u.value+"/sale-record-click?id="+o,method:"POST",header:{"Content-Type":"application/json"},success:()=>t("log","at pages/calendar/calendar.vue:582","点击记录成功"),fail:e=>t("error","at pages/calendar/calendar.vue:583","点击记录失败:",e)}),void uni.navigateTo({url:"/pages/goods/goods?goods_id="+n});var o,n}},[e.createElementVNode("view",{class:"goods-image-container"},[e.createElementVNode("image",{src:a.goods_image,mode:"aspectFill",class:"goods-image"},null,8,["src"]),e.createElementVNode("view",{class:"goods-tags"},[e.createElementVNode("text",{class:"tag sale-type"},e.toDisplayString(a.type)+" · "+e.toDisplayString(a.sale_type),1),1==a.is_first_sale_day?(e.openBlock(),e.createElementBlock("text",{key:0,class:"tag first-day"},"首日")):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"brand-name"},e.toDisplayString(a.brand_name),1),e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(a.goods_name),1)]),e.createElementVNode("view",{class:"goods-details"},[a.sizes&&a.sizes.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(L(a.sizes),((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"size-group"},[e.createElementVNode("text",{class:"size-category"},e.toDisplayString(t.category)+"：",1),e.createElementVNode("text",{class:"size-details"},e.toDisplayString(t.details.join("、")),1)])))),128))])):(e.openBlock(),e.createElementBlock("text",{key:1},e.toDisplayString(a.size)+" · "+e.toDisplayString(a.size_detail),1))]),e.createElementVNode("view",{class:"time-info"},[e.createElementVNode("text",null,"开定 "+e.toDisplayString(F(a.sub_time)),1),a.sub_time_end?(e.openBlock(),e.createElementBlock("text",{key:0},"截止 "+e.toDisplayString(F(a.sub_time_end)),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"price-info"},["限量现货"!=a.sale_type&&"不限量现货"!=a.sale_type?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"price-group"},[e.createElementVNode("text",{class:"price-label"},"定金"),e.createElementVNode("text",{class:"deposit-price"},e.toDisplayString(a.sub_amount),1),e.createElementVNode("text",{class:"currency"},"("+e.toDisplayString(a.currency)+")",1)]),e.createElementVNode("view",{class:"price-group"},[e.createElementVNode("text",{class:"price-label"},"尾款"),e.createElementVNode("text",{class:"final-price"},e.toDisplayString(a.fin_amount),1)])])):(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("view",{class:"price-group"},[e.createElementVNode("text",{class:"price-label"},"全款"),e.createElementVNode("text",{class:"full-price"},e.toDisplayString(a.sub_amount+a.fin_amount),1),e.createElementVNode("text",{class:"currency"},"("+e.toDisplayString(a.currency)+")",1)])]))])])],8,["onClick"])))),128))]))],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("view",{class:"date-title"},[e.createElementVNode("text",{class:"highlight"},e.toDisplayString(e.unref(V))+" 日",1),e.createElementVNode("text",null," 星期"+e.toDisplayString(e.unref(x).weekday)+"约妆",1)]),null==e.unref(x).plans||0===e.unref(x).plans.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},[e.createElementVNode("image",{src:Se,class:"empty-icon"}),e.createElementVNode("text",null,"这天没有开妆计划呢...")])):(e.openBlock(),e.createElementBlock("view",{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x).plans,(t=>{return e.openBlock(),e.createElementBlock("view",{key:t.id,class:"plan-card",onClick:e=>{return a=t.artist_info,void uni.navigateTo({url:"/pages/artist_info/artist_info?brand_id="+a.brand_id});var a}},[e.createElementVNode("view",{class:"artist-header"},[e.createElementVNode("view",{class:"artist-info"},[t.artist_info&&t.artist_info.LogoImage?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.artist_info.LogoImage,mode:"aspectFill",class:"artist-avatar"},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"artist-details"},[e.createElementVNode("text",{class:"artist-name"},e.toDisplayString(t.artist_name),1),e.createElementVNode("view",{class:"makeup-price-range"},[e.createElementVNode("text",null,"妆费: "+e.toDisplayString(B(t)),1)])])])]),t.artist_info&&t.artist_info.Description?(e.openBlock(),e.createElementBlock("view",{key:0,class:"artist-description"},e.toDisplayString(t.artist_info.Description),1)):e.createCommentVNode("",!0),t.artist_info&&t.artist_info.artist_highlight_images?(e.openBlock(),e.createElementBlock("view",{key:1,class:"highlight-images"},[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"image-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((o=t.artist_info.artist_highlight_images,o?o.split(",").filter((e=>""!==e.trim())):[]),((t,a)=>(e.openBlock(),e.createElementBlock("image",{key:a,src:t,mode:"aspectFill",class:"highlight-image",onClick:e=>{return a=t,void uni.previewImage({urls:[a],current:a});var a}},null,8,["src","onClick"])))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["foldable-section",{expanded:g.value[t.id]}])},[e.createElementVNode("view",{class:"plan-info"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"开放时间:"),e.createElementVNode("text",{class:"value"},e.toDisplayString(F(t.open_time))+" - "+e.toDisplayString(F(t.close_time)),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"接单类型:"),e.createElementVNode("text",{class:"value"},e.toDisplayString((a=t.order_type,{1:"限时手速",2:"抽选投递",3:"黑箱卡投递"}[a]||"未知类型")),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"最大人数:"),e.createElementVNode("text",{class:"value"},e.toDisplayString(0===t.max_participants?"不限量":t.max_participants),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"每人限投:"),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.max_submissions_per_user)+"次",1)])]),e.createElementVNode("view",{class:"plan-config"},[e.createElementVNode("view",{class:"config-section"},[e.createElementVNode("text",{class:"section-title"},"档位选择"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(M(t),(t=>(e.openBlock(),e.createElementBlock("view",{key:t.title,class:"tier-item"},[e.createElementVNode("text",{class:"tier-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"tier-price"},e.toDisplayString(t.price)+"元",1),e.createElementVNode("text",{class:"tier-desc"},e.toDisplayString(t.description),1)])))),128))]),R(t).length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"config-section"},[e.createElementVNode("text",{class:"section-title"},"加购服务"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(R(t),(t=>(e.openBlock(),e.createElementBlock("view",{key:t.title,class:"addon-item"},[e.createElementVNode("text",{class:"addon-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"addon-price"},e.toDisplayString(t.price)+"元",1),e.createElementVNode("text",{class:"addon-desc"},e.toDisplayString(t.description),1)])))),128))])):e.createCommentVNode("",!0)])],2),e.createElementVNode("view",{class:"fold-toggle",onClick:e.withModifiers((e=>{return a=t.id,void(g.value[a]=!g.value[a]);var a}),["stop"])},[e.createElementVNode("text",null,e.toDisplayString(g.value[t.id]?"收起":"展开"),1),e.createVNode(m,{type:g.value[t.id]?"arrowup":"arrowdown",size:"16",color:"#81D8cf"},null,8,["type"])],8,["onClick"])],8,["onClick"]);var a,o})),128))]))],64))]),e.createVNode(p,{show:e.unref(S)},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-842c06c0"]]),Be=uni.getSystemInfoSync();function Te(e){if("number"==typeof e||!isNaN(Number(e)))return uni.upx2px(e);if("string"==typeof e){if(e.endsWith("rpx"))return Te(e.replace("rpx",""));if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("vw"))return Number(e.replace("vw",""))*Be.screenWidth/100;if(e.endsWith("vh"))return Number(e.replace("vh",""))*Be.screenHeight/100}return 0}const De=e=>{(e.$wxs||(e.$wxs=[])).push("wxsModule"),(e.$wxsModules||(e.$wxsModules={})).wxsModule="8ab5efd6"},Ie={name:"bt-cropper",props:{imageSrc:{type:String,default:"",required:!0},mask:{type:String,default:""},containerSize:{type:Object,default:null},fileType:{type:String,default:"png"},dWidth:Number,maxWidth:{type:Number,default:2e3},ratio:{type:Number,default:0,validator:e=>"number"==typeof e&&!(e<0)},rotate:Number,showGrid:{type:Boolean,default:!1},quality:{type:Number,default:1},canvas2d:{type:Boolean,default:!1},initPosition:{type:Object,default:()=>null},autoZoom:{type:Boolean,default:!0}},data:()=>({canvasId:"bt-cropper",containerRect:null,imageInfo:null,operationHistory:[],operationIndex:0,anim:!1,timer:null,type2d:!1,pixel:1,imageRect:null,cropperRect:null,target:{width:0,height:0}}),watch:{imageSrc:{handler(e){"string"==typeof e&&""!==e?this.imageInit(e):this.imageInfo=null},immediate:!0},ratio(){0!=this.ratio&&(this.startAnim(),this.init())}},computed:{containerStyle(){return this.containerSize&&this.containerRect?{width:this.containerRect.width+"px",height:this.containerRect.height+"px"}:{}},rotateAngle(){const e=Number(this.rotate);return isNaN(e)?0:e%360}},methods:{startAnim(){this.stopAnim(),this.anim=!0,this.timer=setTimeout((()=>{this.anim=!1}),200)},stopAnim(){this.anim=!1,clearTimeout(this.timer)},imageInit(e){uni.showLoading({title:"载入中..."}),uni.getImageInfo({src:e,success:e=>{this.imageInfo=e,this.$nextTick((()=>{this.getContainer().then((e=>{this.containerRect=e,this.init()}))}))},fail:e=>{this.$emit("loadFail",e),uni.showToast({title:"图片下载失败!",icon:"none"})},complete(e){uni.hideLoading()}})},initCropper(){const e=this.imageInfo.width/this.imageInfo.height,t=this.containerRect.width/this.containerRect.height,a={};let o=this.ratio;0==o&&(o=this.cropperRect?this.cropperRect.width/this.cropperRect.height:1);const n={};return t>o?(n.height=.85*this.containerRect.height,n.width=n.height*o):(n.width=.85*this.containerRect.width,n.height=n.width/o),o>e?(a.width=n.width,a.height=a.width/e):(a.height=n.height,a.width=a.height*e),a.left=(this.containerRect.width-a.width)/2,a.top=(this.containerRect.height-a.height)/2,n.left=a.left+(a.width-n.width)/2,n.top=a.top+(a.height-n.height)/2,{imageRect:a,cropperRect:n}},init(){const{imageRect:e,cropperRect:t}=this.initCropper();if(this.initPosition){const a=this.imageInfo.width/e.width,{left:o,top:n,width:l,height:s}=this.initPosition;void 0!==o&&void 0!==n&&void 0!==l&&void 0!==s&&(t.width=l/a,t.height=s/a,t.left=o/a,t.top=n/a,this.$nextTick(this.zoomToFill))}this.imageRect=e,this.cropperRect=t,this.operationHistory=[{imageRect:e,cropperRect:t}],this.operationIndex=0,this.setTarget(),this.type2d=!1},setTarget(){const e=this.cropperRect.width/this.cropperRect.height;if(this.dWidth)this.target={width:this.dWidth,height:this.dWidth/(e||1)};else{const t=Math.min(this.maxWidth,this.cropperRect.width*(this.imageInfo.width/this.imageRect.width));this.target={width:t,height:t/(e||1)}}},addHistory({imageRect:e,cropperRect:t}){this.operationIndex!==this.operationHistory.length-1&&(this.operationHistory=this.operationHistory.slice(0,this.operationIndex)),this.operationHistory.push({imageRect:e,cropperRect:t}),this.operationHistory.length>10&&this.operationHistory.shift(),this.operationIndex=this.operationHistory.length-1},updateData(e){this.imageRect=e.imageRect,this.cropperRect=e.cropperRect,this.addHistory(e),this.setTarget(),this.autoZoom&&(this.timer=setTimeout((()=>{this.zoomToFill()}),600));const{imageRect:t,cropperRect:a}=e,o=t.width/this.imageInfo.width;this.$emit("change",{left:(a.left-t.left)/o,top:(a.top-t.top)/o,width:a.width/o,height:a.height/o})},getContainer(){if(null!==this.containerSize&&"object"==typeof this.containerSize){const{width:e,height:t}=this.containerSize;return Promise.resolve({width:Te(e),height:Te(t)})}return new Promise((e=>{uni.createSelectorQuery().in(this).select(".mainContent").boundingClientRect((t=>{e(t)})).exec()}))},zoomToFill(){this.startAnim();const e={...this.cropperRect};this.imageRect,this.cropperRect,this.cropperRect=this.initCropper().cropperRect;const t=this.cropperRect.width/e.width,a=e.left-this.imageRect.left,o=e.top-this.imageRect.top;this.imageRect={width:this.imageRect.width*t,height:this.imageRect.height*t,left:this.imageRect.left+(this.cropperRect.left-e.left)-(t-1)*a,top:this.imageRect.top+(this.cropperRect.top-e.top)-(t-1)*o}},onTouchStart(){this.stopAnim()},undo(){return this.operationIndex>0&&(this.operationIndex--,this.imageRect=this.operationHistory[this.operationIndex].imageRect,this.cropperRect=this.operationHistory[this.operationIndex].cropperRect,!0)},resume(){return this.operationIndex<this.operationHistory.length-1&&(this.operationIndex++,this.imageRect=this.operationHistory[this.operationIndex].imageRect,this.cropperRect=this.operationHistory[this.operationIndex].cropperRect,!0)},async drawImage(e,t,a,o,n,l){if(this.type2d)await new Promise((e=>t.onload=e)),e.drawImage(t,a*this.pixel,o*this.pixel,n*this.pixel,l*this.pixel);else{const s=await new Promise((e=>{uni.getImageInfo({src:t,success({path:t}){e(t)}})}));e.drawImage(s,a*this.pixel,o*this.pixel,n*this.pixel,l*this.pixel),await new Promise((t=>e.draw(!1,t)))}},async crop(){let e,a;if(this.$emit("cropStart"),this.setTarget(),this.type2d){const t=uni.createSelectorQuery().in(this);a=await new Promise((e=>t.select(".bt-canvas").node((({node:t})=>e(t))).exec())),a.width=this.target.width*this.pixel,a.height=this.target.height*this.pixel,e=a.getContext("2d")}else e=uni.createCanvasContext(this.canvasId,this);const o=this.cropperRect.width/this.target.width,n=(this.cropperRect.left-this.imageRect.left)/o,l=(this.cropperRect.top-this.imageRect.top)/o;let s;this.type2d?(s=a.createImage(),s.src=this.imageSrc):s=this.imageSrc;const i=-n,r=-l,c=this.imageRect.width/o,u=this.imageRect.height/o;if(e.save(),e.translate(i+c/2,r+u/2),e.rotate(this.rotateAngle*Math.PI/180),e.translate(-(i+c/2),-(r+u/2)),await this.drawImage(e,s,i,r,c,u),e.restore(),""!==this.mask){let t,a;t=this.type2d?e.getImageData(0,0,this.target.width,this.target.height):await new Promise((e=>{uni.canvasGetImageData({canvasId:this.canvasId,x:0,y:0,width:this.target.width,height:this.target.height,success(t){e(t)}},this)})),e.clearRect(0,0,this.target.width,this.target.height),this.type2d?s.src=this.mask:s=this.mask,await this.drawImage(e,s,0,0,this.target.width,this.target.height),a=this.type2d?e.getImageData(0,0,this.target.width,this.target.height):await new Promise(((e,t)=>{uni.canvasGetImageData({canvasId:this.canvasId,x:0,y:0,width:this.target.width,height:this.target.height,success(t){e(t)}},this)})),e.clearRect(0,0,this.target.width,this.target.height);for(let e=3;e<a.data.length;e+=4){0!==a.data[e]&&(t.data[e]=0)}this.type2d?e.putImageData(t,0,0):await new Promise((e=>{uni.canvasPutImageData({canvasId:this.canvasId,x:0,y:0,width:t.width,height:t.height,data:t.data,complete:t=>{e(t)}},this)}))}return new Promise(((e,o)=>{const n={};this.type2d?n.canvas=a:n.canvasId=this.canvasId,uni.canvasToTempFilePath({...n,destWidth:this.target.width,destHeight:this.target.height,quality:Number(this.quality)||1,fileType:this.fileType,success:({tempFilePath:t})=>{e(t)},fail(e){t("log","at uni_modules/bt-cropper/components/bt-cropper/bt-cropper.vue:593","保存失败，错误信息：",e),o(e)}},this)}))}}};De(Ie);const ze=V(Ie,[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",{class:"bt-container",style:e.normalizeStyle([s.containerStyle])},[e.createElementVNode("view",{class:"mainContent","data-type":"image",onTouchstart:a[8]||(a[8]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),onTouchmove:a[9]||(a[9]=(...e)=>t.wxsModule.touchMove&&t.wxsModule.touchMove(...e)),onTouchend:a[10]||(a[10]=(...e)=>t.wxsModule.touchEnd&&t.wxsModule.touchEnd(...e))},[l.imageRect&&l.cropperRect?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("image",{mode:"aspectFit",src:o.imageSrc,class:e.normalizeClass(["image",{anim:l.anim}]),rotateAngle:e.wp(s.rotateAngle),"change:rotateAngle":t.wxsModule.changeRotateAngle,"change:imageRect":t.wxsModule.changeImageRect,imageRect:e.wp(l.imageRect)},null,10,["src","rotateAngle","change:rotateAngle","change:imageRect","imageRect"]),e.createElementVNode("view",{class:e.normalizeClass(["cropper",{anim:l.anim}]),"change:cropperRect":t.wxsModule.changeCropper,cropperRect:e.wp(l.cropperRect),"change:ratio":t.wxsModule.changeRatio,ratio:e.wp(o.ratio)},[e.createElementVNode("image",{class:"mask",src:o.mask},null,8,["src"]),o.showGrid?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"line row row1"}),e.createElementVNode("view",{class:"line row row2"}),e.createElementVNode("view",{class:"line col col1"}),e.createElementVNode("view",{class:"line col col2"})],64)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"controller vertical left",onTouchstart:a[0]||(a[0]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller vertical right",onTouchstart:a[1]||(a[1]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller horizon top",onTouchstart:a[2]||(a[2]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller horizon bottom",onTouchstart:a[3]||(a[3]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller left top",onTouchstart:a[4]||(a[4]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller left bottom",onTouchstart:a[5]||(a[5]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller right top",onTouchstart:a[6]||(a[6]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32),e.createElementVNode("view",{class:"controller right bottom",onTouchstart:a[7]||(a[7]=(...e)=>t.wxsModule.touchStart&&t.wxsModule.touchStart(...e)),"data-type":"controller"},null,32)],10,["change:cropperRect","cropperRect","change:ratio","ratio"])],64)):e.createCommentVNode("",!0)],32),l.type2d?(e.openBlock(),e.createElementBlock("canvas",{key:0,type:"2d",class:"bt-canvas",width:l.target.width,height:l.target.height},null,8,["width","height"])):(e.openBlock(),e.createElementBlock("canvas",{key:1,"canvas-id":l.canvasId,class:"bt-canvas",style:e.normalizeStyle({width:l.target.width+"px",height:l.target.height+"px"}),width:l.target.width*l.pixel,height:l.target.height*l.pixel},null,12,["canvas-id","width","height"]))],4)}],["__scopeId","data-v-339decdf"]]);const Ae=V({data:()=>({imageSrc:"",dist:"",mask:"",ratio:1,containerSize:{width:600,height:600},initPosition:null}),onLoad(e){this.imageSrc=decodeURIComponent(e.src)},onPullDownRefresh(){uni.stopPullDownRefresh()},methods:{openPopup(){this.$refs.pop.open()},change(){uni.chooseImage({count:1,sizeType:["original"],success:e=>{let t=e.tempFilePaths[0];this.src=t,this.initPosition=null}})},close(){this.$refs.pop.close()},onChange(e){this.initPosition=e},undo(){this.$refs.cropper.undo()},resume(){this.$refs.cropper.resume()},crop(){this.$refs.cropper.crop().then((e=>{this.dist=e;const a=getCurrentPages(),o=a[a.length-2];t("log","at pages/pop_croper/pop_croper.vue:82",o),o.returnParam=e,uni.navigateBack({delta:1})}))}}},[["render",function(t,o,n,l,s,i){const r=a(e.resolveDynamicComponent("bt-cropper"),ze),c=a(e.resolveDynamicComponent("uni-popup"),J);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(c,{ref:"pop"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"content"},[e.createVNode(r,{ref:"cropper",imageSrc:s.imageSrc,mask:s.mask,ratio:s.ratio,initPosition:s.initPosition,dWidth:800,fileType:"png",containerSize:s.containerSize,onChange:i.onChange},null,8,["imageSrc","mask","ratio","initPosition","containerSize","onChange"]),e.createElementVNode("view",{class:"btns"},[e.createElementVNode("button",{class:"button",onClick:o[0]||(o[0]=(...e)=>i.crop&&i.crop(...e))},"裁剪"),e.createElementVNode("button",{class:"button",onClick:o[1]||(o[1]=(...e)=>i.undo&&i.undo(...e))},"撤销")])])])),_:1},512)])}],["__scopeId","data-v-a1faecd2"]]),Pe=V({__name:"setting",setup(o){uni.setNavigationBarTitle({title:"设置"});const n=e.computed((()=>[{label:"更改用户名",action:m,status:!!h.userInfo.password,displayValue:h.userInfo.password?"去修改":"未设置"},{label:"更改密码",action:c,status:!!h.userInfo.password,displayValue:h.userInfo.password?"去修改":"未设置"},{label:"绑定手机号",action:d,status:!!h.userInfo.tel_phone,displayValue:h.userInfo.tel_phone?h.userInfo.tel_phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"去绑定"},{label:"绑定微信",action:p,status:!!h.userInfo.wechat_open_id,displayValue:h.userInfo.wechat_open_id?"已绑定":"去绑定"},{label:"检查更新",action:g,status:l.value.version,displayValue:i.value}]));e.ref({});let l=e.ref({});const s=e.ref(!1);e.ref(!1);const i=e.ref("检查更新");let r=e.ref(0);function c(){uni.navigateTo({url:"/pages/setting/password/password"})}function d(){uni.navigateTo({url:"/pages/setting/tel_phone/tel_phone"})}function m(){uni.navigateTo({url:"/pages/setting/username/username"})}function p(){h.userInfo.wechat_open_id?uni.showToast({title:"已绑定微信",icon:"none"}):(uni.showToast({title:"请在微信小程序中绑定",icon:"none"}),Promise.reject("请在微信小程序中绑定")).then((()=>{t("log","at pages/setting/setting.vue:120","微信绑定成功"),uni.showToast({title:"微信绑定成功",icon:"none"})})).catch((e=>{t("error","at pages/setting/setting.vue:127","微信绑定失败:",e),uni.showToast({title:"微信绑定失败",icon:"none"})}))}const g=async()=>{uni.getSystemInfoSync().platform;{r.value++;const e=await uni.request({url:`${u.value}/latest-version?version=1.1.2`,method:"GET"});e&&e.data&&("success"===e.data.status&&e.data.data?(i.value="有新版本:"+e.data.data.version,l.value=!0):r.value>1&&uni.showToast({title:"当前已是最新版本",icon:"none"}))}};async function v(){s.value?uni.showModal({title:"取消注销申请",content:"确定要取消账号注销申请吗？",success:async e=>{e.confirm&&await async function(){const e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});uni.showLoading({title:"处理中...",mask:!0});try{const t=await uni.request({url:`${u.value}/with-state/cancel-delete`,method:"POST",header:{Authorization:e}});if(uni.hideLoading(),"success"!==t.data.status)throw new Error(t.data.msg||"取消注销失败");s.value=!1,h.userInfo.deleteApplyAt=0,uni.showToast({title:"已取消注销申请",icon:"success",duration:3e3})}catch(t){uni.hideLoading(),uni.showToast({title:t.message||"操作失败，请稍后重试",icon:"none",duration:3e3})}}()}}):uni.showModal({title:"申请注销账号",content:"确定要申请注销账号吗？注销后账号将不可恢复！",confirmText:"确认注销",confirmColor:"#f56c6c",success:async e=>{e.confirm&&await async function(){const e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});uni.showLoading({title:"处理中...",mask:!0});try{const t=await uni.request({url:`${u.value}/with-state/apply-delete`,method:"POST",header:{Authorization:e}});if(uni.hideLoading(),"success"!==t.data.status)throw new Error(t.data.msg||"申请注销失败");s.value=!0,h.userInfo.deleteApplyAt=Math.floor(Date.now()/1e3),uni.showToast({title:"已申请注销账号",icon:"success",duration:3e3}),setTimeout((()=>{uni.showModal({title:"注销申请已提交",content:"您的账号将在30天后正式注销。在此期间您可以正常使用所有功能，并可随时取消注销申请。",showCancel:!1,confirmText:"知道了"})}),1e3)}catch(t){uni.hideLoading(),uni.showToast({title:t.message||"操作失败，请稍后重试",icon:"none",duration:3e3})}}()}})}return e.onMounted((()=>{f().then((e=>{s.value=e.delete_apply_at>0})),g()})),(t,o)=>{const l=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(l),e.createElementVNode("view",{class:"settings-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"menu-item",onClick:e=>t.action(t)},[e.createElementVNode("text",{class:"menu-label"},e.toDisplayString(t.label),1),e.createElementVNode("view",{class:"menu-value"},[e.createElementVNode("text",{class:e.normalizeClass(t.status?"active":"inactive")},e.toDisplayString(t.displayValue),3),e.createElementVNode("image",{class:"arrow-icon",src:"/static/right.png"})])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"logout-section"},[e.createElementVNode("view",{class:"logout-btn",onClick:v,style:e.normalizeStyle({backgroundColor:s.value?"#f56c6c":"#cfcad8"})},[e.createElementVNode("text",null,e.toDisplayString(s.value?"取消注销申请":"申请注销账号"),1)],4),s.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"deletion-notice"}," 已申请注销，30天后账号将正式注销。在此之前可以正常使用，并可随时取消注销申请。 ")):e.createCommentVNode("",!0)])])],64)}}},[["__scopeId","data-v-1f3c2cda"]]),Le=V({__name:"password",setup(o){uni.setNavigationBarTitle({title:"设置密码"});let n=e.ref(""),l=e.ref(""),s=e.ref("");const i=e.computed((()=>l.value&&s.value&&l.value===s.value)),r=e.computed((()=>l.value.length<6?"密码过于简单":l.value.length<10?"密码强度一般":"密码强度较高")),c=e=>l.value.length<6?"weak":l.value.length<10?"medium":"strong";function d(){l.value==s.value?!h.userInfo.password||n.value?uni.request({url:u.value+"/with-state/setting-password",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{old_password:n.value,new_password:l.value},success:e=>{t("log","at pages/setting/password/password.vue:134",e.data),"success"==e.data.status?uni.showToast({title:"修改成功",icon:"success"}):uni.showToast({title:e.data.msg,icon:"none"})}}):uni.showToast({title:"请输入原密码",icon:"none"}):uni.showToast({title:"两次密码输入不一致",icon:"none"})}return v(),(t,o)=>{const u=a(e.resolveDynamicComponent("view-logs"),E),m=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(u),e.createElementVNode("view",{class:"password-container"},[e.createElementVNode("view",{class:"form-wrapper"},[e.unref(h).userInfo.password?(e.openBlock(),e.createElementBlock("view",{key:0,class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[0]||(o[0]=t=>e.isRef(n)?n.value=t:n=t)},null,512),[[e.vModelText,e.unref(n)]]),e.createElementVNode("label",{class:"floating-label"},"原密码"),e.createVNode(m,{class:"input-icon",type:"locked",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]]),e.createElementVNode("label",{class:"floating-label"},"新密码"),e.createVNode(m,{class:"input-icon",type:"gear",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[2]||(o[2]=t=>e.isRef(s)?s.value=t:s=t)},null,512),[[e.vModelText,e.unref(s)]]),e.createElementVNode("label",{class:"floating-label"},"确认新密码"),e.createVNode(m,{class:"input-icon",type:"checkmarkempty",size:"18",color:"#999"})])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[3]||(o[3]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]]),e.createElementVNode("label",{class:"floating-label"},"设置密码"),e.createVNode(m,{class:"input-icon",type:"locked",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:" ","onUpdate:modelValue":o[4]||(o[4]=t=>e.isRef(s)?s.value=t:s=t)},null,512),[[e.vModelText,e.unref(s)]]),e.createElementVNode("label",{class:"floating-label"},"确认密码"),e.createVNode(m,{class:"input-icon",type:"checkmarkempty",size:"18",color:"#999"})])])),e.unref(l)?(e.openBlock(),e.createElementBlock("view",{key:2,class:"password-strength"},[e.createElementVNode("view",{class:e.normalizeClass(["strength-bar",c()])},null,2),e.createElementVNode("view",{class:e.normalizeClass(["strength-bar",c()])},null,2),e.createElementVNode("view",{class:e.normalizeClass(["strength-bar",c()])},null,2),e.createElementVNode("text",{class:"strength-text"},e.toDisplayString(r.value),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{active:i.value}]),onClick:d,disabled:!i.value},e.toDisplayString(e.unref(h).userInfo.password?"更新密码":"设置密码"),11,["disabled"])]),e.createElementVNode("view",{class:"security-tips"},[e.createVNode(m,{type:"info",size:"16",color:"#666"}),e.createElementVNode("text",null,"建议使用8位以上包含字母和数字的组合")])])],64)}}},[["__scopeId","data-v-abda41a7"]]),$e=V({__name:"tel_phone",setup(o){uni.setNavigationBarTitle({title:"手机号"});let n=e.ref(""),l=e.ref(""),s=e.ref("发送验证码");function i(){uni.request({url:u.value+"/with-state/update-profile",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{tel_phone:n.value,code:l.value},success:e=>{t("log","at pages/setting/tel_phone/tel_phone.vue:58",e.data),"success"==e.data.status?(uni.showToast({title:"修改成功",icon:"success"}),v()):uni.showToast({title:e.data.msg,icon:"none"})}})}function r(){"发送验证码"==s.value?""!=n.value&&""!=n.value?/^1[3456789]\d{9}$/.test(n.value)?(s.value="发送中",uni.request({url:u.value+"/send-sms-code",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{tel_phone:n.value},success:e=>{t("log","at pages/setting/tel_phone/tel_phone.vue:111",e.data),"success"==e.data.status?(s.value="已发送",uni.showToast({title:"发送成功",icon:"success"})):(uni.showToast({title:e.data.msg,icon:"none"}),s.value="发送验证码")}})):uni.showToast({title:"手机号格式错误",icon:"none"}):uni.showToast({title:"请输入手机号和密码",icon:"none"}):uni.showToast({title:"请点击发送验证码",icon:"none"})}return v(),(t,o)=>{const c=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(c),e.createElementVNode("view",{style:{padding:"15px"}},[e.unref(h).userInfo.tel_phone?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("input",{type:"text",class:"inputer",value:e.unref(h).userInfo.tel_phone,disabled:""},null,8,["value"]),e.createElementVNode("text",{style:{padding:"10px","font-size":"20px",color:"rgb(190 190 190)"}},"已绑定，如需修改请联系管理员操作。")])):(e.openBlock(),e.createElementBlock("view",{key:1},[e.withDirectives(e.createElementVNode("input",{class:"inputer",type:"text",placeholder:"请输入手机号","onUpdate:modelValue":o[0]||(o[0]=t=>e.isRef(n)?n.value=t:n=t)},null,512),[[e.vModelText,e.unref(n)]]),e.createElementVNode("view",{style:{position:"relative"}},[e.withDirectives(e.createElementVNode("input",{class:"inputer",type:"text",placeholder:"请输入验证码","onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]]),e.createElementVNode("button",{style:{position:"absolute",right:"0px",width:"110px","font-size":"16px",bottom:"10px"},onClick:r},[e.createElementVNode("text",null,e.toDisplayString(e.unref(s)),1)])])])),e.unref(h).userInfo.tel_phone?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:2,class:"light_button",onClick:i},"提交"))])],64)}}},[["__scopeId","data-v-8ef2d4f4"]]),Fe=["{","}"];const Me=/^(?:\d)+/,Re=/^(?:\w)+/;const Oe="zh-Hans",qe="zh-Hant",Ue="en",je=Object.prototype.hasOwnProperty,He=(e,t)=>je.call(e,t),Ge=new class{constructor(){this._caches=Object.create(null)}interpolate(e,t,a=Fe){if(!t)return[e];let o=this._caches[e];return o||(o=function(e,[t,a]){const o=[];let n=0,l="";for(;n<e.length;){let s=e[n++];if(s===t){l&&o.push({type:"text",value:l}),l="";let t="";for(s=e[n++];void 0!==s&&s!==a;)t+=s,s=e[n++];const i=s===a,r=Me.test(t)?"list":i&&Re.test(t)?"named":"unknown";o.push({value:t,type:r})}else l+=s}return l&&o.push({type:"text",value:l}),o}(e,a),this._caches[e]=o),function(e,t){const a=[];let o=0;const n=Array.isArray(t)?"list":(l=t,null!==l&&"object"==typeof l?"named":"unknown");var l;if("unknown"===n)return a;for(;o<e.length;){const l=e[o];switch(l.type){case"text":a.push(l.value);break;case"list":a.push(t[parseInt(l.value,10)]);break;case"named":"named"===n&&a.push(t[l.value])}o++}return a}(o,t)}};function We(e,t){if(!e)return;if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if("chinese"===(e=e.toLowerCase()))return Oe;if(0===e.indexOf("zh"))return e.indexOf("-hans")>-1?Oe:e.indexOf("-hant")>-1?qe:(a=e,["-tw","-hk","-mo","-cht"].find((e=>-1!==a.indexOf(e)))?qe:Oe);var a;let o=[Ue,"fr","es"];t&&Object.keys(t).length>0&&(o=Object.keys(t));const n=function(e,t){return t.find((t=>0===e.indexOf(t)))}(e,o);return n||void 0}class Je{constructor({locale:e,fallbackLocale:t,messages:a,watcher:o,formater:n}){this.locale=Ue,this.fallbackLocale=Ue,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=n||Ge,this.messages=a||{},this.setLocale(e||Ue),o&&this.watchLocale(o)}setLocale(e){const t=this.locale;this.locale=We(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach((e=>{e(this.locale,t)}))}getLocale(){return this.locale}watchLocale(e){const t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,a=!0){const o=this.messages[e];o?a?Object.assign(o,t):Object.keys(t).forEach((e=>{He(o,e)||(o[e]=t[e])})):this.messages[e]=t}f(e,t,a){return this.formater.interpolate(e,t,a).join("")}t(e,t,a){let o=this.message;return"string"==typeof t?(t=We(t,this.messages))&&(o=this.messages[t]):a=t,He(o,e)?this.formater.interpolate(o[e],a).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}}const Ke={en:{"uni-load-more.contentdown":"Pull up to show more","uni-load-more.contentrefresh":"loading...","uni-load-more.contentnomore":"No more data"},"zh-Hans":{"uni-load-more.contentdown":"上拉显示更多","uni-load-more.contentrefresh":"正在加载...","uni-load-more.contentnomore":"没有更多数据了"},"zh-Hant":{"uni-load-more.contentdown":"上拉顯示更多","uni-load-more.contentrefresh":"正在加載...","uni-load-more.contentnomore":"沒有更多數據了"}};let Ye;setTimeout((()=>{Ye=uni.getSystemInfoSync().platform}),16);const{t:Qe}=function(e,t={},a,o){if("string"!=typeof e){const a=[t,e];e=a[0],t=a[1]}"string"!=typeof e&&(e="undefined"!=typeof uni&&uni.getLocale?uni.getLocale():"undefined"!=typeof global&&global.getLocale?global.getLocale():Ue),"string"!=typeof a&&(a="undefined"!=typeof __uniConfig&&__uniConfig.fallbackLocale||Ue);const n=new Je({locale:e,fallbackLocale:a,messages:t,watcher:o});let l=(e,t)=>{if("function"!=typeof getApp)l=function(e,t){return n.t(e,t)};else{let e=!1;l=function(t,a){const o=getApp().$vm;return o&&(o.$locale,e||(e=!0,function(e,t){e.$watchLocale?e.$watchLocale((e=>{t.setLocale(e)})):e.$watch((()=>e.$locale),(e=>{t.setLocale(e)}))}(o,n))),n.t(t,a)}}return l(e,t)};return{i18n:n,f:(e,t,a)=>n.f(e,t,a),t:(e,t)=>l(e,t),add:(e,t,a=!0)=>n.add(e,t,a),watch:e=>n.watchLocale(e),getLocale:()=>n.getLocale(),setLocale:e=>n.setLocale(e)}}(Ke);const Xe=V({name:"UniLoadMore",emits:["clickLoadMore"],props:{status:{type:String,default:"more"},showIcon:{type:Boolean,default:!0},iconType:{type:String,default:"auto"},iconSize:{type:Number,default:24},color:{type:String,default:"#777777"},contentText:{type:Object,default:()=>({contentdown:"",contentrefresh:"",contentnomore:""})},showText:{type:Boolean,default:!0}},data:()=>({webviewHide:!1,platform:Ye,imgBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzlBMzU3OTlEOUM0MTFFOUI0NTZDNERBQURBQzI4RkUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzlBMzU3OUFEOUM0MTFFOUI0NTZDNERBQURBQzI4RkUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOUEzNTc5N0Q5QzQxMUU5QjQ1NkM0REFBREFDMjhGRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOUEzNTc5OEQ5QzQxMUU5QjQ1NkM0REFBREFDMjhGRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pt+ALSwAAA6CSURBVHja1FsLkFZVHb98LM+F5bHL8khA1iSeiyQBCRM+YGqKUnnJTDLGI0BGZlKDIU2MMglUiDApEZvSsZnQtBRJtKwQNKQMFYeRDR10WOLd8ljYXdh+v8v5fR3Od+797t1dnOnO/Ofce77z+J//+b/P+ZqtXbs2sJ9MJhNUV1cHJ06cCJo3bx7EPc2aNcvpy7pWrVoF+/fvDyoqKoI2bdoE9fX1F7TjN8a+EXBn/fkfvw942Tf+wYMHg9mzZwfjxo0LDhw4EPa1x2MbFw/fOGfPng1qa2tzcCkILsLDydq2bRsunpOTMM7TD/W/tZDZhPdeKD+yGxHhdu3aBV27dg3OnDlzMVANMheLAO3btw8KCwuDmpoaX5OxbgUIMEq7K8IcPnw4KCsrC/r37x8cP378/4cAXAB3vqSkJMuiDhTkw+XcuXNhOWbMmKBly5YhUT8xArhyFvP0BfwRsAuwxJZJsm/nzp2DTp06he/OU+cZ64K6o0ePBkOHDg2GDx8e6gEbJ5Q/NHNuAJQ1hgBeHUDlR7nVTkY8rQAvAi4z34vR/mPs1FoRsaCgIJThI0eOBC1atEiFGGV+5MiRoS45efJkqFjJFXV1dQuA012m2WcwTw98fy6CqBdsaiIO4CScrGPHjvk4odhavPquRtFWXEC25VgkREKOCh/qDSq+vn37htzD/mZTOmOc5U7zKzBPEedygWshcDyWvs30igAbU+6oyMgJBCFhwQE0fccxN60Ay9iebbjoDh06hMowjQxT4fXq1SskArmHZpkArvixp/kWzHdMeArExSJEaiXIjjRjRJ4DaAGWpibLzXN3Fm1vA5teBgh3j1Rv3bp1YgKwPdmf2p9zcyNYYgPKMfY0T5f5nNYdw158nJ8QawW4CLKwiOBSEgO/hok2eBydR+3dYH+PLxA5J8Vv0KBBwenTp0P2JWAx6+yFEBfs8lMY+y0SWMBNI9E4ThKi58VKTg3FQZS1RQF1cz27eC0QHMu+3E0SkUowjhVt5VdaWhp07949ZHv2Qd1EjDXM2cla1M0nl3GxAs3J9yREzyTdFVKVFOaE9qRA8GM0WebRuo9JGZKA7Mv2SeS/Z8+eoQ9BArMfFrLGo6jvxbhHbJZnKX2Rzz1O7QhJJ9Cs2ZMaWIyq/zhdeqPNfIoHd58clIQD+JSXl4dKlyIAuBdVXZwFVWKspSSoxE++h8x4k3uCnEhE4I5KwRiFWGOU0QWKiCYLbdoRMRKAu2kQ9vkfLU6dOhX06NEjlH+yMRZSinnuyWnYosVcji8CEA/6Cg2JF+IIUBqnGKUTCNwtwBN4f89RiK1R96DEgO2o0NDmtEdvVFdVVYV+P3UAPUEs6GFwV3PHmXkD4vh74iDFJysVI/MlaQhwKeBNTLYX5VuA8T4/gZxA4MRGFxDB6R7OmYPfyykGRJbyie+XnGYnQIC/coH9+vULiYrxrkL9ZA9+0ykaHIfEpM7ge8TiJ2CsHYwyMfafAF1yCGBHYIbCVDjDjKt7BeB51D+LgQa6OkG7IDYEEtvQ7lnXLKLtLdLuJBpE4gPUXcW2+PkZwOex+4cGDhwYDBkyRL7/HFcEwUGPo/8uWRUpYnfxGHco8HkewLHLyYmAawAPuIFZxhOpDfJQ8gbUv41yORAptMWBNr6oqMhWird5+u+iHmBb2nhjDV7HWBNQTgK8y11l5NetWzc5ULscAtSj7nbNI0skhWeUZCc0W4nyH/jO4Vz0u1IeYhbk4AiwM6tjxIWByHsoZ9qcIBPJd/y+DwPfBESOmCa/QF3WiZHucLlEDpNxcNhmheEOPgdQNx6/VZFQzFZ5TN08AHXQt2Ii3EdyFuUsPtTcGPhW5iMiCNELvz+Gdn9huG4HUJaW/w3g0wxV0XaG7arG2WeKiUWYM4Y7GO5ezshTARbbWGw/DvXkpp/ivVvE0JVoMxN4rpGzJMhE5Pl+xlATsDIqikP9F9D2z3h9nOksEUFhK+qO4rcPkoalMQ/HqJLIyb3F3JdjrCcw1yZ8joyJLR5gCo54etlag7qIoeNh1N1BRYj3DTFJ0elotxPlVzkGuYAmL0VSJVGAJA41c4Z6A3BzTLfn0HYwYKEI6CUAMzZEWvLsIcQOo1AmmyyM72nHJCfYsogflGV6jEk9vyQZXSuq6w4c16NsGcGZbwOPr+H1RkOk2LEzjNepxQkihHSCQ4ynAYNRx2zMKV92CQMWqj8J0BRE8EShxRFN6YrfCRhC0x3r/Zm4IbQCcmJoV0kMamllccR6FjHqUC5F2R/wS2dcymOlfAKOS4KmzQb5cpNC2MC7JhVn5wjXoJ44rYhLh8n0eXOCorJxa7POjbSlCGVczr34/RsAmrcvo9s+wGp3tzVhntxiXiJ4nvEYb4FJkf0O8HocAePmLvCxnL0AORraVekJk6TYjDabRVXfRE2lCN1h6ZQRN1+InUbsCpKwoBZHh0dODN9JBCUffItXxEavTQkUtnfTVAplCWL3JISz29h4NjotnuSsQKJCk8dF+kJR6RARjrqFVmfPnj3ZbK8cIJ0msd6jgHPGtfVTQ8VLmlvh4mct9sobRmPic0DyDQQnx/NlfYUgyz59+oScsH379pAwXABD32nTpoUHIToESeI5mnbE/UqDdyLcafEBf2MCqgC7NwxIbMREJQ0g4D4sfJwnD+AmRrII05cfMWJE+L1169bQr+fip06dGp4oJ83lmYd5wj/EmMa4TaHivo4EeCguYZBnkB5g2aWA69OIEnUHOaGysjIYMGBAMGnSpODYsWPZwCpFmm4lNq+4gSLQA7jcX8DwtjEyRC8wjabnXEx9kfWnTJkSJkAo90xpJVV+FmcVNeYAF5zWngS4C4O91MBxmAv8blLEpbjI5sz9MTdAhcgkCT1RO8mZkAjfiYpTEvStAS53Uw1vAiUGgZ3GpuQEYvoiBqlIan7kSDHnTwJQFNiPu0+5VxCVYhcZIjNrdXUDdp+Eq5AZ3Gkg8QAyVZRZIk4Tl4QAbF9cXJxNYZMAtAokgs4BrNxEpCtteXg7DDTMDKYNSuQdKsnJBek7HxewvxaosWxLYXtw+cJp18217wql4aKCfBNoEu0O5VU+PhctJ0YeXD4C6JQpyrlpSLTojpGGGN5YwNziChdIZLk4lvLcFJ9jMX3QdiImY9bmGQU+TRUL5CHITTRlgF8D9ouD1MfmLoEPl5xokIumZ2cfgMpHt47IW9N64Hsh7wQYYjyIugWuF5fCqYncXRd5vPMWyizzvhi/32+nvG0dZc9vR6fZOu0md5e+uC408FvKSIOZwXlGvxPv95izA2Vtvg1xKFWARI+vMX66HUhpQQb643uW1bSjuTWyw2SBvDrBvjFic1eGGlz5esq3ko9uSIlBRqPuFcCv8F4WIcN12nVaBd0SaYwI6PDDImR11JkqgHcPmQssjxIn6bUshygDFJUTxPMpHk+jfjPgupgdnYV2R/g7xSjtpah8RJBewhwf0gGK6XI92u4wXFEU40afJ4DN4h5LcAd+40HI3JgJecuT0c062W0i2hQJUTcxan3/CMW1PF2K6bbA+Daz4xRs1D3Br1Cm0OihKCqizW78/nXAF/G5TXrEcVzaNMH6CyMswqsAHqDyDLEyou8lwOXnKF8DjI6KjV3KzMBiXkDH8ij/H214J5A596ekrZ3F0zXlWeL7+P5eUrNo3/QwC15uxthuzidy7DzKRwEDaAViiDgKbTbz7CJnzo0bN7pIfIiid8SuPwn25o3QCmpnyjlZkyxPP8EomCJzrGb7GJMx7tNsq4MT2xMUYaiErZOluTzKsnz3gwCeCZyVRZJfYplNEokEjwrPtxlxjeYAk+F1F74VAzPxQRNYYdtpOUvWs8J1sGhBJMNsb7igN8plJs1eSmLIhLKE4rvaCX27gOhLpLOsIzJ7qn/i+wZzcvSOZ23/du8TZjwV8zHIXoP4R3ifBxiFz1dcVpa3aPntPE+c6TmIWE9EtcMmAcPdWAhYhAXxcLOQi9L1WhD1Sc8p1d2oL7XGiRKp8F4A2i8K/nfI+y/gsTDJ/YC/8+AD5Uh04KHiGl+cIFPnBDDrPMjwRGkLXyxO4VGbfQWnDH2v0bVWE3C9QOXlepbgjEfIJQI6XDG3z5ahD9cw2pS78ipB85wyScNTvsVzlzzhL8/jRrnmVjfFJK/m3m4nj9vbgQTguT8XZTjsm672R5uJKEaQmBI/c58gyus8ZDagLpEVSJBIyHp4jn++xqPV71OgQgJYEWOtZ/haxRtKmWOBu8xdBLftWltsY84zE6WIEy/eIOWL+BaayMx+KHtL7EAkqdNDLiEXmEMUHniedtJqg9HmZtfvt26vNi0BdG3Ft3g8ZOf7PAu59TxtzivLNIekyi+wD1i8CuUiD9FXAa8C+/xS3JPmZnomyc7H+fb4/Se0bk41Fel621r4cgVxbq91V4jVqwB7HTe2M7jgB+QWHavZkDRPmZcASoZEmBx6i75bGjPcMdL4/VKGFAGWZkGzPG0XAbdL9A81G5LOmUnC9hHKJeO7dcUMjblSl12867ElFTtaGl20xvvLGPdVz/8TVuU7y0x1PG7vtNg24oz9Uo/Z412++VFWI7Fcog9tu9Lm6gvRmIPv9x1xmQAu6RDkXtbOtlGEmpgD5Nvnyc0dcv0EE6cfdi1HmhMf9wDF3k3gtRvEedhxjpgfqPb9PU9iEJHnyOUA7bQUXh6kq/D7l2iTjWv7XOD530BDr8jIrus+srXjt4MzumJMHuTsBa63YKE1+RR5lBjEikCCnWKWiHdzOgKO+nRIBAF88za/IFmJ3eMZov4CYxGBabcpGL8EYx+SeMXJeRwHNsV/h+vdxeuhEpN3ZyNY78Gm2fknJxVGhyjixPiQvVkNzT1elD9Py/aTAL64Hb9vcYmC9zfdXdT/C1LeGbg4rnBaAihDFJH12W5ulfNCNe/xTsP3bp8ikzJs5BF+5PNfAQYAPaseTdsEcaYAAAAASUVORK5CYII="}),computed:{iconSnowWidth(){return 2*(Math.floor(this.iconSize/24)||1)},contentdownText(){return this.contentText.contentdown||Qe("uni-load-more.contentdown")},contentrefreshText(){return this.contentText.contentrefresh||Qe("uni-load-more.contentrefresh")},contentnomoreText(){return this.contentText.contentnomore||Qe("uni-load-more.contentnomore")}},mounted(){var e=getCurrentPages(),t=e[e.length-1].$getAppWebview();t.addEventListener("hide",(()=>{this.webviewHide=!0})),t.addEventListener("show",(()=>{this.webviewHide=!1}))},methods:{onClick(){this.$emit("clickLoadMore",{detail:{status:this.status}})}}},[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",{class:"uni-load-more",onClick:a[0]||(a[0]=(...e)=>s.onClick&&s.onClick(...e))},[!l.webviewHide&&("circle"===o.iconType||"auto"===o.iconType&&"android"===l.platform)&&"loading"===o.status&&o.showIcon?(e.openBlock(),e.createElementBlock("view",{key:0,style:e.normalizeStyle({width:o.iconSize+"px",height:o.iconSize+"px"}),class:"uni-load-more__img uni-load-more__img--android-MP"},[e.createElementVNode("view",{class:"uni-load-more__img-icon",style:e.normalizeStyle({borderTopColor:o.color,borderTopWidth:o.iconSize/12})},null,4),e.createElementVNode("view",{class:"uni-load-more__img-icon",style:e.normalizeStyle({borderTopColor:o.color,borderTopWidth:o.iconSize/12})},null,4),e.createElementVNode("view",{class:"uni-load-more__img-icon",style:e.normalizeStyle({borderTopColor:o.color,borderTopWidth:o.iconSize/12})},null,4)],4)):!l.webviewHide&&"loading"===o.status&&o.showIcon?(e.openBlock(),e.createElementBlock("view",{key:1,style:e.normalizeStyle({width:o.iconSize+"px",height:o.iconSize+"px"}),class:"uni-load-more__img uni-load-more__img--ios-H5"},[e.createElementVNode("image",{src:l.imgBase64,mode:"widthFix"},null,8,["src"])],4)):e.createCommentVNode("",!0),o.showText?(e.openBlock(),e.createElementBlock("text",{key:2,class:"uni-load-more__text",style:e.normalizeStyle({color:o.color})},e.toDisplayString("more"===o.status?s.contentdownText:"loading"===o.status?s.contentrefreshText:s.contentnomoreText),5)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-090e4ba3"]]),Ze={pages:[{path:"pages/index/index",style:{navigationBarTitleText:"首页",navigationStyle:"custom",enablePullDownRefresh:!0}},{path:"pages/homepage/homepage",style:{navigationBarTitleText:"home",navigationStyle:"custom"}},{path:"pages/stock/stock",style:{navigationBarTitleText:"我的娃柜",navigationStyle:"custom"}},{path:"pages/mine/mine",style:{navigationBarTitleText:"个人信息",navigationStyle:"custom"}},{path:"pages/watch_demo/watch_demo",style:{navigationBarTitleText:"watch_demo"}},{path:"pages/goods/goods",style:{navigationBarTitleText:"商品页面","app-plus":{softinputmode:"adjustResize"}}},{path:"pages/brand/brand",style:{navigationBarTitleText:"品牌页面"}},{path:"pages/calendar/calendar",style:{navigationBarTitleText:"上新",navigationStyle:"custom",enablePullDownRefresh:!0}},{path:"pages/pop_croper/pop_croper",style:{navigationBarTitleText:""}},{path:"pages/setting/setting",style:{navigationBarTitleText:""}},{path:"pages/setting/password/password",style:{navigationBarTitleText:""}},{path:"pages/setting/tel_phone/tel_phone",style:{navigationBarTitleText:""}},{path:"pages/stock/account_book_form/account_book_form",style:{navigationBarTitleText:""}},{path:"pages/stock/showcase_form/showcase_form",style:{navigationBarTitleText:""}},{path:"pages/stock/bill_form/bill_form",style:{navigationBarTitleText:""}},{path:"pages/collocation/collocation",style:{navigationBarTitleText:"分享搭配"}},{path:"pages/collocation_share/collocation_share",style:{navigationBarTitleText:""}},{path:"pages/user_page/user_page",style:{navigationBarTitleText:""}},{path:"pages/message_list/message_list",style:{navigationBarTitleText:""}},{path:"pages/message_info/message_info",style:{navigationBarTitleText:""}},{path:"pages/register/register",style:{navigationBarTitleText:""}},{path:"pages/user_like/user_like",style:{navigationBarTitleText:""}},{path:"pages/collocation_square/collocation_square",style:{navigationBarTitleText:"",navigationStyle:"custom",enablePullDownRefresh:!0}},{path:"pages/sale_news/sale_news",style:{navigationBarTitleText:""}},{path:"pages/treehole_publish/treehole_publish",style:{navigationBarTitleText:""}},{path:"pages/treehole_detail/treehole_detail",style:{navigationBarTitleText:""}},{path:"pages/reset_password/reset_password",style:{navigationBarTitleText:""}},{path:"pages/setting/username/username",style:{navigationBarTitleText:""}},{path:"pages/my_comment/my_comment",style:{navigationBarTitleText:""}},{path:"pages/my_collocation/my_collocation",style:{navigationBarTitleText:""}},{path:"pages/article_detail/article_detail",style:{navigationBarTitleText:""}},{path:"pages/loadding/loadding",style:{navigationBarTitleText:""}},{path:"pages/private/private",style:{navigationBarTitleText:""}},{path:"pages/permission/permission",style:{navigationBarTitleText:""}},{path:"pages/drag-image-test/drag-image-test",style:{navigationBarTitleText:""}},{path:"pages/account_book_preview/account_book_preview",style:{navigationBarTitleText:""}},{path:"pages/creator_base/creator_base",style:{navigationBarTitleText:""}},{path:"pages/creator_base/brand_edit/brand_edit",style:{navigationBarTitleText:""}},{path:"pages/creator_base/goods_list/goods_list",style:{navigationBarTitleText:""}},{path:"pages/creator_base/goods_editor/goods_editor",style:{navigationBarTitleText:""}},{path:"pages/creator_base/collocation_list/collocation_list",style:{navigationBarTitleText:""}},{path:"pages/creator_base/artist_info/artist_info",style:{navigationBarTitleText:""}},{path:"pages/creator_base/artist_setting/artist_setting",style:{navigationBarTitleText:""}},{path:"pages/artist_info/artist_info",style:{navigationBarTitleText:""}},{path:"pages/creator_base/set_showcase/set_showcase",style:{navigationBarTitleText:""}},{path:"pages/creator_base/faceup_editor/faceup_editor",style:{navigationBarTitleText:""}},{path:"pages/creator_base/order_plane/order_plane",style:{navigationBarTitleText:""}},{path:"pages/artwork/artwork",style:{navigationBarTitleText:""}},{path:"pages/creator_base/news/news",style:{navigationBarTitleText:""}}],globalStyle:{navigationBarTextStyle:"black",navigationBarTitleText:"uni-app",navigationBarBackgroundColor:"#F8F8F8",backgroundColor:"#F8F8F8",rpxCalcMaxDeviceWidth:750,rpxCalcBaseDeviceWidth:375,rpxCalcIncludeWidth:750},tabBar:{selectedColor:"#7cc1d2",backgroundColor:"#fefefe",borderStyle:"white",list:[{pagePath:"pages/index/index",text:"百科",iconPath:"static/new-icon/tab1.png",selectedIconPath:"static/new-icon/tab1.png"},{pagePath:"pages/collocation_square/collocation_square",text:"广场",iconPath:"static/new-icon/tab4.png",selectedIconPath:"static/new-icon/tab4.png"},{pagePath:"pages/calendar/calendar",text:"上新",iconPath:"static/new-icon/tab2.png",selectedIconPath:"static/new-icon/tab2.png"},{pagePath:"pages/stock/stock",text:"娃柜",iconPath:"static/new-icon/tab3.png",selectedIconPath:"static/new-icon/tab3.png"},{pagePath:"pages/mine/mine",text:"我的",iconPath:"static/new-icon/tab5.png",selectedIconPath:"static/new-icon/tab5.png"}]},uniIdRouter:{}};function et(e,t,a){return e(a={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&a.path)}},a.exports),a.exports}var tt=et((function(e,t){var a;e.exports=(a=a||function(e,t){var a=Object.create||function(){function e(){}return function(t){var a;return e.prototype=t,a=new e,e.prototype=null,a}}(),o={},n=o.lib={},l=n.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=n.WordArray=l.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||r).stringify(this)},concat:function(e){var t=this.words,a=e.words,o=this.sigBytes,n=e.sigBytes;if(this.clamp(),o%4)for(var l=0;l<n;l++){var s=a[l>>>2]>>>24-l%4*8&255;t[o+l>>>2]|=s<<24-(o+l)%4*8}else for(l=0;l<n;l+=4)t[o+l>>>2]=a[l>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,a=this.sigBytes;t[a>>>2]&=4294967295<<32-a%4*8,t.length=e.ceil(a/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var a,o=[],n=function(t){var a=987654321,o=4294967295;return function(){var n=((a=36969*(65535&a)+(a>>16)&o)<<16)+(t=18e3*(65535&t)+(t>>16)&o)&o;return n/=4294967296,(n+=.5)*(e.random()>.5?1:-1)}},l=0;l<t;l+=4){var i=n(4294967296*(a||e.random()));a=987654071*i(),o.push(4294967296*i()|0)}return new s.init(o,t)}}),i=o.enc={},r=i.Hex={stringify:function(e){for(var t=e.words,a=e.sigBytes,o=[],n=0;n<a;n++){var l=t[n>>>2]>>>24-n%4*8&255;o.push((l>>>4).toString(16)),o.push((15&l).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,a=[],o=0;o<t;o+=2)a[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new s.init(a,t/2)}},c=i.Latin1={stringify:function(e){for(var t=e.words,a=e.sigBytes,o=[],n=0;n<a;n++){var l=t[n>>>2]>>>24-n%4*8&255;o.push(String.fromCharCode(l))}return o.join("")},parse:function(e){for(var t=e.length,a=[],o=0;o<t;o++)a[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new s.init(a,t)}},u=i.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=n.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var a=this._data,o=a.words,n=a.sigBytes,l=this.blockSize,i=n/(4*l),r=(i=t?e.ceil(i):e.max((0|i)-this._minBufferSize,0))*l,c=e.min(4*r,n);if(r){for(var u=0;u<r;u+=l)this._doProcessBlock(o,u);var d=o.splice(0,r);a.sigBytes-=c}return new s.init(d,c)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=d.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,a){return new e.init(a).finalize(t)}},_createHmacHelper:function(e){return function(t,a){return new m.HMAC.init(e,a).finalize(t)}}});var m=o.algo={};return o}(Math),a)})),at=tt,ot=(et((function(e,t){var a;e.exports=(a=at,function(e){var t=a,o=t.lib,n=o.WordArray,l=o.Hasher,s=t.algo,i=[];!function(){for(var t=0;t<64;t++)i[t]=4294967296*e.abs(e.sin(t+1))|0}();var r=s.MD5=l.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var a=0;a<16;a++){var o=t+a,n=e[o];e[o]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var l=this._hash.words,s=e[t+0],r=e[t+1],p=e[t+2],h=e[t+3],g=e[t+4],v=e[t+5],f=e[t+6],y=e[t+7],w=e[t+8],_=e[t+9],k=e[t+10],E=e[t+11],N=e[t+12],V=e[t+13],b=e[t+14],x=e[t+15],S=l[0],C=l[1],B=l[2],T=l[3];S=c(S,C,B,T,s,7,i[0]),T=c(T,S,C,B,r,12,i[1]),B=c(B,T,S,C,p,17,i[2]),C=c(C,B,T,S,h,22,i[3]),S=c(S,C,B,T,g,7,i[4]),T=c(T,S,C,B,v,12,i[5]),B=c(B,T,S,C,f,17,i[6]),C=c(C,B,T,S,y,22,i[7]),S=c(S,C,B,T,w,7,i[8]),T=c(T,S,C,B,_,12,i[9]),B=c(B,T,S,C,k,17,i[10]),C=c(C,B,T,S,E,22,i[11]),S=c(S,C,B,T,N,7,i[12]),T=c(T,S,C,B,V,12,i[13]),B=c(B,T,S,C,b,17,i[14]),S=u(S,C=c(C,B,T,S,x,22,i[15]),B,T,r,5,i[16]),T=u(T,S,C,B,f,9,i[17]),B=u(B,T,S,C,E,14,i[18]),C=u(C,B,T,S,s,20,i[19]),S=u(S,C,B,T,v,5,i[20]),T=u(T,S,C,B,k,9,i[21]),B=u(B,T,S,C,x,14,i[22]),C=u(C,B,T,S,g,20,i[23]),S=u(S,C,B,T,_,5,i[24]),T=u(T,S,C,B,b,9,i[25]),B=u(B,T,S,C,h,14,i[26]),C=u(C,B,T,S,w,20,i[27]),S=u(S,C,B,T,V,5,i[28]),T=u(T,S,C,B,p,9,i[29]),B=u(B,T,S,C,y,14,i[30]),S=d(S,C=u(C,B,T,S,N,20,i[31]),B,T,v,4,i[32]),T=d(T,S,C,B,w,11,i[33]),B=d(B,T,S,C,E,16,i[34]),C=d(C,B,T,S,b,23,i[35]),S=d(S,C,B,T,r,4,i[36]),T=d(T,S,C,B,g,11,i[37]),B=d(B,T,S,C,y,16,i[38]),C=d(C,B,T,S,k,23,i[39]),S=d(S,C,B,T,V,4,i[40]),T=d(T,S,C,B,s,11,i[41]),B=d(B,T,S,C,h,16,i[42]),C=d(C,B,T,S,f,23,i[43]),S=d(S,C,B,T,_,4,i[44]),T=d(T,S,C,B,N,11,i[45]),B=d(B,T,S,C,x,16,i[46]),S=m(S,C=d(C,B,T,S,p,23,i[47]),B,T,s,6,i[48]),T=m(T,S,C,B,y,10,i[49]),B=m(B,T,S,C,b,15,i[50]),C=m(C,B,T,S,v,21,i[51]),S=m(S,C,B,T,N,6,i[52]),T=m(T,S,C,B,h,10,i[53]),B=m(B,T,S,C,k,15,i[54]),C=m(C,B,T,S,r,21,i[55]),S=m(S,C,B,T,w,6,i[56]),T=m(T,S,C,B,x,10,i[57]),B=m(B,T,S,C,f,15,i[58]),C=m(C,B,T,S,V,21,i[59]),S=m(S,C,B,T,g,6,i[60]),T=m(T,S,C,B,E,10,i[61]),B=m(B,T,S,C,p,15,i[62]),C=m(C,B,T,S,_,21,i[63]),l[0]=l[0]+S|0,l[1]=l[1]+C|0,l[2]=l[2]+B|0,l[3]=l[3]+T|0},_doFinalize:function(){var t=this._data,a=t.words,o=8*this._nDataBytes,n=8*t.sigBytes;a[n>>>5]|=128<<24-n%32;var l=e.floor(o/4294967296),s=o;a[15+(n+64>>>9<<4)]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),a[14+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(a.length+1),this._process();for(var i=this._hash,r=i.words,c=0;c<4;c++){var u=r[c];r[c]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return i},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,a,o,n,l,s){var i=e+(t&a|~t&o)+n+s;return(i<<l|i>>>32-l)+t}function u(e,t,a,o,n,l,s){var i=e+(t&o|a&~o)+n+s;return(i<<l|i>>>32-l)+t}function d(e,t,a,o,n,l,s){var i=e+(t^a^o)+n+s;return(i<<l|i>>>32-l)+t}function m(e,t,a,o,n,l,s){var i=e+(a^(t|~o))+n+s;return(i<<l|i>>>32-l)+t}t.MD5=l._createHelper(r),t.HmacMD5=l._createHmacHelper(r)}(Math),a.MD5)})),et((function(e,t){var a,o,n;e.exports=(o=(a=at).lib.Base,n=a.enc.Utf8,void(a.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var a=e.blockSize,o=4*a;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var l=this._oKey=t.clone(),s=this._iKey=t.clone(),i=l.words,r=s.words,c=0;c<a;c++)i[c]^=1549556828,r[c]^=909522486;l.sigBytes=s.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,a=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(a))}})))})),et((function(e,t){e.exports=at.HmacMD5}))),nt=et((function(e,t){e.exports=at.enc.Utf8})),lt=et((function(e,t){var a,o,n;e.exports=(n=(o=a=at).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,a=e.sigBytes,o=this._map;e.clamp();for(var n=[],l=0;l<a;l+=3)for(var s=(t[l>>>2]>>>24-l%4*8&255)<<16|(t[l+1>>>2]>>>24-(l+1)%4*8&255)<<8|t[l+2>>>2]>>>24-(l+2)%4*8&255,i=0;i<4&&l+.75*i<a;i++)n.push(o.charAt(s>>>6*(3-i)&63));var r=o.charAt(64);if(r)for(;n.length%4;)n.push(r);return n.join("")},parse:function(e){var t=e.length,a=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var l=0;l<a.length;l++)o[a.charCodeAt(l)]=l}var s=a.charAt(64);if(s){var i=e.indexOf(s);-1!==i&&(t=i)}return function(e,t,a){for(var o=[],l=0,s=0;s<t;s++)if(s%4){var i=a[e.charCodeAt(s-1)]<<s%4*2,r=a[e.charCodeAt(s)]>>>6-s%4*2;o[l>>>2]|=(i|r)<<24-l%4*8,l++}return n.create(o,l)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},a.enc.Base64)}));const st="uni_id_token",it="uni_id_token_expired",rt="FUNCTION",ct="OBJECT",ut="CLIENT_DB",dt="pending",mt="rejected";function pt(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function ht(e){return"object"===pt(e)}function gt(e){return"function"==typeof e}function vt(e){return function(){try{return e.apply(e,arguments)}catch(t){console.error(t)}}}const ft="REJECTED",yt="NOT_PENDING";class wt{constructor({createPromise:e,retryRule:t=ft}={}){this.createPromise=e,this.status=null,this.promise=null,this.retryRule=t}get needRetry(){if(!this.status)return!0;switch(this.retryRule){case ft:return this.status===mt;case yt:return this.status!==dt}}exec(){return this.needRetry?(this.status=dt,this.promise=this.createPromise().then((e=>(this.status="fulfilled",Promise.resolve(e))),(e=>(this.status=mt,Promise.reject(e)))),this.promise):this.promise}}function _t(e){return e&&"string"==typeof e?JSON.parse(e):e}const kt=_t([]);_t("");const Et=_t("[]")||[];let Nt="";try{Nt="__UNI__5D7AAEE"}catch(ma){}let Vt,bt={};function xt(e,t={}){var a,o;return a=bt,o=e,Object.prototype.hasOwnProperty.call(a,o)||(bt[e]=t),bt[e]}bt=uni._globalUniCloudObj?uni._globalUniCloudObj:uni._globalUniCloudObj={};const St=["invoke","success","fail","complete"],Ct=xt("_globalUniCloudInterceptor");function Bt(e,t){Ct[e]||(Ct[e]={}),ht(t)&&Object.keys(t).forEach((a=>{St.indexOf(a)>-1&&function(e,t,a){let o=Ct[e][t];o||(o=Ct[e][t]=[]),-1===o.indexOf(a)&&gt(a)&&o.push(a)}(e,a,t[a])}))}function Tt(e,t){Ct[e]||(Ct[e]={}),ht(t)?Object.keys(t).forEach((a=>{St.indexOf(a)>-1&&function(e,t,a){const o=Ct[e][t];if(!o)return;const n=o.indexOf(a);n>-1&&o.splice(n,1)}(e,a,t[a])})):delete Ct[e]}function Dt(e,t){return e&&0!==e.length?e.reduce(((e,a)=>e.then((()=>a(t)))),Promise.resolve()):Promise.resolve()}function It(e,t){return Ct[e]&&Ct[e][t]||[]}function zt(e){Bt("callObject",e)}const At=xt("_globalUniCloudListener"),Pt="response",Lt="needLogin",$t="refreshToken",Ft="clientdb",Mt="cloudfunction",Rt="cloudobject";function Ot(e){return At[e]||(At[e]=[]),At[e]}function qt(e,t){const a=Ot(e);a.includes(t)||a.push(t)}function Ut(e,t){const a=Ot(e),o=a.indexOf(t);-1!==o&&a.splice(o,1)}function jt(e,t){const a=Ot(e);for(let o=0;o<a.length;o++)(0,a[o])(t)}let Ht,Gt=!1;function Wt(){return Ht||(Ht=new Promise((e=>{Gt&&e(),function t(){if("function"==typeof getCurrentPages){const t=getCurrentPages();t&&t[0]&&(Gt=!0,e())}Gt||setTimeout((()=>{t()}),30)}()})),Ht)}function Jt(e){const t={};for(const a in e){const o=e[a];gt(o)&&(t[a]=vt(o))}return t}class Kt extends Error{constructor(e){const t=e.message||e.errMsg||"unknown system error";super(t),this.errMsg=t,this.code=this.errCode=e.code||e.errCode||"SYSTEM_ERROR",this.errSubject=this.subject=e.subject||e.errSubject,this.cause=e.cause,this.requestId=e.requestId}toJson(e=0){if(!(e>=10))return e++,{errCode:this.errCode,errMsg:this.errMsg,errSubject:this.errSubject,cause:this.cause&&this.cause.toJson?this.cause.toJson(e):this.cause}}}var Yt={request:e=>uni.request(e),uploadFile:e=>uni.uploadFile(e),setStorageSync:(e,t)=>uni.setStorageSync(e,t),getStorageSync:e=>uni.getStorageSync(e),removeStorageSync:e=>uni.removeStorageSync(e),clearStorageSync:()=>uni.clearStorageSync(),connectSocket:e=>uni.connectSocket(e)};function Qt(e){return e&&Qt(e.__v_raw)||e}function Xt(){return{token:Yt.getStorageSync(st)||Yt.getStorageSync("uniIdToken"),tokenExpired:Yt.getStorageSync(it)}}function Zt({token:e,tokenExpired:t}={}){e&&Yt.setStorageSync(st,e),t&&Yt.setStorageSync(it,t)}let ea,ta;function aa(){return ea||(ea=uni.getSystemInfoSync()),ea}function oa(){let e,t;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;const{scene:a,channel:o}=uni.getLaunchOptionsSync();e=o,t=a}}catch(a){}return{channel:e,scene:t}}let na={};function la(){const e=uni.getLocale&&uni.getLocale()||"en";if(ta)return{...na,...ta,locale:e,LOCALE:e};const t=aa(),{deviceId:a,osName:o,uniPlatform:n,appId:l}=t,s=["appId","appLanguage","appName","appVersion","appVersionCode","appWgtVersion","browserName","browserVersion","deviceBrand","deviceId","deviceModel","deviceType","osName","osVersion","romName","romVersion","ua","hostName","hostVersion","uniPlatform","uniRuntimeVersion","uniRuntimeVersionCode","uniCompilerVersion","uniCompilerVersionCode"];for(const i in t)Object.hasOwnProperty.call(t,i)&&-1===s.indexOf(i)&&delete t[i];return ta={PLATFORM:n,OS:o,APPID:l,DEVICEID:a,...oa(),...t},{...na,...ta,locale:e,LOCALE:e}}var sa=function(e,t){let a="";return Object.keys(e).sort().forEach((function(t){e[t]&&(a=a+"&"+t+"="+e[t])})),a=a.slice(1),ot(a,t).toString()},ia=function(e,t){return new Promise(((a,o)=>{t(Object.assign(e,{complete(e){e||(e={});const t=e.data&&e.data.header&&e.data.header["x-serverless-request-id"]||e.header&&e.header["request-id"];if(!e.statusCode||e.statusCode>=400){const a=e.data&&e.data.error&&e.data.error.code||"SYS_ERR",n=e.data&&e.data.error&&e.data.error.message||e.errMsg||"request:fail";return o(new Kt({code:a,message:n,requestId:t}))}const n=e.data;if(n.error)return o(new Kt({code:n.error.code,message:n.error.message,requestId:t}));n.result=n.data,n.requestId=t,delete n.data,a(n)}}))}))},ra=function(e){return lt.stringify(nt.parse(e))},ca={init(e){const t=new class{constructor(e){["spaceId","clientSecret"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),this.config=Object.assign({},{endpoint:0===e.spaceId.indexOf("mp-")?"https://api.next.bspapp.com":"https://api.bspapp.com"},e),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=Yt,this._getAccessTokenPromiseHub=new wt({createPromise:()=>this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then((e=>{if(!e.result||!e.result.accessToken)throw new Kt({code:"AUTH_FAILED",message:"获取accessToken失败"});this.setAccessToken(e.result.accessToken)})),retryRule:yt})}get hasAccessToken(){return!!this.accessToken}setAccessToken(e){this.accessToken=e}requestWrapped(e){return ia(e,this.adapter.request)}requestAuth(e){return this.requestWrapped(e)}request(e,t){return Promise.resolve().then((()=>this.hasAccessToken?t?this.requestWrapped(e):this.requestWrapped(e).catch((t=>new Promise(((e,a)=>{!t||"GATEWAY_INVALID_TOKEN"!==t.code&&"InvalidParameter.InvalidToken"!==t.code?a(t):e()})).then((()=>this.getAccessToken())).then((()=>{const t=this.rebuildRequest(e);return this.request(t,!0)})))):this.getAccessToken().then((()=>{const t=this.rebuildRequest(e);return this.request(t,!0)}))))}rebuildRequest(e){const t=Object.assign({},e);return t.data.token=this.accessToken,t.header["x-basement-token"]=this.accessToken,t.header["x-serverless-sign"]=sa(t.data,this.config.clientSecret),t}setupRequest(e,t){const a=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),o={"Content-Type":"application/json"};return"auth"!==t&&(a.token=this.accessToken,o["x-basement-token"]=this.accessToken),o["x-serverless-sign"]=sa(a,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:a,dataType:"json",header:o}}getAccessToken(){return this._getAccessTokenPromiseHub.exec()}async authorize(){await this.getAccessToken()}callFunction(e){const t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request({...this.setupRequest(t),timeout:e.timeout})}getOSSUploadOptionsFromPath(e){const t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}uploadFileToOSS({url:e,formData:t,name:a,filePath:o,fileType:n,onUploadProgress:l}){return new Promise(((s,i)=>{const r=this.adapter.uploadFile({url:e,formData:t,name:a,filePath:o,fileType:n,header:{"X-OSS-server-side-encrpytion":"AES256"},success(e){e&&e.statusCode<400?s(e):i(new Kt({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail(e){i(new Kt({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof l&&r&&"function"==typeof r.onProgressUpdate&&r.onProgressUpdate((e=>{l({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}reportOSSUpload(e){const t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}async uploadFile({filePath:e,cloudPath:t,fileType:a="image",cloudPathAsRealPath:o=!1,onUploadProgress:n,config:l}){if("string"!==pt(t))throw new Kt({code:"INVALID_PARAM",message:"cloudPath必须为字符串类型"});if(!(t=t.trim()))throw new Kt({code:"INVALID_PARAM",message:"cloudPath不可为空"});if(/:\/\//.test(t))throw new Kt({code:"INVALID_PARAM",message:"cloudPath不合法"});const s=l&&l.envType||this.config.envType;if(o&&("/"!==t[0]&&(t="/"+t),t.indexOf("\\")>-1))throw new Kt({code:"INVALID_PARAM",message:"使用cloudPath作为路径时，cloudPath不可包含“\\”"});const i=(await this.getOSSUploadOptionsFromPath({env:s,filename:o?t.split("/").pop():t,fileId:o?t:void 0})).result,r="https://"+i.cdnDomain+"/"+i.ossPath,{securityToken:c,accessKeyId:u,signature:d,host:m,ossPath:p,id:h,policy:g,ossCallbackUrl:v}=i,f={"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:u,Signature:d,host:m,id:h,key:p,policy:g,success_action_status:200};if(c&&(f["x-oss-security-token"]=c),v){const e=JSON.stringify({callbackUrl:v,callbackBody:JSON.stringify({fileId:h,spaceId:this.config.spaceId}),callbackBodyType:"application/json"});f.callback=ra(e)}const y={url:"https://"+i.host,formData:f,fileName:"file",name:"file",filePath:e,fileType:a};if(await this.uploadFileToOSS(Object.assign({},y,{onUploadProgress:n})),v)return{success:!0,filePath:e,fileID:r};if((await this.reportOSSUpload({id:h})).success)return{success:!0,filePath:e,fileID:r};throw new Kt({code:"UPLOAD_FAILED",message:"文件上传失败"})}getTempFileURL({fileList:e}={}){return new Promise(((t,a)=>{Array.isArray(e)&&0!==e.length||a(new Kt({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"})),this.getFileInfo({fileList:e}).then((a=>{t({fileList:e.map(((e,t)=>{const o=a.fileList[t];return{fileID:e,tempFileURL:o&&o.url||e}}))})}))}))}async getFileInfo({fileList:e}={}){if(!Array.isArray(e)||0===e.length)throw new Kt({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"});const t={method:"serverless.file.resource.info",params:JSON.stringify({id:e.map((e=>e.split("?")[0])).join(",")})};return{fileList:(await this.request(this.setupRequest(t))).result}}}(e),a={signInAnonymously:function(){return t.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return a},t.customAuth=t.auth,t}};const ua="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:";var da,ma;(ma=da||(da={})).local="local",ma.none="none",ma.session="session";var pa=function(){},ha=et((function(e,t){var a;e.exports=(a=at,function(e){var t=a,o=t.lib,n=o.WordArray,l=o.Hasher,s=t.algo,i=[],r=[];!function(){function t(t){for(var a=e.sqrt(t),o=2;o<=a;o++)if(!(t%o))return!1;return!0}function a(e){return 4294967296*(e-(0|e))|0}for(var o=2,n=0;n<64;)t(o)&&(n<8&&(i[n]=a(e.pow(o,.5))),r[n]=a(e.pow(o,1/3)),n++),o++}();var c=[],u=s.SHA256=l.extend({_doReset:function(){this._hash=new n.init(i.slice(0))},_doProcessBlock:function(e,t){for(var a=this._hash.words,o=a[0],n=a[1],l=a[2],s=a[3],i=a[4],u=a[5],d=a[6],m=a[7],p=0;p<64;p++){if(p<16)c[p]=0|e[t+p];else{var h=c[p-15],g=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,v=c[p-2],f=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;c[p]=g+c[p-7]+f+c[p-16]}var y=o&n^o&l^n&l,w=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),_=m+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&u^~i&d)+r[p]+c[p];m=d,d=u,u=i,i=s+_|0,s=l,l=n,n=o,o=_+(w+y)|0}a[0]=a[0]+o|0,a[1]=a[1]+n|0,a[2]=a[2]+l|0,a[3]=a[3]+s|0,a[4]=a[4]+i|0,a[5]=a[5]+u|0,a[6]=a[6]+d|0,a[7]=a[7]+m|0},_doFinalize:function(){var t=this._data,a=t.words,o=8*this._nDataBytes,n=8*t.sigBytes;return a[n>>>5]|=128<<24-n%32,a[14+(n+64>>>9<<4)]=e.floor(o/4294967296),a[15+(n+64>>>9<<4)]=o,t.sigBytes=4*a.length,this._process(),this._hash},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=l._createHelper(u),t.HmacSHA256=l._createHmacHelper(u)}(Math),a.SHA256)})),ga=ha,va=et((function(e,t){e.exports=at.HmacSHA256}));const fa=()=>{let e;if(!Promise){e=()=>{},e.promise={};const t=()=>{throw new Kt({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}const t=new Promise(((t,a)=>{e=(e,o)=>e?a(e):t(o)}));return e.promise=t,e};function ya(e){return void 0===e}function wa(e){return"[object Null]"===Object.prototype.toString.call(e)}function _a(e=""){return e.replace(/([\s\S]+)\s+(请前往云开发AI小助手查看问题：.*)/,"$1")}function ka(e=32){let t="";for(let a=0;a<e;a++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}var Ea;!function(e){e.WEB="web",e.WX_MP="wx_mp"}(Ea||(Ea={}));const Na={adapter:null,runtime:void 0},Va=["anonymousUuidKey"];class ba extends pa{constructor(){super(),Na.adapter.root.tcbObject||(Na.adapter.root.tcbObject={})}setItem(e,t){Na.adapter.root.tcbObject[e]=t}getItem(e){return Na.adapter.root.tcbObject[e]}removeItem(e){delete Na.adapter.root.tcbObject[e]}clear(){delete Na.adapter.root.tcbObject}}function xa(e,t){switch(e){case"local":return t.localStorage||new ba;case"none":return new ba;default:return t.sessionStorage||new ba}}class Sa{constructor(e){if(!this._storage){this._persistence=Na.adapter.primaryStorage||e.persistence,this._storage=xa(this._persistence,Na.adapter);const t=`access_token_${e.env}`,a=`access_token_expire_${e.env}`,o=`refresh_token_${e.env}`,n=`anonymous_uuid_${e.env}`,l=`login_type_${e.env}`,s="device_id",i=`token_type_${e.env}`,r=`user_info_${e.env}`;this.keys={accessTokenKey:t,accessTokenExpireKey:a,refreshTokenKey:o,anonymousUuidKey:n,loginTypeKey:l,userInfoKey:r,deviceIdKey:s,tokenTypeKey:i}}}updatePersistence(e){if(e===this._persistence)return;const t="local"===this._persistence;this._persistence=e;const a=xa(e,Na.adapter);for(const o in this.keys){const e=this.keys[o];if(t&&Va.includes(o))continue;const n=this._storage.getItem(e);ya(n)||wa(n)||(a.setItem(e,n),this._storage.removeItem(e))}this._storage=a}setStore(e,t,a){if(!this._storage)return;const o={version:a||"localCachev1",content:t},n=JSON.stringify(o);try{this._storage.setItem(e,n)}catch(l){throw l}}getStore(e,t){try{if(!this._storage)return}catch(o){return""}t=t||"localCachev1";const a=this._storage.getItem(e);return a&&a.indexOf(t)>=0?JSON.parse(a).content:""}removeStore(e){this._storage.removeItem(e)}}const Ca={},Ba={};function Ta(e){return Ca[e]}class Da{constructor(e,t){this.data=t||null,this.name=e}}class Ia extends Da{constructor(e,t){super("error",{error:e,data:t}),this.error=e}}const za=new class{constructor(){this._listeners={}}on(e,t){return a=e,o=t,(n=this._listeners)[a]=n[a]||[],n[a].push(o),this;var a,o,n}off(e,t){return function(e,t,a){if(a&&a[e]){const o=a[e].indexOf(t);-1!==o&&a[e].splice(o,1)}}(e,t,this._listeners),this}fire(e,t){if(e instanceof Ia)return console.error(e.error),this;const a="string"==typeof e?new Da(e,t||{}):e,o=a.name;if(this._listens(o)){a.target=this;const e=this._listeners[o]?[...this._listeners[o]]:[];for(const t of e)t.call(this,a)}return this}_listens(e){return this._listeners[e]&&this._listeners[e].length>0}};function Aa(e,t){za.on(e,t)}function Pa(e,t={}){za.fire(e,t)}function La(e,t){za.off(e,t)}const $a="loginStateChanged",Fa="loginStateExpire",Ma="loginTypeChanged",Ra="anonymousConverted",Oa="refreshAccessToken";var qa;!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.WECHAT_PUBLIC="WECHAT-PUBLIC",e.WECHAT_OPEN="WECHAT-OPEN",e.CUSTOM="CUSTOM",e.EMAIL="EMAIL",e.USERNAME="USERNAME",e.NULL="NULL"}(qa||(qa={}));class Ua{constructor(){this._fnPromiseMap=new Map}async run(e,t){let a=this._fnPromiseMap.get(e);return a||(a=new Promise((async(a,o)=>{try{await this._runIdlePromise();const o=t();a(await o)}catch(n){o(n)}finally{this._fnPromiseMap.delete(e)}})),this._fnPromiseMap.set(e,a)),a}_runIdlePromise(){return Promise.resolve()}}class ja{constructor(e){this._singlePromise=new Ua,this._cache=Ta(e.env),this._baseURL=`https://${e.env}.ap-shanghai.tcb-api.tencentcloudapi.com`,this._reqClass=new Na.adapter.reqClass({timeout:e.timeout,timeoutMsg:`请求在${e.timeout/1e3}s内未完成，已中断`,restrictedMethods:["post"]})}_getDeviceId(){if(this._deviceID)return this._deviceID;const{deviceIdKey:e}=this._cache.keys;let t=this._cache.getStore(e);return"string"==typeof t&&t.length>=16&&t.length<=48||(t=ka(),this._cache.setStore(e,t)),this._deviceID=t,t}async _request(e,t,a={}){const o={"x-request-id":ka(),"x-device-id":this._getDeviceId()};if(a.withAccessToken){const{tokenTypeKey:e}=this._cache.keys,t=await this.getAccessToken(),a=this._cache.getStore(e);o.authorization=`${a} ${t}`}return this._reqClass["get"===a.method?"get":"post"]({url:`${this._baseURL}${e}`,data:t,headers:o})}async _fetchAccessToken(){const{loginTypeKey:e,accessTokenKey:t,accessTokenExpireKey:a,tokenTypeKey:o}=this._cache.keys,n=this._cache.getStore(e);if(n&&n!==qa.ANONYMOUS)throw new Kt({code:"INVALID_OPERATION",message:"非匿名登录不支持刷新 access token"});const l=await this._singlePromise.run("fetchAccessToken",(async()=>(await this._request("/auth/v1/signin/anonymously",{},{method:"post"})).data)),{access_token:s,expires_in:i,token_type:r}=l;return this._cache.setStore(o,r),this._cache.setStore(t,s),this._cache.setStore(a,Date.now()+1e3*i),s}isAccessTokenExpired(e,t){let a=!0;return e&&t&&(a=t<Date.now()),a}async getAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t}=this._cache.keys,a=this._cache.getStore(e),o=this._cache.getStore(t);return this.isAccessTokenExpired(a,o)?this._fetchAccessToken():a}async refreshAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,loginTypeKey:a}=this._cache.keys;return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.setStore(a,qa.ANONYMOUS),this.getAccessToken()}async getUserInfo(){return this._singlePromise.run("getUserInfo",(async()=>(await this._request("/auth/v1/user/me",{},{withAccessToken:!0,method:"get"})).data))}}const Ha=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],Ga={"X-SDK-Version":"1.3.5"};function Wa(e,t,a){const o=e[t];e[t]=function(t){const n={},l={};a.forEach((a=>{const{data:o,headers:s}=a.call(e,t);Object.assign(n,o),Object.assign(l,s)}));const s=t.data;return s&&(()=>{var e;if(e=s,"[object FormData]"!==Object.prototype.toString.call(e))t.data={...s,...n};else for(const t in n)s.append(t,n[t])})(),t.headers={...t.headers||{},...l},o.call(e,t)}}function Ja(){const e=Math.random().toString(16).slice(2);return{data:{seqId:e},headers:{...Ga,"x-seqid":e}}}class Ka{constructor(e={}){var t;this.config=e,this._reqClass=new Na.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:`请求在${this.config.timeout/1e3}s内未完成，已中断`,restrictedMethods:["post"]}),this._cache=Ta(this.config.env),this._localCache=(t=this.config.env,Ba[t]),this.oauth=new ja(this.config),Wa(this._reqClass,"post",[Ja]),Wa(this._reqClass,"upload",[Ja]),Wa(this._reqClass,"download",[Ja])}async post(e){return await this._reqClass.post(e)}async upload(e){return await this._reqClass.upload(e)}async download(e){return await this._reqClass.download(e)}async refreshAccessToken(){let e,t;this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken());try{e=await this._refreshAccessTokenPromise}catch(a){t=a}if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return e}async _refreshAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:a,loginTypeKey:o,anonymousUuidKey:n}=this._cache.keys;this._cache.removeStore(e),this._cache.removeStore(t);let l=this._cache.getStore(a);if(!l)throw new Kt({message:"未登录CloudBase"});const s={refresh_token:l},i=await this.request("auth.fetchAccessTokenWithRefreshToken",s);if(i.data.code){const{code:e}=i.data;if("SIGN_PARAM_INVALID"===e||"REFRESH_TOKEN_EXPIRED"===e||"INVALID_REFRESH_TOKEN"===e){if(this._cache.getStore(o)===qa.ANONYMOUS&&"INVALID_REFRESH_TOKEN"===e){const e=this._cache.getStore(n),t=this._cache.getStore(a),o=await this.send("auth.signInAnonymously",{anonymous_uuid:e,refresh_token:t});return this.setRefreshToken(o.refresh_token),this._refreshAccessToken()}Pa(Fa),this._cache.removeStore(a)}throw new Kt({code:i.data.code,message:`刷新access token失败：${i.data.code}`})}if(i.data.access_token)return Pa(Oa),this._cache.setStore(e,i.data.access_token),this._cache.setStore(t,i.data.access_token_expire+Date.now()),{accessToken:i.data.access_token,accessTokenExpire:i.data.access_token_expire};i.data.refresh_token&&(this._cache.removeStore(a),this._cache.setStore(a,i.data.refresh_token),this._refreshAccessToken())}async getAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:a}=this._cache.keys;if(!this._cache.getStore(a))throw new Kt({message:"refresh token不存在，登录状态异常"});let o=this._cache.getStore(e),n=this._cache.getStore(t),l=!0;return this._shouldRefreshAccessTokenHook&&!(await this._shouldRefreshAccessTokenHook(o,n))&&(l=!1),(!o||!n||n<Date.now())&&l?this.refreshAccessToken():{accessToken:o,accessTokenExpire:n}}async request(e,t,a){const o=`x-tcb-trace_${this.config.env}`;let n="application/x-www-form-urlencoded";const l={action:e,env:this.config.env,dataVersion:"2019-08-16",...t};let s;if(-1===Ha.indexOf(e)&&(this._cache.keys,l.access_token=await this.oauth.getAccessToken()),"storage.uploadFile"===e){s=new FormData;for(let e in s)s.hasOwnProperty(e)&&void 0!==s[e]&&s.append(e,l[e]);n="multipart/form-data"}else{n="application/json",s={};for(let e in l)void 0!==l[e]&&(s[e]=l[e])}let i={headers:{"content-type":n}};a&&a.timeout&&(i.timeout=a.timeout),a&&a.onUploadProgress&&(i.onUploadProgress=a.onUploadProgress);const r=this._localCache.getStore(o);r&&(i.headers["X-TCB-Trace"]=r);const{parse:c,inQuery:u,search:d}=t;let m={env:this.config.env};c&&(m.parse=!0),u&&(m={...u,...m});let p=function(e,t,a={}){const o=/\?/.test(t);let n="";for(let l in a)""===n?!o&&(t+="?"):n+="&",n+=`${l}=${encodeURIComponent(a[l])}`;return/^http(s)?\:\/\//.test(t+=n)?t:`${e}${t}`}(ua,"//tcb-api.tencentcloudapi.com/web",m);d&&(p+=d);const h=await this.post({url:p,data:s,...i}),g=h.header&&h.header["x-tcb-trace"];if(g&&this._localCache.setStore(o,g),200!==Number(h.status)&&200!==Number(h.statusCode)||!h.data)throw new Kt({code:"NETWORK_ERROR",message:"network request error"});return h}async send(e,t={},a={}){const o=await this.request(e,t,{...a,onUploadProgress:t.onUploadProgress});if(("ACCESS_TOKEN_DISABLED"===o.data.code||"ACCESS_TOKEN_EXPIRED"===o.data.code)&&-1===Ha.indexOf(e)){await this.oauth.refreshAccessToken();const o=await this.request(e,t,{...a,onUploadProgress:t.onUploadProgress});if(o.data.code)throw new Kt({code:o.data.code,message:_a(o.data.message)});return o.data}if(o.data.code)throw new Kt({code:o.data.code,message:_a(o.data.message)});return o.data}setRefreshToken(e){const{accessTokenKey:t,accessTokenExpireKey:a,refreshTokenKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(a),this._cache.setStore(o,e)}}const Ya={};function Qa(e){return Ya[e]}class Xa{constructor(e){this.config=e,this._cache=Ta(e.env),this._request=Qa(e.env)}setRefreshToken(e){const{accessTokenKey:t,accessTokenExpireKey:a,refreshTokenKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(a),this._cache.setStore(o,e)}setAccessToken(e,t){const{accessTokenKey:a,accessTokenExpireKey:o}=this._cache.keys;this._cache.setStore(a,e),this._cache.setStore(o,t)}async refreshUserInfo(){const{data:e}=await this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e}setLocalUserInfo(e){const{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e)}}class Za{constructor(e){if(!e)throw new Kt({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=e,this._cache=Ta(this._envId),this._request=Qa(this._envId),this.setUserInfo()}linkWithTicket(e){if("string"!=typeof e)throw new Kt({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}linkWithRedirect(e){e.signInWithRedirect()}updatePassword(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}updateEmail(e){return this._request.send("auth.updateEmail",{newEmail:e})}updateUsername(e){if("string"!=typeof e)throw new Kt({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}async getLinkedUidList(){const{data:e}=await this._request.send("auth.getLinkedUidList",{});let t=!1;const{users:a}=e;return a.forEach((e=>{e.wxOpenId&&e.wxPublicId&&(t=!0)})),{users:a,hasPrimaryUid:t}}setPrimaryUid(e){return this._request.send("auth.setPrimaryUid",{uid:e})}unlink(e){return this._request.send("auth.unlink",{platform:e})}async update(e){const{nickName:t,gender:a,avatarUrl:o,province:n,country:l,city:s}=e,{data:i}=await this._request.send("auth.updateUserInfo",{nickName:t,gender:a,avatarUrl:o,province:n,country:l,city:s});this.setLocalUserInfo(i)}async refresh(){const e=await this._request.oauth.getUserInfo();return this.setLocalUserInfo(e),e}setUserInfo(){const{userInfoKey:e}=this._cache.keys,t=this._cache.getStore(e);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach((e=>{this[e]=t[e]})),this.location={country:t.country,province:t.province,city:t.city}}setLocalUserInfo(e){const{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e),this.setUserInfo()}}class eo{constructor(e){if(!e)throw new Kt({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=Ta(e);const{refreshTokenKey:t,accessTokenKey:a,accessTokenExpireKey:o}=this._cache.keys,n=this._cache.getStore(t),l=this._cache.getStore(a),s=this._cache.getStore(o);this.credential={refreshToken:n,accessToken:l,accessTokenExpire:s},this.user=new Za(e)}get isAnonymousAuth(){return this.loginType===qa.ANONYMOUS}get isCustomAuth(){return this.loginType===qa.CUSTOM}get isWeixinAuth(){return this.loginType===qa.WECHAT||this.loginType===qa.WECHAT_OPEN||this.loginType===qa.WECHAT_PUBLIC}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}}class to extends Xa{async signIn(){this._cache.updatePersistence("local"),await this._request.oauth.getAccessToken(),Pa($a),Pa(Ma,{env:this.config.env,loginType:qa.ANONYMOUS,persistence:"local"});const e=new eo(this.config.env);return await e.user.refresh(),e}async linkAndRetrieveDataWithTicket(e){const{anonymousUuidKey:t,refreshTokenKey:a}=this._cache.keys,o=this._cache.getStore(t),n=this._cache.getStore(a),l=await this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:o,refresh_token:n,ticket:e});if(l.refresh_token)return this._clearAnonymousUUID(),this.setRefreshToken(l.refresh_token),await this._request.refreshAccessToken(),Pa(Ra,{env:this.config.env}),Pa(Ma,{loginType:qa.CUSTOM,persistence:"local"}),{credential:{refreshToken:l.refresh_token}};throw new Kt({message:"匿名转化失败"})}_setAnonymousUUID(e){const{anonymousUuidKey:t,loginTypeKey:a}=this._cache.keys;this._cache.removeStore(t),this._cache.setStore(t,e),this._cache.setStore(a,qa.ANONYMOUS)}_clearAnonymousUUID(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}}class ao extends Xa{async signIn(e){if("string"!=typeof e)throw new Kt({code:"PARAM_ERROR",message:"ticket must be a string"});const{refreshTokenKey:t}=this._cache.keys,a=await this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""});if(a.refresh_token)return this.setRefreshToken(a.refresh_token),await this._request.refreshAccessToken(),Pa($a),Pa(Ma,{env:this.config.env,loginType:qa.CUSTOM,persistence:this.config.persistence}),await this.refreshUserInfo(),new eo(this.config.env);throw new Kt({message:"自定义登录失败"})}}class oo extends Xa{async signIn(e,t){if("string"!=typeof e)throw new Kt({code:"PARAM_ERROR",message:"email must be a string"});const{refreshTokenKey:a}=this._cache.keys,o=await this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(a)||""}),{refresh_token:n,access_token:l,access_token_expire:s}=o;if(n)return this.setRefreshToken(n),l&&s?this.setAccessToken(l,s):await this._request.refreshAccessToken(),await this.refreshUserInfo(),Pa($a),Pa(Ma,{env:this.config.env,loginType:qa.EMAIL,persistence:this.config.persistence}),new eo(this.config.env);throw o.code?new Kt({code:o.code,message:`邮箱登录失败: ${o.message}`}):new Kt({message:"邮箱登录失败"})}async activate(e){return this._request.send("auth.activateEndUserMail",{token:e})}async resetPasswordWithToken(e,t){return this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})}}class no extends Xa{async signIn(e,t){if("string"!=typeof e)throw new Kt({code:"PARAM_ERROR",message:"username must be a string"});"string"!=typeof t&&(t="",console.warn("password is empty"));const{refreshTokenKey:a}=this._cache.keys,o=await this._request.send("auth.signIn",{loginType:qa.USERNAME,username:e,password:t,refresh_token:this._cache.getStore(a)||""}),{refresh_token:n,access_token_expire:l,access_token:s}=o;if(n)return this.setRefreshToken(n),s&&l?this.setAccessToken(s,l):await this._request.refreshAccessToken(),await this.refreshUserInfo(),Pa($a),Pa(Ma,{env:this.config.env,loginType:qa.USERNAME,persistence:this.config.persistence}),new eo(this.config.env);throw o.code?new Kt({code:o.code,message:`用户名密码登录失败: ${o.message}`}):new Kt({message:"用户名密码登录失败"})}}class lo{constructor(e){this.config=e,this._cache=Ta(e.env),this._request=Qa(e.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),Aa(Ma,this._onLoginTypeChanged)}get currentUser(){const e=this.hasLoginState();return e&&e.user||null}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}anonymousAuthProvider(){return new to(this.config)}customAuthProvider(){return new ao(this.config)}emailAuthProvider(){return new oo(this.config)}usernameAuthProvider(){return new no(this.config)}async signInAnonymously(){return new to(this.config).signIn()}async signInWithEmailAndPassword(e,t){return new oo(this.config).signIn(e,t)}signInWithUsernameAndPassword(e,t){return new no(this.config).signIn(e,t)}async linkAndRetrieveDataWithTicket(e){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new to(this.config)),Aa(Ra,this._onAnonymousConverted),await this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)}async signOut(){if(this.loginType===qa.ANONYMOUS)throw new Kt({message:"匿名用户不支持登出操作"});const{refreshTokenKey:e,accessTokenKey:t,accessTokenExpireKey:a}=this._cache.keys,o=this._cache.getStore(e);if(!o)return;const n=await this._request.send("auth.logout",{refresh_token:o});return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.removeStore(a),Pa($a),Pa(Ma,{env:this.config.env,loginType:qa.NULL,persistence:this.config.persistence}),n}async signUpWithEmailAndPassword(e,t){return this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})}async sendPasswordResetEmail(e){return this._request.send("auth.sendPasswordResetEmail",{email:e})}onLoginStateChanged(e){Aa($a,(()=>{const t=this.hasLoginState();e.call(this,t)}));const t=this.hasLoginState();e.call(this,t)}onLoginStateExpired(e){Aa(Fa,e.bind(this))}onAccessTokenRefreshed(e){Aa(Oa,e.bind(this))}onAnonymousConverted(e){Aa(Ra,e.bind(this))}onLoginTypeChanged(e){Aa(Ma,(()=>{const t=this.hasLoginState();e.call(this,t)}))}async getAccessToken(){return{accessToken:(await this._request.getAccessToken()).accessToken,env:this.config.env}}hasLoginState(){const{accessTokenKey:e,accessTokenExpireKey:t}=this._cache.keys,a=this._cache.getStore(e),o=this._cache.getStore(t);return this._request.oauth.isAccessTokenExpired(a,o)?null:new eo(this.config.env)}async isUsernameRegistered(e){if("string"!=typeof e)throw new Kt({code:"PARAM_ERROR",message:"username must be a string"});const{data:t}=await this._request.send("auth.isUsernameRegistered",{username:e});return t&&t.isRegistered}getLoginState(){return Promise.resolve(this.hasLoginState())}async signInWithTicket(e){return new ao(this.config).signIn(e)}shouldRefreshAccessToken(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}getUserInfo(){return this._request.send("auth.getUserInfo",{}).then((e=>e.code?e:{...e.data,requestId:e.seqId}))}getAuthHeader(){const{refreshTokenKey:e,accessTokenKey:t}=this._cache.keys,a=this._cache.getStore(e);return{"x-cloudbase-credentials":this._cache.getStore(t)+"/@@/"+a}}_onAnonymousConverted(e){const{env:t}=e.data;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}_onLoginTypeChanged(e){const{loginType:t,persistence:a,env:o}=e.data;o===this.config.env&&(this._cache.updatePersistence(a),this._cache.setStore(this._cache.keys.loginTypeKey,t))}}const so=function(e,t){t=t||fa();const a=Qa(this.config.env),{cloudPath:o,filePath:n,onUploadProgress:l,fileType:s="image"}=e;return a.send("storage.getUploadMetadata",{path:o}).then((e=>{const{data:{url:i,authorization:r,token:c,fileId:u,cosFileId:d},requestId:m}=e,p={key:o,signature:r,"x-cos-meta-fileid":d,success_action_status:"201","x-cos-security-token":c};a.upload({url:i,data:p,file:n,name:o,fileType:s,onUploadProgress:l}).then((e=>{201===e.statusCode?t(null,{fileID:u,requestId:m}):t(new Kt({code:"STORAGE_REQUEST_FAIL",message:`STORAGE_REQUEST_FAIL: ${e.data}`}))})).catch((e=>{t(e)}))})).catch((e=>{t(e)})),t.promise},io=function(e,t){t=t||fa();const a=Qa(this.config.env),{cloudPath:o}=e;return a.send("storage.getUploadMetadata",{path:o}).then((e=>{t(null,e)})).catch((e=>{t(e)})),t.promise},ro=function({fileList:e},t){if(t=t||fa(),!e||!Array.isArray(e))return{code:"INVALID_PARAM",message:"fileList必须是非空的数组"};for(let o of e)if(!o||"string"!=typeof o)return{code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"};const a={fileid_list:e};return Qa(this.config.env).send("storage.batchDeleteFile",a).then((e=>{e.code?t(null,e):t(null,{fileList:e.data.delete_list,requestId:e.requestId})})).catch((e=>{t(e)})),t.promise},co=function({fileList:e},t){t=t||fa(),e&&Array.isArray(e)||t(null,{code:"INVALID_PARAM",message:"fileList必须是非空的数组"});let a=[];for(let n of e)"object"==typeof n?(n.hasOwnProperty("fileID")&&n.hasOwnProperty("maxAge")||t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是包含fileID和maxAge的对象"}),a.push({fileid:n.fileID,max_age:n.maxAge})):"string"==typeof n?a.push({fileid:n}):t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是字符串"});const o={file_list:a};return Qa(this.config.env).send("storage.batchGetDownloadUrl",o).then((e=>{e.code?t(null,e):t(null,{fileList:e.data.download_list,requestId:e.requestId})})).catch((e=>{t(e)})),t.promise},uo=async function({fileID:e},t){const a=(await co.call(this,{fileList:[{fileID:e,maxAge:600}]})).fileList[0];if("SUCCESS"!==a.code)return t?t(a):new Promise((e=>{e(a)}));const o=Qa(this.config.env);let n=a.download_url;if(n=encodeURI(n),!t)return o.download({url:n});t(await o.download({url:n}))},mo=function({name:e,data:t,query:a,parse:o,search:n,timeout:l},s){const i=s||fa();let r;try{r=t?JSON.stringify(t):""}catch(u){return Promise.reject(u)}if(!e)return Promise.reject(new Kt({code:"PARAM_ERROR",message:"函数名不能为空"}));const c={inQuery:a,parse:o,search:n,function_name:e,request_data:r};return Qa(this.config.env).send("functions.invokeFunction",c,{timeout:l}).then((e=>{if(e.code)i(null,e);else{let a=e.data.response_data;if(o)i(null,{result:a,requestId:e.requestId});else try{a=JSON.parse(e.data.response_data),i(null,{result:a,requestId:e.requestId})}catch(t){i(new Kt({message:"response data must be json"}))}}return i.promise})).catch((e=>{i(e)})),i.promise},po={timeout:15e3,persistence:"session"},ho=6e5,go={};class vo{constructor(e){this.config=e||this.config,this.authObj=void 0}init(e){switch(Na.adapter||(this.requestClient=new Na.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:`请求在${(e.timeout||5e3)/1e3}s内未完成，已中断`})),this.config={...po,...e},!0){case this.config.timeout>ho:console.warn("timeout大于可配置上限[10分钟]，已重置为上限数值"),this.config.timeout=ho;break;case this.config.timeout<100:console.warn("timeout小于可配置下限[100ms]，已重置为下限数值"),this.config.timeout=100}return new vo(this.config)}auth({persistence:e}={}){if(this.authObj)return this.authObj;const t=e||Na.adapter.primaryStorage||po.persistence;var a;return t!==this.config.persistence&&(this.config.persistence=t),function(e){const{env:t}=e;Ca[t]=new Sa(e),Ba[t]=new Sa({...e,persistence:"local"})}(this.config),a=this.config,Ya[a.env]=new Ka(a),this.authObj=new lo(this.config),this.authObj}on(e,t){return Aa.apply(this,[e,t])}off(e,t){return La.apply(this,[e,t])}callFunction(e,t){return mo.apply(this,[e,t])}deleteFile(e,t){return ro.apply(this,[e,t])}getTempFileURL(e,t){return co.apply(this,[e,t])}downloadFile(e,t){return uo.apply(this,[e,t])}uploadFile(e,t){return so.apply(this,[e,t])}getUploadMetadata(e,t){return io.apply(this,[e,t])}registerExtension(e){go[e.name]=e}async invokeExtension(e,t){const a=go[e];if(!a)throw new Kt({message:`扩展${e} 必须先注册`});return await a.invoke(t,this)}useAdapters(e){const{adapter:t,runtime:a}=function(e){const t=(a=e,"[object Array]"===Object.prototype.toString.call(a)?e:[e]);var a;for(const o of t){const{isMatch:e,genAdapter:t,runtime:a}=o;if(e())return{adapter:t(),runtime:a}}}(e)||{};t&&(Na.adapter=t),a&&(Na.runtime=a)}}var fo=new vo;function yo(e,t,a){void 0===a&&(a={});var o=/\?/.test(t),n="";for(var l in a)""===n?!o&&(t+="?"):n+="&",n+=l+"="+encodeURIComponent(a[l]);return/^http(s)?:\/\//.test(t+=n)?t:""+e+t}class wo{get(e){const{url:t,data:a,headers:o,timeout:n}=e;return new Promise(((e,l)=>{Yt.request({url:yo("https:",t),data:a,method:"GET",header:o,timeout:n,success(t){e(t)},fail(e){l(e)}})}))}post(e){const{url:t,data:a,headers:o,timeout:n}=e;return new Promise(((e,l)=>{Yt.request({url:yo("https:",t),data:a,method:"POST",header:o,timeout:n,success(t){e(t)},fail(e){l(e)}})}))}upload(e){return new Promise(((t,a)=>{const{url:o,file:n,data:l,headers:s,fileType:i}=e,r=Yt.uploadFile({url:yo("https:",o),name:"file",formData:Object.assign({},l),filePath:n,fileType:i,header:s,success(e){const a={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&l.success_action_status&&(a.statusCode=parseInt(l.success_action_status,10)),t(a)},fail(e){a(new Error(e.errMsg||"uploadFile:fail"))}});"function"==typeof e.onUploadProgress&&r&&"function"==typeof r.onProgressUpdate&&r.onProgressUpdate((t=>{e.onUploadProgress({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend})}))}))}}const _o={setItem(e,t){Yt.setStorageSync(e,t)},getItem:e=>Yt.getStorageSync(e),removeItem(e){Yt.removeStorageSync(e)},clear(){Yt.clearStorageSync()}};var ko={genAdapter:function(){return{root:{},reqClass:wo,localStorage:_o,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};fo.useAdapters(ko);const Eo=fo,No=Eo.init;Eo.init=function(e){e.env=e.spaceId;const t=No.call(this,e);t.config.provider="tencent",t.config.spaceId=e.spaceId;const a=t.auth;return t.auth=function(e){const t=a.call(this,e);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach((e=>{var a;t[e]=(a=t[e],function(e){e=e||{};const{success:t,fail:o,complete:n}=Jt(e);if(!(t||o||n))return a.call(this,e);a.call(this,e).then((e=>{t&&t(e),n&&n(e)}),(e=>{o&&o(e),n&&n(e)}))}).bind(t)})),t},t.customAuth=t.auth,t};var Vo=Eo;async function bo(e,t){const a=`http://${e}:${t}/system/ping`;try{const e=await(o={url:a,timeout:500},new Promise(((e,t)=>{Yt.request({...o,success(t){e(t)},fail(e){t(e)}})})));return!(!e.data||0!==e.data.code)}catch(n){return!1}var o}const xo={"serverless.file.resource.generateProximalSign":"storage/generate-proximal-sign","serverless.file.resource.report":"storage/report","serverless.file.resource.delete":"storage/delete","serverless.file.resource.getTempFileURL":"storage/get-temp-file-url"};var So={init(e){const t=new class{constructor(e){if(["spaceId","clientSecret"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),!e.endpoint)throw new Error("集群空间未配置ApiEndpoint，配置后需要重新关联服务空间后生效");this.config=Object.assign({},e),this.config.provider="dcloud",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.adapter=Yt}async request(e,t=!0){return e=this.setupRequest(e),Promise.resolve().then((()=>ia(e,this.adapter.request)))}requestLocal(e){return new Promise(((t,a)=>{this.adapter.request(Object.assign(e,{complete(e){if(e||(e={}),!e.statusCode||e.statusCode>=400){const t=e.data&&e.data.code||"SYS_ERR",o=e.data&&e.data.message||"request:fail";return a(new Kt({code:t,message:o}))}t({success:!0,result:e.data})}}))}))}setupRequest(e){const t=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),a={"Content-Type":"application/json"};a["x-serverless-sign"]=sa(t,this.config.clientSecret);const o=la();a["x-client-info"]=encodeURIComponent(JSON.stringify(o));const{token:n}=Xt();return a["x-client-token"]=n,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(a))}}async setupLocalRequest(e){const t=la(),{token:a}=Xt(),o=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now(),clientInfo:t,token:a}),{address:n,servePort:l}=this.__dev__&&this.__dev__.debugInfo||{},{address:s}=await async function(e,t){let a;for(let o=0;o<e.length;o++){const n=e[o];if(await bo(n,t)){a=n;break}}return{address:a,port:t}}(n,l);return{url:`http://${s}:${l}/${xo[e.method]}`,method:"POST",data:o,dataType:"json",header:JSON.parse(JSON.stringify({"Content-Type":"application/json"}))}}callFunction(e){const t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request(t,!1)}getUploadFileOptions(e){const t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(t)}reportUploadFile(e){const t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(t)}uploadFile({filePath:e,cloudPath:t,fileType:a="image",onUploadProgress:o}){if(!t)throw new Kt({code:"CLOUDPATH_REQUIRED",message:"cloudPath不可为空"});let n;return this.getUploadFileOptions({cloudPath:t}).then((t=>{const{url:l,formData:s,name:i}=t.result;return n=t.result.fileUrl,new Promise(((t,n)=>{const r=this.adapter.uploadFile({url:l,formData:s,name:i,filePath:e,fileType:a,success(e){e&&e.statusCode<400?t(e):n(new Kt({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail(e){n(new Kt({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof o&&r&&"function"==typeof r.onProgressUpdate&&r.onProgressUpdate((e=>{o({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))})).then((()=>this.reportUploadFile({cloudPath:t}))).then((t=>new Promise(((a,o)=>{t.success?a({success:!0,filePath:e,fileID:n}):o(new Kt({code:"UPLOAD_FAILED",message:"文件上传失败"}))}))))}deleteFile({fileList:e}){const t={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:e})};return this.request(t).then((e=>{if(e.success)return e.result;throw new Kt({code:"DELETE_FILE_FAILED",message:"删除文件失败"})}))}getTempFileURL({fileList:e,maxAge:t}={}){if(!Array.isArray(e)||0===e.length)throw new Kt({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"});const a={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:e,maxAge:t})};return this.request(a).then((e=>{if(e.success)return{fileList:e.result.fileList.map((e=>({fileID:e.fileID,tempFileURL:e.tempFileURL})))};throw new Kt({code:"GET_TEMP_FILE_URL_FAILED",message:"获取临时文件链接失败"})}))}}(e),a={signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return a},t.customAuth=t.auth,t}},Co=et((function(e,t){e.exports=at.enc.Hex}));function Bo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function To(e="",t={}){const{data:a,functionName:o,method:n,headers:l,signHeaderKeys:s=[],config:i}=t,r=String(Date.now()),c=Bo(),u=Object.assign({},l,{"x-from-app-id":i.spaceAppId,"x-from-env-id":i.spaceId,"x-to-env-id":i.spaceId,"x-from-instance-id":r,"x-from-function-name":o,"x-client-timestamp":r,"x-alipay-source":"client","x-request-id":c,"x-alipay-callid":c,"x-trace-id":c}),d=["x-from-app-id","x-from-env-id","x-to-env-id","x-from-instance-id","x-from-function-name","x-client-timestamp"].concat(s),[m="",p=""]=e.split("?")||[],h=function(e){const t="HMAC-SHA256",a=e.signedHeaders.join(";"),o=e.signedHeaders.map((t=>`${t.toLowerCase()}:${e.headers[t]}\n`)).join(""),n=ga(e.body).toString(Co),l=`${e.method.toUpperCase()}\n${e.path}\n${e.query}\n${o}\n${a}\n${n}\n`,s=ga(l).toString(Co),i=`${t}\n${e.timestamp}\n${s}\n`,r=va(i,e.secretKey).toString(Co);return`${t} Credential=${e.secretId}, SignedHeaders=${a}, Signature=${r}`}({path:m,query:p,method:n,headers:u,timestamp:r,body:JSON.stringify(a),secretId:i.accessKey,secretKey:i.secretKey,signedHeaders:d.sort()});return{url:`${i.endpoint}${e}`,headers:Object.assign({},u,{Authorization:h})}}function Do({url:e,data:t,method:a="POST",headers:o={},timeout:n}){return new Promise(((l,s)=>{Yt.request({url:e,method:a,data:"object"==typeof t?JSON.stringify(t):t,header:o,dataType:"json",timeout:n,complete:(e={})=>{const t=o["x-trace-id"]||"";if(!e.statusCode||e.statusCode>=400){const{message:a,errMsg:o,trace_id:n}=e.data||{};return s(new Kt({code:"SYS_ERR",message:a||o||"request:fail",requestId:n||t}))}l({status:e.statusCode,data:e.data,headers:e.header,requestId:t})}})}))}function Io(e,t){const{path:a,data:o,method:n="GET"}=e,{url:l,headers:s}=To(a,{functionName:"",data:o,method:n,headers:{"x-alipay-cloud-mode":"oss","x-data-api-type":"oss","x-expire-timestamp":Date.now()+6e4},signHeaderKeys:["x-data-api-type","x-expire-timestamp"],config:t});return Do({url:l,data:o,method:n,headers:s}).then((e=>{const t=e.data||{};if(!t.success)throw new Kt({code:e.errCode,message:e.errMsg,requestId:e.requestId});return t.data||{}})).catch((e=>{throw new Kt({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}function zo(e=""){const t=e.trim().replace(/^cloud:\/\//,""),a=t.indexOf("/");if(a<=0)throw new Kt({code:"INVALID_PARAM",message:"fileID不合法"});const o=t.substring(0,a),n=t.substring(a+1);return o!==this.config.spaceId&&console.warn("file ".concat(e," does not belong to env ").concat(this.config.spaceId)),n}function Ao(e=""){return"cloud://".concat(this.config.spaceId,"/").concat(e.replace(/^\/+/,""))}class Po{constructor(e){this.config=e}signedURL(e,t={}){const a=`/ws/function/${e}`,o=this.config.wsEndpoint.replace(/^ws(s)?:\/\//,""),n=Object.assign({},t,{accessKeyId:this.config.accessKey,signatureNonce:Bo(),timestamp:""+Date.now()}),l=[a,["accessKeyId","authorization","signatureNonce","timestamp"].sort().map((function(e){return n[e]?"".concat(e,"=").concat(n[e]):null})).filter(Boolean).join("&"),`host:${o}`].join("\n"),s=["HMAC-SHA256",ga(l).toString(Co)].join("\n"),i=va(s,this.config.secretKey).toString(Co),r=Object.keys(n).map((e=>`${e}=${encodeURIComponent(n[e])}`)).join("&");return`${this.config.wsEndpoint}${a}?${r}&signature=${i}`}}var Lo={init:e=>{e.provider="alipay";const t=new class{constructor(e){if(["spaceId","spaceAppId","accessKey","secretKey"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),e.endpoint){if("string"!=typeof e.endpoint)throw new Error("endpoint must be string");if(!/^https:\/\//.test(e.endpoint))throw new Error("endpoint must start with https://");e.endpoint=e.endpoint.replace(/\/$/,"")}this.config=Object.assign({},e,{endpoint:e.endpoint||`https://${e.spaceId}.api-hz.cloudbasefunction.cn`,wsEndpoint:e.wsEndpoint||`wss://${e.spaceId}.api-hz.cloudbasefunction.cn`}),this._websocket=new Po(this.config)}callFunction(e){return function(e,t){const{name:a,data:o,async:n=!1,timeout:l}=e,s="POST",i={"x-to-function-name":a};n&&(i["x-function-invoke-type"]="async");const{url:r,headers:c}=To("/functions/invokeFunction",{functionName:a,data:o,method:s,headers:i,signHeaderKeys:["x-to-function-name"],config:t});return Do({url:r,data:o,method:s,headers:c,timeout:l}).then((e=>{let t=0;if(n){const a=e.data||{};t="200"===a.errCode?0:a.errCode,e.data=a.data||{},e.errMsg=a.errMsg}if(0!==t)throw new Kt({code:t,message:e.errMsg,requestId:e.requestId});return{errCode:t,success:0===t,requestId:e.requestId,result:e.data}})).catch((e=>{throw new Kt({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}(e,this.config)}uploadFileToOSS({url:e,filePath:t,fileType:a,formData:o,onUploadProgress:n}){return new Promise(((l,s)=>{const i=Yt.uploadFile({url:e,filePath:t,fileType:a,formData:o,name:"file",success(e){e&&e.statusCode<400?l(e):s(new Kt({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail(e){s(new Kt({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof n&&i&&"function"==typeof i.onProgressUpdate&&i.onProgressUpdate((e=>{n({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}async uploadFile({filePath:e,cloudPath:t="",fileType:a="image",onUploadProgress:o}){if("string"!==pt(t))throw new Kt({code:"INVALID_PARAM",message:"cloudPath必须为字符串类型"});if(!(t=t.trim()))throw new Kt({code:"INVALID_PARAM",message:"cloudPath不可为空"});if(/:\/\//.test(t))throw new Kt({code:"INVALID_PARAM",message:"cloudPath不合法"});const n=await Io({path:"/".concat(t.replace(/^\//,""),"?post_url")},this.config),{file_id:l,upload_url:s,form_data:i}=n,r=i&&i.reduce(((e,t)=>(e[t.key]=t.value,e)),{});return this.uploadFileToOSS({url:s,filePath:e,fileType:a,formData:r,onUploadProgress:o}).then((()=>({fileID:l})))}async getTempFileURL({fileList:e}){return new Promise(((t,a)=>{(!e||e.length<0)&&t({code:"INVALID_PARAM",message:"fileList不能为空数组"}),e.length>50&&t({code:"INVALID_PARAM",message:"fileList数组长度不能超过50"});const o=[];for(const l of e){let e;"string"!==pt(l)&&t({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"});try{e=zo.call(this,l)}catch(n){console.warn(n.errCode,n.errMsg),e=l}o.push({file_id:e,expire:600})}Io({path:"/?download_url",data:{file_list:o},method:"POST"},this.config).then((e=>{const{file_list:a=[]}=e;t({fileList:a.map((e=>({fileID:Ao.call(this,e.file_id),tempFileURL:e.download_url})))})})).catch((e=>a(e)))}))}async connectWebSocket(e){const{name:t,query:a}=e;return Yt.connectSocket({url:this._websocket.signedURL(t,a),complete:()=>{}})}}(e);return t.auth=function(){return{signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!0)}}},t}};function $o({data:e}){let t;t=la();const a=JSON.parse(JSON.stringify(e||{}));if(Object.assign(a,{clientInfo:t}),!a.uniIdToken){const{token:e}=Xt();e&&(a.uniIdToken=e)}return a}const Fo=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"，云函数[{functionName}]在云端不存在，请检查此云函数名称是否正确以及该云函数是否已上传到服务空间",mode:"append"}];var Mo=/[\\^$.*+?()[\]{}|]/g,Ro=RegExp(Mo.source);function Oo(e,t,a){return e.replace(new RegExp((o=t)&&Ro.test(o)?o.replace(Mo,"\\$&"):o,"g"),a);var o}const qo="request",Uo="response",jo="both",Ho="_globalUniCloudStatus",Go={code:2e4,message:"System error"},Wo={code:20101,message:"Invalid client"};function Jo(e){const{errSubject:t,subject:a,errCode:o,errMsg:n,code:l,message:s,cause:i}=e||{};return new Kt({subject:t||a||"uni-secure-network",code:o||l||Go.code,message:n||s,cause:i})}let Ko;function Yo({secretType:e}={}){return e===qo||e===Uo||e===jo}function Qo({name:e,data:t={}}={}){return"DCloud-clientDB"===e&&"encryption"===t.redirectTo&&"getAppClientKey"===t.action}function Xo({functionName:e,result:t,logPvd:a}){}function Zo(e){const t=e.callFunction,a=function(a){const o=a.name;a.data=$o.call(e,{data:a.data});const n={aliyun:"aliyun",tencent:"tcb",tcb:"tcb",alipay:"alipay",dcloud:"dcloud"}[this.config.provider],l=Yo(a),s=Qo(a),i=l||s;return t.call(this,a).then((e=>(e.errCode=0,!i&&Xo.call(this,{functionName:o,result:e,logPvd:n}),Promise.resolve(e))),(e=>(!i&&Xo.call(this,{functionName:o,result:e,logPvd:n}),e&&e.message&&(e.message=function({message:e="",extraInfo:t={},formatter:a=[]}={}){for(let o=0;o<a.length;o++){const{rule:n,content:l,mode:s}=a[o],i=e.match(n);if(!i)continue;let r=l;for(let e=1;e<i.length;e++)r=Oo(r,`{$${e}}`,i[e]);for(const e in t)r=Oo(r,`{${e}}`,t[e]);return"replace"===s?r:e+r}return e}({message:`[${a.name}]: ${e.message}`,formatter:Fo,extraInfo:{functionName:o}})),Promise.reject(e))))};e.callFunction=function(t){const{provider:o,spaceId:n}=e.config,l=t.name;let s,i;return t.data=t.data||{},s=a,s=s.bind(e),i=Qo(t)?a.call(e,t):Yo(t)?new Ko({secretType:t.secretType,uniCloudIns:e}).wrapEncryptDataCallFunction(a.bind(e))(t):function({provider:e,spaceId:t,functionName:a}={}){const{appId:o,uniPlatform:n,osName:l}=aa();let s=n;"app"===n&&(s=l);const i=function({provider:e,spaceId:t}={}){const a=kt;if(!a)return{};e=function(e){return"tencent"===e?"tcb":e}(e);const o=a.find((a=>a.provider===e&&a.spaceId===t));return o&&o.config}({provider:e,spaceId:t});if(!i||!i.accessControl||!i.accessControl.enable)return!1;const r=i.accessControl.function||{},c=Object.keys(r);if(0===c.length)return!0;const u=function(e,t){let a,o,n;for(let l=0;l<e.length;l++){const s=e[l];s!==t?"*"!==s?s.split(",").map((e=>e.trim())).indexOf(t)>-1&&(o=s):n=s:a=s}return a||o||n}(c,a);if(!u)return!1;if((r[u]||[]).find(((e={})=>e.appId===o&&(e.platform||"").toLowerCase()===s.toLowerCase())))return!0;throw console.error(`此应用[appId: ${o}, platform: ${s}]不在云端配置的允许访问的应用列表内，参考：https://uniapp.dcloud.net.cn/uniCloud/secure-network.html#verify-client`),Jo(Wo)}({provider:o,spaceId:n,functionName:l})?new Ko({secretType:t.secretType,uniCloudIns:e}).wrapVerifyClientCallFunction(a.bind(e))(t):s(t),Object.defineProperty(i,"result",{get:()=>(console.warn("当前返回结果为Promise类型，不可直接访问其result属性，详情请参考：https://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{})}),i.then((e=>e))}}Ko=class{constructor(){throw Jo({message:"Platform app is not enabled, please check whether secure network module is enabled in your manifest.json"})}};const en=Symbol("CLIENT_DB_INTERNAL");function tn(e,t){return e.then="DoNotReturnProxyWithAFunctionNamedThen",e._internalType=en,e.inspect=null,e.__v_raw=void 0,new Proxy(e,{get(e,a,o){if("_uniClient"===a)return null;if("symbol"==typeof a)return e[a];if(a in e||"string"!=typeof a){const t=e[a];return"function"==typeof t?t.bind(e):t}return t.get(e,a,o)}})}function an(e){return{on:(t,a)=>{e[t]=e[t]||[],e[t].indexOf(a)>-1||e[t].push(a)},off:(t,a)=>{e[t]=e[t]||[];const o=e[t].indexOf(a);-1!==o&&e[t].splice(o,1)}}}const on=["db.Geo","db.command","command.aggregate"];function nn(e,t){return on.indexOf(`${e}.${t}`)>-1}function ln(e){switch(pt(e=Qt(e))){case"array":return e.map((e=>ln(e)));case"object":return e._internalType===en||Object.keys(e).forEach((t=>{e[t]=ln(e[t])})),e;case"regexp":return{$regexp:{source:e.source,flags:e.flags}};case"date":return{$date:e.toISOString()};default:return e}}function sn(e){return e&&e.content&&e.content.$method}class rn{constructor(e,t,a){this.content=e,this.prevStage=t||null,this.udb=null,this._database=a}toJSON(){let e=this;const t=[e.content];for(;e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map((e=>({$method:e.$method,$param:ln(e.$param)})))}}toString(){return JSON.stringify(this.toJSON())}getAction(){const e=this.toJSON().$db.find((e=>"action"===e.$method));return e&&e.$param&&e.$param[0]}getCommand(){return{$db:this.toJSON().$db.filter((e=>"action"!==e.$method))}}get isAggregate(){let e=this;for(;e;){const t=sn(e),a=sn(e.prevStage);if("aggregate"===t&&"collection"===a||"pipeline"===t)return!0;e=e.prevStage}return!1}get isCommand(){let e=this;for(;e;){if("command"===sn(e))return!0;e=e.prevStage}return!1}get isAggregateCommand(){let e=this;for(;e;){const t=sn(e),a=sn(e.prevStage);if("aggregate"===t&&"command"===a)return!0;e=e.prevStage}return!1}getNextStageFn(e){const t=this;return function(){return cn({$method:e,$param:ln(Array.from(arguments))},t,t._database)}}get count(){return this.isAggregate?this.getNextStageFn("count"):function(){return this._send("count",Array.from(arguments))}}get remove(){return this.isCommand?this.getNextStageFn("remove"):function(){return this._send("remove",Array.from(arguments))}}get(){return this._send("get",Array.from(arguments))}get add(){return this.isCommand?this.getNextStageFn("add"):function(){return this._send("add",Array.from(arguments))}}update(){return this._send("update",Array.from(arguments))}end(){return this._send("end",Array.from(arguments))}get set(){return this.isCommand?this.getNextStageFn("set"):function(){throw new Error("JQL禁止使用set方法")}}_send(e,t){const a=this.getAction(),o=this.getCommand();return o.$db.push({$method:e,$param:ln(t)}),this._database._callCloudFunction({action:a,command:o})}}function cn(e,t,a){return tn(new rn(e,t,a),{get(e,t){let o="db";return e&&e.content&&(o=e.content.$method),nn(o,t)?cn({$method:t},e,a):function(){return cn({$method:t,$param:ln(Array.from(arguments))},e,a)}}})}function un({path:e,method:t}){return class{constructor(){this.param=Array.from(arguments)}toJSON(){return{$newDb:[...e.map((e=>({$method:e}))),{$method:t,$param:this.param}]}}toString(){return JSON.stringify(this.toJSON())}}}function dn(e,t={}){return tn(new e(t),{get:(e,t)=>nn("db",t)?cn({$method:t},null,e):function(){return cn({$method:t,$param:ln(Array.from(arguments))},null,e)}})}class mn extends class{constructor({uniClient:e={},isJQL:t=!1}={}){this._uniClient=e,this._authCallBacks={},this._dbCallBacks={},e._isDefault&&(this._dbCallBacks=xt("_globalUniCloudDatabaseCallback")),t||(this.auth=an(this._authCallBacks)),this._isJQL=t,Object.assign(this,an(this._dbCallBacks)),this.env=tn({},{get:(e,t)=>({$env:t})}),this.Geo=tn({},{get:(e,t)=>un({path:["Geo"],method:t})}),this.serverDate=un({path:[],method:"serverDate"}),this.RegExp=un({path:[],method:"RegExp"})}getCloudEnv(e){if("string"!=typeof e||!e.trim())throw new Error("getCloudEnv参数错误");return{$env:e.replace("$cloudEnv_","")}}_callback(e,t){const a=this._dbCallBacks;a[e]&&a[e].forEach((e=>{e(...t)}))}_callbackAuth(e,t){const a=this._authCallBacks;a[e]&&a[e].forEach((e=>{e(...t)}))}multiSend(){const e=Array.from(arguments),t=e.map((e=>{const t=e.getAction(),a=e.getCommand();if("getTemp"!==a.$db[a.$db.length-1].$method)throw new Error("multiSend只支持子命令内使用getTemp");return{action:t,command:a}}));return this._callCloudFunction({multiCommand:t,queryList:e})}}{_parseResult(e){return this._isJQL?e.result:e}_callCloudFunction({action:e,command:t,multiCommand:a,queryList:o}){function n(e,t){if(a&&o)for(let a=0;a<o.length;a++){const n=o[a];n.udb&&"function"==typeof n.udb.setResult&&(t?n.udb.setResult(t):n.udb.setResult(e.result.dataList[a]))}}const l=this,s=this._isJQL?"databaseForJQL":"database";function i(e){return l._callback("error",[e]),Dt(It(s,"fail"),e).then((()=>Dt(It(s,"complete"),e))).then((()=>(n(null,e),jt(Pt,{type:Ft,content:e}),Promise.reject(e))))}const r=Dt(It(s,"invoke")),c=this._uniClient;return r.then((()=>c.callFunction({name:"DCloud-clientDB",type:ut,data:{action:e,command:t,multiCommand:a}}))).then((e=>{const{code:t,message:a,token:o,tokenExpired:r,systemInfo:c=[]}=e.result;if(c)for(let n=0;n<c.length;n++){const{level:e,message:t,detail:a}=c[n];let o="[System Info]"+t;a&&(o=`${o}\n详细信息：${a}`),(console["warn"===e?"error":e]||console.log)(o)}if(t)return i(new Kt({code:t,message:a,requestId:e.requestId}));e.result.errCode=e.result.errCode||e.result.code,e.result.errMsg=e.result.errMsg||e.result.message,o&&r&&(Zt({token:o,tokenExpired:r}),this._callbackAuth("refreshToken",[{token:o,tokenExpired:r}]),this._callback("refreshToken",[{token:o,tokenExpired:r}]),jt($t,{token:o,tokenExpired:r}));const u=[{prop:"affectedDocs",tips:"affectedDocs不再推荐使用，请使用inserted/deleted/updated/data.length替代"},{prop:"code",tips:"code不再推荐使用，请使用errCode替代"},{prop:"message",tips:"message不再推荐使用，请使用errMsg替代"}];for(let n=0;n<u.length;n++){const{prop:t,tips:a}=u[n];if(t in e.result){const o=e.result[t];Object.defineProperty(e.result,t,{get:()=>(console.warn(a),o)})}}return d=e,Dt(It(s,"success"),d).then((()=>Dt(It(s,"complete"),d))).then((()=>{n(d,null);const e=l._parseResult(d);return jt(Pt,{type:Ft,content:e}),Promise.resolve(e)}));var d}),(e=>(/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(e.message)&&console.warn("clientDB未初始化，请在web控制台保存一次schema以开启clientDB"),i(new Kt({code:e.code||"SYSTEM_ERROR",message:e.message,requestId:e.requestId})))))}}const pn="token无效，跳转登录页面",hn="token过期，跳转登录页面",gn={TOKEN_INVALID_TOKEN_EXPIRED:hn,TOKEN_INVALID_INVALID_CLIENTID:pn,TOKEN_INVALID:pn,TOKEN_INVALID_WRONG_TOKEN:pn,TOKEN_INVALID_ANONYMOUS_USER:pn},vn={"uni-id-token-expired":hn,"uni-id-check-token-failed":pn,"uni-id-token-not-exist":pn,"uni-id-check-device-feature-failed":pn},fn={...gn,...vn,default:"用户未登录或登录状态过期，自动跳转登录页面"};function yn(e,t){let a="";return a=e?`${e}/${t}`:t,a.replace(/^\//,"")}function wn(e=[],t=""){const a=[],o=[];return e.forEach((e=>{!0===e.needLogin?a.push(yn(t,e.path)):!1===e.needLogin&&o.push(yn(t,e.path))})),{needLoginPage:a,notNeedLoginPage:o}}function _n(e){return e.split("?")[0].replace(/^\//,"")}function kn(){return function(e){let t=e&&e.$page&&e.$page.fullPath;return t?("/"!==t.charAt(0)&&(t="/"+t),t):""}(function(){const e=getCurrentPages();return e[e.length-1]}())}function En(){return _n(kn())}function Nn(e="",t={}){if(!e)return!1;if(!(t&&t.list&&t.list.length))return!1;const a=t.list,o=_n(e);return a.some((e=>e.pagePath===o))}const Vn=!!Ze.uniIdRouter,{loginPage:bn,routerNeedLogin:xn,resToLogin:Sn,needLoginPage:Cn,notNeedLoginPage:Bn,loginPageInTabBar:Tn}=function({pages:e=[],subPackages:t=[],uniIdRouter:a={},tabBar:o={}}=Ze){const{loginPage:n,needLogin:l=[],resToLogin:s=!0}=a,{needLoginPage:i,notNeedLoginPage:r}=wn(e),{needLoginPage:c,notNeedLoginPage:u}=function(e=[]){const t=[],a=[];return e.forEach((e=>{const{root:o,pages:n=[]}=e,{needLoginPage:l,notNeedLoginPage:s}=wn(n,o);t.push(...l),a.push(...s)})),{needLoginPage:t,notNeedLoginPage:a}}(t);return{loginPage:n,routerNeedLogin:l,resToLogin:s,needLoginPage:[...i,...c],notNeedLoginPage:[...r,...u],loginPageInTabBar:Nn(n,o)}}();if(Cn.indexOf(bn)>-1)throw new Error(`Login page [${bn}] should not be "needLogin", please check your pages.json`);function Dn(e){const t=En();if("/"===e.charAt(0))return e;const[a,o]=e.split("?"),n=a.replace(/^\//,"").split("/"),l=t.split("/");l.pop();for(let s=0;s<n.length;s++){const e=n[s];".."===e?l.pop():"."!==e&&l.push(e)}return""===l[0]&&l.shift(),"/"+l.join("/")+(o?"?"+o:"")}function In({redirect:e}){const t=_n(e),a=_n(bn);return En()!==a&&t!==a}function zn({api:e,redirect:t}={}){if(!t||!In({redirect:t}))return;const a=(n=t,"/"!==(o=bn).charAt(0)&&(o="/"+o),n?o.indexOf("?")>-1?o+`&uniIdRedirectUrl=${encodeURIComponent(n)}`:o+`?uniIdRedirectUrl=${encodeURIComponent(n)}`:o);var o,n;Tn?"navigateTo"!==e&&"redirectTo"!==e||(e="switchTab"):"switchTab"===e&&(e="navigateTo");const l={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,switchTab:uni.switchTab,reLaunch:uni.reLaunch};setTimeout((()=>{l[e]({url:a})}),0)}function An({url:e}={}){const t={abortLoginPageJump:!1,autoToLoginPage:!1},a=function(){const{token:e,tokenExpired:t}=Xt();let a;if(e){if(t<Date.now()){const e="uni-id-token-expired";a={errCode:e,errMsg:fn[e]}}}else{const e="uni-id-check-token-failed";a={errCode:e,errMsg:fn[e]}}return a}();if(function(e){const t=_n(Dn(e));return!(Bn.indexOf(t)>-1)&&(Cn.indexOf(t)>-1||xn.some((t=>{return a=e,new RegExp(t).test(a);var a})))}(e)&&a){if(a.uniIdRedirectUrl=e,Ot(Lt).length>0)return setTimeout((()=>{jt(Lt,a)}),0),t.abortLoginPageJump=!0,t;t.autoToLoginPage=!0}return t}function Pn(){!function(){const e=kn(),{abortLoginPageJump:t,autoToLoginPage:a}=An({url:e});t||a&&zn({api:"redirectTo",redirect:e})}();const e=["navigateTo","redirectTo","reLaunch","switchTab"];for(let t=0;t<e.length;t++){const a=e[t];uni.addInterceptor(a,{invoke(e){const{abortLoginPageJump:t,autoToLoginPage:o}=An({url:e.url});return t?e:o?(zn({api:a,redirect:Dn(e.url)}),!1):e}})}}function Ln(){this.onResponse((e=>{const{type:t,content:a}=e;let o=!1;switch(t){case"cloudobject":o=function(e){if("object"!=typeof e)return!1;const{errCode:t}=e||{};return t in fn}(a);break;case"clientdb":o=function(e){if("object"!=typeof e)return!1;const{errCode:t}=e||{};return t in gn}(a)}o&&function(e={}){const t=Ot(Lt);Wt().then((()=>{const a=kn();if(a&&In({redirect:a}))return t.length>0?jt(Lt,Object.assign({uniIdRedirectUrl:a},e)):void(bn&&zn({api:"navigateTo",redirect:a}))}))}(a)}))}function $n(e){var t;(t=e).onResponse=function(e){qt(Pt,e)},t.offResponse=function(e){Ut(Pt,e)},function(e){e.onNeedLogin=function(e){qt(Lt,e)},e.offNeedLogin=function(e){Ut(Lt,e)},Vn&&(xt(Ho).needLoginInit||(xt(Ho).needLoginInit=!0,Wt().then((()=>{Pn.call(e)})),Sn&&Ln.call(e)))}(e),function(e){e.onRefreshToken=function(e){qt($t,e)},e.offRefreshToken=function(e){Ut($t,e)}}(e)}let Fn;const Mn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Rn=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function On(){const e=Xt().token||"",t=e.split(".");if(!e||3!==t.length)return{uid:null,role:[],permission:[],tokenExpired:0};let a;try{a=JSON.parse((o=t[1],decodeURIComponent(Fn(o).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(n){throw new Error("获取当前用户信息出错，详细错误信息为："+n.message)}var o;return a.tokenExpired=1e3*a.exp,delete a.exp,delete a.iat,a}Fn="function"!=typeof atob?function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!Rn.test(e))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var a,o,n="",l=0;l<e.length;)t=Mn.indexOf(e.charAt(l++))<<18|Mn.indexOf(e.charAt(l++))<<12|(a=Mn.indexOf(e.charAt(l++)))<<6|(o=Mn.indexOf(e.charAt(l++))),n+=64===a?String.fromCharCode(t>>16&255):64===o?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return n}:atob;var qn=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(et((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const a="chooseAndUploadFile:ok",o="chooseAndUploadFile:fail";function n(e,t){return e.tempFiles.forEach(((e,a)=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+a+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}function l(e,t,{onChooseFile:o,onUploadProgress:n}){return t.then((e=>{if(o){const t=o(e);if(void 0!==t)return Promise.resolve(t).then((t=>void 0===t?e:t))}return e})).then((t=>!1===t?{errMsg:a,tempFilePaths:[],tempFiles:[]}:function(e,t,o=5,n){(t=Object.assign({},t)).errMsg=a;const l=t.tempFiles,s=l.length;let i=0;return new Promise((a=>{for(;i<o;)r();function r(){const o=i++;if(o>=s)return void(!l.find((e=>!e.url&&!e.errMsg))&&a(t));const c=l[o];e.uploadFile({provider:c.provider,filePath:c.path,cloudPath:c.cloudPath,fileType:c.fileType,cloudPathAsRealPath:c.cloudPathAsRealPath,onUploadProgress(e){e.index=o,e.tempFile=c,e.tempFilePath=c.path,n&&n(e)}}).then((e=>{c.url=e.fileID,o<s&&r()})).catch((e=>{c.errMsg=e.errMsg||e.message,o<s&&r()}))}}))}(e,t,5,n)))}t.initChooseAndUploadFile=function(e){return function(t={type:"all"}){return"image"===t.type?l(e,function(e){const{count:t,sizeType:a,sourceType:l=["album","camera"],extension:s}=e;return new Promise(((e,i)=>{uni.chooseImage({count:t,sizeType:a,sourceType:l,extension:s,success(t){e(n(t,"image"))},fail(e){i({errMsg:e.errMsg.replace("chooseImage:fail",o)})}})}))}(t),t):"video"===t.type?l(e,function(e){const{camera:t,compressed:a,maxDuration:l,sourceType:s=["album","camera"],extension:i}=e;return new Promise(((e,r)=>{uni.chooseVideo({camera:t,compressed:a,maxDuration:l,sourceType:s,extension:i,success(t){const{tempFilePath:a,duration:o,size:l,height:s,width:i}=t;e(n({errMsg:"chooseVideo:ok",tempFilePaths:[a],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:a,size:l,type:t.tempFile&&t.tempFile.type||"",width:i,height:s,duration:o,fileType:"video",cloudPath:""}]},"video"))},fail(e){r({errMsg:e.errMsg.replace("chooseVideo:fail",o)})}})}))}(t),t):l(e,function(e){const{count:t,extension:a}=e;return new Promise(((e,l)=>{let s=uni.chooseFile;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(s=wx.chooseMessageFile),"function"!=typeof s)return l({errMsg:o+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});s({type:"all",count:t,extension:a,success(t){e(n(t))},fail(e){l({errMsg:e.errMsg.replace("chooseFile:fail",o)})}})}))}(t),t)}}})));const Un="manual";function jn(e){return{props:{localdata:{type:Array,default:()=>[]},options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:()=>({mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{},mixinDatacomError:null}),created(){this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((()=>{var e=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach((t=>{e.push(this[t])})),e}),((e,t)=>{if(this.loadtime===Un)return;let a=!1;const o=[];for(let n=2;n<e.length;n++)e[n]!==t[n]&&(o.push(e[n]),a=!0);e[0]!==t[0]&&(this.mixinDatacomPage.current=this.pageCurrent),this.mixinDatacomPage.size=this.pageSize,this.onMixinDatacomPropsChange(a,o)}))},methods:{onMixinDatacomPropsChange(e,t){},mixinDatacomEasyGet({getone:e=!1,success:t,fail:a}={}){this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomError=null,this.mixinDatacomGet().then((a=>{this.mixinDatacomLoading=!1;const{data:o,count:n}=a.result;this.getcount&&(this.mixinDatacomPage.count=n),this.mixinDatacomHasMore=o.length<this.pageSize;const l=e?o.length?o[0]:void 0:o;this.mixinDatacomResData=l,t&&t(l)})).catch((e=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=e,this.mixinDatacomError=e,a&&a(e)})))},mixinDatacomGet(t={}){let a;t=t||{},a="undefined"!=typeof __uniX&&__uniX?e.databaseForJQL(this.spaceInfo):e.database(this.spaceInfo);const o=t.action||this.action;o&&(a=a.action(o));const n=t.collection||this.collection;a=Array.isArray(n)?a.collection(...n):a.collection(n);const l=t.where||this.where;l&&Object.keys(l).length&&(a=a.where(l));const s=t.field||this.field;s&&(a=a.field(s));const i=t.foreignKey||this.foreignKey;i&&(a=a.foreignKey(i));const r=t.groupby||this.groupby;r&&(a=a.groupBy(r));const c=t.groupField||this.groupField;c&&(a=a.groupField(c)),!0===(void 0!==t.distinct?t.distinct:this.distinct)&&(a=a.distinct());const u=t.orderby||this.orderby;u&&(a=a.orderBy(u));const d=void 0!==t.pageCurrent?t.pageCurrent:this.mixinDatacomPage.current,m=void 0!==t.pageSize?t.pageSize:this.mixinDatacomPage.size,p=void 0!==t.getcount?t.getcount:this.getcount,h=void 0!==t.gettree?t.gettree:this.gettree,g=void 0!==t.gettreepath?t.gettreepath:this.gettreepath,v={getCount:p},f={limitLevel:void 0!==t.limitlevel?t.limitlevel:this.limitlevel,startWith:void 0!==t.startwith?t.startwith:this.startwith};return h&&(v.getTree=f),g&&(v.getTreePath=f),a=a.skip(m*(d-1)).limit(m).get(v),a}}}}function Hn(e){return xt("_globalUniCloudSecureNetworkCache__{spaceId}".replace("{spaceId}",e.config.spaceId))}async function Gn({openid:e,callLoginByWeixin:t=!1}={}){throw Hn(this),new Error("[SecureNetwork] API `initSecureNetworkByWeixin` is not supported on platform `app`")}async function Wn(e){const t=Hn(this);return t.initPromise||(t.initPromise=Gn.call(this,e).then((e=>e)).catch((e=>{throw delete t.initPromise,e}))),t.initPromise}function Jn(e){na=e}function Kn(e){const t={getAppBaseInfo:uni.getSystemInfo,getPushClientId:uni.getPushClientId};return function(a){return new Promise(((o,n)=>{t[e]({...a,success(e){o(e)},fail(e){n(e)}})}))}}class Yn extends class{constructor(){this._callback={}}addListener(e,t){this._callback[e]||(this._callback[e]=[]),this._callback[e].push(t)}on(e,t){return this.addListener(e,t)}removeListener(e,t){if(!t)throw new Error('The "listener" argument must be of type function. Received undefined');const a=this._callback[e];if(!a)return;const o=function(e,t){for(let a=e.length-1;a>=0;a--)if(e[a]===t)return a;return-1}(a,t);a.splice(o,1)}off(e,t){return this.removeListener(e,t)}removeAllListener(e){delete this._callback[e]}emit(e,...t){const a=this._callback[e];if(a)for(let o=0;o<a.length;o++)a[o](...t)}}{constructor(){super(),this._uniPushMessageCallback=this._receivePushMessage.bind(this),this._currentMessageId=-1,this._payloadQueue=[]}init(){return Promise.all([Kn("getAppBaseInfo")(),Kn("getPushClientId")()]).then((([{appId:e}={},{cid:t}={}]=[])=>{if(!e)throw new Error("Invalid appId, please check the manifest.json file");if(!t)throw new Error("Invalid push client id");this._appId=e,this._pushClientId=t,this._seqId=Date.now()+"-"+Math.floor(9e5*Math.random()+1e5),this.emit("open"),this._initMessageListener()}),(e=>{throw this.emit("error",e),this.close(),e}))}async open(){return this.init()}_isUniCloudSSE(e){if("receive"!==e.type)return!1;const t=e&&e.data&&e.data.payload;return!(!t||"UNI_CLOUD_SSE"!==t.channel||t.seqId!==this._seqId)}_receivePushMessage(e){if(!this._isUniCloudSSE(e))return;const t=e&&e.data&&e.data.payload,{action:a,messageId:o,message:n}=t;this._payloadQueue.push({action:a,messageId:o,message:n}),this._consumMessage()}_consumMessage(){for(;;){const e=this._payloadQueue.find((e=>e.messageId===this._currentMessageId+1));if(!e)break;this._currentMessageId++,this._parseMessagePayload(e)}}_parseMessagePayload(e){const{action:t,messageId:a,message:o}=e;"end"===t?this._end({messageId:a,message:o}):"message"===t&&this._appendMessage({messageId:a,message:o})}_appendMessage({messageId:e,message:t}={}){this.emit("message",t)}_end({messageId:e,message:t}={}){this.emit("end",t),this.close()}_initMessageListener(){uni.onPushMessage(this._uniPushMessageCallback)}_destroy(){uni.offPushMessage(this._uniPushMessageCallback)}toJSON(){return{appId:this._appId,pushClientId:this._pushClientId,seqId:this._seqId}}close(){this._destroy(),this.emit("close")}}const Qn={tcb:Vo,tencent:Vo,aliyun:ca,private:So,dcloud:So,alipay:Lo};let Xn=new class{init(e){let t={};const a=Qn[e.provider];if(!a)throw new Error("未提供正确的provider参数");var o;return t=a.init(e),function(e){e._initPromiseHub||(e._initPromiseHub=new wt({createPromise:function(){let t=Promise.resolve();t=new Promise((e=>{setTimeout((()=>{e()}),1)}));const a=e.auth();return t.then((()=>a.getLoginState())).then((e=>e?Promise.resolve():a.signInAnonymously()))}}))}(t),Zo(t),function(e){const t=e.uploadFile;e.uploadFile=function(e){return t.call(this,e)}}(t),(o=t).database=function(e){if(e&&Object.keys(e).length>0)return o.init(e).database();if(this._database)return this._database;const t=dn(mn,{uniClient:o});return this._database=t,t},o.databaseForJQL=function(e){if(e&&Object.keys(e).length>0)return o.init(e).databaseForJQL();if(this._databaseForJQL)return this._databaseForJQL;const t=dn(mn,{uniClient:o,isJQL:!0});return this._databaseForJQL=t,t},function(e){e.getCurrentUserInfo=On,e.chooseAndUploadFile=qn.initChooseAndUploadFile(e),Object.assign(e,{get mixinDatacom(){return jn(e)}}),e.SSEChannel=Yn,e.initSecureNetworkByWeixin=function(e){return function({openid:t,callLoginByWeixin:a=!1}={}){return Wn.call(e,{openid:t,callLoginByWeixin:a})}}(e),e.setCustomClientInfo=Jn,e.importObject=function(t){return function(a,o={}){o=function(e,t={}){return e.customUI=t.customUI||e.customUI,e.parseSystemError=t.parseSystemError||e.parseSystemError,Object.assign(e.loadingOptions,t.loadingOptions),Object.assign(e.errorOptions,t.errorOptions),"object"==typeof t.secretMethods&&(e.secretMethods=t.secretMethods),e}({customUI:!1,loadingOptions:{title:"加载中...",mask:!0},errorOptions:{type:"modal",retry:!1}},o);const{customUI:n,loadingOptions:l,errorOptions:s,parseSystemError:i}=o,r=!n;return new Proxy({},{get(n,c){switch(c){case"toString":return"[object UniCloudObject]";case"toJSON":return{}}return function({fn:e,interceptorName:t,getCallbackArgs:a}={}){return async function(...o){const n=a?a({params:o}):{};let l,s;try{return await Dt(It(t,"invoke"),{...n}),l=await e(...o),await Dt(It(t,"success"),{...n,result:l}),l}catch(i){throw s=i,await Dt(It(t,"fail"),{...n,error:s}),s}finally{await Dt(It(t,"complete"),s?{...n,error:s}:{...n,result:l})}}}({fn:async function n(...u){let d;r&&uni.showLoading({title:l.title,mask:l.mask});const m={name:a,type:ct,data:{method:c,params:u}};"object"==typeof o.secretMethods&&function(e,t){const a=t.data.method,o=e.secretMethods||{},n=o[a]||o["*"];n&&(t.secretType=n)}(o,m);let p=!1;try{d=await t.callFunction(m)}catch(e){p=!0,d={result:new Kt(e)}}const{errSubject:h,errCode:g,errMsg:v,newToken:f}=d.result||{};if(r&&uni.hideLoading(),f&&f.token&&f.tokenExpired&&(Zt(f),jt($t,{...f})),g){let e=v;if(p&&i&&(e=(await i({objectName:a,methodName:c,params:u,errSubject:h,errCode:g,errMsg:v})).errMsg||v),r)if("toast"===s.type)uni.showToast({title:e,icon:"none"});else{if("modal"!==s.type)throw new Error(`Invalid errorOptions.type: ${s.type}`);{const{confirm:t}=await async function({title:e,content:t,showCancel:a,cancelText:o,confirmText:n}={}){return new Promise(((l,s)=>{uni.showModal({title:e,content:t,showCancel:a,cancelText:o,confirmText:n,success(e){l(e)},fail(){l({confirm:!1,cancel:!0})}})}))}({title:"提示",content:e,showCancel:s.retry,cancelText:"取消",confirmText:s.retry?"重试":"确定"});if(s.retry&&t)return n(...u)}}const t=new Kt({subject:h,code:g,message:v,requestId:d.requestId});throw t.detail=d.result,jt(Pt,{type:Rt,content:t}),t}return jt(Pt,{type:Rt,content:d.result}),d.result},interceptorName:"callObject",getCallbackArgs:function({params:e}={}){return{objectName:a,methodName:c,params:e}}})}})}}(e)}(t),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach((e=>{if(!t[e])return;const a=t[e];t[e]=function(){return a.apply(t,Array.from(arguments))},t[e]=function(e,t){return function(a){let o=!1;if("callFunction"===t){const e=a&&a.type||rt;o=e!==rt}const n="callFunction"===t&&!o,l=this._initPromiseHub.exec();a=a||{};const{success:s,fail:i,complete:r}=Jt(a),c=l.then((()=>o?Promise.resolve():Dt(It(t,"invoke"),a))).then((()=>e.call(this,a))).then((e=>o?Promise.resolve(e):Dt(It(t,"success"),e).then((()=>Dt(It(t,"complete"),e))).then((()=>(n&&jt(Pt,{type:Mt,content:e}),Promise.resolve(e))))),(e=>o?Promise.reject(e):Dt(It(t,"fail"),e).then((()=>Dt(It(t,"complete"),e))).then((()=>(jt(Pt,{type:Mt,content:e}),Promise.reject(e))))));if(!(s||i||r))return c;c.then((e=>{s&&s(e),r&&r(e),n&&jt(Pt,{type:Mt,content:e})}),(e=>{i&&i(e),r&&r(e),n&&jt(Pt,{type:Mt,content:e})}))}}(t[e],e).bind(t)})),t.init=this.init,t}};(()=>{const e=Et;let t={};if(e&&1===e.length)t=e[0],Xn=Xn.init(t),Xn._isDefault=!0;else{const t=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile"],a=["database","getCurrentUserInfo","importObject"];let o;o=e&&e.length>0?"应用有多个服务空间，请通过uniCloud.init方法指定要使用的服务空间":"应用未关联服务空间，请在uniCloud目录右键关联服务空间",[...t,...a].forEach((e=>{Xn[e]=function(){if(console.error(o),-1===a.indexOf(e))return Promise.reject(new Kt({code:"SYS_ERR",message:o}));console.error(o)}}))}Object.assign(Xn,{get mixinDatacom(){return jn(Xn)}}),$n(Xn),Xn.addInterceptor=Bt,Xn.removeInterceptor=Tt,Xn.interceptObject=zt,uni.__uniCloud=Xn;{const e=Vt||(Vt=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;function e(){return this}return void 0!==e()?e():new Function("return this")()}(),Vt);e.uniCloud=Xn,e.UniCloudError=Kt}})();var Zn=Xn;const el={props:{localdata:{type:[Array,Object],default:()=>[]},spaceInfo:{type:Object,default:()=>({})},collection:{type:String,default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:500},getcount:{type:[Boolean,String],default:!1},getone:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},manual:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>[]},modelValue:{type:[Array,String,Number],default:()=>[]},preload:{type:Boolean,default:!1},stepSearh:{type:Boolean,default:!0},selfField:{type:String,default:""},parentField:{type:String,default:""},multiple:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},data(){return{loading:!1,errorMessage:"",loadMore:{contentdown:"",contentrefresh:"",contentnomore:""},dataList:[],selected:[],selectedIndex:0,page:{current:this.pageCurrent,size:this.pageSize,count:0}}},computed:{isLocalData(){return!this.collection.length},isCloudData(){return this.collection.length>0},isCloudDataList(){return this.isCloudData&&!this.parentField&&!this.selfField},isCloudDataTree(){return this.isCloudData&&this.parentField&&this.selfField},dataValue(){return(Array.isArray(this.modelValue)?this.modelValue.length>0:null!==this.modelValue||void 0!==this.modelValue)?this.modelValue:this.value},hasValue(){return"number"==typeof this.dataValue||null!=this.dataValue&&this.dataValue.length>0}},created(){this.$watch((()=>{var e=[];return["pageCurrent","pageSize","spaceInfo","value","modelValue","localdata","collection","action","field","orderby","where","getont","getcount","gettree"].forEach((t=>{e.push(this[t])})),e}),((e,t)=>{for(let a=2;a<e.length&&e[a]==t[a];a++);e[0]!=t[0]&&(this.page.current=this.pageCurrent),this.page.size=this.pageSize,this.onPropsChange()})),this._treeData=[]},methods:{onPropsChange(){this._treeData=[]},async loadData(){this.isLocalData?this.loadLocalData():this.isCloudDataList?this.loadCloudDataList():this.isCloudDataTree&&this.loadCloudDataTree()},async loadLocalData(){this._treeData=[],this._extractTree(this.localdata,this._treeData);let e=this.dataValue;void 0!==e&&(Array.isArray(e)&&(e=e[e.length-1],"object"==typeof e&&e[this.map.value]&&(e=e[this.map.value])),this.selected=this._findNodePath(e,this.localdata))},async loadCloudDataList(){if(!this.loading){this.loading=!0;try{let e=(await this.getCommand()).result.data;this._treeData=e,this._updateBindData(),this._updateSelected(),this.onDataChange()}catch(ma){this.errorMessage=ma}finally{this.loading=!1}}},async loadCloudDataTree(){if(!this.loading){this.loading=!0;try{let e={field:this._cloudDataPostField(),where:this._cloudDataTreeWhere()};this.gettree&&(e.startwith=`${this.selfField}=='${this.dataValue}'`);let t=(await this.getCommand(e)).result.data;this._treeData=t,this._updateBindData(),this._updateSelected(),this.onDataChange()}catch(ma){this.errorMessage=ma}finally{this.loading=!1}}},async loadCloudDataNode(e){if(!this.loading){this.loading=!0;try{let t={field:this._cloudDataPostField(),where:this._cloudDataNodeWhere()};e((await this.getCommand(t)).result.data)}catch(ma){this.errorMessage=ma}finally{this.loading=!1}}},getCloudDataValue(){return this.isCloudDataList?this.getCloudDataListValue():this.isCloudDataTree?this.getCloudDataTreeValue():void 0},getCloudDataListValue(){let e=[],t=this._getForeignKeyByField();return t&&e.push(`${t} == '${this.dataValue}'`),e=e.join(" || "),this.where&&(e=`(${this.where}) && (${e})`),this.getCommand({field:this._cloudDataPostField(),where:e}).then((e=>(this.selected=e.result.data,e.result.data)))},getCloudDataTreeValue(){return this.getCommand({field:this._cloudDataPostField(),getTreePath:{startWith:`${this.selfField}=='${this.dataValue}'`}}).then((e=>{let t=[];return this._extractTreePath(e.result.data,t),this.selected=t,t}))},getCommand(e={}){let t=Zn.database(this.spaceInfo);const a=e.action||this.action;a&&(t=t.action(a));const o=e.collection||this.collection;t=t.collection(o);const n=e.where||this.where;n&&Object.keys(n).length&&(t=t.where(n));const l=e.field||this.field;l&&(t=t.field(l));const s=e.orderby||this.orderby;s&&(t=t.orderBy(s));const i=void 0!==e.pageCurrent?e.pageCurrent:this.page.current,r=void 0!==e.pageSize?e.pageSize:this.page.size,c={getCount:void 0!==e.getcount?e.getcount:this.getcount,getTree:void 0!==e.gettree?e.gettree:this.gettree};return e.getTreePath&&(c.getTreePath=e.getTreePath),t=t.skip(r*(i-1)).limit(r).get(c),t},_cloudDataPostField(){let e=[this.field];return this.parentField&&e.push(`${this.parentField} as parent_value`),e.join(",")},_cloudDataTreeWhere(){let e=[],t=this.selected,a=this.parentField;if(a&&e.push(`${a} == null || ${a} == ""`),t.length)for(var o=0;o<t.length-1;o++)e.push(`${a} == '${t[o].value}'`);let n=[];return this.where&&n.push(`(${this.where})`),e.length&&n.push(`(${e.join(" || ")})`),n.join(" && ")},_cloudDataNodeWhere(){let e=[],t=this.selected;return t.length&&e.push(`${this.parentField} == '${t[t.length-1].value}'`),e=e.join(" || "),this.where?`(${this.where}) && (${e})`:e},_getWhereByForeignKey(){let e=[],t=this._getForeignKeyByField();return t&&e.push(`${t} == '${this.dataValue}'`),this.where?`(${this.where}) && (${e.join(" || ")})`:e.join(" || ")},_getForeignKeyByField(){let e=this.field.split(","),t=null;for(let a=0;a<e.length;a++){const o=e[a].split("as");if(!(o.length<2)&&"value"===o[1].trim()){t=o[0].trim();break}}return t},_updateBindData(e){const{dataList:t,hasNodes:a}=this._filterData(this._treeData,this.selected);let o=!1===this._stepSearh&&!a;return e&&(e.isleaf=o),this.dataList=t,this.selectedIndex=t.length-1,!o&&this.selected.length<t.length&&this.selected.push({value:null,text:"请选择"}),{isleaf:o,hasNodes:a}},_updateSelected(){let e=this.dataList,t=this.selected,a=this.map.text,o=this.map.value;for(let n=0;n<t.length;n++){let l=t[n].value,s=e[n];for(let e=0;e<s.length;e++){let i=s[e];if(i[o]===l){t[n].text=i[a];break}}}},_filterData(e,t){let a=[],o=!0;a.push(e.filter((e=>null===e.parent_value||void 0===e.parent_value||""===e.parent_value)));for(let n=0;n<t.length;n++){let l=t[n].value,s=e.filter((e=>e.parent_value===l));s.length?a.push(s):o=!1}return{dataList:a,hasNodes:o}},_extractTree(e,t,a){let o=this.map.value;for(let n=0;n<e.length;n++){let l=e[n],s={};for(let e in l)"children"!==e&&(s[e]=l[e]);null!=a&&""!==a&&(s.parent_value=a),t.push(s);let i=l.children;i&&this._extractTree(i,t,l[o])}},_extractTreePath(e,t){for(let a=0;a<e.length;a++){let o=e[a],n={};for(let e in o)"children"!==e&&(n[e]=o[e]);t.push(n);let l=o.children;l&&this._extractTreePath(l,t)}},_findNodePath(e,t,a=[]){let o=this.map.text,n=this.map.value;for(let l=0;l<t.length;l++){let s=t[l],i=s.children,r=s[o],c=s[n];if(a.push({value:c,text:r}),c===e)return a;if(i){const t=this._findNodePath(e,i,a);if(t.length)return t}a.pop()}return[]}}};const tl={name:"UniDataPicker",emits:["popupopened","popupclosed","nodeclick","input","change","update:modelValue","inputclick"],mixins:[el],components:{DataPickerView:V({name:"UniDataPickerView",emits:["nodeclick","change","datachange","update:modelValue"],mixins:[el],props:{managedMode:{type:Boolean,default:!1},ellipsis:{type:Boolean,default:!0}},created(){this.managedMode||this.$nextTick((()=>{this.loadData()}))},methods:{onPropsChange(){this._treeData=[],this.selectedIndex=0,this.$nextTick((()=>{this.loadData()}))},handleSelect(e){this.selectedIndex=e},handleNodeClick(e,t,a){if(e.disable)return;const o=this.dataList[t][a],n=o[this.map.text],l=o[this.map.value];if(t<this.selected.length-1?(this.selected.splice(t,this.selected.length-t),this.selected.push({text:n,value:l})):t===this.selected.length-1&&this.selected.splice(t,1,{text:n,value:l}),o.isleaf)return void this.onSelectedChange(o,o.isleaf);const{isleaf:s,hasNodes:i}=this._updateBindData();this.isLocalData?this.onSelectedChange(o,!i||s):this.isCloudDataList?this.onSelectedChange(o,!0):this.isCloudDataTree&&(s?this.onSelectedChange(o,o.isleaf):i||this.loadCloudDataNode((e=>{e.length?(this._treeData.push(...e),this._updateBindData(o)):o.isleaf=!0,this.onSelectedChange(o,o.isleaf)})))},updateData(e){this._treeData=e.treeData,this.selected=e.selected,this._treeData.length?this._updateBindData():this.loadData()},onDataChange(){this.$emit("datachange")},onSelectedChange(e,t){t&&this._dispatchEvent(),e&&this.$emit("nodeclick",e)},_dispatchEvent(){this.$emit("change",this.selected.slice(0))}}},[["render",function(t,o,n,l,s,i){const r=a(e.resolveDynamicComponent("uni-load-more"),Xe);return e.openBlock(),e.createElementBlock("view",{class:"uni-data-pickerview"},[t.isCloudDataList?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("scroll-view",{key:0,class:"selected-area","scroll-x":"true"},[e.createElementVNode("view",{class:"selected-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.selected,((a,o)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["selected-item",{"selected-item-active":o==t.selectedIndex}]),key:o,onClick:e=>i.handleSelect(o)},[e.createElementVNode("text",null,e.toDisplayString(a.text||""),1)],10,["onClick"])))),128))])])),e.createElementVNode("view",{class:"tab-c"},[e.createElementVNode("scroll-view",{class:"list","scroll-y":!0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.dataList[t.selectedIndex],((a,o)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["item",{"is-disabled":!!a.disable}]),key:o,onClick:e=>i.handleNodeClick(a,t.selectedIndex,o)},[e.createElementVNode("text",{class:"item-text"},e.toDisplayString(a[t.map.text]),1),t.selected.length>t.selectedIndex&&a[t.map.value]==t.selected[t.selectedIndex].value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"check"})):e.createCommentVNode("",!0)],10,["onClick"])))),128))]),t.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-cover"},[e.createVNode(r,{class:"load-more",contentText:t.loadMore,status:"loading"},null,8,["contentText"])])):e.createCommentVNode("",!0),t.errorMessage?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-message"},[e.createElementVNode("text",{class:"error-text"},e.toDisplayString(t.errorMessage),1)])):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-c0c521c5"]])},props:{options:{type:[Object,Array],default:()=>({})},popupTitle:{type:String,default:"请选择"},placeholder:{type:String,default:"请选择"},heightMobile:{type:String,default:""},readonly:{type:Boolean,default:!1},clearIcon:{type:Boolean,default:!0},border:{type:Boolean,default:!0},split:{type:String,default:"/"},ellipsis:{type:Boolean,default:!0}},data:()=>({isOpened:!1,inputSelected:[]}),created(){this.$nextTick((()=>{this.load()}))},watch:{localdata:{handler(){this.load()},deep:!0}},methods:{clear(){this._dispatchEvent([])},onPropsChange(){this._treeData=[],this.selectedIndex=0,this.load()},load(){this.readonly?this._processReadonly(this.localdata,this.dataValue):this.isLocalData?(this.loadData(),this.inputSelected=this.selected.slice(0)):(this.isCloudDataList||this.isCloudDataTree)&&(this.loading=!0,this.getCloudDataValue().then((e=>{this.loading=!1,this.inputSelected=e})).catch((e=>{this.loading=!1,this.errorMessage=e})))},show(){this.isOpened=!0,setTimeout((()=>{this.$refs.pickerView.updateData({treeData:this._treeData,selected:this.selected,selectedIndex:this.selectedIndex})}),200),this.$emit("popupopened")},hide(){this.isOpened=!1,this.$emit("popupclosed")},handleInput(){this.readonly?this.$emit("inputclick"):this.show()},handleClose(e){this.hide()},onnodeclick(e){this.$emit("nodeclick",e)},ondatachange(e){this._treeData=this.$refs.pickerView._treeData},onchange(e){this.hide(),this.$nextTick((()=>{this.inputSelected=e})),this._dispatchEvent(e)},_processReadonly(e,t){if(e.findIndex((e=>e.children))>-1){let e;return Array.isArray(t)?(e=t[t.length-1],"object"==typeof e&&e.value&&(e=e.value)):e=t,void(this.inputSelected=this._findNodePath(e,this.localdata))}if(!this.hasValue)return void(this.inputSelected=[]);let a=[];if(Array.isArray(t))for(let l=0;l<t.length;l++){var o=t[l],n=e.find((e=>e.value==o));n&&a.push(n)}else{let o=e.find((e=>e.value==t));o&&a.push(o)}a.length&&(this.inputSelected=a)},_filterForArray(e,t){var a=[];for(let l=0;l<t.length;l++){var o=t[l],n=e.find((e=>e.value==o));n&&a.push(n)}return a},_dispatchEvent(e){let t={};if(e.length){for(var a=new Array(e.length),o=0;o<e.length;o++)a[o]=e[o].value;t=e[e.length-1]}else t.value="";this.formItem&&this.formItem.setValue(t.value),this.$emit("input",t.value),this.$emit("update:modelValue",t.value),this.$emit("change",{detail:{value:e}})}}};const al=V(tl,[["render",function(t,o,n,l,s,i){const r=a(e.resolveDynamicComponent("uni-load-more"),Xe),c=a(e.resolveDynamicComponent("uni-icons"),b),u=e.resolveComponent("data-picker-view");return e.openBlock(),e.createElementBlock("view",{class:"uni-data-tree"},[e.createElementVNode("view",{class:"uni-data-tree-input",onClick:o[1]||(o[1]=(...e)=>i.handleInput&&i.handleInput(...e))},[e.renderSlot(t.$slots,"default",{options:n.options,data:s.inputSelected,error:t.errorMessage},(()=>[e.createElementVNode("view",{class:e.normalizeClass(["input-value",{"input-value-border":n.border}])},[t.errorMessage?(e.openBlock(),e.createElementBlock("text",{key:0,class:"selected-area error-text"},e.toDisplayString(t.errorMessage),1)):t.loading&&!s.isOpened?(e.openBlock(),e.createElementBlock("view",{key:1,class:"selected-area"},[e.createVNode(r,{class:"load-more",contentText:t.loadMore,status:"loading"},null,8,["contentText"])])):s.inputSelected.length?(e.openBlock(),e.createElementBlock("scroll-view",{key:2,class:"selected-area","scroll-x":"true"},[e.createElementVNode("view",{class:"selected-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.inputSelected,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"selected-item",key:a},[e.createElementVNode("text",{class:"text-color"},e.toDisplayString(t.text),1),a<s.inputSelected.length-1?(e.openBlock(),e.createElementBlock("text",{key:0,class:"input-split-line"},e.toDisplayString(n.split),1)):e.createCommentVNode("",!0)])))),128))])])):(e.openBlock(),e.createElementBlock("text",{key:3,class:"selected-area placeholder"},e.toDisplayString(n.placeholder),1)),n.clearIcon&&!n.readonly&&s.inputSelected.length?(e.openBlock(),e.createElementBlock("view",{key:4,class:"icon-clear",onClick:o[0]||(o[0]=e.withModifiers(((...e)=>i.clear&&i.clear(...e)),["stop"]))},[e.createVNode(c,{type:"clear",color:"#c0c4cc",size:"24"})])):e.createCommentVNode("",!0),n.clearIcon&&s.inputSelected.length||n.readonly?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:5,class:"arrow-area"},[e.createElementVNode("view",{class:"input-arrow"})]))],2)]),!0)]),s.isOpened?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uni-data-tree-cover",onClick:o[2]||(o[2]=(...e)=>i.handleClose&&i.handleClose(...e))})):e.createCommentVNode("",!0),s.isOpened?(e.openBlock(),e.createElementBlock("view",{key:1,class:"uni-data-tree-dialog"},[e.createElementVNode("view",{class:"uni-popper__arrow"}),e.createElementVNode("view",{class:"dialog-caption"},[e.createElementVNode("view",{class:"title-area"},[e.createElementVNode("text",{class:"dialog-title"},e.toDisplayString(n.popupTitle),1)]),e.createElementVNode("view",{class:"dialog-close",onClick:o[3]||(o[3]=(...e)=>i.handleClose&&i.handleClose(...e))},[e.createElementVNode("view",{class:"dialog-close-plus","data-id":"close"}),e.createElementVNode("view",{class:"dialog-close-plus dialog-close-rotate","data-id":"close"})])]),e.createVNode(u,{class:"picker-view",ref:"pickerView",modelValue:t.dataValue,"onUpdate:modelValue":o[4]||(o[4]=e=>t.dataValue=e),localdata:t.localdata,preload:t.preload,collection:t.collection,field:t.field,orderby:t.orderby,where:t.where,"step-searh":t.stepSearh,"self-field":t.selfField,"parent-field":t.parentField,"managed-mode":!0,map:t.map,ellipsis:n.ellipsis,onChange:i.onchange,onDatachange:i.ondatachange,onNodeclick:i.onnodeclick},null,8,["modelValue","localdata","preload","collection","field","orderby","where","step-searh","self-field","parent-field","map","ellipsis","onChange","onDatachange","onNodeclick"])])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-a67d2d60"]]),ol="/static/info-circle.png",nl={__name:"account_book_form",props:["account_book_id"],setup(o){const l=o,s=!!l.account_book_id,r=e.ref(1),c=e.ref([]),d=uni.getSystemInfoSync();e.ref(d.statusBarHeight);let p=e.ref(""),h=e.ref("");e.ref(1);const g=e.ref(!1),v=e.ref(""),y=e.ref([]),w=[],_=e.computed((()=>[...w,...y.value.map((e=>e.name))])),k=e.ref({isRemind:!1,finalPrice:0,finalTime:""}),N=e.ref(!1),V=e.ref([]);e.ref([]);const x=e.ref([]),S=e.ref({sizeDetail:"",color:"",remark:"",buyDate:"",position:"",shopName:"",headCircumference:"",shoulderWidth:"",makeupArtist:"",arrivalDate:"",additionalValue:""}),C=e=>{const t=e.detail.value;2===t.length?(x.value=[t[0].value,t[1].value],S.value.sizeDetail=t[1].value):(x.value=[],S.value.sizeDetail="")},B=async()=>{const e=uni.getStorageSync("token");try{const t=await uni.request({url:u.value+"/with-state/account-types",method:"GET",header:{Authorization:e}});y.value=t.data.data||[]}catch(a){t("error","at pages/stock/account_book_form/account_book_form.vue:403","获取分类失败:",a)}},D=async()=>{if(!v.value.trim())return void uni.showToast({title:"请输入分类名称",icon:"none"});const e=uni.getStorageSync("token");try{await uni.request({url:u.value+"/with-state/add-account-type",method:"POST",header:{Authorization:e},data:{name:v.value.trim()}}),await B(),v.value="",uni.showToast({title:"添加成功"})}catch(t){uni.showToast({title:"添加失败",icon:"none"})}},I=e.ref(0);function z(e){I.value=e.detail.value}function A(e){let a=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/account-book-detail",method:"GET",header:{Authorization:a},data:{id:e},success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:525",e.data.data),p.value=e.data.data.name,h.value=parseInt(e.data.data.price),r.value=e.data.data.count||1,I.value=_.value.indexOf(e.data.data.type),e.data.data.image_url&&(c.value=e.data.data.image_url.split(",")),k.value={isRemind:e.data.data.is_remind,finalPrice:e.data.data.final_price,finalTime:e.data.data.final_time};const a=e.data.data.type,o=_.value.findIndex((e=>e===a));-1!==o?I.value=o:(t("warn","at pages/stock/account_book_form/account_book_form.vue:547",`未找到分类: ${a}`),I.value=0),S.value={sizeDetail:e.data.data.size_detail||"",color:e.data.data.color||"",remark:e.data.data.remark||"",buyDate:e.data.data.buy_date?new Date(e.data.data.buy_date).toISOString().split("T")[0]:"",position:e.data.data.position||"",shopName:e.data.data.shop_name||"",headCircumference:e.data.data.head_circumference||"",shoulderWidth:e.data.data.shoulder_width||"",makeupArtist:e.data.data.makeup_artist||"",arrivalDate:e.data.data.arrival_date?new Date(e.data.data.arrival_date).toISOString().split("T")[0]:"",additionalValue:e.data.data.additional_value||""},e.data.data.size&&(x.value=[e.data.data.size,e.data.data.size_detail||""]),t("log","at pages/stock/account_book_form/account_book_form.vue:576","f:",k)},fail:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:579",e)}})}e.ref(["请选择","娃衣","娃头","眼珠","假发","娃鞋","其它"]),e.ref({});const P=async e=>{var a;try{const t=await uni.request({url:u.value+`/goods?id=${e.id}`,method:"GET"});if("success"===t.data.status){const e=t.data.data;p.value=e.name,h.value=e.fin_amount+e.sub_amount,r.value=1,(null==(a=e.goods_images)?void 0:a[0])&&(c.value=[e.goods_images[0]])}}catch(o){t("error","at pages/stock/account_book_form/account_book_form.vue:607","获取商品详情失败:",o),uni.showToast({title:"获取商品信息失败",icon:"none"})}};function L(){uni.showModal({title:"提示",content:"确定删除该账本吗？",success:e=>{if(e.confirm){const e=Number(l.account_book_id);if(isNaN(e)||e<=0)return void uni.showToast({title:"参数错误",icon:"none"});uni.request({url:u.value+"/with-state/delete-account-book",method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{id:e},success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:645",e.data.status),"success"===e.data.status?(uni.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>uni.navigateBack()),500)):uni.showToast({title:e.data.msg||"删除失败",icon:"none"})},fail:e=>{t("error","at pages/stock/account_book_form/account_book_form.vue:660","请求失败:",e),uni.showToast({title:"网络错误",icon:"none"})}})}}})}async function $(){uni.chooseImage({count:9,success:async e=>{const a=e.tempFilePaths;for(const n of a)try{const e=await fe(),a=await ye(n,e.token,e.path);if(t("log","at pages/stock/account_book_form/account_book_form.vue:686","res:",a),200===a.qiniuRes.statusCode){const t=m+e.path;c.value.push(t)}else t("error","at pages/stock/account_book_form/account_book_form.vue:691","上传失败:",n)}catch(o){t("error","at pages/stock/account_book_form/account_book_form.vue:694","上传错误:",o)}uni.showToast({title:`上传了${a.length}张图片`,icon:"success"})}})}function F(){M()&&(s?function(){let e={name:p.value,price:parseInt(h.value,10),count:parseInt(r.value,10),type:_.value[I.value],image_url:c.value.join(","),id:parseInt(l.account_book_id,10),is_remind:k.value.isRemind,final_price:parseInt(k.value.finalPrice,10),final_time:k.value.finalTime,size:x.value[0]||"",size_detail:S.value.sizeDetail||"",color:S.value.color,remark:S.value.remark,buy_date:S.value.buyDate,position:S.value.position,shop_name:S.value.shopName,head_circumference:S.value.headCircumference,shoulder_width:S.value.shoulderWidth,makeup_artist:S.value.makeupArtist,arrival_date:S.value.arrivalDate,additional_value:S.value.additionalValue};uni.request({url:u.value+"/with-state/update-account-book",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:869",e.data),"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}():function(){let e={name:p.value,price:parseInt(h.value,10),count:parseInt(r.value,10),type:_.value[I.value],image_url:c.value.join(","),is_remind:k.value.isRemind,final_price:parseInt(k.value.finalPrice,10),final_time:k.value.finalTime,size:x.value[0]||"",size_detail:S.value.sizeDetail||"",color:S.value.color,remark:S.value.remark,buy_date:S.value.buyDate,position:S.value.position,shop_name:S.value.shopName,head_circumference:S.value.headCircumference,shoulder_width:S.value.shoulderWidth,makeup_artist:S.value.makeupArtist,arrival_date:S.value.arrivalDate,additional_value:S.value.additionalValue};t("log","at pages/stock/account_book_form/account_book_form.vue:804","提交数据:",e),uni.request({url:u.value+"/with-state/add-account-book",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{t("log","at pages/stock/account_book_form/account_book_form.vue:814",e.data),"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}())}f().then((e=>{s?(A(l.account_book_id),uni.setNavigationBarTitle({title:"编辑账本"})):uni.setNavigationBarTitle({title:"新增账本"})}));const M=()=>r.value<=0?(uni.showToast({title:"个数必须大于0",icon:"none"}),!1):!(k.value.isRemind&&(!k.value.finalPrice||k.value.finalPrice<=0))||(uni.showToast({title:"请输入正确的尾款金额",icon:"none"}),!1);n((async()=>{await f(),await B(),await(async()=>{try{const e=await uni.request({url:u.value+"/sizes",method:"GET"});if("success"===e.data.status){const t=e.data.data,a=[];for(const[e,o]of Object.entries(t))a.push({text:e,value:e,children:o.map((e=>({text:e,value:e})))});V.value=a}}catch(e){t("error","at pages/stock/account_book_form/account_book_form.vue:358","获取尺寸数据失败:",e),uni.showToast({title:"获取尺寸数据失败",icon:"none"})}})(),s?(await A(l.account_book_id),uni.setNavigationBarTitle({title:"编辑账本"})):uni.setNavigationBarTitle({title:"新增账本"})}));return i((async e=>{if(t("log","at pages/stock/account_book_form/account_book_form.vue:982","接收到的参数:",e),e.goods_id)try{(e=>{p.value=e.name;const t=e.total_amount?e.total_amount:(parseFloat(e.sub_amount)||0)+(parseFloat(e.fin_amount)||0);h.value=t,e.goods_images&&e.goods_images.length>0&&(c.value=[e.goods_images[0]]),e.size&&(x.value=[e.size,e.size_detail||""],S.value.sizeDetail=e.size_detail||""),e.currency&&(p.value+=` (${e.currency})`),e.color&&(S.value.color=e.color)})(await(a=e.goods_id,new Promise(((e,o)=>{uni.request({url:u.value+"/goods?id="+a,method:"GET",timeout:5e3,success:t=>{"success"===t.data.status?e(t.data.data):o(new Error(t.data.msg||"获取商品信息失败"))},fail:e=>{t("error","at pages/stock/account_book_form/account_book_form.vue:934","商品详情获取失败",e),o(e)}})}))))}catch(o){t("error","at pages/stock/account_book_form/account_book_form.vue:990","获取商品信息失败:",o),uni.showToast({title:"获取商品信息失败",icon:"none"})}var a})),(o,n)=>{const l=a(e.resolveDynamicComponent("view-logs"),E),i=a(e.resolveDynamicComponent("uni-icons"),b),d=a(e.resolveDynamicComponent("common-modal"),T),m=a(e.resolveDynamicComponent("goods-search"),R),f=a(e.resolveDynamicComponent("uni-data-picker"),al);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(l),e.createElementVNode("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(d,{visible:g.value,"onUpdate:visible":n[1]||(n[1]=e=>g.value=e),top:"100rpx"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"type-modal"},[e.createElementVNode("view",{class:"add-type-form"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>v.value=e),placeholder:"输入新分类名称",class:"type-input"},null,512),[[e.vModelText,v.value]]),e.createElementVNode("button",{class:"add-btn",onClick:D},"添加分类")]),e.createElementVNode("view",{class:"type-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"type-item"},[e.createElementVNode("text",null,e.toDisplayString(a.name),1),e.createVNode(i,{type:"trash",size:"22",color:"#ff6666",onClick:e=>(async e=>{uni.showModal({title:"确认删除",success:async a=>{if(a.confirm){const a=uni.getStorageSync("token");try{const t=(await uni.request({url:u.value+"/with-state/delete-account-type",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{id:e}})).data;"success"===t.status?(await B(),uni.showToast({title:"删除成功"})):uni.showToast({title:t.msg||"删除失败",icon:"none"})}catch(o){t("error","at pages/stock/account_book_form/account_book_form.vue:477","删除失败:",o),uni.showToast({title:o.errMsg||"请求失败",icon:"none"})}}}})})(a.id)},null,8,["onClick"])])))),128))])])])),_:1},8,["visible"]),e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"分类"),e.createElementVNode("view",{class:"type-selector"},[e.createElementVNode("picker",{mode:"selector",class:"form-input",value:I.value,range:_.value,onChange:z},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(_.value[I.value]||"请选择分类"),1)],40,["value","range"]),e.createElementVNode("text",{class:"manage-type",onClick:n[2]||(n[2]=e=>g.value=!0)},"管理分类")])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"名称"),e.createElementVNode("view",{class:"form-input",style:{padding:"0"}},[e.createElementVNode("view",{class:"custom-search-container"},[e.createVNode(m,{"font-size":"24rpx",mode:"fill",onSelect:P,modelValue:e.unref(p),"onUpdate:modelValue":n[3]||(n[3]=t=>e.isRef(p)?p.value=t:p=t),background:"#fff",width:"620rpx","show-icon":!1,class:"custom-search"},null,8,["modelValue"])])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"价值"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit",placeholder:"请输入价值","placeholder-class":"placeholder-style","onUpdate:modelValue":n[4]||(n[4]=t=>e.isRef(h)?h.value=t:h=t)},null,512),[[e.vModelText,e.unref(h)]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"个数"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"number",placeholder:"请输入个数","placeholder-class":"placeholder-style","onUpdate:modelValue":n[5]||(n[5]=e=>r.value=e)},null,512),[[e.vModelText,r.value]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"物品图片"),e.createElementVNode("view",{class:"upload-wrapper"},[e.createElementVNode("view",{class:"image-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"preview-image"},[e.createElementVNode("image",{mode:"aspectFill",src:t,class:"image-preview",onClick:e=>{uni.previewImage({current:c.value.index,urls:c.value})}},null,8,["src","onClick"]),e.createElementVNode("view",{class:"image-actions"},[e.createVNode(i,{type:"close",size:"22",color:"#fff",onClick:e=>function(e,t){t&&t.stopPropagation&&t.stopPropagation(),uni.showModal({title:"删除图片",content:"确定删除这张图片吗？",success:t=>{t.confirm&&c.value.splice(e,1)}})}(a,e),class:"delete-icon"},null,8,["onClick"])])])))),128)),e.createElementVNode("view",{class:"add-image-box",onClick:$},[e.createVNode(i,{type:"plusempty",size:"40",color:"#ccc"}),e.createElementVNode("text",{class:"add-text"},"添加图片")])])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"尺寸"),e.createVNode(f,{placeholder:"请选择尺寸",localdata:V.value,value:x.value,onChange:C,class:"size-picker"},null,8,["localdata","value"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("label",{class:"remind-label",onClick:n[6]||(n[6]=e=>{N.value=!N.value})},[e.createElementVNode("view",{class:e.normalizeClass(["arrow-icon",{"arrow-down":N.value}])},null,2),e.createElementVNode("text",null,"更多信息")])]),N.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"more-info-form"},[e.createElementVNode("view",{class:"form-item size_detail"},[e.createElementVNode("text",{class:"form-label"},"尺寸详情"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[7]||(n[7]=e=>S.value.sizeDetail=e),placeholder:"请输入尺寸详情",class:"form-input"},null,512),[[e.vModelText,S.value.sizeDetail]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"颜色"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[8]||(n[8]=e=>S.value.color=e),placeholder:"请输入颜色",class:"form-input"},null,512),[[e.vModelText,S.value.color]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"店名"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[9]||(n[9]=e=>S.value.shopName=e),placeholder:"请输入店名",class:"form-input"},null,512),[[e.vModelText,S.value.shopName]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"头围"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[10]||(n[10]=e=>S.value.headCircumference=e),placeholder:"请输入头围(cm)",class:"form-input",type:"digit"},null,512),[[e.vModelText,S.value.headCircumference]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"肩宽"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[11]||(n[11]=e=>S.value.shoulderWidth=e),placeholder:"请输入肩宽(cm)",class:"form-input",type:"digit"},null,512),[[e.vModelText,S.value.shoulderWidth]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"妆师"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[12]||(n[12]=e=>S.value.makeupArtist=e),placeholder:"请输入妆师",class:"form-input"},null,512),[[e.vModelText,S.value.makeupArtist]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"备注"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[13]||(n[13]=e=>S.value.remark=e),placeholder:"请输入备注",class:"form-input"},null,512),[[e.vModelText,S.value.remark]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"购入时间"),e.createElementVNode("view",{class:"date-picker-wrapper"},[e.createElementVNode("picker",{mode:"date",value:S.value.buyDate,onChange:n[14]||(n[14]=e=>S.value.buyDate=e.detail.value)},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(S.value.buyDate||"选择购入日期"),1)],40,["value"])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"到家日期"),e.createElementVNode("view",{class:"date-picker-wrapper"},[e.createElementVNode("picker",{mode:"date",value:S.value.arrivalDate,onChange:n[15]||(n[15]=e=>S.value.arrivalDate=e.detail.value)},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(S.value.arrivalDate||"选择到家日期"),1)],40,["value"])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"附加值（妆费或h了多少入）"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[16]||(n[16]=e=>S.value.additionalValue=e),placeholder:"请输入附加值",class:"form-input",type:"digit"},null,512),[[e.vModelText,S.value.additionalValue]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"存放位置"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[17]||(n[17]=e=>S.value.position=e),placeholder:"请输入存放位置",class:"form-input"},null,512),[[e.vModelText,S.value.position]])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("label",{class:"remind-label",onClick:n[18]||(n[18]=e=>(k.value.isRemind=!k.value.isRemind,void(k.value.isRemind||(k.value.finalPrice=0,k.value.finalTime=""))))},[e.createElementVNode("view",{class:e.normalizeClass(["arrow-icon",{"arrow-down":k.value.isRemind}])},null,2),e.createElementVNode("text",null,"需要补款提醒"),k.value.finalPrice>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"remind-dot"})):e.createCommentVNode("",!0)])]),k.value.isRemind?(e.openBlock(),e.createElementBlock("view",{key:1,class:"remind-form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"尾款金额"),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":n[19]||(n[19]=e=>k.value.finalPrice=e),placeholder:"请输入待补款金额",class:"form-input"},null,512),[[e.vModelText,k.value.finalPrice]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"补款日期"),e.createElementVNode("view",{class:"date-picker-wrapper"},[e.createElementVNode("picker",{mode:"date",value:k.value.finalTime,onChange:n[20]||(n[20]=e=>k.value.finalTime=e.detail.value)},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(k.value.finalTime||"选择截止日期"),1)],40,["value"])])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"info-text"},[e.createElementVNode("image",{src:ol,mode:"aspectFill"}),e.createElementVNode("text",null,"仅用于记录您所购买过的物品，其他人不会看到")]),e.createElementVNode("view",{class:"button-group"},[e.unref(s)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"delete-button",onClick:L}," 删除账本 ")):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"submit-button",onClick:F}," 记录"+e.toDisplayString(e.unref(s)?"修改":"新增"),1)])])])],64)}}},ll=V(nl,[["__scopeId","data-v-3e40943f"]]),sl=V({__name:"common-name-picker",props:{dataList:{type:Array,default:()=>[]},placeholder:{type:String,default:"请选择"},defaultValue:{type:String,default:""}},emits:["select"],setup(o,{emit:n}){const l=o,s=n,i=e.ref(!1),r=e.ref(l.defaultValue),c=()=>{i.value=!i.value};return e.onMounted((()=>{t("log","at components/common-name-picker/common-name-picker.vue:69","初始值",i.value),i.value=!1})),(t,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"select-container",ref:"containerRef"},[e.createElementVNode("view",{class:"select-input",onClick:c},[e.createElementVNode("text",{class:"selected-value"},e.toDisplayString(r.value||o.placeholder),1),e.createElementVNode("view",{class:e.normalizeClass(["arrow-icon",{rotate:i.value}])},[e.createVNode(l,{type:"arrowdown",size:"16",color:"#666"})],2)]),e.createElementVNode("view",{class:"popup-container"},[i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"mask",onClick:n[0]||(n[0]=e=>c())})):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"options-wrapper"},[e.createElementVNode("scroll-view",{"scroll-y":"true",class:"select-options"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.dataList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["option-item",{selected:r.value===t}]),onClick:e.withModifiers((e=>(e=>{r.value=e,i.value=!1,s("select",e)})(t)),["stop"])},[e.createTextVNode(e.toDisplayString(t)+" ",1),r.value===t?(e.openBlock(),e.createBlock(l,{key:0,type:"checkmarkempty",size:"18",color:"#007AFF",class:"check-icon"})):e.createCommentVNode("",!0)],10,["onClick"])))),128))])])):e.createCommentVNode("",!0)])],512)}}},[["__scopeId","data-v-351df181"]]),il=V({__name:"custom-picker",props:{dataList:{type:Array,required:!0},margin:{type:String,default:"0"}},emits:["select"],setup(t,{emit:a}){const o=t,n=a,l=e.ref(""),s=e.ref(!1),i=e.computed((()=>o.dataList.filter((e=>e.name.toLowerCase().includes(l.value.toLowerCase()))))),r=()=>{n("select",0,l.value)},c=()=>{s.value=!s.value};return(a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"custom-select"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),onClick:c,onInput:r,placeholder:"请选择或输入",class:"select-input",style:e.normalizeStyle({margin:t.margin})},null,36),[[e.vModelText,l.value]]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"dropdown"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,onClick:e=>(e=>{l.value=e.name,s.value=!1,n("select",e.id,e.name)})(t),class:"dropdown-item"},e.toDisplayString(t.name),9,["onClick"])))),128))])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-795dad92"]]),rl=V({__name:"relation-picker",props:{typeList:{type:Array,default:()=>[]},visible:{type:Boolean,default:!1},hideType:{type:Boolean,default:!1}},emits:["update:visible","confirm","cancel"],setup(o,{emit:n}){const l=o,s=n,i=e.ref([]),r=e.ref(),c=e.ref(),d=e.ref(),m=e.ref(),p=e.ref(!1),h=e.ref(!0),g=e.ref({type:null,brand:{id:0,name:""},goods:{id:0,name:"",image:""}}),v=e.ref(""),f=e=>{h.value=e,w(),g.value={type:null,brand:{id:0,name:""},goods:{id:0,name:"",image:""}}},y=e=>{const t={type:r,brand:c,goods:d,fuzzy:m};Object.entries(t).forEach((([t,a])=>{var o;t!==e&&(null==(o=a.value)?void 0:o.close)&&a.value.close()}))},w=()=>{[r,c,d,m].forEach((e=>{var t;(null==(t=e.value)?void 0:t.reset)&&e.value.reset()}))},_=async e=>{var a;try{if(!(null==e?void 0:e.id))return v.value=e.name,void(g.value={type:"未知类型",brand:{id:0,name:""},goods:{id:0,name:e.name,image:""}});const t=await V(e.id);v.value=e.name,g.value={type:t.type||"未知类型",brand:{id:t.brand_id||0,name:t.brand_name||""},goods:{id:e.id,name:e.name,image:(null==(a=null==t?void 0:t.goods_images)?void 0:a[0])||""}}}catch(o){t("error","at components/relation-picker/relation-picker.vue:206","商品信息获取失败",o),uni.showToast({title:"详细信息获取失败，已保存基本信息",icon:"none"}),v.value=e.name,g.value={type:"未知类型",brand:{id:0,name:""},goods:{id:(null==e?void 0:e.id)||0,name:e.name,image:""}}}},k=()=>{p.value=!1,v.value="",w(),e.nextTick((()=>{g.value={type:null,brand:{id:0,name:""},goods:{id:0,name:"",image:""}}}))};e.watch((()=>l.visible),(e=>{p.value=e})),e.watch(p,(e=>{s("update:visible",e)}));const E=e=>{p.value=e,e||k()},N=e=>{g.value.type=e},V=e=>new Promise(((a,o)=>{uni.request({url:u.value+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{a(e.data.data)},fail:e=>{t("error","at components/relation-picker/relation-picker.vue:290","商品详情获取失败",e),o(e)}})})),x=(e,a)=>{g.value.brand={id:e||0,name:a},e&&function(e){uni.request({url:u.value+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{t("log","at components/relation-picker/relation-picker.vue:371",e.data.data),i.value=e.data.data,t("log","at components/relation-picker/relation-picker.vue:373",i.value)},fail:e=>{t("log","at components/relation-picker/relation-picker.vue:377",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}(e)},S=async(e,a)=>{var o;try{if(g.value.goods={id:e||0,name:a,image:""},e&&0!==e){const t=await V(e);g.value.goods.image=(null==(o=null==t?void 0:t.goods_images)?void 0:o[0])||""}}catch(n){t("error","at components/relation-picker/relation-picker.vue:356","商品信息获取失败",n),uni.showToast({title:"图片信息获取失败，已保存基本信息",icon:"none"})}};const C=async()=>{var e,a;try{let n=null;if(h.value)if(g.value.goods.id&&0!==g.value.goods.id)try{const t=await V(g.value.goods.id);n={isFuzzy:!0,keyword:v.value,goods:{id:t.id||g.value.goods.id,name:t.goods_name||g.value.goods.name,image:(null==(e=null==t?void 0:t.goods_images)?void 0:e[0])||""},brand:{id:t.brand_id||0,name:t.brand_name||""},type:t.type||"未知类型"}}catch(o){t("error","at components/relation-picker/relation-picker.vue:439","商品信息获取失败，使用缓存数据",o),n={isFuzzy:!0,keyword:v.value,goods:g.value.goods,brand:g.value.brand,type:g.value.type||"未知类型"}}else n={isFuzzy:!0,keyword:v.value,goods:{id:0,name:v.value,image:""},brand:{id:0,name:""},type:"未知类型"};else{if(t("log","at components/relation-picker/relation-picker.vue:469","jjjjjjjjjjjjjjjj"),g.value.goods.id&&0!==g.value.goods.id)try{const e=await V(g.value.goods.id);g.value.goods.image=(null==(a=null==e?void 0:e.goods_images)?void 0:a[0])||"",g.value.type=e.type||g.value.type}catch(o){t("error","at components/relation-picker/relation-picker.vue:478","商品信息获取失败，使用缓存数据",o)}if(!g.value.type)throw new Error("请选择商品类型");if(!g.value.brand.name)throw new Error("请填写或选择品牌");if(!g.value.goods.name)throw new Error("请填写或选择商品");n={isFuzzy:!1,type:g.value.type,brand:g.value.brand,goods:g.value.goods}}t("log","at components/relation-picker/relation-picker.vue:494","确认数据:",n),s("confirm",n),k()}catch(o){uni.showToast({title:o.message,icon:"none"})}},B=()=>{s("cancel"),k()};return(t,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b),s=a(e.resolveDynamicComponent("common-name-picker"),sl),u=a(e.resolveDynamicComponent("common-search"),q),g=a(e.resolveDynamicComponent("custom-picker"),il),w=a(e.resolveDynamicComponent("goods-search"),R),k=a(e.resolveDynamicComponent("common-modal"),T);return e.openBlock(),e.createBlock(k,{visible:p.value,"onUpdate:visible":E,top:"200rpx"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"relation-picker-container"},[e.createElementVNode("view",{class:"picker-header"},[e.createElementVNode("view",{class:"mode-switch"},[h.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"switch-btn precision-mode",onClick:n[0]||(n[0]=e=>f(!1))},[e.createVNode(l,{type:"search",size:"18",color:"#fff"}),e.createElementVNode("text",null,"切换到精确关联")])):e.createCommentVNode("",!0),h.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"switch-btn fuzzy-mode",onClick:n[1]||(n[1]=e=>f(!0))},[e.createVNode(l,{type:"list",size:"18",color:"#fff"}),e.createElementVNode("text",null,"切换到模糊关联")]))])]),e.createElementVNode("view",{class:"picker-body"},[h.value?(e.openBlock(),e.createBlock(w,{key:1,ref_key:"fuzzySearch",ref:m,mode:"fill",onSelect:_,modelValue:v.value,"onUpdate:modelValue":n[5]||(n[5]=e=>v.value=e),width:"550rpx",onToggle:n[6]||(n[6]=e=>y("fuzzy")),class:"fuzzy-search"},null,8,["modelValue"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o.hideType?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(s,{key:0,ref_key:"typePicker",ref:r,dataList:o.typeList,onSelect:N,onToggle:n[2]||(n[2]=e=>y("type")),class:"type-picker"},null,8,["dataList"])),e.createVNode(u,{ref_key:"brandSearch",ref:c,background:"#f8f8f8",mode:"fill",onSelect:x,onToggle:n[3]||(n[3]=e=>y("brand")),class:"brand-search",style:{padding:"0px!important"}},null,512),e.createVNode(g,{ref_key:"goodsPicker",ref:d,background:"#f8f8f8",dataList:i.value,onSelect:S,onToggle:n[4]||(n[4]=e=>y("goods")),class:"goods-picker"},null,8,["dataList"])],64))]),e.createElementVNode("view",{class:"picker-footer"},[e.createElementVNode("button",{class:"cancel-btn",onClick:B},"取消"),e.createElementVNode("button",{class:"confirm-btn",onClick:C},"确认")])])])),_:1},8,["visible"])}}},[["__scopeId","data-v-e66ac03c"]]),cl="/static/add2.png",ul=V({__name:"showcase_form",props:["showcase_id"],setup(o){const n=o,l=e.ref([]),s=e.ref([]),r=e.ref([]),c=e.ref(!1);e.ref(""),e.ref(0),e.ref(""),e.ref(0),e.ref("");const d=e=>{try{const t={goods_id:e.goods.id||0,goods_name:e.goods.name,goods_image:e.goods.image||"",brand_id:e.brand.id||0,brand_name:e.brand.name||(e.isFuzzy?"":"未知品牌"),type:e.type||(e.isFuzzy?"未知类型":"")};k.value.some((e=>0!==e.goods_id&&e.goods_id===t.goods_id||e.goods_name===t.goods_name))?uni.showToast({title:"已存在相同关联项",icon:"none"}):k.value.push(t)}catch(a){t("error","at pages/stock/showcase_form/showcase_form.vue:157","保存关联数据失败:",a),uni.showToast({title:"保存关联信息失败",icon:"none"})}},p=()=>{t("log","at pages/stock/showcase_form/showcase_form.vue:166","用户取消选择")},h=()=>{c.value=!0},g=e.computed((()=>[-1,1,3].includes(_.value))),v=e.computed((()=>n.showcase_id>0)),f=e.ref(""),w=e.ref(""),_=e.ref(-1);const k=e.ref([]);function N(e){uni.previewImage({current:l.value[e],urls:l.value})}async function V(){uni.showModal({title:"确认删除",content:"确定要删除这个展示吗？",success:async e=>{if(e.confirm)try{"success"===(await uni.request({url:`${u.value}/with-state/delete-showcase?id=`+n.showcase_id,method:"POST",header:{Authorization:uni.getStorageSync("token")}})).data.status&&(uni.showToast({title:"删除成功"}),setTimeout((()=>uni.navigateBack()),1e3))}catch(t){uni.showToast({title:"删除失败",icon:"none"})}}})}async function b(){if(!uni.getStorageSync("token"))return void uni.showToast({title:"请先登录",icon:"none"});if(!f.value.trim()||!w.value.trim())return void uni.showToast({title:"标题和正文不能为空",icon:"none"});if(0===l.value.length)return void uni.showToast({title:"请至少上传一张图片",icon:"none"});let e=y(),a={name:f.value,description:w.value,image_urls:l.value.join(","),display:_.value,origin:e,relations:k.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:2})))};try{let e=`${u.value}/with-state/add-showcase`;n.showcase_id&&(e=`${u.value}/with-state/update-showcase`,a={...a,id:parseInt(n.showcase_id,10)});if("failed"===(await uni.request({url:e,method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:uni.getStorageSync("token")}})).data.code)return void uni.showToast({title:"提交失败",icon:"none"});uni.showToast({title:"提交成功"}),setTimeout((()=>uni.navigateBack()),1500)}catch(o){t("log","at pages/stock/showcase_form/showcase_form.vue:408",o),uni.showToast({title:"提交失败",icon:"none"})}}return uni.setNavigationBarTitle({title:"展示柜"}),i((async e=>{if(e.goods_id&&e.goods_name&&e.brand_id&&e.brand_name&&e.type){let n="";try{n=(await(a=parseInt(e.goods_id),new Promise(((e,o)=>{uni.request({url:u.value+"/goods?id="+a,method:"GET",timeout:5e3,success:a=>{t("log","at pages/stock/showcase_form/showcase_form.vue:198",a.data.data),e(a.data)},fail:e=>{t("log","at pages/stock/showcase_form/showcase_form.vue:202",e),uni.showToast({title:"网络请求失败",icon:"none"}),o(e)},complete:()=>{uni.hideLoading()}})})))).data.goods_images[0]||""}catch(o){t("error","at pages/stock/showcase_form/showcase_form.vue:522","获取商品图片失败:",o)}k.value.push({brand_id:parseInt(e.brand_id,10),goods_id:parseInt(e.goods_id,10),brand_name:e.brand_name,goods_name:e.goods_name,goods_image:n,type:e.type})}var a;uni.request({url:u.value+"/goods-types",method:"GET",timeout:5e3,success:e=>{t("log","at pages/stock/showcase_form/showcase_form.vue:428",e.data.data),r.value=e.data.data},fail:e=>{t("log","at pages/stock/showcase_form/showcase_form.vue:432",e),uni.showToast({title:"网络请求失败",icon:"none"})}}),async function(){var e;if(n.showcase_id)try{const a=(await uni.request({url:`${u.value}/with-state/showcase-detail?id=${n.showcase_id}`,method:"GET",header:{Authorization:uni.getStorageSync("token")}})).data.data;f.value=a.name,w.value=a.description,_.value=a.display,l.value=(null==(e=a.image_urls)?void 0:e.split(","))||[],t("log","at pages/stock/showcase_form/showcase_form.vue:239",a),a.relations&&(k.value=a.relations.map((e=>({goods_id:e.relation_goods_id,goods_name:e.relation_goods_name,brand_id:e.relation_brand_id,brand_name:e.relation_brand_name,type:e.type,goods_image:e.relation_goods_image}))))}catch(a){uni.showToast({title:"加载失败",icon:"none"})}}()})),(o,n)=>{const i=a(e.resolveDynamicComponent("view-logs"),E),u=a(e.resolveDynamicComponent("relation-picker"),rl);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(i),g.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"edit-tip"},[e.createElementVNode("text",null,"当前状态不可编辑")])),e.createElementVNode("view",{style:{width:"100%",overflow:"hidden"}},[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload_item",key:a},[e.createElementVNode("image",{src:t,class:"uploaded_image",onClick:N,mode:"aspectFill"},null,8,["src"]),g.value?(e.openBlock(),e.createElementBlock("image",{key:0,src:F,class:"close_icon",onClick:e=>function(e){l.value.splice(e,1)}(a)},null,8,["onClick"])):e.createCommentVNode("",!0)])))),128)),g.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},[e.createElementVNode("image",{src:cl,class:"upload_img",onClick:n[0]||(n[0]=e=>async function(){try{const e=await ve(9);for(const t of e){const e=await fe();await ye(t,e.token,e.path),l.value.push(m+e.path)}uni.showToast({title:`成功上传${e.length}张图片`,icon:"success"})}catch(e){t("error","at pages/stock/showcase_form/showcase_form.vue:289","上传出错:",e),uni.showToast({title:"部分图片上传失败",icon:"none"})}}(o.index)),style:{width:"50px",height:"50px",margin:"25px"}})])):e.createCommentVNode("",!0)])]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>f.value=e),type:"text",disabled:!g.value,placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["disabled"]),[[e.vModelText,f.value]]),e.createElementVNode("view",{class:"oneLine"}),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>w.value=e),disabled:!g.value,placeholder:"请输入描述",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["disabled"]),[[e.vModelText,w.value]]),e.createElementVNode("view",{class:"oneLine"}),e.createElementVNode("view",{class:""},[g.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"relation-trigger",onClick:h},[e.createElementVNode("text",{class:"placeholder"},"点击关联娃物"),e.createElementVNode("image",{src:_e,class:"arrow-icon"})])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"publish-detail"},[e.createElementVNode("text",null,"* 展示您的宝宝们 。"),e.createElementVNode("text",null,"* 不关联商品的展示柜不会出现在广场中。")]),e.createElementVNode("view",{class:"saveCollocationDataList"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[e.createElementVNode("view",{class:"saveCollocationDataItem"},[t.goods_image?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-image"},"?")),e.createElementVNode("text",{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},e.toDisplayString(t.type)+" "+e.toDisplayString(t.brand_name)+" - "+e.toDisplayString(t.goods_name),1),g.value?(e.openBlock(),e.createElementBlock("image",{key:2,src:F,class:"close_icon",onClick:e=>function(e){k.value.splice(e,1)}(a)},null,8,["onClick"])):e.createCommentVNode("",!0)])])))),128))]),e.createVNode(u,{visible:c.value,"onUpdate:visible":n[3]||(n[3]=e=>c.value=e),typeList:r.value,goodsList:s.value,onConfirm:d,onCancel:p},null,8,["visible","typeList","goodsList"]),e.createElementVNode("view",{class:"footer"},[v.value?(e.openBlock(),e.createElementBlock("button",{key:0,onClick:V,class:"delete-btn"},"删除")):e.createCommentVNode("",!0),e.createElementVNode("button",{onClick:b},"发表")])])}}},[["__scopeId","data-v-abf6107e"]]),dl={__name:"bill_form",props:["bill_id"],setup(o){const n=o,l=e.ref({}),s=!!n.bill_id,r=e.ref(""),c=e.ref(""),d=e.ref(""),m=e.ref(0),p=["未补款","已补款"];i((e=>{l.value=e,e.name&&(r.value=decodeURIComponent(e.name)),e.amount&&(c.value=e.amount)}));const h=e.ref("");function g(e){const t=e.detail.value;d.value=t,h.value=f(t)}function v(){uni.showModal({title:"提示",content:"确定删除该账单吗？",success:e=>{e.confirm&&uni.request({url:u.value+"/with-state/delete-tail-bill?id="+parseInt(n.bill_id,10),method:"POST",header:{Authorization:uni.getStorageSync("token")},success:e=>{"success"==e.data.status?(uni.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}})}function f(e){let t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}function y(e){m.value=e.detail.value}function w(){s?function(){let e={id:parseInt(n.bill_id,10),name:r.value,price:parseFloat(c.value),ymd:d.value,status:m.value};uni.request({url:u.value+"/with-state/update-tail-bill",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}():function(){let e={name:r.value,price:parseFloat(c.value),ymd:d.value,status:m.value};uni.request({url:u.value+"/with-state/add-tail-bill",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:e,success:e=>{"success"==e.data.status?(uni.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),500)):uni.showToast({title:e.data.msg,icon:"none"})}})}()}return e.onMounted((()=>{s?(!function(e){let a=uni.getStorageSync("token");uni.request({url:u.value+"/with-state/tail-bill-detail",method:"GET",header:{Authorization:a},data:{id:e},success:e=>{r.value=e.data.data.name,c.value=e.data.data.price,d.value=e.data.data.ymd,m.value=e.data.data.status,h.value=f(e.data.data.ymd)},fail:e=>{t("log","at pages/stock/bill_form/bill_form.vue:141",e)}})}(n.bill_id),uni.setNavigationBarTitle({title:"编辑账单"})):uni.setNavigationBarTitle({title:"新增账单"})})),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(n),e.createElementVNode("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单名称"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"text",placeholder:"请输入名称","placeholder-class":"placeholder-style","onUpdate:modelValue":o[0]||(o[0]=e=>r.value=e)},null,512),[[e.vModelText,r.value]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单金额"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit",placeholder:"请输入金额","placeholder-class":"placeholder-style","onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e)},null,512),[[e.vModelText,c.value]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单日期"),e.createElementVNode("view",{style:{padding:"0px 10px",border:"1px solid #e6e6e6","border-radius":"10px"}},[e.createElementVNode("picker",{mode:"date",value:h.value,onChange:g},[e.createElementVNode("view",{class:"picker-content",style:{color:"#2c2c2c","font-size":"26rpx"}},e.toDisplayString(h.value||"请选择日期"),1)],40,["value"])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"账单状态"),e.createElementVNode("view",{style:{padding:"0px 10px",border:"1px solid #e6e6e6","border-radius":"10px"}},[e.createElementVNode("picker",{mode:"selector",value:m.value,range:p,onChange:y},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(p[m.value]||"请选择状态"),1)],40,["value"])])]),e.createElementVNode("view",{style:{overflow:"hidden"}},[e.createElementVNode("image",{src:ol,mode:"aspectFill",style:{width:"28rpx",height:"28rpx","margin-right":"10rpx",position:"relative",top:"3rpx"}}),e.createElementVNode("text",{style:{color:"#888"}},"仅用于您的记账，其他人不会看到")])]),e.createElementVNode("view",{class:"button-group"},[e.createElementVNode("button",{class:"submit-button",onClick:w}," 记录"+e.toDisplayString(e.unref(s)?"修改":"新增"),1),e.unref(s)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"delete-button",onClick:v}," 删除账单 ")):e.createCommentVNode("",!0)])])],64)}}},ml=V(dl,[["__scopeId","data-v-d5013885"]]),pl={__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type","collocation_id"],setup(o){const n=o,l=e.ref(!1),s=e.ref([]),i=e.ref([]),r=e.ref([]),c=e.ref(!1),d=e.ref([]),p=e.ref(""),h=e.ref("");e.onMounted((()=>{var e;uni.request({url:u.value+"/goods-types",method:"GET",timeout:5e3,success:e=>{e.data&&e.data.data&&(r.value=e.data.data)},fail:e=>{t("log","at pages/collocation/collocation.vue:371",e),uni.showToast({title:"获取商品类型失败",icon:"none"})}}),n.collocation_id&&(l.value=!0,async function(){if(n.collocation_id)try{const e=await uni.request({url:`${u.value}/view-collocation?collocation_id=${n.collocation_id}&origin=1`,method:"GET",timeout:5e3});if("success"===e.data.status){const t=e.data.data;p.value=t.title||"",h.value=t.content||"",s.value=t.image_url_list||[],t.collocation_relation_list&&t.collocation_relation_list.length>0&&(d.value=t.collocation_relation_list.map((e=>({goods_id:e.relation_goods_id,goods_name:e.relation_goods_name,brand_id:e.relation_brand_id,brand_name:e.relation_brand_name,type:e.type,goods_image:e.relation_goods_image||""}))))}}catch(e){t("error","at pages/collocation/collocation.vue:122","获取搭配详情失败:",e),uni.showToast({title:"加载搭配详情失败",icon:"none"})}}()),n.goods_id&&n.goods_name&&n.brand_id&&n.brand_name&&n.type&&(e=n.goods_id,new Promise(((a,o)=>{uni.request({url:u.value+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{a(e.data)},fail:e=>{t("log","at pages/collocation/collocation.vue:217",e),uni.showToast({title:"网络请求失败",icon:"none"}),o(e)}})}))).then((e=>{let t={brand_id:parseInt(n.brand_id,10),goods_id:parseInt(n.goods_id,10),brand_name:n.brand_name,goods_name:n.goods_name,goods_image:e.data.goods_images[0],type:n.type};d.value.some((e=>e.goods_id===t.goods_id&&e.brand_id===t.brand_id))||d.value.push(t)}))}));const g=e=>{try{const t={goods_id:e.goods.id||0,goods_name:e.goods.name,goods_image:e.goods.image||"",brand_id:e.brand.id||0,brand_name:e.brand.name||(e.isFuzzy?"":"未知品牌"),type:e.type||(e.isFuzzy?"未知类型":"")};d.value.some((e=>0!==e.goods_id&&e.goods_id===t.goods_id||e.goods_name===t.goods_name))?uni.showToast({title:"已存在相同关联项",icon:"none"}):d.value.push(t)}catch(a){t("error","at pages/collocation/collocation.vue:189","保存关联数据失败:",a),uni.showToast({title:"保存关联信息失败",icon:"none"})}},v=()=>{t("log","at pages/collocation/collocation.vue:199","用户取消选择")},f=()=>{c.value=!0};async function y(){try{const e=9-s.value.length;if(e<=0)return void uni.showToast({title:"最多只能上传9张图片",icon:"none"});const t=await ve(e);for(const a of t){const e=await fe();await ye(a,e.token,e.path),s.value.push(m+e.path)}uni.showToast({title:`成功上传${t.length}张图片`,icon:"success"})}catch(e){t("error","at pages/collocation/collocation.vue:268","上传出错:",e),uni.showToast({title:"部分图片上传失败",icon:"none"})}}async function w(){const e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});if(!p.value.trim())return void uni.showToast({title:"标题不能为空",icon:"none"});if(0===s.value.length)return void uni.showToast({title:"请至少上传一张图片",icon:"none"});const a={title:p.value,content:h.value,image_url_list:s.value,relations:d.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:1})))};l.value&&(a.collocation_id=parseInt(n.collocation_id));try{const t=l.value?u.value+"/with-state/update-collocation":u.value+"/with-state/add-collocation",o=await uni.request({url:t,method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:e},timeout:8e3});"success"===o.data.status?(uni.showToast({title:l.value?"更新成功":"提交成功"}),setTimeout((()=>uni.navigateBack()),1500)):uni.showToast({title:o[1].data.msg||(l.value?"更新失败":"提交失败"),icon:"none"})}catch(o){t("log","at pages/collocation/collocation.vue:351",o),uni.showToast({title:"网络请求失败",icon:"none"})}}return(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E),u=a(e.resolveDynamicComponent("relation-picker"),rl);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(n),e.createElementVNode("view",{style:{width:"100%",overflow:"hidden"}},[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload_item",key:a},[e.createElementVNode("image",{src:t,class:"uploaded_image",onClick:e=>function(e){uni.previewImage({current:s.value[e],urls:s.value})}(a),mode:"aspectFill"},null,8,["src","onClick"]),e.createElementVNode("image",{src:F,class:"close_icon",onClick:e=>function(e){s.value.splice(e,1)}(a)},null,8,["onClick"])])))),128)),s.value.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},[e.createElementVNode("image",{src:cl,class:"upload_img",onClick:y,style:{width:"50px",height:"50px",margin:"25px"}})])):e.createCommentVNode("",!0)])]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>p.value=e),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,512),[[e.vModelText,p.value]]),e.createElementVNode("view",{class:"oneLine"}),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":o[1]||(o[1]=e=>h.value=e),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,512),[[e.vModelText,h.value]]),e.createElementVNode("view",{class:"oneLine"}),e.createElementVNode("view",{class:""},[e.createElementVNode("view",{class:"relation-trigger",onClick:f},[e.createElementVNode("text",{class:"placeholder"},"点击关联娃物"),e.createElementVNode("image",{src:_e,class:"arrow-icon"})])]),e.createElementVNode("view",{class:"publish-detail"},[e.createElementVNode("text",null,"* 分享您对于打扮BJD的想法✨。"),e.createElementVNode("text",null,"* 不关联商品的搭配不会出现在广场中。"),e.createElementVNode("text",null,"* 可以是BJD相关的贩售广告，但不可以滥用关联。")]),e.createElementVNode("view",{class:"saveCollocationDataList"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[e.createElementVNode("view",{class:"saveCollocationDataItem"},[t.goods_image?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-image"},"?")),e.createElementVNode("text",{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},e.toDisplayString(t.type)+" "+e.toDisplayString(t.brand_name)+" - "+e.toDisplayString(t.goods_name),1),e.createElementVNode("image",{src:F,class:"close_icon",onClick:e=>function(e){d.value.splice(e,1)}(a)},null,8,["onClick"])])])))),128))]),e.createVNode(u,{visible:c.value,"onUpdate:visible":o[2]||(o[2]=e=>c.value=e),typeList:r.value,goodsList:i.value,onConfirm:g,onCancel:v},null,8,["visible","typeList","goodsList"]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("button",{onClick:w},e.toDisplayString(l.value?"更新":"提交"),1)])])}}},hl=V({__name:"collocation_share",props:{collocation_id:{type:String,default:0},origin:{type:String,default:0}},setup(o){const l=e.ref({title:"",content:"",image_url_list:[],collocation_relation_list:[]}),s=e.ref({userName:"",avatar:""});uni.getSystemInfoSync();const r=e.ref(!0),c=e.ref(!1),d=e.ref(""),m=e.ref(0),p=e.ref(0);let g=e.ref(!1);const v=e.ref(null),y=e.ref(null);e.ref(1);let w=e.ref({});uni.setNavigationBarTitle({title:"搭配详情"});const _=async(e,a)=>{var o;try{const n=await uni.request({url:u.value+`/view-collocation?collocation_id=${e}&origin=${a}`});if("success"!==n.data.status)return void N(n.data.msg||"数据加载失败");const s={...n.data.data,image_url_list:Array.isArray(n.data.data.image_url_list)?n.data.data.image_url_list:[n.data.data.image_urls],collocation_relation_list:await Promise.all(n.data.data.collocation_relation_list.map((async e=>{try{const a=e.relation_goods_id>0?await(e=>new Promise(((a,o)=>{e&&0!==e?uni.request({url:`${u.value}/goods?id=${e}`,method:"GET",timeout:5e3,success:e=>{"success"===e.data.status?a(e.data.data):o(e.data.msg||"获取商品信息失败")},fail:e=>{t("error","at pages/collocation_share/collocation_share.vue:214",e),uni.showToast({title:"网络请求失败",icon:"none"}),o(e)}}):o("无效的商品ID")})))(e.relation_goods_id):null;return{...e,goodsInfo:a,imageLoaded:!!a,imageError:!a}}catch(a){return t("error","at pages/collocation_share/collocation_share.vue:266","商品信息获取失败:",a),{...e,goodsInfo:null,imageLoaded:!1,imageError:!0}}})))};l.value=s,(null==(o=n.data.data)?void 0:o.uid)&&await k(n.data.data.uid)}catch(n){N("数据加载失败")}finally{r.value=!1}},k=async e=>{try{const a=await uni.request({url:`${u.value}/user-info?uid=${e}`,method:"GET"});"success"===a.data.status?s.value=a.data.data:t("error","at pages/collocation_share/collocation_share.vue:325","获取用户信息失败:",a.data.msg)}catch(a){t("error","at pages/collocation_share/collocation_share.vue:328","用户信息请求失败:",a),uni.showToast({title:"作者信息加载失败",icon:"none"})}},N=e=>{c.value=!0,d.value=e,uni.showToast({title:e,icon:"none"})};function V(e){let a=uni.getStorageSync("token");if(""==a)return;let o=1==p.value?3:4;uni.request({url:u.value+"/with-state/hasLike?id="+e+"&type="+o,method:"POST",header:{Authorization:a},success:e=>{"success"==e.data.status?e.data.data.id>0?g.value=!0:g.value=!1:uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t("log","at pages/collocation_share/collocation_share.vue:442",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}function x(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}const S=({parent:e,target:a})=>{var o;t("log","at pages/collocation_share/collocation_share.vue:466","parent",e),t("log","at pages/collocation_share/collocation_share.vue:467","target",a);let n=e;null!=a&&(n=a),w.value.id!=n.id?(t("log","at pages/collocation_share/collocation_share.vue:478","item",n),w.value=n,null==(o=y.value)||o.focusInput()):w.value={}},C=e=>{var t,a,o;let n=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});const l=1==p.value?3:6,s={content:e.content,origin:e.origin,target_id:parseInt(m.value),type:l,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...w.value.id&&{reply_id:w.value.id,reply_for:w.value.comment,reply_uid:w.value.user_id,parent_id:w.value.parent_id>0?w.value.parent_id:w.value.id}},i={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0},...e.association_id&&{association_id:e.association_id,association_type:e.association_type},...e.image_url&&{image_url:e.image_url},...w.value.id&&{reply_id:w.value.id,reply_for:w.value.comment,reply_uid:w.value.user_id,parent_id:w.value.parent_id>0?w.value.parent_id:w.value.id,reply_username:w.value.is_anonymous?"匿名用户":w.value.username}};w.value.id?0===w.value.parent_id?null==(a=v.value)||a.addReplyComment({...i,parent_id:w.value.id}):null==(o=v.value)||o.addReplyComment({...i,parent_id:w.value.parent_id}):null==(t=v.value)||t.addNewComment(i),uni.request({url:u.value+"/with-state/add-comment",method:"POST",header:{Authorization:n},data:s,success:t=>{var a,o;if("success"==t.data.status){const o=t.data.data,n={...o,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0}};o.reply_uid&&w.value.is_anonymous&&(n.reply_username="匿名用户"),null==(a=v.value)||a.updateTempComment(i.id,n),uni.showToast({title:"评论成功",icon:"success"})}else null==(o=v.value)||o.removeTempComment(i.id),uni.showToast({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=v.value)||t.removeTempComment(i.id),uni.showToast({title:"网络请求失败",icon:"none"})}})};function B(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${s}`}return n((()=>{t("log","at pages/collocation_share/collocation_share.vue:674","注册键盘弹出事件"),uni.onKeyboardHeightChange(keyboardHeightChangeHandler)})),i((e=>{try{if(!e.collocation_id)return c.value=!0,void(d.value="缺少必要参数Id");if(!e.origin)return c.value=!0,void(d.value="缺少必要参数Origin");m.value=e.collocation_id,p.value=e.origin,_(e.collocation_id,e.origin),f().then((a=>{t("log","at pages/collocation_share/collocation_share.vue:697",a),V(e.collocation_id)}))}catch(a){t("error","at pages/collocation_share/collocation_share.vue:703","onLoad Error:",a),uni.showToast({title:"加载失败",icon:"none"})}})),(o,n)=>{var i;const f=a(e.resolveDynamicComponent("view-logs"),E),k=a(e.resolveDynamicComponent("uni-icons"),b),N=a(e.resolveDynamicComponent("report-button"),me),T=a(e.resolveDynamicComponent("comment-list"),he),D=a(e.resolveDynamicComponent("comment-input"),we);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(f),e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("view",{class:"heart",onClick:n[0]||(n[0]=e=>function(){let e=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});let a=1==p.value?3:4,o={id:parseInt(l.value.id),type:a},n=g.value?"/with-state/unlike":"/with-state/add-like";uni.request({url:u.value+n,method:"POST",header:{Authorization:e},data:o,success:e=>(t("log","at pages/collocation_share/collocation_share.vue:383",e.data),"success"==e.data.status?(uni.showToast({title:"操作成功",icon:"success"}),g.value=!g.value,V(l.value.id),void _(l.value.id,p.value)):void uni.showToast({title:e.data.msg,icon:"none"})),fail:e=>{t("log","at pages/collocation_share/collocation_share.vue:402",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}())},[e.unref(g)?(e.openBlock(),e.createBlock(k,{key:1,type:"heart-filled",size:"28",color:"#ff4d4f"})):(e.openBlock(),e.createBlock(k,{key:0,type:"heart",size:"28",color:"#ff4d4f"})),e.createElementVNode("text",{class:"num"},e.toDisplayString((null==(i=l.value)?void 0:i.like_count)?x(l.value.like_count):0),1)]),e.createElementVNode("swiper",{class:"swiper-box","indicator-dots":!0,autoplay:!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.image_url_list,((a,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o},[e.createElementVNode("image",{src:a,mode:"aspectFill",class:"swiper-image",onClick:e=>function(e){t("log","at pages/collocation_share/collocation_share.vue:227",l),uni.previewImage({current:l.value.image_url_list[e],urls:l.value.image_url_list})}(o)},null,8,["src","onClick"])])))),128))])]),e.createElementVNode("view",{class:"author-info",onClick:n[1]||(n[1]=e=>{return t=l.value.uid,void uni.navigateTo({url:"/pages/user_page/user_page?uid="+t});var t})},[e.createElementVNode("image",{class:"avatar",src:s.value.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-meta"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(s.value.user_name||"未知用户"),1),e.createElementVNode("text",{class:"publish-time"},"发布于 "+e.toDisplayString(B(l.value.created_at)),1)])]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("view",{style:{display:"flex","justify-content":"space-between"}},[e.createElementVNode("text",{class:"title"},e.toDisplayString(l.value.title),1),e.createElementVNode("view",{class:"report-container"},[e.createVNode(N,{"report-type":1===p.value?2:1,"relation-id":parseInt(m.value),"icon-type":"flag","icon-color":"#999"},null,8,["report-type","relation-id"])])]),e.createElementVNode("text",{class:"content"},e.toDisplayString(l.value.content),1)]),e.createElementVNode("view",{class:"goods-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.collocation_relation_list,(t=>{var a,o;return e.openBlock(),e.createElementBlock("view",{key:t.id,class:"goods-item",onClick:e=>(e=>{e.relation_goods_id>0?uni.navigateTo({url:`/pages/goods/goods?goods_id=${e.relation_goods_id}`}):e.relation_brand_id>0?uni.navigateTo({url:`/pages/brand/brand?brand_id=${e.relation_brand_id}`}):uni.showToast({title:"暂无商品和品牌信息",icon:"none"})})(t)},[e.createElementVNode("view",{class:"image-container"},[0===t.relation_goods_id?(e.openBlock(),e.createElementBlock("view",{key:0,class:"placeholder-box"},[e.createElementVNode("text",{style:{color:"#fff","font-size":"45px"}},"?")])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[t.imageLoaded?(e.openBlock(),e.createElementBlock("image",{key:0,src:(null==(o=null==(a=t.goodsInfo)?void 0:a.goods_images)?void 0:o[0])||"/static/goods-default.png",mode:"aspectFill",class:"goods-image"},null,8,["src"])):t.imageError?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-box"},[e.createElementVNode("text",null,"图片加载失败")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"loading-box"},[e.createElementVNode("text",null,"加载中...")]))],64))]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("text",{class:"brand"},e.toDisplayString(t.relation_brand_name)+" - "+e.toDisplayString(t.relation_goods_name),1),e.createElementVNode("view",null,[e.createElementVNode("text",{class:"category"},e.toDisplayString(t.type),1),e.createElementVNode("text",{class:"price"}," （"+e.toDisplayString(t.goodsInfo&&t.goodsInfo.total_amount?t.goodsInfo.total_amount+t.goodsInfo.currency:"贩售价格未收录")+"）",1)]),e.createElementVNode("view",{class:"see font-alimamashuhei"}," 去看看 → ")])],8,["onClick"])})),128))]),p.value>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{padding:"10px"}},[e.createVNode(T,{ref_key:"commentListRef",ref:v,type:1==p.value?3:6,"relation-id":parseInt(m.value),onReply:S},null,8,["type","relation-id"])])):e.createCommentVNode("",!0),l.value.title?(e.openBlock(),e.createBlock(D,{key:1,ref_key:"commentInputRef",ref:y,"reply-info":e.unref(w),"target-id":m.value,onSubmit:C,"onUpdate:replyInfo":n[2]||(n[2]=t=>e.isRef(w)?w.value=t:w=t)},null,8,["reply-info","target-id"])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}}),r.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"loading"},"加载中...")):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"error"},e.toDisplayString(d.value),1)):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-08f017bc"]]),gl=V({__name:"user_page",props:["uid"],setup(o){const l=e.ref(0),s=e.ref(["搭配","娃柜","点评"]),i=o,c=e.ref({avatar:"",user_name:"加载中..."}),d=e.ref(!1),m=e.ref(!1),p=e.ref([]),h=e.ref([]),g=e.ref([]),v=e.ref([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e.watch(l,(e=>{v.value[e];0===[p,h,g][e].value.length&&y()}));const f=e=>{uni.navigateTo({url:e})},y=async()=>{if(d.value||m.value)return;const e=v.value[l.value];if(!e.loading&&!e.finished){e.loading=!0;try{let t,a;switch(l.value){case 0:t=`/user-info/collection?user_id=${i.uid}&page=${e.page}`,a="List";break;case 1:t=`/user-info/show-case?user_id=${i.uid}&page=${e.page}`,a="List";break;case 2:t=`/user-info/posts?user_id=${i.uid}&page=${e.page}`,a="comment_list"}const o=await uni.request({url:`${u.value}${t}`});if("success"===o.data.status){const t=o.data.data,n=t[a].map((e=>{var t,a,o;switch(l.value){case 0:return{id:e.id,cover:(null==(t=e.image_urls)?void 0:t.split(",")[0])||"",images:(null==(a=e.image_urls)?void 0:a.split(","))||[],title:e.title,time:e.created_at};case 1:return{id:e.id,cover:(null==(o=e.image_urls)?void 0:o.split(",")[0])||"",title:e.name,desc:e.description,time:e.created_at,price:e.price||0};case 2:return{id:e.id,product_thumb:e.target_image,product_name:e.target_name,content:e.comment,create_time:_(e.created_at),target_id:e.relation_id}}})),s=[p,h,g][l.value];s.value=[...s.value,...n],e.total=t.total,e.finished=s.value.length>=t.total,e.page++}}catch(a){t("log","at pages/user_page/user_page.vue:231",a),uni.showToast({title:"数据加载失败",icon:"none"})}finally{e.loading=!1}}},w=async()=>{try{const e=uni.getStorageSync("token");if(!e)return void t("log","at pages/user_page/user_page.vue:293","未登录");const a=d.value?"remove":"add",o=await uni.request({url:`${u.value}/with-state/blacklist/${a}?target_user_id=`+i.uid,method:"POST",header:{Authorization:e}});"success"===o.data.status?(d.value=!d.value,uni.showToast({title:d.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(d.value||m.value)&&(p.value=[],h.value=[],g.value=[])):uni.showToast({title:o.data.msg,icon:"none"})}catch(e){t("log","at pages/user_page/user_page.vue:328","操作失败",e),uni.showToast({title:"操作失败",icon:"none"})}},_=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`};return uni.setNavigationBarTitle({title:"用户主页"}),n((()=>{(async()=>{try{const e=await uni.request({url:`${u.value}/user-info?uid=${i.uid}`});"success"===e.data.status&&(c.value=e.data.data)}catch(e){uni.showToast({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const e=uni.getStorageSync("token");if(e)try{const t=await uni.request({url:`${u.value}/with-state/blacklist/status`,method:"GET",data:{target_user_id:i.uid},header:{Authorization:e}});"success"===t.data.status&&(d.value=t.data.data.is_blocked,m.value=t.data.data.they_blocked)}catch(a){t("log","at pages/user_page/user_page.vue:284","获取黑名单状态失败",a)}else t("log","at pages/user_page/user_page.vue:263","未登录")})().then((()=>{d.value||m.value||y()}))})),r((()=>{y()})),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E),i=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(n),e.createElementVNode("view",{class:"header_container"},[e.createElementVNode("view",{class:"user-info-container"},[e.createElementVNode("view",{class:"user-info-box"},[e.createElementVNode("image",{class:"avatar",src:c.value.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"username"},e.toDisplayString(c.value.user_name),1)]),e.createElementVNode("view",{class:"action-buttons"},[e.createElementVNode("view",{class:e.normalizeClass(["action-btn block-btn",{blocked:d.value}]),onClick:w},[e.createVNode(i,{type:(d.value,"minus"),size:"16",color:"#fff"},null,8,["type"]),e.createElementVNode("text",null,e.toDisplayString(d.value?"已拉黑":"拉黑"),1)],2)])])]),d.value||m.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"content"},[e.createElementVNode("view",{class:"tabs-container"},[e.createElementVNode("view",{class:"tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item font-alimamashuhei",{active:l.value===a}]),onClick:e=>l.value=a},e.toDisplayString(t),11,["onClick"])))),128))])]),0===l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"collocation-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"collocation-item item-image-container",onClick:e=>f(`/pages/collocation_share/collocation_share?collocation_id=${t.id}&origin=1`)},[e.createElementVNode("image",{class:"item-image",src:t.cover,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(t.title),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),1===l.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"doll-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"doll-item item-image-container",onClick:e=>f(`/pages/collocation_share/collocation_share?collocation_id=${t.id}&origin=2`)},[e.createElementVNode("image",{class:"item-image",src:t.cover,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"item-price"},"¥"+e.toDisplayString(t.price),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),2===l.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"review-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"review-item",onClick:e=>f(`/pages/goods/goods?goods_id=${t.target_id}`)},[e.createElementVNode("image",{class:"product-thumb",src:t.product_thumb,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"review-content"},[e.createElementVNode("text",{class:"product-name"},e.toDisplayString(t.product_name),1),e.createElementVNode("text",{class:"review-text"},e.toDisplayString(t.content),1),e.createElementVNode("text",{class:"review-time"},e.toDisplayString(t.create_time),1)])],8,["onClick"])))),128))])):e.createCommentVNode("",!0)])),d.value||m.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createVNode(i,{type:"minus",size:"48",color:"#ccc"}),e.createElementVNode("text",null,"你无法查看该用户的主页")])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-13431507"]]);let vl={};vl={data:()=>({is_show:"none"}),watch:{show(e){this.is_show=this.show}},created(){this.swipeaction=this.getSwipeAction(),this.swipeaction&&Array.isArray(this.swipeaction.children)&&this.swipeaction.children.push(this)},mounted(){this.is_show=this.show},methods:{closeSwipe(e){this.autoClose&&this.swipeaction&&this.swipeaction.closeOther(this)},change(e){this.$emit("change",e.open),this.is_show!==e.open&&(this.is_show=e.open)},appTouchStart(e){const{clientX:t}=e.changedTouches[0];this.clientX=t,this.timestamp=(new Date).getTime()},appTouchEnd(e,t,a,o){const{clientX:n}=e.changedTouches[0];let l=Math.abs(this.clientX-n),s=(new Date).getTime()-this.timestamp;l<40&&s<300&&this.$emit("click",{content:a,index:t,position:o})},onClickForPC(e,t,a){}}};const fl=e=>{(e.$wxs||(e.$wxs=[])).push("wxsswipe"),(e.$wxsModules||(e.$wxsModules={})).wxsswipe="afd46426"},yl=e=>{(e.$renderjs||(e.$renderjs=[])).push("renderswipe"),(e.$renderjsModules||(e.$renderjsModules={})).renderswipe="5a1e922e"},wl={mixins:[vl,{},{}],emits:["click","change"],props:{show:{type:String,default:"none"},disabled:{type:Boolean,default:!1},autoClose:{type:Boolean,default:!0},threshold:{type:Number,default:20},leftOptions:{type:Array,default:()=>[]},rightOptions:{type:Array,default:()=>[]}},unmounted(){this.__isUnmounted=!0,this.uninstall()},methods:{uninstall(){this.swipeaction&&this.swipeaction.children.forEach(((e,t)=>{e===this&&this.swipeaction.children.splice(t,1)}))},getSwipeAction(e="uniSwipeAction"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t}}};fl(wl),yl(wl);const _l=V(wl,[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",{class:"uni-swipe"},[e.createElementVNode("view",{class:"uni-swipe_box","change:prop":t.wxsswipe.showWatch,prop:e.wp(t.is_show),"data-threshold":o.threshold,"data-disabled":o.disabled,onTouchstart:a[2]||(a[2]=(...e)=>t.wxsswipe.touchstart&&t.wxsswipe.touchstart(...e)),onTouchmove:a[3]||(a[3]=(...e)=>t.wxsswipe.touchmove&&t.wxsswipe.touchmove(...e)),onTouchend:a[4]||(a[4]=(...e)=>t.wxsswipe.touchend&&t.wxsswipe.touchend(...e))},[e.createElementVNode("view",{class:"uni-swipe_button-group button-group--left"},[e.renderSlot(t.$slots,"left",{},(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.leftOptions,((o,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,style:e.normalizeStyle({backgroundColor:o.style&&o.style.backgroundColor?o.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:a[0]||(a[0]=e.withModifiers(((...e)=>t.appTouchStart&&t.appTouchStart(...e)),["stop"])),onTouchend:e.withModifiers((e=>t.appTouchEnd(e,n,o,"left")),["stop"]),onClick:e.withModifiers((e=>t.onClickForPC(n,o,"left")),["stop"])},[e.createElementVNode("text",{class:"uni-swipe_button-text",style:e.normalizeStyle({color:o.style&&o.style.color?o.style.color:"#FFFFFF",fontSize:o.style&&o.style.fontSize?o.style.fontSize:"16px"})},e.toDisplayString(o.text),5)],44,["onTouchend","onClick"])))),128))]),!0)]),e.createElementVNode("view",{class:"uni-swipe_text--center"},[e.renderSlot(t.$slots,"default",{},void 0,!0)]),e.createElementVNode("view",{class:"uni-swipe_button-group button-group--right"},[e.renderSlot(t.$slots,"right",{},(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.rightOptions,((o,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,style:e.normalizeStyle({backgroundColor:o.style&&o.style.backgroundColor?o.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:a[1]||(a[1]=e.withModifiers(((...e)=>t.appTouchStart&&t.appTouchStart(...e)),["stop"])),onTouchend:e.withModifiers((e=>t.appTouchEnd(e,n,o,"right")),["stop"]),onClick:e.withModifiers((e=>t.onClickForPC(n,o,"right")),["stop"])},[e.createElementVNode("text",{class:"uni-swipe_button-text",style:e.normalizeStyle({color:o.style&&o.style.color?o.style.color:"#FFFFFF",fontSize:o.style&&o.style.fontSize?o.style.fontSize:"16px"})},e.toDisplayString(o.text),5)],44,["onTouchend","onClick"])))),128))]),!0)])],40,["change:prop","prop","data-threshold","data-disabled"])])}],["__scopeId","data-v-20868213"]]);const kl=V({name:"uniSwipeAction",data:()=>({}),created(){this.children=[]},methods:{resize(){},closeAll(){this.children.forEach((e=>{e.is_show="none"}))},closeOther(e){this.openItem&&this.openItem!==e&&(this.openItem.is_show="none"),this.openItem=e}}},[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",null,[e.renderSlot(t.$slots,"default")])}]]),El={__name:"message_list",setup(o){const n=e.ref([]),l=e.ref(0),s=e.ref(1),i=e.ref(!1),r=e.ref(!0),c=e.ref(!1),d=e=>[{text:"删除",style:{backgroundColor:"#dd524d"},data:{type:"delete",id:e.id}},{text:e.is_read?"已读":"标记已读",style:{backgroundColor:"#6fd0d4"},data:{type:"read",id:e.id}}];e.onMounted((async()=>{await f(),m(),h(),uni.setNavigationBarTitle({title:"消息"})}));const m=async(e=!1)=>{try{c.value=!0;const t=e?s.value:1,a=await uni.request({url:`${u.value}/with-state/user-messages?page=${t}`,header:{Authorization:uni.getStorageSync("token")}});if("success"===a.data.status){const o=a.data.data.message_list;n.value=e?[...n.value,...o]:o,r.value=o.length>=10,s.value=t+(r.value?1:0)}}catch(t){uni.showToast({title:"消息加载失败",icon:"none"})}finally{c.value=!1,i.value=!1}},p=()=>{t("log","at pages/message_list/message_list.vue:138","触发加载更多",c.value,r.value),!c.value&&r.value&&m(!0)},h=async()=>{try{const e=await uni.request({url:`${u.value}/with-state/unread-message-count`,header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status&&(l.value=e.data.data.count)}catch(e){uni.showToast({title:"未读数获取失败",icon:"none"})}},g=e=>{const{type:t,id:a}=e.content.data;"delete"===t?v(a):"read"===t&&w(a)},v=e=>{uni.showModal({title:"删除确认",content:"确定要删除这条消息吗？",success:t=>{t.confirm&&y(e)}})},y=async e=>{try{await uni.request({url:`${u.value}/with-state/delete-message`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{message_id:e}}),n.value=n.value.filter((t=>t.id!==e)),h(),uni.showToast({title:"删除成功"})}catch(t){uni.showToast({title:"删除失败",icon:"none"})}},w=async e=>{try{await uni.request({url:`${u.value}/with-state/mark-message-read`,method:"POST",header:{Authorization:uni.getStorageSync("token"),"Content-Type":"application/json"},data:{message_id:e}});const t=n.value.find((t=>t.id===e));t&&!t.is_read&&(t.is_read=1,l.value--)}catch(t){uni.showToast({title:"标记失败",icon:"none"})}},_=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`};return(t,o)=>{const l=a(e.resolveDynamicComponent("view-logs"),E),s=a(e.resolveDynamicComponent("uni-swipe-action-item"),_l),i=a(e.resolveDynamicComponent("uni-swipe-action"),kl);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(l),e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("scroll-view",{class:"message-list","scroll-y":"",onScrolltolower:p,"show-scrollbar":!1},[e.createVNode(i,null,{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t=>(e.openBlock(),e.createBlock(s,{key:t.id,"right-options":d(t),threshold:.4,onClick:g},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"message-item",onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/message_info/message_info?message_id=${a}`});var a}},[e.createElementVNode("image",{class:"cover-image",src:t.cover_image,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:e.normalizeClass(["msg",{unread:!t.is_read}])},e.toDisplayString(t.msg),3)]),e.createElementVNode("text",{class:"time"},e.toDisplayString(_(t.created_at)),1)],8,["onClick"])])),_:2},1032,["right-options"])))),128))])),_:1}),e.createElementVNode("view",{class:"loading-wrapper"},[c.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},"加载中...")):e.createCommentVNode("",!0),r.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:1,class:"loading-text"},"没有更多数据了"))])],32)])}}},Nl={__name:"message_info",props:["message_id"],setup(o){const n=o,l=e.ref(null),s=e.ref(!0),i=e.ref(""),r=e.ref(""),c=async()=>{try{if(s.value=!0,i.value="",!r.value)return void(i.value="无效的消息ID");if(!(await f()))return void(i.value="请先登录");const e=await uni.request({url:`${u.value}/with-state/message-detail`,method:"GET",data:{id:r.value},header:{Authorization:uni.getStorageSync("token")}});"success"===e.data.status?(l.value=e.data.data,uni.$emit("message-status-update",{id:r.value,is_read:1})):i.value=e.data.msg||"获取详情失败"}catch(e){i.value="请求失败，请检查网络",t("error","at pages/message_info/message_info.vue:97","详情请求失败:",e)}finally{s.value=!1}};return e.onMounted((()=>{uni.setNavigationBarTitle({title:"消息详情"}),r.value=n.message_id,c()})),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E),r=a(e.resolveDynamicComponent("uni-load-more"),Xe),u=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(n),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-wrapper"},[e.createVNode(r,{status:"loading"})])):i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-wrapper"},[e.createVNode(u,{type:"info",size:"24",color:"#ff4d4f"}),e.createElementVNode("text",{class:"error-text"},e.toDisplayString(i.value),1),e.createElementVNode("button",{class:"retry-btn",onClick:c},"重试")])):(e.openBlock(),e.createElementBlock("scroll-view",{key:2,class:"content-wrapper","scroll-y":""},[e.createElementVNode("image",{class:"cover-image",src:l.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),e.createElementVNode("view",{class:"main-content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(l.value.title),1),e.createElementVNode("text",{class:"time"},e.toDisplayString((d=l.value.created_at,new Date(1e3*d).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("text",{class:"message-text"},e.toDisplayString(l.value.msg),1)])])]))]);var d}}},Vl=V({__name:"register",setup(t){const o=e.ref({telephone:"",code:"",password:"",rePassword:""}),n=e.ref({phone:"",code:"",password:"",rePassword:""}),l=e.ref(0),s=e.computed((()=>l.value>0)),i=e.computed((()=>l.value>0?`${l.value}秒后重发`:"获取验证码")),r=e.ref(!1),c=()=>o.value.telephone?/^1[3-9]\d{9}$/.test(o.value.telephone)?(n.value.phone="",!0):(n.value.phone="手机号格式不正确",!1):(n.value.phone="手机号不能为空",!1),d=async()=>{if(c())try{const e=await uni.request({url:`${u.value}/send-sms-code`,method:"POST",data:{tel_phone:o.value.telephone}});"success"===e.data.status?(m(),uni.showToast({title:"验证码已发送",icon:"none"})):uni.showToast({title:e.data.msg||"发送失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}},m=()=>{l.value=60;const e=setInterval((()=>{l.value<=0?clearInterval(e):l.value--}),1e3)},p=()=>o.value.password.length<6?(n.value.password="密码至少需要6位",!1):(n.value.password="",!0),h=()=>o.value.password!==o.value.rePassword?(n.value.rePassword="两次密码输入不一致",!1):(n.value.rePassword="",!0),g=()=>o.value.code?6!==o.value.code.length?(n.value.code="验证码格式不正确",!1):(n.value.code="",!0):(n.value.code="验证码不能为空",!1),v=async()=>{if([c(),g(),p(),h()].every((e=>e)))try{r.value=!0;const e=await uni.request({url:`${u.value}/register`,method:"POST",data:{telephone:o.value.telephone,code:o.value.code,password:o.value.password,re_password:o.value.rePassword}});"success"===e.data.status?(uni.setStorageSync("token",e.data.data.jwt_token),uni.showToast({title:"注册成功",icon:"success",complete:()=>{setTimeout((()=>{uni.switchTab({url:"/pages/mine/mine"})}),1500)}})):uni.showToast({title:e.data.msg||"注册失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}finally{r.value=!1}},f=()=>{uni.navigateTo({url:"/pages/login/login"})};return(t,l)=>{const u=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(u),e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"手机号注册")]),e.createElementVNode("view",{class:"form-box"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("text",{class:"prefix"},"+86"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:c},null,544),[[e.vModelText,o.value.telephone]])]),n.value.phone?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.phone),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"code-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.code=e),type:"number",autocomplete:"new-password",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:g},null,544),[[e.vModelText,o.value.code]]),e.createElementVNode("button",{class:e.normalizeClass(["code-btn",{disabled:s.value}]),disabled:s.value,onClick:d},e.toDisplayString(i.value),11,["disabled"])]),n.value.code?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.code),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.password=e),autocomplete:"new-password",type:"password",placeholder:"请输入密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:p},null,544),[[e.vModelText,o.value.password]])]),n.value.password?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.password),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.rePassword=e),type:"password",placeholder:"请再次输入密码",class:"input","placeholder-class":"placeholder",onBlur:h},null,544),[[e.vModelText,o.value.rePassword]])]),n.value.rePassword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.rePassword),1)):e.createCommentVNode("",!0)]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{loading:r.value}]),disabled:r.value,onClick:v},e.toDisplayString(r.value?"注册中...":"立即注册"),11,["disabled"]),e.createElementVNode("view",{class:"bottom-tips"},[e.createTextVNode(" 已有账号？ "),e.createElementVNode("text",{class:"link-text",onClick:f},"去登录")])])])],64)}}},[["__scopeId","data-v-2c7e0c3f"]]),bl=V({__name:"user_like",setup(o){const n=e.ref([{type:1,name:"商品"},{type:2,name:"品牌"},{type:3,name:"搭配"},{type:4,name:"展示柜"}]),l=e.ref(1),s=e.ref([]),i=e.ref(!1),r=e.ref(!1),c=e.reactive({page:1,page_size:8,total:0});e.onMounted((async()=>{await d(),m()}));const d=async()=>{await f()||uni.navigateTo({url:"/pages/login/login"})},m=async()=>{if(!i.value&&!r.value){i.value=!0;try{const e=await uni.request({url:`${u.value}/with-state/user-likes`,method:"GET",data:{type:l.value,page:c.page,page_size:c.page_size},header:{Authorization:uni.getStorageSync("token")}});if("success"===e.data.status){const t=e.data.data.list;s.value=[...s.value,...t],c.total=e.data.data.total,e.data.data.list.length?r.value=!1:r.value=!0,c.page+=1}}catch(e){uni.showToast({title:"加载失败",icon:"none"})}finally{i.value=!1}}},p=()=>{r.value?t("log","at pages/user_like/user_like.vue:203","no more"):m()},h=()=>{c.page=1,s.value=[],r.value=!1},g=e=>(null==e?void 0:e.length)>0?e[0]:"",v=e=>{const t=(null==e?void 0:e.split(",")[0])||"";return t||""};return uni.setNavigationBarTitle({title:"我的关注"}),(t,o)=>{const c=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(c),e.createElementVNode("view",{class:"nav-bar"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["nav-item",{active:l.value===t.type}]),onClick:e=>{return a=t.type,void(l.value!==a&&(l.value=a,h(),m()));var a}},e.toDisplayString(t.name),11,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"scroll-view","scroll-y":"",onScrolltolower:p,"show-scrollbar":!1},[e.createElementVNode("view",{class:"list-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((a,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:a.id},[1===l.value&&a.goods?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list-item goods-item",onClick:e=>{return t=a.goods.id,void uni.navigateTo({url:`/pages/goods/goods?goods_id=${t}`});var t}},[e.createElementVNode("view",{class:"goods-left"},[e.createElementVNode("image",{class:"goods-thumb",src:g(a.goods.goods_images),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"price-tag"},"¥"+e.toDisplayString(a.goods.total_amount),1)]),e.createElementVNode("view",{class:"goods-right"},[e.createElementVNode("view",{class:"goods-header"},[e.createElementVNode("text",{class:"goods-title line-clamp-2"},e.toDisplayString(a.goods.name),1),e.createElementVNode("button",{class:"unfollow-btn",onClick:e.withModifiers((e=>(async e=>{try{"success"===(await uni.request({url:`${u.value}/user/unfollow`,method:"POST",data:{id:e},header:{Authorization:uni.getStorageSync("token")}})).data.status&&(s.value=s.value.filter((t=>t.id!==e)),uni.showToast({title:"已取消关注",icon:"success"}))}catch(t){uni.showToast({title:"操作失败",icon:"none"})}})(a.id)),["stop"])},"取消关注",8,["onClick"])]),e.createElementVNode("view",{class:"goods-specs"},[e.createElementVNode("text",{class:"spec-item"},e.toDisplayString(a.goods.brand_name),1),e.createElementVNode("text",{class:"spec-item"},e.toDisplayString(a.goods.size),1),e.createElementVNode("text",{class:"spec-item"},e.toDisplayString(a.goods.skin.split(" ")[0]),1)]),e.createElementVNode("view",{class:"goods-footer"},[e.createElementVNode("text",{class:"goods-type"},e.toDisplayString(a.goods.type),1),e.createElementVNode("text",{class:"goods-material"},e.toDisplayString(a.goods.doll_material),1)])])],8,["onClick"])):e.createCommentVNode("",!0),2===l.value&&a.brand?(e.openBlock(),e.createElementBlock("view",{key:1,class:"list-item brand-item",onClick:e=>{return t=a.brand.id,void uni.navigateTo({url:`/pages/brand/brand?brand_id=${t}`});var t}},[e.createElementVNode("view",{class:"brand-content"},[e.createElementVNode("image",{class:"brand-logo",src:a.brand.logo_image,mode:"aspectFit"},null,8,["src"]),e.createElementVNode("view",{class:"brand-info"},[e.createElementVNode("view",{class:"brand-header"},[e.createElementVNode("text",{class:"brand-name"},e.toDisplayString(a.brand.brand_name),1),e.createElementVNode("text",{class:"brand-country"},e.toDisplayString(a.brand.country_name),1)]),e.createElementVNode("text",{class:"brand-description line-clamp-2"},e.toDisplayString(a.brand.description),1),e.createElementVNode("view",{class:"brand-actions"},[e.createElementVNode("button",{class:"action-btn",onClick:e.withModifiers((e=>t.unfollowBrand(a.id)),["stop"])},"取消关注",8,["onClick"])])])])],8,["onClick"])):e.createCommentVNode("",!0),3===l.value&&a.collocation?(e.openBlock(),e.createElementBlock("view",{key:2,class:"list-item",onClick:e=>{return t=a.collocation.id,void uni.navigateTo({url:`/pages/collocation/detail?id=${t}`});var t}},[e.createElementVNode("image",{class:"item-image",src:v(a.collocation.image_urls),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(a.collocation.title),1)],8,["onClick"])):e.createCommentVNode("",!0),4===l.value&&a.showcase?(e.openBlock(),e.createElementBlock("view",{key:3,class:"list-item",onClick:e=>{return t=a.showcase.id,void uni.navigateTo({url:`/pages/showcase/detail?id=${t}`});var t}},[e.createElementVNode("image",{class:"item-image",src:g(a.showcase.image_urls),mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"item-title"},e.toDisplayString(a.showcase.name),1)],8,["onClick"])):e.createCommentVNode("",!0)],64)))),128)),e.createElementVNode("view",{class:"loading-status"},[i.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},"加载中...")):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more-text"},"没有更多了")):e.createCommentVNode("",!0)])])],32)])}}},[["__scopeId","data-v-6a1a683e"]]),xl={__name:"collocation_square",setup(o){const n=e.ref("find"),l=e.ref([]),s=e.ref(!1),i=e.ref(!1),r=e.ref(1),d=e.ref(0),m=e.ref(0),p=e.reactive([0,0]),h=e.ref(!1),g=e.ref(""),v=e.ref([]),f=e.getCurrentInstance(),y=e.ref(null),w=e.ref([]);e.ref(null);const _=e.ref([]),k=e.ref(!1),N=e.ref(!1),V=e.ref(-1),x=e.ref("全部"),S=e.ref("全部"),C=e.ref([]),D=e.ref([]),I=e.ref(!1),z=()=>{I.value=!I.value},A=()=>{I.value=!1},L=()=>{A(),uni.navigateTo({url:"/pages/collocation/collocation"})},$=()=>{A(),uni.navigateTo({url:"/pages/stock/showcase_form/showcase_form"})},F=e=>{const t=l.value[e];return t.position?{left:`${t.position.left}px`,top:`${t.position.top}px`,width:`${m.value}px`}:{}},M=e=>{if(t("log","at pages/collocation_square/collocation_square.vue:278","进入计算布局逻辑"),!e)return void t("log","at pages/collocation_square/collocation_square.vue:280","无法获取instance");if(t("log","at pages/collocation_square/collocation_square.vue:283","获取成功"),!l.value)return void t("log","at pages/collocation_square/collocation_square.vue:285","无列表数据，不需要计算布局");t("log","at pages/collocation_square/collocation_square.vue:288","获取成功，准备createSelectorQuery"),t("log","at pages/collocation_square/collocation_square.vue:289",e);const a=uni.createSelectorQuery().in(e.proxy);t("log","at pages/collocation_square/collocation_square.vue:291","获取到query");const o=l.value.map(((e,t)=>new Promise((e=>{a.select(`#card-${t}`).boundingClientRect((a=>{e({index:t,rect:a})}))}))));a.exec((async()=>{t("log","at pages/collocation_square/collocation_square.vue:306","进入Query"),p[0]=0,p[1]=0;const e=await Promise.all(o);e.length?(e.forEach((({index:e,rect:a})=>{if(!a)return void t("error","at pages/collocation_square/collocation_square.vue:322",`卡片${e}元素查询失败`);const o=l.value[e],n=p[0]<=p[1]?0:1,s=n*(m.value+10),i=p[n]+10;p[n]=i+a.height,o.position={left:s,top:i}})),d.value=Math.max(...p)+20):t("warn","at pages/collocation_square/collocation_square.vue:314","未查询到任何卡片元素")}))},O=e=>{I.value=!1,h.value=!1,"view"===n.value&&(l.value.forEach((e=>{delete e.position})),p[0]=0,p[1]=0),q(e)},q=e=>{n.value=e,"find"===e&&(0===C.value.length&&(U(),j()),0===_.value.length&&H(!0)),"view"==e&&W()},U=async()=>{try{const e=await uni.request({url:`${u.value}/goods-types`,method:"GET"});"success"===e.data.status&&(C.value=["全部",...e.data.data])}catch(e){t("error","at pages/collocation_square/collocation_square.vue:393","获取商品分类失败:",e)}},j=async()=>{try{const e=await uni.request({url:`${u.value}/sizes?show_type=hot`,method:"GET"});if("success"===e.data.status){const t=Object.keys(e.data.data);D.value=["全部",...t]}}catch(e){t("error","at pages/collocation_square/collocation_square.vue:411","获取尺寸分类失败:",e)}},H=async(e=!1)=>{if(e&&(_.value=[],V.value=-1,N.value=!1),!k.value&&!N.value)try{k.value=!0;const t={cursor:V.value,page_size:10,type:"全部"===x.value?"":x.value,size:"全部"===S.value?"":S.value},a=await uni.request({url:`${u.value}/random-list`,method:"POST",data:t,header:{"content-type":"application/json"}});if("success"===a.data.status){const t=a.data.data,o=t.goods_list||[];_.value=e?o:[..._.value,...o],V.value=t.next_cursor,N.value=o.length<10}}catch(a){t("error","at pages/collocation_square/collocation_square.vue:465","获取随机商品失败:",a),uni.showToast({title:"加载失败",icon:"none"})}finally{k.value=!1}},G=()=>{H()};e.onMounted((()=>{const e=uni.getSystemInfoSync();m.value=(e.windowWidth-30)/2,U(),j(),H(!0)})),c((async()=>{try{"view"===n.value?await W(!0):"find"===n.value&&await H(!0),uni.stopPullDownRefresh()}catch(e){uni.stopPullDownRefresh(),uni.showToast({title:"刷新失败",icon:"none"})}}));const W=async(e=!1)=>{if(e&&(l.value=[],r.value=1,i.value=!1,s.value=!1),s.value||i.value)return t("log","at pages/collocation_square/collocation_square.vue:523","正在加载或没有更多数据，停止请求"),void J();try{s.value=!0;const a={page:r.value,page_size:10,filter_goods_id_list:w.value.map((e=>e.goods_id))};t("log","at pages/collocation_square/collocation_square.vue:538","请求参数:",JSON.stringify(a,null,2));const o=await uni.request({url:`${u.value}/collocation-list`,method:"POST",data:a,header:{"content-type":"application/json"}});if(t("log","at pages/collocation_square/collocation_square.vue:549","接口响应:",o),"success"===o.data.status){const t=o.data.data||{},a=Array.isArray(t.collocation_relation_list)?t.collocation_relation_list:[];l.value=e?a:[...l.value,...a],i.value=a.length<10,r.value++,e&&0===a.length&&uni.showToast({title:"暂无相关搭配",icon:"none"}),J()}}catch(a){t("error","at pages/collocation_square/collocation_square.vue:575","请求失败:",a),uni.showToast({title:"加载失败",icon:"none"})}finally{s.value=!1}},J=async()=>{t("log","at pages/collocation_square/collocation_square.vue:586","等待next tick"),await e.nextTick(),t("log","at pages/collocation_square/collocation_square.vue:588","等待完成"),M(f),setTimeout((()=>{t("log","at pages/collocation_square/collocation_square.vue:592","二次计算布局"),M(f)}),500)},K=()=>{h.value=!0},Y=e=>{if(t("log","at pages/collocation_square/collocation_square.vue:632","选择商品:",e),!(null==e?void 0:e.id))return;const a={goods_id:e.id,goods_name:`${e.brand_name?e.brand_name+"·":""}${e.name}`};w.value.some((e=>e.goods_id===a.goods_id))||(w.value=[...w.value,a])};const Q=async()=>{h.value=!1,await W(!0)},X=()=>{h.value=!1},Z=(e,t)=>{var a;null==(a=null==t?void 0:t.stopPropagation)||a.call(t),w.value=w.value.filter((t=>t.goods_id!==e)),i.value=!1,W(!0)},ee=()=>{y.value=null,g.value="",w.value=[],v.value=[]};const te=()=>{i.value||W()};return(t,o)=>{const r=a(e.resolveDynamicComponent("view-logs"),E),c=a(e.resolveDynamicComponent("goods-search"),R),u=a(e.resolveDynamicComponent("uni-icons"),b),m=a(e.resolveDynamicComponent("uni-transition"),B),p=a(e.resolveDynamicComponent("common-modal"),T),g=a(e.resolveDynamicComponent("loading-toast"),P),v=a(e.resolveDynamicComponent("common-page"),se);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("meta",{name:"theme-color",content:"#def9ff"}),e.createVNode(r),e.createVNode(v,{head_color:"#def9ff"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab",{active:"find"===n.value}]),onClick:o[0]||(o[0]=e=>O("find"))},[e.createElementVNode("image",{src:"/static/new-icon/findfind.gif",class:"tab-image"})],2),e.createElementVNode("view",{class:e.normalizeClass(["tab",{active:"view"===n.value}]),onClick:o[1]||(o[1]=e=>O("view"))},[e.createElementVNode("image",{src:"/static/new-icon/sesee.png",class:"tab-image",style:{position:"relative",bottom:"5rpx"}})],2)]),"find"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"category-container"},[e.createElementVNode("view",{style:{margin:"10rpx 0 40rpx 0"}},[e.createVNode(c,{"hidden-icon":!1,width:"670rpx"})]),e.createElementVNode("scroll-view",{"scroll-x":"",class:"category-scroll","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["category-item",{active:x.value===t}]),key:a,onClick:e=>(e=>{x.value=e,H(!0)})(t)},e.toDisplayString(t),11,["onClick"])))),128))]),e.createElementVNode("scroll-view",{"scroll-x":"",class:"size-scroll","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["size-item",{active:S.value===t}]),key:a,onClick:e=>(e=>{S.value=e,H(!0)})(t)},e.toDisplayString(t),11,["onClick"])))),128))])]),e.createElementVNode("scroll-view",{class:"goods-list","scroll-y":"",onScrolltolower:G,"show-scrollbar":!1},[e.createElementVNode("view",{class:"goods-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"goods-card",onClick:e=>{return a=t.id,void uni.navigateTo({url:"/pages/goods/goods?goods_id="+a});var a}},[e.createElementVNode("image",{src:t.goods_images[0],mode:"aspectFill",class:"goods-image"},null,8,["src"]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"goods-brand"},e.toDisplayString(t.brand_name),1),e.createElementVNode("text",{class:"goods-price"},e.toDisplayString(t.total_amount)+" "+e.toDisplayString(t.currency),1)])],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"loading-state"},[k.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),N.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)])],32)])):e.createCommentVNode("",!0),"view"===n.value?(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("view",{class:"filter-bar-container"},[e.createElementVNode("view",{class:"filter-bar"},[e.createElementVNode("view",{class:"filter-tags",onClick:K},[e.createElementVNode("view",{class:"selected-goods"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.goods_id,class:"tag",onClick:e.withModifiers((e=>Z(t.goods_id,e)),["stop"])},[e.createTextVNode(e.toDisplayString(t.goods_name)+" ",1),e.createElementVNode("text",{class:"remove"},"×")],8,["onClick"])))),128))]),w.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:0,class:"tip"},"当前无筛选条件"))]),e.createElementVNode("button",{class:"submit-btn",onClick:o[2]||(o[2]=e=>W(!0))},"筛选")])]),e.createElementVNode("view",{class:"container"},[e.createElementVNode("scroll-view",{class:"card-list","scroll-y":"",onScrolltolower:te,"show-scrollbar":!1},[e.createElementVNode("view",{class:"cards-container",style:e.normalizeStyle({height:d.value+"px"})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>{var o,n;return e.openBlock(),e.createElementBlock("view",{key:t.collocation_id,class:"card",id:"card-"+a,style:e.normalizeStyle(F(a)),onClick:e=>{return a=t.collocation_id,o=t.origin,void uni.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+a+"&origin="+o});var a,o}},[e.createElementVNode("view",{class:"user-info",onClick:e.withModifiers((e=>{return a=t.uid,void uni.navigateTo({url:`/pages/user_page/user_page?uid=${a}`});var a}),["stop"])},[e.createElementVNode("image",{src:t.avatar||"/default_avatar.jpg",class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-meta"},[e.createElementVNode("text",{class:"username"},e.toDisplayString((n=t.username,n.length>10?`${n.toString().slice(-8)}...`:n)),1),e.createElementVNode("view",{class:"like-count"},[e.createVNode(u,{type:"hand-up",size:"18",color:"#5f85a3"}),e.createElementVNode("text",{style:{margin:"0 5rpx",color:"#5f85a3"}},e.toDisplayString(t.like_count),1)])])],8,["onClick"]),(null==(o=t.image_urls)?void 0:o.length)>0?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.image_urls[0],mode:"aspectFill",class:"card-image","lazy-load":""},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"desc"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"goods-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.relation_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"tag-box",key:a},[e.createElementVNode("text",{class:"goods-tag"},e.toDisplayString(t.relation_goods_name||"未命名商品"),1)])))),128))])])],12,["id","onClick"])})),128))],4),e.createElementVNode("view",{class:"loading-state"},[s.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)])],32),e.createElementVNode("view",{class:"floating-button",onClick:z},[e.createVNode(u,{type:"plusempty",size:"30",color:"#fff"})]),e.createVNode(m,{name:"fade",mode:"out-in",duration:300},{default:e.withCtx((()=>[I.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"post-menu-mask",onClick:A})):e.createCommentVNode("",!0)])),_:1}),e.createElementVNode("view",{class:e.normalizeClass(["post-menu",{show:I.value}])},[e.createElementVNode("view",{class:"menu-item",onClick:L},[e.createVNode(u,{style:{"margin-right":"10rpx"},type:"color",size:"24",color:"#5f85a3"}),e.createElementVNode("text",null,"发搭配分享")]),e.createElementVNode("view",{class:"menu-item",onClick:$},[e.createVNode(u,{style:{"margin-right":"10rpx"},type:"compose",size:"24",color:"#5f85a3"}),e.createElementVNode("text",null,"发展示柜")])],2),e.createVNode(p,{visible:h.value,"onUpdate:visible":o[3]||(o[3]=e=>h.value=e),top:"0",width:"100%",height:"100%"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"modal-mask",onClick:e.withModifiers(X,["stop"])}),e.createElementVNode("view",{class:"filter-modal"},[e.createElementVNode("view",{class:"modal-header",style:e.normalizeStyle("margin-top:0rpx")},[e.createElementVNode("text",{class:"title"},"筛选看想要的娃物搭配吧！"),e.createElementVNode("text",{class:"close",onClick:X},"×")],4),e.createVNode(c,{mode:"fill",onSelect:Y,background:"#f8f8f8",width:"100%"}),e.createElementVNode("view",{class:"selected-goods"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.goods_id,class:"goods-tag",onClick:e.withModifiers((e=>Z(t.goods_id,e)),["stop"])},[e.createTextVNode(e.toDisplayString(t.goods_name)+" ",1),e.createElementVNode("text",{class:"remove"},"×")],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"action-btns"},[e.createElementVNode("button",{class:"btn reset",onClick:ee},"重置"),e.createElementVNode("button",{class:"btn confirm",onClick:Q},"应用筛选")])])])),_:1},8,["visible"])])])):e.createCommentVNode("",!0),e.createVNode(g,{show:k.value||s.value},null,8,["show"])])),_:1})],64)}}},Sl=V(xl,[["__scopeId","data-v-cf1ca9b2"]]),Cl=V({__name:"sale_news",setup(o){const n=e.ref({title:"",content:"",image_list:[],created_at:0}),l=e.ref({brand_name:"",logo:""}),s=e.ref(!0),r=e.ref(!1),c=e.ref(""),d=e.ref(0),m=e.ref(0),p=e.ref(!1),g=e.ref(null),v=e.ref(null);e.ref(1);let y=e.ref({});uni.getSystemInfoSync();const w=({parent:e,target:a})=>{var o;t("log","at pages/sale_news/sale_news.vue:109","parent",e),t("log","at pages/sale_news/sale_news.vue:110","target",a);let n=e;null!=a&&(n=a),y.value.id!=n.id?(t("log","at pages/sale_news/sale_news.vue:121","item",n),y.value=n,null==(o=v.value)||o.focusInput()):y.value={}};function _(e){uni.navigateTo({url:"/pages/brand/brand?brand_id="+e})}uni.setNavigationBarTitle({title:"图透详情"});const k=e=>{var a,o,n;let l=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/sale_news/sale_news.vue:209","reply_info",y.value);const s={content:e.content,origin:e.origin,target_id:parseInt(d.value),type:4,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...y.value.id&&{reply_id:y.value.id,reply_for:y.value.comment,reply_uid:y.value.user_id,parent_id:y.value.parent_id>0?y.value.parent_id:y.value.id}},i={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0},...e.association_id&&{association_id:e.association_id,association_type:e.association_type},...e.image_url&&{image_url:e.image_url},...y.value.id&&{reply_id:y.value.id,reply_for:y.value.comment,reply_uid:y.value.user_id,parent_id:y.value.parent_id>0?y.value.parent_id:y.value.id,reply_username:y.value.is_anonymous?"匿名用户":y.value.username}};y.value.id?0===y.value.parent_id?null==(o=g.value)||o.addReplyComment({...i,parent_id:y.value.id}):null==(n=g.value)||n.addReplyComment({...i,parent_id:y.value.parent_id}):null==(a=g.value)||a.addNewComment(i),uni.request({url:u.value+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:t=>{var a,o;if("success"==t.data.status){const o=t.data.data,n={...o,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0}};o.reply_uid&&y.value.is_anonymous&&(n.reply_username="匿名用户"),null==(a=g.value)||a.updateTempComment(i.id,n),uni.showToast({title:"评论成功",icon:"success"})}else null==(o=g.value)||o.removeTempComment(i.id),uni.showToast({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=g.value)||t.removeTempComment(i.id),uni.showToast({title:"网络请求失败",icon:"none"})}})};function N(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${s}`}const V=()=>{uni.request({url:u.value+"/brand-info?id="+m.value,success:e=>{"success"===e.data.status&&(l.value=e.data.data,uni.setNavigationBarTitle({title:e.data.data.brand_name}),x())},fail:()=>handleError("品牌信息加载失败")})},b=async()=>{if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});const e="/with-state/"+(p.value?"unlike":"add-like");uni.request({url:u.value+e,method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{id:parseInt(m.value),type:2},success:e=>{"success"===e.data.status&&(p.value=!p.value,uni.showToast({title:p.value?"关注成功":"已取消关注",icon:"none"}))}})},x=()=>{h.isLogin&&uni.request({url:`${u.value}/with-state/hasLike?id=${m.value}&type=2`,method:"POST",header:{Authorization:uni.getStorageSync("token")},success:e=>{var t;p.value=(null==(t=e.data.data)?void 0:t.id)>0}})};return i((e=>{e.id?(d.value=e.id,(async e=>{try{const t=await uni.request({url:`${u.value}/sale-news-detail?id=${e}`,timeout:5e3});"success"===t.data.status?(n.value={...t.data.data,image_list:t.data.data.image_list||[]},m.value=t.data.data.brand_id,V()):handleError(t.data.msg||"数据加载失败")}catch(a){t("error","at pages/sale_news/sale_news.vue:188","请求失败:",a),handleError("网络请求失败")}finally{s.value=!1}})(e.id),f().then(x)):handleError("缺少必要参数")})),(t,o)=>{const i=a(e.resolveDynamicComponent("view-logs"),E),u=a(e.resolveDynamicComponent("comment-list"),he),m=a(e.resolveDynamicComponent("comment-input"),we);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(i),e.createElementVNode("view",null,[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("swiper",{class:"swiper-box","indicator-dots":!0,autoplay:!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.image_list,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"swiper-image",onClick:e=>{uni.previewImage({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])))),128))])]),e.createElementVNode("view",{class:"brand-info"},[e.createElementVNode("image",{class:"brand-logo",src:l.value.logo_image,mode:"aspectFill",onClick:o[0]||(o[0]=e=>_(l.value.id))},null,8,["src"]),e.createElementVNode("view",{class:"brand-details",onClick:o[1]||(o[1]=e=>_(l.value.id))},[e.createElementVNode("text",{class:"brand-name"},e.toDisplayString(l.value.brand_name),1),e.createElementVNode("text",{class:"publish-time"},e.toDisplayString(N(n.value.created_at)),1)]),e.createElementVNode("text",{class:"follow",onClick:b,style:e.normalizeStyle({background:p.value?"#ff6a6c":"#65C3D6"})},e.toDisplayString(p.value?"已关注":"+ 关注品牌"),5)]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"title"},e.toDisplayString(n.value.title),1)]),e.createElementVNode("view",{style:{margin:"20rpx 0rpx"}},[e.createElementVNode("text",{class:"content"},e.toDisplayString(n.value.content),1)])]),e.createElementVNode("view",{style:{padding:"10px"}},[e.createVNode(u,{ref_key:"commentListRef",ref:g,type:4,"relation-id":parseInt(d.value),onReply:w},null,8,["relation-id"])]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error"},e.toDisplayString(c.value),1)):e.createCommentVNode("",!0),e.createVNode(m,{ref_key:"commentInputRef",ref:v,"reply-info":e.unref(y),"target-id":d.value,onSubmit:k,"onUpdate:replyInfo":o[2]||(o[2]=t=>e.isRef(y)?y.value=t:y=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}})])],64)}}},[["__scopeId","data-v-3519db80"]]),Bl={__name:"treehole_publish",setup(o){const n=e.ref(""),l=e.ref(0),s=e.ref([]),i=e.ref([]),r=e.ref(""),c=e.ref(-1),d=e.ref("");function p(e){uni.previewImage({current:s.value[e],urls:s.value})}function h(e){l.value=e.detail.value.length>0?1:0}uni.setNavigationBarTitle({title:"投稿树洞"});function g(e){const t=e.detail.value;t>=0&&i.value[t]&&(c.value=t,r.value=i.value[t].value,d.value=i.value[t].label)}const v=e.computed((()=>n.value.trim().length>0&&null!==r.value));async function f(){if(v.value)if(r.value)try{uni.showLoading({title:"提交中..."});const e=uni.getStorageSync("token");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});const t={content:n.value.trim(),images:s.value,is_anonymous:l.value,category_id:r.value},a=await uni.request({url:u.value+"/with-state/add-submission",method:"POST",data:t,header:{"Content-Type":"application/json",Authorization:e}});uni.hideLoading(),"success"==a.data.status?(uni.showToast({title:"已收到您的投稿",icon:"success"}),setTimeout((()=>{n.value="",s.value=[],l.value=0,uni.navigateBack()}),1500)):uni.showToast({title:a.data.msg||"提交失败",icon:"none"})}catch(e){uni.hideLoading(),t("error","at pages/treehole_publish/treehole_publish.vue:237","提交失败:",e),uni.showToast({title:"网络请求失败",icon:"none"})}else uni.showToast({title:"请选择分类",icon:"none"})}return e.onMounted((()=>{(async()=>{try{const e=await uni.request({url:u.value+"/treehole-typelist",method:"GET"});"success"===e.data.status&&(i.value=Object.entries(e.data.data).map((([e,t])=>({value:Number(e),label:t}))))}catch(e){t("error","at pages/treehole_publish/treehole_publish.vue:151","获取分类失败:",e)}})()})),(o,u)=>{const y=a(e.resolveDynamicComponent("view-logs"),E),w=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{title:"发布树洞"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(y),e.createElementVNode("view",{class:"publish-box"},[e.createElementVNode("picker",{class:"category-picker",range:i.value,"range-key":"label",onChange:g,value:c.value},[e.createElementVNode("view",{class:"picker-content"},[e.createElementVNode("text",{class:e.normalizeClass(["picker-text",r.value?"":"placeholder"])},e.toDisplayString(d.value||"请选择分类（必选）"),3),e.createVNode(w,{type:"right",size:"22",color:"#888"})])],40,["range","value"]),e.createElementVNode("scroll-view",{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload_item",key:a},[e.createElementVNode("image",{src:t,class:"uploaded_image",onClick:p,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("image",{src:F,class:"close_icon",onClick:e=>o.deleteImage(a)},null,8,["onClick"])])))),128)),e.createElementVNode("view",{class:"uploadImageBox",style:{background:"#f8f8f8"}},[e.createElementVNode("image",{src:cl,class:"upload_img",onClick:u[0]||(u[0]=e=>(o.index,t("log","at pages/treehole_publish/treehole_publish.vue:109","openSelect"),void ge().then((e=>{fe().then((a=>{t("log","at pages/treehole_publish/treehole_publish.vue:112",a),ye(e,a.token,a.path).then((e=>{200!=e.statusCode&&uni.showToast({title:"上传失败",icon:"none"}),t("log","at pages/treehole_publish/treehole_publish.vue:121",m+a.path),s.value.push(m+a.path),uni.showToast({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])]),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":u[1]||(u[1]=e=>n.value=e),placeholder:"写下你想说的话...",class:"textarea",maxlength:"500"},null,512),[[e.vModelText,n.value]]),e.createElementVNode("view",{class:"anonymous"},[e.createElementVNode("checkbox-group",{onChange:h},[e.createElementVNode("label",null,[e.createElementVNode("checkbox",{checked:1===l.value,color:"#4cbbd0"},null,8,["checked"]),e.createElementVNode("text",null,"匿名发布")])],32)]),e.createElementVNode("view",{class:"publish-detail"},[e.createElementVNode("text",null,"* 目前树洞为非审稿发布，只接受娃圈相关内容。"),e.createElementVNode("text",null,"* 如果勾选匿名发布，他人将无法通过稿件进入您的主页。如果稿件遭到过多点踩或投诉，我们可能会隐藏这封稿件。")]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{disabled:!v.value}]),onClick:f}," 提交 ",2)])])}}},Tl=V(Bl,[["__scopeId","data-v-1bf33a46"]]),Dl={__name:"treehole_detail",props:{id:{type:String,required:!0}},setup(o){e.ref(!0),e.ref(!1),e.ref("");const n=e.ref(0),l=e.ref(null),s=e.ref(null),i=e.ref(null);e.ref(1);let r=e.ref({});e.ref({});const c=e.ref(!1),d=o,m=({parent:e,target:t})=>{var a;const o=t||e;r.value=o,null==(a=i.value)||a.focusInput()},p=e=>{var a,o,l;let i=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});t("log","at pages/treehole_detail/treehole_detail.vue:136","reply_info",r.value);const c={content:e.content,origin:e.origin,target_id:parseInt(n.value),type:5,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...r.value.id&&{reply_id:r.value.id,reply_for:r.value.comment,reply_uid:r.value.user_id,parent_id:r.value.parent_id>0?r.value.parent_id:r.value.id}},d={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0},...e.association_id&&{association_id:e.association_id,association_type:e.association_type},...e.image_url&&{image_url:e.image_url},...r.value.id&&{reply_id:r.value.id,reply_for:r.value.comment,reply_uid:r.value.user_id,parent_id:r.value.parent_id>0?r.value.parent_id:r.value.id,reply_username:r.value.is_anonymous?"匿名用户":r.value.username}};r.value.id?0===r.value.parent_id?null==(o=s.value)||o.addReplyComment({...d,parent_id:r.value.id}):null==(l=s.value)||l.addReplyComment({...d,parent_id:r.value.parent_id}):null==(a=s.value)||a.addNewComment(d),uni.request({url:u.value+"/with-state/add-comment",method:"POST",header:{Authorization:i},data:c,success:t=>{var a,o;if("success"==t.data.status){const o=t.data.data,n={...o,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0}};o.reply_uid&&r.value.is_anonymous&&(n.reply_username="匿名用户"),null==(a=s.value)||a.updateTempComment(d.id,n),uni.showToast({title:"评论成功",icon:"success"})}else null==(o=s.value)||o.removeTempComment(d.id),uni.showToast({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=s.value)||t.removeTempComment(d.id),uni.showToast({title:"网络请求失败",icon:"none"})}})};const g=()=>{if(!h.isLogin)return void uni.showModal({title:"提示",content:"需要登录后才能点赞",success:e=>{e.confirm&&uni.navigateTo({url:"/pages/login/login"})}});const e=uni.getStorageSync("token"),t=u.value+(c.value?"/with-state/unlike":"/with-state/add-like");uni.request({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(d.id),type:5},success:e=>{"success"===e.data.status&&(c.value=!c.value,l.value.like_count+=c.value?1:-1)}})};const v=e.computed((()=>{var e,t;return(null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.slice(0,9))||[]})),y=e.computed((()=>{var e,t;return((null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.length)||0)-9})),w=e.computed((()=>{var e,t;return((null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.length)||0)>9}));uni.setNavigationBarTitle({title:"投稿详情"});const _=e.computed((()=>{const e=v.value.length;return 1===e?"single":2===e?"double":"multi"})),k=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return e.onMounted((async()=>{n.value=d.id,t("log","at pages/treehole_detail/treehole_detail.vue:427","pageId",n.value);try{const e=await uni.request({url:`${u.value}/treehole-detail?id=${d.id}`});"success"===e.data.status&&(l.value=e.data.data)}catch(e){t("log","at pages/treehole_detail/treehole_detail.vue:438",e),uni.showToast({title:"加载失败",icon:"none"})}f(),function(){let e=uni.getStorageSync("token");""!=e&&uni.request({url:u.value+"/with-state/hasLike?id="+d.id+"&type=5",method:"POST",header:{Authorization:e},success:e=>{t("log","at pages/treehole_detail/treehole_detail.vue:343",e.data),"success"==e.data.status?e.data.data.id>0?c.value=!0:c.value=!1:uni.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t("log","at pages/treehole_detail/treehole_detail.vue:361",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}()})),(t,o)=>{const u=a(e.resolveDynamicComponent("view-logs"),E),h=a(e.resolveDynamicComponent("report-button"),me),f=a(e.resolveDynamicComponent("uni-icons"),b),N=a(e.resolveDynamicComponent("comment-list"),he),V=a(e.resolveDynamicComponent("comment-input"),we);return e.openBlock(),e.createElementBlock(e.Fragment,null,[l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(u),e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"author-info"},[e.createElementVNode("image",{src:l.value.avatar||"/static/noname.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{style:{width:"500rpx"}},[e.createElementVNode("text",{class:"author-name"},e.toDisplayString(l.value.author_name),1),e.createElementVNode("view",{class:"time"},e.toDisplayString(k(l.value.created_at)),1)]),e.createElementVNode("view",{style:{width:"120rpx"}},[e.createVNode(h,{"report-type":"3","relation-id":parseInt(d.id),"button-text":"举报","icon-type":"flag","icon-size":"24","icon-color":"#666"},null,8,["relation-id"])])])]),e.createElementVNode("view",{class:"content"},e.toDisplayString(l.value.content),1),e.createElementVNode("view",{class:e.normalizeClass(["image-container",_.value])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"image-wrapper"},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"image-item",onClick:e=>(e=>{uni.previewImage({current:e,urls:l.value.images})})(a)},null,8,["src","onClick"]),w.value&&8===a?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-overlay"}," +"+e.toDisplayString(y.value),1)):e.createCommentVNode("",!0)])))),128))],2),e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("view",{class:"action-group"},[e.createElementVNode("view",{class:"action-item",onClick:g},[e.createVNode(f,{type:c.value?"hand-up-filled":"hand-up",size:"24",color:c.value?"#ff4d4f":"#666"},null,8,["type","color"]),e.createElementVNode("text",{class:"action-text"},e.toDisplayString(l.value.like_count||0),1)]),e.createElementVNode("view",{class:"action-item",onClick:o[0]||(o[0]=e=>function(e){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+e.id;uni.setClipboardData({data:t,success:function(){uni.showToast({title:"复制链接成功",icon:"none"})}})}(l.value))},[e.createVNode(f,{type:"redo",size:"24",color:"#666"}),e.createElementVNode("text",{class:"action-text"},"分享")])]),l.value.approve_time>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"time-text"},"审核于 "+e.toDisplayString(k(l.value.approve_time)),1)):e.createCommentVNode("",!0)])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading"},"加载中...")),e.createElementVNode("view",{style:{padding:"10px"}},[e.createVNode(N,{ref_key:"commentListRef",ref:s,type:5,"relation-id":parseInt(d.id),onReply:m},null,8,["relation-id"])]),e.createVNode(V,{ref_key:"commentInputRef",ref:i,"reply-info":e.unref(r),"target-id":n.value,onSubmit:p,"onUpdate:replyInfo":o[1]||(o[1]=t=>e.isRef(r)?r.value=t:r=t)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}})],64)}}},Il=V({__name:"reset_password",setup(t){const o=e.ref({telephone:"",code:"",newPassword:"",reNewPassword:""}),n=e.ref({phone:"",code:"",newPassword:"",reNewPassword:""}),l=e.ref(0),s=e.computed((()=>l.value>0)),i=e.computed((()=>l.value>0?`${l.value}秒后重发`:"获取验证码")),r=e.ref(!1),c=()=>o.value.telephone?/^1[3-9]\d{9}$/.test(o.value.telephone)?(n.value.phone="",!0):(n.value.phone="手机号格式不正确",!1):(n.value.phone="手机号不能为空",!1),d=async()=>{if(c())try{const e=await uni.request({url:`${u.value}/send-sms-code`,method:"POST",data:{tel_phone:o.value.telephone}});"success"===e.data.status?(v(),uni.showToast({title:"验证码已发送",icon:"none"})):uni.showToast({title:e.data.msg||"发送失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}},m=()=>o.value.newPassword.length<6?(n.value.newPassword="密码至少需要6位",!1):(n.value.newPassword="",!0),p=()=>o.value.newPassword!==o.value.reNewPassword?(n.value.reNewPassword="两次密码输入不一致",!1):(n.value.reNewPassword="",!0),h=()=>o.value.code?6!==o.value.code.length?(n.value.code="验证码格式不正确",!1):(n.value.code="",!0):(n.value.code="验证码不能为空",!1),g=async()=>{if([c(),h(),m(),p()].every((e=>e)))try{r.value=!0;const e=await uni.request({url:`${u.value}/reset-password`,method:"POST",data:{telephone:o.value.telephone,code:o.value.code,password:o.value.newPassword,re_password:o.value.reNewPassword}});"success"===e.data.status?uni.showToast({title:"密码重置成功",icon:"success",complete:()=>{setTimeout((()=>{uni.navigateBack()}),1500)}}):uni.showToast({title:e.data.msg||"重置失败",icon:"none"})}catch(e){uni.showToast({title:"网络请求失败",icon:"none"})}finally{r.value=!1}},v=()=>{l.value=60;const e=setInterval((()=>{l.value<=0?clearInterval(e):l.value--}),1e3)},f=()=>{uni.navigateBack()};return(t,l)=>{const u=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(u),e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"重置密码")]),e.createElementVNode("view",{class:"form-box"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("text",{class:"prefix"},"+86"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:c},null,544),[[e.vModelText,o.value.telephone]])]),n.value.phone?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.phone),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"code-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.code=e),type:"number",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:h},null,544),[[e.vModelText,o.value.code]]),e.createElementVNode("button",{class:e.normalizeClass(["code-btn",{disabled:s.value}]),disabled:s.value,onClick:d},e.toDisplayString(i.value),11,["disabled"])]),n.value.code?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.code),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.newPassword=e),type:"password",placeholder:"请输入新密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:m},null,544),[[e.vModelText,o.value.newPassword]])]),n.value.newPassword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.newPassword),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.reNewPassword=e),type:"password",placeholder:"请再次输入新密码",class:"input","placeholder-class":"placeholder",onBlur:p},null,544),[[e.vModelText,o.value.reNewPassword]])]),n.value.reNewPassword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.value.reNewPassword),1)):e.createCommentVNode("",!0)]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{loading:r.value}]),disabled:r.value,onClick:g},e.toDisplayString(r.value?"提交中...":"重置密码"),11,["disabled"]),e.createElementVNode("view",{class:"bottom-tips"},[e.createElementVNode("text",{class:"link-text",onClick:f},"返回登录")])])])],64)}}},[["__scopeId","data-v-ed0733fa"]]),zl=V({__name:"username",setup(t){uni.setNavigationBarTitle({title:"修改用户名"});const o=e.ref(h.userInfo.username||""),n=e.ref(!1),l=e.computed((()=>o.value.length>=2&&o.value!==h.userInfo.username));async function s(){if(l.value)try{n.value=!0;const e=await uni.request({url:u.value+"/with-state/update-profile",method:"POST",header:{Authorization:uni.getStorageSync("token")},data:{username:o.value}});"success"===e.data.status?(uni.showToast({title:"更新成功",icon:"success"}),await v(),setTimeout((()=>uni.navigateBack()),1500)):uni.showToast({title:e.data.msg||"更新失败",icon:"none"})}catch(e){uni.showToast({title:"请求失败，请稍后重试",icon:"none"})}finally{n.value=!1}}return(t,i)=>{const r=a(e.resolveDynamicComponent("view-logs"),E),c=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(r),e.createElementVNode("view",{class:"password-container"},[e.createElementVNode("view",{class:"form-wrapper"},[e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:" ","onUpdate:modelValue":i[0]||(i[0]=e=>o.value=e),maxlength:"20"},null,512),[[e.vModelText,o.value]]),e.createElementVNode("label",{class:"floating-label"},"用户名"),e.createVNode(c,{class:"input-icon",type:"person",size:"18",color:"#999"})])]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{active:l.value}]),onClick:s,disabled:!l.value},[e.createTextVNode(e.toDisplayString(n.value?"提交中...":"更新用户名")+" ",1),n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"})):e.createCommentVNode("",!0)],10,["disabled"])]),e.createElementVNode("view",{class:"security-tips"},[e.createVNode(c,{type:"info",size:"16",color:"#666"}),e.createElementVNode("text",null,"用户名2-20个字符，支持中英文、数字和下划线")])])],64)}}},[["__scopeId","data-v-c4a49249"]]),Al=V({__name:"my_comment",setup(t){const o=e.ref([]),n=e.ref(1),l=e.ref(10),s=e.ref(0),i=e.ref(!1),r=e.ref(!1),c={1:{name:"品牌",class:"brand"},2:{name:"商品",class:"goods"},3:{name:"搭配",class:"collocation"},4:{name:"资讯",class:"news"},5:{name:"树洞",class:"treehole"},6:{name:"展示柜",class:"collocation"},7:{name:"文章",class:"collocation"}};e.onMounted((()=>{d()}));const d=async(e=!1)=>{if(!i.value&&!r.value){i.value=!0;try{const t=await uni.request({url:`${u.value}/with-state/my-comment`,method:"GET",header:{Authorization:uni.getStorageSync("token")},data:{page:n.value,page_size:l.value}});if("success"===t.data.status){const a=t.data.data;o.value=e?[...o.value,...a.comment_list]:a.comment_list,s.value=a.total,n.value++,r.value=o.value.length>=s.value}}finally{i.value=!1}}},m=()=>{r.value||d(!0)},p=e=>{let t="";const a=e.relation_id;switch(e.type){case 1:t=`/pages/brand/brand?brand_id=${a}`;break;case 2:t=`/pages/goods/goods?goods_id=${a}`;break;case 3:t=`/pages/collocation_share/collocation_share?collocation_id=${a}&origin=1`;break;case 4:t=`/pages/sale_news/sale_news?id=${a}&brand_id=0`;break;case 5:t=`/pages/treehole_detail/treehole_detail?id=${a}`;break;case 6:t=`/pages/collocation_share/collocation_share?collocation_id=${a}&origin=2`;break;default:return void uni.showToast({title:"未知类型",icon:"none"})}t&&uni.navigateTo({url:t})},h=e=>{var t;return(null==(t=c[e])?void 0:t.name)||"未知"};function g(e){const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}return uni.setNavigationBarTitle({title:"我的评论"}),(t,n)=>{const l=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createVNode(l),e.createElementVNode("scroll-view",{class:"comment-list","scroll-y":"",onScrolltolower:m,"show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>{return e.openBlock(),e.createElementBlock("view",{key:a,class:"comment-item",onClick:e=>p(t)},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{class:"avatar",src:t.avatar||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-meta"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(t.username),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(g(t.created_at)),1)])]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"content"},e.toDisplayString(t.comment),1)]),e.createElementVNode("view",{class:"target-box",onClick:e=>p(t)},[t.target_image?(e.openBlock(),e.createElementBlock("image",{key:0,class:"target-image",src:t.target_image,mode:"aspectFill"},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"target-info"},[e.createElementVNode("view",{class:e.normalizeClass(["type-tag",(o=t.type,(null==(n=c[o])?void 0:n.class)||"")])},e.toDisplayString(h(t.type)),3),e.createElementVNode("text",{class:"target-name"},e.toDisplayString(t.target_name),1)])],8,["onClick"])],8,["onClick"]);var o,n})),128)),e.createElementVNode("view",{class:"loading-status"},[i.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"loading-text"},"加载中...")):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-more-text"},"没有更多了")):e.createCommentVNode("",!0)])],32)])}}},[["__scopeId","data-v-d36fa393"]]),Pl=V({__name:"my_collocation",setup(t){const o=e.ref([]),n=e.ref(1),l=e.ref(10),s=e.ref(0),i=e.ref(!1),r=e.ref(!1),c=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`},d=async()=>{if(!r.value&&!i.value){i.value=!0;try{if(!(await f()))return;const e=await uni.request({url:`${u.value}/with-state/my-collocation`,method:"GET",header:{Authorization:uni.getStorageSync("token")},data:{page:n.value,page_size:l.value}});"success"===e.data.status&&(o.value=[...o.value,...e.data.data.collocation_relation_list],s.value=e.data.data.total,r.value=o.value.length>=s.value,n.value++)}catch(e){uni.showToast({title:"加载失败",icon:"none"})}finally{i.value=!1}}},p=()=>{r.value||d()};return uni.setNavigationBarTitle({title:"我的搭配"}),e.onMounted((()=>{d()})),(t,n)=>{const l=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("meta",{name:"theme-color",content:"#F8F8F8"}),e.createVNode(l),e.createElementVNode("scroll-view",{class:"scroll-content","scroll-y":"",onScrolltolower:p,"show-scrollbar":!1},[0!==o.value.length||i.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"}," 暂无发布的搭配，快去创建吧~ ")),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"collocation-card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("image",{class:"avatar",src:t.avatar||`${e.unref(m)}/default-avatar.png`,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"time"},e.toDisplayString(c(t.created_at)),1)]),e.createElementVNode("view",{class:"image-container"},[t.image_urls.length>1?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"swiper-box",autoplay:!1,circular:!0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.image_urls,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{class:"swiper-image",src:t,mode:"aspectFill","lazy-load":"",style:{aspectRatio:"3/4"}},null,8,["src"])])))),128))])):(e.openBlock(),e.createElementBlock("image",{key:1,class:"single-image",src:t.image_urls[0],mode:"aspectFill","lazy-load":"",style:{aspectRatio:"3/4"}},null,8,["src"]))]),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"content"},e.toDisplayString(t.content),1)]),t.relation_list.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"relation-box"},[e.createElementVNode("text",{class:"relation-label"},"搭配包含："),e.createElementVNode("scroll-view",{"scroll-x":"",class:"tag-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.relation_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"relation-tag"},e.toDisplayString(t.type)+"·"+e.toDisplayString(t.relation_goods_name||t.relation_brand_name),1)))),128))])])):e.createCommentVNode("",!0)])))),128)),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-box"},[e.createElementVNode("image",{src:"/static/images/loading.gif",class:"loading-icon"}),e.createElementVNode("text",null,"加载中...")])):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"no-more"},"没有更多了～")):e.createCommentVNode("",!0)],32)])}}},[["__scopeId","data-v-7890bff4"]]),Ll=e=>{(e.$wxs||(e.$wxs=[])).push("handler"),(e.$wxsModules||(e.$wxsModules={})).handler="2f992f8c"},$l={name:"node",options:{},data:()=>({ctrl:{}}),props:{name:String,attrs:{type:Object,default:()=>({})},childs:Array,opts:Array},components:{},mounted(){if(this.$nextTick((()=>{for(this.root=this.$parent;"mp-html"!==this.root.$options.name;this.root=this.root.$parent);})),this.opts[0]){let e;for(e=this.childs.length;e--&&"img"!==this.childs[e].name;);-1!==e&&(this.observer=uni.createIntersectionObserver(this).relativeToViewport({top:500,bottom:500}),this.observer.observe("._img",(e=>{e.intersectionRatio&&(this.$set(this.ctrl,"load",1),this.observer.disconnect())})))}},beforeDestroy(){this.observer&&this.observer.disconnect()},methods:{play(e){const t=e.currentTarget.dataset.i,a=this.childs[t];this.root.$emit("play",{source:a.name,attrs:{...a.attrs,src:a.src[this.ctrl[t]||0]}})},imgTap(e){const t=this.childs[e.currentTarget.dataset.i];t.a?this.linkTap(t.a):t.attrs.ignore||(t.attrs.src=t.attrs.src||t.attrs["data-src"],this.root.$emit("imgtap",t.attrs),this.root.previewImg&&uni.previewImage({current:parseInt(t.attrs.i),urls:this.root.imgList}))},imgLongTap(e){const t=this.childs[e.currentTarget.dataset.i].attrs;this.opts[3]&&!t.ignore&&uni.showActionSheet({itemList:["保存图片"],success:()=>{const e=e=>{uni.saveImageToPhotosAlbum({filePath:e,success(){uni.showToast({title:"保存成功"})}})};this.root.imgList[t.i].startsWith("http")?uni.downloadFile({url:this.root.imgList[t.i],success:t=>e(t.tempFilePath)}):e(this.root.imgList[t.i])}})},imgLoad(e){const t=e.currentTarget.dataset.i;this.childs[t].w?(this.opts[1]&&!this.ctrl[t]||-1===this.ctrl[t])&&this.$set(this.ctrl,t,1):this.$set(this.ctrl,t,e.detail.width),this.checkReady()},checkReady(){this.root&&!this.root.lazyLoad&&(this.root._unloadimgs-=1,this.root._unloadimgs||setTimeout((()=>{this.root.getRect().then((e=>{this.root.$emit("ready",e)})).catch((()=>{this.root.$emit("ready",{})}))}),350))},linkTap(e){const t=e.currentTarget?this.childs[e.currentTarget.dataset.i]:{},a=t.attrs||e,o=a.href;this.root.$emit("linktap",Object.assign({innerText:this.root.getText(t.children||[])},a)),o&&("#"===o[0]?this.root.navigateTo(o.substring(1)).catch((()=>{})):o.split("?")[0].includes("://")?this.root.copyLink&&plus.runtime.openWeb(o):uni.navigateTo({url:o,fail(){uni.switchTab({url:o,fail(){}})}}))},mediaError(e){const t=e.currentTarget.dataset.i,a=this.childs[t];if("video"===a.name||"audio"===a.name){let e=(this.ctrl[t]||0)+1;if(e>a.src.length&&(e=0),e<a.src.length)return void this.$set(this.ctrl,t,e)}else"img"===a.name&&(this.opts[2]&&this.$set(this.ctrl,t,-1),this.checkReady());this.root&&this.root.$emit("error",{source:a.name,attrs:a.attrs,errMsg:e.detail.errMsg})}}};Ll($l);const Fl=V($l,[["render",function(t,a,o,n,l,s){const i=e.resolveComponent("node",!0);return e.openBlock(),e.createElementBlock("view",{id:o.attrs.id,class:e.normalizeClass("_block _"+o.name+" "+o.attrs.class),style:e.normalizeStyle(o.attrs.style)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.childs,((t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:n},["img"===t.name&&!t.t&&(o.opts[1]&&!l.ctrl[n]||l.ctrl[n]<0)?(e.openBlock(),e.createElementBlock("image",{key:0,class:"_img",style:e.normalizeStyle(t.attrs.style),src:l.ctrl[n]<0?o.opts[2]:o.opts[1],mode:"widthFix"},null,12,["src"])):e.createCommentVNode("",!0),"img"===t.name&&t.t?(e.openBlock(),e.createElementBlock("rich-text",{key:1,style:e.normalizeStyle("display:"+t.t),nodes:[{attrs:{style:t.attrs.style||"",src:t.attrs.src},name:"img"}],"data-i":n,onClick:a[0]||(a[0]=e.withModifiers(((...e)=>s.imgTap&&s.imgTap(...e)),["stop"]))},null,12,["nodes","data-i"])):"img"===t.name?(e.openBlock(),e.createElementBlock("image",{key:2,id:t.attrs.id,class:e.normalizeClass("_img "+t.attrs.class),style:e.normalizeStyle((-1===l.ctrl[n]?"display:none;":"")+"width:"+(l.ctrl[n]||1)+"px;"+t.attrs.style),src:t.attrs.src||(l.ctrl.load?t.attrs["data-src"]:""),mode:t.h?t.w?t.m||"":"heightFix":"widthFix","data-i":n,onLoad:a[1]||(a[1]=(...e)=>s.imgLoad&&s.imgLoad(...e)),onError:a[2]||(a[2]=(...e)=>s.mediaError&&s.mediaError(...e)),onClick:a[3]||(a[3]=e.withModifiers(((...e)=>s.imgTap&&s.imgTap(...e)),["stop"])),onLongpress:a[4]||(a[4]=(...e)=>s.imgLongTap&&s.imgLongTap(...e))},null,46,["id","src","mode","data-i"])):t.text?(e.openBlock(),e.createElementBlock("text",{key:3,decode:""},e.toDisplayString(t.text),1)):"br"===t.name?(e.openBlock(),e.createElementBlock("text",{key:4},"\\n")):"a"===t.name?(e.openBlock(),e.createElementBlock("view",{key:5,id:t.attrs.id,class:e.normalizeClass((t.attrs.href?"_a ":"")+t.attrs.class),"hover-class":"_hover",style:e.normalizeStyle("display:inline;"+t.attrs.style),"data-i":n,onClick:a[5]||(a[5]=e.withModifiers(((...e)=>s.linkTap&&s.linkTap(...e)),["stop"]))},[e.createVNode(i,{name:"span",childs:t.children,opts:o.opts,style:{display:"inherit"}},null,8,["childs","opts"])],14,["id","data-i"])):t.html?(e.openBlock(),e.createElementBlock("view",{key:6,id:t.attrs.id,class:e.normalizeClass("_video "+t.attrs.class),style:e.normalizeStyle(t.attrs.style),innerHTML:t.html,"data-i":n,onVplay:a[6]||(a[6]=e.withModifiers(((...e)=>s.play&&s.play(...e)),["stop"]))},null,46,["id","innerHTML","data-i"])):"iframe"===t.name?(e.openBlock(),e.createElementBlock("iframe",{key:7,style:e.normalizeStyle(t.attrs.style),allowfullscreen:t.attrs.allowfullscreen,frameborder:t.attrs.frameborder,src:t.attrs.src},null,12,["allowfullscreen","frameborder","src"])):"embed"===t.name?(e.openBlock(),e.createElementBlock("embed",{key:8,style:e.normalizeStyle(t.attrs.style),src:t.attrs.src},null,12,["src"])):"table"===t.name&&t.c||"li"===t.name?(e.openBlock(),e.createElementBlock("view",{key:9,id:t.attrs.id,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},["li"===t.name?(e.openBlock(),e.createBlock(i,{key:0,childs:t.children,opts:o.opts},null,8,["childs","opts"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(t.children,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},["td"===t.name||"th"===t.name?(e.openBlock(),e.createBlock(i,{key:0,childs:t.children,opts:o.opts},null,8,["childs","opts"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(t.children,((t,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:a},["td"===t.name||"th"===t.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},[e.createVNode(i,{childs:t.children,opts:o.opts},null,8,["childs","opts"])],6)):(e.openBlock(),e.createElementBlock("view",{key:1,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.children,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass("_"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.attrs.style)},[e.createVNode(i,{childs:t.children,opts:o.opts},null,8,["childs","opts"])],6)))),128))],6))],64)))),128))],6)))),128))],14,["id"])):t.c?2===t.c?(e.openBlock(),e.createElementBlock("view",{key:11,id:t.attrs.id,class:e.normalizeClass("_block _"+t.name+" "+t.attrs.class),style:e.normalizeStyle(t.f+";"+t.attrs.style)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.children,((t,a)=>(e.openBlock(),e.createBlock(i,{key:a,style:e.normalizeStyle(t.f),name:t.name,attrs:t.attrs,childs:t.children,opts:o.opts},null,8,["style","name","attrs","childs","opts"])))),128))],14,["id"])):(e.openBlock(),e.createBlock(i,{key:12,style:e.normalizeStyle(t.f),name:t.name,attrs:t.attrs,childs:t.children,opts:o.opts},null,8,["style","name","attrs","childs","opts"])):(e.openBlock(),e.createElementBlock("rich-text",{key:10,id:t.attrs.id,style:e.normalizeStyle("display:inline;"+t.f),preview:!1,selectable:o.opts[4],"user-select":o.opts[4],nodes:[t]},null,12,["id","selectable","user-select","nodes"]))],64)))),128))],14,["id"])}],["__scopeId","data-v-39dba710"]]),Ml={trustTags:Hl("a,abbr,ad,audio,b,blockquote,br,code,col,colgroup,dd,del,dl,dt,div,em,fieldset,h1,h2,h3,h4,h5,h6,hr,i,img,ins,label,legend,li,ol,p,q,ruby,rt,source,span,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,title,ul,video"),blockTags:Hl("address,article,aside,body,caption,center,cite,footer,header,html,nav,pre,section"),inlineTags:Hl("abbr,b,big,code,del,em,i,ins,label,q,small,span,strong,sub,sup"),ignoreTags:Hl("area,base,canvas,embed,frame,head,iframe,input,link,map,meta,param,rp,script,source,style,textarea,title,track,wbr"),voidTags:Hl("area,base,br,col,circle,ellipse,embed,frame,hr,img,input,line,link,meta,param,path,polygon,rect,source,track,use,wbr"),entities:{lt:"<",gt:">",quot:'"',apos:"'",ensp:" ",emsp:" ",nbsp:" ",semi:";",ndash:"–",mdash:"—",middot:"·",lsquo:"‘",rsquo:"’",ldquo:"“",rdquo:"”",bull:"•",hellip:"…",larr:"←",uarr:"↑",rarr:"→",darr:"↓"},tagStyle:{address:"font-style:italic",big:"display:inline;font-size:1.2em",caption:"display:table-caption;text-align:center",center:"text-align:center",cite:"font-style:italic",dd:"margin-left:40px",mark:"background-color:yellow",pre:"font-family:monospace;white-space:pre",s:"text-decoration:line-through",small:"display:inline;font-size:0.8em",strike:"text-decoration:line-through",u:"text-decoration:underline"},svgDict:{animatetransform:"animateTransform",lineargradient:"linearGradient",viewbox:"viewBox",attributename:"attributeName",repeatcount:"repeatCount",repeatdur:"repeatDur",foreignobject:"foreignObject"}},Rl={};let Ol;const ql=uni.getSystemInfoSync();Ol=ql.windowWidth;const Ul=Hl(" ,\r,\n,\t,\f");let jl=0;function Hl(e){const t=Object.create(null),a=e.split(",");for(let o=a.length;o--;)t[a[o]]=!0;return t}function Gl(e,t){let a=e.indexOf("&");for(;-1!==a;){const o=e.indexOf(";",a+3);let n;if(-1===o)break;"#"===e[a+1]?(n=parseInt(("x"===e[a+2]?"0":"")+e.substring(a+2,o)),isNaN(n)||(e=e.substr(0,a)+String.fromCharCode(n)+e.substr(o+1))):(n=e.substring(a+1,o),(Ml.entities[n]||"amp"===n&&t)&&(e=e.substr(0,a)+(Ml.entities[n]||"&")+e.substr(o+1))),a=e.indexOf("&",a+1)}return e}function Wl(e){let t=e.length-1;for(let a=t;a>=-1;a--)(-1===a||e[a].c||!e[a].name||"div"!==e[a].name&&"p"!==e[a].name&&"h"!==e[a].name[0]||(e[a].attrs.style||"").includes("inline"))&&(t-a>=5&&e.splice(a+1,t-a,{name:"div",attrs:{},children:e.slice(a+1,t+1)}),t=a-1)}function Jl(e){this.options=e||{},this.tagStyle=Object.assign({},Ml.tagStyle,this.options.tagStyle),this.imgList=e.imgList||[],this.imgList._unloadimgs=0,this.plugins=e.plugins||[],this.attrs=Object.create(null),this.stack=[],this.nodes=[],this.pre=(this.options.containerStyle||"").includes("white-space")&&this.options.containerStyle.includes("pre")?2:0}function Kl(e){this.handler=e}Ml.ignoreTags.iframe=void 0,Ml.trustTags.iframe=!0,Ml.ignoreTags.embed=void 0,Ml.trustTags.embed=!0,Jl.prototype.parse=function(e){for(let t=this.plugins.length;t--;)this.plugins[t].onUpdate&&(e=this.plugins[t].onUpdate(e,Ml)||e);for(new Kl(this).parse(e);this.stack.length;)this.popNode();return this.nodes.length>50&&Wl(this.nodes),this.nodes},Jl.prototype.expose=function(){for(let e=this.stack.length;e--;){const t=this.stack[e];if(t.c||"a"===t.name||"video"===t.name||"audio"===t.name)return;t.c=1}},Jl.prototype.hook=function(e){for(let t=this.plugins.length;t--;)if(this.plugins[t].onParse&&!1===this.plugins[t].onParse(e,this))return!1;return!0},Jl.prototype.getUrl=function(e){const t=this.options.domain;return"/"===e[0]?e="/"===e[1]?(t?t.split("://")[0]:"http")+":"+e:t?t+e:plus.io.convertLocalFileSystemURL(e):e.includes("data:")||e.includes("://")||(e=t?t+"/"+e:plus.io.convertLocalFileSystemURL(e)),e},Jl.prototype.parseStyle=function(e){const t=e.attrs,a=(this.tagStyle[e.name]||"").split(";").concat((t.style||"").split(";")),o={};let n="";t.id&&!this.xml&&(this.options.useAnchor?this.expose():"img"!==e.name&&"a"!==e.name&&"video"!==e.name&&"audio"!==e.name&&(t.id=void 0)),t.width&&(o.width=parseFloat(t.width)+(t.width.includes("%")?"%":"px"),t.width=void 0),t.height&&(o.height=parseFloat(t.height)+(t.height.includes("%")?"%":"px"),t.height=void 0);for(let l=0,s=a.length;l<s;l++){const e=a[l].split(":");if(e.length<2)continue;const t=e.shift().trim().toLowerCase();let s=e.join(":").trim();if("-"===s[0]&&s.lastIndexOf("-")>0||s.includes("safe"))n+=`;${t}:${s}`;else if(!o[t]||s.includes("import")||!o[t].includes("import")){if(s.includes("url")){let e=s.indexOf("(")+1;if(e){for(;'"'===s[e]||"'"===s[e]||Ul[s[e]];)e++;s=s.substr(0,e)+this.getUrl(s.substr(e))}}else s.includes("rpx")&&(s=s.replace(/[0-9.]+\s*rpx/g,(e=>parseFloat(e)*Ol/750+"px")));o[t]=s}}return e.attrs.style=n,o},Jl.prototype.onTagName=function(e){this.tagName=this.xml?e:e.toLowerCase(),"svg"===this.tagName&&(this.xml=(this.xml||0)+1,Ml.ignoreTags.style=void 0)},Jl.prototype.onAttrName=function(e){(e=this.xml?e:e.toLowerCase()).includes("?")||e.includes(";")?this.attrName=void 0:"data-"===e.substr(0,5)?"data-src"!==e||this.attrs.src?"img"===this.tagName||"a"===this.tagName?this.attrName=e:this.attrName=void 0:this.attrName="src":(this.attrName=e,this.attrs[e]="T")},Jl.prototype.onAttrVal=function(e){const t=this.attrName||"";"style"===t||"href"===t?this.attrs[t]=Gl(e,!0):t.includes("src")?this.attrs[t]=this.getUrl(Gl(e,!0)):t&&(this.attrs[t]=e)},Jl.prototype.onOpenTag=function(e){const t=Object.create(null);t.name=this.tagName,t.attrs=this.attrs,this.options.nodes.length&&(t.type="node"),this.attrs=Object.create(null);const a=t.attrs,o=this.stack[this.stack.length-1],n=o?o.children:this.nodes,l=this.xml?e:Ml.voidTags[t.name];if(Rl[t.name]&&(a.class=Rl[t.name]+(a.class?" "+a.class:"")),"embed"===t.name&&this.expose(),"video"!==t.name&&"audio"!==t.name||("video"!==t.name||a.id||(a.id="v"+jl++),a.controls||a.autoplay||(a.controls="T"),t.src=[],a.src&&(t.src.push(a.src),a.src=void 0),this.expose()),l){if(!this.hook(t)||Ml.ignoreTags[t.name])return void("base"!==t.name||this.options.domain?"source"===t.name&&o&&("video"===o.name||"audio"===o.name)&&a.src&&o.src.push(a.src):this.options.domain=a.href);const e=this.parseStyle(t);if("img"===t.name){if(a.src&&(a.src.includes("webp")&&(t.webp="T"),a.src.includes("data:")&&"all"!==this.options.previewImg&&!a["original-src"]&&(a.ignore="T"),!a.ignore||t.webp||a.src.includes("cloud://"))){for(let n=this.stack.length;n--;){const o=this.stack[n];"a"===o.name&&(t.a=o.attrs),"table"!==o.name||t.webp||a.src.includes("cloud://")||(!e.display||e.display.includes("inline")?t.t="inline-block":t.t=e.display,e.display=void 0),o.c=1}a.i=this.imgList.length.toString();let o=a["original-src"]||a.src;this.imgList.push(o),t.t||(this.imgList._unloadimgs+=1),this.options.lazyLoad&&(a["data-src"]=a.src,a.src=void 0)}"inline"===e.display&&(e.display=""),a.ignore&&(e["max-width"]=e["max-width"]||"100%",a.style+=";-webkit-touch-callout:none"),parseInt(e.width)>Ol&&(e.height=void 0),isNaN(parseInt(e.width))||(t.w="T"),!isNaN(parseInt(e.height))&&(!e.height.includes("%")||o&&(o.attrs.style||"").includes("height"))&&(t.h="T"),t.w&&t.h&&e["object-fit"]&&("contain"===e["object-fit"]?t.m="aspectFit":"cover"===e["object-fit"]&&(t.m="aspectFill"))}else if("svg"===t.name)return n.push(t),this.stack.push(t),void this.popNode();for(const t in e)e[t]&&(a.style+=`;${t}:${e[t].replace(" !important","")}`);a.style=a.style.substr(1)||void 0}else("pre"===t.name||(a.style||"").includes("white-space")&&a.style.includes("pre"))&&2!==this.pre&&(this.pre=t.pre=1),t.children=[],this.stack.push(t);n.push(t)},Jl.prototype.onCloseTag=function(e){let t;for(e=this.xml?e:e.toLowerCase(),t=this.stack.length;t--&&this.stack[t].name!==e;);if(-1!==t)for(;this.stack.length>t;)this.popNode();else if("p"===e||"br"===e){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push({name:e,attrs:{class:Rl[e]||"",style:this.tagStyle[e]||""}})}},Jl.prototype.popNode=function(){const e=this.stack.pop();let t=e.attrs;const a=e.children,o=this.stack[this.stack.length-1],n=o?o.children:this.nodes;if(!this.hook(e)||Ml.ignoreTags[e.name])return"title"===e.name&&a.length&&"text"===a[0].type&&this.options.setTitle&&uni.setNavigationBarTitle({title:a[0].text}),void n.pop();if(e.pre&&2!==this.pre){this.pre=e.pre=void 0;for(let e=this.stack.length;e--;)this.stack[e].pre&&(this.pre=1)}const l={};if("svg"===e.name){if(this.xml>1)return void this.xml--;let a="";const o=t.style;return t.style="",t.xmlns="http://www.w3.org/2000/svg",function e(t){if("text"===t.type)return void(a+=t.text);const o=Ml.svgDict[t.name]||t.name;if("foreignObject"===o)for(const a of t.children||[])if(a.attrs&&!a.attrs.xmlns){a.attrs.xmlns="http://www.w3.org/1999/xhtml";break}a+="<"+o;for(const n in t.attrs){const e=t.attrs[n];e&&(a+=` ${Ml.svgDict[n]||n}="${e.replace(/"/g,"")}"`)}if(t.children){a+=">";for(let a=0;a<t.children.length;a++)e(t.children[a]);a+="</"+o+">"}else a+="/>"}(e),e.name="img",e.attrs={src:"data:image/svg+xml;utf8,"+a.replace(/#/g,"%23"),style:o,ignore:"T"},e.children=void 0,this.xml=!1,void(Ml.ignoreTags.style=!0)}if(t.align&&("table"===e.name?"center"===t.align?l["margin-inline-start"]=l["margin-inline-end"]="auto":l.float=t.align:l["text-align"]=t.align,t.align=void 0),t.dir&&(l.direction=t.dir,t.dir=void 0),"font"===e.name&&(t.color&&(l.color=t.color,t.color=void 0),t.face&&(l["font-family"]=t.face,t.face=void 0),t.size)){let e=parseInt(t.size);isNaN(e)||(e<1?e=1:e>7&&(e=7),l["font-size"]=["x-small","small","medium","large","x-large","xx-large","xxx-large"][e-1]),t.size=void 0}if((t.class||"").includes("align-center")&&(l["text-align"]="center"),Object.assign(l,this.parseStyle(e)),"table"!==e.name&&parseInt(l.width)>Ol&&(l["max-width"]="100%",l["box-sizing"]="border-box"),Ml.blockTags[e.name]?e.name="div":Ml.trustTags[e.name]||this.xml||(e.name="span"),"a"===e.name||"ad"===e.name||"iframe"===e.name)this.expose();else if("video"===e.name){(l.height||"").includes("auto")&&(l.height=void 0);let a='<video style="width:100%;height:100%"';for(const e in t)t[e]&&(a+=" "+e+'="'+t[e]+'"');this.options.pauseVideo&&(a+=" onplay=\"this.dispatchEvent(new CustomEvent('vplay',{bubbles:!0}));for(var e=document.getElementsByTagName('video'),t=0;t<e.length;t++)e[t]!=this&&e[t].pause()\""),a+=">";for(let t=0;t<e.src.length;t++)a+='<source src="'+e.src[t]+'">';a+="</video>",e.html=a}else if("ul"!==e.name&&"ol"!==e.name||!e.c)if("table"===e.name){let o=parseFloat(t.cellpadding),n=parseFloat(t.cellspacing);const s=parseFloat(t.border),i=l["border-color"],r=l["border-style"];if(e.c&&(isNaN(o)&&(o=2),isNaN(n)&&(n=2)),s&&(t.style+=`;border:${s}px ${r||"solid"} ${i||"gray"}`),e.flag&&e.c){l.display="grid","collapse"===l["border-collapse"]&&(l["border-collapse"]=void 0,n=0),n?(l["grid-gap"]=n+"px",l.padding=n+"px"):s&&(t.style+=";border-left:0;border-top:0");const c=[],u=[],d=[],m={};!function e(t){for(let a=0;a<t.length;a++)if("tr"===t[a].name)u.push(t[a]);else if("colgroup"===t[a].name){let e=1;for(const o of t[a].children||[])if("col"===o.name){const t=o.attrs.style||"",a=t.indexOf("width")?t.indexOf(";width"):0;if(-1!==a){let o=t.indexOf(";",a+6);-1===o&&(o=t.length),c[e]=t.substring(a?a+7:6,o)}e+=1}}else e(t[a].children||[])}(a);for(let e=1;e<=u.length;e++){let t=1;for(let a=0;a<u[e-1].children.length;a++){const l=u[e-1].children[a];if("td"===l.name||"th"===l.name){for(;m[e+"."+t];)t++;let a=l.attrs.style||"",u=a.indexOf("width")?a.indexOf(";width"):0;if(-1!==u){let e=a.indexOf(";",u+6);-1===e&&(e=a.length),l.attrs.colspan||(c[t]=a.substring(u?u+7:6,e)),a=a.substr(0,u)+a.substr(e)}if(a+=";display:flex",u=a.indexOf("vertical-align"),-1!==u){const e=a.substr(u+15,10);e.includes("middle")?a+=";align-items:center":e.includes("bottom")&&(a+=";align-items:flex-end")}else a+=";align-items:center";if(u=a.indexOf("text-align"),-1!==u){const e=a.substr(u+11,10);e.includes("center")?a+=";justify-content: center":e.includes("right")&&(a+=";justify-content: right")}if(a=(s?`;border:${s}px ${r||"solid"} ${i||"gray"}`+(n?"":";border-right:0;border-bottom:0"):"")+(o?`;padding:${o}px`:"")+";"+a,l.attrs.colspan&&(a+=`;grid-column-start:${t};grid-column-end:${t+parseInt(l.attrs.colspan)}`,l.attrs.rowspan||(a+=`;grid-row-start:${e};grid-row-end:${e+1}`),t+=parseInt(l.attrs.colspan)-1),l.attrs.rowspan){a+=`;grid-row-start:${e};grid-row-end:${e+parseInt(l.attrs.rowspan)}`,l.attrs.colspan||(a+=`;grid-column-start:${t};grid-column-end:${t+1}`);for(let a=1;a<l.attrs.rowspan;a++)for(let o=0;o<(l.attrs.colspan||1);o++)m[e+a+"."+(t-o)]=1}a&&(l.attrs.style=a),d.push(l),t++}}if(1===e){let e="";for(let a=1;a<t;a++)e+=(c[a]?c[a]:"auto")+" ";l["grid-template-columns"]=e}}e.children=d}else e.c&&(l.display="table"),isNaN(n)||(l["border-spacing"]=n+"px"),(s||o)&&function e(t){for(let a=0;a<t.length;a++){const n=t[a];"th"===n.name||"td"===n.name?(s&&(n.attrs.style=`border:${s}px ${r||"solid"} ${i||"gray"};${n.attrs.style||""}`),o&&(n.attrs.style=`padding:${o}px;${n.attrs.style||""}`)):n.children&&e(n.children)}}(a);if(this.options.scrollTable&&!(t.style||"").includes("inline")){const a=Object.assign({},e);e.name="div",e.attrs={style:"overflow:auto"},e.children=[a],t=a.attrs}}else if(("tbody"===e.name||"tr"===e.name)&&e.flag&&e.c)e.flag=void 0,function e(t){for(let a=0;a<t.length;a++)if("td"===t[a].name)for(const e of["color","background","background-color"])l[e]&&(t[a].attrs.style=e+":"+l[e]+";"+(t[a].attrs.style||""));else e(t[a].children||[])}(a);else if("td"!==e.name&&"th"!==e.name||!t.colspan&&!t.rowspan)if("ruby"===e.name){e.name="span";for(let e=0;e<a.length-1;e++)"text"===a[e].type&&"rt"===a[e+1].name&&(a[e]={name:"div",attrs:{style:"display:inline-block;text-align:center"},children:[{name:"div",attrs:{style:"font-size:50%;"+(a[e+1].attrs.style||"")},children:a[e+1].children},a[e]]},a.splice(e+1,1))}else e.c&&function e(t){t.c=2;for(let a=t.children.length;a--;){const o=t.children[a];o.name&&(Ml.inlineTags[o.name]||(o.attrs.style||"").includes("inline")&&o.children)&&!o.c&&e(o),o.c&&"table"!==o.name||(t.c=1)}}(e);else for(let i=this.stack.length;i--;)"table"!==this.stack[i].name&&"tbody"!==this.stack[i].name&&"tr"!==this.stack[i].name||(this.stack[i].flag=1);else{const e={a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"};e[t.type]&&(t.style+=";list-style-type:"+e[t.type],t.type=void 0);for(let t=a.length;t--;)"li"===a[t].name&&(a[t].c=1)}if((l.display||"").includes("flex")&&!e.c)for(let i=a.length;i--;){const e=a[i];e.f&&(e.attrs.style=(e.attrs.style||"")+e.f,e.f=void 0)}const s=o&&((o.attrs.style||"").includes("flex")||(o.attrs.style||"").includes("grid"))&&!e.c;s&&(e.f=";max-width:100%"),a.length>=50&&e.c&&!(l.display||"").includes("flex")&&Wl(a);for(const i in l)if(l[i]){const a=`;${i}:${l[i].replace(" !important","")}`;s&&(i.includes("flex")&&"flex-direction"!==i||"align-self"===i||i.includes("grid")||"-"===l[i][0]||i.includes("width")&&a.includes("%"))?(e.f+=a,"width"===i&&(t.style+=";width:100%")):t.style+=a}t.style=t.style.substr(1)||void 0},Jl.prototype.onText=function(e){if(!this.pre){let t,a="";for(let o=0,n=e.length;o<n;o++)Ul[e[o]]?(" "!==a[a.length-1]&&(a+=" "),"\n"!==e[o]||t||(t=!0)):a+=e[o];if(" "===a){if(t)return;{const e=this.stack[this.stack.length-1];if(e&&"t"===e.name[0])return}}e=a}const t=Object.create(null);if(t.type="text",t.text=Gl(e),this.hook(t)){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push(t)}},Kl.prototype.parse=function(e){this.content=e||"",this.i=0,this.start=0,this.state=this.text;for(let t=this.content.length;-1!==this.i&&this.i<t;)this.state()},Kl.prototype.checkClose=function(e){const t="/"===this.content[this.i];return!!(">"===this.content[this.i]||t&&">"===this.content[this.i+1])&&(e&&this.handler[e](this.content.substring(this.start,this.i)),this.i+=t?2:1,this.start=this.i,this.handler.onOpenTag(t),"script"===this.handler.tagName?(this.i=this.content.indexOf("</",this.i),-1!==this.i&&(this.i+=2,this.start=this.i),this.state=this.endTag):this.state=this.text,!0)},Kl.prototype.text=function(){if(this.i=this.content.indexOf("<",this.i),-1===this.i)return void(this.start<this.content.length&&this.handler.onText(this.content.substring(this.start,this.content.length)));const e=this.content[this.i+1];if(e>="a"&&e<="z"||e>="A"&&e<="Z")this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i)),this.start=++this.i,this.state=this.tagName;else if("/"===e||"!"===e||"?"===e){this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i));const t=this.content[this.i+2];if("/"===e&&(t>="a"&&t<="z"||t>="A"&&t<="Z"))return this.i+=2,this.start=this.i,void(this.state=this.endTag);let a="--\x3e";"!"===e&&"-"===this.content[this.i+2]&&"-"===this.content[this.i+3]||(a=">"),this.i=this.content.indexOf(a,this.i),-1!==this.i&&(this.i+=a.length,this.start=this.i)}else this.i++},Kl.prototype.tagName=function(){if(Ul[this.content[this.i]]){for(this.handler.onTagName(this.content.substring(this.start,this.i));Ul[this.content[++this.i]];);this.i<this.content.length&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)}else this.checkClose("onTagName")||this.i++},Kl.prototype.attrName=function(){let e=this.content[this.i];if(Ul[e]||"="===e){this.handler.onAttrName(this.content.substring(this.start,this.i));let t="="===e;const a=this.content.length;for(;++this.i<a;)if(e=this.content[this.i],!Ul[e]){if(this.checkClose())return;if(t)return this.start=this.i,void(this.state=this.attrVal);if("="!==this.content[this.i])return this.start=this.i,void(this.state=this.attrName);t=!0}}else this.checkClose("onAttrName")||this.i++},Kl.prototype.attrVal=function(){const e=this.content[this.i],t=this.content.length;if('"'===e||"'"===e){if(this.start=++this.i,this.i=this.content.indexOf(e,this.i),-1===this.i)return;this.handler.onAttrVal(this.content.substring(this.start,this.i))}else for(;this.i<t;this.i++){if(Ul[this.content[this.i]]){this.handler.onAttrVal(this.content.substring(this.start,this.i));break}if(this.checkClose("onAttrVal"))return}for(;Ul[this.content[++this.i]];);this.i<t&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)},Kl.prototype.endTag=function(){const e=this.content[this.i];if(Ul[e]||">"===e||"/"===e){if(this.handler.onCloseTag(this.content.substring(this.start,this.i)),">"!==e&&(this.i=this.content.indexOf(">",this.i),-1===this.i))return;this.start=++this.i,this.state=this.text}else this.i++};const Yl=[];const Ql=V({name:"mp-html",data:()=>({nodes:[]}),props:{containerStyle:{type:String,default:""},content:{type:String,default:""},copyLink:{type:[Boolean,String],default:!0},domain:String,errorImg:{type:String,default:""},lazyLoad:{type:[Boolean,String],default:!1},loadingImg:{type:String,default:""},pauseVideo:{type:[Boolean,String],default:!0},previewImg:{type:[Boolean,String],default:!0},scrollTable:[Boolean,String],selectable:[Boolean,String],setTitle:{type:[Boolean,String],default:!0},showImgMenu:{type:[Boolean,String],default:!0},tagStyle:Object,useAnchor:[Boolean,Number]},emits:["load","ready","imgtap","linktap","play","error"],components:{node:Fl},watch:{content(e){this.setContent(e)}},created(){this.plugins=[];for(let e=Yl.length;e--;)this.plugins.push(new Yl[e](this))},mounted(){this.content&&!this.nodes.length&&this.setContent(this.content)},beforeDestroy(){this._hook("onDetached")},methods:{in(e,t,a){e&&t&&a&&(this._in={page:e,selector:t,scrollTop:a})},navigateTo(e,t){return new Promise(((a,o)=>{if(!this.useAnchor)return void o(Error("Anchor is disabled"));t=t||parseInt(this.useAnchor)||0;const n=uni.createSelectorQuery().in(this._in?this._in.page:this).select((this._in?this._in.selector:"._root")+(e?` #${e}`:"")).boundingClientRect();this._in?n.select(this._in.selector).scrollOffset().select(this._in.selector).boundingClientRect():n.selectViewport().scrollOffset(),n.exec((e=>{if(!e[0])return void o(Error("Label not found"));const n=e[1].scrollTop+e[0].top-(e[2]?e[2].top:0)+t;this._in?this._in.page[this._in.scrollTop]=n:uni.pageScrollTo({scrollTop:n,duration:300}),a()}))}))},getText(e){let t="";return function e(a){for(let o=0;o<a.length;o++){const n=a[o];if("text"===n.type)t+=n.text.replace(/&amp;/g,"&");else if("br"===n.name)t+="\n";else{const a="p"===n.name||"div"===n.name||"tr"===n.name||"li"===n.name||"h"===n.name[0]&&n.name[1]>"0"&&n.name[1]<"7";a&&t&&"\n"!==t[t.length-1]&&(t+="\n"),n.children&&e(n.children),a&&"\n"!==t[t.length-1]?t+="\n":"td"!==n.name&&"th"!==n.name||(t+="\t")}}}(e||this.nodes),t},getRect(){return new Promise(((e,t)=>{uni.createSelectorQuery().in(this).select("#_root").boundingClientRect().exec((a=>a[0]?e(a[0]):t(Error("Root label not found"))))}))},pauseMedia(){for(let t=(this._videos||[]).length;t--;)this._videos[t].pause();let e=this.$parent;for(;!e.$scope;)e=e.$parent;e.$scope.$getAppWebview().evalJS('for(var e=document.getElementsByTagName("video"),i=e.length;i--;)e[i].pause()')},setPlaybackRate(e){this.playbackRate=e;for(let o=(this._videos||[]).length;o--;)this._videos[o].playbackRate(e);const t='for(var e=document.getElementsByTagName("video"),i=e.length;i--;)e[i].playbackRate='+e;let a=this.$parent;for(;!a.$scope;)a=a.$parent;a.$scope.$getAppWebview().evalJS(t)},setContent(e,t){t&&this.imgList||(this.imgList=[]);const a=new Jl(this).parse(e);if(this.$set(this,"nodes",t?(this.nodes||[]).concat(a):a),this._videos=[],this.$nextTick((()=>{this._hook("onLoad"),this.$emit("load")})),this.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){let e=0;const t=a=>{a&&a.height||(a={}),a.height===e?this.$emit("ready",a):(e=a.height,setTimeout((()=>{this.getRect().then(t).catch(t)}),350))};this.getRect().then(t).catch(t)}else this.imgList._unloadimgs||this.getRect().then((e=>{this.$emit("ready",e)})).catch((()=>{this.$emit("ready",{})}))},_hook(e){for(let t=Yl.length;t--;)this.plugins[t][e]&&this.plugins[t][e]()}}},[["render",function(t,a,o,n,l,s){const i=e.resolveComponent("node");return e.openBlock(),e.createElementBlock("view",{id:"_root",class:e.normalizeClass((o.selectable?"_select ":"")+"_root"),style:e.normalizeStyle(o.containerStyle)},[l.nodes[0]?(e.openBlock(),e.createBlock(i,{key:1,childs:l.nodes,opts:[o.lazyLoad,o.loadingImg,o.errorImg,o.showImgMenu,o.selectable],name:"span"},null,8,["childs","opts"])):e.renderSlot(t.$slots,"default",{key:0},void 0,!0)],6)}],["__scopeId","data-v-864c11a0"]]),Xl=V({__name:"article_detail",setup(t){const o=e.ref({title:"",content:"",banner:"",created_at:0});e.ref(1),e.ref(!1),e.ref(!1),e.ref(null);const n=e.ref(null),l=e.ref(null),s=e.ref({}),r=async({content:e,replyInfo:t,origin:a})=>{var l,s;if(!(await m(!0)))return;const i={content:e,origin:a,target_id:parseInt(o.value.id),type:7,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};try{const{data:e}=await uni.request({url:`${u.value}/with-state/add-comment`,method:"POST",header:{Authorization:uni.getStorageSync("token")},data:i});"success"===e.status&&(0===e.data.parent_id?null==(l=n.value)||l.addNewComment(e.data):null==(s=n.value)||s.addReplyComment(e.data),uni.showToast({title:"评论成功"}))}catch(r){uni.showToast({title:"评论失败",icon:"none"})}},c=({parent:e,target:t})=>{var a;const o=t||e;s.value=o,null==(a=l.value)||a.focusInput()};i((async e=>{if(!e.id)return uni.navigateBack();f(),await d(e.id)}));const d=async e=>{try{const{data:t}=await uni.request({url:`${u.value}/article-detail?id=${e}`});"success"===t.status&&(o.value=t.data,uni.setNavigationBarTitle({title:t.data.title}))}catch(t){uni.showToast({title:"加载失败",icon:"none"})}},m=async(e=!1)=>!!h.isLogin||(e&&uni.showToast({title:"请先登录",icon:"none"}),!1);return(t,i)=>{const u=a(e.resolveDynamicComponent("view-logs"),E),d=a(e.resolveDynamicComponent("mp-html"),Ql),m=a(e.resolveDynamicComponent("comment-list"),he),p=a(e.resolveDynamicComponent("comment-input"),we);return e.openBlock(),e.createElementBlock("view",{class:"article-container"},[e.createVNode(u),o.value.banner?(e.openBlock(),e.createElementBlock("image",{key:0,src:o.value.banner,mode:"widthFix",class:"banner"},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(o.value.title),1),e.createVNode(d,{content:o.value.content,class:"content-html"},null,8,["content"]),o.value.id>0?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",null,[e.createVNode(m,{ref_key:"commentListRef",ref:n,type:7,"relation-id":parseInt(o.value.id),onReply:c},null,8,["relation-id"])]),e.createVNode(p,{ref_key:"commentInputRef",ref:l,"reply-info":s.value,"target-id":o.value.id.toString(),onSubmit:r,"onUpdate:replyInfo":i[0]||(i[0]=e=>s.value=e)},null,8,["reply-info","target-id"])])):e.createCommentVNode("",!0)])])}}},[["__scopeId","data-v-0f753e52"]]);const Zl=V({props:{threshold:{type:Number,default:150},scrollHeight:{type:String,default:"100vh"}},data:()=>({triggered:!1,pullDownGif:"https://images1.fantuanpu.com/home/f4a2f2a997e45b87bfce23edc794d9a6.gif",refreshingGif:"https://images1.fantuanpu.com/home/f4a2f2a997e45b87bfce23edc794d9a6.gif",refreshText:"下拉刷新"}),methods:{onRefresh(){this.triggered=!0,this.refreshText="正在刷新...",this.$emit("refresh")},finishRefresh(){this.triggered=!1,this.refreshText="刷新完成",setTimeout((()=>{this.refreshText="下拉刷新"}),800)},onRestore(){this.refreshText="下拉刷新"},onAbort(){this.refreshText="刷新取消"}}},[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("scroll-view",{"scroll-y":"","refresher-default-style":"none","refresher-enabled":!0,"refresher-triggered":l.triggered,"refresher-threshold":o.threshold,"refresher-background":"#f8f8f8",onRefresherrefresh:a[0]||(a[0]=(...e)=>s.onRefresh&&s.onRefresh(...e)),onRefresherrestore:a[1]||(a[1]=(...e)=>s.onRestore&&s.onRestore(...e)),onRefresherabort:a[2]||(a[2]=(...e)=>s.onAbort&&s.onAbort(...e)),style:e.normalizeStyle({height:o.scrollHeight}),class:"scroll-view"},[e.createElementVNode("view",{slot:"refresher",class:"refresh-container",style:e.normalizeStyle({height:`${o.threshold}px`})},[e.createElementVNode("view",{class:e.normalizeClass(["refresh-content",{refreshing:l.triggered}])},[e.createElementVNode("image",{class:"refresh-icon",src:l.triggered?l.refreshingGif:l.pullDownGif,mode:"aspectFit"},null,8,["src"]),e.createElementVNode("text",{class:"refresh-text"},e.toDisplayString(l.refreshText),1)],2)],4),e.renderSlot(t.$slots,"default",{},void 0,!0)],44,["refresher-triggered","refresher-threshold"])])}],["__scopeId","data-v-852bc35b"]]);const es=V({data:()=>({statusBarHeight:0,dataList:[{id:1,name:"张三",content:"今天天气真不错，适合户外运动！",time:"10:30",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},{id:2,name:"李四",content:"刚刚完成了一个重要的项目，庆祝一下！",time:"09:15",avatar:"https://randomuser.me/api/portraits/women/2.jpg"},{id:3,name:"王五",content:"学习新技能真的很有成就感，继续加油！",time:"昨天 18:20",avatar:"https://randomuser.me/api/portraits/men/3.jpg"},{id:4,name:"赵六",content:"分享一张今天拍的美景照片，大自然真神奇！",time:"昨天 16:45",avatar:"https://randomuser.me/api/portraits/women/4.jpg"},{id:5,name:"钱七",content:"尝试了新的菜谱，味道超级棒！",time:"昨天 14:30",avatar:"https://randomuser.me/api/portraits/men/5.jpg"}]}),onLoad(){const e=uni.getSystemInfoSync();this.statusBarHeight=e.statusBarHeight},methods:{handleRefresh(){setTimeout((()=>{const e={id:this.dataList.length+1,name:`新用户${this.dataList.length+1}`,content:`这是新刷出的内容 #${this.dataList.length+1}`,time:"刚刚",avatar:`https://randomuser.me/api/portraits/${this.dataList.length%2==0?"men":"women"}/${this.dataList.length+1}.jpg`};this.dataList.unshift(e),this.$refs.refresh.finishRefresh()}),1500)}}},[["render",function(t,o,n,l,s,i){const r=a(e.resolveDynamicComponent("comment-loadding"),Zl);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(r,{ref:"refresh",onRefresh:i.handleRefresh,scrollHeight:`calc(100vh - ${s.statusBarHeight}px)`},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"自定义下拉刷新演示")]),e.createElementVNode("view",{class:"card-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.dataList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("image",{class:"avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1)]),e.createElementVNode("text",{class:"card-content"},e.toDisplayString(t.content),1),e.createElementVNode("text",{class:"card-time"},e.toDisplayString(t.time),1)])))),128))])])])),_:1},8,["onRefresh","scrollHeight"])])}]]),ts={__name:"private",setup:t=>(uni.setNavigationBarTitle({title:"隐私政策"}),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(n),e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-info-circle"}),e.createTextVNode(" 引言")]),e.createElementVNode("text",{class:"policy-text"},"本应用尊重并保护所有使用服务用户的个人隐私权。"),e.createElementVNode("text",{class:"policy-text"},"为了给您提供更准确、更有个性化的服务，本应用会按照本隐私权政策的规定使用和披露您的个人信息。"),e.createElementVNode("text",{class:"policy-text"},"但本应用将以高度的勤勉、审慎义务对待这些信息。"),e.createElementVNode("text",{class:"policy-text"},"除本隐私权政策另有规定外，在未征得您事先许可的情况下，本应用不会将这些信息对外披露或向第三方提供。"),e.createElementVNode("text",{class:"policy-text"},"本应用会不时更新本隐私权政策。"),e.createElementVNode("text",{class:"policy-text"},"您在同意本应用服务使用协议之时，即视为您已经同意本隐私权政策全部内容。"),e.createElementVNode("text",{class:"policy-text"},"本隐私权政策属于本应用服务使用协议不可分割的一部分。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-globe"}),e.createTextVNode(" 1. 适用范围")]),e.createElementVNode("text",{class:"policy-text"},"(a) 在您注册本应用帐号时，您根据本应用要求提供的个人注册信息；"),e.createElementVNode("text",{class:"policy-text"},"(b) 在您使用本应用网络服务，或访问本应用平台网页时，本应用自动接收并记录的您的浏览器和计算机上的信息，包括但不限于您的IP地址、浏览器的类型、使用的语言、访问日期和时间、软硬件特征信息及您需求的网页记录等数据；"),e.createElementVNode("text",{class:"policy-text"},"(c) 本应用通过合法途径从商业伙伴处取得的用户个人数据。"),e.createElementVNode("text",{class:"policy-text"},"您了解并同意，以下信息不适用本隐私权政策："),e.createElementVNode("text",{class:"policy-text"},"(a) 您在使用本应用平台提供的搜索服务时输入的关键字信息；"),e.createElementVNode("text",{class:"policy-text"},"(b) 本应用收集到的您在本应用发布的有关信息数据，包括但不限于参与活动、成交信息及评价详情；"),e.createElementVNode("text",{class:"policy-text"},"(c) 违反法律规定或违反本应用规则行为及本应用已对您采取的措施。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-cogs"}),e.createTextVNode(" 2. 信息使用")]),e.createElementVNode("text",{class:"policy-text"},"(a)本应用不会向任何无关第三方提供、出售、出租、分享或交易您的个人信息，除非事先得到您的许可，或该第三方和本应用（含本应用关联公司）单独或共同为您提供服务，且在该服务结束后，其将被禁止访问包括其以前能够访问的所有这些资料。"),e.createElementVNode("text",{class:"policy-text"},"(b) 本应用亦不允许任何第三方以任何手段收集、编辑、出售或者无偿传播您的个人信息。任何本应用平台用户如从事上述活动，一经发现，本应用有权立即终止与该用户的服务协议。"),e.createElementVNode("text",{class:"policy-text"},"(c) 为服务用户的目的，本应用可能通过使用您的个人信息，向您提供您感兴趣的信息，包括但不限于向您发出产品和服务信息，或者与本应用合作伙伴共享信息以便他们向您发送有关其产品和服务的信息（后者需要您的事先同意）。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-shield-alt"}),e.createTextVNode(" 3. 信息披露")]),e.createElementVNode("text",{class:"policy-text"},"在如下情况下，本应用将依据您的个人意愿或法律的规定全部或部分的披露您的个人信息："),e.createElementVNode("text",{class:"policy-text"},"(a) 经您事先同意，向第三方披露；"),e.createElementVNode("text",{class:"policy-text"},"(b)为提供您所要求的产品和服务，而必须和第三方分享您的个人信息；"),e.createElementVNode("text",{class:"policy-text"},"(c) 根据法律的有关规定，或者行政或司法机构的要求，向第三方或者行政、司法机构披露；"),e.createElementVNode("text",{class:"policy-text"},"(d) 如您出现违反中国有关法律、法规或者本应用服务协议或相关规则的情况，需要向第三方披露；"),e.createElementVNode("text",{class:"policy-text"},"(e) 如您是适格的知识产权投诉人并已提起投诉，应被投诉人要求，向被投诉人披露，以便双方处理可能的权利纠纷；"),e.createElementVNode("text",{class:"policy-text"},"(f) 在本应用平台上创建的某一交易中，如交易任何一方履行或部分履行了交易义务并提出信息披露请求的，本应用有权决定向该用户提供其交易对方的联络方式等必要信息，以促成交易的完成或纠纷的解决。"),e.createElementVNode("text",{class:"policy-text"},"(g) 其它本应用根据法律、法规或者网站政策认为合适的披露。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-database"}),e.createTextVNode(" 4. 信息存储和交换")]),e.createElementVNode("text",{class:"policy-text"},"本应用收集的有关您的信息和资料将保存在本应用及（或）其关联公司的服务器上，这些信息和资料可能传送至您所在国家、地区或本应用收集信息和资料所在地的境外并在境外被访问、存储和展示。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-cookie"}),e.createTextVNode(" 5. Cookie的使用")]),e.createElementVNode("text",{class:"policy-text"},"(a) 在您未拒绝接受cookies的情况下，本应用会在您的计算机上设定或取用cookies ，以便您能登录或使用依赖于cookies的本应用平台服务或功能。本应用使用cookies可为您提供更加周到的个性化服务，包括推广服务。"),e.createElementVNode("text",{class:"policy-text"},"(b) 您有权选择接受或拒绝接受cookies。您可以通过修改浏览器设置的方式拒绝接受cookies。但如果您选择拒绝接受cookies，则您可能无法登录或使用依赖于cookies的本应用网络服务或功能。"),e.createElementVNode("text",{class:"policy-text"},"(c) 通过本应用所设cookies所取得的有关信息，将适用本政策。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-lock"}),e.createTextVNode(" 6. 信息安全")]),e.createElementVNode("text",{class:"policy-text"},"(a) 本应用帐号均有安全保护功能，请妥善保管您的用户名及密码信息。本应用将通过对用户密码进行加密等安全措施确保您的信息不丢失，不被滥用和变造。尽管有前述安全措施，但同时也请您注意在信息网络上不存在“完善的安全措施”。"),e.createElementVNode("text",{class:"policy-text"},"(b) 在使用本应用网络服务进行网上交易时，您不可避免的要向交易对方或潜在的交易对方披露自己的个人信息，如联络方式或者邮政地址。请您妥善保护自己的个人信息，仅在必要的情形下向他人提供。如您发现自己的个人信息泄密，尤其是本应用用户名及密码发生泄露，请您立即联络本应用客服，以便本应用采取相应措施。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("h2",{class:"section-title"},[e.createElementVNode("i",{class:"fas fa-sync-alt"}),e.createTextVNode(" 7. 本隐私政策的更改")]),e.createElementVNode("text",{class:"policy-text"},"(a)如果决定更改隐私政策，我们会在本政策中、本公司网站中以及我们认为适当的位置发布这些更改，以便您了解我们如何收集、使用您的个人信息，哪些人可以访问这些信息，以及在什么情况下我们会透露这些信息。"),e.createElementVNode("text",{class:"policy-text"},"(b)本公司保留随时修改本政策的权利，因此请经常查看。如对本政策作出重大更改，本公司会通过网站通知的形式告知。")]),e.createElementVNode("view",{class:"last-update"},[e.createElementVNode("text",{class:"policy-text"},[e.createElementVNode("i",{class:"fas fa-exclamation-circle"}),e.createTextVNode(" 重要提示：请您妥善保护自己的个人信息，仅在必要的情形下向他人提供。如您发现自己的个人信息泄密，尤其是本应用用户名及密码发生泄露，请您立即联络本应用客服，以便本应用采取相应措施。")])])])])])})},as={__name:"permission",setup:t=>(e.onMounted((()=>{uni.setNavigationBarTitle({title:"用户协议"})})),(t,o)=>{const n=a(e.resolveDynamicComponent("view-logs"),E);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(n),e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"数据保护条款"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"严格禁止任何未经授权的的人工转载、复制或传播平台内容")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"未经授权禁止使用爬虫工具获取平台数据")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"所有用户生成内容均受版权保护，未经授权不得使用")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"我们部署了反爬虫系统，实时监控数据访问行为")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"我们保留对侵权行为采取法律手段的权利")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"用户行为规范与内容管理"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"}," 您在使用本应用过程中所发布的任何文字、图片、音视频、评论等内容，均需遵守相关法律法规及本协议的约定，不得包含以下内容（包括但不限于）： 淫秽、暴力、威胁、骚扰、辱骂、恐吓、恶意中伤他人； 散布谣言、虚假信息、诈骗、钓鱼链接； 仇恨言论、歧视性言论或可能引发社会不安的内容； 其他违反法律法规、社会公序良俗或平台管理规范的内容。 ")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"我们对不良内容和滥用行为采取“零容忍”政策，包括但不限于恶意骚扰、辱骂他人、发送垃圾内容、冒充他人等。一经发现，我们有权立即删除相关内容，并封禁发布者账号，且无需另行通知。")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"用户可通过本应用提供的“举报”功能对不良信息进行举报，我们将在 24 小时内处理并视情况采取禁言、删除、封号等措施。")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"相机权限"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于扫描二维码、拍摄照片与上传图片")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 仅在您主动使用拍照功能时申请")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 不会在后台访问您的相机")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"位置权限"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于查找附近的娃店")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 仅在您使用基于位置的服务时申请")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 您可以随时在系统设置中关闭此权限")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"通知权限"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于接受BJD娃圈关注品牌的上新通知")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 您可以自定义接收的通知类型")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 可以在系统设置中随时关闭通知")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"存储权限"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于保存照片和下载内容")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于缓存应用数据以提升加载速度")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 不会访问您设备上的其他文件")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"设备信息"),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于适配不同设备，提供更好的兼容性")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 用于统计分析，改进产品质量")]),e.createElementVNode("view",{class:"permission-item"},[e.createElementVNode("text",{class:"permission-text"},"• 收集的信息包括设备型号、操作系统版本等")])])])])],64)})},os={__name:"drag-image-test",setup(o){const n=e.ref([]);return f().then((e=>{!function(e){if(t("log","at pages/drag-image-test/drag-image-test.vue:38",h),!h.isLogin)return;let a=uni.getStorageSync("token"),o=u.value+"/with-state/account-book";e&&"全部"!==e&&(o=u.value+"/with-state/account-book?type="+e),uni.request({url:o,method:"GET",header:{Authorization:a},success:e=>{n.value=e.data.data.account_books,t("log","at pages/drag-image-test/drag-image-test.vue:58",n.value)},fail:e=>{t("log","at pages/drag-image-test/drag-image-test.vue:61",e)}})}()})),(t,o)=>{const l=a(e.resolveDynamicComponent("shmily-drag-image"),Z);return e.openBlock(),e.createElementBlock("view",{style:{"min-height":"100vh",width:"100vw"}},[n.value.length>0?(e.openBlock(),e.createBlock(l,{key:0,modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),"border-radius":"20"},null,8,["modelValue"])):e.createCommentVNode("",!0)])}}},ns={__name:"account_book_preview",props:["account_book_id"],setup(t){const o=t,l=e.ref(!1),s=e.ref({}),i=e.ref(500),r=e.ref([]),c=e.ref(0),d=`account_book_heights_${o.account_book_id}`,m=()=>{uni.setStorageSync(d,{heights:r.value,screenWidth:c.value})},p=e.computed((()=>s.value.image_url?s.value.image_url.split(",").map((e=>e.trim())):[])),h=()=>{uni.navigateTo({url:`/pages/stock/account_book_form/account_book_form?account_book_id=${o.account_book_id}`})};return n((()=>{const e=uni.getSystemInfoSync().windowWidth;c.value=e;const t=uni.getStorageSync(d);if(i.value=300,r.value=[],t){if(!(t.screenWidth!==e)&&t.heights.length>0){r.value=t.heights;const e=Math.max(...t.heights.filter((e=>e)));i.value=Math.max(e,300)}}f().then((()=>{(async e=>{const t=uni.getStorageSync("token");try{const a=await uni.request({url:`${u.value}/with-state/account-book-detail?id=${e}`,method:"GET",header:{Authorization:t}});"success"===a.data.status?(s.value=a.data.data,setTimeout((()=>{l.value=!0,uni.setNavigationBarTitle({title:s.value.name||"账本详情"})}),600)):uni.showToast({title:a.data.msg||"获取详情失败",icon:"none"})}catch(a){uni.showToast({title:"网络请求失败",icon:"none"})}})(o.account_book_id)}))})),(t,o)=>{const n=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("loading-toast"),P);return e.openBlock(),e.createElementBlock(e.Fragment,null,[l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"detail-container"},[e.createElementVNode("view",{class:"header-image-container"},[e.createElementVNode("swiper",{class:"swiper",autoplay:!0,interval:3e3,circular:!0,"indicator-dots":"",style:e.normalizeStyle({height:i.value+"px"})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("view",{class:"image-container"},[e.createElementVNode("image",{src:t,mode:"widthFix",class:"header-image",onLoad:e=>((e,t)=>{if(!c.value)return;const{width:a,height:o}=e.detail,n=o/a*c.value;r.value[t]=n;const l=r.value.filter((e=>e));if(l.length>0){const e=Math.max(...l);e>i.value&&(i.value=e,m())}})(e,a)},null,40,["src","onLoad"])])])))),128))],4),e.createElementVNode("view",{class:"image-overlay"})]),e.createElementVNode("view",{class:"title-container"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(s.value.name),1),e.createElementVNode("view",{class:"category-tag"},e.toDisplayString(s.value.type),1)]),e.createElementVNode("view",{class:"info-section"},[e.createElementVNode("view",{class:"section-title"},[e.createVNode(n,{type:"list",size:"16",color:"#5db7ff"}),e.createElementVNode("text",null,"详细信息")]),e.createElementVNode("view",{class:"info-container"},[s.value.count?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"number",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"数量")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.count),1)])):e.createCommentVNode("",!0),s.value.price||s.value.final_price>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"money",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"价格")]),e.createElementVNode("view",{class:"info-value"},[s.value.final_price>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"highlight"},"总价: "+e.toDisplayString(s.value.price)+"元",1)):(e.openBlock(),e.createElementBlock("text",{key:1},e.toDisplayString(s.value.price)+"元",1))])])):e.createCommentVNode("",!0),s.value.final_price>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"money",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"尾款金额")]),e.createElementVNode("view",{class:"info-value"},[e.createElementVNode("text",{class:"highlight"},e.toDisplayString(s.value.final_price)+"元",1),s.value.final_time?(e.openBlock(),e.createElementBlock("text",{key:0,class:"time-tag"},"（"+e.toDisplayString(s.value.final_time)+"）",1)):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),s.value.shop_name?(e.openBlock(),e.createElementBlock("view",{key:3,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"shop",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"店铺")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.shop_name),1)])):e.createCommentVNode("",!0),s.value.size||s.value.size_detail?(e.openBlock(),e.createElementBlock("view",{key:4,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"compose",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"尺寸")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.size)+" "+e.toDisplayString(s.value.size_detail),1)])):e.createCommentVNode("",!0),s.value.head_circumference?(e.openBlock(),e.createElementBlock("view",{key:5,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"circle",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"头围")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.head_circumference),1)])):e.createCommentVNode("",!0),s.value.shoulder_width?(e.openBlock(),e.createElementBlock("view",{key:6,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"arrowright",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"肩宽")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.shoulder_width),1)])):e.createCommentVNode("",!0),s.value.makeup_artist?(e.openBlock(),e.createElementBlock("view",{key:7,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"person",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"妆师")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.makeup_artist),1)])):e.createCommentVNode("",!0),s.value.color?(e.openBlock(),e.createElementBlock("view",{key:8,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"color",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"颜色")]),e.createElementVNode("view",{class:"info-value"},[e.createTextVNode(e.toDisplayString(s.value.color)+" ",1),e.createElementVNode("view",{class:"color-preview",style:e.normalizeStyle({backgroundColor:s.value.color})},null,4)])])):e.createCommentVNode("",!0)])]),s.value.buy_date||s.value.arrival_date?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-section"},[e.createElementVNode("view",{class:"section-title"},[e.createVNode(n,{type:"calendar",size:"16",color:"#5db7ff"}),e.createElementVNode("text",null,"时间信息")]),e.createElementVNode("view",{class:"info-container"},[s.value.buy_date?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"cart",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"购入时间")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.buy_date),1)])):e.createCommentVNode("",!0),s.value.arrival_date?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"home",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"到家日期")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.arrival_date),1)])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),s.value.position?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-section"},[e.createElementVNode("view",{class:"section-title"},[e.createVNode(n,{type:"location",size:"16",color:"#5db7ff"}),e.createElementVNode("text",null,"位置信息")]),e.createElementVNode("view",{class:"info-container"},[e.createElementVNode("view",{class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"map",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"存放位置")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.position),1)])])])):e.createCommentVNode("",!0),s.value.additional_value||s.value.remark?(e.openBlock(),e.createElementBlock("view",{key:2,class:"info-section"},[e.createElementVNode("view",{class:"section-title"},[e.createVNode(n,{type:"info",size:"16",color:"#5db7ff"}),e.createElementVNode("text",null,"附加信息")]),e.createElementVNode("view",{class:"info-container"},[s.value.additional_value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"plus",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"附加值")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.additional_value),1)])):e.createCommentVNode("",!0),s.value.remark?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-line"},[e.createElementVNode("view",{class:"info-label"},[e.createVNode(n,{type:"chat",size:"14",color:"#5db7ff"}),e.createElementVNode("text",null,"备注")]),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(s.value.remark),1)])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"edit-button-container",onClick:h},[e.createElementVNode("view",{class:"edit-button"},[e.createVNode(n,{type:"compose",size:"22",color:"#fff"})])]),e.createVNode(u,{show:!l.value},null,8,["show"])],64)}}},ls={__name:"creator_base",setup(o){const n=e.ref(!1),l=e.ref(!1),s=e.ref(!1),i=e.ref({brand_name:"加载中...",description:"",country_name:"",nickname_list:"",logo_image:"",type:"",goods_count:0,views:0,vote_number:0,score:0,is_brand:0,is_bjd_artist:0,is_bjd_hairstylist:0}),r=e.ref(""),c=e.ref(0),d=e.ref({}),m=e.computed((()=>d.value.brand_id>0)),p=e.computed((()=>r.value?`我的UID是${d.value.id}，我的品牌是${r.value}，品牌ID是${c.value}`:""));let h=e.ref(0),g=e.ref(!1);const v=async(e,a)=>{if(!g.value){g.value=!0,uni.showLoading({title:"更新中...",mask:!0});try{const t=uni.getStorageSync("token");if(!t)return void uni.showToast({title:"请先登录",icon:"none"});const o={};o[e]=a?1:0;const r=await uni.request({url:`${u.value}/brand-manager/update-brand-identity`,method:"POST",header:{Authorization:t,"Content-Type":"application/json"},data:o});"success"===r.data.status?(uni.showToast({title:"更新成功",icon:"success"}),i.value[e]=a?1:0):(uni.showToast({title:r.data.msg||"更新失败",icon:"none"}),"is_brand"===e&&(n.value=!a),"is_bjd_artist"===e&&(l.value=!a),"is_bjd_hairstylist"===e&&(s.value=!a))}catch(o){t("error","at pages/creator_base/creator_base.vue:296","更新失败:",o),uni.showToast({title:"网络请求失败",icon:"none"})}finally{g.value=!1,uni.hideLoading()}}},y=e=>{const t=e.detail.value;v("is_brand",t)},w=e=>{const t=e.detail.value;v("is_bjd_artist",t)},_=e=>{const t=e.detail.value;v("is_bjd_hairstylist",t)},k=e=>{t("log","at pages/creator_base/creator_base.vue:325",e),r.value=e,c.value=0},E=(e,t)=>{c.value=e,r.value=t},N=()=>{uni.setClipboardData({data:"dogdogdoll",success:()=>{uni.showToast({title:"已复制联系方式",icon:"success"})}})},V=()=>{p.value?uni.setClipboardData({data:p.value,success:()=>{uni.showToast({title:"已复制入驻信息",icon:"success"})}}):uni.showToast({title:"请先选择品牌",icon:"none"})},x=e=>{switch(e){case"info-setting":uni.navigateTo({url:"/pages/creator_base/brand_edit/brand_edit"});break;case"goods-manage":uni.navigateTo({url:"/pages/creator_base/goods_list/goods_list"});break;case"image-manage":uni.navigateTo({url:"/pages/creator_base/news/news"});break;case"artist_info":uni.navigateTo({url:"/pages/creator_base/artist_setting/artist_setting"})}};return e.onMounted((()=>{uni.setNavigationBarTitle({title:"我的品牌"}),(async()=>{try{const e=await f();if(d.value=e,!e||!e.brand_id)return void(i.value.brand_id=0);h.value=e.brand_id,uni.request({url:`${u.value}/brand-info?id=${e.brand_id}`,method:"GET",success:e=>{"success"===e.data.status?(i.value=e.data.data,n.value=1===e.data.data.is_brand,l.value=1===e.data.data.is_bjd_artist,s.value=1===e.data.data.is_bjd_hairstylist):uni.showToast({title:e.data.msg||"获取品牌信息失败",icon:"none"})},fail:e=>{t("error","at pages/creator_base/creator_base.vue:230","请求失败:",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}catch(e){t("error","at pages/creator_base/creator_base.vue:238","加载品牌数据出错:",e),uni.showToast({title:"加载数据出错",icon:"none"})}})()})),(t,o)=>{const r=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("common-search"),q);return e.openBlock(),e.createElementBlock("view",{class:"container"},[m.value?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("image",{class:"logo",src:i.value.logo_image,mode:"aspectFit"},null,8,["src"]),e.createElementVNode("view",{class:"brand-info"},[e.createElementVNode("text",{class:"brand-name"},e.toDisplayString(i.value.brand_name),1),e.createElementVNode("text",{class:"brand-type"},e.toDisplayString(i.value.type)+" · "+e.toDisplayString(i.value.country_name),1)])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("text",{class:"title"},"品牌信息"),e.createElementVNode("view",{class:"score-box"},[e.createVNode(r,{type:"star-filled",size:"16",color:"#FFC107"}),e.createElementVNode("text",{class:"score"},e.toDisplayString(i.value.score),1)])]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"名称："),e.createElementVNode("text",{class:"value"},e.toDisplayString(i.value.brand_name),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"简介："),e.createElementVNode("text",{class:"value"},e.toDisplayString(i.value.description),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"国籍："),e.createElementVNode("text",{class:"value"},e.toDisplayString(i.value.country_name),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"别名："),e.createElementVNode("text",{class:"value"},e.toDisplayString(i.value.nickname_list),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"身份："),e.createElementVNode("text",{class:"value"},e.toDisplayString(i.value.type),1)])]),e.createElementVNode("view",{class:"identity-section"},[e.createElementVNode("view",{class:"identity-item"},[e.createElementVNode("view",{class:"identity-title"},"店铺身份"),e.createElementVNode("switch",{checked:n.value,onChange:y,color:"#8fecff"},null,40,["checked"]),e.createElementVNode("text",{class:"identity-status"},e.toDisplayString(n.value?"我是店铺":"不是店铺"),1)]),e.createElementVNode("view",{class:"identity-item"},[e.createElementVNode("view",{class:"identity-title"},"妆师身份"),e.createElementVNode("switch",{checked:l.value,onChange:w,color:"#8fecff"},null,40,["checked"]),e.createElementVNode("text",{class:"identity-status"},e.toDisplayString(l.value?"我是妆师":"不是妆师"),1)]),e.createElementVNode("view",{class:"identity-item"},[e.createElementVNode("view",{class:"identity-title"},"毛娘身份"),e.createElementVNode("switch",{checked:s.value,onChange:_,color:"#c1ddff"},null,40,["checked"]),e.createElementVNode("text",{class:"identity-status"},e.toDisplayString(s.value?"我是毛娘":"不是毛娘"),1)])]),e.createElementVNode("view",{class:"action-buttons"},[e.createElementVNode("view",{class:"btn info-setting",onClick:o[0]||(o[0]=e=>x("info-setting"))},[e.createVNode(r,{type:"contact",size:"24",color:"#006a57"}),e.createElementVNode("text",null,"信息设置")]),e.createElementVNode("view",{class:"btn goods-manage",onClick:o[1]||(o[1]=e=>x("goods-manage"))},[e.createVNode(r,{type:"shop",size:"24",color:"#dfd7c2"}),e.createElementVNode("text",null,"商品管理")]),e.createElementVNode("view",{class:"btn image-manage",onClick:o[2]||(o[2]=e=>x("image-manage"))},[e.createVNode(r,{type:"image",size:"24",color:"#fff6e1"}),e.createElementVNode("text",null,"文章管理")]),e.createElementVNode("view",{class:"btn info-artist",onClick:o[3]||(o[3]=e=>x("artist_info"))},[e.createVNode(r,{type:"contact",size:"24",color:"#c7e1fa"}),e.createElementVNode("text",null,"创作者")])])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"settle-container"},[e.createElementVNode("view",{class:"description"},[e.createElementVNode("text",{class:"desc-text"}," 如果您是娃圈贩售方、BJD妆师或毛娘，并希望管理和展示自己的品牌信息，欢迎申请入驻。通过认证后，您可以发布商品词条、图透、妆图等相关内容。除特殊情况外，我们的官方账号会在小红书和微博每日定期汇总并发布当日的贩售信息；妆师与毛娘的开单信息也将提前进行集中同步。 "),e.createElementVNode("text",{class:"desc-text"}," 入驻认证流程如下： "),e.createElementVNode("text",{class:"desc-text"}," 1：添加官方客服微信 dogdogdoll，在下方输入或搜索自己的名称。复制并发送给客服微信 dogdogdoll； "),e.createElementVNode("text",{class:"desc-text"}," 2：使用您在小红书或微博的官方账号向我们的官方账号发送一条验证消息，即可完成认证； "),e.createElementVNode("text",{class:"desc-text"}," 入驻及代宣传服务均为无偿。后续的使用体验与意见，您可直接通过该微信号反馈给我们。 "),e.createElementVNode("text",{class:"desc-text"}," 此外，我们计划于明年推出线上交易平台服务，若您对此感兴趣，也欢迎提出宝贵建议。 ")]),e.createElementVNode("view",{class:"contact-section"},[e.createElementVNode("text",{class:"contact-label"},"联系方式"),e.createElementVNode("view",{class:"contact-content"},[e.createElementVNode("text",null,"dogdogdoll"),e.createElementVNode("button",{class:"copy-btn",onClick:N},"点击复制")])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"品牌名称"),e.createVNode(u,{mode:"fill",onSelect:E,placeholder:"搜索并选择您的品牌","show-index-selector":"",onCloseAssociate:k}),c.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"brand-id"},"品牌ID: "+e.toDisplayString(c.value),1)):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"desc-text"}," 您的信息可能已经被录入，可以在尝试这里搜索您的品牌名称。 ")]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"入驻信息"),e.createElementVNode("textarea",{class:"info-textarea",value:p.value,disabled:"",placeholder:"请先选择品牌","auto-height":""},null,8,["value"]),e.createElementVNode("button",{class:"copy-btn",onClick:V},"复制信息")])])]))])}}},ss=V(ls,[["__scopeId","data-v-3bb822fa"]]),is={__name:"brand_edit",setup(o){const n=e.reactive({id:0,brand_name:"",nickname_list:"",country_name:"",type:"",website_url:"",description:"",logo_image:""}),l=e.ref({}),s=e.ref(["公司","个人作者"]),i=e.ref(!1),r=e.computed((()=>{var e,t,a;return""!==(null==(e=n.brand_name)?void 0:e.trim())&&""!==(null==(t=n.type)?void 0:t.trim())&&""!==(null==(a=n.website_url)?void 0:a.trim())})),c=e=>{n.type=s.value[e.detail.value]},d=async()=>{try{i.value=!0;const e=await f();if(t("log","at pages/creator_base/brand_edit/brand_edit.vue:154",e),!e||!e.brand_id)return void uni.showToast({title:"您尚未管理任何品牌",icon:"none"});const a=null==e?void 0:e.brand_id;if(!a)return void uni.showToast({title:"用户未关联品牌信息",icon:"none"});const o=await uni.request({url:`${u.value}/brand-info?id=${a}`,method:"GET",header:{Authorization:uni.getStorageSync("token")}});"success"===o.data.status?(l.value=o.data.data,Object.assign(n,{id:l.value.id,brand_name:l.value.brand_name||"",nickname_list:l.value.nickname_list||"",country_name:l.value.country_name||"",type:l.value.type||"",website_url:l.value.website_url||"",description:l.value.description||"",logo_image:l.value.logo_image||""})):uni.showToast({title:"获取品牌信息失败: "+(o.data.msg||"未知错误"),icon:"none"})}catch(e){t("error","at pages/creator_base/brand_edit/brand_edit.vue:202","获取品牌信息失败:",e),uni.showToast({title:"获取品牌信息失败，请重试",icon:"none"})}finally{i.value=!1}},m=async()=>{try{const e=await ge();uni.showLoading({title:"上传中...",mask:!0});const t=await fe();if(!t||!t.path||!t.token)throw new Error("获取上传凭证失败: 缺少必要字段");const a=t.path,o=await ye(e,t.token,a);o&&o.imageUrl&&(n.logo_image=o.imageUrl,uni.showToast({title:"上传成功,保存生效",icon:"success"}))}catch(e){t("error","at pages/creator_base/brand_edit/brand_edit.vue:248","上传LOGO失败:",e),uni.showToast({title:`上传LOGO失败: ${e.message||e}`,icon:"none",duration:3e3})}finally{uni.hideLoading()}},p=async()=>{if(r.value)try{i.value=!0;const e={id:n.id,brand_name:n.brand_name,nickname_list:n.nickname_list,country_name:n.country_name,type:n.type,website_url:n.website_url,description:n.description,logo_image:n.logo_image},t=await uni.request({url:`${u.value}/brand-manager/update-brand`,method:"POST",header:{"Content-Type":"application/json",Authorization:uni.getStorageSync("token")},data:e});"success"===t.data.status?(uni.showToast({title:"已更新",icon:"success"}),d()):uni.showToast({title:"更新失败: "+(t.data.msg||"未知错误"),icon:"none"})}catch(e){t("error","at pages/creator_base/brand_edit/brand_edit.vue:302","提交失败:",e),uni.showToast({title:"提交失败，请重试",icon:"none"})}finally{i.value=!1}};return e.onMounted((()=>{uni.setNavigationBarTitle({title:"编辑品牌信息"}),d()})),(t,o)=>{const u=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"brand-edit-container"},[e.createElementVNode("view",{class:"form-wrapper"},[e.createElementVNode("view",{class:"logo-editor"},[e.createElementVNode("view",{class:"preview-title"},"品牌LOGO"),e.createElementVNode("view",{class:"logo-preview"},[e.createElementVNode("image",{src:n.logo_image||l.value.logo_image,mode:"aspectFit",class:"logo-image"},null,8,["src"]),e.createElementVNode("button",{class:"change-logo-btn",onClick:m},"更换LOGO")])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:" ","onUpdate:modelValue":o[0]||(o[0]=e=>n.brand_name=e),maxlength:"20"},null,512),[[e.vModelText,n.brand_name]]),e.createElementVNode("label",{class:"floating-label"},"品牌名称"),e.createVNode(u,{class:"input-icon",type:"compose",size:"18",color:"#999"})]),n.brand_name&&l.value.brand_name_image?(e.openBlock(),e.createElementBlock("view",{key:0,class:"brand-preview"},[e.createElementVNode("view",{class:"preview-title"},"效果预览"),e.createElementVNode("view",{class:"preview-content"},[e.createElementVNode("image",{src:l.value.brand_name_image,mode:"widthFix",class:"preview-image"},null,8,["src"])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"hint-text"},[e.createElementVNode("text",null,"展示给用户的名称，尽量不要使用emoji，符号表情，我的程序会用艺术字体生成您品牌名称的粗体文字，含有特殊字符可能会导致渲染为【口】。"),e.createElementVNode("text",null,"您的名称在程序中会进行中英文分词，以便用户更快速的搜索到您，字符顺序不对也可以兼容，例如：这些搜索都可以搜索到娃圈狗狗助手 WaQuanGouGou/wqgg/娃狗手/手狗 , 用户输入的命中词数决定了在搜索框中的排序权重。"),e.createElementVNode("text",null,"但需要注意的是过长的名字并不会换行展示，而是压缩在一行里。")]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:" ","onUpdate:modelValue":o[1]||(o[1]=e=>n.nickname_list=e)},null,512),[[e.vModelText,n.nickname_list]]),e.createElementVNode("label",{class:"floating-label"},"品牌别名（多个用逗号分隔）"),e.createVNode(u,{class:"input-icon",type:"flag",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"hint-text"},[e.createElementVNode("text",null,"您的其它称呼，我们也对别名进行了分词，用户同样可以通过别名查找到您，但别名的命中词权重低于名称，您可以在搜索框中实验搜索效果;"),e.createElementVNode("text",null,"如果您的别称在圈内十分出名，我们建议放在名称后面。例如：娃圈狗狗助手（眠猫）")]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:" ","onUpdate:modelValue":o[2]||(o[2]=e=>n.country_name=e)},null,512),[[e.vModelText,n.country_name]]),e.createElementVNode("label",{class:"floating-label"},"国籍"),e.createVNode(u,{class:"input-icon",type:"location",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("picker",{value:s.value.indexOf(n.type),range:s.value,onChange:c},[e.createElementVNode("view",{class:"picker-view"},[e.createElementVNode("text",{class:"picker-value"},e.toDisplayString(n.type||"请选择身份类型"),1),e.createVNode(u,{class:"picker-icon",type:"arrowdown",size:"16",color:"#999"})])],40,["value","range"]),e.createElementVNode("label",{class:"floating-label",style:{top:"0px","font-size":"14px"}},"身份类型"),e.createVNode(u,{class:"input-icon",type:"person",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"hint-text"},[e.createElementVNode("text",null,"向他人展示您的身份，可选公司或个人作者，个人作者意为个人自制。")]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:" ","onUpdate:modelValue":o[3]||(o[3]=e=>n.website_url=e)},null,512),[[e.vModelText,n.website_url]]),e.createElementVNode("label",{class:"floating-label"},"贩售渠道（URL）"),e.createVNode(u,{class:"input-icon",type:"link",size:"18",color:"#999"})]),e.createElementVNode("view",{class:"hint-text"},[e.createElementVNode("text",null,"淘宝店URL、微店URL等，请确认是一个能打开的地址。")]),e.createElementVNode("view",{class:"input-item textarea-item"},[e.withDirectives(e.createElementVNode("textarea",{class:"textarea",placeholder:" ","onUpdate:modelValue":o[4]||(o[4]=e=>n.description=e),maxlength:"200"},null,512),[[e.vModelText,n.description]]),e.createElementVNode("label",{class:"floating-label",style:{top:"60rpx"}},"品牌描述"),e.createVNode(u,{class:"input-icon",type:"chat",size:"18",color:"#999"})]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{active:r.value}]),onClick:p,disabled:!r.value||i.value}," 更新品牌信息 ",10,["disabled"]),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-overlay"},[e.createVNode(u,{type:"spinner-cycle",size:"32",color:"#fff",class:"loading-icon"})])):e.createCommentVNode("",!0)])])}}},rs=V(is,[["__scopeId","data-v-4648e78a"]]),cs={__name:"goods_list",setup(o){const l=e.ref([]),s=e.ref(!0),i=e.ref("more"),r=e.ref(null),c=e.ref(null),d=e.ref(1),m=e.ref({}),p=e.ref("all"),h=e.ref(0),g=e.ref(null),v=e.ref([]),y=e.ref(0),w=e.ref(!1),_=e.ref(!1),k=e.ref(0),E=e.ref(!1),N=e.ref(0),V=e.ref({"限量预定":"限量预定","限时预定":"限时预定","限时限量预定":"限时限量预定","限量现货":"限量现货","现货":"现货"}),x=e.ref(["限量预定","限时预定","限时限量预定","限量现货","现货"]),S=e=>{const t=e.detail.value;k.value=t,P.value.sale_type=x.value[t]},C=e.ref([{value:"CNY",text:"人民币 (CNY)"},{value:"USD",text:"美元 (USD)"},{value:"JPY",text:"日元 (JPY)"},{value:"KRW",text:"韩元 (KRW)"}]),B=e.ref(""),T=e.ref(""),D=e.ref(""),I=e.ref(""),z=e.ref(""),A=e.ref(""),P=e.ref({goods_id:0,sale_type:"",sub_amount:"",fin_amount:"",sub_date:"",sub_time:"",fin_date:"",fin_time:"",currency:"CNY"}),L=()=>{uni.navigateTo({url:"/pages/creator_base/goods_editor/goods_editor"})},$=e.computed((()=>C.value.map((e=>e.text)))),F=e=>{p.value=e,d.value=1,l.value=[],Z(1)},M=()=>{g.value.close(),R()},R=()=>{P.value={},w.value=!1,_.value=!1,E.value=!1,B.value="",T.value="",D.value="",I.value="",z.value="",A.value=""},O=()=>{R()},q=()=>{P.value={goods_id:y.value,sale_type:"",sub_amount:"",fin_amount:"",sub_time:"",fin_time:"",currency:"CNY"},w.value=!0},U=e=>{const t=e.detail.value;N.value=t,P.value.currency=C.value[t].value},j=e=>{B.value=e.detail.value},H=e=>{T.value=e.detail.value},G=e=>{z.value=e.detail.value},W=e=>{A.value=e.detail.value},K=async()=>{try{if(!P.value.sale_type)return void uni.showToast({title:"请选择贩售模式",icon:"none"});if(!P.value.sub_amount)return void uni.showToast({title:"请输入定金金额",icon:"none"});if(!P.value.fin_amount)return void uni.showToast({title:"请输入尾款金额",icon:"none"});if(!P.value.currency)return void uni.showToast({title:"请选择币种",icon:"none"});if(!B.value||!T.value)return void uni.showToast({title:"请选择完整的开始时间",icon:"none"});if(!z.value||!A.value)return void uni.showToast({title:"请选择完整的预定/购买截止时间",icon:"none"});const e=`${B.value} ${T.value}`;P.value.sub_time=Math.floor(new Date(e).getTime()/1e3);const t=`${z.value} ${A.value}`;P.value.sub_time_end=Math.floor(new Date(t).getTime()/1e3);const a=uni.getStorageSync("token"),o="POST",n=P.value.id?`${u.value}/brand-manager/update-sales`:`${u.value}/brand-manager/create-sales`,l={...P.value,sub_amount:parseInt(P.value.sub_amount),fin_amount:parseInt(P.value.fin_amount)},s=await uni.request({url:n,method:o,header:{Authorization:a,"Content-Type":"application/json"},data:l});"success"===s.data.status?(uni.showToast({title:"保存成功",icon:"success"}),await Y(y.value),R()):uni.showToast({title:s.data.msg||"保存失败",icon:"none"})}catch(e){t("error","at pages/creator_base/goods_list/goods_list.vue:647","保存贩售计划失败:",e),uni.showToast({title:"保存失败",icon:"none"})}},Y=async e=>{try{const t=uni.getStorageSync("token"),a=await uni.request({url:`${u.value}/brand-manager/goods-sales`,method:"GET",header:{Authorization:t},data:{goods_id:e}});"success"===a.data.status?v.value=a.data.data||[]:(uni.showToast({title:a.data.msg||"获取贩售计划失败",icon:"none"}),v.value=[])}catch(a){t("error","at pages/creator_base/goods_list/goods_list.vue:680","获取贩售计划失败:",a),v.value=[],uni.showToast({title:"获取贩售计划失败",icon:"none"})}},Q=e=>{if(!e)return"";return(e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`)(new Date(1e3*e))},X=e=>{if(!e)return"";const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},Z=async(e=1)=>{try{e>1?i.value="loading":s.value=!0;const t=uni.getStorageSync("token");if(!t)return r.value="未登录，请先登录",s.value=!1,void(i.value="more");const a=(await uni.request({url:`${u.value}/brand-manager/get-goods-list`,method:"GET",header:{Authorization:t},data:{page:e,page_size:10,type:"all"===p.value?"":p.value}})).data;if("success"===a.status){const t=a.data.goods_list||[];d.value=e,l.value=1===e?t:[...l.value,...t],c.value={page_index:a.data.page_index,page_size:a.data.page_size,total:a.data.total};const o=Math.ceil(c.value.total/c.value.page_size);i.value=c.value.page_index<o?"more":"noMore"}else r.value=a.msg||"获取商品列表失败",uni.showToast({title:r.value,icon:"none"}),i.value="more"}catch(a){r.value="网络请求失败",t("error","at pages/creator_base/goods_list/goods_list.vue:771","获取商品列表失败:",a),uni.showToast({title:"网络请求失败",icon:"none"}),i.value="more"}finally{s.value=!1}},ee=()=>{"more"===i.value&&Z(d.value+1)};return n((async()=>{uni.setNavigationBarTitle({title:"作品管理"});if(!(await f()))return uni.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{uni.reLaunch({url:"/pages/login/login"})}),1500);await(async()=>{try{const e=uni.getStorageSync("token"),t=await uni.request({url:`${u.value}/brand-manager/get-goods-count`,method:"GET",header:{Authorization:e},data:{brand_id:1}});if("success"===t.data.status){let e=0;const a=t.data.data;for(const t in a)e+=a[t];m.value=a,h.value=e}else uni.showToast({title:t.data.msg||"获取分类数量失败",icon:"none"})}catch(e){t("error","at pages/creator_base/goods_list/goods_list.vue:349","获取分类数量失败:",e),uni.showToast({title:"获取分类数量失败",icon:"none"})}})(),Z(1)})),(o,n)=>{const r=a(e.resolveDynamicComponent("uni-icons"),b),c=a(e.resolveDynamicComponent("uni-load-more"),Xe),d=a(e.resolveDynamicComponent("uni-popup"),J);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("scroll-view",{"scroll-x":"true",class:"category-scroll","scroll-with-animation":!0},[e.createElementVNode("view",{class:"category-list"},[e.createElementVNode("view",{class:e.normalizeClass(["category-item",{active:"all"===p.value}]),onClick:n[0]||(n[0]=e=>F("all"))},[e.createElementVNode("text",null,"全部"),e.createElementVNode("text",{class:"count"},"("+e.toDisplayString(m.value.all||0)+")",1)],2),"all"!==o.e_type?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(m.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["category-item",{active:p.value===a}]),onClick:e=>F(a)},[e.createElementVNode("text",null,e.toDisplayString(a),1),e.createElementVNode("text",{class:"count"},"("+e.toDisplayString(t)+")",1)],10,["onClick"])))),128)):e.createCommentVNode("",!0)])]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):0===l.value.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},"暂无商品")):(e.openBlock(),e.createElementBlock("scroll-view",{key:2,"scroll-y":"true",class:"scroll-view",onScrolltolower:ee},[e.createElementVNode("view",{class:"goods-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:e.normalizeClass(["goods-item",{"last-item":a===l.value.length-1}])},[e.createElementVNode("view",{class:"goods-main"},[e.createElementVNode("view",{class:"image-container"},[e.createElementVNode("image",{class:"goods-image",src:t.goods_images[0]||"/static/default-goods.png",mode:"aspectFill"},null,8,["src"])]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("view",{class:"title-row"},[e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1),t.is_hot?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tag"},"热销")):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"goods-details"},[e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"尺寸:"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(t.size||"无"),1)]),e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"肤色:"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(t.skin||"无"),1)])]),e.createElementVNode("view",{class:"price-container"},[e.createElementVNode("text",{class:"goods-price"},"¥"+e.toDisplayString(t.total_amount),1),e.createElementVNode("text",{class:"goods-currency"},e.toDisplayString(t.currency),1)])])]),e.createElementVNode("view",{class:"action-buttons-single-row"},[e.createElementVNode("button",{class:"btn preview",onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/goods/goods?goods_id=${a}`});var a}},[e.createVNode(r,{type:"eye",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 预览 ")],8,["onClick"]),e.createElementVNode("button",{class:"btn edit",onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/creator_base/goods_editor/goods_editor?goods_id=${a}`});var a}},[e.createVNode(r,{type:"compose",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 编辑 ")],8,["onClick"]),e.createElementVNode("button",{class:"btn collocation",onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/creator_base/collocation_list/collocation_list?goods_id=${a}`});var a}},[e.createVNode(r,{type:"star",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 搭配参考 ")],8,["onClick"]),e.createElementVNode("button",{class:"btn sales",onClick:e=>(async e=>{y.value=e,await Y(e),g.value.open()})(t.id)},[e.createVNode(r,{type:"shop",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 贩售计划 ")],8,["onClick"])])],2)))),128))]),e.createElementVNode("view",{class:"load-more"},[e.createVNode(c,{status:i.value,contentText:{contentdown:"上拉加载更多",contentrefresh:"正在加载...",contentnomore:"没有更多了"}},null,8,["status","contentText"])])],32)),e.createVNode(d,{ref_key:"salesPopup",ref:g,type:"bottom","background-color":"#fff"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"sales-popup"},[e.createElementVNode("scroll-view",{"scroll-y":"true",class:"popup-scroll-view"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"title"},"贩售计划管理"),e.createVNode(r,{type:"close",size:"20",color:"#999",onClick:M})]),v.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"sales-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,(a=>(e.openBlock(),e.createElementBlock("view",{class:"sales-item",key:a.id},[e.createElementVNode("view",{class:"sale-info"},[e.createElementVNode("text",{class:"sale-type"},e.toDisplayString(V.value[a.sale_type]||a.sale_type),1),e.createElementVNode("text",{class:"sale-time"},e.toDisplayString(X(a.sub_time))+" "+e.toDisplayString(Q(a.sub_time))+" - "+e.toDisplayString(X(a.sub_time_end))+" "+e.toDisplayString(Q(a.sub_time_end)),1),e.createElementVNode("text",{class:"sale-amount"},"定金: ¥"+e.toDisplayString(a.sub_amount)+" 尾款: ¥"+e.toDisplayString(a.fin_amount),1)]),e.createElementVNode("view",{class:"sale-actions"},[e.createVNode(r,{type:"compose",size:"18",color:"#666",onClick:e=>(e=>{P.value={...e},e.sub_time&&e.sub_time>0?(B.value=X(e.sub_time),T.value=Q(e.sub_time)):(B.value="",T.value=""),e.sub_time_end&&e.sub_time_end>0?(z.value=X(e.sub_time_end),A.value=Q(e.sub_time_end)):(z.value="",A.value=""),w.value=!0})(a)},null,8,["onClick"]),e.createVNode(r,{type:"trash",size:"18",color:"#f56c6c",onClick:e=>(async e=>{uni.showModal({title:"删除确认",content:"确定要删除这条贩售计划吗？",success:async a=>{if(a.confirm)try{const t=uni.getStorageSync("token"),a=await uni.request({url:`${u.value}/brand-manager/sale`,method:"DELETE",header:{Authorization:t},data:{id:e}});"success"===a.data.status?(uni.showToast({title:"删除成功",icon:"success"}),await Y(y.value)):uni.showToast({title:a.data.msg||"删除失败",icon:"none"})}catch(o){t("error","at pages/creator_base/goods_list/goods_list.vue:507","删除贩售计划失败:",o),uni.showToast({title:"删除失败",icon:"none"})}}})})(a.id)},null,8,["onClick"])])])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-sales"},[e.createElementVNode("text",null,"暂无贩售计划")])),e.createElementVNode("button",{class:"add-btn",onClick:q},[e.createVNode(r,{type:"plus",size:"16",color:"#fff"}),e.createTextVNode(" 添加贩售计划 ")]),w.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"sale-form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"贩售模式"),e.createElementVNode("picker",{mode:"selector",range:x.value,value:k.value,onChange:S},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(V.value[P.value.sale_type]||"请选择贩售模式"),1)],40,["range","value"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"定金金额"),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":n[1]||(n[1]=e=>P.value.sub_amount=e),placeholder:"请输入定金金额"},null,512),[[e.vModelText,P.value.sub_amount]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"尾款金额"),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":n[2]||(n[2]=e=>P.value.fin_amount=e),placeholder:"请输入尾款金额"},null,512),[[e.vModelText,P.value.fin_amount]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"定金时间"),e.createElementVNode("picker",{mode:"date",value:B.value,onChange:j},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(B.value||"选择日期"),1)],40,["value"]),e.createElementVNode("picker",{mode:"time",value:T.value,onChange:H},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(T.value||"选择时间"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"预定/购买截止时间"),e.createElementVNode("picker",{mode:"date",value:z.value,onChange:G},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(z.value||"选择日期"),1)],40,["value"]),e.createElementVNode("picker",{mode:"time",value:A.value,onChange:W},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(A.value||"选择时间"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"币种"),e.createElementVNode("picker",{mode:"selector",range:$.value,value:N.value,onChange:U},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(P.value.currency||"请选择币种"),1)],40,["range","value"])]),e.createElementVNode("view",{class:"form-buttons"},[e.createElementVNode("button",{class:"btn cancel",onClick:O},"取消"),e.createElementVNode("button",{class:"btn save",onClick:K},"保存")])])):e.createCommentVNode("",!0)])])])),_:1},512),e.createElementVNode("view",{class:"floating-button",onClick:L},[e.createVNode(r,{type:"plusempty",size:"30",color:"#fff"})])])}}},us=V(cs,[["__scopeId","data-v-398d7694"]]),ds=V({__name:"cascade-multi-select",props:{show:{type:Boolean,default:!1},sizeData:{type:Object,default:()=>({})},initialSelection:{type:Array,default:()=>[]}},emits:["close","confirm"],setup(t,{emit:o}){const n=t,l=o,s=e.ref(""),i=e.ref([]),r=e.computed((()=>Object.keys(n.sizeData).map((e=>({label:e,value:e,count:n.sizeData[e].length}))))),c=e.computed((()=>s.value&&n.sizeData[s.value]||[])),u=()=>{s.value="",i.value=[]},d=()=>{l("close")},m=(e,t)=>i.value.some((a=>a.category===t&&a.size===e)),p=()=>{l("confirm",[...i.value]),d()};return e.watch((()=>n.show),(e=>{e&&(n.initialSelection&&n.initialSelection.length>0?(i.value=[...n.initialSelection],n.initialSelection[0]&&(s.value=n.initialSelection[0].category)):(u(),r.value.length>0&&(s.value=r.value[0].value)))})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b),h=a(e.resolveDynamicComponent("bottom-popup"),H);return e.openBlock(),e.createBlock(h,{show:t.show,onClose:d},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"cascade-container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"选择尺寸"),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("text",{class:"action-text",onClick:u},"重置"),e.createVNode(l,{type:"closeempty",size:"24",color:"#666",onClick:d})])]),e.createElementVNode("view",{class:"cascade-body"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"categories-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["category-item",{active:s.value===t.value}]),onClick:e=>(e=>{s.value=e.value})(t)},[e.createElementVNode("text",{class:"category-label"},e.toDisplayString(t.label),1),e.createElementVNode("text",{class:"category-count"},e.toDisplayString(t.count)+"个",1)],10,["onClick"])))),128))]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"sizes-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["size-item",{selected:m(t,s.value)}]),onClick:e=>((e,t)=>{const a=i.value.findIndex((a=>a.category===t&&a.size===e));a>=0?i.value.splice(a,1):i.value.push({category:t,size:e})})(t,s.value)},[e.createElementVNode("text",{class:"size-label"},e.toDisplayString(t),1),m(t,s.value)?(e.openBlock(),e.createBlock(l,{key:0,type:"checkmarkempty",size:"16",color:"#65c6d9"})):e.createCommentVNode("",!0)],10,["onClick"])))),128))])]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("text",{class:"selected-count"},"已选: "+e.toDisplayString(i.value.length)+"个",1),e.createElementVNode("button",{class:"confirm-btn",onClick:p},"确定")])])])),_:1},8,["show"])}}},[["__scopeId","data-v-e9360f38"]]),ms={__name:"goods_editor",props:{goods_id:{type:String}},setup(o){const n=o,l=e.computed((()=>n.goods_id&&"0"!==n.goods_id&&"new"!==n.goods_id)),s=e.ref({id:0,name:"",brand_id:0,brand_name:"",total_amount:0,currency:"CNY",size:"",size_detail:"",skin:"",type:"",desc_content:"",doll_material:"",goods_images:[],sizes:[]}),i=e.ref(!0),r=e.ref([]),c=e.ref([]);e.ref([]);const d=e.ref(!1),m=e.ref(null),p=e.ref([]),h=e.ref(-1),g=e.ref([]),v=e.ref(-1),f=e.ref({}),y=e.ref([]),w=e.ref(-1),_=e.ref(["白肌","浅烧","牡丹白","奶油","半白","粉白","普肌","粉普","烧肌"]),k=e.computed((()=>["整体","单体","单头"].includes(s.value.type))),E=e.ref([]),N=e.computed((()=>s.value.sizes&&Array.isArray(s.value.sizes)?s.value.sizes.map((e=>`${e.goods_size}/${e.size_detail}`)):[])),V=()=>{E.value=(s.value.sizes||[]).map((e=>({category:e.goods_size,size:e.size_detail}))),d.value=!0},x=e=>{s.value.sizes=e.map((e=>({goods_size:e.category,size_detail:e.size})))},S=e=>{t("log","at pages/creator_base/goods_editor/goods_editor.vue:391","点击了图片",e);const a=s.value.goods_images.map((e=>e.src)),o=s.value.goods_images.findIndex((t=>t.id===e.id));return uni.previewImage({urls:a,current:o>=0?o:0,indicator:"default",loop:!0}),!1},C=async()=>{try{let e=`${u.value}/materials`;"假发"===s.value.type&&(e=`${u.value}/hair-materials`);const t=await uni.request({url:e,method:"GET"});"success"===t.data.status&&(y.value=t.data.data)}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:427","获取材质数据失败:",e),uni.showToast({title:"获取材质数据失败",icon:"none"})}},B=e=>{const t=e.detail.value;h.value=t,s.value.type=p.value[t],C()},T=e=>{const t=e.detail.value;v.value=t,s.value.currency=g.value[t]},D=e=>{const t=e.detail.value;w.value=t,s.value.doll_material=y.value[t]},I=e=>{const t=[];e.forEach((e=>{const a=s.value.goods_images.find((t=>t.id===e));a&&t.push(a)})),s.value.goods_images=t},z=async()=>{try{if(uni.showLoading({title:"保存中..."}),!s.value.name)return void uni.showToast({title:"请填写商品名称",icon:"none"});if(!s.value.type)return void uni.showToast({title:"请选择商品类型",icon:"none"});if(!s.value.goods_images||0===s.value.goods_images.length)return void uni.showToast({title:"请至少上传一张商品图片",icon:"none"});const e={...s.value,goods_images:s.value.goods_images.map((e=>({id:e.id,url:e.src}))),sizes:s.value.sizes,total_amount:parseInt(s.value.total_amount)},t=uni.getStorageSync("token");if(!t)return error.value="未登录，请先登录",loading.value=!1,void(loadStatus.value="more");const a=l.value?`${u.value}/brand-manager/update-goods`:`${u.value}/brand-manager/add-goods`,o=(l.value,"POST"),n=await uni.request({url:a,method:o,data:e,header:{Authorization:t}});"success"===n.data.status?(uni.showToast({title:l.value?"保存成功":"添加成功"}),setTimeout((()=>{uni.navigateBack()}),1500)):uni.showToast({title:n.data.msg||(l.value?"保存失败":"添加失败"),icon:"none"})}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:577","操作失败",e),uni.showToast({title:l.value?"保存失败":"添加失败",icon:"none"})}finally{uni.hideLoading()}},A=async()=>{try{const a=9-s.value.goods_images.length;if(a<=0)return void uni.showToast({title:"最多只能添加9张图片",icon:"none"});const o=await ve(a);uni.showLoading({title:"上传中...",mask:!0});for(let n=0;n<o.length;n++)try{uni.showLoading({title:`上传中 (${n+1}/${o.length})`,mask:!0});const e=await fe();if(!e||!e.path||!e.token)throw new Error("获取上传凭证失败: 缺少必要字段");const t=e.path,a=await ye(o[n],e.token,t);a&&a.imageUrl&&s.value.goods_images.push({id:Date.now()+n,src:a.imageUrl,name:"",price:"",type:""})}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:647",`第 ${n+1} 张图片上传失败:`,e),uni.showToast({title:`第 ${n+1} 张图片上传失败: ${e.message||e}`,icon:"none",duration:3e3})}uni.hideLoading(),uni.showToast({title:`成功添加${o.length}张图片`,icon:"success"})}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:662","添加图片失败",e),uni.hideLoading(),uni.showToast({title:`添加图片失败: ${e.message||e}`,icon:"none",duration:3e3})}},P=e=>{uni.showModal({title:"删除确认",content:"确定要删除这张图片吗？",confirmText:"删除",confirmColor:"#ff3b30",success:t=>{t.confirm&&(s.value.goods_images=s.value.goods_images.filter((t=>t.id!==e)),uni.showToast({title:"图片已删除",icon:"success"}))}})};return e.onMounted((async()=>{uni.setNavigationBarTitle({title:l.value?"编辑商品信息":"添加新商品"}),await(async()=>{try{const e=await uni.request({url:`${u.value}/sizes`,method:"GET"});if("success"===e.data.status){r.value=e.data.data;const t=[];for(const[e,a]of Object.entries(r.value))t.push({text:e,value:e,children:a.map((e=>({text:e,value:e})))});c.value=t}}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:341","获取尺寸数据失败:",e),uni.showToast({title:"获取尺寸数据失败",icon:"none"})}})(),await(async()=>{try{const e=await uni.request({url:`${u.value}/goods-types`,method:"GET"});"success"===e.data.status&&(p.value=e.data.data)}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:361","获取类型数据失败:",e),uni.showToast({title:"获取类型数据失败",icon:"none"})}})(),await(async()=>{try{const e=await uni.request({url:`${u.value}/currency`,method:"GET"});"success"===e.data.status&&(f.value=e.data.data,g.value=Object.keys(e.data.data))}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:382","获取货币数据失败:",e),uni.showToast({title:"获取货币数据失败",icon:"none"})}})(),await(async()=>{try{if(!l.value){const e=uni.getStorageSync("userInfo");return void(e&&e.brand&&(s.value.brand_id=e.brand.id,s.value.brand_name=e.brand.name))}uni.showLoading({title:"加载中..."});const e=uni.getStorageSync("token");if(!e)return error.value="未登录，请先登录",loading.value=!1,void(loadStatus.value="more");const t=await uni.request({url:`${u.value}/brand-manager/get-goods-info-by-id`,method:"GET",data:{id:n.goods_id},header:{Authorization:e}});if("success"===t.data.status){const e=t.data.data;s.value={...e,sizes:e.sizes||[],goods_images:e.goods_images.map((e=>({id:e.id,src:e.url,name:"",price:"",type:""})))},h.value=p.value.indexOf(s.value.type),v.value=g.value.findIndex((e=>e===s.value.currency)),w.value=y.value.indexOf(s.value.doll_material)}else uni.showToast({title:t.data.msg,icon:"none"})}catch(e){t("error","at pages/creator_base/goods_editor/goods_editor.vue:304","获取商品信息失败",e),uni.showToast({title:"获取商品信息失败",icon:"none"})}finally{uni.hideLoading()}})(),await C()})),(t,o)=>{const n=a(e.resolveDynamicComponent("cascade-multi-select"),ds),c=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("shmily-drag-image"),Z);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"form-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"商品名称"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>s.value.name=e),placeholder:"请输入商品名称",class:"input"},null,512),[[e.vModelText,s.value.name]])]),s.value.brand_name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"form-item"},[e.createElementVNode("text",{class:"label"},"品牌"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>s.value.brand_name=e),disabled:"",class:"input disabled"},null,512),[[e.vModelText,s.value.brand_name]])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"价格"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>s.value.total_amount=e),type:"number",placeholder:"请输入价格",class:"input"},null,512),[[e.vModelText,s.value.total_amount]]),e.createElementVNode("picker",{class:"currency-picker",onChange:T,value:v.value,range:g.value},[e.createElementVNode("view",{class:"currency"},e.toDisplayString(s.value.currency),1)],40,["value","range"]),e.createElementVNode("text",{class:"hint"},"暂不支持小数点，如有加购项、不同售价，可以写在描述里")]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"尺寸"),e.createElementVNode("view",{class:"selected-sizes",onClick:V},[0===N.value.length?(e.openBlock(),e.createElementBlock("text",{key:0},"选择尺寸")):(e.openBlock(),e.createElementBlock("view",{key:1,class:"size-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"size-tag"},e.toDisplayString(t),1)))),128))])),e.createElementVNode("text",{class:"hint"},"可以多选您支持的尺寸，可以选择多个分类；我们推荐不同的大分类建多个词条，并在名称后面加入（x分）的描述。")]),e.createVNode(n,{ref_key:"sizeSelector",ref:m,show:d.value,sizeData:r.value,initialSelection:E.value,onClose:o[3]||(o[3]=e=>d.value=!1),onConfirm:x},null,8,["show","sizeData","initialSelection"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"类型"),e.createElementVNode("picker",{onChange:B,value:h.value,range:p.value},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(s.value.type||"请选择类型"),1)],40,["value","range"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"肤色"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[4]||(o[4]=e=>s.value.skin=e),placeholder:"请输入肤色",class:"input"},null,512),[[e.vModelText,s.value.skin]]),k.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"skin-quick-selector"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"skin-tag",onClick:e=>(e=>{s.value.skin?s.value.skin+=` ${e}`:s.value.skin=e})(t)},e.toDisplayString(t),9,["onClick"])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"材质"),e.createElementVNode("picker",{onChange:D,value:w.value,range:y.value},[e.createElementVNode("view",{class:"picker-content"},e.toDisplayString(s.value.doll_material||"请选择材质"),1)],40,["value","range"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"描述"),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":o[5]||(o[5]=e=>s.value.desc_content=e),placeholder:"请输入商品描述",class:"textarea","auto-height":""},null,512),[[e.vModelText,s.value.desc_content]]),e.createElementVNode("text",{class:"hint"},"可以填写加购项目或不同肤色的价格。")]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"商品图片"),e.createElementVNode("text",{class:"hint"},"长按图片可拖拽排序"+e.toDisplayString(i.value?"，点击图片右上角可删除。":""),1),e.createElementVNode("text",{class:"hint"},"为了保持版面美观， 请将最好看的一张图放在第一张，第一张不要用大字报。为了保证用户最佳观看效果，请不要上传过大图片和长宽比效果不佳的图片（3:4最优)。 "),e.createElementVNode("text",{class:"hint"},"同时为了保护平台数据安全，我们会在一段时间后自动添加水印，但您仍然能看到无水印原图。"),s.value.goods_images.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"add-image-btn",onClick:A},[e.createVNode(c,{type:"plusempty",size:"30",color:"#999"}),e.createElementVNode("text",null,"添加图片")])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"image-edit-container"},[e.createVNode(u,{modelValue:s.value.goods_images,"onUpdate:modelValue":o[6]||(o[6]=e=>s.value.goods_images=e),cols:3,showItemInfo:!1,itemMargin:10,showDelete:!0,"border-radius":"0",onSortChange:I,onItemClick:S,"custom-click":!0,onDelete:P,keyName:"src"},null,8,["modelValue"])])]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("button",{class:"btn save-btn",onClick:z},e.toDisplayString(l.value?"保存修改":"添加商品"),1)])])}}},ps=V(ms,[["__scopeId","data-v-b7a27c65"]]);
/*!
    * vue-router v4.3.0
    * (c) 2024 Eduardo San Martin Morote
    * @license MIT
    */
var hs,gs,vs,fs,ys,ws;(gs=hs||(hs={})).pop="pop",gs.push="push",(fs=vs||(vs={})).back="back",fs.forward="forward",fs.unknown="",(ws=ys||(ys={}))[ws.aborted=4]="aborted",ws[ws.cancelled=8]="cancelled",ws[ws.duplicated=16]="duplicated";const _s=Symbol("");const ks={__name:"collocation_list",setup(o){const n=e.inject(_s),l=e.ref(n.query.goods_id||""),s=e.ref([]),i=e.ref(!0),r=e.ref(null),c=async()=>{if(l.value)try{i.value=!0;const e=await uni.request({url:`${u.value}/goods-collocation`,method:"GET",data:{goods_id:l.value,official:!0}});if("success"!==e.data.status)throw new Error(e.data.msg||"获取搭配数据失败");{const t=e.data.data;s.value=t.collocation_relation_list.map((e=>({...e,imageList:e.image_urls.split(",").map((e=>e.trim()))})))}}catch(e){uni.showToast({title:e.message||"请求失败",icon:"none"}),t("error","at pages/creator_base/collocation_list/collocation_list.vue:131","获取搭配数据失败:",e)}finally{i.value=!1}else uni.showToast({title:"商品ID缺失",icon:"none"})},d=async()=>{if(!r.value&&l.value)try{const e=await uni.request({url:`${u.value}/goods`,method:"GET",data:{id:l.value}});"success"===e.data.status&&(r.value=e.data.data)}catch(o){t("error","at pages/creator_base/collocation_list/collocation_list.vue:171","获取商品信息失败:",o)}const e={goods_id:l.value};r.value&&(e.brand_id=r.value.brand_id,e.goods_name=r.value.name,e.brand_name=r.value.brand_name,e.type=r.value.type);const a=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");uni.navigateTo({url:`/pages/collocation/collocation?${a}`})},m=e=>{const t=new Date(1e3*e);return`${t.getMonth()+1}-${t.getDate()} ${t.getHours()}:${t.getMinutes()}`};return e.onMounted((async()=>{uni.setNavigationBarTitle({title:"官方搭配管理"}),h.isLogin||await f(),c()})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-bg"}),e.createElementVNode("view",{class:"header"},[e.createElementVNode("button",{class:"add-btn",onClick:d},"添加您的搭配参考"),e.createElementVNode("view",{class:"description"},[e.createElementVNode("text",{class:"hint"},"搭配参考可以帮助您的购买者快速知晓体型适配问题，优秀的搭配参考图会显著提升买家购买欲望。"),e.createElementVNode("text",{class:"hint"},"同时，您在搭配参考中发布的关联，将被推送到其它娃物词条下方，他人在购买其它娃物时，也会通过了解到您发布关联的搭配参考，导航到您的词条。")])]),s.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"collocation-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(a=>(e.openBlock(),e.createElementBlock("view",{class:"collocation-item",key:a.relation_id},[e.createElementVNode("view",{class:"item-header"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(a.title),1),e.createElementVNode("text",{class:"type-tag"},e.toDisplayString(m(a.created_at)),1)]),e.createElementVNode("view",{class:"content"},e.toDisplayString(a.content),1),e.createElementVNode("scroll-view",{class:"image-scroll","scroll-x":"true",style:{width:"100%"}},[e.createElementVNode("view",{class:"image-wrapper"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.imageList,((t,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:t,mode:"aspectFill",class:"collocation-image",onClick:e=>((e,t)=>{uni.previewImage({current:t,urls:e})})(a.imageList,o),style:{width:"300rpx",height:"300rpx","margin-right":"20rpx","flex-shrink":"0"}},null,8,["src","onClick"])))),128))])]),e.createElementVNode("view",{class:"action-buttons-single-row"},[e.createElementVNode("button",{class:"btn preview",onClick:e=>{return t=a.collocation_id,void uni.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${t}&origin=1`});var t}},[e.createVNode(l,{type:"eye",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 预览 ")],8,["onClick"]),e.createElementVNode("button",{class:"btn edit",onClick:e=>{return t=a.collocation_id,void uni.navigateTo({url:`/pages/collocation/collocation?collocation_id=${t}`});var t}},[e.createVNode(l,{type:"compose",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 编辑 ")],8,["onClick"]),e.createElementVNode("button",{class:"btn collocation",onClick:e=>(async e=>{uni.showModal({title:"确认删除",content:"确定要删除这个搭配参考吗？",success:async a=>{if(a.confirm){t("log","at pages/creator_base/collocation_list/collocation_list.vue:213",e);try{const t=uni.getStorageSync("token"),a=await uni.request({url:`${u.value}/with-state/delete-collocation?collocation_id=${e.collocation_id}`,method:"POST",header:{Authorization:t},data:{collocation_id:e.collocation_id}});if("success"!==a.data.status)throw new Error(a.data.msg||"删除失败");uni.showToast({title:"删除成功"}),c()}catch(o){uni.showToast({title:o.message||"删除失败",icon:"none"})}}}})})(a)},[e.createVNode(l,{type:"closeempty",size:"14",color:"#3a3a3a"}),e.createTextVNode(" 删除 ")],8,["onClick"])]),e.createElementVNode("view",{class:"divider"})])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{src:"/static/empty.png",class:"empty-img"}),e.createElementVNode("text",{class:"empty-text"},"暂无搭配参考")]))])}}},Es=V({__name:"artist_info",setup(o){const n=e.ref("artist"),l=e.ref({artist_highlight_images:[],hairstylist_highlight_images:[],status_of_artist:0,status_of_hairstylist:0,base_price_of_artist:0,base_price_of_hairstylist:0,overload_ratio_of_artist:1,overload_ratio_of_hairstylist:1,rule_of_artist:"",rule_of_hairstylist:"",contact:""}),s=e.ref([{label:"请选择状态",value:0},{label:"长期接单",value:1},{label:"限时手速投递",value:2},{label:"限时抽选投递",value:3},{label:"限时黑箱卡投递",value:4},{label:"暂停接单",value:5}]),i=e.ref(!1),r=e.ref(0),c=e.ref(""),d=e.ref(!1),m=e.ref(0),p=e.ref(""),h=e.computed((()=>s.value.findIndex((e=>e.value===l.value.status_of_artist)))),g=e.computed((()=>s.value.findIndex((e=>e.value===l.value.status_of_hairstylist)))),v=e=>{n.value=e},f=(e,t)=>{uni.previewImage({current:e,urls:t})},y=async()=>{try{const a=9-l.value.artist_highlight_images.length;if(a<=0)return void uni.showToast({title:"最多只能上传9张图片",icon:"none"});const o=await ve(a);i.value=!0,r.value=0,c.value="准备上传...",c.value="获取上传凭证...";const n=await fe();if(!n||!n.token)throw new Error("获取上传凭证失败");const s=n;for(let i=0;i<o.length;i++)try{const e=o[i];c.value=`上传中 (${i+1}/${o.length})`,r.value=Math.round(i/o.length*100);const t=s.path,a=await ye(e,s.token,t);a&&a.imageUrl&&l.value.artist_highlight_images.push(a.imageUrl)}catch(e){t("error","at pages/creator_base/artist_info/artist_info.vue:321",`第 ${i+1} 张图片上传失败:`,e),uni.showToast({title:`第 ${i+1} 张图片上传失败: ${e.message||e}`,icon:"none",duration:3e3})}uni.showToast({title:"上传成功",icon:"success"})}catch(e){t("error","at pages/creator_base/artist_info/artist_info.vue:332","上传失败:",e),uni.showToast({title:"上传失败: "+(e.message||"未知错误"),icon:"none"})}finally{i.value=!1,r.value=0}},w=async()=>{try{const a=9-l.value.hairstylist_highlight_images.length;if(a<=0)return void uni.showToast({title:"最多只能上传9张图片",icon:"none"});const o=await ve(a);d.value=!0,m.value=0,p.value="准备上传...",p.value="获取上传凭证...";const n=await fe();if(!n||!n.token)throw new Error("获取上传凭证失败");const s=n;for(let i=0;i<o.length;i++)try{const e=o[i];p.value=`上传中 (${i+1}/${o.length})`,m.value=Math.round(i/o.length*100);const t=s.path,a=await ye(e,s.token,t);a&&a.imageUrl&&l.value.hairstylist_highlight_images.push(a.imageUrl)}catch(e){t("error","at pages/creator_base/artist_info/artist_info.vue:410",`第 ${i+1} 张图片上传失败:`,e),uni.showToast({title:`第 ${i+1} 张图片上传失败: ${e.message||e}`,icon:"none",duration:3e3})}uni.showToast({title:"上传成功",icon:"success"})}catch(e){t("error","at pages/creator_base/artist_info/artist_info.vue:421","上传失败:",e),uni.showToast({title:"上传失败: "+(e.message||"未知错误"),icon:"none"})}finally{d.value=!1,m.value=0}},_=async()=>{const e=uni.getStorageSync("token");if(e){uni.showLoading({title:"加载中..."});try{const a=await uni.request({url:`${u.value}/brand-manager/get-artist-info`,method:"GET",header:{Authorization:e}});if("success"===a.data.status){t("log","at pages/creator_base/artist_info/artist_info.vue:471",a.data.data);const e=a.data.data;l.value={artist_highlight_images:e.artist_highlight_images||[],hairstylist_highlight_images:e.hairstylist_highlight_images||[],status_of_artist:Number(e.status_of_artist)||0,status_of_hairstylist:Number(e.status_of_hairstylist)||0,base_price_of_artist:parseFloat(e.base_price_of_artist)||0,base_price_of_hairstylist:parseFloat(e.base_price_of_hairstylist)||0,overload_ratio_of_artist:parseFloat(e.overload_ratio_of_artist)||1,overload_ratio_of_hairstylist:parseFloat(e.overload_ratio_of_hairstylist)||1,rule_of_artist:e.rule_of_artist||"",rule_of_hairstylist:e.rule_of_hairstylist||"",contact:e.contact||""}}else uni.showToast({title:a.data.msg||"获取信息失败",icon:"none"})}catch(a){t("error","at pages/creator_base/artist_info/artist_info.vue:493","获取创作者信息失败:",a),uni.showToast({title:"网络请求失败",icon:"none"})}finally{uni.hideLoading()}}else uni.showToast({title:"请先登录",icon:"none"})},k=async()=>{const e=uni.getStorageSync("token");if(e){uni.showLoading({title:"保存中..."});try{l.value.base_price_of_artist=parseFloat(l.value.base_price_of_artist);const t=await uni.request({url:`${u.value}/brand-manager/update-artist-info`,method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:l.value});"success"===t.data.status?(uni.showToast({title:"保存成功",icon:"success"}),_()):uni.showToast({title:t.data.msg||"保存失败",icon:"none"})}catch(a){t("error","at pages/creator_base/artist_info/artist_info.vue:545","保存创作者信息失败:",a),uni.showToast({title:"网络请求失败",icon:"none"})}finally{uni.hideLoading()}}else uni.showToast({title:"请先登录",icon:"none"})};return e.onMounted((()=>{_(),uni.setNavigationBarTitle({title:"妆师毛娘信息设置"})})),(t,o)=>{const u=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"artist"===n.value}]),onClick:o[0]||(o[0]=e=>v("artist"))}," 妆师 ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"hairstylist"===n.value}]),onClick:o[1]||(o[1]=e=>v("hairstylist"))}," 毛娘 ",2)]),"artist"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"form-container"},[e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"接单方式"),e.createElementVNode("picker",{class:"picker",mode:"selector",range:s.value,"range-key":"label",value:h.value},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(s.value[h.value].label),1)],8,["range","value"])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"基础价格"),e.createElementVNode("view",{class:"input-container"},[e.createElementVNode("text",{class:"input-symbol"},"¥"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"digit","onUpdate:modelValue":o[2]||(o[2]=e=>l.value.base_price_of_artist=e),placeholder:"请输入基础价格"},null,512),[[e.vModelText,l.value.base_price_of_artist]])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"钞能力系数"),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"digit","onUpdate:modelValue":o[3]||(o[3]=e=>l.value.overload_ratio_of_artist=e),placeholder:"请输入钞能力系数"},null,512),[[e.vModelText,l.value.overload_ratio_of_artist]]),e.createElementVNode("text",{class:"input-symbol"},"倍")])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"站外联系方式"),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":o[4]||(o[4]=e=>l.value.contact=e),placeholder:"请输入联系方式，例如【闲鱼：xxx】"},null,512),[[e.vModelText,l.value.contact]])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"展示作品"),e.createElementVNode("view",{class:"highlight-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.artist_highlight_images,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"highlight-item"},[e.createElementVNode("image",{class:"highlight-img",src:t,mode:"aspectFill",onClick:e=>f(t,l.value.artist_highlight_images)},null,8,["src","onClick"]),e.createElementVNode("view",{class:"highlight-actions"},[e.createVNode(u,{type:"trash",size:"24",color:"#ff4d6a",onClick:e.withModifiers((e=>(e=>{uni.showModal({title:"提示",content:"确定要删除这张展示图吗？",success:t=>{t.confirm&&(l.value.artist_highlight_images.splice(e,1),uni.showToast({title:"删除成功",icon:"success"}))}})})(a)),["stop"])},null,8,["onClick"])])])))),128)),l.value.artist_highlight_images.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-btn",onClick:y},[e.createVNode(u,{type:"plus",size:"32",color:"#999"}),e.createElementVNode("text",{class:"upload-text"},"添加图片")])):e.createCommentVNode("",!0)]),i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-progress"},[e.createElementVNode("progress",{percent:r.value,"stroke-width":"4",activeColor:"#4a9db5"},null,8,["percent"]),e.createElementVNode("text",null,e.toDisplayString(c.value),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"细则说明"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":o[5]||(o[5]=e=>l.value.rule_of_artist=e),placeholder:"请输入妆师细则说明"},null,512),[[e.vModelText,l.value.rule_of_artist]])])])):e.createCommentVNode("",!0),"hairstylist"===n.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"form-container"},[e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"接单方式"),e.createElementVNode("picker",{class:"picker",mode:"selector",range:s.value,"range-key":"label",value:g.value},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(s.value[g.value].label),1)],8,["range","value"])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"基础价格"),e.createElementVNode("view",{class:"input-container"},[e.createElementVNode("text",{class:"input-symbol"},"¥"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"digit","onUpdate:modelValue":o[6]||(o[6]=e=>l.value.base_price_of_hairstylist=e),placeholder:"请输入基础价格"},null,512),[[e.vModelText,l.value.base_price_of_hairstylist]])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"钞能力系数"),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"digit","onUpdate:modelValue":o[7]||(o[7]=e=>l.value.overload_ratio_of_hairstylist=e),placeholder:"请输入钞能力系数"},null,512),[[e.vModelText,l.value.overload_ratio_of_hairstylist]]),e.createElementVNode("text",{class:"input-symbol"},"倍")])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"站外联系方式"),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":o[8]||(o[8]=e=>l.value.contact=e),placeholder:"请输入联系方式，例如【闲鱼：xxx】"},null,512),[[e.vModelText,l.value.contact]])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"展示作品"),e.createElementVNode("view",{class:"highlight-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.hairstylist_highlight_images,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"highlight-item"},[e.createElementVNode("image",{class:"highlight-img",src:t,mode:"aspectFill",onClick:e=>f(t,l.value.hairstylist_highlight_images)},null,8,["src","onClick"]),e.createElementVNode("view",{class:"highlight-actions"},[e.createVNode(u,{type:"trash",size:"24",color:"#ff4d6a",onClick:e.withModifiers((e=>(e=>{uni.showModal({title:"提示",content:"确定要删除这张展示图吗？",success:t=>{t.confirm&&(l.value.hairstylist_highlight_images.splice(e,1),uni.showToast({title:"删除成功",icon:"success"}))}})})(a)),["stop"])},null,8,["onClick"])])])))),128)),e.createElementVNode("view",{class:"add-btn",onClick:w},[e.createVNode(u,{type:"plus",size:"24",color:"#fff"})])]),d.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-progress"},[e.createElementVNode("progress",{percent:m.value,"stroke-width":"4",activeColor:"#4a9db5"},null,8,["percent"]),e.createElementVNode("text",null,e.toDisplayString(p.value),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"细则说明"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":o[9]||(o[9]=e=>l.value.rule_of_hairstylist=e),placeholder:"请输入毛娘细则说明"},null,512),[[e.vModelText,l.value.rule_of_hairstylist]])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"save-btn",onClick:k},"保存设置")])}}},[["__scopeId","data-v-a5731b02"]]),Ns={__name:"artist_setting",setup(t){e.ref(""),e.ref({});const o=e=>{let t="";switch(e){case"makeupGallery":t="/pages/creator_base/set_showcase/set_showcase";break;case"wigGallery":uni.showToast({title:"将在下一个版本支持",icon:"none"});break;case"profileEdit":t="/pages/creator_base/artist_info/artist_info";break;case"orderPlan":t="/pages/creator_base/order_plane/order_plane";break;default:return}uni.navigateTo({url:t})};return e.onMounted((()=>{})),(t,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{class:"function-section"},[e.createElementVNode("view",{class:"function-item",onClick:n[0]||(n[0]=e=>o("makeupGallery"))},[e.createElementVNode("view",{class:"function-icon"},[e.createVNode(l,{type:"color",size:"24",color:"#3c3b48"})]),e.createElementVNode("view",{class:"function-info"},[e.createElementVNode("text",{class:"function-title"},"设置妆图展示"),e.createElementVNode("text",{class:"function-desc"},"管理你的妆面作品展示")]),e.createElementVNode("view",{class:"function-arrow"},[e.createVNode(l,{type:"arrowright",size:"20",color:"#999"})])]),e.createElementVNode("view",{class:"function-item",onClick:n[1]||(n[1]=e=>o("wigGallery"))},[e.createElementVNode("view",{class:"function-icon"},[e.createVNode(l,{type:"headphones",size:"24",color:"#3c3b48"})]),e.createElementVNode("view",{class:"function-info"},[e.createElementVNode("text",{class:"function-title"},"设置假毛展示"),e.createElementVNode("text",{class:"function-desc"},"管理你的假发作品展示")]),e.createElementVNode("view",{class:"function-arrow"},[e.createVNode(l,{type:"arrowright",size:"20",color:"#999"})])]),e.createElementVNode("view",{class:"function-item",onClick:n[2]||(n[2]=e=>o("profileEdit"))},[e.createElementVNode("view",{class:"function-icon"},[e.createVNode(l,{type:"person",size:"24",color:"#3c3b48"})]),e.createElementVNode("view",{class:"function-info"},[e.createElementVNode("text",{class:"function-title"},"编辑个人信息"),e.createElementVNode("text",{class:"function-desc"},"修改个人资料和联系方式")]),e.createElementVNode("view",{class:"function-arrow"},[e.createVNode(l,{type:"arrowright",size:"20",color:"#999"})])]),e.createElementVNode("view",{class:"function-item",onClick:n[3]||(n[3]=e=>o("orderPlan"))},[e.createElementVNode("view",{class:"function-icon"},[e.createVNode(l,{type:"calendar",size:"24",color:"#3c3b48"})]),e.createElementVNode("view",{class:"function-info"},[e.createElementVNode("text",{class:"function-title"},"发布接单计划"),e.createElementVNode("text",{class:"function-desc"},"设置你的接单时间和规则")]),e.createElementVNode("view",{class:"function-arrow"},[e.createVNode(l,{type:"arrowright",size:"20",color:"#999"})])])])])}}},Vs="/static/images/empty.png",bs=V({__name:"artist_info",setup(o){const n=e.ref({artist_id:0,brand_id:0,brand_name:"",description:"",logo_image:"",highlight_images:[],status_of_artist:0,status_of_artist_text:"",status_of_hairstylist:0,status_of_hairstylist_text:"",base_price_of_artist:0,base_price_of_hairstylist:0}),l=e.ref([]),s=e.ref("works"),r=e.ref("artist"),c=e.ref(1),d=e.ref(20),m=e.ref(!0),p=e.ref(0),h=e.ref([]),g=e.ref(1),v=e.ref(5),f=e.ref(!0),y=e=>{const t=["#FFEEF2","#E8F5FF","#F0FFF0","#FFF8E8","#F5F0FF","#E8FFF8","#FFF0F5","#F0F8FF"];return t[e.charCodeAt(0)%t.length]};function w(e){uni.navigateTo({url:"/pages/brand/brand?brand_id="+e})}const _=async()=>{try{const e=await uni.request({url:`${u.value}/brand-artist/bjd-faceup?brand_id=${p.value}&page=${c.value}&size=${d.value}`,method:"GET"});if("success"===e.data.status){const t=e.data.data.list;1===c.value?l.value=t:l.value=[...l.value,...t],m.value=l.value.length<e.data.data.total}else t("log","at pages/artist_info/artist_info.vue:300",e),uni.showToast({title:"获取作品列表失败",icon:"none"})}catch(e){uni.showToast({title:"网络错误",icon:"none"})}},k=()=>{const e="artist"===r.value?n.value.contact_info_artist:n.value.contact_info_hairstylist;e?uni.setClipboardData({data:e,success:()=>{uni.showToast({title:"已复制联系信息",icon:"success"})}}):uni.showToast({title:"暂无联系信息",icon:"none"})},E=async()=>{try{const e="artist"===r.value?1:2,t=await uni.request({url:`${u.value}/brand-artist/order-plans?brand_id=${p.value}&artist_type=${e}&page=${g.value}&size=${v.value}`,method:"GET"});if("success"===t.data.status){const e=t.data.data;1===g.value?h.value=e:h.value=[...h.value,...e],f.value=e.length===v.value}else uni.showToast({title:"获取开单记录失败",icon:"none"})}catch(e){uni.showToast({title:"网络错误",icon:"none"})}},N=e=>{s.value=e,"plans"===e&&(g.value=1,E())},V=e=>{r.value=e,"works"===s.value?(c.value=1,_()):(g.value=1,E())},b=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`};return i((e=>{t("log","at pages/artist_info/artist_info.vue:498","页面加载",e),uni.setNavigationBarTitle({title:"妆师毛娘主页"}),(e=>{t("log","at pages/artist_info/artist_info.vue:238",e),p.value=(null==e?void 0:e.brand_id)||0})(e),(async()=>{try{const e=await uni.request({url:`${u.value}/brand-artist/info?brand_id=${p.value}`,method:"GET"});"success"===e.data.status?n.value=e.data.data:uni.showToast({title:"获取创作者信息失败",icon:"none"})}catch(e){uni.showToast({title:"网络错误",icon:"none"})}})(),_()})),uni.setNavigationBarTitle({title:""}),(o,i)=>{const c=a(e.resolveDynamicComponent("uni-load-more"),Xe);return e.openBlock(),e.createElementBlock("view",{class:"artist-detail"},[e.createElementVNode("view",{class:"artist-header"},[e.createElementVNode("view",{class:"avatar-container"},[e.createElementVNode("image",{class:"avatar",src:n.value.logo_image,mode:"aspectFill",onClick:i[0]||(i[0]=e=>w(n.value.brand_id))},null,8,["src"])]),e.createElementVNode("view",{class:"info-container"},[e.createElementVNode("view",{class:"name-container"},[e.createElementVNode("text",{class:"brand-name",onClick:i[1]||(i[1]=e=>w(n.value.brand_id))},e.toDisplayString(n.value.brand_name),1)]),e.createElementVNode("text",{class:"description"},e.toDisplayString(n.value.description),1),e.createElementVNode("view",{class:"status-container"},["artist"===r.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"status"},"妆师接单方式: "+e.toDisplayString(n.value.status_of_artist_text),1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"status"},"毛娘接单方式: "+e.toDisplayString(n.value.status_of_hairstylist_text),1))]),e.createElementVNode("view",{class:"contact-container"},[e.createElementVNode("text",{class:"contact-info"}," 联系方式："+e.toDisplayString(n.value.contact?n.value.contact:"尚未设置"),1),e.createElementVNode("text",{class:"copy-tip",onClick:k},"复制")])])]),e.createElementVNode("view",{class:"main-tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"works"===s.value}]),onClick:i[2]||(i[2]=e=>N("works"))}," 作品展示 ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"plans"===s.value}]),onClick:i[3]||(i[3]=e=>N("plans"))}," 开单记录 ",2)]),"works"===s.value?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"showcase-header"},[e.createElementVNode("text",{class:"showcase-title"},"作品展示"),e.createElementVNode("view",{class:"showcase-divider"})]),e.createElementVNode("scroll-view",{class:"highlight-scroll","scroll-x":""},[e.createElementVNode("view",{class:"highlight-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.highlight_images,((t,a)=>(e.openBlock(),e.createElementBlock("image",{key:a,src:t,mode:"aspectFill",class:"highlight-img"},null,8,["src"])))),128))])]),e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"artist"===r.value}]),onClick:i[4]||(i[4]=e=>V("artist"))}," 妆师作品 ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"hairstylist"===r.value}]),onClick:i[5]||(i[5]=e=>V("hairstylist"))}," 毛娘作品 ",2)]),e.createElementVNode("view",{class:"works-list"},["artist"===r.value?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"work-item",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/artwork/artwork?id=${a}`});var a}},[e.createElementVNode("image",{class:"work-cover",src:t.image_urls[0],mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"work-info"},[e.createElementVNode("view",{class:"work-header"},[e.createElementVNode("text",{class:"work-head",onClick:e.withModifiers((e=>{return a=t.goods_id,void uni.navigateTo({url:`/pages/goods/goods?goods_id=${a||1576}`});var a}),["stop"])},e.toDisplayString(t.head_name),9,["onClick"]),e.createElementVNode("view",{class:e.normalizeClass(["sex-tag","男"===t.sex?"male":"female"])},e.toDisplayString(t.sex),3)]),t.style_tags&&t.style_tags.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"style-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.style_tags,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"style-tag",key:a,style:e.normalizeStyle({backgroundColor:y(t)})},e.toDisplayString(t),5)))),128))])):e.createCommentVNode("",!0)])],8,["onClick"])))),128)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-works"},[e.createElementVNode("image",{class:"empty-icon",src:Vs,mode:"aspectFit"}),e.createElementVNode("text",{class:"empty-text"},"暂无作品")]))]),m.value&&"artist"===r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"load-more"},[e.createVNode(c,{status:"loading"})])):"artist"===r.value&&l.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},[e.createElementVNode("text",null,"— 已经到底了 —")])):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("view",{class:"showcase-header"},[e.createElementVNode("text",{class:"showcase-title"},"开单记录"),e.createElementVNode("view",{class:"showcase-divider"})]),e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"artist"===r.value}]),onClick:i[6]||(i[6]=e=>V("artist"))}," 妆师开单 ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"hairstylist"===r.value}]),onClick:i[7]||(i[7]=e=>V("hairstylist"))}," 毛娘开单 ",2)]),e.createElementVNode("view",{class:"plans-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((a,o)=>{return e.openBlock(),e.createElementBlock("view",{key:a.id,class:"plan-item"},[e.createElementVNode("view",{class:"plan-images"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.images,((o,n)=>(e.openBlock(),e.createElementBlock("image",{key:n,src:o,mode:"aspectFill",class:"plan-image",onClick:e=>{return o=a.images,l=n,void uni.previewImage({current:l,urls:o,indicator:"number",loop:!0,success:()=>{t("log","at pages/artist_info/artist_info.vue:410","预览图片成功")},fail:e=>{t("log","at pages/artist_info/artist_info.vue:413","预览图片失败",e),uni.showToast({title:"预览图片失败",icon:"none"})}});var o,l}},null,8,["src","onClick"])))),128))]),e.createElementVNode("view",{class:"plan-info"},[e.createElementVNode("text",{class:"info-item"},"接单类型: "+e.toDisplayString((n=a.order_type,{1:"长期接单",2:"限时手速",3:"限时抽选",4:"限时黑箱卡",9:"关闭投递"}[n]||"未知类型")),1),e.createElementVNode("text",{class:"info-item"},"名额: "+e.toDisplayString(a.max_participants)+"人/每人"+e.toDisplayString(a.max_submissions_per_user)+"单",1),e.createElementVNode("text",{class:"info-item"},[e.createTextVNode(e.toDisplayString(b(1e3*a.open_time))+" 至 "+e.toDisplayString(b(1e3*a.close_time))+" ",1),e.createElementVNode("view",{class:e.normalizeClass(["plan-status",a.is_active?"active":"inactive"])},e.toDisplayString(a.is_active?"进行中":"已结束"),3)])]),e.createElementVNode("view",{class:"tiers-section"},[e.createElementVNode("text",{class:"section-title"},"档位选择"),e.createElementVNode("view",{class:"tiers-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.tiers,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tier-item"},[e.createElementVNode("text",{class:"tier-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"tier-price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"tier-desc"},e.toDisplayString(t.description),1)])))),128))])]),a.addons&&a.addons.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"addons-section"},[e.createElementVNode("text",{class:"section-title"},"加购服务"),e.createElementVNode("view",{class:"addons-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.addons,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"addon-item"},[e.createElementVNode("text",{class:"addon-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"addon-price"},"+¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"addon-desc"},e.toDisplayString(t.description),1)])))),128))])])):e.createCommentVNode("",!0)]);var n})),128))]),f.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"load-more"},[e.createVNode(c,{status:"loading"})])):h.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},[e.createElementVNode("text",null,"— 没有更多开单记录了 —")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"no-works"},[e.createElementVNode("image",{class:"empty-icon",src:Vs,mode:"aspectFit"}),e.createElementVNode("text",{class:"empty-text"},"暂无开单记录")]))]))])}}},[["__scopeId","data-v-e1df4d4b"]]),xs=V({__name:"set_showcase",setup(o){const n=e.ref("highlight"),l=e.ref({artist_id:0,brand_id:0,brand_name:"",description:"",logo_image:"",artist_highlight_images:[],status_of_artist:0,status_of_artist_text:"",status_of_hairstylist:0,status_of_hairstylist_text:""}),s=e.ref([]),i=e.ref(1),r=e.ref(20),c=e.ref(!0),d=e.ref(0),m=e.ref(!1),p=e.ref(0),h=e.ref(""),g=e=>{n.value=e,"faceup"===e&&0===s.value.length&&f()},v=async()=>{try{const e=await uni.request({url:`${u.value}/brand-manager/get-artist-info`,method:"GET",header:{Authorization:`${uni.getStorageSync("token")}`}});if("success"===e.data.status&&e.data.data){const t=e.data.data;l.value={...l.value,brand_id:t.brand_id,artist_highlight_images:t.artist_highlight_images||[]},d.value=t.brand_id}else uni.showToast({title:"获取艺术家信息失败",icon:"none"})}catch(e){uni.showToast({title:"网络错误",icon:"none"})}},f=async()=>{if(d.value)try{const e=await uni.request({url:`${u.value}/brand-artist/bjd-faceup?brand_id=${d.value}&page=${i.value}&size=${r.value}`,method:"GET"});if("success"===e.data.status){const t=e.data.data.list.map((e=>({...e,image_urls:Array.isArray(e.image_urls)?e.image_urls:(e.image_urls||"").split(",")})));1===i.value?s.value=t:s.value=[...s.value,...t],c.value=s.value.length<e.data.data.total}else uni.showToast({title:"获取妆图列表失败",icon:"none"})}catch(e){uni.showToast({title:"网络错误",icon:"none"})}else t("log","at pages/creator_base/set_showcase/set_showcase.vue:218","无Brand_id")},y=async()=>{try{const e=await ve(1);if(!e||0===e.length)return;m.value=!0,h.value="准备上传...",h.value="获取上传凭证...";const t=await fe();if(!t||!t.token)throw new Error("获取上传凭证失败");const a=e[0];h.value="上传中...",p.value=50;const o=t.path,n=await ye(a,t.token,o);n&&n.imageUrl&&(l.value.artist_highlight_images.push(n.imageUrl),p.value=100,await w(),uni.showToast({title:"上传成功",icon:"success"}))}catch(e){t("error","at pages/creator_base/set_showcase/set_showcase.vue:291","上传图片失败:",e),uni.showToast({title:"上传图片失败",icon:"none"})}finally{m.value=!1,p.value=0}},w=async()=>{try{const e=await uni.request({url:`${u.value}/brand-manager/update-highlight-images`,method:"POST",data:{brand_id:l.value.brand_id,artist_highlight_images:l.value.artist_highlight_images.join(",")},header:{Authorization:`${uni.getStorageSync("token")}`}});"success"!==e.data.status&&t("error","at pages/creator_base/set_showcase/set_showcase.vue:318","更新展示图失败:",e.data.msg),v()}catch(e){t("error","at pages/creator_base/set_showcase/set_showcase.vue:322","更新展示图失败:",e)}},_=e=>{const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},k=()=>{uni.navigateTo({url:"/pages/creator_base/faceup_editor/faceup_editor"})};return e.onMounted((()=>{uni.setNavigationBarTitle({title:"作品展示设置"}),v()})),(t,o)=>{const i=a(e.resolveDynamicComponent("uni-icons"),b);return e.openBlock(),e.createElementBlock("view",{class:"artist-container"},[e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"highlight"===n.value}]),onClick:o[0]||(o[0]=e=>g("highlight"))}," 展示图 ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"faceup"===n.value}]),onClick:o[1]||(o[1]=e=>g("faceup"))}," 妆图列表 ",2)]),"highlight"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"highlight-tab"},[e.createElementVNode("scroll-view",{class:"highlight-scroll","scroll-y":""},[e.createElementVNode("view",{class:"highlight-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.artist_highlight_images,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"highlight-item"},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"highlight-img",onClick:e=>{return a=t,void uni.previewImage({current:a,urls:l.value.artist_highlight_images});var a}},null,8,["src","onClick"]),e.createElementVNode("view",{class:"highlight-actions"},[e.createVNode(i,{type:"trash",size:"24",color:"#ff4d6a",onClick:e=>(async e=>{uni.showModal({title:"提示",content:"确定要删除这张展示图吗？",success:async t=>{t.confirm&&(l.value.artist_highlight_images.splice(e,1),await w(),uni.showToast({title:"删除成功",icon:"success"}))}})})(a)},null,8,["onClick"])])])))),128))])]),e.createElementVNode("view",{class:"add-btn",onClick:y},[e.createVNode(i,{type:"plus",size:"24",color:"#fff"}),e.createElementVNode("text",null,"添加展示图")]),m.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-progress"},[e.createElementVNode("progress",{percent:p.value,"stroke-width":"4",activeColor:"#4a9db5"},null,8,["percent"]),e.createElementVNode("text",null,e.toDisplayString(h.value),1)])):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"faceup-tab"},[e.createElementVNode("scroll-view",{class:"faceup-scroll","scroll-y":""},[e.createElementVNode("view",{class:"faceup-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"faceup-item",onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/creator_base/faceup_editor/faceup_editor?id=${a}`});var a}},[e.createElementVNode("image",{src:t.image_urls[0],mode:"aspectFill",class:"faceup-img"},null,8,["src"]),e.createElementVNode("view",{class:"faceup-info"},[e.createElementVNode("text",{class:"faceup-head"},e.toDisplayString(t.head_name),1),e.createElementVNode("view",{class:"faceup-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.style_tags,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tag"},e.toDisplayString(t),1)))),128))]),e.createElementVNode("view",{class:"faceup-meta"},[e.createElementVNode("text",{class:e.normalizeClass(["sex","男"===t.sex?"male":"female"])},e.toDisplayString(t.sex),3),e.createElementVNode("text",{class:"date"},e.toDisplayString(_(t.created_at)),1)])]),e.createVNode(i,{type:"arrowright",size:"20",color:"#999"})],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"add-btn",onClick:k},[e.createVNode(i,{type:"plus",size:"24",color:"#fff"}),e.createElementVNode("text",null,"添加妆图")])]))])}}},[["__scopeId","data-v-ec5b9eb0"]]),Ss={__name:"faceup_editor",setup(o){const n=e.ref(!1),l=e.ref({id:0,title:"",head_name:"",goods_id:"",sex:"男",styles_tags:[],face_up_image_urls:[]}),s=e.ref(!1),r=e.ref({}),c=e.ref(!1),d=e.ref({}),m=e.ref([]),p=e.ref(!1),h=e.ref(0),g=e.ref("");i((async e=>{await v(),e.id&&(n.value=!0,f(e.id)),uni.setNavigationBarTitle({title:n?"编辑妆面":"添加新妆面"})}));const v=async()=>{try{const e=await uni.request({url:`${u.value}/bjd-faceup-style-tags`,method:"GET"});"success"===e.data.status&&(r.value=e.data.data,d.value={"风格标签":Object.values(r.value)})}catch(e){t("error","at pages/creator_base/faceup_editor/faceup_editor.vue:223","获取风格标签失败:",e),uni.showToast({title:"获取风格标签失败",icon:"none"})}},f=async e=>{try{uni.showLoading({title:"加载中..."});const t=await uni.request({url:`${u.value}/faceup/detail?id=${e}`,method:"GET"});if("success"===t.data.status){const e=t.data.data;l.value={id:e.id,title:e.title,head_name:e.head_name,goods_id:e.goods_id,sex:1===e.sex?"男":"女",styles_tags:e.styles_tags?e.styles_tags.split(",").filter(Boolean):[],face_up_image_urls:e.images||(e.face_up_image_urls?e.face_up_image_urls.split(","):[])},m.value=l.value.styles_tags.map((e=>({category:"风格标签",size:r.value[e]})))}else uni.showToast({title:t.data.msg,icon:"none"})}catch(a){t("log","at pages/creator_base/faceup_editor/faceup_editor.vue:265",a),uni.showToast({title:"获取妆面详情失败",icon:"none"})}finally{uni.hideLoading()}},y=e=>{e.isFuzzy,l.value.head_name=e.goods.name,l.value.goods_id=e.goods.id||"",s.value=!1},w=e=>{l.value.sex=e.detail.value},_=e=>{const t=e.map((e=>{const t=e.size;for(const[a,o]of Object.entries(r.value))if(o===t)return a;return null})).filter((e=>null!==e));l.value.styles_tags=t,c.value=!1},k=async()=>{try{const a=9-l.value.face_up_image_urls.length;if(a<=0)return void uni.showToast({title:"最多只能上传9张图片",icon:"none"});const o=await ve(a);if(!o||0===o.length)return;p.value=!0,g.value="准备上传...",g.value="获取上传凭证...";const n=await fe();if(!n||!n.token)throw new Error("获取上传凭证失败");for(let s=0;s<o.length;s++)try{const e=o[s];g.value=`上传中 (${s+1}/${o.length})`,h.value=s/o.length*100;const t=n.path,a=await ye(e,n.token,t);a&&a.imageUrl&&(l.value.face_up_image_urls.push(a.imageUrl),h.value=(s+1)/o.length*100)}catch(e){t("error","at pages/creator_base/faceup_editor/faceup_editor.vue:367",`第 ${s+1} 张图片上传失败:`,e),uni.showToast({title:`第 ${s+1} 张图片上传失败`,icon:"none"})}uni.showToast({title:`成功上传${o.length}张图片`,icon:"success"})}catch(e){t("error","at pages/creator_base/faceup_editor/faceup_editor.vue:380","上传图片失败:",e),uni.showToast({title:"上传图片失败",icon:"none"})}finally{p.value=!1,h.value=0}},E=async()=>{if(l.value.title)if(l.value.head_name)if(l.value.goods_id)if(0!==l.value.face_up_image_urls.length)try{uni.showLoading({title:"提交中..."});const e={id:l.value.id,title:l.value.title,head_name:l.value.head_name,goods_id:l.value.goods_id,sex:"男"===l.value.sex?1:2,styles_tags:l.value.styles_tags.join(","),face_up_image_urls:l.value.face_up_image_urls.join(",")},t=n.value?`${u.value}/brand-manager/faceup/update`:`${u.value}/brand-manager/faceup/add`,a=uni.getStorageSync("token");if(!a)return error.value="未登录，请先登录",loading.value=!1,void(loadStatus.value="more");const o=await uni.request({url:t,method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a}});"success"===o.data.status?(uni.showToast({title:n.value?"更新成功":"添加成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)):uni.showToast({title:o.data.msg||"提交失败",icon:"none"})}catch(e){t("error","at pages/creator_base/faceup_editor/faceup_editor.vue:491","提交失败:",e),uni.showToast({title:"提交失败",icon:"none"})}finally{uni.hideLoading()}else uni.showToast({title:"请至少上传一张图片",icon:"none"});else uni.showToast({title:"请选择关联商品",icon:"none"});else uni.showToast({title:"请选择头型名称",icon:"none"});else uni.showToast({title:"请输入妆面标题",icon:"none"})},N=()=>{uni.navigateBack()};return(t,o)=>{const i=a(e.resolveDynamicComponent("uni-icons"),b),u=a(e.resolveDynamicComponent("cascade-multi-select"),ds),v=a(e.resolveDynamicComponent("relation-picker"),rl);return e.openBlock(),e.createElementBlock("view",{class:"faceup-form-container"},[e.createElementVNode("scroll-view",{class:"form-scroll","scroll-y":""},[e.createElementVNode("view",{class:"form-body"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"妆面标题"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[0]||(o[0]=e=>l.value.title=e),placeholder:"请输入妆面标题",maxlength:"50"},null,512),[[e.vModelText,l.value.title]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"头型名称"),e.createElementVNode("view",{class:"relation-picker-trigger",onClick:o[1]||(o[1]=e=>s.value=!0)},[l.value.head_name?(e.openBlock(),e.createElementBlock("text",{key:0,class:"selected-value"},e.toDisplayString(l.value.head_name),1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"placeholder"},"请选择头型")),e.createVNode(i,{type:"arrowright",size:"16",color:"#999"})])]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>l.value.goods_id=e),type:"hidden",style:{visibility:"hidden"}},null,512),[[e.vModelText,l.value.goods_id]]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"性别"),e.createElementVNode("radio-group",{class:"radio-group",onChange:w},[e.createElementVNode("label",{class:"radio-label"},[e.createElementVNode("radio",{value:"男",checked:"男"===l.value.sex,color:"#8fecff"},null,8,["checked"]),e.createElementVNode("text",null,"男")]),e.createElementVNode("label",{class:"radio-label"},[e.createElementVNode("radio",{value:"女",checked:"女"===l.value.sex,color:"#ffc3c6"},null,8,["checked"]),e.createElementVNode("text",null,"女")])],32)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("view",{class:"tag-header"},[e.createElementVNode("text",{class:"label"},"风格标签"),e.createElementVNode("view",{class:"tag-selector-btn",onClick:o[3]||(o[3]=e=>c.value=!0)},[e.createElementVNode("text",null,"管理风格标签"),e.createVNode(i,{type:"arrowdown",size:"16",color:"#666"})])]),e.createElementVNode("view",{class:"tags-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.styles_tags,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tag-item"},[e.createElementVNode("text",null,e.toDisplayString(r.value[t]),1),e.createVNode(i,{type:"close",size:"16",color:"#999",onClick:e=>(e=>{const t=l.value.styles_tags.indexOf(e);t>-1&&l.value.styles_tags.splice(t,1)})(t)},null,8,["onClick"])])))),128)),0===l.value.styles_tags.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"no-tags-hint"},[e.createElementVNode("text",null,"未选择风格标签")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"妆面图片"),e.createElementVNode("text",{class:"hint"},"请上传清晰的妆面图片，最多9张"),e.createElementVNode("view",{class:"upload-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.face_up_image_urls,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"image-preview"},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"preview-img"},null,8,["src"]),e.createElementVNode("view",{class:"image-actions"},[e.createVNode(i,{type:"eye",size:"20",color:"#fff",onClick:e=>{return a=t,void uni.previewImage({current:a,urls:l.value.face_up_image_urls});var a}},null,8,["onClick"]),e.createVNode(i,{type:"trash",size:"20",color:"#fff",onClick:e=>(e=>{uni.showModal({title:"提示",content:"确定要删除这张图片吗？",success:t=>{t.confirm&&(l.value.face_up_image_urls.splice(e,1),uni.showToast({title:"已删除",icon:"success"}))}})})(a)},null,8,["onClick"])])])))),128)),l.value.face_up_image_urls.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-btn",onClick:k},[e.createVNode(i,{type:"plus",size:"32",color:"#999"}),e.createElementVNode("text",{class:"upload-text"},"添加图片")])):e.createCommentVNode("",!0)]),p.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-progress"},[e.createElementVNode("progress",{percent:h.value,"stroke-width":"4",activeColor:"#4a9db5"},null,8,["percent"]),e.createElementVNode("text",null,e.toDisplayString(g.value),1)])):e.createCommentVNode("",!0)])])]),e.createElementVNode("view",{class:"form-footer"},[e.createElementVNode("button",{class:"btn cancel",onClick:N},"取消"),e.createElementVNode("button",{class:"btn submit",onClick:E},e.toDisplayString(n.value?"保存修改":"添加妆面"),1)]),e.createVNode(u,{show:c.value,sizeData:d.value,initialSelection:m.value,onClose:o[4]||(o[4]=e=>c.value=!1),onConfirm:_,title:"选择风格标签"},null,8,["show","sizeData","initialSelection"]),e.createVNode(v,{visible:s.value,"onUpdate:visible":o[5]||(o[5]=e=>s.value=e),onConfirm:y,onCancel:o[6]||(o[6]=e=>s.value=!1),"hide-type":"true"},null,8,["visible"])])}}};const Cs=V({name:"UniNumberBox",emits:["change","input","update:modelValue","blur","focus"],props:{value:{type:[Number,String],default:1},modelValue:{type:[Number,String],default:1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},background:{type:String,default:"#f5f5f5"},color:{type:String,default:"#333"},disabled:{type:Boolean,default:!1},width:{type:Number,default:40}},data:()=>({inputValue:0}),watch:{value(e){this.inputValue=+e},modelValue(e){this.inputValue=+e}},computed:{widthWithPx(){return this.width+"px"}},created(){1===this.value&&(this.inputValue=+this.modelValue),1===this.modelValue&&(this.inputValue=+this.value)},methods:{_calcValue(e){if(this.disabled)return;const t=this._getDecimalScale();let a=this.inputValue*t,o=this.step*t;if("minus"===e){if(a-=o,a<this.min*t)return;a>this.max*t&&(a=this.max*t)}if("plus"===e){if(a+=o,a>this.max*t)return;a<this.min*t&&(a=this.min*t)}this.inputValue=(a/t).toFixed(String(t).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_getDecimalScale(){let e=1;return~~this.step!==this.step&&(e=Math.pow(10,String(this.step).split(".")[1].length)),e},_onBlur(e){this.$emit("blur",e);let t=e.detail.value;if(isNaN(t))return void(this.inputValue=this.value);t=+t,t>this.max?t=this.max:t<this.min&&(t=this.min);const a=this._getDecimalScale();this.inputValue=t.toFixed(String(a).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_onFocus(e){this.$emit("focus",e)}}},[["render",function(t,a,o,n,l,s){return e.openBlock(),e.createElementBlock("view",{class:"uni-numbox"},[e.createElementVNode("view",{onClick:a[0]||(a[0]=e=>s._calcValue("minus")),class:"uni-numbox__minus uni-numbox-btns",style:e.normalizeStyle({background:o.background})},[e.createElementVNode("text",{class:e.normalizeClass(["uni-numbox--text",{"uni-numbox--disabled":l.inputValue<=o.min||o.disabled}]),style:e.normalizeStyle({color:o.color})},"-",6)],4),e.withDirectives(e.createElementVNode("input",{disabled:o.disabled,onFocus:a[1]||(a[1]=(...e)=>s._onFocus&&s._onFocus(...e)),onBlur:a[2]||(a[2]=(...e)=>s._onBlur&&s._onBlur(...e)),class:"uni-numbox__value",type:o.step<1?"digit":"number","onUpdate:modelValue":a[3]||(a[3]=e=>l.inputValue=e),style:e.normalizeStyle({background:o.background,color:o.color,width:s.widthWithPx})},null,44,["disabled","type"]),[[e.vModelDynamic,l.inputValue]]),e.createElementVNode("view",{onClick:a[4]||(a[4]=e=>s._calcValue("plus")),class:"uni-numbox__plus uni-numbox-btns",style:e.normalizeStyle({background:o.background})},[e.createElementVNode("text",{class:e.normalizeClass(["uni-numbox--text",{"uni-numbox--disabled":l.inputValue>=o.max||o.disabled}]),style:e.normalizeStyle({color:o.color})},"+",6)],4)])}],["__scopeId","data-v-8e354f23"]]),Bs={__name:"order_plane",setup(o){const l=[{label:"全部",value:"all"},{label:"进行中",value:"active"},{label:"未开始",value:"upcoming"},{label:"已结束",value:"inactive"}],s=e.ref("all"),i=e.ref([]),r=e.ref(1),c=e.ref(10),d=e.ref(0),m=e.ref(!1),p=e.ref(!1),h=e.ref("more"),g=e.ref(0),v=e.ref(null),f=e.ref(!1),y=e.ref(null),w=e.ref(!1),_=e.ref(0),k=e.ref(0),E=e.ref(""),N=e.ref(null),V=e.ref(!1),x=e.ref(!1);e.ref([]),e.ref([]);const S=e.ref([{label:"添加空白档位",value:"blank"}]),C=e.ref([{label:"添加空白加购",value:"blank"}]),B=e.ref({artist_name:"",artist_type:1,order_type:1,max_participants:10,max_submissions_per_user:1,open_date:"",open_time:"",close_date:"",close_time:"",images:[],order_config:{tiers:[],addons:[]}}),T=[{value:1,text:"妆师"}],D=[{value:1,text:"长期接单"},{value:2,text:"限时手速"},{value:3,text:"限时抽选"},{value:4,text:"限时黑箱卡"},{value:9,text:"关闭投递"}];e.onMounted((()=>{P(),I(),uni.setNavigationBarTitle({title:"接单计划管理"})})),n((()=>{F(!0)})),e.watch(V,(e=>{e?(v.value.close(),N.value.open()):N.value.close()})),e.watch(x,(e=>{e?(v.value.close(),addonPicker.value.open()):addonPicker.value.close()}));const I=async()=>{try{const e=await uni.request({url:u.value+"/brand-manager/order-plane/common-tiers",method:"GET",header:{Authorization:L()}});"success"===e.data.status&&(S.value=[{label:"添加空白档位",value:"blank"},...e.data.data.map((e=>({label:e.title,value:e})))]);const t=await uni.request({url:u.value+"/brand-manager/order-plane/common-addons",method:"GET",header:{Authorization:L()}});"success"===t.data.status&&(C.value=[{label:"添加空白加购",value:"blank"},...t.data.data.map((e=>({label:e.title,value:e})))])}catch(e){t("error","at pages/creator_base/order_plane/order_plane.vue:450","获取默认配置失败:",e)}},z=e=>{const t=e.detail.value,a=S.value[t];"blank"===a.value?B.value.order_config.tiers.push({title:"",price:0,description:""}):B.value.order_config.tiers.push({...a.value,price:parseFloat(a.value.price)||0})},A=e=>{const t=e.detail.value,a=C.value[t];"blank"===a.value?B.value.order_config.addons.push({title:"",price:0,description:""}):B.value.order_config.addons.push({...a.value,price:parseFloat(a.value.price)||0})},P=()=>{const e=uni.getSystemInfoSync();g.value=e.windowHeight-180},L=()=>uni.getStorageSync("token")||"",$=async()=>{try{const a=9-B.value.images.length;if(a<=0)return;const o=await ve(a);if(!o||0===o.length)return;const n=await fe(),l=n.token,s=n.path;w.value=!0,k.value=o.length,_.value=0;const i=[];for(let r=0;r<o.length;r++)try{const e=o[r];E.value=`上传中 (${r+1}/${o.length})`,_.value=r+1;const t=await ye(e,l,s);t&&t.imageUrl&&i.push(t.imageUrl)}catch(e){t("error","at pages/creator_base/order_plane/order_plane.vue:663",`第 ${r+1} 张图片上传失败:`,e),uni.showToast({title:`第 ${r+1} 张图片上传失败`,icon:"none"})}B.value.images=[...B.value.images,...i],i.length>0&&uni.showToast({title:`成功上传 ${i.length} 张图片`,icon:"success"})}catch(a){t("error","at pages/creator_base/order_plane/order_plane.vue:682","图片选择或上传失败:",a),uni.showToast({title:"图片上传失败: "+(a.message||"未知错误"),icon:"none"})}finally{w.value=!1,_.value=0,k.value=0}},F=async(e=!1)=>{if(!m.value){e&&(r.value=1,i.value=[],h.value="more"),m.value=!0,h.value="loading";try{const a=await uni.request({url:u.value+"/brand-manager/order-plan/list",method:"GET",data:{page:r.value,page_size:c.value,status:s.value},header:{Authorization:L()}});if("success"===a.data.status){const o=a.data.data,n=o.list||[];d.value=o.total;const l=n.map((e=>{const a="string"==typeof e.images?e.images.split(",").filter((e=>""!==e.trim())):e.images||[];let o={};try{o=e.order_config?JSON.parse(e.order_config):{}}catch(ma){t("error","at pages/creator_base/order_plane/order_plane.vue:739","解析 order_config 失败:",ma)}return{...e,images:a,order_config:o}}));i.value=e?l:[...i.value,...l],i.value.length>=d.value?h.value="noMore":(h.value="more",r.value++)}else uni.showToast({title:a.data.message||"获取列表失败",icon:"none"})}catch(a){uni.showToast({title:"网络错误",icon:"none"})}finally{m.value=!1}}},M=()=>{"noMore"!==h.value&&F()},R=()=>{O(),f.value=!1,v.value.open()},O=()=>{B.value={artist_name:"",artist_type:1,order_type:1,max_participants:10,max_submissions_per_user:1,open_date:"",open_time:"",close_date:"",close_time:"",images:[],order_config:{tiers:[],addons:[]}},y.value=null,p.value=!1},q=e=>{B.value.open_date=e.detail.value},U=e=>{B.value.open_time=e.detail.value},j=e=>{B.value.close_date=e.detail.value},H=e=>{B.value.close_time=e.detail.value},G=async()=>{if(!B.value.artist_name)return void uni.showToast({title:"请填写计划名称",icon:"none"});if(!(B.value.open_date&&B.value.open_time&&B.value.close_date&&B.value.close_time))return void uni.showToast({title:"请选择开始和结束时间",icon:"none"});const e=new Date(`${B.value.open_date} ${B.value.open_time}`).getTime()/1e3,a=new Date(`${B.value.close_date} ${B.value.close_time}`).getTime()/1e3;if(a<=e)return void uni.showToast({title:"结束时间必须晚于开始时间",icon:"none"});const o={artist_name:B.value.artist_name,artist_type:B.value.artist_type,order_type:B.value.order_type,max_participants:B.value.max_participants,max_submissions_per_user:B.value.max_submissions_per_user,open_time:e,close_time:a,images:B.value.images,order_config:{tiers:B.value.order_config.tiers.map((e=>({...e,price:parseFloat(e.price)||0}))),addons:B.value.order_config.addons.map((e=>({...e,price:parseFloat(e.price)||0})))}};f.value&&(o.id=y.value),p.value=!0;try{const e=u.value+(f.value?"/brand-manager/order-plan/update":"/brand-manager/order-plan/add"),t="POST",a=await uni.request({url:e,method:t,data:o,header:{Authorization:L(),"Content-Type":"application/json"}});"success"===a.data.status?(uni.showToast({title:f.value?"更新成功":"添加成功",icon:"success"}),v.value.close(),F(!0)):uni.showToast({title:a.data.message||(f.value?"更新失败":"添加失败"),icon:"none"})}catch(n){t("error","at pages/creator_base/order_plane/order_plane.vue:962","提交失败:",n),uni.showToast({title:"请求失败，请稍后重试",icon:"none"})}finally{p.value=!1}},W=()=>{v.value.close()},K=async e=>{try{const t=await uni.request({url:u.value+"/brand-manager/order-plan/delete?id="+e,method:"POST",header:{Authorization:L(),"Content-Type":"application/json"}});"success"===t.data.status?(uni.showToast({title:"删除成功",icon:"success"}),F(!0)):uni.showToast({title:t.data.message||"删除失败",icon:"none"})}catch(a){t("error","at pages/creator_base/order_plane/order_plane.vue:1015","删除失败:",a),uni.showToast({title:"网络错误",icon:"none"})}},Y=e=>{B.value.artist_type=parseInt(e.detail.value)+1},Q=e=>{const t=parseInt(e.detail.value);B.value.order_type=D[t].value},X=(e,t="yyyy-MM-dd HH:mm")=>{if(!e)return"";const a=new Date(e),o=a.getFullYear(),n=(a.getMonth()+1).toString().padStart(2,"0"),l=a.getDate().toString().padStart(2,"0"),s=a.getHours().toString().padStart(2,"0"),i=a.getMinutes().toString().padStart(2,"0");return"yyyy-MM-dd"===t?`${o}-${n}-${l}`:"HH:mm"===t?`${s}:${i}`:`${o}-${n}-${l} ${s}:${i}`},Z=e=>{const t=Math.floor(Date.now()/1e3);return t<e.open_time?"未开始":t>e.close_time?"已结束":"进行中"},ee=e=>{const t=Math.floor(Date.now()/1e3);return t<e.open_time?"upcoming":t>e.close_time?"inactive":"active"};return(t,o)=>{const n=a(e.resolveDynamicComponent("uni-load-more"),Xe),r=a(e.resolveDynamicComponent("uni-icons"),b),c=a(e.resolveDynamicComponent("uni-number-box"),Cs),u=a(e.resolveDynamicComponent("uni-popup"),J);return e.openBlock(),e.createElementBlock("view",{class:"order-plan-page"},[e.createElementVNode("view",{class:"filter-tabs"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(l,(t=>e.createElementVNode("view",{key:t.value,class:e.normalizeClass(["tab-item",{active:s.value===t.value}]),onClick:e=>(e=>{s.value=e,F(!0)})(t.value)},e.toDisplayString(t.label),11,["onClick"]))),64))]),e.createElementVNode("scroll-view",{class:"plan-list","scroll-y":"",onScrolltolower:M,style:e.normalizeStyle({height:g.value+"px"})},[m.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createVNode(n,{status:"loading"})])):i.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(i.value,(t=>{return e.openBlock(),e.createElementBlock("view",{key:t.id,class:"plan-item"},[e.createElementVNode("view",{class:"plan-header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("text",{class:"plan-title"},e.toDisplayString(t.artist_name)+" - "+e.toDisplayString((a=t.order_type,{1:"长期接单",2:"限时手速",3:"限时抽选",4:"限时黑箱卡",9:"关闭投递"}[a]||"未知类型")),1),e.createElementVNode("view",{class:e.normalizeClass(["plan-status",ee(t)])},e.toDisplayString(Z(t)),3)]),e.createElementVNode("view",{class:"action-btns"},[e.createElementVNode("button",{class:"edit-btn",onClick:e=>(e=>{var t,a;O(),f.value=!0,y.value=e.id,B.value={artist_name:e.artist_name,artist_type:e.artist_type,order_type:e.order_type,max_participants:e.max_participants,max_submissions_per_user:e.max_submissions_per_user,images:[...e.images||[]],order_config:{tiers:[...(null==(t=e.order_config)?void 0:t.tiers)||[]],addons:[...(null==(a=e.order_config)?void 0:a.addons)||[]]}},e.open_time&&(B.value.open_date=X(1e3*e.open_time,"yyyy-MM-dd"),B.value.open_time=X(1e3*e.open_time,"HH:mm")),e.close_time&&(B.value.close_date=X(1e3*e.close_time,"yyyy-MM-dd"),B.value.close_time=X(1e3*e.close_time,"HH:mm")),v.value.open()})(t)},"编辑",8,["onClick"]),e.createElementVNode("button",{class:"delete-btn",onClick:e=>{return a=t.id,void uni.showModal({title:"提示",content:"确定要删除该开单计划吗？",success:e=>{e.confirm&&K(a)}});var a}},"删除",8,["onClick"])])]),t.images&&t.images.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"plan-images"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.images,((a,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:a,mode:"aspectFill",class:"plan-image",onClick:e=>{return a=t.images,n=o,void uni.previewImage({current:n,urls:a,indicator:"number"});var a,n}},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"plan-info"},[e.createElementVNode("view",{class:"info-row"},[e.createVNode(r,{type:"person",size:"16",color:"#666"}),e.createElementVNode("text",{class:"info-item"},"名额: "+e.toDisplayString(t.max_participants)+"人/每人"+e.toDisplayString(t.max_submissions_per_user)+"单",1)]),e.createElementVNode("view",{class:"info-row"},[e.createVNode(r,{type:"calendar",size:"16",color:"#666"}),e.createElementVNode("text",{class:"info-item"},e.toDisplayString(X(1e3*t.open_time))+" 至 "+e.toDisplayString(X(1e3*t.close_time)),1)])]),t.order_config&&t.order_config.tiers&&t.order_config.tiers.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"tiers-section"},[e.createElementVNode("text",{class:"section-title"},"档位选择"),e.createElementVNode("view",{class:"tiers-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.order_config.tiers,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tier-item"},[e.createElementVNode("text",{class:"tier-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"tier-price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"tier-desc"},e.toDisplayString(t.description),1)])))),128))])])):e.createCommentVNode("",!0)]);var a})),128)):e.createCommentVNode("",!0),m.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:2,class:"load-more"},["loading"===h.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),"noMore"===h.value&&0!==i.value.length?(e.openBlock(),e.createElementBlock("text",{key:1},"— 没有更多了 —")):e.createCommentVNode("",!0)])),0!==i.value.length||m.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:3,class:"empty"},[e.createElementVNode("image",{class:"empty-icon",src:Vs}),e.createElementVNode("text",{class:"empty-text"},"暂无开单计划"),e.createElementVNode("text",{class:"empty-tip"},"点击加号按钮创建您的第一个开单计划")]))],36),e.createElementVNode("button",{class:"add-btn",onClick:R},[e.createVNode(r,{type:"plusempty",size:"30",color:"#fff"})]),e.createVNode(u,{ref_key:"popup",ref:v,type:"bottom"},{default:e.withCtx((()=>{var t,a,l;return[e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},e.toDisplayString(f.value?"编辑开单计划":"新增开单计划"),1),e.createVNode(r,{type:"closeempty",size:"24",color:"#999",onClick:W})]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"form-container"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"计划名称"),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":o[0]||(o[0]=e=>B.value.artist_name=e),placeholder:"请输入计划名称"},null,512),[[e.vModelText,B.value.artist_name]])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"接单类型"),e.createElementVNode("picker",{onChange:Y,value:B.value.artist_type,range:T,"range-key":"text"},[e.createElementVNode("view",{class:"picker"},e.toDisplayString((null==(t=T[B.value.artist_type-1])?void 0:t.text)||"请选择接单类型"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"接单方式"),e.createElementVNode("picker",{onChange:Q,value:(l=B.value.order_type,D.findIndex((e=>e.value===l))),range:D,"range-key":"text"},[e.createElementVNode("view",{class:"picker"},e.toDisplayString((null==(a=D.find((e=>e.value===B.value.order_type)))?void 0:a.text)||"请选择接单方式"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"最大参与人数"),e.createVNode(c,{modelValue:B.value.max_participants,"onUpdate:modelValue":o[1]||(o[1]=e=>B.value.max_participants=e),min:1,max:1e3},null,8,["modelValue"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"每人最大投递数"),e.createVNode(c,{modelValue:B.value.max_submissions_per_user,"onUpdate:modelValue":o[2]||(o[2]=e=>B.value.max_submissions_per_user=e),min:1,max:10},null,8,["modelValue"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"开始时间"),e.createElementVNode("picker",{mode:"date",value:B.value.open_date,onChange:q},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(B.value.open_date||"选择日期"),1)],40,["value"]),e.createElementVNode("picker",{mode:"time",value:B.value.open_time,onChange:U},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(B.value.open_time||"选择时间"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"结束时间"),e.createElementVNode("picker",{mode:"date",value:B.value.close_date,onChange:j},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(B.value.close_date||"选择日期"),1)],40,["value"]),e.createElementVNode("picker",{mode:"time",value:B.value.close_time,onChange:H},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(B.value.close_time||"选择时间"),1)],40,["value"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"展示图片"),e.createElementVNode("view",{class:"image-uploader"},[w.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uploading-container"},[e.createVNode(n,{status:"loading"}),e.createElementVNode("text",{class:"uploading-text"},"上传中 ("+e.toDisplayString(_.value)+"/"+e.toDisplayString(k.value)+")",1)])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value.images,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"image-preview"},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"preview-image"},null,8,["src"]),e.createVNode(r,{type:"close",size:"18",color:"#fff",class:"delete-icon",onClick:e=>(e=>{B.value.images.splice(e,1)})(a)},null,8,["onClick"])])))),128)),B.value.images.length<9&&!w.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-btn",onClick:$},[e.createVNode(r,{type:"plusempty",size:"28",color:"#999"}),e.createElementVNode("text",null,"添加图片")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"form-label-row"},[e.createElementVNode("text",{class:"form-label"},"档位配置"),e.createElementVNode("view",{class:"header-buttons"},[e.createElementVNode("picker",{range:S.value,"range-key":"label",onChange:z},[e.createElementVNode("button",{class:"small-btn"},"+ 添加档位")],40,["range"])])]),e.createElementVNode("view",{class:"tier-config"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value.order_config.tiers,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tier-item"},[e.createElementVNode("view",{class:"tier-header"},[B.value.order_config.tiers.length>1?(e.openBlock(),e.createBlock(r,{key:0,type:"trash",size:"18",color:"#f56c6c",onClick:e=>(e=>{B.value.order_config.tiers.length>1&&B.value.order_config.tiers.splice(e,1)})(a)},null,8,["onClick"])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"tier-inputs"},[e.withDirectives(e.createElementVNode("input",{class:"tier-input","onUpdate:modelValue":e=>t.title=e,placeholder:"档位名称"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.title]]),e.withDirectives(e.createElementVNode("input",{class:"tier-input","onUpdate:modelValue":e=>t.price=e,placeholder:"价格",type:"number"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.price]]),e.withDirectives(e.createElementVNode("input",{class:"tier-input","onUpdate:modelValue":e=>t.description=e,placeholder:"描述"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.description]])])])))),128))])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"form-label-row"},[e.createElementVNode("text",{class:"form-label"},"加购配置"),e.createElementVNode("view",{class:"header-buttons"},[e.createElementVNode("picker",{range:C.value,"range-key":"label",onChange:A},[e.createElementVNode("button",{class:"small-btn"},"+ 添加加购")],40,["range"])])]),e.createElementVNode("view",{class:"tier-config"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value.order_config.addons,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tier-item"},[e.createElementVNode("view",{class:"tier-header"},[e.createElementVNode("text",null,"加购 "+e.toDisplayString(a+1),1),B.value.order_config.addons.length>1?(e.openBlock(),e.createBlock(r,{key:0,type:"trash",size:"18",color:"#f56c6c",onClick:e=>(e=>{B.value.order_config.addons.length>1&&B.value.order_config.addons.splice(e,1)})(a)},null,8,["onClick"])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"tier-inputs"},[e.withDirectives(e.createElementVNode("input",{class:"tier-input","onUpdate:modelValue":e=>t.title=e,placeholder:"加购名称"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.title]]),e.withDirectives(e.createElementVNode("input",{class:"tier-input","onUpdate:modelValue":e=>t.price=e,placeholder:"价格",type:"number"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.price]]),e.withDirectives(e.createElementVNode("input",{class:"tier-input","onUpdate:modelValue":e=>t.description=e,placeholder:"描述"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.description]])])])))),128))])])]),e.createElementVNode("button",{class:"submit-btn",onClick:G,disabled:p.value},e.toDisplayString(p.value?"提交中...":"提交"),9,["disabled"])])]})),_:1},512)])}}},Ts=V(Bs,[["__scopeId","data-v-8d424c2a"]]),Ds={__name:"artwork",setup(o){const n=e.ref({id:0,title:"",head_name:"",faceup_tag_content:[],sex:0,created_at:0,brand_id:0,art_type:1,goods_id:0,images:[],like_count:0}),l=e.ref(null),s=e.ref(null),r=e.ref(!0),c=e.ref(!1),d=e.ref(""),m=e.ref(!1),p=e.ref(0),g=e.ref(8),v=e.ref(null),y=e.ref(null),w=e.ref({});function _(e){if(!e)return"";const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}const k=async e=>{try{const t=await uni.request({url:u.value+`/goods?id=${e}`,method:"GET"});"success"===t.data.status&&(l.value=t.data.data)}catch(ma){t("error","at pages/artwork/artwork.vue:210","获取商品信息失败:",ma)}},E=async e=>{try{const t=await uni.request({url:u.value+`/brand-info?id=${e}`,method:"GET"});"success"===t.data.status&&(s.value=t.data.data)}catch(ma){t("error","at pages/artwork/artwork.vue:226","获取品牌信息失败:",ma)}},N=e=>{c.value=!0,d.value=e,uni.showToast({title:e,icon:"none"})};const V=({parent:e,target:t})=>{var a;let o=e;null!=t&&(o=t),w.value.id!=o.id?(w.value=o,null==(a=y.value)||a.focusInput()):w.value={}},x=e=>{var t,a,o;let n=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});const l={content:e.content,origin:e.origin,target_id:parseInt(p.value),type:8,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...w.value.id&&{reply_id:w.value.id,reply_for:w.value.comment,reply_uid:w.value.user_id,parent_id:w.value.parent_id>0?w.value.parent_id:w.value.id}},s={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0},...e.image_url&&{image_url:e.image_url},...w.value.id&&{reply_id:w.value.id,reply_for:w.value.comment,reply_uid:w.value.user_id,parent_id:w.value.parent_id>0?w.value.parent_id:w.value.id,reply_username:w.value.is_anonymous?"匿名用户":w.value.username}};w.value.id?0===w.value.parent_id?null==(a=v.value)||a.addReplyComment({...s,parent_id:w.value.id}):null==(o=v.value)||o.addReplyComment({...s,parent_id:w.value.parent_id}):null==(t=v.value)||t.addNewComment(s),uni.request({url:u.value+"/with-state/add-comment",method:"POST",header:{Authorization:n},data:l,success:t=>{var a,o;if("success"==t.data.status){const o=t.data.data,n={...o,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:h.userInfo.avatar,username:h.userInfo.nickname,is_anonymous:0}};o.reply_uid&&w.value.is_anonymous&&(n.reply_username="匿名用户"),null==(a=v.value)||a.updateTempComment(s.id,n),uni.showToast({title:"评论成功",icon:"success"})}else null==(o=v.value)||o.removeTempComment(s.id),uni.showToast({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=v.value)||t.removeTempComment(s.id),uni.showToast({title:"网络请求失败",icon:"none"})}})};return i((e=>{e.id?(p.value=e.id,(async e=>{try{r.value=!0;const t=await uni.request({url:u.value+`/faceup/detail?id=${e}`});if("success"!==t.data.status)return void N(t.data.msg||"数据加载失败");n.value=t.data.data,Array.isArray(n.value.images)||(n.value.images=n.value.face_up_image_urls?n.value.face_up_image_urls.split(","):[]),n.value.goods_id&&k(n.value.goods_id),n.value.brand_id&&E(n.value.brand_id)}catch(a){t("error","at pages/artwork/artwork.vue:191","获取作品详情失败:",a),N("数据加载失败")}finally{r.value=!1}})(e.id),f().then((()=>{!function(){let e=uni.getStorageSync("token");e&&uni.request({url:u.value+"/with-state/hasLike?id="+p.value+"&type=7",method:"POST",header:{Authorization:e},success:e=>{"success"==e.data.status&&(m.value=e.data.data.id>0)}})}()}))):N("缺少必要参数")})),(o,i)=>{var f,k;const E=a(e.resolveDynamicComponent("uni-icons"),b),N=a(e.resolveDynamicComponent("comment-list"),he),S=a(e.resolveDynamicComponent("comment-input"),we);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("view",{class:"heart",onClick:i[0]||(i[0]=e=>function(){let e=uni.getStorageSync("token");if(!h.isLogin)return void uni.showToast({title:"请先登录",icon:"none"});const a={id:parseInt(p.value),type:7};let o=m.value?"/with-state/unlike":"/with-state/add-like";uni.request({url:u.value+o,method:"POST",header:{Authorization:e},data:a,success:e=>{"success"==e.data.status?(uni.showToast({title:m.value?"取消点赞":"点赞成功",icon:"success"}),m.value=!m.value,m.value?n.value.like_count+=1:n.value.like_count-=1):uni.showToast({title:e.data.msg||"操作失败",icon:"none"})},fail:e=>{t("log","at pages/artwork/artwork.vue:301",e),uni.showToast({title:"网络请求失败",icon:"none"})}})}())},[m.value?(e.openBlock(),e.createBlock(E,{key:1,type:"heart-filled",size:"28",color:"#ff4d4f"})):(e.openBlock(),e.createBlock(E,{key:0,type:"heart",size:"28",color:"#ff4d4f"})),e.createElementVNode("text",{class:"num"},e.toDisplayString((null==(f=n.value)?void 0:f.like_count)?(T=n.value.like_count,T?T<1e3?T.toString():`${Math.floor(T/1e3)}k+`:"0"):0),1)]),e.createElementVNode("swiper",{class:"swiper-box","indicator-dots":!0,autoplay:!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.images,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"swiper-image",onClick:e=>function(e){uni.previewImage({current:n.value.images[e],urls:n.value.images})}(a)},null,8,["src","onClick"])])))),128))])]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"author-info",onClick:i[1]||(i[1]=e=>{return t=n.value.brand_id,void uni.navigateTo({url:`/pages/brand/brand?brand_id=${t}`});var t})},[e.createElementVNode("image",{src:s.value.logo_image,mode:"aspectFill",class:"author-avatar"},null,8,["src"]),e.createElementVNode("view",{class:"author-details"},[e.createElementVNode("text",{class:"author-name"},e.toDisplayString(s.value.brand_name),1),e.createElementVNode("text",{class:"publish-time"},"发布于 "+e.toDisplayString(_(n.value.created_at)),1)])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content-box"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(n.value.title),1),e.createElementVNode("text",{class:"head-name"},"头名: "+e.toDisplayString(n.value.head_name),1),e.createElementVNode("view",{class:"meta-info"},[e.createElementVNode("text",{class:"meta-item"},"性别: "+e.toDisplayString((B=n.value.sex,{0:"未知",1:"男",2:"女"}[B]||"未知")),1),e.createElementVNode("text",{class:"meta-item"},"类型: "+e.toDisplayString((C=n.value.art_type,{1:"妆师",2:"毛娘"}[C]||"未知类型")),1)]),n.value.faceup_tag_content&&n.value.faceup_tag_content.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tags-container"},[e.createElementVNode("text",{class:"tags-title"},"风格:"),e.createElementVNode("view",{class:"tags-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.faceup_tag_content,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"tag-item"},e.toDisplayString(t),1)))),128))])])):e.createCommentVNode("",!0)]),n.value.goods_id&&l.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"goods-section"},[e.createElementVNode("text",{class:"section-title"},"关联商品"),e.createElementVNode("view",{class:"goods-item",onClick:i[2]||(i[2]=e=>{return t=n.value.goods_id,void uni.navigateTo({url:`/pages/goods/goods?goods_id=${t}`});var t})},[e.createElementVNode("view",{class:"image-container"},[e.createElementVNode("image",{src:(null==(k=l.value.goods_images)?void 0:k[0])||"/static/goods-default.png",mode:"aspectFill",class:"goods-image"},null,8,["src"])]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(l.value.name),1),e.createElementVNode("text",{class:"goods-brand"},e.toDisplayString(l.value.brand_name),1),e.createElementVNode("view",{class:"see"},"去看看 →")])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{padding:"10px"}},[e.createVNode(N,{ref_key:"commentListRef",ref:v,type:g.value,"relation-id":parseInt(p.value),onReply:V},null,8,["type","relation-id"])]),e.createVNode(S,{ref_key:"commentInputRef",ref:y,"reply-info":w.value,"target-id":p.value,onSubmit:x,"onUpdate:replyInfo":i[3]||(i[3]=e=>w.value=e)},null,8,["reply-info","target-id"]),e.createElementVNode("view",{style:{width:"100%",height:"120rpx"}}),r.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"loading"},"加载中...")):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"error"},e.toDisplayString(d.value),1)):e.createCommentVNode("",!0)]);var C,B,T}}},Is=V(Ds,[["__scopeId","data-v-3ef251e3"]]),zs={__name:"news",setup(o){const l=e.ref([]),s=e.ref(1),i=e.ref(10),r=e.ref(0),c=e.ref(!1),d=e.ref(!1),m=e.ref("more"),p=e.ref(0),h=e.ref(null),g=e.ref(!1),v=e.ref(null),f=e.ref(!1),y=e.ref(0),w=e.ref(0),_=e.ref(""),k=e.ref({title:"",content:"",image_list:[],news_type:1,subscribe_goods_id:0,subscribe_goods_name:""}),E=e.ref([{value:1,label:"图透"},{value:2,label:"尾款"},{value:3,label:"截定"},{value:4,label:"公告"}]),N=e.ref(1),V=e=>{k.value.subscribe_goods_id=e.id,k.value.subscribe_goods_name=e.name},x=e=>{k.value.news_type=parseInt(e.detail.value)+1};e.onMounted((()=>{S(),uni.setNavigationBarTitle({title:"品牌文章管理"})})),n((()=>{T(!0)}));const S=()=>{const e=uni.getSystemInfoSync();p.value=e.windowHeight-50},C=()=>uni.getStorageSync("token")||"",B=async()=>{try{const a=9-k.value.image_list.length;if(a<=0)return;const o=await ve(a);if(!o||0===o.length)return;const n=await fe(),l=n.token,s=n.path;f.value=!0,w.value=o.length,y.value=0;const i=[];for(let r=0;r<o.length;r++)try{const e=o[r];_.value=`上传中 (${r+1}/${o.length})`,y.value=r+1;const t=await ye(e,l,s);t&&t.imageUrl&&i.push(t.imageUrl)}catch(e){t("error","at pages/creator_base/news/news.vue:253",`第 ${r+1} 张图片上传失败:`,e),uni.showToast({title:`第 ${r+1} 张图片上传失败`,icon:"none"})}k.value.image_list=[...k.value.image_list,...i],i.length>0&&uni.showToast({title:`成功上传 ${i.length} 张图片`,icon:"success"})}catch(a){t("error","at pages/creator_base/news/news.vue:270","图片选择或上传失败:",a),uni.showToast({title:"图片上传失败: "+(a.message||"未知错误"),icon:"none"})}finally{f.value=!1,y.value=0,w.value=0}},T=async(e=!1)=>{if(!c.value){e&&(s.value=1,l.value=[],m.value="more"),c.value=!0,m.value="loading";try{const t=await uni.request({url:u.value+"/brand-manager/news/list",method:"GET",data:{page_index:s.value,page_size:i.value},header:{Authorization:C()}});if("success"===t.data.status){const a=t.data.data,o=a.news_list||[];r.value=a.total;const n=o.map((e=>{const t=e.image_urls?e.image_urls.split(",").filter((e=>""!==e.trim())):e.image_list||[];return{...e,image_list:t}}));l.value=e?n:[...l.value,...n],l.value.length>=r.value?m.value="noMore":(m.value="more",s.value++)}else uni.showToast({title:t.data.message||"获取列表失败",icon:"none"})}catch(t){uni.showToast({title:"网络错误",icon:"none"})}finally{c.value=!1}}},D=()=>{"noMore"!==m.value&&T()},I=()=>{z(),g.value=!1,h.value.open()},z=()=>{k.value={title:"",content:"",image_list:[]},v.value=null,d.value=!1},A=async()=>{if(!k.value.title)return void uni.showToast({title:"请填写文章标题",icon:"none"});if(!k.value.content)return void uni.showToast({title:"请填写文章内容",icon:"none"});const e={title:k.value.title,content:k.value.content,image_urls:k.value.image_list,news_type:k.value.news_type,subscribe_goods_id:k.value.subscribe_goods_id,subscribe_goods_name:k.value.subscribe_goods_name};g.value&&(e.id=v.value),d.value=!0;try{const t=u.value+(g.value?"/brand-manager/news/update":"/brand-manager/news/create"),a="POST",o=await uni.request({url:t,method:a,data:e,header:{Authorization:C(),"Content-Type":"application/json"}});"success"===o.data.status?(uni.showToast({title:g.value?"更新成功":"添加成功",icon:"success"}),h.value.close(),T(!0)):uni.showToast({title:o.data.message||(g.value?"更新失败":"添加失败"),icon:"none"})}catch(a){t("error","at pages/creator_base/news/news.vue:439","提交失败:",a),uni.showToast({title:"请求失败，请稍后重试",icon:"none"})}finally{d.value=!1}},P=()=>{h.value.close()},L=async e=>{try{const t=await uni.request({url:u.value+"/brand-manager/news/delete?id="+e,method:"GET",header:{Authorization:C()}});"success"===t.data.status?(uni.showToast({title:"删除成功",icon:"success"}),T(!0)):uni.showToast({title:t.data.message||"删除失败",icon:"none"})}catch(a){t("error","at pages/creator_base/news/news.vue:487","删除失败:",a),uni.showToast({title:"网络错误",icon:"none"})}},$=(e,t="yyyy-MM-dd HH:mm")=>{if(!e)return"";const a=new Date(e),o=a.getFullYear(),n=(a.getMonth()+1).toString().padStart(2,"0"),l=a.getDate().toString().padStart(2,"0"),s=a.getHours().toString().padStart(2,"0"),i=a.getMinutes().toString().padStart(2,"0");return"yyyy-MM-dd"===t?`${o}-${n}-${l}`:"HH:mm"===t?`${s}:${i}`:`${o}-${n}-${l} ${s}:${i}`};return(t,o)=>{const n=a(e.resolveDynamicComponent("uni-load-more"),Xe),s=a(e.resolveDynamicComponent("uni-icons"),b),i=a(e.resolveDynamicComponent("goods-search"),R),r=a(e.resolveDynamicComponent("uni-popup"),J);return e.openBlock(),e.createElementBlock("view",{class:"brand-news-page"},[e.createElementVNode("scroll-view",{class:"news-list","scroll-y":"","scroll-x":"false",onScrolltolower:D,style:e.normalizeStyle({height:p.value+"px"})},[c.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createVNode(n,{status:"loading"})])):l.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(l.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"news-item"},[e.createElementVNode("view",{class:"news-header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("text",{class:"news-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"news-time"},e.toDisplayString($(1e3*t.created_at)),1)]),e.createElementVNode("view",{class:"action-btns"},[e.createElementVNode("button",{class:"edit-btn",onClick:e=>{return a=t,z(),g.value=!0,v.value=a.id,k.value={title:a.title,content:a.content,image_list:[...a.image_list||[]],news_type:a.news_type||1,subscribe_goods_id:a.subscribe_goods_id||0,subscribe_goods_name:a.subscribe_goods_name||""},void h.value.open();var a}},"编辑",8,["onClick"]),e.createElementVNode("button",{class:"delete-btn",onClick:e=>{return a=t.id,void uni.showModal({title:"提示",content:"确定要删除该文章吗？",success:e=>{e.confirm&&L(a)}});var a}},"删除",8,["onClick"])])]),t.image_list&&t.image_list.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"news-images"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.image_list,((a,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:a,mode:"aspectFill",class:"news-image",onClick:e=>{return a=t.image_list,n=o,void uni.previewImage({current:n,urls:a,indicator:"number"});var a,n}},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"news-content-preview"},e.toDisplayString(t.content.length>50?t.content.substring(0,50)+"...":t.content),1)])))),128)):e.createCommentVNode("",!0),c.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:2,class:"load-more"},["loading"===m.value?(e.openBlock(),e.createElementBlock("text",{key:0},"加载中...")):e.createCommentVNode("",!0),"noMore"===m.value&&0!==l.value.length?(e.openBlock(),e.createElementBlock("text",{key:1},"— 没有更多了 —")):e.createCommentVNode("",!0)])),0!==l.value.length||c.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:3,class:"empty"},[e.createElementVNode("image",{class:"empty-icon",src:Vs}),e.createElementVNode("text",{class:"empty-text"},"暂无品牌文章"),e.createElementVNode("text",{class:"empty-tip"},"点击加号按钮创建您的第一篇文章")]))],36),e.createElementVNode("button",{class:"add-btn",onClick:I},[e.createVNode(s,{type:"plusempty",size:"30",color:"#fff"})]),e.createVNode(r,{ref_key:"popup",ref:h,type:"bottom"},{default:e.withCtx((()=>{var t;return[e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},e.toDisplayString(g.value?"编辑文章":"新增文章"),1),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:P})]),e.createElementVNode("scroll-view",{"scroll-y":"true",class:"form-container",style:{height:"1000rpx"}},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"文章类型"),e.createElementVNode("picker",{onChange:x,value:k.value.news_type,range:E.value,"range-key":"label"},[e.createElementVNode("view",{class:"picker"},e.toDisplayString((null==(t=E.value.find((e=>e.value===k.value.news_type)))?void 0:t.label)||"请选择文章类型"),1)],40,["value","range"]),e.createElementVNode("view",{class:"goods-search-tip"}," 只可以发布与【贩售】相关内容；半成品->图透、即将截止贩售->截定、开始贩售以及其它->公告 "),e.createElementVNode("view",{class:"goods-search-tip"}," 我们每天上午和晚上10点左右会搬运一次小红书里发布的和贩售相关的新消息，如果有重复可以自行编辑或删除。 ")]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"文章标题"),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":o[0]||(o[0]=e=>k.value.title=e),placeholder:"请输入文章标题"},null,512),[[e.vModelText,k.value.title]])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"文章内容"),e.withDirectives(e.createElementVNode("textarea",{class:"form-textarea","onUpdate:modelValue":o[1]||(o[1]=e=>k.value.content=e),placeholder:"请输入文章内容","auto-height":""},null,512),[[e.vModelText,k.value.content]])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"关联商品"),e.createElementVNode("view",{class:"goods-search-container"},[e.createVNode(i,{mode:"fill",modelValue:k.value.subscribe_goods_name,onSelect:V,brandId:N.value},null,8,["modelValue","brandId"]),e.createElementVNode("view",{class:"goods-search-tip"}," 关联商品，用户可以订阅消息，如果该商品下次发布贩售消息，订阅用户将收到弹窗提醒 ")])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"展示图片"),e.createElementVNode("view",{class:"image-uploader"},[f.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uploading-container"},[e.createVNode(n,{status:"loading"}),e.createElementVNode("text",{class:"uploading-text"},"上传中 ("+e.toDisplayString(y.value)+"/"+e.toDisplayString(w.value)+")",1)])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value.image_list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"image-preview"},[e.createElementVNode("image",{src:t,mode:"aspectFill",class:"preview-image"},null,8,["src"]),e.createVNode(s,{type:"close",size:"18",color:"#fff",class:"delete-icon",onClick:e=>(e=>{k.value.image_list.splice(e,1)})(a)},null,8,["onClick"])])))),128)),k.value.image_list.length<9&&!f.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-btn",onClick:B},[e.createVNode(s,{type:"plusempty",size:"28",color:"#999"}),e.createElementVNode("text",null,"添加图片")])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"submit-btn",onClick:A,disabled:d.value},e.toDisplayString(d.value?"提交中...":"提交"),9,["disabled"])])]})),_:1},512)])}}};__definePage("pages/index/index",K),__definePage("pages/homepage/homepage",Q),__definePage("pages/stock/stock",ie),__definePage("pages/mine/mine",ce),__definePage("pages/watch_demo/watch_demo",ue),__definePage("pages/goods/goods",Ee),__definePage("pages/brand/brand",xe),__definePage("pages/calendar/calendar",Ce),__definePage("pages/pop_croper/pop_croper",Ae),__definePage("pages/setting/setting",Pe),__definePage("pages/setting/password/password",Le),__definePage("pages/setting/tel_phone/tel_phone",$e),__definePage("pages/stock/account_book_form/account_book_form",ll),__definePage("pages/stock/showcase_form/showcase_form",ul),__definePage("pages/stock/bill_form/bill_form",ml),__definePage("pages/collocation/collocation",pl),__definePage("pages/collocation_share/collocation_share",hl),__definePage("pages/user_page/user_page",gl),__definePage("pages/message_list/message_list",El),__definePage("pages/message_info/message_info",Nl),__definePage("pages/register/register",Vl),__definePage("pages/user_like/user_like",bl),__definePage("pages/collocation_square/collocation_square",Sl),__definePage("pages/sale_news/sale_news",Cl),__definePage("pages/treehole_publish/treehole_publish",Tl),__definePage("pages/treehole_detail/treehole_detail",Dl),__definePage("pages/reset_password/reset_password",Il),__definePage("pages/setting/username/username",zl),__definePage("pages/my_comment/my_comment",Al),__definePage("pages/my_collocation/my_collocation",Pl),__definePage("pages/article_detail/article_detail",Xl),__definePage("pages/loadding/loadding",es),__definePage("pages/private/private",ts),__definePage("pages/permission/permission",as),__definePage("pages/drag-image-test/drag-image-test",os),__definePage("pages/account_book_preview/account_book_preview",ns),__definePage("pages/creator_base/creator_base",ss),__definePage("pages/creator_base/brand_edit/brand_edit",rs),__definePage("pages/creator_base/goods_list/goods_list",us),__definePage("pages/creator_base/goods_editor/goods_editor",ps),__definePage("pages/creator_base/collocation_list/collocation_list",ks),__definePage("pages/creator_base/artist_info/artist_info",Es),__definePage("pages/creator_base/artist_setting/artist_setting",Ns),__definePage("pages/artist_info/artist_info",bs),__definePage("pages/creator_base/set_showcase/set_showcase",xs),__definePage("pages/creator_base/faceup_editor/faceup_editor",Ss),__definePage("pages/creator_base/order_plane/order_plane",Ts),__definePage("pages/artwork/artwork",Is),__definePage("pages/creator_base/news/news",zs),uni.invokePushCallback({type:"enabled",offline:!0}),Promise.resolve().then((()=>{"undefined"!=typeof plus&&plus.push&&plus.globalEvent.addEventListener("newPath",(({path:e})=>{if(!e)return;const t=getCurrentPages(),a=t[t.length-1];a&&a.$page&&a.$page.fullPath===e||uni.navigateTo({url:e,fail(t){t.errMsg.indexOf("tabbar")>-1?uni.switchTab({url:e,fail(e){console.error(e.errMsg)}}):console.error(t.errMsg)}})})),plus.push.setAutoNotification&&plus.push.setAutoNotification(!1)}));const As={__name:"App",setup:e=>(s((()=>{t("log","at App.vue:5","App Launch")})),n((()=>{t("log","at App.vue:11","App Show"),setTimeout((()=>{t("log","at App.vue:13","开始加载字体..."),uni.loadFontFace({family:"cutefont",source:'url("https://images1.fantuanpu.com/font/ry-super-less-rokk.ttf")',global:!0,success(){t("log","at App.vue:31","字体cutefont加载成功")},fail(e){t("log","at App.vue:34","字体cutefont加载失败",e)}}),t("log","at App.vue:15","结束加载字体")}),2e3)})),l((()=>{t("log","at App.vue:20","App Hide")})),()=>{})};const{app:Ps,Vuex:Ls,Pinia:$s}={app:e.createVueApp(As)};uni.Vuex=Ls,uni.Pinia=$s,Ps.provide("__globalStyles",__uniConfig.styles),Ps._component.mpType="app",Ps._component.render=()=>{},Ps.mount("#app")}(Vue);
