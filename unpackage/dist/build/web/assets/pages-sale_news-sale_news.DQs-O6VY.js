import{r as a,p as e,a2 as t,a as l,c as s,w as n,v as o,j as i,g as r,b as d,B as u,d as c,k as p,l as m,F as _,e as f,t as g,a0 as v,u as y,D as h,T as b,n as k,A as S,i as w,G as x,f as C,J as $,E as j}from"./index-6ojkiy1R.js";import{_ as I,a as F}from"./comment-input.WXDjx_KR.js";import{a as E,r as L}from"./uni-app.es.BMFd5FAr.js";import{c as A,w as D,b as R}from"./config.Bhvn_Gfs.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.C75VRGWb.js";import"./common-modal.Biav_mER.js";const z=T({__name:"sale_news",setup(T){const z=a({title:"",content:"",image_list:[],created_at:0}),O=a({brand_name:"",logo:""}),P=a(!0),B=a(!1),M=a(""),G=a(0),H=a(0),J=a(!1),N=a(null),U=a(null);a(1);let Y=a({});e();const q=({parent:a,target:e})=>{var t;console.log("parent",a),console.log("target",e);let l=a;null!=e&&(l=e),Y.value.id!=l.id?(console.log("item",l),Y.value=l,null==(t=U.value)||t.focusInput()):Y.value={}};function K(a){k({url:"/pages/brand/brand?brand_id="+a})}t({title:"图透详情"});const Q=({content:a,replyInfo:e,origin:t})=>{let l=i("token");if(!R.isLogin)return void S({title:"请先登录",icon:"none"});console.log("reply_info",e);const s={content:a,origin:t,target_id:parseInt(G.value),type:4,...e.id&&{reply_id:e.id,reply_for:e.comment,reply_user_id:e.user_id,parent_id:e.parent_id>0?e.parent_id:e.id}};o({url:D+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:a=>{var e,t;if("success"==a.data.status){const l=a.data.data;0===l.parent_id?null==(e=N.value)||e.addNewComment(l):null==(t=N.value)||t.addReplyComment(l),S({title:"评论成功",icon:"success"})}else S({title:a.data.msg,icon:"none"})},fail:a=>{S({title:"网络请求失败",icon:"none"})}})};function V(a){const e=new Date(1e3*a),t=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),n=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${t}-${l}-${s} ${n}:${o}`}const W=()=>{o({url:D+"/brand-info?id="+H.value,success:a=>{"success"===a.data.status&&(O.value=a.data.data,t({title:a.data.data.brand_name}),Z())},fail:()=>handleError("品牌信息加载失败")})},X=async()=>{if(!R.isLogin)return void S({title:"请先登录",icon:"none"});const a="/with-state/"+(J.value?"unlike":"add-like");o({url:D+a,method:"POST",header:{Authorization:i("token")},data:{id:parseInt(H.value),type:2},success:a=>{"success"===a.data.status&&(J.value=!J.value,S({title:J.value?"关注成功":"已取消关注",icon:"none"}))}})},Z=()=>{R.isLogin&&o({url:`${D}/with-state/hasLike?id=${H.value}&type=2`,method:"POST",header:{Authorization:i("token")},success:a=>{var e;J.value=(null==(e=a.data.data)?void 0:e.id)>0}})};return E((a=>{a.id?(G.value=a.id,(async a=>{try{const e=await o({url:`${D}/sale-news-detail?id=${a}`,timeout:5e3});"success"===e.data.status?(z.value={...e.data.data,image_list:e.data.data.image_list||[]},H.value=e.data.data.brand_id,W()):handleError(e.data.msg||"数据加载失败")}catch(e){console.error("请求失败:",e),handleError("网络请求失败")}finally{P.value=!1}})(a.id),A().then(Z)):handleError("缺少必要参数")})),(a,e)=>{const t=w,o=j,i=x,k=r,S=C,E=L(l("comment-list"),I),A=L(l("comment-input"),F);return d(),s(k,null,{default:n((()=>[u("meta",{name:"theme-color",content:"#F8F8F8"}),c(k,{style:{position:"relative"}},{default:n((()=>[c(i,{class:"swiper-box","indicator-dots":!0,autoplay:!1},{default:n((()=>[(d(!0),p(_,null,m(z.value.image_list,((a,e)=>(d(),s(o,{key:e},{default:n((()=>[c(t,{src:a,mode:"aspectFill",class:"swiper-image",onClick:a=>{$({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),c(k,{class:"brand-info"},{default:n((()=>[c(t,{class:"brand-logo",src:O.value.logo_image,mode:"aspectFill",onClick:e[0]||(e[0]=a=>K(O.value.id))},null,8,["src"]),c(k,{class:"brand-details",onClick:e[1]||(e[1]=a=>K(O.value.id))},{default:n((()=>[c(S,{class:"brand-name"},{default:n((()=>[f(g(O.value.brand_name),1)])),_:1}),c(S,{class:"publish-time"},{default:n((()=>[f(g(V(z.value.created_at)),1)])),_:1})])),_:1}),c(S,{class:"follow",onClick:X,style:v({background:J.value?"#ff6a6c":"#65C3D6"})},{default:n((()=>[f(g(J.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),c(k,{class:"content-box"},{default:n((()=>[c(k,null,{default:n((()=>[c(S,{class:"title"},{default:n((()=>[f(g(z.value.title),1)])),_:1})])),_:1}),c(k,{style:{margin:"20rpx 0rpx"}},{default:n((()=>[c(S,{class:"content"},{default:n((()=>[f(g(z.value.content),1)])),_:1})])),_:1})])),_:1}),c(k,{style:{padding:"10px"}},{default:n((()=>[c(E,{ref_key:"commentListRef",ref:N,type:4,"relation-id":parseInt(G.value),onReply:q},null,8,["relation-id"])])),_:1}),P.value?(d(),s(k,{key:0,class:"loading"},{default:n((()=>[f("加载中...")])),_:1})):y("",!0),B.value?(d(),s(k,{key:1,class:"error"},{default:n((()=>[f(g(M.value),1)])),_:1})):y("",!0),c(A,{ref_key:"commentInputRef",ref:U,"reply-info":h(Y),"target-id":G.value,onSubmit:Q,"onUpdate:replyInfo":e[2]||(e[2]=a=>b(Y)?Y.value=a:Y=a)},null,8,["reply-info","target-id"]),c(k,{style:{width:"100%",height:"120rpx"}})])),_:1})}}},[["__scopeId","data-v-90093e14"]]);export{z as default};
