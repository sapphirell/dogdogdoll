import{g as a,h as e,_ as t,m as l,c as s,w as n,l as o,H as i,f as r,o as d,p as u,a as c,d as p,r as m,F as _,b as f,t as g,Y as v,z as y,y as h,R as b,n as k,k as S,i as w,C as x,e as C,G as $,B as I}from"./index-B55GPRQF.js";import{_ as F,a as j}from"./comment-input.BEXNcG5_.js";import{a as L,r as E}from"./uni-app.es.CzHle-z4.js";import{b as R,w as z,a as A}from"./config.BIUptOrH.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.B2Wm8RW1.js";const O=D({__name:"sale_news",setup(D){const O=a({title:"",content:"",image_list:[],created_at:0}),P=a({brand_name:"",logo:""}),T=a(!0),G=a(!1),H=a(""),M=a(0),Y=a(0),B=a(!1),N=a(null),U=a(null);a(1);let q=a({});e();const J=({parent:a,target:e})=>{var t;console.log("parent",a),console.log("target",e);let l=a;null!=e&&(l=e),q.value.id!=l.id?(console.log("item",l),q.value=l,null==(t=U.value)||t.focusInput()):q.value={}};function K(a){k({url:"/pages/brand/brand?brand_id="+a})}t({title:"图透详情"});const Q=({content:a,replyInfo:e,origin:t})=>{let l=i("token");if(!A.isLogin)return void S({title:"请先登录",icon:"none"});console.log("reply_info",e);const s={content:a,origin:t,target_id:parseInt(M.value),type:4,...e.id&&{reply_id:e.id,reply_for:e.comment,reply_user_id:e.user_id,parent_id:e.parent_id>0?e.parent_id:e.id}};o({url:z+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:a=>{var e,t;if("success"==a.data.status){const l=a.data.data;0===l.parent_id?null==(e=N.value)||e.addNewComment(l):null==(t=N.value)||t.addReplyComment(l),S({title:"评论成功",icon:"success"})}else S({title:a.data.msg,icon:"none"})},fail:a=>{S({title:"网络请求失败",icon:"none"})}})};function V(a){const e=new Date(1e3*a),t=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),n=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${t}-${l}-${s} ${n}:${o}`}const W=()=>{o({url:z+"/brand-info?id="+Y.value,success:a=>{"success"===a.data.status&&(P.value=a.data.data,t({title:a.data.data.brand_name}),Z())},fail:()=>handleError("品牌信息加载失败")})},X=async()=>{if(!A.isLogin)return void S({title:"请先登录",icon:"none"});const a="/with-state/"+(B.value?"unlike":"add-like");o({url:z+a,method:"POST",header:{Authorization:i("token")},data:{id:parseInt(Y.value),type:2},success:a=>{"success"===a.data.status&&(B.value=!B.value,S({title:B.value?"关注成功":"已取消关注",icon:"none"}))}})},Z=()=>{A.isLogin&&o({url:`${z}/with-state/hasLike?id=${Y.value}&type=2`,method:"POST",header:{Authorization:i("token")},success:a=>{var e;B.value=(null==(e=a.data.data)?void 0:e.id)>0}})};return L((a=>{a.id?(M.value=a.id,(async a=>{try{const e=await o({url:`${z}/sale-news-detail?id=${a}`,timeout:5e3});"success"===e.data.status?(O.value={...e.data.data,image_list:e.data.data.image_list||[]},Y.value=e.data.data.brand_id,W()):handleError(e.data.msg||"数据加载失败")}catch(e){console.error("请求失败:",e),handleError("网络请求失败")}finally{T.value=!1}})(a.id),R().then(Z)):handleError("缺少必要参数")})),(a,e)=>{const t=w,o=I,i=x,k=r,S=C,L=E(l("comment-list"),F),R=E(l("comment-input"),j);return d(),s(k,null,{default:n((()=>[u("meta",{name:"theme-color",content:"#F8F8F8"}),c(k,{style:{position:"relative"}},{default:n((()=>[c(i,{class:"swiper-box","indicator-dots":!0,autoplay:!1},{default:n((()=>[(d(!0),p(_,null,m(O.value.image_list,((a,e)=>(d(),s(o,{key:e},{default:n((()=>[c(t,{src:a,mode:"aspectFill",class:"swiper-image",onClick:a=>{$({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),c(k,{class:"brand-info"},{default:n((()=>[c(t,{class:"brand-logo",src:P.value.logo_image,mode:"aspectFill",onClick:e[0]||(e[0]=a=>K(P.value.id))},null,8,["src"]),c(k,{class:"brand-details",onClick:e[1]||(e[1]=a=>K(P.value.id))},{default:n((()=>[c(S,{class:"brand-name"},{default:n((()=>[f(g(P.value.brand_name),1)])),_:1}),c(S,{class:"publish-time"},{default:n((()=>[f(g(V(O.value.created_at)),1)])),_:1})])),_:1}),c(S,{class:"follow",onClick:X,style:v({background:B.value?"#ff6a6c":"#65C3D6"})},{default:n((()=>[f(g(B.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),c(k,{class:"content-box"},{default:n((()=>[c(k,null,{default:n((()=>[c(S,{class:"title"},{default:n((()=>[f(g(O.value.title),1)])),_:1})])),_:1}),c(k,{style:{margin:"20rpx 0rpx"}},{default:n((()=>[c(S,{class:"content"},{default:n((()=>[f(g(O.value.content),1)])),_:1})])),_:1})])),_:1}),c(k,{style:{padding:"10px"}},{default:n((()=>[c(L,{ref_key:"commentListRef",ref:N,type:4,"relation-id":parseInt(M.value),onReply:J},null,8,["relation-id"])])),_:1}),T.value?(d(),s(k,{key:0,class:"loading"},{default:n((()=>[f("加载中...")])),_:1})):y("",!0),G.value?(d(),s(k,{key:1,class:"error"},{default:n((()=>[f(g(H.value),1)])),_:1})):y("",!0),c(R,{ref_key:"commentInputRef",ref:U,"reply-info":h(q),"target-id":M.value,onSubmit:Q,"onUpdate:replyInfo":e[2]||(e[2]=a=>b(q)?q.value=a:q=a)},null,8,["reply-info","target-id"]),c(k,{style:{width:"100%",height:"120rpx"}})])),_:1})}}},[["__scopeId","data-v-90093e14"]]);export{O as default};
