import{g as a,h as e,W as t,j as l,c as s,w as n,l as o,C as i,f as r,o as d,k as u,a as c,d as p,r as m,F as _,b as f,t as g,U as v,v as y,u as h,N as b,n as k,m as S,i as w,y as x,e as C,B as $,D as F}from"./index-CAhh9jg-.js";import{_ as I,a as j}from"./comment-input.Koi9PTNE.js";import{o as L,r as z}from"./uni-app.es.CI_TJZj7.js";import{b as D,w as E,a as R}from"./config.D_tpLRWx.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DApveqxl.js";const O=A({__name:"sale_news",setup(A){const O=a({title:"",content:"",image_list:[],created_at:0}),P=a({brand_name:"",logo:""}),T=a(!0),M=a(!1),N=a(""),U=a(0),B=a(0),H=a(!1),W=a(null),Y=a(null);a(1);let q=a({});e();const G=({parent:a,target:e})=>{var t;console.log("parent",a),console.log("target",e);let l=a;null!=e&&(l=e),q.value.id!=l.id?(console.log("item",l),q.value=l,null==(t=Y.value)||t.focusInput()):q.value={}};function J(a){k({url:"/pages/brand/brand?brand_id="+a})}t({title:"图透详情"});const K=({content:a,replyInfo:e,origin:t})=>{let l=i("token");if(!R.isLogin)return void S({title:"请先登录",icon:"none"});console.log("reply_info",e);const s={content:a,origin:t,target_id:parseInt(U.value),type:4,...e.id&&{reply_id:e.id,reply_for:e.comment,reply_user_id:e.user_id,parent_id:e.parent_id>0?e.parent_id:e.id}};o({url:E+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:a=>{var e,t;if("success"==a.data.status){const l=a.data.data;0===l.parent_id?null==(e=W.value)||e.addNewComment(l):null==(t=W.value)||t.addReplyComment(l),S({title:"评论成功",icon:"success"})}else S({title:a.data.msg,icon:"none"})},fail:a=>{S({title:"网络请求失败",icon:"none"})}})};function Q(a){const e=new Date(1e3*a),t=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),n=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${t}-${l}-${s} ${n}:${o}`}const V=()=>{o({url:E+"/brand-info?id="+B.value,success:a=>{"success"===a.data.status&&(P.value=a.data.data,t({title:a.data.data.brand_name}),Z())},fail:()=>handleError("品牌信息加载失败")})},X=async()=>{if(!R.isLogin)return void S({title:"请先登录",icon:"none"});const a="/with-state/"+(H.value?"unlike":"add-like");o({url:E+a,method:"POST",header:{Authorization:i("token")},data:{id:parseInt(B.value),type:2},success:a=>{"success"===a.data.status&&(H.value=!H.value,S({title:H.value?"关注成功":"已取消关注",icon:"none"}))}})},Z=()=>{R.isLogin&&o({url:`${E}/with-state/hasLike?id=${B.value}&type=2`,method:"POST",header:{Authorization:i("token")},success:a=>{var e;H.value=(null==(e=a.data.data)?void 0:e.id)>0}})};return L((a=>{a.id&&a.brand_id?(U.value=a.id,B.value=a.brand_id,(async a=>{try{const e=await o({url:`${E}/sale-news-detail?id=${a}`,timeout:5e3});"success"===e.data.status?(O.value={...e.data.data,image_list:e.data.data.image_list||[]},V()):handleError(e.data.msg||"数据加载失败")}catch(e){handleError("网络请求失败")}finally{T.value=!1}})(a.id),D().then(Z)):handleError("缺少必要参数")})),(a,e)=>{const t=w,o=F,i=x,k=r,S=C,L=z(l("comment-list"),I),D=z(l("comment-input"),j);return d(),s(k,null,{default:n((()=>[u("meta",{name:"theme-color",content:"#F8F8F8"}),c(k,{style:{position:"relative"}},{default:n((()=>[c(i,{class:"swiper-box","indicator-dots":!0,autoplay:!1},{default:n((()=>[(d(!0),p(_,null,m(O.value.image_list,((a,e)=>(d(),s(o,{key:e},{default:n((()=>[c(t,{src:a,mode:"aspectFill",class:"swiper-image",onClick:a=>{$({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),c(k,{class:"brand-info"},{default:n((()=>[c(t,{class:"brand-logo",src:P.value.logo_image,mode:"aspectFill",onClick:e[0]||(e[0]=a=>J(P.value.id))},null,8,["src"]),c(k,{class:"brand-details",onClick:e[1]||(e[1]=a=>J(P.value.id))},{default:n((()=>[c(S,{class:"brand-name"},{default:n((()=>[f(g(P.value.brand_name),1)])),_:1}),c(S,{class:"publish-time"},{default:n((()=>[f(g(Q(O.value.created_at)),1)])),_:1})])),_:1}),c(S,{class:"follow",onClick:X,style:v({background:H.value?"#ff6a6c":"#65C3D6"})},{default:n((()=>[f(g(H.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),c(k,{class:"content-box"},{default:n((()=>[c(k,null,{default:n((()=>[c(S,{class:"title"},{default:n((()=>[f(g(O.value.title),1)])),_:1})])),_:1}),c(k,{style:{margin:"20rpx 0rpx"}},{default:n((()=>[c(S,{class:"content"},{default:n((()=>[f(g(O.value.content),1)])),_:1})])),_:1})])),_:1}),c(k,{style:{padding:"10px"}},{default:n((()=>[c(L,{ref_key:"commentListRef",ref:W,type:4,"relation-id":parseInt(U.value),onReply:G},null,8,["relation-id"])])),_:1}),T.value?(d(),s(k,{key:0,class:"loading"},{default:n((()=>[f("加载中...")])),_:1})):y("",!0),M.value?(d(),s(k,{key:1,class:"error"},{default:n((()=>[f(g(N.value),1)])),_:1})):y("",!0),c(D,{ref_key:"commentInputRef",ref:Y,"reply-info":h(q),"target-id":U.value,onSubmit:K,"onUpdate:replyInfo":e[2]||(e[2]=a=>b(q)?q.value=a:q=a)},null,8,["reply-info","target-id"]),c(k,{style:{width:"100%",height:"120rpx"}})])),_:1})}}},[["__scopeId","data-v-212e1d04"]]);export{O as default};
