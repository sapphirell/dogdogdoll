import{g as e,j as a,c as o,w as l,l as s,m as t,p as n,o as i,a as d,d as c,r as u,F as r,b as p,C as m,a4 as g,i as _,f as v,S as f,Q as h,a9 as x,H as b,t as y,B as k,e as w}from"./index-CAhh9jg-.js";import{_ as j}from"./common-name-picker.WlSLPQob.js";import{r as C}from"./uni-app.es.CI_TJZj7.js";import{_ as I}from"./common-search.CCwQUJ9J.js";import{_ as L,a as S}from"./common-modal.CGmcSZAO.js";import{_ as T}from"./common-page.BrPj6MFC.js";import{_ as V}from"./cancel.CnEdunnH.js";import{_ as D}from"./add2.S6xx6DwX.js";import{_ as F}from"./right2.s_X9TKoF.js";import{w as G,i as E,d as U}from"./config.D_tpLRWx.js";import{c as A,g as B,u as P}from"./image.b6tkzStG.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const H=z({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(z){const H=z,J=e([]),K=e([]),N=e([]),O=e(!1),Q=e(""),q=e(0),M=e(""),R=e(0),W=e("");function X(e){return new Promise(((a,o)=>{s({url:G+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),a(e.data)},fail:e=>{console.log(e),t({title:"网络请求失败",icon:"none"}),o(e)},complete:()=>{n()}})}))}const Y=e([]);H.goods_id&&H.goods_name&&H.brand_id&&H.brand_name&&H.type&&X(H.goods_id).then((e=>{let a={brand_id:parseInt(H.brand_id,10),goods_id:parseInt(H.goods_id,10),brand_name:H.brand_name,goods_name:H.goods_name,goods_image:e.data.goods_images[0],type:H.type};console.log(a),Y.value.push(a)}));const Z=e(""),$=e("");function ee(e){k({current:J.value[e],urls:J.value})}function ae(){const e=m("token");if(!e)return void t({title:"请先登录",icon:"none"});if(!Z.value.trim()||!$.value.trim())return void t({title:"标题和正文不能为空",icon:"none"});if(0===J.value.length)return void t({title:"请至少上传一张图片",icon:"none"});let a=U();const o={title:Z.value,content:$.value,image_url_list:J.value,scene:a,relation_data_list:Y.value.map((e=>({goods_id:e.goods_id,goods_name:e.goods_name,brand_id:e.brand_id,brand_name:e.brand_name,type:e.type})))};console.log(o),s({url:G+"/with-state/add-collocation",method:"POST",data:o,header:{"Content-Type":"application/json",Authorization:e},timeout:5e3,success:e=>{"success"===e.data.status?(t({title:"提交成功"}),Z.value="",$.value="",J.value=[],Y.value=[],g()):t({title:e.data.msg||"提交失败",icon:"none"})},fail:e=>{console.log(e),t({title:"网络请求失败",icon:"none"})}})}function oe(e,a){console.log("收到品牌ID:",e),console.log("收到品牌Name:",a),q.value=parseInt(e,10),Q.value=a,s({url:G+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),K.value=e.data.data,console.log(K.value)},fail:e=>{console.log(e),t({title:"网络请求失败",icon:"none"})}})}function le(e,a){console.log("选中的 id:",e),console.log("选中的 name:",a),R.value=parseInt(e,10),M.value=a}function se(e){console.log("选中的值:",e),W.value=e,O.value=!0}function te(){if(""!=Q.value)if(""!=M.value){if(0==R.value){let e={brand_id:q.value,goods_id:0,brand_name:Q.value,goods_name:M.value,goods_image:"",type:W.value};return Y.value.push(e),O.value=!1,q.value=0,Q.value="",R.value=0,M.value="",void(W.value="")}X(R.value).then((e=>{let a={brand_id:q.value,goods_id:R.value,brand_name:Q.value,goods_name:M.value,goods_image:e.data.goods_images[0],type:W.value};Y.value.push(a),O.value=!1,q.value=0,Q.value="",R.value=0,M.value="",W.value=""}))}else t({title:"请选择或填写商品名称",icon:"none"});else t({title:"请选择或填写品牌名称",icon:"none"})}return s({url:G+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),N.value=e.data.data},fail:e=>{console.log(e),t({title:"网络请求失败",icon:"none"})}}),(e,s)=>{const n=_,m=v,g=f,k=h,G=x,U=C(a("common-name-picker"),j),z=w,H=C(a("common-search"),I),Q=C(a("custom-picker"),L),q=b,M=C(a("common-modal"),S),R=C(a("common-page"),T);return i(),o(R,null,{default:l((()=>[d(g,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(i(!0),c(r,null,u(J.value,((e,a)=>(i(),o(m,{class:"upload_item",key:a},{default:l((()=>[d(n,{src:e,class:"uploaded_image",onClick:ee,mode:"aspectFill"},null,8,["src"]),d(n,{src:V,class:"close_icon",onClick:e=>function(e){J.value.splice(e,1)}(a)},null,8,["onClick"])])),_:2},1024)))),128)),d(m,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[d(n,{src:D,class:"upload_img",onClick:s[0]||(s[0]=a=>(e.index,console.log("openSelect"),void A().then((e=>{B().then((a=>{console.log(a),P(e,a.token,a.path).then((e=>{200!=e.statusCode&&t({title:"上传失败",icon:"none"}),console.log(E+a.path),J.value.push(E+a.path),t({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),d(k,{modelValue:Z.value,"onUpdate:modelValue":s[1]||(s[1]=e=>Z.value=e),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),d(m,{class:"oneLine"}),d(G,{modelValue:$.value,"onUpdate:modelValue":s[2]||(s[2]=e=>$.value=e),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),d(m,{class:"oneLine"}),d(m,{class:""},{default:l((()=>[d(m,{style:{display:"flex",padding:"10px 15px",position:"relative"}},{default:l((()=>[d(U,{style:{width:"650rpx"},dataList:N.value,placeholder:"关联娃物",onSelect:se},null,8,["dataList"]),d(n,{src:F,style:{width:"20px",height:"20px",margin:"10px",position:"absolute",right:"40rpx"},mode:"aspectFill"})])),_:1})])),_:1}),d(m,{class:"saveCollocationDataList"},{default:l((()=>[(i(!0),c(r,null,u(Y.value,((e,a)=>(i(),o(m,{key:a},{default:l((()=>[d(m,{class:"saveCollocationDataItem"},{default:l((()=>[e.goods_image?(i(),o(n,{key:0,src:e.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(i(),o(z,{key:1,class:"no-image"},{default:l((()=>[p("?")])),_:1})),d(z,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[p(y(e.type)+" "+y(e.brand_name)+" - "+y(e.goods_name),1)])),_:2},1024),d(n,{src:V,class:"close_icon",onClick:e=>function(e){Y.value.splice(e,1)}(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(M,{visible:O.value,"onUpdate:visible":s[3]||(s[3]=e=>O.value=e)},{default:l((()=>[d(m,{class:"selectTab",style:{border:"1px sold #b2b0b4","padding-top":"60rpx"}},{default:l((()=>[d(H,{mode:"fill",onSelect:oe,width:"calc(100vw - 120px)"}),d(m,{style:{height:"30rpx"}}),d(Q,{dataList:K.value,onSelect:le,margin:"10px 0 0 0px"},null,8,["dataList"]),d(q,{onClick:te,style:{"margin-top":"20px","background-color":"#fff"}},{default:l((()=>[p("确认")])),_:1})])),_:1})])),_:1},8,["visible"]),d(m,{class:"footer"},{default:l((()=>[d(q,{onClick:ae},{default:l((()=>[p("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-3f3cc776"]]);export{H as default};
