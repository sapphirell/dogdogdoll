import{h as e,P as a,_ as l,aa as o,k as t,c as s,w as i,l as n,C as d,m as c,o as u,a as r,b as m,v as p,e as v,r as _,F as g,x as f,a8 as h,f as y,g as x,i as b,W as k,N as w,X as C,D as j,t as T,p as E,y as L}from"./index-u2rUIk8T.js";import{_ as I}from"./common-name-picker.BbA5WcEx.js";import{r as D}from"./uni-app.es.DpDa-E5E.js";import{_ as V}from"./common-search.B09gwaSi.js";import{_ as F,a as S}from"./common-modal.D11NfJ0_.js";import{_ as A}from"./common-page.CNR2v_s0.js";import{_ as G}from"./cancel.CnEdunnH.js";import{_ as $}from"./add2.S6xx6DwX.js";import{_ as z}from"./right2.s_X9TKoF.js";import{w as P,i as U}from"./config.DgkxgtZ3.js";import{c as N,g as B,u as O}from"./image.BZ6EH6H4.js";import{_ as W}from"./_plugin-vue_export-helper.BCo6x5W8.js";const X=W({__name:"showcase_form",props:["showcase_id"],setup(W){const X=W,q=e([]),H=e([]),J=e([]),K=e(!1),M=e(""),Q=e(0),R=e(""),Y=e(0),Z=e(""),ee=a((()=>[-1,1,3].includes(te.value))),ae=a((()=>!!X.showcase_id)),le=e(""),oe=e(""),te=e(-1);const se=e([]);function ie(e){L({current:q.value[e],urls:q.value})}async function ne(){f({title:"确认删除",content:"确定要删除这个展示吗？",success:async e=>{if(e.confirm)try{200===(await n({url:`${P}/with-state/delete-showcase`,method:"DELETE",data:{id:X.showcase_id},header:{Authorization:d("token")}})).data.code&&(c({title:"删除成功"}),setTimeout((()=>h()),1e3))}catch(a){c({title:"删除失败",icon:"none"})}}})}async function de(){if(!d("token"))return void c({title:"请先登录",icon:"none"});if(!le.value.trim()||!oe.value.trim())return void c({title:"标题和正文不能为空",icon:"none"});if(0===q.value.length)return void c({title:"请至少上传一张图片",icon:"none"});let e={name:le.value,description:oe.value,image_urls:q.value.join(","),display:te.value,relations:se.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:2})))};try{const a=`${P}/with-state/update-showcase`;X.showcase_id&&(e={...e,id:parseInt(X.showcase_id,10)});if("failed"===(await n({url:a,method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:d("token")}})).data.code)return void c({title:"提交失败",icon:"none"});c({title:"提交成功"}),setTimeout((()=>h()),1500)}catch(a){console.log(a),c({title:"提交失败",icon:"none"})}}function ce(e,a){console.log("收到品牌ID:",e),console.log("收到品牌Name:",a),Q.value=parseInt(e,10),M.value=a,n({url:P+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),H.value=e.data.data,console.log(H.value)},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"})}})}function ue(e,a){console.log("选中的 id:",e),console.log("选中的 name:",a),Y.value=parseInt(e,10),R.value=a}function re(e){console.log("选中的值:",e),Z.value=e,K.value=!0}function me(){if(""!=M.value)if(""!=R.value){if(0==Y.value){let e={brand_id:Q.value,goods_id:0,brand_name:M.value,goods_name:R.value,goods_image:"",type:Z.value};return se.value.push(e),K.value=!1,Q.value=0,M.value="",Y.value=0,R.value="",void(Z.value="")}var e;(e=Y.value,new Promise(((a,l)=>{n({url:P+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),a(e.data)},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"}),l(e)},complete:()=>{E()}})}))).then((e=>{let a={brand_id:Q.value,goods_id:Y.value,brand_name:M.value,goods_name:R.value,goods_image:e.data.goods_images[0],type:Z.value};se.value.push(a),K.value=!1,Q.value=0,M.value="",Y.value=0,R.value="",Z.value=""}))}else c({title:"请选择或填写商品名称",icon:"none"});else c({title:"请选择或填写品牌名称",icon:"none"})}return l({title:"展示柜"}),o((()=>{n({url:P+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),J.value=e.data.data},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"})}}),async function(){var e;if(X.showcase_id)try{const a=(await n({url:`${P}/with-state/showcase-detail?id=${X.showcase_id}`,method:"GET",header:{Authorization:d("token")}})).data.data;le.value=a.name,oe.value=a.description,te.value=a.display,q.value=(null==(e=a.image_urls)?void 0:e.split(","))||[],console.log(a),a.relations&&(se.value=a.relations.map((e=>({goods_id:e.relation_goods_id,goods_name:e.relation_goods_name,brand_id:e.relation_brand_id,brand_name:e.relation_brand_name,type:e.type,goods_image:e.relation_goods_image}))))}catch(a){c({title:"加载失败",icon:"none"})}}()})),(e,a)=>{const l=y,o=x,n=b,d=k,f=w,h=C,E=D(t("common-name-picker"),I),L=D(t("common-search"),V),P=D(t("custom-picker"),F),W=j,X=D(t("common-modal"),S),M=D(t("common-page"),A);return u(),s(M,null,{default:i((()=>[ee.value?p("",!0):(u(),s(o,{key:0,class:"edit-tip"},{default:i((()=>[r(l,null,{default:i((()=>[m("当前状态不可编辑")])),_:1})])),_:1})),r(d,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:i((()=>[(u(!0),v(g,null,_(q.value,((e,a)=>(u(),s(o,{class:"upload_item",key:a},{default:i((()=>[r(n,{src:e,class:"uploaded_image",onClick:ie,mode:"aspectFill"},null,8,["src"]),ee.value?(u(),s(n,{key:0,src:G,class:"close_icon",onClick:e=>function(e){q.value.splice(e,1)}(a)},null,8,["onClick"])):p("",!0)])),_:2},1024)))),128)),ee.value?(u(),s(o,{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:i((()=>[r(n,{src:$,class:"upload_img",onClick:a[0]||(a[0]=a=>(e.index,console.log("openSelect"),void N().then((e=>{B().then((a=>{console.log(a),O(e,a.token,a.path).then((e=>{200!=e.statusCode&&c({title:"上传失败",icon:"none"}),console.log(U+a.path),q.value.push(U+a.path),c({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})):p("",!0)])),_:1}),r(f,{modelValue:le.value,"onUpdate:modelValue":a[1]||(a[1]=e=>le.value=e),type:"text",disabled:!ee.value,placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue","disabled"]),r(o,{class:"oneLine"}),r(h,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),disabled:!ee.value,placeholder:"请输入描述",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue","disabled"]),r(o,{class:"oneLine"}),r(o,{class:""},{default:i((()=>[ee.value?(u(),s(o,{key:0,style:{display:"flex",padding:"10px 15px",position:"relative"}},{default:i((()=>[r(E,{style:{width:"650rpx"},dataList:J.value,placeholder:"关联娃物",onSelect:re},null,8,["dataList"]),r(n,{src:z,style:{width:"20px",height:"20px",margin:"10px",position:"absolute",right:"40rpx"},mode:"aspectFill"})])),_:1})):p("",!0)])),_:1}),r(o,{class:"saveCollocationDataList"},{default:i((()=>[(u(!0),v(g,null,_(se.value,((e,a)=>(u(),s(o,{key:a},{default:i((()=>[r(o,{class:"saveCollocationDataItem"},{default:i((()=>[e.goods_image?(u(),s(n,{key:0,src:e.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(u(),s(l,{key:1,class:"no-image"},{default:i((()=>[m("?")])),_:1})),r(l,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:i((()=>[m(T(e.type)+" "+T(e.brand_name)+" - "+T(e.goods_name),1)])),_:2},1024),ee.value?(u(),s(n,{key:2,src:G,class:"close_icon",onClick:e=>function(e){se.value.splice(e,1)}(a)},null,8,["onClick"])):p("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),r(X,{visible:K.value,"onUpdate:visible":a[3]||(a[3]=e=>K.value=e)},{default:i((()=>[r(o,{class:"selectTab",style:{border:"1px sold #b2b0b4"}},{default:i((()=>[r(L,{mode:"fill",onSelect:ce,width:"calc(100vw - 120px)"}),r(P,{dataList:H.value,onSelect:ue,margin:"10px 0 0 8px"},null,8,["dataList"]),r(W,{onClick:me,style:{"margin-top":"20px","background-color":"#fff"}},{default:i((()=>[m("确认")])),_:1})])),_:1})])),_:1},8,["visible"]),r(o,{class:"footer"},{default:i((()=>[ae.value?(u(),s(W,{key:0,onClick:ne,class:"delete-btn"},{default:i((()=>[m("删除")])),_:1})):p("",!0),r(W,{onClick:de},{default:i((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-c5f3ab23"]]);export{X as default};
