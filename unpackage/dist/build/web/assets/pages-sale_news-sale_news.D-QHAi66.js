import{r as a,l as e,a2 as t,a as l,v as s,d as n,w as o,F as i,q as r,j as d,g as u,b as c,B as m,x as p,e as _,t as g,a0 as v,c as f,p as y,C as h,T as b,n as k,A as w,i as S,G as x,f as C,J as $,E as I}from"./index-BFzTDSoz.js";import{c as j,w as F,b as A,_ as E}from"./view-logs.yEAac7W9.js";import{_ as L,a as D,r as R}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as T,a as z}from"./comment-input.B__ry1x5.js";import"./uni-icons.COaeasi-.js";import"./common-modal.DWKlFhUY.js";const O=L({__name:"sale_news",setup(L){const O=a({title:"",content:"",image_list:[],created_at:0}),P=a({brand_name:"",logo:""}),B=a(!0),M=a(!1),q=a(""),G=a(0),H=a(0),J=a(!1),K=a(null),N=a(null);a(1);let U=a({});e();const Y=({parent:a,target:e})=>{var t;console.log("parent",a),console.log("target",e);let l=a;null!=e&&(l=e),U.value.id!=l.id?(console.log("item",l),U.value=l,null==(t=N.value)||t.focusInput()):U.value={}};function Q(a){k({url:"/pages/brand/brand?brand_id="+a})}t({title:"图透详情"});const V=({content:a,replyInfo:e,origin:t})=>{let l=d("token");if(!A.isLogin)return void w({title:"请先登录",icon:"none"});console.log("reply_info",e);const s={content:a,origin:t,target_id:parseInt(G.value),type:4,...e.id&&{reply_id:e.id,reply_for:e.comment,reply_user_id:e.user_id,parent_id:e.parent_id>0?e.parent_id:e.id}};r({url:F+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:a=>{var e,t;if("success"==a.data.status){const l=a.data.data;0===l.parent_id?null==(e=K.value)||e.addNewComment(l):null==(t=K.value)||t.addReplyComment(l),w({title:"评论成功",icon:"success"})}else w({title:a.data.msg,icon:"none"})},fail:a=>{w({title:"网络请求失败",icon:"none"})}})};function W(a){const e=new Date(1e3*a),t=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),n=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${t}-${l}-${s} ${n}:${o}`}const X=()=>{r({url:F+"/brand-info?id="+H.value,success:a=>{"success"===a.data.status&&(P.value=a.data.data,t({title:a.data.data.brand_name}),aa())},fail:()=>handleError("品牌信息加载失败")})},Z=async()=>{if(!A.isLogin)return void w({title:"请先登录",icon:"none"});const a="/with-state/"+(J.value?"unlike":"add-like");r({url:F+a,method:"POST",header:{Authorization:d("token")},data:{id:parseInt(H.value),type:2},success:a=>{"success"===a.data.status&&(J.value=!J.value,w({title:J.value?"关注成功":"已取消关注",icon:"none"}))}})},aa=()=>{A.isLogin&&r({url:`${F}/with-state/hasLike?id=${H.value}&type=2`,method:"POST",header:{Authorization:d("token")},success:a=>{var e;J.value=(null==(e=a.data.data)?void 0:e.id)>0}})};return D((a=>{a.id?(G.value=a.id,(async a=>{try{const e=await r({url:`${F}/sale-news-detail?id=${a}`,timeout:5e3});"success"===e.data.status?(O.value={...e.data.data,image_list:e.data.data.image_list||[]},H.value=e.data.data.brand_id,X()):handleError(e.data.msg||"数据加载失败")}catch(e){console.error("请求失败:",e),handleError("网络请求失败")}finally{B.value=!1}})(a.id),j().then(aa)):handleError("缺少必要参数")})),(a,e)=>{const t=R(l("view-logs"),E),r=S,d=I,k=x,w=u,j=C,F=R(l("comment-list"),T),A=R(l("comment-input"),z);return c(),s(i,null,[n(t),n(w,null,{default:o((()=>[m("meta",{name:"theme-color",content:"#F8F8F8"}),n(w,{style:{position:"relative"}},{default:o((()=>[n(k,{class:"swiper-box","indicator-dots":!0,autoplay:!1},{default:o((()=>[(c(!0),s(i,null,p(O.value.image_list,((a,e)=>(c(),f(d,{key:e},{default:o((()=>[n(r,{src:a,mode:"aspectFill",class:"swiper-image",onClick:a=>{$({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),n(w,{class:"brand-info"},{default:o((()=>[n(r,{class:"brand-logo",src:P.value.logo_image,mode:"aspectFill",onClick:e[0]||(e[0]=a=>Q(P.value.id))},null,8,["src"]),n(w,{class:"brand-details",onClick:e[1]||(e[1]=a=>Q(P.value.id))},{default:o((()=>[n(j,{class:"brand-name"},{default:o((()=>[_(g(P.value.brand_name),1)])),_:1}),n(j,{class:"publish-time"},{default:o((()=>[_(g(W(O.value.created_at)),1)])),_:1})])),_:1}),n(j,{class:"follow",onClick:Z,style:v({background:J.value?"#ff6a6c":"#65C3D6"})},{default:o((()=>[_(g(J.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),n(w,{class:"content-box"},{default:o((()=>[n(w,null,{default:o((()=>[n(j,{class:"title"},{default:o((()=>[_(g(O.value.title),1)])),_:1})])),_:1}),n(w,{style:{margin:"20rpx 0rpx"}},{default:o((()=>[n(j,{class:"content"},{default:o((()=>[_(g(O.value.content),1)])),_:1})])),_:1})])),_:1}),n(w,{style:{padding:"10px"}},{default:o((()=>[n(F,{ref_key:"commentListRef",ref:K,type:4,"relation-id":parseInt(G.value),onReply:Y},null,8,["relation-id"])])),_:1}),B.value?(c(),f(w,{key:0,class:"loading"},{default:o((()=>[_("加载中...")])),_:1})):y("",!0),M.value?(c(),f(w,{key:1,class:"error"},{default:o((()=>[_(g(q.value),1)])),_:1})):y("",!0),n(A,{ref_key:"commentInputRef",ref:N,"reply-info":h(U),"target-id":G.value,onSubmit:V,"onUpdate:replyInfo":e[2]||(e[2]=a=>b(U)?U.value=a:U=a)},null,8,["reply-info","target-id"]),n(w,{style:{width:"100%",height:"120rpx"}})])),_:1})],64)}}},[["__scopeId","data-v-11c1ac03"]]);export{O as default};
