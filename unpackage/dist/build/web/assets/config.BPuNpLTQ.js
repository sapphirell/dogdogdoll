import{af as t,A as n,p as o,I as e,H as s,q as a}from"./index-D8OtiTi9.js";const i="https://api.fantuanpu.com",c="https://images1.fantuanpu.com/";let u=t({isLogin:!1,userInfo:{}});function r(){a({title:"请在微信小程序中登录",icon:"none"})}function l(){const t=n("token");t?o({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:t},success:t=>{const n=t.data.data;n?h(n):m()},fail:t=>{p(t,"获取用户信息失败")}}):m()}function d(){return new Promise(((t,e)=>{const s=n("token");if(!s)return m(),void t(null);o({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:s},success:n=>{const o=n.data.data;o?(console.log("返回：",o),h(o),t(o)):(m(),t(null))},fail:n=>{p(n,"获取用户信息失败"),t(null)}})}))}async function f(t,e,s){let c=n("token");return c?(o({url:i+"/with-state/add-vote-score",method:"POST",header:{Authorization:c},data:{target_id:parseInt(s),score:parseInt(e),type:t},success:t=>(console.log(t.data),"success"==t.data.status?(a({title:"评分成功",icon:"success"}),activeModal.value=!1,0):(a({title:t.data.msg,icon:"none"}),0)),fail:t=>{console.log(t),a({title:"网络请求失败",icon:"none"})}}),0):(a({title:"请先登录",icon:"none"}),0)}function h(t){e("userInfo",t),u.userInfo=t,u.isLogin=!0}function m(){s("userInfo"),u.userInfo={},u.isLogin=!1}function p(t,n="请求失败"){console.error(t),a({title:n,icon:"none"})}export{d as a,l as b,r as c,u as g,c as i,f as v,i as w};
