import{r as a,o as e,a2 as s,a as t,c as l,w as r,q as i,j as o,at as u,g as d,b as c,d as n,e as m,t as f,f as v,h as _,i as g,S as p}from"./index-BFzTDSoz.js";import{c as h,w,_ as y}from"./view-logs.yEAac7W9.js";import{_ as j,r as x}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as k}from"./uni-load-more.DTS_b-uf.js";import{_ as z}from"./uni-icons.COaeasi-.js";const C=j({__name:"message_info",props:["message_id"],setup(j){const C=j,D=a(null),b=a(!0),A=a(""),I=a(""),S=async()=>{try{if(b.value=!0,A.value="",!I.value)return void(A.value="无效的消息ID");if(!(await h()))return void(A.value="请先登录");const a=await i({url:`${w}/with-state/message-detail`,method:"GET",data:{id:I.value},header:{Authorization:o("token")}});"success"===a.data.status?(D.value=a.data.data,u("message-status-update",{id:I.value,is_read:1})):A.value=a.data.msg||"获取详情失败"}catch(a){A.value="请求失败，请检查网络",console.error("详情请求失败:",a)}finally{b.value=!1}};return e((()=>{s({title:"消息详情"}),I.value=C.message_id,S()})),(a,e)=>{const s=x(t("view-logs"),y),i=x(t("uni-load-more"),k),o=d,u=x(t("uni-icons"),z),h=v,w=_,j=g,C=p;return c(),l(o,{class:"container"},{default:r((()=>[n(s),b.value?(c(),l(o,{key:0,class:"loading-wrapper"},{default:r((()=>[n(i,{status:"loading"})])),_:1})):A.value?(c(),l(o,{key:1,class:"error-wrapper"},{default:r((()=>[n(u,{type:"info",size:"24",color:"#ff4d4f"}),n(h,{class:"error-text"},{default:r((()=>[m(f(A.value),1)])),_:1}),n(w,{class:"retry-btn",onClick:S},{default:r((()=>[m("重试")])),_:1})])),_:1})):(c(),l(C,{key:2,class:"content-wrapper","scroll-y":""},{default:r((()=>[n(j,{class:"cover-image",src:D.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),n(o,{class:"main-content"},{default:r((()=>[n(o,{class:"header"},{default:r((()=>[n(h,{class:"title"},{default:r((()=>[m(f(D.value.title),1)])),_:1}),n(h,{class:"time"},{default:r((()=>{return[m(f((a=D.value.created_at,new Date(1e3*a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1})])),_:1}),n(o,{class:"message-content"},{default:r((()=>[n(h,{class:"message-text"},{default:r((()=>[m(f(D.value.msg),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-5d40fc3c"]]);export{C as default};
