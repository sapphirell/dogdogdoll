import{h as e,g as t,s as a,j as l,u as s,c as o,w as n,v as i,l as d,m as r,p as c,C as u,f as _,o as g,k as f,a as m,b as p,t as y,U as h,d as x,r as b,F as k,N as v,n as w,e as S,i as C,y as I,S as z,q as j,V as F,B as L,D as $}from"./index-CAhh9jg-.js";import{_ as T}from"./uni-icons.DApveqxl.js";import{r as M}from"./uni-app.es.CI_TJZj7.js";import{_ as R,a as D}from"./comment-input.Koi9PTNE.js";import{_ as A}from"./right2.s_X9TKoF.js";import{b as G,w as O,a as P}from"./config.D_tpLRWx.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=q({__name:"goods",props:["goods_id"],setup(q){const B=q;e();const E=t(null),N=t(null);t(1);let U=t({}),H=t({}),K=t(1),V=t(!1),W=t(!1);const Y=t(400),J=t([]),Q=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let l=e;null!=t&&(l=t),U.value.id!=l.id?(console.log("item",l),U.value=l,null==(a=N.value)||a.focusInput()):U.value={}},X=({content:e,replyInfo:t,origin:a})=>{let l=u("token");if(!P.isLogin)return void r({title:"请先登录",icon:"none"});console.log("reply_info",t);const s={content:e,origin:a,target_id:parseInt(pageId.value),type:2,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};d({url:O+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:e=>{var t,a;if("success"==e.data.status){const l=e.data.data;0===l.parent_id?null==(t=E.value)||t.addNewComment(l):null==(a=E.value)||a.addReplyComment(l),r({title:"评论成功",icon:"success"})}else r({title:e.data.msg,icon:"none"})},fail:e=>{r({title:"网络请求失败",icon:"none"})}})};function Z(e){console.log(e.detail.current),K.value=e.detail.current+1}function ee(){d({url:O+"/goods?id="+B.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),H.value=e.data.data},fail:e=>{console.log(e),r({title:"网络请求失败",icon:"none"})},complete:()=>{c()}})}function te(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}function ae(e){const t=new Date(1e3*e),a=t.getFullYear(),l=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${l}-${s} ${o}:${n}`}function le(){let e=u("token");""!=e&&d({url:O+"/with-state/hasLike?id="+B.goods_id+"&type=1",method:"POST",header:{Authorization:e},success:e=>{console.log(e.data),"success"==e.data.status?e.data.data.id>0?V.value=!0:V.value=!1:r({title:e.data.msg,icon:"none"})},fail:e=>{console.log(e),r({title:"网络请求失败",icon:"none"})}})}function se(){w({url:"/pages/collocation/collocation?goods_id="+B.goods_id+"&brand_id="+H.value.brand_id+"&goods_name="+H.value.name+"&brand_name="+H.value.brand_name+"&type="+H.value.type})}function oe(e){if(!e)return"";return e.split(",")[0].trim()}return a({title:"加载中"}),ee(),d({url:O+"/goods-collocation?goods_id="+B.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),W.value=e.data.data},fail:e=>{console.log(e),r({title:"网络请求失败",icon:"none"})}}),G().then((e=>{console.log(e),le()})),(e,t)=>{const a=M(l("uni-icons"),T),c=S,G=_,q=C,ne=$,ie=I,de=z,re=M(l("comment-list"),R),ce=M(l("comment-input"),D);return s(H).name?(g(),o(G,{key:0},{default:n((()=>[f("meta",{name:"theme-color",content:"#F8F8F8"}),m(G,null,{default:n((()=>[m(G,{style:{position:"relative"}},{default:n((()=>[m(G,{class:"heart",onClick:t[0]||(t[0]=e=>function(){let e=u("token");if(!P.isLogin)return void r({title:"请先登录",icon:"none"});let t={id:parseInt(B.goods_id),type:1},a=V.value?"/with-state/unlike":"/with-state/add-like";d({url:O+a,method:"POST",header:{Authorization:e},data:t,success:e=>(console.log(e.data),"success"==e.data.status?(r({title:"操作成功",icon:"success"}),V.value=!V.value,le(),void ee()):void r({title:e.data.msg,icon:"none"})),fail:e=>{console.log(e),r({title:"网络请求失败",icon:"none"})}})}())},{default:n((()=>[s(V)?(g(),o(a,{key:1,type:"heart-filled",size:"28",color:"#ff4d4f"})):(g(),o(a,{key:0,type:"heart",size:"28",color:"#ff4d4f"})),m(c,{class:"num",style:{color:"#ff4d4f"}},{default:n((()=>[p(y(te(s(H).goods_like_count)),1)])),_:1})])),_:1}),m(ie,{interval:3e3,duration:200,onChange:Z,class:"banner_swiper",style:h([{"max-height":"800px"},{height:Y.value+"px"}])},{default:n((()=>[(g(!0),x(k,null,b(s(H).goods_images,((e,t)=>(g(),o(ne,{key:t,class:"banner_swiper_item"},{default:n((()=>[m(G,{class:"swiper-item"},{default:n((()=>[m(q,{src:e,mode:"widthFix",style:{width:"100%",display:"block"},class:j("swiper-image-"+t),onClick:e=>{L({current:H.value.goods_images.index,urls:H.value.goods_images})},onLoad:e=>function(e){console.log("图片加载完成",e);const t=F();setTimeout((()=>{t.select(`.swiper-image-${e}`).boundingClientRect((t=>{try{if(!t)return void console.warn("未找到图片元素");console.log(t),J.value[e]=t.height;const a=J.value.filter((e=>e>0));if(0===a.length)return;Y.value=Math.max(...a)}catch(a){console.error("高度计算异常:",a)}})).exec()}),20)}(t)},null,8,["src","class","onClick","onLoad"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["style"]),m(G,{class:"swiper-index-box"},{default:n((()=>[m(c,{class:"font-alimamashuhei"},{default:n((()=>[p(y(s(K))+" / "+y(s(H).goods_images.length),1)])),_:1})])),_:1})])),_:1})])),_:1}),m(G,{class:"msg_body"},{default:n((()=>[m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("名称")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).name),1)])),_:1})])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("类型")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).type),1)])),_:1})])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("初贩定价")])),_:1}),s(H).total_amount?(g(),o(c,{key:0,class:"msg_text"},{default:n((()=>[p(y(s(H).total_amount+" "+s(H).currency),1)])),_:1})):s(H).goods_sales&&s(H).goods_sales.length>0?(g(),o(c,{key:1,class:"msg_text"},{default:n((()=>[p(y(s(H).goods_sales[0].sub_amount+s(H).goods_sales[0].fin_amount)+" "+y(s(H).goods_sales[0].currency),1)])),_:1})):(g(),o(c,{key:2},{default:n((()=>[p("未知")])),_:1}))])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("初贩时间")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).sub_time1>0?ae(s(H).sub_time1):"未知"),1)])),_:1})])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("尺寸")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).size)+" / "+y(s(H).size_detail),1)])),_:1})])),_:1}),"单体"===s(H).type||"整体"===s(H).type||"单头"===s(H).type?(g(),o(G,{key:0,class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("可选体型")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).body_size||"未知"),1)])),_:1})])),_:1})):i("",!0),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("可选颜色")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).skin),1)])),_:1})])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("贩售情报")])),_:1}),null==s(H).goods_sales?(g(),o(c,{key:0},{default:n((()=>[p("暂无收录贩售详细信息")])),_:1})):i("",!0),m(G,{class:"msg_text"},{default:n((()=>[(g(!0),x(k,null,b(s(H).goods_sales,(e=>(g(),o(c,{key:e.id,style:{width:"100%",display:"block","margin-bottom":"10px"}},{default:n((()=>[p(y(ae(e.sub_time))+", "+y(e.sale_type)+", 总价: "+y(e.sub_amount+e.fin_amount)+" ("+y(e.currency)+") ",1)])),_:2},1024)))),128))])),_:1})])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("制作方")])),_:1}),m(c,{class:"msg_text",style:{color:"#55aae5"},onClick:t[1]||(t[1]=e=>{return t=s(H).brand_id,void w({url:"/pages/brand/brand?brand_id="+t});var t})},{default:n((()=>[p(y(s(H).brand_name),1)])),_:1})])),_:1}),m(G,{class:"msg_block"},{default:n((()=>[m(c,{class:"lable_text"},{default:n((()=>[p("备注")])),_:1}),m(c,{class:"msg_text"},{default:n((()=>[p(y(s(H).desc_content),1)])),_:1})])),_:1})])),_:1}),m(G,{style:{padding:"40rpx"}},{default:n((()=>[m(G,{style:{display:"flex",margin:"30px 5px 10px 5px"}},{default:n((()=>[m(c,{style:{color:"rgb(100, 198, 220)","font-weight":"bold",display:"block",width:"calc(100% - 130rpx)"}},{default:n((()=>[p("搭配参考")])),_:1}),m(G,{style:{display:"flex"}},{default:n((()=>[m(c,{style:{width:"110rpx",display:"inline-block",color:"#888"}},{default:n((()=>[p("查看更多")])),_:1}),m(q,{src:A,style:{width:"30rpx",height:"30rpx",display:"inline-block",position:"relative",top:"3rpx"}})])),_:1})])),_:1}),m(de,{"scroll-x":"true",class:"collocationBox","ll-with-animation":"true","show-scrollbar":!1},{default:n((()=>[s(W)&&s(W).collocation_relation_list.length>0?(g(!0),x(k,{key:0},b(s(W).collocation_relation_list,(e=>(g(),o(G,{key:e.collocation_id,style:{},class:"collocationItem square",onClick:t=>{return a=e.collocation_id,l=e.relation_origin,void w({url:"/pages/collocation_share/collocation_share?collocation_id="+a+"&origin="+l});var a,l}},{default:n((()=>[m(q,{src:oe(e.image_urls),mode:"aspectFill",style:{width:"100%",height:"100%"}},null,8,["src"])])),_:2},1032,["onClick"])))),128)):i("",!0)])),_:1}),m(G,{onClick:se,style:{border:"1px solid #eaeaea",display:"flex",margin:"20rpx auto","border-radius":"15rpx",width:"400rpx"}},{default:n((()=>[m(q,{src:"/assets/paper_plane-DW2p-K8L.png",style:{width:"45rpx",height:"45rpx",margin:"18rpx"}}),m(c,{style:{color:"rgb(184 184 184)",margin:"12px auto"}},{default:n((()=>[p("上传搭配参考帮助他人")])),_:1})])),_:1})])),_:1}),m(G,{style:{padding:"10px"}},{default:n((()=>[m(re,{ref_key:"commentListRef",ref:E,type:2,"relation-id":parseInt(B.goods_id),onReply:Q},null,8,["relation-id"])])),_:1}),e.loading?(g(),o(G,{key:0,class:"loading"},{default:n((()=>[p("加载中...")])),_:1})):i("",!0),e.error?(g(),o(G,{key:1,class:"error"},{default:n((()=>[p(y(e.errorMsg),1)])),_:1})):i("",!0),m(ce,{ref_key:"commentInputRef",ref:N,"reply-info":s(U),"target-id":B.goods_id,onSubmit:X,"onUpdate:replyInfo":t[2]||(t[2]=e=>v(U)?U.value=e:U=e)},null,8,["reply-info","target-id"]),m(G,{style:{height:"80px"}})])),_:1})):i("",!0)}}},[["__scopeId","data-v-873a151a"]]);export{B as default};
