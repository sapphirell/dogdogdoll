import{a1 as e,a as t,b as a,c as s,w as l,d as i,v as o,F as n,x as r,D as d,a0 as u,H as c,g as h,r as g,_ as m,l as _,q as p,A as f,a2 as v,$ as y,j as b,B as w,C as S,e as x,t as C,T as k,i as I,f as z,h as R,p as $,J as M,n as T,a3 as N,E as P,G as F}from"./index-BFzTDSoz.js";import{a as L,b as j,w as B,_ as A}from"./view-logs.yEAac7W9.js";import{_ as V,r as D,c as E}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as O}from"./uni-icons.COaeasi-.js";import{_ as X,a as G}from"./comment-input.B__ry1x5.js";import"./common-modal.DWKlFhUY.js";const W=V({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),s=Math.ceil(e);for(let l=0;l<this.max;l++)a>l?t.push({activeWitch:"100%"}):s-1===l?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let s=0;s<t.length-1;s++)if(e.indexOf(t[s])>0){a=!1;break}return a},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let s=parseInt(a/(t+this.marginNumber));s=s<0?0:s,s=s>this.max?this.max:s;const l=parseInt(a-(t+this.marginNumber)*s);let i=0;(this._oldValue!==s||this.PC)&&(this._oldValue=s,i=this.allowHalf?l>t/2?s+1:s+.5:s+1,i=Math.max(.5,Math.min(i,this.max)),this.valueSync=i,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(e,g,m,_,p,f){const v=D(t("uni-icons"),O),y=h;return a(),s(y,null,{default:l((()=>[i(y,{ref:"uni-rate",class:"uni-rate"},{default:l((()=>[(a(!0),o(n,null,r(f.stars,((e,t)=>(a(),s(y,{class:d(["uni-rate__icon",{"uni-cursor-not-allowed":m.disabled}]),style:u({"margin-right":f.marginNumber+"px"}),key:t,onTouchstart:c(f.touchstart,["stop"]),onTouchmove:c(f.touchmove,["stop"]),onMousedown:c(f.mousedown,["stop"]),onMousemove:c(f.mousemove,["stop"]),onMouseleave:f.mouseleave},{default:l((()=>[i(v,{color:m.color,size:m.size,type:m.isFill?"star-filled":"star"},null,8,["color","size","type"]),i(y,{style:u({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:l((()=>[i(v,{color:m.disabled?m.disabledColor:m.activeColor,size:m.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]),H=V({__name:"brand",props:["brand_id"],setup(e){const d=e;console.log(d);const c=g(!1);let V=g([]),O=g({page_index:1,page_size:3,total:0});m({title:"加载中"}),_();let H=g(0);const U=g(0),q=g(null),J=g(null);g(1);let K=g({});const Y=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let s=e;null!=t&&(s=t),K.value.id!=s.id?(console.log("item",s),K.value=s,null==(a=J.value)||a.focusInput()):K.value={}},Q=({content:e,replyInfo:t,origin:a})=>{let s=b("token");if(!j.isLogin)return void f({title:"请先登录",icon:"none"});console.log("reply_info",t);const l={content:e,origin:a,target_id:parseInt(d.brand_id),type:1,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};p({url:B+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:l,success:e=>{var t,a;if("success"==e.data.status){const s=e.data.data;0===s.parent_id?null==(t=q.value)||t.addNewComment(s):null==(a=q.value)||a.addReplyComment(s),f({title:"评论成功",icon:"success"})}else f({title:e.data.msg,icon:"none"})},fail:e=>{f({title:"网络请求失败",icon:"none"})}})},Z=e=>{if(console.log(e),!j.isLogin)return f({title:"请先登录",icon:"none"}),void(H.value=0);H.value=e.value,U.value=e.value,async function(){if(0==H.value)return void f({title:"请先评分",icon:"none"});try{let e=b("token");if(!e)return void f({title:"请先登录",icon:"none"});m({title:"提交中..."});const t=await p({url:B+"/with-state/add-vote-score",method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:{type:1,score:H.value,target_id:parseInt(d.brand_id)}});y(),"success"===t.data.status?(ee(),f({title:"评分成功",icon:"success"})):f({title:t.data.msg||"评分失败",icon:"none"})}catch(e){y(),console.error("评分失败:",e),f({title:"评分失败，请重试",icon:"none"})}}()};function ee(){p({url:B+"/brand-info?id="+d.brand_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),ne.value=e.data.data,v({title:e.data.data.brand_name}),ae()},fail:e=>{console.log(e),f({title:"网络请求失败",icon:"none"})},complete:()=>{y()}})}const te=async()=>{let e=b("token");if(j.isLogin)try{const t=`${B}/with-state/${c.value?"unlike":"add-like"}`,a=await p({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(d.brand_id),type:2}});"success"===a.data.status?(c.value=!c.value,f({title:c.value?"关注成功":"已取消关注",icon:"none"}),ee()):f({title:a.data.msg,icon:"none"})}catch(t){console.error(t),f({title:"操作失败",icon:"none"})}else f({title:"请先登录",icon:"none"})},ae=async()=>{var e;try{const t=await p({url:`${B}/with-state/hasLike?id=${parseInt(d.brand_id)}&type=2`,method:"POST",header:{Authorization:b("token")}});c.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(t){console.error("获取关注状态失败:",t)}};function se(e){const t=new Date(1e3*e),a=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),l=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${s}-${l} ${i}:${o}`}function le(){p({url:B+"/brand-goods?brand_id="+d.brand_id+"&page="+oe.value,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),ie.value.page_index=e.data.data.page_index,ie.value.total=e.data.data.total,ie.value.goods_list=ie.value.goods_list?ie.value.goods_list.concat(e.data.data.goods_list):e.data.data.goods_list,e.data.data.goods_list.length>0&&(oe.value+=1),0==e.data.data.goods_list.length&&oe.value>1&&f({title:"没有更多数据了",icon:"none"})},fail:e=>{console.log(e),f({title:"网络请求失败",icon:"none"})}})}let ie=g({}),oe=g(1),ne=g({});return E((()=>{L(),ee(),le(),p({url:`${B}/brand-news-list?brand_id=${d.brand_id}&page=${O.value.page_index}&page_size=${O.value.page_size}`,method:"GET",success:e=>{if("success"===e.data.status){const t=e.data.data;V.value=[...V.value,...t.news_list],O.value.total=t.total,t.news_list.length>0&&(O.value.page_index+=1)}else f({title:e.data.msg||"获取图透失败",icon:"none"})},fail:e=>{f({title:"网络请求失败",icon:"none"})}}),j.isLogin?function(e,t){let a=b("token");a&&j.isLogin&&p({url:B+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(t),type:e},success:e=>(console.log(e.data.data),"success"==e.data.status?(U.value=e.data.data.score,e.data.data.score):(f({title:e.data.msg,icon:"none"}),0)),fail:e=>(console.log(e),f({title:"网络请求失败",icon:"none"}),0)})}(1,d.brand_id):H.value=0})),(e,g)=>{const m=D(t("view-logs"),A),_=I,p=z,f=h,v=D(t("uni-rate"),W),y=N,b=R,L=P,j=F,B=D(t("comment-list"),X),E=D(t("comment-input"),G);return a(),s(f,null,{default:l((()=>[w("meta",{name:"theme-color",content:"#F8F8F8"}),i(m),i(_,{src:S(ne).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),i(f,{class:"body"},{default:l((()=>[i(f,null,{default:l((()=>[i(_,{src:S(ne).brand_name_image,mode:"heightFix",style:{height:"60rpx"}},null,8,["src"]),i(p,{style:{float:"right",margin:"5px 0px"}},{default:l((()=>[x(C(S(ne).country_name)+" / "+C(S(ne).type),1)])),_:1}),i(f,{style:{clear:"both"}})])),_:1}),i(f,{style:{margin:"20rpx 0rpx",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},{default:l((()=>[i(f,{style:{display:"flex","align-items":"center","flex-grow":"1"}},{default:l((()=>[i(v,{style:{"margin-top":"5px"},value:S(ne).score,"allow-half":"true",activeColor:"#65C3D6",onChange:Z,"is-fill":"false"},null,8,["value"]),i(p,{style:{"margin-left":"8rpx",position:"relative",top:"5px"}},{default:l((()=>[x(C(S(ne).score)+"（"+C(S(ne).vote_number)+"次评分) ",1)])),_:1})])),_:1}),i(p,{class:"follow",onClick:te,style:u({background:c.value?"#ff6a6c":"#65C3D6"})},{default:l((()=>[x(C(c.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),i(f,{style:{"margin-top":"15px"}},{default:l((()=>[i(p,null,{default:l((()=>[x("别名："+C(S(ne).nickname_list),1)])),_:1})])),_:1}),i(f,{style:{"margin-top":"10px"}},{default:l((()=>[i(p,null,{default:l((()=>[x("简介："+C(S(ne).description),1)])),_:1})])),_:1}),w("div",{style:{clear:"both"}}),i(p,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:l((()=>[x("收录作品 ("+C(S(ie).total)+")",1)])),_:1}),i(f,{class:"brand_goods"},{default:l((()=>[(a(!0),o(n,null,r(S(ie).goods_list,((e,t)=>(a(),s(f,{class:"brand_goods_item",style:{},key:e.id},{default:l((()=>[i(y,{onClick:t=>{return a=e.id,void T({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},{default:l((()=>[i(f,{style:{width:"100%",height:"calc(100% - 20px)"}},{default:l((()=>[i(_,{style:{width:"100%",height:"100%"},src:e.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])])),_:2},1024),i(p,{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},{default:l((()=>[x(C(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),i(b,{class:"load_more",onClick:le},{default:l((()=>[x("加载更多")])),_:1}),i(p,{class:"section-title"},{default:l((()=>[x("品牌图透 ("+C(S(O).total)+")",1)])),_:1}),i(f,{class:"news-list"},{default:l((()=>[(a(!0),o(n,null,r(S(V),((e,t)=>(a(),s(f,{class:"news-item",style:{position:"relative"},key:e.id},{default:l((()=>[i(f,{class:"news-header"},{default:l((()=>[i(p,{class:"news-header-title"},{default:l((()=>[x(C(e.title),1)])),_:2},1024)])),_:2},1024),e.image_list&&e.image_list.length>0?(a(),s(f,{key:0,class:"news-images"},{default:l((()=>[i(j,{class:"image-swiper",autoplay:!0,circular:!0,"indicator-dots":""},{default:l((()=>[(a(!0),o(n,null,r(e.image_list,((t,o)=>(a(),s(L,{key:o},{default:l((()=>[i(_,{src:t,mode:"aspectFill",class:"swiper-image",onClick:a=>{return s=t,l=e.image_list,void M({current:s,urls:l});var s,l}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):$("",!0),i(f,{class:"news-content"},{default:l((()=>[x(C(e.content),1)])),_:2},1024),i(f,{class:"news-footer"},{default:l((()=>[i(p,{class:"news-time"},{default:l((()=>[x(C(se(e.created_at)),1)])),_:2},1024),i(p,{class:"view-more",onClick:t=>function(e){T({url:`/pages/sale_news/sale_news?id=${e.id}&brand_id=${e.brand_id}`})}(e)},{default:l((()=>[x("查看详情 →")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(f,null,{default:l((()=>[i(B,{ref_key:"commentListRef",ref:q,type:1,"relation-id":parseInt(d.brand_id),onReply:Y},null,8,["relation-id"])])),_:1})])),_:1}),i(f,{style:{height:"80px"}}),i(E,{ref_key:"commentInputRef",ref:J,"reply-info":S(K),"target-id":d.brand_id,onSubmit:Q,"onUpdate:replyInfo":g[0]||(g[0]=e=>k(K)?K.value=e:K=e)},null,8,["reply-info","target-id"])])),_:1})}}},[["__scopeId","data-v-bde941eb"]]);export{H as default};
