import{r as a,o as e,a3 as s,a as t,c as l,w as r,q as i,j as o,at as u,g as d,b as c,d as n,e as m,t as f,f as v,h as _,i as g,S as p}from"./index-I3aG4WZL.js";import{_ as h}from"./view-logs.C4HVuFxK.js";import{_ as w,r as y}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{_ as j}from"./uni-load-more.C4hxbgUE.js";import{_ as x}from"./uni-icons.BQtdpjJ2.js";import{c as k,w as z}from"./config.BjeWXQ7P.js";const D=w({__name:"message_info",props:["message_id"],setup(w){const D=w,C=a(null),S=a(!0),b=a(""),E=a(""),G=async()=>{try{if(S.value=!0,b.value="",!E.value)return void(b.value="无效的消息ID");if(!(await k()))return void(b.value="请先登录");const a=await i({url:`${z}/with-state/message-detail`,method:"GET",data:{id:E.value},header:{Authorization:o("token")}});"success"===a.data.status?(C.value=a.data.data,u("message-status-update",{id:E.value,is_read:1})):b.value=a.data.msg||"获取详情失败"}catch(a){b.value="请求失败，请检查网络",console.error("详情请求失败:",a)}finally{S.value=!1}};return e((()=>{s({title:"消息详情"}),E.value=D.message_id,G()})),(a,e)=>{const s=y(t("view-logs"),h),i=y(t("uni-load-more"),j),o=d,u=y(t("uni-icons"),x),w=v,k=_,z=g,D=p;return c(),l(o,{class:"container"},{default:r((()=>[n(s),S.value?(c(),l(o,{key:0,class:"loading-wrapper"},{default:r((()=>[n(i,{status:"loading"})])),_:1})):b.value?(c(),l(o,{key:1,class:"error-wrapper"},{default:r((()=>[n(u,{type:"info",size:"24",color:"#ff4d4f"}),n(w,{class:"error-text"},{default:r((()=>[m(f(b.value),1)])),_:1}),n(k,{class:"retry-btn",onClick:G},{default:r((()=>[m("重试")])),_:1})])),_:1})):(c(),l(D,{key:2,class:"content-wrapper","scroll-y":""},{default:r((()=>[n(z,{class:"cover-image",src:C.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),n(o,{class:"main-content"},{default:r((()=>[n(o,{class:"header"},{default:r((()=>[n(w,{class:"title"},{default:r((()=>[m(f(C.value.title),1)])),_:1}),n(w,{class:"time"},{default:r((()=>{return[m(f((a=C.value.created_at,new Date(1e3*a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1})])),_:1}),n(o,{class:"message-content"},{default:r((()=>[n(w,{class:"message-text"},{default:r((()=>[m(f(C.value.msg),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-5d40fc3c"]]);export{D as default};
