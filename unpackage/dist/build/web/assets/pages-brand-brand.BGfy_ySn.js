import{Z as e,m as t,o as a,c as s,w as l,a as i,d as o,F as n,r,x as d,Y as u,D as c,f as h,g,q as m,h as p,l as _,k as f,_ as y,v,H as b,p as w,y as S,b as x,t as C,R as k,i as z,e as I,K as R,z as $,G as M,n as L,$ as N,B as P,C as T}from"./index-B55GPRQF.js";import{_ as F}from"./uni-icons.B2Wm8RW1.js";import{r as B,c as V}from"./uni-app.es.CzHle-z4.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as A,a as D}from"./comment-input.BEXNcG5_.js";import{a as E,w as G}from"./config.BIUptOrH.js";const O=j({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),s=Math.ceil(e);for(let l=0;l<this.max;l++)a>l?t.push({activeWitch:"100%"}):s-1===l?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let s=0;s<t.length-1;s++)if(e.indexOf(t[s])>0){a=!1;break}return a},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let s=parseInt(a/(t+this.marginNumber));s=s<0?0:s,s=s>this.max?this.max:s;const l=parseInt(a-(t+this.marginNumber)*s);let i=0;(this._oldValue!==s||this.PC)&&(this._oldValue=s,i=this.allowHalf?l>t/2?s+1:s+.5:s+1,i=Math.max(.5,Math.min(i,this.max)),this.valueSync=i,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(e,g,m,p,_,f){const y=B(t("uni-icons"),F),v=h;return a(),s(v,null,{default:l((()=>[i(v,{ref:"uni-rate",class:"uni-rate"},{default:l((()=>[(a(!0),o(n,null,r(f.stars,((e,t)=>(a(),s(v,{class:d(["uni-rate__icon",{"uni-cursor-not-allowed":m.disabled}]),style:u({"margin-right":f.marginNumber+"px"}),key:t,onTouchstart:c(f.touchstart,["stop"]),onTouchmove:c(f.touchmove,["stop"]),onMousedown:c(f.mousedown,["stop"]),onMousemove:c(f.mousemove,["stop"]),onMouseleave:f.mouseleave},{default:l((()=>[i(y,{color:m.color,size:m.size,type:m.isFill?"star-filled":"star"},null,8,["color","size","type"]),i(v,{style:u({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:l((()=>[i(y,{color:m.disabled?m.disabledColor:m.activeColor,size:m.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]),X=j({__name:"brand",props:["brand_id"],setup(e){const d=e;console.log(d);const c=g(!1);let F=g([]),j=g({page_index:1,page_size:3,total:0});m({title:"加载中"}),p();let X=g(0);const W=g(null),H=g(null);g(1);let U=g({});const Y=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let s=e;null!=t&&(s=t),U.value.id!=s.id?(console.log("item",s),U.value=s,null==(a=H.value)||a.focusInput()):U.value={}},q=({content:e,replyInfo:t,origin:a})=>{let s=b("token");if(!E.isLogin)return void f({title:"请先登录",icon:"none"});console.log("reply_info",t);const l={content:e,origin:a,target_id:parseInt(d.brand_id),type:1,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};_({url:G+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:l,success:e=>{var t,a;if("success"==e.data.status){const s=e.data.data;0===s.parent_id?null==(t=W.value)||t.addNewComment(s):null==(a=W.value)||a.addReplyComment(s),f({title:"评论成功",icon:"success"})}else f({title:e.data.msg,icon:"none"})},fail:e=>{f({title:"网络请求失败",icon:"none"})}})},K=e=>{if(!E.isLogin)return f({title:"请先登录",icon:"none"}),void(X.value=0);!async function(){if(0==X.value)return void f({title:"请先评分",icon:"none"});try{let e=b("token");if(!e)return void f({title:"请先登录",icon:"none"});m({title:"提交中..."});const t=await _({url:G+"/with-state/add-vote-score",method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:{type:1,score:X.value,target_id:parseInt(d.brand_id)}});v(),"success"===t.data.status?(Z(),f({title:"评分成功",icon:"success"})):f({title:t.data.msg||"评分失败",icon:"none"})}catch(e){v(),console.error("评分失败:",e),f({title:"评分失败，请重试",icon:"none"})}}()};function Z(){_({url:G+"/brand-info?id="+d.brand_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),le.value=e.data.data,y({title:e.data.data.brand_name}),Q()},fail:e=>{console.log(e),f({title:"网络请求失败",icon:"none"})},complete:()=>{v()}})}const J=async()=>{let e=b("token");if(E.isLogin)try{const t=`${G}/with-state/${c.value?"unlike":"add-like"}`,a=await _({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(d.brand_id),type:2}});"success"===a.data.status?(c.value=!c.value,f({title:c.value?"关注成功":"已取消关注",icon:"none"}),Z()):f({title:a.data.msg,icon:"none"})}catch(t){console.error(t),f({title:"操作失败",icon:"none"})}else f({title:"请先登录",icon:"none"})},Q=async()=>{var e;try{const t=await _({url:`${G}/with-state/hasLike?id=${parseInt(d.brand_id)}&type=2`,method:"POST",header:{Authorization:b("token")}});c.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(t){console.error("获取关注状态失败:",t)}};function ee(e){const t=new Date(1e3*e),a=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),l=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${s}-${l} ${i}:${o}`}function te(){_({url:G+"/brand-goods?brand_id="+d.brand_id+"&page="+se.value,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),ae.value.page_index=e.data.data.page_index,ae.value.total=e.data.data.total,ae.value.goods_list=ae.value.goods_list?ae.value.goods_list.concat(e.data.data.goods_list):e.data.data.goods_list,e.data.data.goods_list.length>0&&(se.value+=1),0==e.data.data.goods_list.length&&se.value>1&&f({title:"没有更多数据了",icon:"none"})},fail:e=>{console.log(e),f({title:"网络请求失败",icon:"none"})}})}let ae=g({}),se=g(1),le=g({});return V((()=>{Z(),te(),_({url:`${G}/brand-news-list?brand_id=${d.brand_id}&page=${j.value.page_index}&page_size=${j.value.page_size}`,method:"GET",success:e=>{if("success"===e.data.status){const t=e.data.data;F.value=[...F.value,...t.news_list],j.value.total=t.total,t.news_list.length>0&&(j.value.page_index+=1)}else f({title:e.data.msg||"获取图透失败",icon:"none"})},fail:e=>{f({title:"网络请求失败",icon:"none"})}}),E.isLogin?function(e,t){let a=b("token");a&&E.isLogin&&_({url:G+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(t),type:e},success:e=>(console.log(e.data.data),"success"==e.data.status?(X.value=e.data.data.score,e.data.data.score):(f({title:e.data.msg,icon:"none"}),0)),fail:e=>(console.log(e),f({title:"网络请求失败",icon:"none"}),0)})}(1,d.brand_id):X.value=0})),(e,g)=>{const m=z,p=I,_=h,f=B(t("uni-rate"),O),y=N,v=R,b=P,V=T,G=B(t("comment-list"),A),Z=B(t("comment-input"),D);return a(),s(_,null,{default:l((()=>[w("meta",{name:"theme-color",content:"#F8F8F8"}),i(m,{src:S(le).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),i(_,{class:"body"},{default:l((()=>[i(_,null,{default:l((()=>[i(p,{style:{float:"left","font-size":"20px"},selectable:"true","user-select":"true"},{default:l((()=>[x(C(S(le).brand_name),1)])),_:1}),i(p,{style:{float:"right",margin:"5px 0px"}},{default:l((()=>[x(C(S(le).country_name)+" / "+C(S(le).type),1)])),_:1}),i(_,{style:{clear:"both"}})])),_:1}),i(_,{style:{margin:"20rpx 0rpx",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},{default:l((()=>[i(_,{style:{display:"flex","align-items":"center","flex-grow":"1"}},{default:l((()=>[i(f,{style:{"margin-top":"5px"},modelValue:S(X),"onUpdate:modelValue":g[0]||(g[0]=e=>k(X)?X.value=e:X=e),"allow-half":"true",disabled:!S(E).isLogin,color:S(E).isLogin?"#65C3D6":"#FF9DDB",onChange:K},null,8,["modelValue","disabled","color"]),i(p,{style:{"margin-left":"8rpx",position:"relative",top:"5px"}},{default:l((()=>[x(C(S(le).score)+"（"+C(S(le).vote_number)+"次评分） ",1)])),_:1})])),_:1}),i(p,{class:"follow",onClick:J,style:u({background:c.value?"#ff6a6c":"#65C3D6"})},{default:l((()=>[x(C(c.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),i(_,{style:{"margin-top":"15px"}},{default:l((()=>[i(p,null,{default:l((()=>[x("别名："+C(S(le).nickname_list),1)])),_:1})])),_:1}),i(_,{style:{"margin-top":"10px"}},{default:l((()=>[i(p,null,{default:l((()=>[x("简介："+C(S(le).description),1)])),_:1})])),_:1}),w("div",{style:{clear:"both"}}),i(p,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:l((()=>[x("收录作品 ("+C(S(ae).total)+")",1)])),_:1}),i(_,{class:"brand_goods"},{default:l((()=>[(a(!0),o(n,null,r(S(ae).goods_list,((e,t)=>(a(),s(_,{class:"brand_goods_item",style:{},key:e.id},{default:l((()=>[i(y,{onClick:t=>{return a=e.id,void L({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},{default:l((()=>[i(_,{style:{width:"100%",height:"calc(100% - 20px)"}},{default:l((()=>[i(m,{style:{width:"100%",height:"100%"},src:e.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])])),_:2},1024),i(p,{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},{default:l((()=>[x(C(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),i(v,{class:"load_more",onClick:te},{default:l((()=>[x("加载更多")])),_:1}),i(p,{class:"section-title"},{default:l((()=>[x("品牌图透 ("+C(S(j).total)+")",1)])),_:1}),i(_,{class:"news-list"},{default:l((()=>[(a(!0),o(n,null,r(S(F),((e,t)=>(a(),s(_,{class:"news-item",style:{position:"relative"},key:e.id},{default:l((()=>[i(_,{class:"news-header"},{default:l((()=>[i(p,{class:"news-header-title"},{default:l((()=>[x(C(e.title),1)])),_:2},1024)])),_:2},1024),e.image_list&&e.image_list.length>0?(a(),s(_,{key:0,class:"news-images"},{default:l((()=>[i(V,{class:"image-swiper",autoplay:!0,circular:!0,"indicator-dots":""},{default:l((()=>[(a(!0),o(n,null,r(e.image_list,((t,o)=>(a(),s(b,{key:o},{default:l((()=>[i(m,{src:t,mode:"aspectFill",class:"swiper-image",onClick:a=>{return s=t,l=e.image_list,void M({current:s,urls:l});var s,l}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):$("",!0),i(_,{class:"news-content"},{default:l((()=>[x(C(e.content),1)])),_:2},1024),i(_,{class:"news-footer"},{default:l((()=>[i(p,{class:"news-time"},{default:l((()=>[x(C(ee(e.created_at)),1)])),_:2},1024),i(p,{class:"view-more",onClick:t=>function(e){L({url:`/pages/sale_news/sale_news?id=${e.id}&brand_id=${e.brand_id}`})}(e)},{default:l((()=>[x("查看详情 →")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(_,null,{default:l((()=>[i(G,{ref_key:"commentListRef",ref:W,type:1,"relation-id":parseInt(d.brand_id),onReply:Y},null,8,["relation-id"])])),_:1})])),_:1}),i(_,{style:{height:"80px"}}),i(Z,{ref_key:"commentInputRef",ref:H,"reply-info":S(U),"target-id":d.brand_id,onSubmit:q,"onUpdate:replyInfo":g[1]||(g[1]=e=>k(U)?U.value=e:U=e)},null,8,["reply-info","target-id"])])),_:1})}}},[["__scopeId","data-v-b86276c4"]]);export{X as default};
