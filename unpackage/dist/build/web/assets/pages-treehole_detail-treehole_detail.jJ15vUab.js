import{g as t,U as e,$ as a,ac as l,l as o,m as s,j as i,d as n,c as u,w as d,a as r,v as c,u as p,N as m,F as g,C as f,f as v,o as _,b as h,t as y,r as x,q as k,A as w,x as S,n as b,i as $,e as C,H as j,V as z,B as F}from"./index-CfMR_IzQ.js";import{_ as A}from"./uni-icons.sjYK3Gk_.js";import{r as I}from"./uni-app.es.5AkhYBbN.js";import{_ as D}from"./comment-input.qrWYiM_3.js";import{w as M,b as T,a as H}from"./config.BX5UpUDr.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=O({__name:"treehole_detail",props:{id:{type:String,required:!0}},setup(O){t(!0);const P=t(!1),q=t(""),L=t(0),U=t(null),Y=t(!1),B=t({});let E=t(1),G=t({});const J=O;const N=()=>{if(!H.isLogin)return void S({title:"提示",content:"需要登录后才能点赞",success:t=>{t.confirm&&b({url:"/pages/login/login"})}});const t=f("token"),e=M+(Y.value?"/with-state/unlike":"/with-state/add-like");o({url:e,method:"POST",header:{Authorization:t},data:{id:parseInt(J.id),type:5},success:t=>{"success"===t.data.status&&(Y.value=!Y.value,U.value.like_count+=Y.value?1:-1)}})};const V=({content:t,replyInfo:e,origin:a})=>{let l=f("token");if(!l)return void s({title:"请先登录",icon:"none"});const i={content:t,target_id:parseInt(J.id),type:5,origin:a,...e.id&&{reply_id:e.id,reply_for:e.comment,reply_user_id:e.user_id}};o({url:M+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:i,success:t=>{"success"==t.data.status?(s({title:"评论成功",icon:"success"}),E.value=1,B.value={},tt()):s({title:t.data.msg,icon:"none"})},fail:t=>{s({title:"网络请求失败",icon:"none"})}})},W=e((()=>{var t,e;return(null==(e=null==(t=U.value)?void 0:t.images)?void 0:e.slice(0,9))||[]})),K=e((()=>{var t,e;return((null==(e=null==(t=U.value)?void 0:t.images)?void 0:e.length)||0)-9})),Q=e((()=>{var t,e;return((null==(e=null==(t=U.value)?void 0:t.images)?void 0:e.length)||0)>9}));function R(t){const e=new Date(1e3*t),a=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0"),s=e.getHours().toString().padStart(2,"0"),i=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${a}-${l}-${o} ${s}:${i}`}a({title:"投稿详情"});const X=e((()=>{const t=W.value.length;return 1===t?"single":2===t?"double":"multi"})),Z=t=>{const e=new Date(1e3*t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};function tt(){o({url:M+"/treehole-comment?treehole_id="+J.id+"&page="+E.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),B.value.page_index=t.data.data.page_index,B.value.total=t.data.data.total,B.value.comment_list=B.value.comment_list?B.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(E.value+=1),0==t.data.data.comment_list.length&&E.value>1&&s({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),s({title:"网络请求失败",icon:"none"})}})}return l((async()=>{try{const t=await o({url:`${M}/treehole-detail?id=${J.id}`});"success"===t.data.status&&(U.value=t.data.data)}catch(t){console.log(t),s({title:"加载失败",icon:"none"})}tt(),T(),function(){let t=f("token");""!=t&&o({url:M+"/with-state/hasLike?id="+J.id+"&type=5",method:"POST",header:{Authorization:t},success:t=>{console.log(t.data),"success"==t.data.status?t.data.data.id>0?Y.value=!0:Y.value=!1:s({title:t.data.msg,icon:"none"})},fail:t=>{console.log(t),s({title:"网络请求失败",icon:"none"})}})}()})),(t,e)=>{const a=$,l=C,o=v,f=I(i("uni-icons"),A),S=j,b=I(i("comment-input"),D);return _(),n(g,null,[U.value?(_(),u(o,{key:0,class:"container"},{default:d((()=>[r(o,{class:"header"},{default:d((()=>[r(o,{class:"author-info"},{default:d((()=>[r(a,{src:U.value.avatar||"/static/noname.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),r(o,{style:{width:"500rpx"}},{default:d((()=>[r(l,{class:"author-name"},{default:d((()=>[h(y(U.value.author_name),1)])),_:1}),r(o,{class:"time"},{default:d((()=>[h(y(Z(U.value.created_at)),1)])),_:1})])),_:1})])),_:1})])),_:1}),r(o,{class:"content"},{default:d((()=>[h(y(U.value.content),1)])),_:1}),r(o,{class:k(["image-container",X.value])},{default:d((()=>[(_(!0),n(g,null,x(W.value,((t,e)=>(_(),u(o,{key:e,class:"image-wrapper"},{default:d((()=>[r(a,{src:t,mode:"aspectFill",class:"image-item",onClick:t=>(t=>{F({current:t,urls:U.value.images})})(e)},null,8,["src","onClick"]),Q.value&&8===e?(_(),u(o,{key:0,class:"image-overlay"},{default:d((()=>[h(" +"+y(K.value),1)])),_:1})):c("",!0)])),_:2},1024)))),128))])),_:1},8,["class"]),r(o,{class:"action-bar"},{default:d((()=>[r(o,{class:"action-group"},{default:d((()=>[r(o,{class:"action-item",onClick:N},{default:d((()=>[r(f,{type:Y.value?"hand-up-filled":"hand-up",size:"24",color:Y.value?"#ff4d4f":"#666"},null,8,["type","color"]),r(l,{class:"action-text"},{default:d((()=>[h(y(U.value.like_count||0),1)])),_:1})])),_:1}),r(o,{class:"action-item",onClick:e[0]||(e[0]=t=>function(t){let e="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+t.id;w({data:e,success:function(){s({title:"复制链接成功",icon:"none"})}})}(U.value))},{default:d((()=>[r(f,{type:"redo",size:"24",color:"#666"}),r(l,{class:"action-text"},{default:d((()=>[h("分享")])),_:1})])),_:1})])),_:1}),r(l,{class:"time-text"},{default:d((()=>[h("审核于 "+y(Z(U.value.approve_time)),1)])),_:1})])),_:1})])),_:1})):(_(),u(o,{key:1,class:"loading"},{default:d((()=>[h("加载中...")])),_:1})),r(o,{style:{padding:"10px"}},{default:d((()=>[B.value.total?(_(),u(l,{key:0,style:{color:"rgb(100, 198, 220)","font-weight":"bold",isplay:"block",margin:"30px 5px",display:"block"}},{default:d((()=>[h("评论区 ("+y(B.value.total||0)+")",1)])),_:1})):c("",!0),r(o,null,{default:d((()=>[B.value.comment_list?(_(),u(o,{key:0},{default:d((()=>[(_(!0),n(g,null,x(B.value.comment_list,((e,s)=>(_(),u(o,{class:"comment_item",key:e.id,style:{"margin-bottom":"20px"}},{default:d((()=>[r(o,{style:{float:"left",width:"80px",padding:"0px 10px 10px 0px"},onClick:a=>t.jump2user(e.uid)},{default:d((()=>[r(a,{style:{width:"50px",height:"50px","border-radius":"100%",display:"block",margin:"10px"},src:e.avatar,mode:"aspectFill"},null,8,["src"]),r(l,{style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},{default:d((()=>[h(y(e.username),1)])),_:2},1024)])),_:2},1032,["onClick"]),r(o,{style:{float:"left",padding:"15px 15px 30px 15px",background:"rgb(245 245 245)",width:"calc(100vw - 170px)","min-height":"60px","border-radius":"15px",position:"relative",top:"2px"}},{default:d((()=>[r(l,{style:{width:"100%","white-space":"normal","word-break":"break-all"}},{default:d((()=>[h(y(e.comment),1)])),_:2},1024),r(l,{style:{color:"#888","font-size":"12px",position:"absolute",bottom:"3px",left:"15px"}},{default:d((()=>[h(y(R(e.created_at))+" floor#"+y(e.floor),1)])),_:2},1024),r(l,{style:z([{fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"},p(G).id===e.id?{color:"#fd6669"}:{color:"#888"}]),onClick:t=>function(t){G.value.id!=t.id?G.value=t:G.value={}}(e)},{default:d((()=>[h(" 引用此回复 ")])),_:2},1032,["style","onClick"])])),_:2},1024),r(o,{style:{clear:"both"}})])),_:2},1024)))),128))])),_:1})):c("",!0),B.value.total?c("",!0):(_(),u(o,{key:1,style:{"font-size":"12px",color:"#888",margin:"20rpx 10rpx",width:"100%","text-align":"center"}},{default:d((()=>[h("- 暂无回复 - ")])),_:1})),B.value.total?(_(),u(S,{key:2,class:"load_more",onClick:tt},{default:d((()=>[h("加载更多")])),_:1})):c("",!0)])),_:1})])),_:1}),P.value?(_(),u(o,{key:2,class:"error"},{default:d((()=>[h(y(q.value),1)])),_:1})):c("",!0),r(b,{"reply-info":p(G),"target-id":L.value,onSubmit:V,"onUpdate:replyInfo":e[1]||(e[1]=t=>m(G)?G.value=t:G=t)},null,8,["reply-info","target-id"]),r(o,{style:{width:"100%",height:"120rpx"}})],64)}}},[["__scopeId","data-v-2084a46a"]]);export{P as default};
