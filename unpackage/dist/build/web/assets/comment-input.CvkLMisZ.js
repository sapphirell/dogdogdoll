import{r as e,M as a,a as l,b as t,v as o,d as s,w as n,aq as i,e as u,t as c,F as d,x as r,c as p,D as m,a1 as f,A as v,j as _,q as h,f as y,g,aC as k,ar as C,h as b,k as w,H as I,p as T,av as x,o as z,J as j,n as A,i as $,l as F,aD as S,aE as N,Z as q,aF as M}from"./index-I3aG4WZL.js";import{_ as P}from"./uni-icons.BQtdpjJ2.js";import{_ as B,r as V}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{_ as D}from"./common-modal.-arcCNZ3.js";import{w as O,b as E,i as R,g as U}from"./config.BjeWXQ7P.js";import{_ as G}from"./switch-search.B16f2bGk.js";import{g as H,u as J}from"./image.C3pSdXmG.js";const L=B({__name:"report-button",props:{reportType:{type:Number,required:!0},relationId:{type:Number,required:!0},buttonText:{type:String,default:"举报"},iconType:{type:String,default:""},iconSize:{type:String,default:24},iconColor:{type:String,default:"#999"},themeColor:{type:String,default:"#64c6dc"},autoFocus:{type:Boolean,default:!1}},emits:["success","error","cancel","before-submit"],setup(w,{emit:I}){const T=w,x=I,z=e(!1),j=e([]),A=e(""),$=e(""),F=e(!1),S=async()=>{await(async()=>{try{const e=_("token"),a=await h({url:`${O}/report/reasons?type=${T.reportType}`,method:"GET",header:{Authorization:e}});return"success"===a.data.status?(j.value=a.data.data,!0):(v({title:"获取举报原因失败: "+(a.data.msg||""),icon:"none"}),!1)}catch(e){return v({title:"网络请求失败",icon:"none"}),!1}})()&&(A.value="",$.value="",z.value=!0)},N=async()=>{if(!F.value){F.value=!0;try{if(!A.value)return void v({title:"请选择举报原因",icon:"none"});x("before-submit",{type:T.reportType,relationId:T.relationId,reason:A.value,details:$.value});const e=_("token"),a={type:T.reportType,relation_id:T.relationId,reason:A.value,details:$.value};let l=`${O}/with-state/report/submit`;""==e&&(l=`${O}/report/submit`);const t=await h({url:l,method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:a,timeout:1e4});"success"===t.data.status?(v({title:"举报提交成功",icon:"success",duration:2e3}),z.value=!1,x("success",t.data)):(v({title:t.data.msg||"举报提交失败",icon:"none"}),x("error",t.data))}catch(e){v({title:"举报提交失败: "+(e.errMsg||"网络错误"),icon:"none"}),x("error",e)}finally{F.value=!1}}};return a(z,(e=>{e||x("cancel")})),(e,a)=>{const v=V(l("uni-icons"),P),_=y,h=g,I=k,T=C,x=b,F=V(l("common-modal"),D);return t(),o(d,null,[s(h,{class:"report-button",onClick:S},{default:n((()=>[i(e.$slots,"default",{},(()=>[s(h,{class:"default-button horizontal"},{default:n((()=>[s(v,{"v-if":""!==w.iconType,type:w.iconType,size:parseInt(w.iconSize),color:w.iconColor},null,8,["v-if","type","size","color"]),s(_,{class:"button-text"},{default:n((()=>[u(c(w.buttonText),1)])),_:1})])),_:1})]),!0)])),_:3}),s(F,{visible:z.value,"onUpdate:visible":a[3]||(a[3]=e=>z.value=e),top:"10vh"},{default:n((()=>[s(h,{class:"report-dialog"},{default:n((()=>[s(h,{class:"dialog-header"},{default:n((()=>[s(_,{class:"dialog-title"},{default:n((()=>[u("举报内容")])),_:1}),s(v,{type:"closeempty",size:"24",color:"#999",onClick:a[0]||(a[0]=e=>z.value=!1)})])),_:1}),s(h,{class:"reason-list"},{default:n((()=>[(t(!0),o(d,null,r(j.value,(e=>(t(),p(h,{key:e.id,class:m(["reason-item",{selected:A.value===e.label}]),onClick:a=>(e=>{A.value===e?A.value="":A.value=e})(e.label)},{default:n((()=>[s(I,{value:e.label,checked:A.value===e.label,color:w.themeColor},null,8,["value","checked","color"]),s(_,{class:"reason-label"},{default:n((()=>[u(c(e.label),1)])),_:2},1024)])),_:2},1032,["onClick","class"])))),128))])),_:1}),s(h,{class:"details-box"},{default:n((()=>[s(T,{modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value=e),placeholder:"请详细描述举报原因（选填）",class:"details-input",maxlength:"200",focus:w.autoFocus},null,8,["modelValue","focus"]),s(_,{class:"word-count"},{default:n((()=>[u(c($.value.length)+"/200",1)])),_:1})])),_:1}),s(h,{class:"button-group"},{default:n((()=>[s(x,{class:"cancel-btn",onClick:a[2]||(a[2]=e=>z.value=!1)},{default:n((()=>[u("取消")])),_:1}),s(x,{class:"submit-btn",onClick:N,style:f({backgroundColor:w.themeColor})},{default:n((()=>[u("提交举报")])),_:1},8,["style"])])),_:1})])),_:1})])),_:1},8,["visible"])],64)}}},[["__scopeId","data-v-d58f9d15"]]),Z=B({__name:"attitude-widget",props:{targetId:Number,type:Number,attitudeStatus:{type:Number,default:0},attitudeCounts:{type:Object,default:()=>({})}},emits:["change"],setup(i,{emit:f}){const k=i,C=f,b=e(!1),x=e(k.attitudeStatus),z=e({}),j=e([{emoji:"😝",value:1,label:"很有趣"},{emoji:"😨",value:2,label:"这个..."},{emoji:"🤤",value:3,label:"我也想要"},{emoji:"🤦‍♀️",value:4,label:"难以直视"},{emoji:"🔴",value:5,label:"谁的鼻子掉了?"}]);a((()=>k.attitudeCounts),(e=>{j.value.forEach((a=>{z.value[a.value]=Number(e[a.value]??0)})),z.value={...z.value}}),{immediate:!0,deep:!0});const A=w((()=>j.value.map((e=>({...e,count:z.value[e.value]||0}))).filter((e=>e.count>0||e.value===x.value)).filter((e=>e.count>0)))),$=()=>{b.value=!b.value};return(e,a)=>{const i=g,f=y,w=V(l("uni-icons"),P);return t(),p(i,{class:"attitude-container"},{default:n((()=>[b.value?(t(),p(i,{key:0,class:"mask",onClick:I($,["stop"]),onTouchmove:a[0]||(a[0]=I((()=>{}),["stop","prevent"]))})):T("",!0),s(i,{class:"counts-and-expand"},{default:n((()=>[s(i,{class:"global-counts"},{default:n((()=>[(t(!0),o(d,null,r(A.value,(e=>(t(),p(i,{key:e.value,class:m(["count-item",{active:x.value===e.value,"has-count":e.count>0}])},{default:n((()=>[s(f,{class:"emoji"},{default:n((()=>[u(c(e.emoji),1)])),_:2},1024),s(f,{class:"count"},{default:n((()=>[u(c(e.count),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),s(i,{class:"expand-btn",onClick:I($,["stop"])},{default:n((()=>[s(w,{type:b.value?"arrowup":"plus",size:"16",color:"#888"},null,8,["type"]),s(f,{class:"btn-text"},{default:n((()=>[u(c(b.value?"收起":"表态"),1)])),_:1})])),_:1})])),_:1}),b.value?(t(),p(i,{key:1,class:"attitude-panel"},{default:n((()=>[(t(!0),o(d,null,r(j.value,(e=>(t(),p(i,{key:e.value,class:m(["attitude-btn",{active:x.value===e.value}]),onClick:I((a=>(async e=>{try{const a=_("token");if(console.log(a),!a)return void v({title:"请先登录",icon:"none"});const l=x.value===e,t=`${O}/with-state/attitude/${l?"remove":"add"}`;"success"===(await h({url:t,method:"POST",data:{target_id:k.targetId,type:k.type,action_type:e},header:{Authorization:a}})).data.status&&(l?(z.value[e]--,x.value=0):(x.value>0&&z.value[x.value]--,x.value=e,z.value[e]=(z.value[e]||0)+1),C("change",{status:x.value,counts:{...z.value}}),b.value=!1)}catch(a){console.log(a),v({title:"操作失败",icon:"none"})}})(e.value)),["stop"])},{default:n((()=>[s(f,{class:"emoji"},{default:n((()=>[u(c(e.emoji),1)])),_:2},1024),s(i,{class:"text-container"},{default:n((()=>[s(f,{class:"label"},{default:n((()=>[u(c(e.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):T("",!0)])),_:1})}}},[["__scopeId","data-v-8b7e4935"]]),K=B({__name:"comment-list",props:{type:{type:Number,required:!0},relationId:{type:Number,required:!0}},emits:["reply"],setup(a,{expose:i,emit:f}){const k=a,C=e([]),b=e(1),w=e(0),I=e(!0);x({});const F=f,S=e(!1),N=e({}),q=(e,{status:a,counts:l})=>{e.attitudeStatus=a,e.attitudeCounts=l};i({addNewComment:e=>{const a={...e,isTemp:!0,showAll:!1,localChildren:[],childTotal:0};N.value[e.id]=a,C.value.unshift(a)},addReplyComment:e=>{const a=e.parent_id,l=C.value.find((e=>e.id===a));if(l){const a={...e,isTemp:!0};N.value[e.id]=a,l.localChildren||(l.localChildren=[]),"number"!=typeof l.childTotal&&(l.childTotal=0),l.localChildren.unshift(a),l.childTotal+=1,!l.showAll&&l.childTotal<=5&&(l.showAll=!0)}},updateTempComment:(e,a)=>{const l=C.value.findIndex((a=>a.id===e));if(-1!==l)return C.value[l]={...a,showAll:C.value[l].showAll,localChildren:C.value[l].localChildren||[],childTotal:C.value[l].childTotal||0},void delete N.value[e];for(const t of C.value)if(t.localChildren&&t.localChildren.length){const l=t.localChildren.findIndex((a=>a.id===e));if(-1!==l)return t.localChildren[l]={...a,parent_id:t.localChildren[l].parent_id},void delete N.value[e]}},removeTempComment:e=>{const a=C.value.findIndex((a=>a.id===e));if(-1!==a)return C.value.splice(a,1),void delete N.value[e];for(const l of C.value)if(l.localChildren&&l.localChildren.length){const a=l.localChildren.findIndex((a=>a.id===e));if(-1!==a)return l.localChildren.splice(a,1),l.childTotal=Math.max(0,l.childTotal-1),void delete N.value[e]}}}),z((()=>{J()}));const M=e=>!e.showAll&&e.localChildren.length>5?e.localChildren.slice(0,5):e.localChildren,B=async()=>{if(!S.value&&I.value)try{S.value=!0,b.value+=1,await J()}finally{S.value=!1}},D=e=>{j({urls:[e],current:e})},R=async e=>{if(E.isLogin)try{const a=_("token"),l=`${O}/with-state/${e.user_like?"unlike":"add-like"}`,t=await h({url:l,method:"POST",header:{Authorization:a},data:{id:e.id,type:6}});"success"===t.data.status?(e.user_like=!e.user_like,e.user_like?e.like_count=(e.like_count||0)+1:e.like_count=Math.max(0,(e.like_count||0)-1),v({title:e.user_like?"点赞成功":"已取消点赞",icon:"none"})):v({title:t.data.msg||"操作失败",icon:"none"})}catch(a){console.error("点赞失败:",a),v({title:"操作失败",icon:"none"})}else v({title:"请先登录",icon:"none"})},U=e=>{A({url:"/pages/user_page/user_page?uid="+e})},G=e=>{const a=new Date(1e3*e);return`${a.getMonth()+1}-${a.getDate()} ${a.getHours()}:${a.getMinutes()}`},H=e=>e?e.length>12?e.slice(0,12)+"...":e:"未知用户",J=async()=>{try{S.value=!0;let e=_("token");const a=await h({url:`${O}/get-comments`,data:{relation_id:k.relationId,type:k.type,page:b.value,page_size:10},header:{Authorization:e}});if("success"===a.data.status){const e=a.data.data,l=e.comment_list.map((e=>({...e,showAll:!1,localChildren:e.children||[],childTotal:e.childTotal||(e.children?e.children.length:0),attitudeStatus:e.user_attitude||0,attitudeCounts:e.attitude_counts||{1:e.count_1||0,2:e.count_2||0,3:e.count_3||0,4:e.count_4||0,5:e.count_5||0}})));1===b.value?C.value=l:C.value.push(...l),console.log("total",e.total),I.value=e.total>C.value.length,w.value=e.total,console.log("是否还有更多?",I.value)}}catch(e){v({title:"加载失败",icon:"none"})}finally{S.value=!1}},K=(e,a=null)=>{F("reply",{parent:e,target:a,relationId:k.relationId})},Q=e=>1===e?"娃物":2===e?"店铺":"关联内容",W=e=>{e.association_id&&(1===e.association_type?A({url:`/pages/goods/goods?goods_id=${e.association_id}`}):2===e.association_type&&A({url:`/pages/brand/brand?brand_id=${e.association_id}`}))},X=e=>e.childTotal>5&&!e.showAll,Y=e=>e.childTotal-Math.min(e.localChildren.length,5);return(e,a)=>{const i=g,f=y,_=$,k=V(l("report-button"),L),b=V(l("uni-icons"),P),x=V(l("attitude-widget"),Z);return t(),p(i,{class:"comment-container"},{default:n((()=>[C.value.length>0?(t(),p(i,{key:0,class:"comment-count"},{default:n((()=>[u(" 共"+c(w.value)+"条回复 ",1)])),_:1})):(t(),p(i,{key:1,class:"empty-tips"},{default:n((()=>[s(f,null,{default:n((()=>[u("-- 暂无回复 --")])),_:1})])),_:1})),(t(!0),o(d,null,r(C.value,(e=>(t(),p(i,{key:e.id,class:"comment-card"},{default:n((()=>[s(i,{class:"main-comment"},{default:n((()=>[s(_,{onClick:a=>U(e.uid),src:e.avatar,class:"avatar",mode:"aspectFill"},null,8,["onClick","src"]),s(i,{class:"content"},{default:n((()=>[s(i,{class:"header"},{default:n((()=>[s(i,null,{default:n((()=>[s(f,{class:"username",onClick:a=>U(e.uid)},{default:n((()=>[u(c(H(e.username)),1)])),_:2},1032,["onClick"]),s(f,{class:"floor"},{default:n((()=>[u("#"+c(e.floor),1)])),_:2},1024)])),_:2},1024),s(k,{"report-type":5,"relation-id":e.id,"button-text":"举报","icon-color":"#999","theme-color":"#64c6dc","icon-size":"24"},null,8,["relation-id"])])),_:2},1024),e.image_url?(t(),p(i,{key:0,class:"comment-images"},{default:n((()=>[s(_,{src:e.image_url,mode:"aspectFill",class:"comment-image",onClick:a=>D(e.image_url)},null,8,["src","onClick"])])),_:2},1024)):T("",!0),s(f,{class:"comment-text",onClick:a=>K(e)},{default:n((()=>[u(c(e.comment),1)])),_:2},1032,["onClick"]),e.association_id?(t(),p(i,{key:1,class:"association-card",onClick:a=>W(e)},{default:n((()=>[s(_,{src:e.association_image,mode:"aspectFill",class:"association-image"},null,8,["src"]),s(i,{class:"association-info"},{default:n((()=>[s(f,{class:"association-name"},{default:n((()=>[u(c(e.association_name),1)])),_:2},1024),s(f,{class:"association-type"},{default:n((()=>[u(c(Q(e.association_type)),1)])),_:2},1024)])),_:2},1024),s(b,{type:"arrow-right",size:"20",color:"#999",class:"association-arrow"})])),_:2},1032,["onClick"])):T("",!0),s(i,{class:"footer"},{default:n((()=>[s(i,{class:"left-actions"},{default:n((()=>[s(f,{class:"time"},{default:n((()=>[u(c(G(e.created_at)),1)])),_:2},1024),s(i,{class:"like-container"},{default:n((()=>[s(i,{class:"like-btn",onClick:a=>R(e)},{default:n((()=>[s(b,{type:e.user_like?"hand-up-filled":"hand-up",size:"18",color:e.user_like?"rgb(100 198 220)":"#999"},null,8,["type","color"]),s(f,{class:m(["like-count",{liked:e.user_like}])},{default:n((()=>[u(c(e.like_count||0),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),s(i,{class:"right-actions"},{default:n((()=>[s(x,{"target-id":e.id,type:6,"attitude-status":e.attitudeStatus,"attitude-counts":e.attitudeCounts,onChange:a=>q(e,a)},null,8,["target-id","attitude-status","attitude-counts","onChange"]),s(f,{class:"reply-btn",onClick:a=>K(e)},{default:n((()=>[u("回复")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),e.localChildren&&e.localChildren.length?(t(),p(i,{key:0,class:"sub-comments"},{default:n((()=>[(t(!0),o(d,null,r(M(e),((a,l)=>(t(),p(i,{key:a.id,class:"sub-comment"},{default:n((()=>[s(_,{onClick:e=>U(a.uid),src:a.avatar,class:"avatar",mode:"aspectFill"},null,8,["onClick","src"]),s(i,{class:"content"},{default:n((()=>[s(i,{class:"header"},{default:n((()=>[s(f,{onClick:e=>U(a.uid),class:"username"},{default:n((()=>[u(c(H(a.username)),1)])),_:2},1032,["onClick"]),s(k,{"report-type":5,"relation-id":a.id,"button-text":"举报","icon-color":"#999","theme-color":"#64c6dc"},null,8,["relation-id"])])),_:2},1024),a.image_url?(t(),p(i,{key:0,class:"comment-images"},{default:n((()=>[s(_,{src:a.image_url,mode:"aspectFill",class:"comment-image",onClick:e=>D(a.image_url)},null,8,["src","onClick"])])),_:2},1024)):T("",!0),s(f,{class:"comment-text",onClick:a=>K(e)},{default:n((()=>[u(c(a.comment),1)])),_:2},1032,["onClick"]),a.association_id?(t(),p(i,{key:1,class:"association-card",onClick:e=>W(a)},{default:n((()=>[s(_,{src:a.association_image,mode:"aspectFill",class:"association-image"},null,8,["src"]),s(i,{class:"association-info"},{default:n((()=>[s(f,{class:"association-name"},{default:n((()=>[u(c(a.association_name),1)])),_:2},1024),s(f,{class:"association-type"},{default:n((()=>[u(c(Q(a.association_type)),1)])),_:2},1024)])),_:2},1024),s(b,{type:"arrow-right",size:"20",color:"#999",class:"association-arrow"})])),_:2},1032,["onClick"])):T("",!0),s(i,{class:"footer"},{default:n((()=>[s(i,{class:"left-actions"},{default:n((()=>[s(f,{class:"time"},{default:n((()=>[u(c(G(a.created_at)),1)])),_:2},1024),s(i,{class:"like-container"},{default:n((()=>[s(i,{class:"like-btn",onClick:e=>R(a)},{default:n((()=>[s(b,{type:a.user_like?"hand-up-filled":"hand-up",size:"18",color:a.user_like?"rgb(100 198 220)":"#999"},null,8,["type","color"]),s(f,{class:m(["like-count",{liked:a.user_like}])},{default:n((()=>[u(c(a.like_count||0),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),s(i,{class:"right-actions"},{default:n((()=>[s(x,{"target-id":a.id,type:6,"attitude-status":e.attitudeStatus,"attitude-counts":e.attitudeCounts,onChange:a=>q(e,a)},null,8,["target-id","attitude-status","attitude-counts","onChange"]),s(f,{class:"reply-btn",onClick:l=>K(e,a)},{default:n((()=>[u("回复")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),X(e)?(t(),p(i,{key:0,class:"load-more",onClick:a=>(async e=>{if(e.localChildren.length<e.childTotal){const l=Math.ceil(e.localChildren.length/5)+1;try{const a=await h({url:`${O}/get-comments-by-parent-id`,data:{parent_id:e.id,page:l}});"success"===a.data.status&&(e.localChildren=[...e.localChildren,...a.data.data.comment_list],e.childTotal=a.data.data.total,e.localChildren.length>=5&&!e.showAll&&(e.showAll=!0))}catch(a){v({title:"加载失败",icon:"none"})}}else e.showAll=!e.showAll})(e)},{default:n((()=>[s(f,null,{default:n((()=>[u("展开"+c(Y(e))+"条回复",1)])),_:2},1024),s(b,{type:"arrow-down",size:"18",color:"#007AFF"})])),_:2},1032,["onClick"])):T("",!0)])),_:2},1024)):T("",!0)])),_:2},1024)))),128)),C.value.length>0?(t(),p(i,{key:2,class:"load-more-box"},{default:n((()=>[I.value?(t(),p(i,{key:0,class:m(["load-more-btn",{loading:S.value}]),onClick:B},{default:n((()=>[S.value?(t(),p(i,{key:1},{default:n((()=>[s(b,{type:"spinner-cycle",size:"16",color:"#888"})])),_:1})):(t(),p(i,{key:0},{default:n((()=>[s(f,null,{default:n((()=>[u(" 加载更多 ")])),_:1}),s(b,{type:"arrow-down",size:"18",color:"#007AFF"})])),_:1}))])),_:1},8,["class"])):(t(),p(i,{key:1,class:"no-more"},{default:n((()=>[s(f,null,{default:n((()=>[u("-- 没有更多了 --")])),_:1})])),_:1}))])),_:1})):T("",!0)])),_:1})}}},[["__scopeId","data-v-c8ce572f"]]);const Q=B({name:"BottomPopup",props:{show:{type:Boolean,default:!1}},methods:{closePopup(){this.$emit("close")}}},[["render",function(e,a,l,o,u,c){const d=g;return t(),p(d,null,{default:n((()=>[l.show?(t(),p(d,{key:0,class:m(["mask",{"mask-show":l.show}]),onClick:c.closePopup},null,8,["class","onClick"])):T("",!0),s(d,{class:m(["popup-container",{"popup-show":l.show}])},{default:n((()=>[i(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])])),_:3})}],["__scopeId","data-v-4caf7b65"]]),W=B({__name:"comment-input",props:{replyInfo:{type:Object,default:()=>({})},targetId:{type:String,required:!0},safeBottom:{type:Number,default:10}},emits:["submit","update:replyInfo"],setup(a,{expose:i,emit:r}){const _=e(!1),h=a,k=e(null),x=e(!1),j=r,A=e(""),B=e(!1),D=e(!1),O=e(!1),E=e(!1),L=e(null),Z=e(""),K=e(0),W=F(),X=w((()=>{var e,a;let l=(null==(e=W.safeAreaInsets)?void 0:e.bottom)||10;console.log("底部安全距离1:",null==(a=W.safeAreaInsets)?void 0:a.bottom,"=>",l);let t=l+K.value;return console.log("底部最终距离2:",t),`${t}px`})),Y=e=>{console.log("切换匿名状态",E.value),E.value=!E.value,E.value?v({title:"进入匿名状态",icon:"none"}):v({title:"退出匿名状态",icon:"none"})},ee=()=>{B.value=!0,x.value=!0,O.value=!0},ae=()=>{setTimeout((()=>{D.value||(O.value||(B.value=!1),x.value=!1),D.value=!1}),200)};async function le(){q({count:1,success:async e=>{const a=e.tempFilePaths;for(const t of a)try{const e=await H(),a=await J(t,e.token,e.path);if(console.log("res:",a),200===a.qiniuRes.statusCode){const a=R+e.path;Z.value=a}else console.error("上传失败:",t)}catch(l){console.error("上传错误:",l)}}})}const te=()=>{console.log("蒙版被点击"),B.value=!1,x.value=!1,O.value=!1,M()};function oe(e){let a={};"goods"===e.type?(console.log("选择了商品:",e.data),_.value=!1,a.type=1,a.id=e.data.id,a.name=e.data.name):"brand"===e.type&&(console.log("选择了品牌:",e.data),_.value=!1,a.type=2,a.id=e.data.id,a.name=e.data.name),L.value=a}const se=()=>{if(!A.value.trim()&&!Z.value)return void v({title:"请输入评论内容或上传图片",icon:"none"});let e=U();console.log("scene",e);const a={content:A.value,target_id:h.targetId,type:4,replyInfo:h.replyInfo,origin:e,image_url:Z.value||"",association_id:L.value?L.value.id:0,association_type:L.value?L.value.type:0,is_anonymous:E.value?1:0};j("submit",a),A.value="",Z.value="",L.value=null,E.value=!1,j("update:replyInfo",{}),te()};return i({focusInput:()=>{x.value=!0}}),z((()=>{console.log("不注册键盘弹出事件")})),(e,i)=>{const r=g,v=V(l("uni-icons"),P),w=y,z=$,j=C,F=b,q=V(l("switch-search"),G),M=V(l("bottom-popup"),Q);return t(),o(d,null,[S(s(r,{class:"mask",onClick:te},null,512),[[N,B.value]]),s(r,{class:"bottom_tab","adjust-position":!1,style:f({paddingBottom:X.value})},{default:n((()=>[s(r,{class:"about_info"},{default:n((()=>[L.value?(t(),p(r,{key:0,class:"association-container"},{default:n((()=>[s(r,{class:"association-item"},{default:n((()=>[s(v,{type:"paperclip",size:"20",color:"#fff"}),s(w,{class:"association-text"},{default:n((()=>[u(c(L.value.name),1)])),_:1}),s(v,{type:"close",size:"20",color:"#fff",onClick:i[0]||(i[0]=I((e=>L.value=null),["stop"])),class:"close-icon"})])),_:1})])),_:1})):T("",!0),Z.value?(t(),p(r,{key:1,class:"image-container"},{default:n((()=>[s(r,{class:"image-item"},{default:n((()=>[s(z,{src:Z.value,mode:"aspectFill",class:"uploaded-image"},null,8,["src"]),s(r,{class:"delete-icon",onClick:i[1]||(i[1]=I((e=>Z.value=""),["stop"]))},{default:n((()=>[s(v,{type:"close",size:"18",color:"#fff"})])),_:1})])),_:1})])),_:1})):T("",!0)])),_:1}),s(r,{class:"bottom_input"},{default:n((()=>[s(j,{"disable-default-padding":!0,focus:x.value,class:m(["comment_input unified-textarea",{expanded:x.value}]),ref_key:"inputRef",ref:k,modelValue:A.value,"onUpdate:modelValue":i[2]||(i[2]=e=>A.value=e),onFocus:ee,onBlur:ae,"adjust-position":!1,placeholder:a.replyInfo.username?"回复@"+a.replyInfo.username+" ":"写评论..."},null,8,["focus","class","modelValue","placeholder"]),s(F,{onClick:se},{default:n((()=>[u("写评论")])),_:1})])),_:1}),S(s(r,{class:"action-bar"},{default:n((()=>[s(r,{onClick:I(Y,["stop"])},{default:n((()=>[E.value?(t(),p(v,{key:0,type:"eye-slash",size:"22",color:E.value?"#007aff":""},null,8,["color"])):(t(),p(v,{key:1,type:"eye",size:"22",color:"#696a6c"}))])),_:1}),s(r,{onClick:i[3]||(i[3]=I((e=>_.value=!0),["stop"]))},{default:n((()=>[s(v,{type:"plus",size:"22",color:"#696a6c"})])),_:1}),s(r,{onClick:I(le,["stop"])},{default:n((()=>[s(v,{type:"image",size:"22",color:"#696a6c"})])),_:1})])),_:1},512),[[N,O.value]]),s(r),s(M,{show:_.value,onClose:i[4]||(i[4]=e=>_.value=!1)},{default:n((()=>[_.value?(t(),p(q,{key:0,"target-id":h.targetId,"reply-info":h.replyInfo,mode:"fill",onSubmit:oe},null,8,["target-id","reply-info"])):T("",!0),s(r,{style:{height:"900rpx"}})])),_:1},8,["show"])])),_:1},8,["style"])],64)}}},[["__scopeId","data-v-e2665e94"]]);export{K as _,W as a,L as b};
