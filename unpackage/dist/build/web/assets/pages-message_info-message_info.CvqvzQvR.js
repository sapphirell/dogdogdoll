import{g as a,ac as e,$ as s,aa as t,j as l,c as r,w as i,l as u,C as o,af as d,f as n,o as c,a as m,b as f,t as v,e as _,H as p,i as g,S as y}from"./index-CfMR_IzQ.js";import{_ as h}from"./uni-icons.sjYK3Gk_.js";import{r as w}from"./uni-app.es.5AkhYBbN.js";import{b as x,w as j}from"./config.BX5UpUDr.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=k({__name:"message_info",props:["message_id"],setup(k){const z=k,b=a(null),C=a(!0),D=a(""),A=a(""),I=async()=>{try{if(C.value=!0,D.value="",!A.value)return void(D.value="无效的消息ID");if(!(await x()))return void(D.value="请先登录");const a=await u({url:`${j}/with-state/message-detail`,method:"GET",data:{id:A.value},header:{Authorization:o("token")}});"success"===a.data.status?(b.value=a.data.data,d("message-status-update",{id:A.value,is_read:1})):D.value=a.data.msg||"获取详情失败"}catch(a){D.value="请求失败，请检查网络",console.error("详情请求失败:",a)}finally{C.value=!1}};return e((()=>{s({title:"消息详情"}),A.value=z.message_id,I()})),(a,e)=>{const s=t("uni-load-more"),u=n,o=w(l("uni-icons"),h),d=_,x=p,j=g,k=y;return c(),r(u,{class:"container"},{default:i((()=>[C.value?(c(),r(u,{key:0,class:"loading-wrapper"},{default:i((()=>[m(s,{status:"loading"})])),_:1})):D.value?(c(),r(u,{key:1,class:"error-wrapper"},{default:i((()=>[m(o,{type:"info",size:"24",color:"#ff4d4f"}),m(d,{class:"error-text"},{default:i((()=>[f(v(D.value),1)])),_:1}),m(x,{class:"retry-btn",onClick:I},{default:i((()=>[f("重试")])),_:1})])),_:1})):(c(),r(k,{key:2,class:"content-wrapper","scroll-y":""},{default:i((()=>[m(j,{class:"cover-image",src:b.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),m(u,{class:"main-content"},{default:i((()=>[m(u,{class:"header"},{default:i((()=>[m(d,{class:"title"},{default:i((()=>[f(v(b.value.title),1)])),_:1}),m(d,{class:"time"},{default:i((()=>{return[f(v((a=b.value.created_at,new Date(1e3*a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1})])),_:1}),m(u,{class:"message-content"},{default:i((()=>[m(d,{class:"message-text"},{default:i((()=>[f(v(b.value.msg),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-e33a478d"]]);export{z as default};
