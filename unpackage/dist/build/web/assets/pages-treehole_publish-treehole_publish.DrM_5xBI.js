import{r as a,a2 as e,k as l,o as s,a as t,c as o,w as n,q as u,b as c,B as i,d as r,D as d,e as m,t as p,v,x as f,F as h,A as _,_ as g,j as b,$ as k,ab as x,f as y,g as j,K as w,i as C,S as F,ar as I,W as T,X as A,Y as B,h as O,J as S}from"./index-BFzTDSoz.js";import{w as V,_ as z,i as J}from"./view-logs.yEAac7W9.js";import{_ as q,r as D}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as E}from"./uni-icons.COaeasi-.js";import{_ as G}from"./common-page.Dhg03y__.js";import{_ as K}from"./cancel.CnEdunnH.js";import{_ as N}from"./add2.S6xx6DwX.js";import{a as P,g as Q,u as U}from"./image.dhxYfBTz.js";const W=q({__name:"treehole_publish",setup(q){const W=a(""),X=a(0),Y=a([]),$=a([]),H=a(""),L=a(-1),M=a("");function R(a){S({current:Y.value[a],urls:Y.value})}function Z(a){X.value=a.detail.value.length>0?1:0}e({title:"投稿树洞"});function aa(a){const e=a.detail.value;e>=0&&$.value[e]&&(L.value=e,H.value=$.value[e].value,M.value=$.value[e].label)}const ea=l((()=>W.value.trim().length>0&&null!==H.value));async function la(){if(ea.value)if(H.value)try{g({title:"提交中..."});const a=b("token");if(!a)return void _({title:"请先登录",icon:"none"});const e={content:W.value.trim(),images:Y.value,is_anonymous:X.value,category_id:H.value},l=await u({url:V+"/with-state/add-submission",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a}});k(),"success"==l.data.status?(_({title:"已收到您的投稿",icon:"success"}),setTimeout((()=>{W.value="",Y.value=[],X.value=0,x()}),1500)):_({title:l.data.msg||"提交失败",icon:"none"})}catch(a){k(),console.error("提交失败:",a),_({title:"网络请求失败",icon:"none"})}else _({title:"请选择分类",icon:"none"})}return s((()=>{(async()=>{try{const a=await u({url:V+"/treehole-typelist",method:"GET"});"success"===a.data.status&&($.value=Object.entries(a.data.data).map((([a,e])=>({value:Number(a),label:e}))))}catch(a){console.error("获取分类失败:",a)}})()})),(a,e)=>{const l=D(t("view-logs"),z),s=y,u=D(t("uni-icons"),E),g=j,b=w,k=C,x=F,S=I,V=T,q=A,sa=B,ta=O,oa=D(t("common-page"),G);return c(),o(oa,{title:"发布树洞"},{default:n((()=>[i("meta",{name:"theme-color",content:"#F8F8F8"}),r(l),r(g,{class:"publish-box"},{default:n((()=>[r(b,{class:"category-picker",range:$.value,"range-key":"label",onChange:aa,value:L.value},{default:n((()=>[r(g,{class:"picker-content"},{default:n((()=>[r(s,{class:d(["picker-text",H.value?"":"placeholder"])},{default:n((()=>[m(p(M.value||"请选择分类（必选）"),1)])),_:1},8,["class"]),r(u,{type:"right",size:"22",color:"#888"})])),_:1})])),_:1},8,["range","value"]),r(x,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:n((()=>[(c(!0),v(h,null,f(Y.value,((e,l)=>(c(),o(g,{class:"upload_item",key:l},{default:n((()=>[r(k,{src:e,class:"uploaded_image",onClick:R,mode:"aspectFill"},null,8,["src"]),r(k,{src:K,class:"close_icon",onClick:e=>a.deleteImage(l)},null,8,["onClick"])])),_:2},1024)))),128)),r(g,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:n((()=>[r(k,{src:N,class:"upload_img",onClick:e[0]||(e[0]=e=>(a.index,console.log("openSelect"),void P().then((a=>{Q().then((e=>{console.log(e),U(a,e.token,e.path).then((a=>{200!=a.statusCode&&_({title:"上传失败",icon:"none"}),console.log(J+e.path),Y.value.push(J+e.path),_({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),r(S,{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),placeholder:"写下你想说的话...",class:"textarea",maxlength:"500"},null,8,["modelValue"]),r(g,{class:"anonymous"},{default:n((()=>[r(sa,{onChange:Z},{default:n((()=>[r(q,null,{default:n((()=>[r(V,{checked:1===X.value,color:"#4cbbd0"},null,8,["checked"]),r(s,null,{default:n((()=>[m("匿名发布")])),_:1})])),_:1})])),_:1})])),_:1}),r(g,{class:"publish-detail"},{default:n((()=>[r(s,null,{default:n((()=>[m("* 目前树洞为非审稿发布，只接受娃圈相关内容。")])),_:1}),r(s,null,{default:n((()=>[m("* 如果勾选匿名发布，他人将无法通过稿件进入您的主页。如果稿件遭到过多点踩或投诉，我们可能会隐藏这封稿件。")])),_:1})])),_:1}),r(ta,{class:d(["submit-btn",{disabled:!ea.value}]),onClick:la},{default:n((()=>[m(" 提交 ")])),_:1},8,["class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-c9807f7b"]]);export{W as default};
