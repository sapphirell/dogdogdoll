import{h as e,k as a,c as o,w as l,l as t,m as s,p as n,o as i,a as d,e as u,r as c,F as r,b as p,C as m,a8 as g,i as _,g as v,W as f,N as h,X as x,D as b,t as y,y as k,f as w}from"./index-u2rUIk8T.js";import{_ as C}from"./common-name-picker.BbA5WcEx.js";import{r as j}from"./uni-app.es.DpDa-E5E.js";import{_ as I}from"./common-search.B09gwaSi.js";import{_ as L,a as T}from"./common-modal.D11NfJ0_.js";import{_ as V}from"./common-page.CNR2v_s0.js";import{_ as D}from"./cancel.CnEdunnH.js";import{_ as F}from"./add2.S6xx6DwX.js";import{_ as S}from"./right2.s_X9TKoF.js";import{w as E,i as G}from"./config.DgkxgtZ3.js";import{c as U,g as A,u as N}from"./image.BZ6EH6H4.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=P({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(P){const z=P,B=e([]),O=e([]),W=e([]),X=e(!1),q=e(""),H=e(0),J=e(""),K=e(0),M=e("");function Q(e){return new Promise(((a,o)=>{t({url:E+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),a(e.data)},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"}),o(e)},complete:()=>{n()}})}))}const R=e([]);z.goods_id&&z.goods_name&&z.brand_id&&z.brand_name&&z.type&&Q(z.goods_id).then((e=>{let a={brand_id:parseInt(z.brand_id,10),goods_id:parseInt(z.goods_id,10),brand_name:z.brand_name,goods_name:z.goods_name,goods_image:e.data.goods_images[0],type:z.type};console.log(a),R.value.push(a)}));const Y=e(""),Z=e("");function $(e){k({current:B.value[e],urls:B.value})}function ee(){const e=m("token");if(!e)return void s({title:"请先登录",icon:"none"});if(!Y.value.trim()||!Z.value.trim())return void s({title:"标题和正文不能为空",icon:"none"});if(0===B.value.length)return void s({title:"请至少上传一张图片",icon:"none"});const a={title:Y.value,content:Z.value,image_url_list:B.value,relation_data_list:R.value.map((e=>({goods_id:e.goods_id,goods_name:e.goods_name,brand_id:e.brand_id,brand_name:e.brand_name,type:e.type})))};console.log(a),t({url:E+"/with-state/add-collocation",method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:e},timeout:5e3,success:e=>{200===e.data.code?(s({title:"提交成功"}),Y.value="",Z.value="",B.value=[],R.value=[],g()):s({title:e.data.msg||"提交失败",icon:"none"})},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}})}function ae(e,a){console.log("收到品牌ID:",e),console.log("收到品牌Name:",a),H.value=parseInt(e,10),q.value=a,t({url:E+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),O.value=e.data.data,console.log(O.value)},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}})}function oe(e,a){console.log("选中的 id:",e),console.log("选中的 name:",a),K.value=parseInt(e,10),J.value=a}function le(e){console.log("选中的值:",e),M.value=e,X.value=!0}function te(){if(""!=q.value)if(""!=J.value){if(0==K.value){let e={brand_id:H.value,goods_id:0,brand_name:q.value,goods_name:J.value,goods_image:"",type:M.value};return R.value.push(e),X.value=!1,H.value=0,q.value="",K.value=0,J.value="",void(M.value="")}Q(K.value).then((e=>{let a={brand_id:H.value,goods_id:K.value,brand_name:q.value,goods_name:J.value,goods_image:e.data.goods_images[0],type:M.value};R.value.push(a),X.value=!1,H.value=0,q.value="",K.value=0,J.value="",M.value=""}))}else s({title:"请选择或填写商品名称",icon:"none"});else s({title:"请选择或填写品牌名称",icon:"none"})}return t({url:E+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),W.value=e.data.data},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}}),(e,t)=>{const n=_,m=v,g=f,k=h,E=x,P=j(a("common-name-picker"),C),z=w,q=j(a("common-search"),I),H=j(a("custom-picker"),L),J=b,K=j(a("common-modal"),T),M=j(a("common-page"),V);return i(),o(M,null,{default:l((()=>[d(g,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(i(!0),u(r,null,c(B.value,((e,a)=>(i(),o(m,{class:"upload_item",key:a},{default:l((()=>[d(n,{src:e,class:"uploaded_image",onClick:$,mode:"aspectFill"},null,8,["src"]),d(n,{src:D,class:"close_icon",onClick:e=>function(e){B.value.splice(e,1)}(a)},null,8,["onClick"])])),_:2},1024)))),128)),d(m,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[d(n,{src:F,class:"upload_img",onClick:t[0]||(t[0]=a=>(e.index,console.log("openSelect"),void U().then((e=>{A().then((a=>{console.log(a),N(e,a.token,a.path).then((e=>{200!=e.statusCode&&s({title:"上传失败",icon:"none"}),console.log(G+a.path),B.value.push(G+a.path),s({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),d(k,{modelValue:Y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Y.value=e),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),d(m,{class:"oneLine"}),d(E,{modelValue:Z.value,"onUpdate:modelValue":t[2]||(t[2]=e=>Z.value=e),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),d(m,{class:"oneLine"}),d(m,{class:""},{default:l((()=>[d(m,{style:{display:"flex",padding:"10px 15px",position:"relative"}},{default:l((()=>[d(P,{style:{width:"650rpx"},dataList:W.value,placeholder:"关联娃物",onSelect:le},null,8,["dataList"]),d(n,{src:S,style:{width:"20px",height:"20px",margin:"10px",position:"absolute",right:"40rpx"},mode:"aspectFill"})])),_:1})])),_:1}),d(m,{class:"saveCollocationDataList"},{default:l((()=>[(i(!0),u(r,null,c(R.value,((e,a)=>(i(),o(m,{key:a},{default:l((()=>[d(m,{class:"saveCollocationDataItem"},{default:l((()=>[e.goods_image?(i(),o(n,{key:0,src:e.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(i(),o(z,{key:1,class:"no-image"},{default:l((()=>[p("?")])),_:1})),d(z,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[p(y(e.type)+" "+y(e.brand_name)+" - "+y(e.goods_name),1)])),_:2},1024),d(n,{src:D,class:"close_icon",onClick:e=>function(e){R.value.splice(e,1)}(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(K,{visible:X.value,"onUpdate:visible":t[3]||(t[3]=e=>X.value=e)},{default:l((()=>[d(m,{class:"selectTab",style:{border:"1px sold #b2b0b4","padding-top":"60rpx"}},{default:l((()=>[d(q,{mode:"fill",onSelect:ae,width:"calc(100vw - 120px)"}),d(m,{style:{height:"30rpx"}}),d(H,{dataList:O.value,onSelect:oe,margin:"10px 0 0 0px"},null,8,["dataList"]),d(J,{onClick:te,style:{"margin-top":"20px","background-color":"#fff"}},{default:l((()=>[p("确认")])),_:1})])),_:1})])),_:1},8,["visible"]),d(m,{class:"footer"},{default:l((()=>[d(J,{onClick:ee},{default:l((()=>[p("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-94af159a"]]);export{z as default};
