import{g as a,X as e,_ as s,m as t,c as l,w as r,l as i,H as o,aq as u,f as d,o as n,a as c,b as m,t as f,e as _,K as v,i as p,S as g}from"./index-B55GPRQF.js";import{_ as y}from"./uni-load-more.CJQcHO9p.js";import{r as h}from"./uni-app.es.CzHle-z4.js";import{_ as w}from"./uni-icons.B2Wm8RW1.js";import{b as j,w as x}from"./config.BIUptOrH.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=k({__name:"message_info",props:["message_id"],setup(k){const z=k,D=a(null),b=a(!0),A=a(""),C=a(""),E=async()=>{try{if(b.value=!0,A.value="",!C.value)return void(A.value="无效的消息ID");if(!(await j()))return void(A.value="请先登录");const a=await i({url:`${x}/with-state/message-detail`,method:"GET",data:{id:C.value},header:{Authorization:o("token")}});"success"===a.data.status?(D.value=a.data.data,u("message-status-update",{id:C.value,is_read:1})):A.value=a.data.msg||"获取详情失败"}catch(a){A.value="请求失败，请检查网络",console.error("详情请求失败:",a)}finally{b.value=!1}};return e((()=>{s({title:"消息详情"}),C.value=z.message_id,E()})),(a,e)=>{const s=h(t("uni-load-more"),y),i=d,o=h(t("uni-icons"),w),u=_,j=v,x=p,k=g;return n(),l(i,{class:"container"},{default:r((()=>[b.value?(n(),l(i,{key:0,class:"loading-wrapper"},{default:r((()=>[c(s,{status:"loading"})])),_:1})):A.value?(n(),l(i,{key:1,class:"error-wrapper"},{default:r((()=>[c(o,{type:"info",size:"24",color:"#ff4d4f"}),c(u,{class:"error-text"},{default:r((()=>[m(f(A.value),1)])),_:1}),c(j,{class:"retry-btn",onClick:E},{default:r((()=>[m("重试")])),_:1})])),_:1})):(n(),l(k,{key:2,class:"content-wrapper","scroll-y":""},{default:r((()=>[c(x,{class:"cover-image",src:D.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),c(i,{class:"main-content"},{default:r((()=>[c(i,{class:"header"},{default:r((()=>[c(u,{class:"title"},{default:r((()=>[m(f(D.value.title),1)])),_:1}),c(u,{class:"time"},{default:r((()=>{return[m(f((a=D.value.created_at,new Date(1e3*a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1})])),_:1}),c(i,{class:"message-content"},{default:r((()=>[c(u,{class:"message-text"},{default:r((()=>[m(f(D.value.msg),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-e33a478d"]]);export{z as default};
