import{a1 as e,a as t,b as a,c as s,w as l,d as i,k as o,F as n,l as r,C as d,a0 as u,H as c,g as h,r as g,_ as m,p,v as _,A as f,a2 as v,$ as y,j as b,B as w,D as S,e as x,t as C,T as k,i as I,f as z,h as R,u as $,J as M,n as T,a3 as N,E as P,G as L}from"./index-6ojkiy1R.js";import{_ as F}from"./uni-icons.C75VRGWb.js";import{r as j,c as B}from"./uni-app.es.BMFd5FAr.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as E,a as V}from"./comment-input.WXDjx_KR.js";import{a as D,b as O,w as X}from"./config.Bhvn_Gfs.js";import"./common-modal.Biav_mER.js";const G=A({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),s=Math.ceil(e);for(let l=0;l<this.max;l++)a>l?t.push({activeWitch:"100%"}):s-1===l?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let s=0;s<t.length-1;s++)if(e.indexOf(t[s])>0){a=!1;break}return a},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let s=parseInt(a/(t+this.marginNumber));s=s<0?0:s,s=s>this.max?this.max:s;const l=parseInt(a-(t+this.marginNumber)*s);let i=0;(this._oldValue!==s||this.PC)&&(this._oldValue=s,i=this.allowHalf?l>t/2?s+1:s+.5:s+1,i=Math.max(.5,Math.min(i,this.max)),this.valueSync=i,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(e,g,m,p,_,f){const v=j(t("uni-icons"),F),y=h;return a(),s(y,null,{default:l((()=>[i(y,{ref:"uni-rate",class:"uni-rate"},{default:l((()=>[(a(!0),o(n,null,r(f.stars,((e,t)=>(a(),s(y,{class:d(["uni-rate__icon",{"uni-cursor-not-allowed":m.disabled}]),style:u({"margin-right":f.marginNumber+"px"}),key:t,onTouchstart:c(f.touchstart,["stop"]),onTouchmove:c(f.touchmove,["stop"]),onMousedown:c(f.mousedown,["stop"]),onMousemove:c(f.mousemove,["stop"]),onMouseleave:f.mouseleave},{default:l((()=>[i(v,{color:m.color,size:m.size,type:m.isFill?"star-filled":"star"},null,8,["color","size","type"]),i(y,{style:u({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:l((()=>[i(v,{color:m.disabled?m.disabledColor:m.activeColor,size:m.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]),W=A({__name:"brand",props:["brand_id"],setup(e){const d=e;console.log(d);const c=g(!1);let F=g([]),A=g({page_index:1,page_size:3,total:0});m({title:"加载中"}),p();let W=g(0);const H=g(0),U=g(null),J=g(null);g(1);let Y=g({});const q=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let s=e;null!=t&&(s=t),Y.value.id!=s.id?(console.log("item",s),Y.value=s,null==(a=J.value)||a.focusInput()):Y.value={}},K=({content:e,replyInfo:t,origin:a})=>{let s=b("token");if(!O.isLogin)return void f({title:"请先登录",icon:"none"});console.log("reply_info",t);const l={content:e,origin:a,target_id:parseInt(d.brand_id),type:1,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};_({url:X+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:l,success:e=>{var t,a;if("success"==e.data.status){const s=e.data.data;0===s.parent_id?null==(t=U.value)||t.addNewComment(s):null==(a=U.value)||a.addReplyComment(s),f({title:"评论成功",icon:"success"})}else f({title:e.data.msg,icon:"none"})},fail:e=>{f({title:"网络请求失败",icon:"none"})}})},Q=e=>{if(console.log(e),!O.isLogin)return f({title:"请先登录",icon:"none"}),void(W.value=0);W.value=e.value,H.value=e.value,async function(){if(0==W.value)return void f({title:"请先评分",icon:"none"});try{let e=b("token");if(!e)return void f({title:"请先登录",icon:"none"});m({title:"提交中..."});const t=await _({url:X+"/with-state/add-vote-score",method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:{type:1,score:W.value,target_id:parseInt(d.brand_id)}});y(),"success"===t.data.status?(Z(),f({title:"评分成功",icon:"success"})):f({title:t.data.msg||"评分失败",icon:"none"})}catch(e){y(),console.error("评分失败:",e),f({title:"评分失败，请重试",icon:"none"})}}()};function Z(){_({url:X+"/brand-info?id="+d.brand_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),oe.value=e.data.data,v({title:e.data.data.brand_name}),te()},fail:e=>{console.log(e),f({title:"网络请求失败",icon:"none"})},complete:()=>{y()}})}const ee=async()=>{let e=b("token");if(O.isLogin)try{const t=`${X}/with-state/${c.value?"unlike":"add-like"}`,a=await _({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(d.brand_id),type:2}});"success"===a.data.status?(c.value=!c.value,f({title:c.value?"关注成功":"已取消关注",icon:"none"}),Z()):f({title:a.data.msg,icon:"none"})}catch(t){console.error(t),f({title:"操作失败",icon:"none"})}else f({title:"请先登录",icon:"none"})},te=async()=>{var e;try{const t=await _({url:`${X}/with-state/hasLike?id=${parseInt(d.brand_id)}&type=2`,method:"POST",header:{Authorization:b("token")}});c.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(t){console.error("获取关注状态失败:",t)}};function ae(e){const t=new Date(1e3*e),a=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),l=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${s}-${l} ${i}:${o}`}function se(){_({url:X+"/brand-goods?brand_id="+d.brand_id+"&page="+ie.value,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),le.value.page_index=e.data.data.page_index,le.value.total=e.data.data.total,le.value.goods_list=le.value.goods_list?le.value.goods_list.concat(e.data.data.goods_list):e.data.data.goods_list,e.data.data.goods_list.length>0&&(ie.value+=1),0==e.data.data.goods_list.length&&ie.value>1&&f({title:"没有更多数据了",icon:"none"})},fail:e=>{console.log(e),f({title:"网络请求失败",icon:"none"})}})}let le=g({}),ie=g(1),oe=g({});return B((()=>{D(),Z(),se(),_({url:`${X}/brand-news-list?brand_id=${d.brand_id}&page=${A.value.page_index}&page_size=${A.value.page_size}`,method:"GET",success:e=>{if("success"===e.data.status){const t=e.data.data;F.value=[...F.value,...t.news_list],A.value.total=t.total,t.news_list.length>0&&(A.value.page_index+=1)}else f({title:e.data.msg||"获取图透失败",icon:"none"})},fail:e=>{f({title:"网络请求失败",icon:"none"})}}),O.isLogin?function(e,t){let a=b("token");a&&O.isLogin&&_({url:X+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(t),type:e},success:e=>(console.log(e.data.data),"success"==e.data.status?(H.value=e.data.data.score,e.data.data.score):(f({title:e.data.msg,icon:"none"}),0)),fail:e=>(console.log(e),f({title:"网络请求失败",icon:"none"}),0)})}(1,d.brand_id):W.value=0})),(e,g)=>{const m=I,p=z,_=h,f=j(t("uni-rate"),G),v=N,y=R,b=P,B=L,D=j(t("comment-list"),E),O=j(t("comment-input"),V);return a(),s(_,null,{default:l((()=>[w("meta",{name:"theme-color",content:"#F8F8F8"}),i(m,{src:S(oe).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),i(_,{class:"body"},{default:l((()=>[i(_,null,{default:l((()=>[i(m,{src:S(oe).brand_name_image,mode:"heightFix",style:{height:"60rpx"}},null,8,["src"]),i(p,{style:{float:"right",margin:"5px 0px"}},{default:l((()=>[x(C(S(oe).country_name)+" / "+C(S(oe).type),1)])),_:1}),i(_,{style:{clear:"both"}})])),_:1}),i(_,{style:{margin:"20rpx 0rpx",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},{default:l((()=>[i(_,{style:{display:"flex","align-items":"center","flex-grow":"1"}},{default:l((()=>[i(f,{style:{"margin-top":"5px"},value:S(oe).score,"allow-half":"true",activeColor:"#65C3D6",onChange:Q,"is-fill":"false"},null,8,["value"]),i(p,{style:{"margin-left":"8rpx",position:"relative",top:"5px"}},{default:l((()=>[x(C(S(oe).score)+"（"+C(S(oe).vote_number)+"次评分) ",1)])),_:1})])),_:1}),i(p,{class:"follow",onClick:ee,style:u({background:c.value?"#ff6a6c":"#65C3D6"})},{default:l((()=>[x(C(c.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),i(_,{style:{"margin-top":"15px"}},{default:l((()=>[i(p,null,{default:l((()=>[x("别名："+C(S(oe).nickname_list),1)])),_:1})])),_:1}),i(_,{style:{"margin-top":"10px"}},{default:l((()=>[i(p,null,{default:l((()=>[x("简介："+C(S(oe).description),1)])),_:1})])),_:1}),w("div",{style:{clear:"both"}}),i(p,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:l((()=>[x("收录作品 ("+C(S(le).total)+")",1)])),_:1}),i(_,{class:"brand_goods"},{default:l((()=>[(a(!0),o(n,null,r(S(le).goods_list,((e,t)=>(a(),s(_,{class:"brand_goods_item",style:{},key:e.id},{default:l((()=>[i(v,{onClick:t=>{return a=e.id,void T({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},{default:l((()=>[i(_,{style:{width:"100%",height:"calc(100% - 20px)"}},{default:l((()=>[i(m,{style:{width:"100%",height:"100%"},src:e.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])])),_:2},1024),i(p,{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},{default:l((()=>[x(C(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),i(y,{class:"load_more",onClick:se},{default:l((()=>[x("加载更多")])),_:1}),i(p,{class:"section-title"},{default:l((()=>[x("品牌图透 ("+C(S(A).total)+")",1)])),_:1}),i(_,{class:"news-list"},{default:l((()=>[(a(!0),o(n,null,r(S(F),((e,t)=>(a(),s(_,{class:"news-item",style:{position:"relative"},key:e.id},{default:l((()=>[i(_,{class:"news-header"},{default:l((()=>[i(p,{class:"news-header-title"},{default:l((()=>[x(C(e.title),1)])),_:2},1024)])),_:2},1024),e.image_list&&e.image_list.length>0?(a(),s(_,{key:0,class:"news-images"},{default:l((()=>[i(B,{class:"image-swiper",autoplay:!0,circular:!0,"indicator-dots":""},{default:l((()=>[(a(!0),o(n,null,r(e.image_list,((t,o)=>(a(),s(b,{key:o},{default:l((()=>[i(m,{src:t,mode:"aspectFill",class:"swiper-image",onClick:a=>{return s=t,l=e.image_list,void M({current:s,urls:l});var s,l}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):$("",!0),i(_,{class:"news-content"},{default:l((()=>[x(C(e.content),1)])),_:2},1024),i(_,{class:"news-footer"},{default:l((()=>[i(p,{class:"news-time"},{default:l((()=>[x(C(ae(e.created_at)),1)])),_:2},1024),i(p,{class:"view-more",onClick:t=>function(e){T({url:`/pages/sale_news/sale_news?id=${e.id}&brand_id=${e.brand_id}`})}(e)},{default:l((()=>[x("查看详情 →")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(_,null,{default:l((()=>[i(D,{ref_key:"commentListRef",ref:U,type:1,"relation-id":parseInt(d.brand_id),onReply:q},null,8,["relation-id"])])),_:1})])),_:1}),i(_,{style:{height:"80px"}}),i(O,{ref_key:"commentInputRef",ref:J,"reply-info":S(Y),"target-id":d.brand_id,onSubmit:K,"onUpdate:replyInfo":g[0]||(g[0]=e=>k(Y)?Y.value=e:Y=e)},null,8,["reply-info","target-id"])])),_:1})}}},[["__scopeId","data-v-78b657db"]]);export{W as default};
