import{r as a,a as o,c as e,w as l,q as s,A as t,$ as n,g as i,b as d,d as c,v as r,x as u,F as p,e as m,j as _,ab as g,i as f,S as v,M as h,ar as y,f as b,h as x,t as k,J as w}from"./index-BFzTDSoz.js";import{w as j,_ as C,i as L,g as F}from"./view-logs.yEAac7W9.js";import{_ as I,r as V}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as z}from"./relation-picker.BL9Kgm-F.js";import{_ as D}from"./cancel.CnEdunnH.js";import{_ as B}from"./add2.S6xx6DwX.js";import{_ as T}from"./right2.s_X9TKoF.js";import{c as A,g as G,u as J}from"./image.dhxYfBTz.js";import"./uni-icons.COaeasi-.js";import"./common-search.BzljtTyU.js";import"./search.CsIL0f2m.js";import"./goods-search.DW_4Fo2f.js";import"./common-modal.DWKlFhUY.js";const P=I({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(I){const P=I,U=a([]),E=a([]),O=a([]),S=a(!1);a(""),a(0),a(""),a(0),a("");const $=a=>{try{const o={goods_id:a.goods.id||0,goods_name:a.goods.name,goods_image:a.goods.image||"",brand_id:a.brand.id||0,brand_name:a.brand.name||(a.isFuzzy?"":"未知品牌"),type:a.type||(a.isFuzzy?"未知类型":"")};M.value.some((a=>0!==a.goods_id&&a.goods_id===o.goods_id||a.goods_name===o.goods_name))?t({title:"已存在相同关联项",icon:"none"}):M.value.push(o)}catch(o){console.error("保存关联数据失败:",o),t({title:"保存关联信息失败",icon:"none"})}},q=()=>{console.log("用户取消选择")},H=()=>{S.value=!0};const M=a([]);var Q;P.goods_id&&P.goods_name&&P.brand_id&&P.brand_name&&P.type&&(Q=P.goods_id,new Promise(((a,o)=>{s({url:j+"/goods?id="+Q,method:"GET",timeout:5e3,success:o=>{console.log(o.data.data),a(o.data)},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"}),o(a)},complete:()=>{n()}})}))).then((a=>{let o={brand_id:parseInt(P.brand_id,10),goods_id:parseInt(P.goods_id,10),brand_name:P.brand_name,goods_name:P.goods_name,goods_image:a.data.goods_images[0],type:P.type};console.log(o),M.value.push(o)}));const K=a(""),N=a("");function R(a){w({current:U.value[a],urls:U.value})}function W(){const a=_("token");if(!a)return void t({title:"请先登录",icon:"none"});if(!K.value.trim())return void t({title:"标题不能为空",icon:"none"});if(0===U.value.length)return void t({title:"请至少上传一张图片",icon:"none"});let o=F();const e={title:K.value,content:N.value,image_url_list:U.value,scene:o,relations:M.value.map((a=>({relation_goods_id:a.goods_id,relation_goods_name:a.goods_name,relation_brand_id:a.brand_id,relation_brand_name:a.brand_name,type:a.type,relation_origin:1})))};console.log(e),s({url:j+"/with-state/add-collocation",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a},timeout:5e3,success:a=>{"success"===a.data.status?(t({title:"提交成功"}),K.value="",N.value="",U.value=[],M.value=[],g()):t({title:a.data.msg||"提交失败",icon:"none"})},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}})}return s({url:j+"/goods-types",method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),O.value=a.data.data},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}}),(a,s)=>{const n=V(o("view-logs"),C),_=f,g=i,w=v,j=h,F=y,I=b,P=V(o("relation-picker"),z),Q=x;return d(),e(g,null,{default:l((()=>[c(n),c(g,{style:{width:"100%",overflow:"hidden"}},{default:l((()=>[c(w,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(d(!0),r(p,null,u(U.value,((a,o)=>(d(),e(g,{class:"upload_item",key:o},{default:l((()=>[c(_,{src:a,class:"uploaded_image",onClick:R,mode:"aspectFill"},null,8,["src"]),c(_,{src:D,class:"close_icon",onClick:a=>function(a){U.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)))),128)),c(g,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[c(_,{src:B,class:"upload_img",onClick:s[0]||(s[0]=o=>async function(){try{const a=await A(9);for(const o of a){const a=await G();await J(o,a.token,a.path),U.value.push(L+a.path)}t({title:`成功上传${a.length}张图片`,icon:"success"})}catch(a){console.error("上传出错:",a),t({title:"部分图片上传失败",icon:"none"})}}(a.index)),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1})])),_:1}),c(j,{modelValue:K.value,"onUpdate:modelValue":s[1]||(s[1]=a=>K.value=a),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),c(g,{class:"oneLine"}),c(F,{modelValue:N.value,"onUpdate:modelValue":s[2]||(s[2]=a=>N.value=a),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),c(g,{class:"oneLine"}),c(g,{class:""},{default:l((()=>[c(g,{class:"relation-trigger",onClick:H},{default:l((()=>[c(I,{class:"placeholder"},{default:l((()=>[m("点击关联娃物")])),_:1}),c(_,{src:T,class:"arrow-icon"})])),_:1})])),_:1}),c(g,{class:"publish-detail"},{default:l((()=>[c(I,null,{default:l((()=>[m("* 分享您对于打扮BJD的想法✨。")])),_:1}),c(I,null,{default:l((()=>[m("* 不关联商品的搭配不会出现在广场中。")])),_:1}),c(I,null,{default:l((()=>[m("* 可以是BJD相关的贩售广告，但不可以滥用关联。")])),_:1})])),_:1}),c(g,{class:"saveCollocationDataList"},{default:l((()=>[(d(!0),r(p,null,u(M.value,((a,o)=>(d(),e(g,{key:o},{default:l((()=>[c(g,{class:"saveCollocationDataItem"},{default:l((()=>[a.goods_image?(d(),e(_,{key:0,src:a.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(d(),e(I,{key:1,class:"no-image"},{default:l((()=>[m("?")])),_:1})),c(I,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[m(k(a.type)+" "+k(a.brand_name)+" - "+k(a.goods_name),1)])),_:2},1024),c(_,{src:D,class:"close_icon",onClick:a=>function(a){M.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),c(P,{visible:S.value,"onUpdate:visible":s[3]||(s[3]=a=>S.value=a),typeList:O.value,goodsList:E.value,onConfirm:$,onCancel:q},null,8,["visible","typeList","goodsList"]),c(g,{class:"footer"},{default:l((()=>[c(Q,{onClick:W},{default:l((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-28bc1bbe"]]);export{P as default};
