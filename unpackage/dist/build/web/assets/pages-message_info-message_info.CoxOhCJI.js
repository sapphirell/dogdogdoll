import{h as a,aa as e,_ as s,a9 as t,k as l,c as r,w as i,l as u,C as o,ad as d,g as n,o as c,a as m,b as f,t as _,f as v,D as p,i as g,W as h}from"./index-u2rUIk8T.js";import{_ as y}from"./uni-icons.dt1Wr7gO.js";import{r as w}from"./uni-app.es.DpDa-E5E.js";import{b as x,w as k}from"./config.DgkxgtZ3.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=j({__name:"message_info",props:["message_id"],setup(j){const z=j,D=a(null),b=a(!0),C=a(""),I=a(""),A=async()=>{try{if(b.value=!0,C.value="",!I.value)return void(C.value="无效的消息ID");if(!(await x()))return void(C.value="请先登录");const a=await u({url:`${k}/with-state/message-detail`,method:"GET",data:{id:I.value},header:{Authorization:o("token")}});"success"===a.data.status?(D.value=a.data.data,d("message-status-update",{id:I.value,is_read:1})):C.value=a.data.msg||"获取详情失败"}catch(a){C.value="请求失败，请检查网络",console.error("详情请求失败:",a)}finally{b.value=!1}};return e((()=>{s({title:"消息详情"}),I.value=z.message_id,A()})),(a,e)=>{const s=t("uni-load-more"),u=n,o=w(l("uni-icons"),y),d=v,x=p,k=g,j=h;return c(),r(u,{class:"container"},{default:i((()=>[b.value?(c(),r(u,{key:0,class:"loading-wrapper"},{default:i((()=>[m(s,{status:"loading"})])),_:1})):C.value?(c(),r(u,{key:1,class:"error-wrapper"},{default:i((()=>[m(o,{type:"info",size:"24",color:"#ff4d4f"}),m(d,{class:"error-text"},{default:i((()=>[f(_(C.value),1)])),_:1}),m(x,{class:"retry-btn",onClick:A},{default:i((()=>[f("重试")])),_:1})])),_:1})):(c(),r(j,{key:2,class:"content-wrapper","scroll-y":""},{default:i((()=>[m(k,{class:"cover-image",src:D.value.cover_image,mode:"widthFix","lazy-load":""},null,8,["src"]),m(u,{class:"main-content"},{default:i((()=>[m(u,{class:"header"},{default:i((()=>[m(d,{class:"title"},{default:i((()=>[f(_(D.value.title),1)])),_:1}),m(d,{class:"time"},{default:i((()=>{return[f(_((a=D.value.created_at,new Date(1e3*a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1})])),_:1}),m(u,{class:"message-content"},{default:i((()=>[m(d,{class:"message-text"},{default:i((()=>[f(_(D.value.msg),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-e33a478d"]]);export{z as default};
