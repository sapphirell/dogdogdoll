import{r as a,M as e,a3 as t,a as l,c as s,w as i,q as c,A as o,j as u,g as n,b as r,B as d,d as v,e as _,t as m,D as f,v as g,x as p,F as h,p as k,i as y,f as b}from"./index-I3aG4WZL.js";import{_ as w}from"./view-logs.C4HVuFxK.js";import{_ as $,c as F,b as C,r as S}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{_ as z}from"./uni-icons.BQtdpjJ2.js";import{w as j}from"./config.BjeWXQ7P.js";const x=$({__name:"user_page",props:["uid"],setup($){const x=a(0),D=a(["搭配","娃柜","点评"]),T=$,A=a({avatar:"",user_name:"加载中..."}),E=a(!1),G=a(!1),L=a([]),M=a([]),q=a([]),B=a([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e(x,(a=>{B.value[a];0===[L,M,q][a].value.length&&I()}));const I=async()=>{if(E.value||G.value)return;const a=B.value[x.value];if(!a.loading&&!a.finished){a.loading=!0;try{let e,t;switch(x.value){case 0:e=`/user-info/collection?user_id=${T.uid}&page=${a.page}`,t="List";break;case 1:e=`/user-info/show-case?user_id=${T.uid}&page=${a.page}`,t="List";break;case 2:e=`/user-info/posts?user_id=${T.uid}&page=${a.page}`,t="comment_list"}const l=await c({url:`${j}${e}`});if("success"===l.data.status){const e=l.data.data,s=e[t].map((a=>{var e,t,l;switch(x.value){case 0:return{id:a.id,cover:(null==(e=a.image_urls)?void 0:e.split(",")[0])||"",images:(null==(t=a.image_urls)?void 0:t.split(","))||[],title:a.title,time:a.created_at};case 1:return{id:a.id,cover:(null==(l=a.image_urls)?void 0:l.split(",")[0])||"",title:a.name,desc:a.description,time:a.created_at};case 2:return{id:a.id,product_thumb:a.target_image,product_name:a.target_name,content:a.comment,create_time:P(a.created_at)}}})),i=[L,M,q][x.value];i.value=[...i.value,...s],a.total=e.total,a.finished=i.value.length>=e.total,a.page++}}catch(e){console.log(e),o({title:"数据加载失败",icon:"none"})}finally{a.loading=!1}}},O=async()=>{try{const a=u("token");if(!a)return void console.log("未登录");const e=E.value?"remove":"add",t=await c({url:`${j}/with-state/blacklist/${e}?target_user_id=`+T.uid,method:"POST",header:{Authorization:a}});"success"===t.data.status?(E.value=!E.value,o({title:E.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(E.value||G.value)&&(L.value=[],M.value=[],q.value=[])):o({title:t.data.msg,icon:"none"})}catch(a){console.log("操作失败",a),o({title:"操作失败",icon:"none"})}},P=a=>{const e=new Date(1e3*a);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`};return t({title:"用户主页"}),F((()=>{(async()=>{try{const a=await c({url:`${j}/user-info?uid=${T.uid}`});"success"===a.data.status&&(A.value=a.data.data)}catch(a){o({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const a=u("token");if(a)try{const e=await c({url:`${j}/with-state/blacklist/status`,method:"GET",data:{target_user_id:T.uid},header:{Authorization:a}});"success"===e.data.status&&(E.value=e.data.data.is_blocked,G.value=e.data.data.they_blocked)}catch(e){console.log("获取黑名单状态失败",e)}else console.log("未登录")})().then((()=>{E.value||G.value||I()}))})),C((()=>{I()})),(a,e)=>{const t=S(l("view-logs"),w),c=y,o=b,u=n,$=S(l("uni-icons"),z);return r(),s(u,{class:"page-container"},{default:i((()=>[d("meta",{name:"theme-color",content:"#F8F8F8"}),v(t),v(u,{class:"header_container"},{default:i((()=>[v(u,{class:"user-info-container"},{default:i((()=>[v(u,{class:"user-info-box"},{default:i((()=>[v(c,{class:"avatar",src:A.value.avatar,mode:"aspectFill"},null,8,["src"]),v(o,{class:"username"},{default:i((()=>[_(m(A.value.user_name),1)])),_:1})])),_:1}),v(u,{class:"action-buttons"},{default:i((()=>[v(u,{class:f(["action-btn block-btn",{blocked:E.value}]),onClick:O},{default:i((()=>[v($,{type:(E.value,"minus"),size:"16",color:"#fff"},null,8,["type"]),v(o,null,{default:i((()=>[_(m(E.value?"已拉黑":"拉黑"),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),E.value||G.value?k("",!0):(r(),s(u,{key:0,class:"content"},{default:i((()=>[v(u,{class:"tabs-container"},{default:i((()=>[v(u,{class:"tabs"},{default:i((()=>[(r(!0),g(h,null,p(D.value,((a,e)=>(r(),s(u,{key:e,class:f(["tab-item font-alimamashuhei",{active:x.value===e}]),onClick:a=>x.value=e},{default:i((()=>[_(m(a),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),0===x.value?(r(),s(u,{key:0,class:"collocation-list"},{default:i((()=>[(r(!0),g(h,null,p(L.value,((e,t)=>(r(),s(u,{key:t,class:"collocation-item item-image-container",onClick:t=>a.navigateTo(`/pages/collocation_share/collocation_share?collocation_id=${e.id}`)},{default:i((()=>[v(c,{class:"item-image",src:e.cover,mode:"aspectFill"},null,8,["src"]),v(o,{class:"item-title"},{default:i((()=>[_(m(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("",!0),1===x.value?(r(),s(u,{key:1,class:"doll-list"},{default:i((()=>[(r(!0),g(h,null,p(M.value,((e,t)=>(r(),s(u,{key:t,class:"doll-item item-image-container",onClick:t=>a.navigateTo(`/pages/user_doll/user_doll?id=${e.id}`)},{default:i((()=>[v(c,{class:"item-image",src:e.cover,mode:"aspectFill"},null,8,["src"]),v(o,{class:"item-title"},{default:i((()=>[_(m(e.title),1)])),_:2},1024),v(o,{class:"item-price"},{default:i((()=>[_("¥"+m(e.price),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("",!0),2===x.value?(r(),s(u,{key:2,class:"review-list"},{default:i((()=>[(r(!0),g(h,null,p(q.value,((a,e)=>(r(),s(u,{key:e,class:"review-item"},{default:i((()=>[v(c,{class:"product-thumb",src:a.product_thumb,mode:"aspectFill"},null,8,["src"]),v(u,{class:"review-content"},{default:i((()=>[v(o,{class:"product-name"},{default:i((()=>[_(m(a.product_name),1)])),_:2},1024),v(o,{class:"review-text"},{default:i((()=>[_(m(a.content),1)])),_:2},1024),v(o,{class:"review-time"},{default:i((()=>[_(m(a.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):k("",!0)])),_:1})),E.value||G.value?(r(),s(u,{key:1,class:"empty-state"},{default:i((()=>[v($,{type:"minus",size:"48",color:"#ccc"}),v(o,null,{default:i((()=>[_("你无法查看该用户的主页")])),_:1})])),_:1})):k("",!0)])),_:1})}}},[["__scopeId","data-v-4fd40fbf"]]);export{x as default};
