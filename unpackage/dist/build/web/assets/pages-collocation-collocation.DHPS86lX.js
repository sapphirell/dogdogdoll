import{g as e,j as a,c as o,w as l,l as t,m as s,p as n,o as i,a as d,d as u,r as c,F as r,b as p,C as m,a9 as g,i as _,f as v,S as f,Q as h,Z as x,H as b,t as y,B as k,e as w}from"./index-CfMR_IzQ.js";import{_ as j}from"./common-name-picker.kOmYGZ9v.js";import{r as C}from"./uni-app.es.5AkhYBbN.js";import{_ as I}from"./common-search.CyUK2jK_.js";import{_ as L,a as S}from"./common-modal.B0laTwpj.js";import{_ as T}from"./common-page.Di5NKMGw.js";import{_ as V}from"./cancel.CnEdunnH.js";import{_ as F}from"./add2.S6xx6DwX.js";import{_ as D}from"./right2.s_X9TKoF.js";import{w as G,i as B}from"./config.BX5UpUDr.js";import{c as E,g as U,u as A}from"./image.C6s062kk.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=H({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(H){const P=H,z=e([]),N=e([]),O=e([]),Q=e(!1),Z=e(""),q=e(0),J=e(""),K=e(0),M=e("");function R(e){return new Promise(((a,o)=>{t({url:G+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),a(e.data)},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"}),o(e)},complete:()=>{n()}})}))}const W=e([]);P.goods_id&&P.goods_name&&P.brand_id&&P.brand_name&&P.type&&R(P.goods_id).then((e=>{let a={brand_id:parseInt(P.brand_id,10),goods_id:parseInt(P.goods_id,10),brand_name:P.brand_name,goods_name:P.goods_name,goods_image:e.data.goods_images[0],type:P.type};console.log(a),W.value.push(a)}));const X=e(""),Y=e("");function $(e){k({current:z.value[e],urls:z.value})}function ee(){const e=m("token");if(!e)return void s({title:"请先登录",icon:"none"});if(!X.value.trim()||!Y.value.trim())return void s({title:"标题和正文不能为空",icon:"none"});if(0===z.value.length)return void s({title:"请至少上传一张图片",icon:"none"});const a={title:X.value,content:Y.value,image_url_list:z.value,relation_data_list:W.value.map((e=>({goods_id:e.goods_id,goods_name:e.goods_name,brand_id:e.brand_id,brand_name:e.brand_name,type:e.type})))};console.log(a),t({url:G+"/with-state/add-collocation",method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:e},timeout:5e3,success:e=>{200===e.data.code?(s({title:"提交成功"}),X.value="",Y.value="",z.value=[],W.value=[],g()):s({title:e.data.msg||"提交失败",icon:"none"})},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}})}function ae(e,a){console.log("收到品牌ID:",e),console.log("收到品牌Name:",a),q.value=parseInt(e,10),Z.value=a,t({url:G+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),N.value=e.data.data,console.log(N.value)},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}})}function oe(e,a){console.log("选中的 id:",e),console.log("选中的 name:",a),K.value=parseInt(e,10),J.value=a}function le(e){console.log("选中的值:",e),M.value=e,Q.value=!0}function te(){if(""!=Z.value)if(""!=J.value){if(0==K.value){let e={brand_id:q.value,goods_id:0,brand_name:Z.value,goods_name:J.value,goods_image:"",type:M.value};return W.value.push(e),Q.value=!1,q.value=0,Z.value="",K.value=0,J.value="",void(M.value="")}R(K.value).then((e=>{let a={brand_id:q.value,goods_id:K.value,brand_name:Z.value,goods_name:J.value,goods_image:e.data.goods_images[0],type:M.value};W.value.push(a),Q.value=!1,q.value=0,Z.value="",K.value=0,J.value="",M.value=""}))}else s({title:"请选择或填写商品名称",icon:"none"});else s({title:"请选择或填写品牌名称",icon:"none"})}return t({url:G+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),O.value=e.data.data},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}}),(e,t)=>{const n=_,m=v,g=f,k=h,G=x,H=C(a("common-name-picker"),j),P=w,Z=C(a("common-search"),I),q=C(a("custom-picker"),L),J=b,K=C(a("common-modal"),S),M=C(a("common-page"),T);return i(),o(M,null,{default:l((()=>[d(g,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(i(!0),u(r,null,c(z.value,((e,a)=>(i(),o(m,{class:"upload_item",key:a},{default:l((()=>[d(n,{src:e,class:"uploaded_image",onClick:$,mode:"aspectFill"},null,8,["src"]),d(n,{src:V,class:"close_icon",onClick:e=>function(e){z.value.splice(e,1)}(a)},null,8,["onClick"])])),_:2},1024)))),128)),d(m,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[d(n,{src:F,class:"upload_img",onClick:t[0]||(t[0]=a=>(e.index,console.log("openSelect"),void E().then((e=>{U().then((a=>{console.log(a),A(e,a.token,a.path).then((e=>{200!=e.statusCode&&s({title:"上传失败",icon:"none"}),console.log(B+a.path),z.value.push(B+a.path),s({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),d(k,{modelValue:X.value,"onUpdate:modelValue":t[1]||(t[1]=e=>X.value=e),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),d(m,{class:"oneLine"}),d(G,{modelValue:Y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>Y.value=e),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),d(m,{class:"oneLine"}),d(m,{class:""},{default:l((()=>[d(m,{style:{display:"flex",padding:"10px 15px",position:"relative"}},{default:l((()=>[d(H,{style:{width:"650rpx"},dataList:O.value,placeholder:"关联娃物",onSelect:le},null,8,["dataList"]),d(n,{src:D,style:{width:"20px",height:"20px",margin:"10px",position:"absolute",right:"40rpx"},mode:"aspectFill"})])),_:1})])),_:1}),d(m,{class:"saveCollocationDataList"},{default:l((()=>[(i(!0),u(r,null,c(W.value,((e,a)=>(i(),o(m,{key:a},{default:l((()=>[d(m,{class:"saveCollocationDataItem"},{default:l((()=>[e.goods_image?(i(),o(n,{key:0,src:e.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(i(),o(P,{key:1,class:"no-image"},{default:l((()=>[p("?")])),_:1})),d(P,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[p(y(e.type)+" "+y(e.brand_name)+" - "+y(e.goods_name),1)])),_:2},1024),d(n,{src:V,class:"close_icon",onClick:e=>function(e){W.value.splice(e,1)}(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(K,{visible:Q.value,"onUpdate:visible":t[3]||(t[3]=e=>Q.value=e)},{default:l((()=>[d(m,{class:"selectTab",style:{border:"1px sold #b2b0b4","padding-top":"60rpx"}},{default:l((()=>[d(Z,{mode:"fill",onSelect:ae,width:"calc(100vw - 120px)"}),d(m,{style:{height:"30rpx"}}),d(q,{dataList:N.value,onSelect:oe,margin:"10px 0 0 0px"},null,8,["dataList"]),d(J,{onClick:te,style:{"margin-top":"20px","background-color":"#fff"}},{default:l((()=>[p("确认")])),_:1})])),_:1})])),_:1},8,["visible"]),d(m,{class:"footer"},{default:l((()=>[d(J,{onClick:ee},{default:l((()=>[p("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-94af159a"]]);export{P as default};
