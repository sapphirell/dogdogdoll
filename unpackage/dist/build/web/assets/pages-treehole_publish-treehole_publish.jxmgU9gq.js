import{g as a,_ as e,j as l,X as s,m as t,c as o,w as n,l as u,o as c,p as i,a as r,x as d,b as m,t as p,d as v,r as f,F as h,k as _,q as g,H as b,v as k,a7 as x,e as y,f as j,I as C,i as w,S as F,ao as I,ax as T,a9 as G,ay as S,K as V,G as z}from"./index-B55GPRQF.js";import{_ as A}from"./uni-icons.B2Wm8RW1.js";import{r as E}from"./uni-app.es.CzHle-z4.js";import{_ as K}from"./common-page.Bgp-g0xT.js";import{_ as O}from"./cancel.CnEdunnH.js";import{_ as P}from"./add2.S6xx6DwX.js";import{w as q,i as B}from"./config.BIUptOrH.js";import{c as D,g as H,u as N}from"./image.BvaLdYzg.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=R({__name:"treehole_publish",setup(R){const U=a(""),X=a(0),J=a([]),L=a([]),M=a(""),Q=a(-1),W=a("");function Y(a){z({current:J.value[a],urls:J.value})}function Z(a){X.value=a.detail.value.length>0?1:0}e({title:"投稿树洞"});function $(a){const e=a.detail.value;e>=0&&L.value[e]&&(Q.value=e,M.value=L.value[e].value,W.value=L.value[e].label)}const aa=l((()=>U.value.trim().length>0&&null!==M.value));async function ea(){if(aa.value)if(M.value)try{g({title:"提交中..."});const a=b("token");if(!a)return void _({title:"请先登录",icon:"none"});const e={content:U.value.trim(),images:J.value,is_anonymous:X.value,category_id:M.value},l=await u({url:q+"/with-state/add-submission",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a}});k(),"success"==l.data.status?(_({title:"已收到您的投稿",icon:"success"}),setTimeout((()=>{U.value="",J.value=[],X.value=0,x()}),1500)):_({title:l.data.msg||"提交失败",icon:"none"})}catch(a){k(),console.error("提交失败:",a),_({title:"网络请求失败",icon:"none"})}else _({title:"请选择分类",icon:"none"})}return s((()=>{(async()=>{try{const a=await u({url:q+"/treehole-typelist",method:"GET"});"success"===a.data.status&&(L.value=Object.entries(a.data.data).map((([a,e])=>({value:Number(a),label:e}))))}catch(a){console.error("获取分类失败:",a)}})()})),(a,e)=>{const l=y,s=E(t("uni-icons"),A),u=j,g=C,b=w,k=F,x=I,z=T,q=G,R=S,la=V,sa=E(t("common-page"),K);return c(),o(sa,{title:"发布树洞"},{default:n((()=>[i("meta",{name:"theme-color",content:"#F8F8F8"}),r(u,{class:"publish-box"},{default:n((()=>[r(g,{class:"category-picker",range:L.value,"range-key":"label",onChange:$,value:Q.value},{default:n((()=>[r(u,{class:"picker-content"},{default:n((()=>[r(l,{class:d(["picker-text",M.value?"":"placeholder"])},{default:n((()=>[m(p(W.value||"请选择分类（必选）"),1)])),_:1},8,["class"]),r(s,{type:"right",size:"22",color:"#888"})])),_:1})])),_:1},8,["range","value"]),r(k,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:n((()=>[(c(!0),v(h,null,f(J.value,((e,l)=>(c(),o(u,{class:"upload_item",key:l},{default:n((()=>[r(b,{src:e,class:"uploaded_image",onClick:Y,mode:"aspectFill"},null,8,["src"]),r(b,{src:O,class:"close_icon",onClick:e=>a.deleteImage(l)},null,8,["onClick"])])),_:2},1024)))),128)),r(u,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:n((()=>[r(b,{src:P,class:"upload_img",onClick:e[0]||(e[0]=e=>(a.index,console.log("openSelect"),void D().then((a=>{H().then((e=>{console.log(e),N(a,e.token,e.path).then((a=>{200!=a.statusCode&&_({title:"上传失败",icon:"none"}),console.log(B+e.path),J.value.push(B+e.path),_({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),r(x,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),placeholder:"写下你想说的话...",class:"textarea",maxlength:"500"},null,8,["modelValue"]),r(u,{class:"anonymous"},{default:n((()=>[r(R,{onChange:Z},{default:n((()=>[r(q,null,{default:n((()=>[r(z,{checked:1===X.value,color:"#4cbbd0"},null,8,["checked"]),r(l,null,{default:n((()=>[m("匿名发布")])),_:1})])),_:1})])),_:1})])),_:1}),r(u,{class:"publish-detail"},{default:n((()=>[r(l,null,{default:n((()=>[m("* 目前树洞为非审稿发布，只接受娃圈相关内容。")])),_:1}),r(l,null,{default:n((()=>[m("* 如果勾选匿名发布，他人将无法通过稿件进入您的主页。如果稿件遭到过多点踩或投诉，我们可能会隐藏这封稿件。")])),_:1})])),_:1}),r(la,{class:d(["submit-btn",{disabled:!aa.value}]),onClick:ea},{default:n((()=>[m(" 提交 ")])),_:1},8,["class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-8ced3b2c"]]);export{U as default};
