import{ad as o,C as n,l as t,P as e,O as s,m as a}from"./index-CAhh9jg-.js";const i="https://api.fantuanpu.com",c="https://images1.fantuanpu.com/";let l=o({isLogin:!1,userInfo:{}});function u(){a({title:"请在微信小程序中登录",icon:"none"})}function r(){const o=n("token");if(console.log("token:",o),!o)return console.log("没有token，无法获取用户信息"),void m();console.log("请求接口"),t({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:o},success:o=>{const n=o.data.data;n?(console.log("获取用户信息成功,进行存储",n),h(n)):(console.log("无法获取，清理用户状态"),m())},fail:o=>{p(o,"获取用户信息失败")}})}function d(){return new Promise(((o,e)=>{const s=n("token");if(!s)return m(),void o(null);t({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:s},success:n=>{const t=n.data.data;t?(console.log("返回：",t),h(t),o(t)):(m(),o(null))},fail:n=>{p(n,"获取用户信息失败"),o(null)}})}))}async function f(o,e,s){let c=n("token");return c?(t({url:i+"/with-state/add-vote-score",method:"POST",header:{Authorization:c},data:{target_id:parseInt(s),score:parseInt(e),type:o},success:o=>(console.log(o.data),"success"==o.data.status?(a({title:"评分成功",icon:"success"}),activeModal.value=!1,0):(a({title:o.data.msg,icon:"none"}),0)),fail:o=>{console.log(o),a({title:"网络请求失败",icon:"none"})}}),0):(a({title:"请先登录",icon:"none"}),0)}function g(){return 1}function h(o){e("userInfo",o),e("token",o.last_token),l.userInfo=o,l.isLogin=!0}function m(){s("userInfo"),l.userInfo={},l.isLogin=!1}function p(o,n="请求失败"){console.error(o),a({title:n,icon:"none"})}export{l as a,d as b,u as c,g as d,r as g,c as i,f as v,i as w};
