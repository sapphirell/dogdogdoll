import{b as t,c as e,w as s,d as o,aq as a,v as n,F as i,x as l,a1 as r,H as c,e as h,t as u,f as d,g as p,r as f,o as g,a3 as m,q as w,j as v,A as y,a as _,B as b,p as S,S as x,D as C,u as k,n as T,i as $}from"./index-I3aG4WZL.js";import{_ as X}from"./view-logs.C4HVuFxK.js";import{_ as D,r as F}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{c as W,w as A}from"./config.BjeWXQ7P.js";let Y={},M=null;M=function(){var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0;for(let o=0;o<e.length-1;o++)if(t.indexOf(e[o])>0){s=!1;break}return s}(),Y={data:()=>({is_show:"none"}),watch:{show(t){this.is_show=this.show}},created(){this.swipeaction=this.getSwipeAction(),this.swipeaction&&Array.isArray(this.swipeaction.children)&&this.swipeaction.children.push(this)},mounted(){this.is_show=this.show},methods:{closeSwipe(t){this.autoClose&&this.swipeaction&&this.swipeaction.closeOther(this)},change(t){this.$emit("change",t.open),this.is_show!==t.open&&(this.is_show=t.open)},appTouchStart(t){if(M)return;const{clientX:e}=t.changedTouches[0];this.clientX=e,this.timestamp=(new Date).getTime()},appTouchEnd(t,e,s,o){if(M)return;const{clientX:a}=t.changedTouches[0];let n=Math.abs(this.clientX-a),i=(new Date).getTime()-this.timestamp;n<40&&i<300&&this.$emit("click",{content:s,index:e,position:o})},onClickForPC(t,e,s){M&&this.$emit("click",{content:e,index:t,position:s})}}};var O=!1;function z(t,e){var s=t.instance,o=s.getDataset().disabled,a=s.getState();I(s,e),(o=("string"==typeof o?JSON.parse(o):o)||!1)||(s.requestAnimationFrame((function(){s.removeClass("ani"),e.callMethod("closeSwipe")})),a.x=a.left||0,function(t){var e=t.instance,s=e.getState();E(e);var o=t.touches[0];O&&N()&&(o=t);s.startX=o.clientX,s.startY=o.clientY}(t))}function P(t,e){var s=t.instance,o=s.getDataset().disabled,a=s.getState();(o=("string"==typeof o?JSON.parse(o):o)||!1)||(!function(t){var e=t.instance.getState(),s=t.touches[0];O&&N()&&(s=t);e.deltaX=s.clientX-e.startX,e.deltaY=s.clientY-e.startY,e.offsetY=Math.abs(e.deltaY),e.offsetX=Math.abs(e.deltaX),e.direction=e.direction||function(t,e){if(t>e&&t>10)return"horizontal";if(e>t&&e>10)return"vertical";return""}(e.offsetX,e.offsetY)}(t),"horizontal"===a.direction&&(t.preventDefault&&t.preventDefault(),q(a.x+a.deltaX,s)))}function j(t,e){var s=t.instance,o=s.getDataset().disabled,a=s.getState();(o=("string"==typeof o?JSON.parse(o):o)||!1)||function(t,e,s){var o=e.getState(),a=o.threshold;o.position;var n=o.isopen||"none",i=o.leftWidth,l=o.rightWidth;if(0===o.deltaX)return void B("none",e,s);B("none"===n&&l>0&&-t>a||"none"!==n&&l>0&&l+t<a?"right":"none"===n&&i>0&&t>a||"none"!==n&&i>0&&i-t<a?"left":"none",e,s)}(a.left,s,e)}function q(t,e,s){t=t||0;var o,a,n,i=e.getState(),l=i.leftWidth,r=i.rightWidth;i.left=(o=t,a=-r,n=l,Math.min(Math.max(o,a),n)),e.requestAnimationFrame((function(){e.setStyle({transform:"translateX("+i.left+"px)","-webkit-transform":"translateX("+i.left+"px)"})}))}function I(t,e){var s,o,a=t.getState(),n=e.selectComponent(".button-group--left"),i=e.selectComponent(".button-group--right");s=n.getBoundingClientRect(),o=i.getBoundingClientRect(),a.leftWidth=s.width||0,a.rightWidth=o.width||0,a.threshold=t.getDataset().threshold}function B(t,e,s){var o=e.getState(),a=o.leftWidth,n=o.rightWidth,i="";switch(o.isopen=o.isopen?o.isopen:"none",t){case"left":i=a;break;case"right":i=-n;break;default:i=0}o.isopen!==t&&(o.throttle=!0,s.callMethod("change",{open:t})),o.isopen=t,e.requestAnimationFrame((function(){e.addClass("ani"),q(i,e)}))}function E(t){var e=t.getState();e.direction="",e.deltaX=0,e.deltaY=0,e.offsetX=0,e.offsetY=0}function N(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,o=0;o<e.length-1;o++)if(t.indexOf(e[o])>0){s=!1;break}return s}"object"==typeof window&&(O=!0);var J=!1;const R={showWatch:function(t,e,s,o){var a=o.getState();I(o,s),t&&"none"!==t?B(t,o,s):(a.left&&B("none",o,s),E(o))},touchstart:z,touchmove:P,touchend:j,mousedown:function(t,e){O&&N()&&(z(t,e),J=!0)},mousemove:function(t,e){O&&N()&&J&&P(t)},mouseup:function(t,e){O&&N()&&(j(t,e),J=!1)},mouseleave:function(t,e){O&&N()&&(J=!1)}},G=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("wxsswipe"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.wxsswipe=R}})},H={showWatch(t,e,s,o,a){var n=a.state;(s.$el||s.$vm&&s.$vm.$el)&&(this.getDom(o,s,a),t&&"none"!==t?this.openState(t,o,s,a):(n.left&&this.openState("none",o,s,a),this.resetTouchStatus(o,a)))},touchstart(t,e,s){let o=t.instance,a=o.getDataset().disabled,n=s.state;this.getDom(o,e,s),a=this.getDisabledType(a),a||(o.requestAnimationFrame((function(){o.removeClass("ani"),e.callMethod("closeSwipe")})),n.x=n.left||0,this.stopTouchStart(t,e,s))},touchmove(t,e,s){let o=t.instance;if(!o)return;let a=o.getDataset().disabled,n=s.state;if(a=this.getDisabledType(a),a)return;if(this.stopTouchMove(t,s),"horizontal"!==n.direction)return;t.preventDefault&&t.preventDefault();let i=n.x+n.deltaX;this.move(i,o,e,s)},touchend(t,e,s){let o=t.instance,a=o.getDataset().disabled,n=s.state;a=this.getDisabledType(a),a||this.moveDirection(n.left,o,e,s)},move(t,e,s,o){t=t||0;let a=o.state,n=a.leftWidth,i=a.rightWidth;a.left=this.range(t,-i,n),e.requestAnimationFrame((function(){e.setStyle({transform:"translateX("+a.left+"px)","-webkit-transform":"translateX("+a.left+"px)"})}))},getDom(t,e,s){var o=s.state,a=e.$el||e.$vm&&e.$vm.$el,n=a.querySelector(".button-group--left"),i=a.querySelector(".button-group--right");o.leftWidth=n.offsetWidth||0,o.rightWidth=i.offsetWidth||0,o.threshold=t.getDataset().threshold},getDisabledType:t=>("string"==typeof t?JSON.parse(t):t)||!1,range:(t,e,s)=>Math.min(Math.max(t,e),s),moveDirection(t,e,s,o){var a=o.state,n=a.threshold;a.position;var i=a.isopen||"none",l=a.leftWidth,r=a.rightWidth;0!==a.deltaX?"none"===i&&r>0&&-t>n||"none"!==i&&r>0&&r+t<n?this.openState("right",e,s,o):"none"===i&&l>0&&t>n||"none"!==i&&l>0&&l-t<n?this.openState("left",e,s,o):this.openState("none",e,s,o):this.openState("none",e,s,o)},openState(t,e,s,o){let a=o.state,n=a.leftWidth,i=a.rightWidth,l="";switch(a.isopen=a.isopen?a.isopen:"none",t){case"left":l=n;break;case"right":l=-i;break;default:l=0}a.isopen!==t&&(a.throttle=!0,s.callMethod("change",{open:t})),a.isopen=t,e.requestAnimationFrame((()=>{e.addClass("ani"),this.move(l,e,s,o)}))},getDirection:(t,e)=>t>e&&t>10?"horizontal":e>t&&e>10?"vertical":"",resetTouchStatus(t,e){let s=e.state;s.direction="",s.deltaX=0,s.deltaY=0,s.offsetX=0,s.offsetY=0},stopTouchStart(t,e,s){let o=t.instance,a=s.state;this.resetTouchStatus(o,s);var n=t.touches[0];a.startX=n.clientX,a.startY=n.clientY},stopTouchMove(t,e){t.instance;let s=e.state,o=t.touches[0];s.deltaX=o.clientX-s.startX,s.deltaY=o.clientY-s.startY,s.offsetY=Math.abs(s.deltaY),s.offsetX=Math.abs(s.deltaX),s.direction=s.direction||this.getDirection(s.offsetX,s.offsetY)}},U={mounted(t,e,s){this.state={}},methods:{showWatch(t,e,s,o){H.showWatch(t,e,s,o,this)},touchstart(t,e){H.touchstart(t,e,this)},touchmove(t,e){H.touchmove(t,e,this)},touchend(t,e){H.touchend(t,e,this)}}},K=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("renderswipe"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.renderswipe=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push(U)},L={mixins:[Y,{},{}],emits:["click","change"],props:{show:{type:String,default:"none"},disabled:{type:Boolean,default:!1},autoClose:{type:Boolean,default:!0},threshold:{type:Number,default:20},leftOptions:{type:Array,default:()=>[]},rightOptions:{type:Array,default:()=>[]}},unmounted(){this.__isUnmounted=!0,this.uninstall()},methods:{uninstall(){this.swipeaction&&this.swipeaction.children.forEach(((t,e)=>{t===this&&this.swipeaction.children.splice(e,1)}))},getSwipeAction(t="uniSwipeAction"){let e=this.$parent,s=e.$options.name;for(;s!==t;){if(e=e.$parent,!e)return!1;s=e.$options.name}return e}}};G(L),K(L);const Q=D(L,[["render",function(f,g,m,w,v,y){const _=d,b=p;return t(),e(b,{class:"uni-swipe"},{default:s((()=>[o(b,{class:"uni-swipe_box","change:prop":f.wxsswipe.showWatch,prop:f.is_show,"data-threshold":m.threshold,"data-disabled":m.disabled,onTouchstart:f.wxsswipe.touchstart,onTouchmove:f.wxsswipe.touchmove,onTouchend:f.wxsswipe.touchend},{default:s((()=>[o(b,{class:"uni-swipe_button-group button-group--left"},{default:s((()=>[a(f.$slots,"left",{},(()=>[(t(!0),n(i,null,l(m.leftOptions,((a,n)=>(t(),e(b,{key:n,style:r({backgroundColor:a.style&&a.style.backgroundColor?a.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:c(f.appTouchStart,["stop"]),onTouchend:c((t=>f.appTouchEnd(t,n,a,"left")),["stop"]),onClick:c((t=>f.onClickForPC(n,a,"left")),["stop"])},{default:s((()=>[o(_,{class:"uni-swipe_button-text",style:r({color:a.style&&a.style.color?a.style.color:"#FFFFFF",fontSize:a.style&&a.style.fontSize?a.style.fontSize:"16px"})},{default:s((()=>[h(u(a.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onTouchstart","onTouchend","onClick"])))),128))]),!0)])),_:3}),o(b,{class:"uni-swipe_text--center"},{default:s((()=>[a(f.$slots,"default",{},void 0,!0)])),_:3}),o(b,{class:"uni-swipe_button-group button-group--right"},{default:s((()=>[a(f.$slots,"right",{},(()=>[(t(!0),n(i,null,l(m.rightOptions,((a,n)=>(t(),e(b,{key:n,style:r({backgroundColor:a.style&&a.style.backgroundColor?a.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:c(f.appTouchStart,["stop"]),onTouchend:c((t=>f.appTouchEnd(t,n,a,"right")),["stop"]),onClick:c((t=>f.onClickForPC(n,a,"right")),["stop"])},{default:s((()=>[o(_,{class:"uni-swipe_button-text",style:r({color:a.style&&a.style.color?a.style.color:"#FFFFFF",fontSize:a.style&&a.style.fontSize?a.style.fontSize:"16px"})},{default:s((()=>[h(u(a.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onTouchstart","onTouchend","onClick"])))),128))]),!0)])),_:3})])),_:3},8,["change:prop","prop","data-threshold","data-disabled","onTouchstart","onTouchmove","onTouchend"])])),_:3})}],["__scopeId","data-v-cb00ce77"]]);const V=D({name:"uniSwipeAction",data:()=>({}),created(){this.children=[]},methods:{resize(){},closeAll(){this.children.forEach((t=>{t.is_show="none"}))},closeOther(t){this.openItem&&this.openItem!==t&&(this.openItem.is_show="none"),this.openItem=t}}},[["render",function(o,n,i,l,r,c){const h=p;return t(),e(h,null,{default:s((()=>[a(o.$slots,"default")])),_:3})}]]),Z=D({__name:"message_list",setup(a){const r=f([]),c=f(0),D=f(1),Y=f(!1),M=f(!0),O=f(!1),z=t=>[{text:"删除",style:{backgroundColor:"#dd524d"},data:{type:"delete",id:t.id}},{text:t.is_read?"已读":"标记已读",style:{backgroundColor:"#6fd0d4"},data:{type:"read",id:t.id}}];g((async()=>{await W(),P(),q(),m({title:"消息"})}));const P=async(t=!1)=>{try{O.value=!0;const e=t?D.value:1,s=await w({url:`${A}/with-state/user-messages?page=${e}`,header:{Authorization:v("token")}});if("success"===s.data.status){const o=s.data.data.message_list;r.value=t?[...r.value,...o]:o,M.value=o.length>=10,D.value=e+(M.value?1:0)}}catch(e){y({title:"消息加载失败",icon:"none"})}finally{O.value=!1,Y.value=!1}},j=()=>{console.log("触发加载更多",O.value,M.value),!O.value&&M.value&&P(!0)},q=async()=>{try{const t=await w({url:`${A}/with-state/unread-message-count`,header:{Authorization:v("token")}});"success"===t.data.status&&(c.value=t.data.data.count)}catch(t){y({title:"未读数获取失败",icon:"none"})}},I=t=>{const{type:e,id:s}=t.content.data;"delete"===e?B(s):"read"===e&&N(s)},B=t=>{k({title:"删除确认",content:"确定要删除这条消息吗？",success:e=>{e.confirm&&E(t)}})},E=async t=>{try{await w({url:`${A}/with-state/delete-message`,method:"POST",header:{Authorization:v("token"),"Content-Type":"application/json"},data:{message_id:t}}),r.value=r.value.filter((e=>e.id!==t)),q(),y({title:"删除成功"})}catch(e){y({title:"删除失败",icon:"none"})}},N=async t=>{try{await w({url:`${A}/with-state/mark-message-read`,method:"POST",header:{Authorization:v("token"),"Content-Type":"application/json"},data:{message_id:t}});const e=r.value.find((e=>e.id===t));e&&!e.is_read&&(e.is_read=1,c.value--)}catch(e){y({title:"标记失败",icon:"none"})}},J=t=>{const e=new Date(1e3*t);return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`};return(a,c)=>{const f=F(_("view-logs"),X),g=$,m=d,w=p,v=F(_("uni-swipe-action-item"),Q),y=F(_("uni-swipe-action"),V),k=x;return t(),e(w,{class:"container"},{default:s((()=>[o(f),b("meta",{name:"theme-color",content:"#F8F8F8"}),o(k,{class:"message-list","scroll-y":"",onScrolltolower:j,"show-scrollbar":!1},{default:s((()=>[o(y,null,{default:s((()=>[(t(!0),n(i,null,l(r.value,(a=>(t(),e(v,{key:a.id,"right-options":z(a),threshold:.4,onClick:I},{default:s((()=>[o(w,{class:"message-item",onClick:t=>{return e=a.id,void T({url:`/pages/message_info/message_info?message_id=${e}`});var e}},{default:s((()=>[o(g,{class:"cover-image",src:a.cover_image,mode:"aspectFill"},null,8,["src"]),o(w,{class:"content"},{default:s((()=>[o(m,{class:"title"},{default:s((()=>[h(u(a.title),1)])),_:2},1024),o(m,{class:C(["msg",{unread:!a.is_read}])},{default:s((()=>[h(u(a.msg),1)])),_:2},1032,["class"])])),_:2},1024),o(m,{class:"time"},{default:s((()=>[h(u(J(a.created_at)),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["right-options"])))),128))])),_:1}),o(w,{class:"loading-wrapper"},{default:s((()=>[O.value?(t(),e(m,{key:0,class:"loading-text"},{default:s((()=>[h("加载中...")])),_:1})):S("",!0),M.value?S("",!0):(t(),e(m,{key:1,class:"loading-text"},{default:s((()=>[h("没有更多数据了")])),_:1}))])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-4c156454"]]);export{Z as default};
