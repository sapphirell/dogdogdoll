import{a2 as e,a as t,b as a,c as s,w as i,d as o,v as l,F as n,x as r,D as u,a1 as d,H as c,g as m,r as _,$ as h,l as p,q as g,A as v,a3 as f,a0 as y,j as b,B as w,C as S,e as C,t as x,T as k,i as I,f as R,h as T,p as z,J as M,n as j,a4 as $,E as P,G as N}from"./index-I3aG4WZL.js";import{_ as F}from"./view-logs.C4HVuFxK.js";import{_ as L,r as B,c as A}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{_ as D}from"./uni-icons.BQtdpjJ2.js";import{_ as E,a as V}from"./comment-input.CvkLMisZ.js";import{a as G,b as O,w as X}from"./config.BjeWXQ7P.js";import"./common-modal.-arcCNZ3.js";import"./switch-search.B16f2bGk.js";import"./goods-search.gE0Nx2pd.js";import"./search.CsIL0f2m.js";import"./cancel.CnEdunnH.js";import"./common-search.CQlKpRi4.js";import"./image.C3pSdXmG.js";const W=L({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),s=Math.ceil(e);for(let i=0;i<this.max;i++)a>i?t.push({activeWitch:"100%"}):s-1===i?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let s=0;s<t.length-1;s++)if(e.indexOf(t[s])>0){a=!1;break}return a},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let s=parseInt(a/(t+this.marginNumber));s=s<0?0:s,s=s>this.max?this.max:s;const i=parseInt(a-(t+this.marginNumber)*s);let o=0;(this._oldValue!==s||this.PC)&&(this._oldValue=s,o=this.allowHalf?i>t/2?s+1:s+.5:s+1,o=Math.max(.5,Math.min(o,this.max)),this.valueSync=o,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(e,_,h,p,g,v){const f=B(t("uni-icons"),D),y=m;return a(),s(y,null,{default:i((()=>[o(y,{ref:"uni-rate",class:"uni-rate"},{default:i((()=>[(a(!0),l(n,null,r(v.stars,((e,t)=>(a(),s(y,{class:u(["uni-rate__icon",{"uni-cursor-not-allowed":h.disabled}]),style:d({"margin-right":v.marginNumber+"px"}),key:t,onTouchstart:c(v.touchstart,["stop"]),onTouchmove:c(v.touchmove,["stop"]),onMousedown:c(v.mousedown,["stop"]),onMousemove:c(v.mousemove,["stop"]),onMouseleave:v.mouseleave},{default:i((()=>[o(f,{color:h.color,size:h.size,type:h.isFill?"star-filled":"star"},null,8,["color","size","type"]),o(y,{style:d({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:i((()=>[o(f,{color:h.disabled?h.disabledColor:h.activeColor,size:h.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]),H=L({__name:"brand",props:["brand_id"],setup(e){const u=e;console.log(u);const c=_(!1);let L=_([]),D=_({page_index:1,page_size:3,total:0});h({title:"加载中"}),p();let H=_(0);const J=_(0),U=_(null),q=_(null);_(1);let K=_({});const Y=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let s=e;null!=t&&(s=t),K.value.id!=s.id?(console.log("item",s),K.value=s,null==(a=q.value)||a.focusInput()):K.value={}},Q=e=>{var t,a,s;let i=b("token");if(!O.isLogin)return void v({title:"请先登录",icon:"none"});console.log("reply_info",K.value);const o={content:e.content,origin:e.origin,target_id:parseInt(u.brand_id),type:1,image_url:e.image_url||"",association_id:e.association_id||0,association_type:e.association_type||0,is_anonymous:e.is_anonymous||0,...K.value.id&&{reply_id:K.value.id,reply_for:K.value.comment,reply_uid:K.value.user_id,parent_id:K.value.parent_id>0?K.value.parent_id:K.value.id}},l={id:Date.now(),content:e.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:O.userInfo.avatar,username:O.userInfo.nickname,is_anonymous:0},...e.association_id&&{association_id:e.association_id,association_type:e.association_type},...e.image_url&&{image_url:e.image_url},...K.value.id&&{reply_id:K.value.id,reply_for:K.value.comment,reply_uid:K.value.user_id,parent_id:K.value.parent_id>0?K.value.parent_id:K.value.id,reply_username:K.value.is_anonymous?"匿名用户":K.value.username}};K.value.id?0===K.value.parent_id?null==(a=U.value)||a.addReplyComment({...l,parent_id:K.value.id}):null==(s=U.value)||s.addReplyComment({...l,parent_id:K.value.parent_id}):null==(t=U.value)||t.addNewComment(l),g({url:X+"/with-state/add-comment",method:"POST",header:{Authorization:i},data:o,success:t=>{var a,s;if("success"==t.data.status){const s=t.data.data,i={...s,...e.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:O.userInfo.avatar,username:O.userInfo.nickname,is_anonymous:0}};s.reply_uid&&K.value.is_anonymous&&(i.reply_username="匿名用户"),null==(a=U.value)||a.updateTempComment(l.id,i),v({title:"评论成功",icon:"success"})}else null==(s=U.value)||s.removeTempComment(l.id),v({title:t.data.msg,icon:"none"})},fail:e=>{var t;null==(t=U.value)||t.removeTempComment(l.id),v({title:"网络请求失败",icon:"none"})}})},Z=e=>{if(console.log(e),!O.isLogin)return v({title:"请先登录",icon:"none"}),void(H.value=0);H.value=e.value,J.value=e.value,async function(){if(0==H.value)return void v({title:"请先评分",icon:"none"});try{let e=b("token");if(!e)return void v({title:"请先登录",icon:"none"});h({title:"提交中..."});const t=await g({url:X+"/with-state/add-vote-score",method:"POST",header:{Authorization:e,"Content-Type":"application/json"},data:{type:1,score:H.value,target_id:parseInt(u.brand_id)}});y(),"success"===t.data.status?(ee(),v({title:"评分成功",icon:"success"})):v({title:t.data.msg||"评分失败",icon:"none"})}catch(e){y(),console.error("评分失败:",e),v({title:"评分失败，请重试",icon:"none"})}}()};function ee(){g({url:X+"/brand-info?id="+u.brand_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),ne.value=e.data.data,f({title:e.data.data.brand_name}),ae()},fail:e=>{console.log(e),v({title:"网络请求失败",icon:"none"})},complete:()=>{y()}})}const te=async()=>{let e=b("token");if(O.isLogin)try{const t=`${X}/with-state/${c.value?"unlike":"add-like"}`,a=await g({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(u.brand_id),type:2}});"success"===a.data.status?(c.value=!c.value,v({title:c.value?"关注成功":"已取消关注",icon:"none"}),ee()):v({title:a.data.msg,icon:"none"})}catch(t){console.error(t),v({title:"操作失败",icon:"none"})}else v({title:"请先登录",icon:"none"})},ae=async()=>{var e;try{const t=await g({url:`${X}/with-state/hasLike?id=${parseInt(u.brand_id)}&type=2`,method:"POST",header:{Authorization:b("token")}});c.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(t){console.error("获取关注状态失败:",t)}};function se(e){const t=new Date(1e3*e),a=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),l=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${s}-${i} ${o}:${l}`}function ie(){g({url:X+"/brand-goods?brand_id="+u.brand_id+"&page="+le.value,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),oe.value.page_index=e.data.data.page_index,oe.value.total=e.data.data.total,oe.value.goods_list=oe.value.goods_list?oe.value.goods_list.concat(e.data.data.goods_list):e.data.data.goods_list,e.data.data.goods_list.length>0&&(le.value+=1),0==e.data.data.goods_list.length&&le.value>1&&v({title:"没有更多数据了",icon:"none"})},fail:e=>{console.log(e),v({title:"网络请求失败",icon:"none"})}})}let oe=_({}),le=_(1),ne=_({});return A((()=>{G(),ee(),ie(),g({url:`${X}/brand-news-list?brand_id=${u.brand_id}&page=${D.value.page_index}&page_size=${D.value.page_size}`,method:"GET",success:e=>{if("success"===e.data.status){const t=e.data.data;L.value=[...L.value,...t.news_list],D.value.total=t.total,t.news_list.length>0&&(D.value.page_index+=1)}else v({title:e.data.msg||"获取图透失败",icon:"none"})},fail:e=>{v({title:"网络请求失败",icon:"none"})}}),O.isLogin?function(e,t){let a=b("token");a&&O.isLogin&&g({url:X+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(t),type:e},success:e=>(console.log(e.data.data),"success"==e.data.status?(J.value=e.data.data.score,e.data.data.score):(v({title:e.data.msg,icon:"none"}),0)),fail:e=>(console.log(e),v({title:"网络请求失败",icon:"none"}),0)})}(1,u.brand_id):H.value=0})),(e,_)=>{const h=B(t("view-logs"),F),p=I,g=R,v=m,f=B(t("uni-rate"),W),y=$,b=T,A=P,G=N,O=B(t("comment-list"),E),X=B(t("comment-input"),V);return a(),s(v,null,{default:i((()=>[w("meta",{name:"theme-color",content:"#F8F8F8"}),o(h),o(p,{src:S(ne).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),o(v,{class:"body"},{default:i((()=>[o(v,null,{default:i((()=>[o(p,{src:S(ne).brand_name_image,mode:"heightFix",style:{height:"60rpx"}},null,8,["src"]),o(g,{style:{float:"right",margin:"5px 0px"}},{default:i((()=>[C(x(S(ne).country_name)+" / "+x(S(ne).type),1)])),_:1}),o(v,{style:{clear:"both"}})])),_:1}),o(v,{style:{margin:"20rpx 0rpx",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},{default:i((()=>[o(v,{style:{display:"flex","align-items":"center","flex-grow":"1"}},{default:i((()=>[o(f,{style:{"margin-top":"5px"},value:S(ne).score,"allow-half":"true",activeColor:"#65C3D6",onChange:Z,"is-fill":"false"},null,8,["value"]),o(g,{style:{"margin-left":"8rpx",position:"relative",top:"5px"}},{default:i((()=>[C(x(S(ne).score)+"（"+x(S(ne).vote_number)+"次评分) ",1)])),_:1})])),_:1}),o(g,{class:"follow",onClick:te,style:d({background:c.value?"#ff6a6c":"#65C3D6"})},{default:i((()=>[C(x(c.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),o(v,{style:{"margin-top":"15px"}},{default:i((()=>[o(g,null,{default:i((()=>[C("别名："+x(S(ne).nickname_list),1)])),_:1})])),_:1}),o(v,{style:{"margin-top":"10px"}},{default:i((()=>[o(g,null,{default:i((()=>[C("简介："+x(S(ne).description),1)])),_:1})])),_:1}),w("div",{style:{clear:"both"}}),o(g,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:i((()=>[C("收录作品 ("+x(S(oe).total)+")",1)])),_:1}),o(v,{class:"brand_goods"},{default:i((()=>[(a(!0),l(n,null,r(S(oe).goods_list,((e,t)=>(a(),s(v,{class:"brand_goods_item",style:{},key:e.id},{default:i((()=>[o(y,{onClick:t=>{return a=e.id,void j({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},{default:i((()=>[o(v,{style:{width:"100%",height:"calc(100% - 20px)"}},{default:i((()=>[o(p,{style:{width:"100%",height:"100%"},src:e.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])])),_:2},1024),o(g,{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},{default:i((()=>[C(x(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),o(b,{class:"load_more",onClick:ie},{default:i((()=>[C("加载更多")])),_:1}),o(g,{class:"section-title"},{default:i((()=>[C("品牌图透 ("+x(S(D).total)+")",1)])),_:1}),o(v,{class:"news-list"},{default:i((()=>[(a(!0),l(n,null,r(S(L),((e,t)=>(a(),s(v,{class:"news-item",style:{position:"relative"},key:e.id},{default:i((()=>[o(v,{class:"news-header"},{default:i((()=>[o(g,{class:"news-header-title"},{default:i((()=>[C(x(e.title),1)])),_:2},1024)])),_:2},1024),e.image_list&&e.image_list.length>0?(a(),s(v,{key:0,class:"news-images"},{default:i((()=>[o(G,{class:"image-swiper",autoplay:!0,circular:!0,"indicator-dots":""},{default:i((()=>[(a(!0),l(n,null,r(e.image_list,((t,l)=>(a(),s(A,{key:l},{default:i((()=>[o(p,{src:t,mode:"aspectFill",class:"swiper-image",onClick:a=>{return s=t,i=e.image_list,void M({current:s,urls:i});var s,i}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):z("",!0),o(v,{class:"news-content"},{default:i((()=>[C(x(e.content),1)])),_:2},1024),o(v,{class:"news-footer"},{default:i((()=>[o(g,{class:"news-time"},{default:i((()=>[C(x(se(e.created_at)),1)])),_:2},1024),o(g,{class:"view-more",onClick:t=>function(e){j({url:`/pages/sale_news/sale_news?id=${e.id}&brand_id=${e.brand_id}`})}(e)},{default:i((()=>[C("查看详情 →")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),o(v,null,{default:i((()=>[o(O,{ref_key:"commentListRef",ref:U,type:1,"relation-id":parseInt(u.brand_id),onReply:Y},null,8,["relation-id"])])),_:1})])),_:1}),o(v,{style:{height:"80px"}}),o(X,{ref_key:"commentInputRef",ref:q,"reply-info":S(K),"target-id":u.brand_id,onSubmit:Q,"onUpdate:replyInfo":_[0]||(_[0]=e=>k(K)?K.value=e:K=e)},null,8,["reply-info","target-id"])])),_:1})}}},[["__scopeId","data-v-2e986380"]]);export{H as default};
