import{r as e,k as a,a as l,v as s,d as o,w as t,F as u,g as d,b as r,e as n,c,t as p,p as i,D as v,q as m,A as w,s as h,V as f,n as _,f as g,N as y,h as b}from"./index-I3aG4WZL.js";import{_ as V}from"./view-logs.C4HVuFxK.js";import{_ as x,r as P}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{w as k}from"./config.BjeWXQ7P.js";const j=x({__name:"register",setup(x){const j=e({telephone:"",code:"",password:"",rePassword:""}),B=e({phone:"",code:"",password:"",rePassword:""}),C=e(0),U=a((()=>C.value>0)),$=a((()=>C.value>0?`${C.value}秒后重发`:"获取验证码")),I=e(!1),T=()=>j.value.telephone?/^1[3-9]\d{9}$/.test(j.value.telephone)?(B.value.phone="",!0):(B.value.phone="手机号格式不正确",!1):(B.value.phone="手机号不能为空",!1),D=async()=>{if(T())try{const e=await m({url:`${k}/send-sms-code`,method:"POST",data:{tel_phone:j.value.telephone}});"success"===e.data.status?(O(),w({title:"验证码已发送",icon:"none"})):w({title:e.data.msg||"发送失败",icon:"none"})}catch(e){w({title:"网络请求失败",icon:"none"})}},O=()=>{C.value=60;const e=setInterval((()=>{C.value<=0?clearInterval(e):C.value--}),1e3)},S=()=>j.value.password.length<6?(B.value.password="密码至少需要6位",!1):(B.value.password="",!0),q=()=>j.value.password!==j.value.rePassword?(B.value.rePassword="两次密码输入不一致",!1):(B.value.rePassword="",!0),A=()=>j.value.code?6!==j.value.code.length?(B.value.code="验证码格式不正确",!1):(B.value.code="",!0):(B.value.code="验证码不能为空",!1),F=async()=>{if([T(),A(),S(),q()].every((e=>e)))try{I.value=!0;const e=await m({url:`${k}/register`,method:"POST",data:{telephone:j.value.telephone,code:j.value.code,password:j.value.password,re_password:j.value.rePassword}});"success"===e.data.status?(h("token",e.data.data.jwt_token),w({title:"注册成功",icon:"success",complete:()=>{setTimeout((()=>{f({url:"/pages/mine/mine"})}),1500)}})):w({title:e.data.msg||"注册失败",icon:"none"})}catch(e){w({title:"网络请求失败",icon:"none"})}finally{I.value=!1}},G=()=>{_({url:"/pages/login/login"})};return(e,a)=>{const m=P(l("view-logs"),V),w=g,h=d,f=y,_=b;return r(),s(u,null,[o(m),o(h,{class:"container"},{default:t((()=>[o(h,{class:"header"},{default:t((()=>[o(w,{class:"title"},{default:t((()=>[n("手机号注册")])),_:1})])),_:1}),o(h,{class:"form-box"},{default:t((()=>[o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(w,{class:"prefix"},{default:t((()=>[n("+86")])),_:1}),o(f,{modelValue:j.value.telephone,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:T},null,8,["modelValue"])])),_:1}),B.value.phone?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(B.value.phone),1)])),_:1})):i("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"code-wrapper"},{default:t((()=>[o(f,{modelValue:j.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>j.value.code=e),type:"number",autocomplete:"new-password",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:A},null,8,["modelValue"]),o(_,{class:v(["code-btn",{disabled:U.value}]),disabled:U.value,onClick:D},{default:t((()=>[n(p($.value),1)])),_:1},8,["disabled","class"])])),_:1}),B.value.code?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(B.value.code),1)])),_:1})):i("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(f,{modelValue:j.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>j.value.password=e),autocomplete:"new-password",type:"password",placeholder:"请输入密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:S},null,8,["modelValue"])])),_:1}),B.value.password?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(B.value.password),1)])),_:1})):i("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(f,{modelValue:j.value.rePassword,"onUpdate:modelValue":a[3]||(a[3]=e=>j.value.rePassword=e),type:"password",placeholder:"请再次输入密码",class:"input","placeholder-class":"placeholder",onBlur:q},null,8,["modelValue"])])),_:1}),B.value.rePassword?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(B.value.rePassword),1)])),_:1})):i("",!0)])),_:1}),o(_,{class:v(["submit-btn",{loading:I.value}]),disabled:I.value,onClick:F},{default:t((()=>[n(p(I.value?"注册中...":"立即注册"),1)])),_:1},8,["disabled","class"]),o(h,{class:"bottom-tips"},{default:t((()=>[n(" 已有账号？ "),o(w,{class:"link-text",onClick:G},{default:t((()=>[n("去登录")])),_:1})])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-e4f2374a"]]);export{j as default};
