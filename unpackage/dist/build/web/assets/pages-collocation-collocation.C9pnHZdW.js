import{r as a,a as o,c as e,w as l,q as s,A as t,a0 as n,g as i,b as d,d as c,v as r,x as u,F as p,e as m,j as _,ab as g,i as f,S as v,N as h,ar as y,f as b,h as x,t as k,J as w}from"./index-I3aG4WZL.js";import{_ as j}from"./view-logs.C4HVuFxK.js";import{_ as C,r as L}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{_ as V}from"./relation-picker.n1AK3sgz.js";import{_ as F}from"./cancel.CnEdunnH.js";import{_ as z}from"./add2.S6xx6DwX.js";import{_ as D}from"./right2.s_X9TKoF.js";import{w as I,i as J,g as T}from"./config.BjeWXQ7P.js";import{c as U,g as B,u as E}from"./image.C3pSdXmG.js";import"./uni-icons.BQtdpjJ2.js";import"./common-search.CQlKpRi4.js";import"./search.CsIL0f2m.js";import"./goods-search.gE0Nx2pd.js";import"./common-modal.-arcCNZ3.js";const G=C({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(C){const G=C,A=a([]),P=a([]),S=a([]),q=a(!1);a(""),a(0),a(""),a(0),a("");const K=a=>{try{const o={goods_id:a.goods.id||0,goods_name:a.goods.name,goods_image:a.goods.image||"",brand_id:a.brand.id||0,brand_name:a.brand.name||(a.isFuzzy?"":"未知品牌"),type:a.type||(a.isFuzzy?"未知类型":"")};O.value.some((a=>0!==a.goods_id&&a.goods_id===o.goods_id||a.goods_name===o.goods_name))?t({title:"已存在相同关联项",icon:"none"}):O.value.push(o)}catch(o){console.error("保存关联数据失败:",o),t({title:"保存关联信息失败",icon:"none"})}},M=()=>{console.log("用户取消选择")},N=()=>{q.value=!0};const O=a([]);var Q;G.goods_id&&G.goods_name&&G.brand_id&&G.brand_name&&G.type&&(Q=G.goods_id,new Promise(((a,o)=>{s({url:I+"/goods?id="+Q,method:"GET",timeout:5e3,success:o=>{console.log(o.data.data),a(o.data)},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"}),o(a)},complete:()=>{n()}})}))).then((a=>{let o={brand_id:parseInt(G.brand_id,10),goods_id:parseInt(G.goods_id,10),brand_name:G.brand_name,goods_name:G.goods_name,goods_image:a.data.goods_images[0],type:G.type};console.log(o),O.value.push(o)}));const R=a(""),$=a("");function H(a){w({current:A.value[a],urls:A.value})}function W(){const a=_("token");if(!a)return void t({title:"请先登录",icon:"none"});if(!R.value.trim())return void t({title:"标题不能为空",icon:"none"});if(0===A.value.length)return void t({title:"请至少上传一张图片",icon:"none"});let o=T();const e={title:R.value,content:$.value,image_url_list:A.value,scene:o,relations:O.value.map((a=>({relation_goods_id:a.goods_id,relation_goods_name:a.goods_name,relation_brand_id:a.brand_id,relation_brand_name:a.brand_name,type:a.type,relation_origin:1})))};console.log(e),s({url:I+"/with-state/add-collocation",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a},timeout:5e3,success:a=>{"success"===a.data.status?(t({title:"提交成功"}),R.value="",$.value="",A.value=[],O.value=[],g()):t({title:a.data.msg||"提交失败",icon:"none"})},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}})}return s({url:I+"/goods-types",method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),S.value=a.data.data},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}}),(a,s)=>{const n=L(o("view-logs"),j),_=f,g=i,w=v,C=h,I=y,T=b,G=L(o("relation-picker"),V),Q=x;return d(),e(g,null,{default:l((()=>[c(n),c(g,{style:{width:"100%",overflow:"hidden"}},{default:l((()=>[c(w,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(d(!0),r(p,null,u(A.value,((a,o)=>(d(),e(g,{class:"upload_item",key:o},{default:l((()=>[c(_,{src:a,class:"uploaded_image",onClick:H,mode:"aspectFill"},null,8,["src"]),c(_,{src:F,class:"close_icon",onClick:a=>function(a){A.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)))),128)),c(g,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[c(_,{src:z,class:"upload_img",onClick:s[0]||(s[0]=o=>async function(){try{const a=await U(9);for(const o of a){const a=await B();await E(o,a.token,a.path),A.value.push(J+a.path)}t({title:`成功上传${a.length}张图片`,icon:"success"})}catch(a){console.error("上传出错:",a),t({title:"部分图片上传失败",icon:"none"})}}(a.index)),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1})])),_:1}),c(C,{modelValue:R.value,"onUpdate:modelValue":s[1]||(s[1]=a=>R.value=a),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),c(g,{class:"oneLine"}),c(I,{modelValue:$.value,"onUpdate:modelValue":s[2]||(s[2]=a=>$.value=a),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),c(g,{class:"oneLine"}),c(g,{class:""},{default:l((()=>[c(g,{class:"relation-trigger",onClick:N},{default:l((()=>[c(T,{class:"placeholder"},{default:l((()=>[m("点击关联娃物")])),_:1}),c(_,{src:D,class:"arrow-icon"})])),_:1})])),_:1}),c(g,{class:"publish-detail"},{default:l((()=>[c(T,null,{default:l((()=>[m("* 分享您对于打扮BJD的想法✨。")])),_:1}),c(T,null,{default:l((()=>[m("* 不关联商品的搭配不会出现在广场中。")])),_:1}),c(T,null,{default:l((()=>[m("* 可以是BJD相关的贩售广告，但不可以滥用关联。")])),_:1})])),_:1}),c(g,{class:"saveCollocationDataList"},{default:l((()=>[(d(!0),r(p,null,u(O.value,((a,o)=>(d(),e(g,{key:o},{default:l((()=>[c(g,{class:"saveCollocationDataItem"},{default:l((()=>[a.goods_image?(d(),e(_,{key:0,src:a.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(d(),e(T,{key:1,class:"no-image"},{default:l((()=>[m("?")])),_:1})),c(T,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[m(k(a.type)+" "+k(a.brand_name)+" - "+k(a.goods_name),1)])),_:2},1024),c(_,{src:F,class:"close_icon",onClick:a=>function(a){O.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),c(G,{visible:q.value,"onUpdate:visible":s[3]||(s[3]=a=>q.value=a),typeList:S.value,goodsList:P.value,onConfirm:K,onCancel:M},null,8,["visible","typeList","goodsList"]),c(g,{class:"footer"},{default:l((()=>[c(Q,{onClick:W},{default:l((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-28bc1bbe"]]);export{G as default};
