import{V as e,j as t,o as a,c as l,w as o,a as s,d as i,F as n,r,q as u,U as d,z as c,f as h,g as m,s as f,h as p,l as g,W as _,m as y,p as v,C as b,k as x,u as S,b as C,t as w,v as k,N as z,i as I,e as R,H as N,n as M,X as P}from"./index-CAhh9jg-.js";import{_ as T}from"./uni-icons.DApveqxl.js";import{r as F}from"./uni-app.es.CI_TJZj7.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as V,a as j}from"./comment-input.Koi9PTNE.js";import{w as B,a as X,v as $}from"./config.D_tpLRWx.js";const A=L({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),l=Math.ceil(e);for(let o=0;o<this.max;o++)a>o?t.push({activeWitch:"100%"}):l-1===o?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let l=0;l<t.length-1;l++)if(e.indexOf(t[l])>0){a=!1;break}return a},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let l=parseInt(a/(t+this.marginNumber));l=l<0?0:l,l=l>this.max?this.max:l;const o=parseInt(a-(t+this.marginNumber)*l);let s=0;(this._oldValue!==l||this.PC)&&(this._oldValue=l,s=this.allowHalf?o>t/2?l+1:l+.5:l+1,s=Math.max(.5,Math.min(s,this.max)),this.valueSync=s,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(e,m,f,p,g,_){const y=F(t("uni-icons"),T),v=h;return a(),l(v,null,{default:o((()=>[s(v,{ref:"uni-rate",class:"uni-rate"},{default:o((()=>[(a(!0),i(n,null,r(_.stars,((e,t)=>(a(),l(v,{class:u(["uni-rate__icon",{"uni-cursor-not-allowed":f.disabled}]),style:d({"margin-right":_.marginNumber+"px"}),key:t,onTouchstart:c(_.touchstart,["stop"]),onTouchmove:c(_.touchmove,["stop"]),onMousedown:c(_.mousedown,["stop"]),onMousemove:c(_.mousemove,["stop"]),onMouseleave:_.mouseleave},{default:o((()=>[s(y,{color:f.color,size:f.size,type:f.isFill?"star-filled":"star"},null,8,["color","size","type"]),s(v,{style:d({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:o((()=>[s(y,{color:f.disabled?f.disabledColor:f.activeColor,size:f.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]),W=L({__name:"brand",props:["brand_id"],setup(e){const c=e;console.log(c);const T=m(!1),L=m(!1);f({title:"加载中"}),p();let W=m(0);const O=m(null),E=m(null);m(1);let U=m({});const G=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let l=e;null!=t&&(l=t),U.value.id!=l.id?(console.log("item",l),U.value=l,null==(a=E.value)||a.focusInput()):U.value={}},H=({content:e,replyInfo:t,origin:a})=>{let l=b("token");if(!X.isLogin)return void y({title:"请先登录",icon:"none"});console.log("reply_info",t);const o={content:e,origin:a,target_id:parseInt(pageId.value),type:1,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};g({url:B+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:o,success:e=>{var t,a;if("success"==e.data.status){const l=e.data.data;0===l.parent_id?null==(t=O.value)||t.addNewComment(l):null==(a=O.value)||a.addReplyComment(l),y({title:"评论成功",icon:"success"})}else y({title:e.data.msg,icon:"none"})},fail:e=>{y({title:"网络请求失败",icon:"none"})}})};function q(){0!=W.value?W.value>5?y({title:"评分不能大于5",icon:"none"}):(console.log(W.value,c.brand_id),$(1,W.value,c.brand_id)):y({title:"请先评分",icon:"none"})}function D(){g({url:B+"/brand-info?id="+c.brand_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),te.value=e.data.data,_({title:e.data.data.brand_name}),K()},fail:e=>{console.log(e),y({title:"网络请求失败",icon:"none"})},complete:()=>{v()}})}const J=async()=>{let e=b("token");if(X.isLogin)try{const t=`${B}/with-state/${T.value?"unlike":"add-like"}`,a=await g({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(c.brand_id),type:2}});"success"===a.data.status?(T.value=!T.value,y({title:T.value?"关注成功":"已取消关注",icon:"none"}),D()):y({title:a.data.msg,icon:"none"})}catch(t){console.error(t),y({title:"操作失败",icon:"none"})}else y({title:"请先登录",icon:"none"})},K=async()=>{var e;try{const t=await g({url:`${B}/with-state/hasLike?id=${parseInt(c.brand_id)}&type=2`,method:"POST",header:{Authorization:b("token")}});T.value=(null==(e=t.data.data)?void 0:e.id)>0}catch(t){console.error("获取关注状态失败:",t)}};function Q(){g({url:B+"/brand-goods?brand_id="+c.brand_id+"&page="+ee.value,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),Z.value.page_index=e.data.data.page_index,Z.value.total=e.data.data.total,Z.value.goods_list=Z.value.goods_list?Z.value.goods_list.concat(e.data.data.goods_list):e.data.data.goods_list,e.data.data.goods_list.length>0&&(ee.value+=1),0==e.data.data.goods_list.length&&ee.value>1&&y({title:"没有更多数据了",icon:"none"})},fail:e=>{console.log(e),y({title:"网络请求失败",icon:"none"})}})}function Y(e){L.value=!L.value}let Z=m({}),ee=m(1),te=m({});return D(),Q(),function(e,t){let a=b("token");a&&X.isLogin&&g({url:B+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(t),type:e},success:e=>(console.log(e.data.data),"success"==e.data.status?(W.value=e.data.data.score,e.data.data.score):(y({title:e.data.msg,icon:"none"}),0)),fail:e=>(console.log(e),y({title:"网络请求失败",icon:"none"}),0)})}(1,c.brand_id),(e,m)=>{const f=I,p=R,g=h,_=F(t("uni-rate"),A),y=P,v=N,b=F(t("comment-list"),V),B=F(t("comment-input"),j);return a(),l(g,null,{default:o((()=>[x("meta",{name:"theme-color",content:"#F8F8F8"}),s(f,{src:S(te).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),s(g,{class:"body"},{default:o((()=>[s(g,null,{default:o((()=>[s(p,{style:{float:"left","font-size":"20px"},selectable:"true","user-select":"true"},{default:o((()=>[C(w(S(te).brand_name),1)])),_:1}),s(p,{style:{float:"right",margin:"5px 0px"}},{default:o((()=>[C(w(S(te).country_name)+" / "+w(S(te).type),1)])),_:1}),s(g,{style:{clear:"both"}})])),_:1}),s(g,{style:{margin:"20rpx 0rpx",display:"flex","justify-content":"space-between"}},{default:o((()=>[s(g,{onClick:m[0]||(m[0]=e=>Y()),style:{display:"inline-block",position:"relative",left:"-8rpx"}},{default:o((()=>[s(_,{style:{"margin-top":"5px",float:"left"},value:S(te).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"},null,8,["value"]),s(p,{style:{float:"left",position:"relative",top:"5px"}},{default:o((()=>[C(w(S(te).score)+"（"+w(S(te).vote_number)+"次评分）",1)])),_:1}),s(g,{style:{clear:"both"}})])),_:1}),s(p,{class:"follow",onClick:J,style:d({background:T.value?"#ff6a6c":"#65C3D6"})},{default:o((()=>[C(w(T.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),s(g,{style:{"margin-top":"15px"}},{default:o((()=>[s(p,null,{default:o((()=>[C("别名："+w(S(te).nickname_list),1)])),_:1})])),_:1}),s(g,{style:{"margin-top":"10px"}},{default:o((()=>[s(p,null,{default:o((()=>[C("简介："+w(S(te).description),1)])),_:1})])),_:1}),x("div",{style:{clear:"both"}}),s(p,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:o((()=>[C("收录作品 ("+w(S(Z).total)+")",1)])),_:1}),s(g,{class:"brand_goods"},{default:o((()=>[(a(!0),i(n,null,r(S(Z).goods_list,((e,t)=>(a(),l(g,{class:"brand_goods_item",style:{},key:e.id},{default:o((()=>[s(y,{onClick:t=>{return a=e.id,void M({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},{default:o((()=>[s(g,{style:{width:"100%",height:"calc(100% - 20px)"}},{default:o((()=>[s(f,{style:{width:"100%",height:"100%"},src:e.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])])),_:2},1024),s(p,{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},{default:o((()=>[C(w(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),s(v,{class:"load_more",onClick:Q},{default:o((()=>[C("加载更多")])),_:1}),s(g,null,{default:o((()=>[s(b,{ref_key:"commentListRef",ref:O,type:1,"relation-id":parseInt(c.brand_id),onReply:G},null,8,["relation-id"]),e.loading?(a(),l(g,{key:0,class:"loading"},{default:o((()=>[C("加载中...")])),_:1})):k("",!0),e.error?(a(),l(g,{key:1,class:"error"},{default:o((()=>[C(w(e.errorMsg),1)])),_:1})):k("",!0)])),_:1})])),_:1}),s(g,{style:{height:"80px"}}),s(g,{class:u(["modal_shadow",{none:!L.value}]),onClick:m[2]||(m[2]=e=>Y())},{default:o((()=>[s(g,{class:"modal_box"},{default:o((()=>[s(g,null,{default:o((()=>[s(p,{style:{"font-size":"25px",color:"#7b6d6d",width:"100%","text-align":"center","margin-bottom":"13px",display:"block"}},{default:o((()=>[C("您的评分 "+w(S(W)),1)])),_:1}),s(_,{modelValue:S(W),"onUpdate:modelValue":m[1]||(m[1]=e=>z(W)?W.value=e:W=e),"allow-half":"true",style:{"margin-top":"5px",float:"left"},size:"45"},null,8,["modelValue"])])),_:1}),s(g,{style:{clear:"both"}}),s(v,{style:{display:"block",width:"100px",position:"absolute",bottom:"0px",right:"20px"},class:"light_button",onClick:q},{default:o((()=>[s(p,{style:{color:"#fff"}},{default:o((()=>[C("提交")])),_:1})])),_:1})])),_:1})])),_:1},8,["class"]),s(B,{ref_key:"commentInputRef",ref:E,"reply-info":S(U),"target-id":c.brand_id,onSubmit:H,"onUpdate:replyInfo":m[3]||(m[3]=e=>z(U)?U.value=e:U=e)},null,8,["reply-info","target-id"])])),_:1})}}},[["__scopeId","data-v-b72cbb73"]]);export{W as default};
