import{av as o,j as n,v as t,s as e,U as s,A as i}from"./index-6ojkiy1R.js";const a="https://api.fantuanpu.com",r="https://images1.fantuanpu.com/";let c=o({isLogin:!1,userInfo:{}});function u(){i({title:"请在微信小程序中登录",icon:"none"})}function l(){return i({title:"请在微信小程序中绑定",icon:"none"}),Promise.reject("请在微信小程序中绑定")}function f(){const o=n("token");if(console.log("token:",o),!o)return console.log("没有token，无法获取用户信息"),void h();console.log("请求接口"),t({url:`${a}/with-state/mine`,method:"GET",header:{Authorization:o},success:o=>{const n=o.data.data;n?(console.log("获取用户信息成功,进行存储",n),m(n)):(console.log("无法获取，清理用户状态"),h())},fail:o=>{p(o,"获取用户信息失败")}})}function d(){return new Promise(((o,e)=>{const s=n("token");if(!s)return h(),void o(null);t({url:`${a}/with-state/mine`,method:"GET",header:{Authorization:s},success:n=>{const t=n.data.data;return t?(console.log("返回：",t),m(t),o(t)):(h(),o(null)),t},fail:n=>{p(n,"获取用户信息失败"),o(null)}})}))}function g(){return console.log("platform:","h5"),1}function m(o){e("userInfo",o),e("token",o.last_token),c.userInfo=o,c.isLogin=!0}function h(){s("userInfo"),c.userInfo={},c.isLogin=!1}function p(o,n="请求失败"){console.error(o),i({title:n,icon:"none"})}export{f as a,c as b,d as c,u as d,l as e,g,r as i,a as w};
