import{r as a,N as e,a2 as t,a as l,c as s,w as i,v as c,A as o,j as u,g as n,b as r,B as d,d as m,e as v,t as _,C as f,k as p,l as g,F as h,u as k,i as y,f as b}from"./index-6ojkiy1R.js";import{_ as $}from"./uni-icons.C75VRGWb.js";import{c as w,b as F,r as C}from"./uni-app.es.BMFd5FAr.js";import{w as S}from"./config.Bhvn_Gfs.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=z({__name:"user_page",props:["uid"],setup(z){const j=a(0),x=a(["搭配","娃柜","点评"]),A=z,T=a({avatar:"",user_name:"加载中..."}),D=a(!1),B=a(!1),E=a([]),L=a([]),G=a([]),I=a([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e(j,(a=>{I.value[a];0===[E,L,G][a].value.length&&M()}));const M=async()=>{if(D.value||B.value)return;const a=I.value[j.value];if(!a.loading&&!a.finished){a.loading=!0;try{let e,t;switch(j.value){case 0:e=`/user-info/collection?user_id=${A.uid}&page=${a.page}`,t="List";break;case 1:e=`/user-info/show-case?user_id=${A.uid}&page=${a.page}`,t="List";break;case 2:e=`/user-info/posts?user_id=${A.uid}&page=${a.page}`,t="comment_list"}const l=await c({url:`${S}${e}`});if("success"===l.data.status){const e=l.data.data,s=e[t].map((a=>{var e,t,l;switch(j.value){case 0:return{id:a.id,cover:(null==(e=a.image_urls)?void 0:e.split(",")[0])||"",images:(null==(t=a.image_urls)?void 0:t.split(","))||[],title:a.title,time:a.created_at};case 1:return{id:a.id,cover:(null==(l=a.image_urls)?void 0:l.split(",")[0])||"",title:a.name,desc:a.description,time:a.created_at};case 2:return{id:a.id,product_thumb:a.target_image,product_name:a.target_name,content:a.comment,create_time:O(a.created_at)}}})),i=[E,L,G][j.value];i.value=[...i.value,...s],a.total=e.total,a.finished=i.value.length>=e.total,a.page++}}catch(e){console.log(e),o({title:"数据加载失败",icon:"none"})}finally{a.loading=!1}}},N=async()=>{try{const a=u("token");if(!a)return void console.log("未登录");const e=D.value?"remove":"add",t=await c({url:`${S}/with-state/blacklist/${e}?target_user_id=`+A.uid,method:"POST",header:{Authorization:a}});"success"===t.data.status?(D.value=!D.value,o({title:D.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(D.value||B.value)&&(E.value=[],L.value=[],G.value=[])):o({title:t.data.msg,icon:"none"})}catch(a){console.log("操作失败",a),o({title:"操作失败",icon:"none"})}},O=a=>{const e=new Date(1e3*a);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`};return t({title:"用户主页"}),w((()=>{(async()=>{try{const a=await c({url:`${S}/user-info?uid=${A.uid}`});"success"===a.data.status&&(T.value=a.data.data)}catch(a){o({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const a=u("token");if(a)try{const e=await c({url:`${S}/with-state/blacklist/status`,method:"GET",data:{target_user_id:A.uid},header:{Authorization:a}});"success"===e.data.status&&(D.value=e.data.data.is_blocked,B.value=e.data.data.they_blocked)}catch(e){console.log("获取黑名单状态失败",e)}else console.log("未登录")})().then((()=>{D.value||B.value||M()}))})),F((()=>{M()})),(a,e)=>{const t=y,c=b,o=n,u=C(l("uni-icons"),$);return r(),s(o,{class:"page-container"},{default:i((()=>[d("meta",{name:"theme-color",content:"#F8F8F8"}),m(o,{class:"header_container"},{default:i((()=>[m(o,{class:"user-info-container"},{default:i((()=>[m(o,{class:"user-info-box"},{default:i((()=>[m(t,{class:"avatar",src:T.value.avatar,mode:"aspectFill"},null,8,["src"]),m(c,{class:"username"},{default:i((()=>[v(_(T.value.user_name),1)])),_:1})])),_:1}),m(o,{class:"action-buttons"},{default:i((()=>[m(o,{class:f(["action-btn block-btn",{blocked:D.value}]),onClick:N},{default:i((()=>[m(u,{type:(D.value,"minus"),size:"16",color:"#fff"},null,8,["type"]),m(c,null,{default:i((()=>[v(_(D.value?"已拉黑":"拉黑"),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),D.value||B.value?k("",!0):(r(),s(o,{key:0,class:"content"},{default:i((()=>[m(o,{class:"tabs-container"},{default:i((()=>[m(o,{class:"tabs"},{default:i((()=>[(r(!0),p(h,null,g(x.value,((a,e)=>(r(),s(o,{key:e,class:f(["tab-item font-alimamashuhei",{active:j.value===e}]),onClick:a=>j.value=e},{default:i((()=>[v(_(a),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),0===j.value?(r(),s(o,{key:0,class:"collocation-list"},{default:i((()=>[(r(!0),p(h,null,g(E.value,((e,l)=>(r(),s(o,{key:l,class:"collocation-item item-image-container",onClick:t=>a.navigateTo(`/pages/collocation_share/collocation_share?collocation_id=${e.id}`)},{default:i((()=>[m(t,{class:"item-image",src:e.cover,mode:"aspectFill"},null,8,["src"]),m(c,{class:"item-title"},{default:i((()=>[v(_(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("",!0),1===j.value?(r(),s(o,{key:1,class:"doll-list"},{default:i((()=>[(r(!0),p(h,null,g(L.value,((e,l)=>(r(),s(o,{key:l,class:"doll-item item-image-container",onClick:t=>a.navigateTo(`/pages/user_doll/user_doll?id=${e.id}`)},{default:i((()=>[m(t,{class:"item-image",src:e.cover,mode:"aspectFill"},null,8,["src"]),m(c,{class:"item-title"},{default:i((()=>[v(_(e.title),1)])),_:2},1024),m(c,{class:"item-price"},{default:i((()=>[v("¥"+_(e.price),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("",!0),2===j.value?(r(),s(o,{key:2,class:"review-list"},{default:i((()=>[(r(!0),p(h,null,g(G.value,((a,e)=>(r(),s(o,{key:e,class:"review-item"},{default:i((()=>[m(t,{class:"product-thumb",src:a.product_thumb,mode:"aspectFill"},null,8,["src"]),m(o,{class:"review-content"},{default:i((()=>[m(c,{class:"product-name"},{default:i((()=>[v(_(a.product_name),1)])),_:2},1024),m(c,{class:"review-text"},{default:i((()=>[v(_(a.content),1)])),_:2},1024),m(c,{class:"review-time"},{default:i((()=>[v(_(a.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):k("",!0)])),_:1})),D.value||B.value?(r(),s(o,{key:1,class:"empty-state"},{default:i((()=>[m(u,{type:"minus",size:"48",color:"#ccc"}),m(c,null,{default:i((()=>[v("你无法查看该用户的主页")])),_:1})])),_:1})):k("",!0)])),_:1})}}},[["__scopeId","data-v-5804dea1"]]);export{j as default};
