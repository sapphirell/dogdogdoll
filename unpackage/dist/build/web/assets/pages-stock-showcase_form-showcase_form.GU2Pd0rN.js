import{r as a,k as e,a2 as o,o as l,a as s,v as t,d as i,w as n,F as d,q as c,j as r,A as u,g as p,b as _,B as m,c as g,e as h,p as f,x as v,u as y,ab as w,f as k,i as b,S as x,M as j,ar as C,h as F,t as L,J as z}from"./index-BFzTDSoz.js";import{w as T,_ as V,i as $,g as A}from"./view-logs.yEAac7W9.js";import{_ as I,r as B}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as D}from"./relation-picker.BL9Kgm-F.js";import{_ as G}from"./cancel.CnEdunnH.js";import{_ as O}from"./add2.S6xx6DwX.js";import{_ as P}from"./right2.s_X9TKoF.js";import{c as S,g as U,u as E}from"./image.dhxYfBTz.js";import"./uni-icons.COaeasi-.js";import"./common-search.BzljtTyU.js";import"./search.CsIL0f2m.js";import"./goods-search.DW_4Fo2f.js";import"./common-modal.DWKlFhUY.js";const q=I({__name:"showcase_form",props:["showcase_id"],setup(I){const q=I,H=a([]),J=a([]),M=a([]),Q=a(!1);a(""),a(0),a(""),a(0),a("");const K=a=>{try{const e={goods_id:a.goods.id||0,goods_name:a.goods.name,goods_image:a.goods.image||"",brand_id:a.brand.id||0,brand_name:a.brand.name||(a.isFuzzy?"":"未知品牌"),type:a.type||(a.isFuzzy?"未知类型":"")};ea.value.some((a=>0!==a.goods_id&&a.goods_id===e.goods_id||a.goods_name===e.goods_name))?u({title:"已存在相同关联项",icon:"none"}):ea.value.push(e)}catch(e){console.error("保存关联数据失败:",e),u({title:"保存关联信息失败",icon:"none"})}},N=()=>{console.log("用户取消选择")},R=()=>{Q.value=!0},W=e((()=>[-1,1,3].includes(aa.value))),X=e((()=>q.showcase_id>0)),Y=a(""),Z=a(""),aa=a(-1),ea=a([]);function oa(a){z({current:H.value[a],urls:H.value})}async function la(){y({title:"确认删除",content:"确定要删除这个展示吗？",success:async a=>{if(a.confirm)try{"success"===(await c({url:`${T}/with-state/delete-showcase?id=`+q.showcase_id,method:"POST",header:{Authorization:r("token")}})).data.status&&(u({title:"删除成功"}),setTimeout((()=>w()),1e3))}catch(e){u({title:"删除失败",icon:"none"})}}})}async function sa(){if(!r("token"))return void u({title:"请先登录",icon:"none"});if(!Y.value.trim()||!Z.value.trim())return void u({title:"标题和正文不能为空",icon:"none"});if(0===H.value.length)return void u({title:"请至少上传一张图片",icon:"none"});let a=A(),e={name:Y.value,description:Z.value,image_urls:H.value.join(","),display:aa.value,origin:a,relations:ea.value.map((a=>({relation_goods_id:a.goods_id,relation_goods_name:a.goods_name,relation_brand_id:a.brand_id,relation_brand_name:a.brand_name,type:a.type,relation_origin:2})))};try{let a=`${T}/with-state/add-showcase`;q.showcase_id&&(a=`${T}/with-state/update-showcase`,e={...e,id:parseInt(q.showcase_id,10)});if("failed"===(await c({url:a,method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:r("token")}})).data.code)return void u({title:"提交失败",icon:"none"});u({title:"提交成功"}),setTimeout((()=>w()),1500)}catch(o){console.log(o),u({title:"提交失败",icon:"none"})}}return o({title:"展示柜"}),l((()=>{c({url:T+"/goods-types",method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),M.value=a.data.data},fail:a=>{console.log(a),u({title:"网络请求失败",icon:"none"})}}),async function(){var a;if(q.showcase_id)try{const e=(await c({url:`${T}/with-state/showcase-detail?id=${q.showcase_id}`,method:"GET",header:{Authorization:r("token")}})).data.data;Y.value=e.name,Z.value=e.description,aa.value=e.display,H.value=(null==(a=e.image_urls)?void 0:a.split(","))||[],console.log(e),e.relations&&(ea.value=e.relations.map((a=>({goods_id:a.relation_goods_id,goods_name:a.relation_goods_name,brand_id:a.relation_brand_id,brand_name:a.relation_brand_name,type:a.type,goods_image:a.relation_goods_image}))))}catch(e){u({title:"加载失败",icon:"none"})}}()})),(a,e)=>{const o=B(s("view-logs"),V),l=k,c=p,r=b,y=x,w=j,z=C,T=B(s("relation-picker"),D),A=F;return _(),t(d,null,[i(o),i(c,null,{default:n((()=>[m("meta",{name:"theme-color",content:"#F8F8F8"}),W.value?f("",!0):(_(),g(c,{key:0,class:"edit-tip"},{default:n((()=>[i(l,null,{default:n((()=>[h("当前状态不可编辑")])),_:1})])),_:1})),i(c,{style:{width:"100%",overflow:"hidden"}},{default:n((()=>[i(y,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:n((()=>[(_(!0),t(d,null,v(H.value,((a,e)=>(_(),g(c,{class:"upload_item",key:e},{default:n((()=>[i(r,{src:a,class:"uploaded_image",onClick:oa,mode:"aspectFill"},null,8,["src"]),W.value?(_(),g(r,{key:0,src:G,class:"close_icon",onClick:a=>function(a){H.value.splice(a,1)}(e)},null,8,["onClick"])):f("",!0)])),_:2},1024)))),128)),W.value?(_(),g(c,{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:n((()=>[i(r,{src:O,class:"upload_img",onClick:e[0]||(e[0]=e=>async function(){try{const a=await S(9);for(const e of a){const a=await U();await E(e,a.token,a.path),H.value.push($+a.path)}u({title:`成功上传${a.length}张图片`,icon:"success"})}catch(a){console.error("上传出错:",a),u({title:"部分图片上传失败",icon:"none"})}}(a.index)),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})):f("",!0)])),_:1})])),_:1}),i(w,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>Y.value=a),type:"text",disabled:!W.value,placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue","disabled"]),i(c,{class:"oneLine"}),i(z,{modelValue:Z.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Z.value=a),disabled:!W.value,placeholder:"请输入描述",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue","disabled"]),i(c,{class:"oneLine"}),i(c,{class:""},{default:n((()=>[W.value?(_(),g(c,{key:0,class:"relation-trigger",onClick:R},{default:n((()=>[i(l,{class:"placeholder"},{default:n((()=>[h("点击关联娃物")])),_:1}),i(r,{src:P,class:"arrow-icon"})])),_:1})):f("",!0)])),_:1}),i(c,{class:"publish-detail"},{default:n((()=>[i(l,null,{default:n((()=>[h("* 展示您的宝宝们 🩵。")])),_:1}),i(l,null,{default:n((()=>[h("* 不关联商品的展示柜不会出现在广场中。")])),_:1})])),_:1}),i(c,{class:"saveCollocationDataList"},{default:n((()=>[(_(!0),t(d,null,v(ea.value,((a,e)=>(_(),g(c,{key:e},{default:n((()=>[i(c,{class:"saveCollocationDataItem"},{default:n((()=>[a.goods_image?(_(),g(r,{key:0,src:a.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(_(),g(l,{key:1,class:"no-image"},{default:n((()=>[h("?")])),_:1})),i(l,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:n((()=>[h(L(a.type)+" "+L(a.brand_name)+" - "+L(a.goods_name),1)])),_:2},1024),W.value?(_(),g(r,{key:2,src:G,class:"close_icon",onClick:a=>function(a){ea.value.splice(a,1)}(e)},null,8,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(T,{visible:Q.value,"onUpdate:visible":e[3]||(e[3]=a=>Q.value=a),typeList:M.value,goodsList:J.value,onConfirm:K,onCancel:N},null,8,["visible","typeList","goodsList"]),i(c,{class:"footer"},{default:n((()=>[X.value?(_(),g(A,{key:0,onClick:la,class:"delete-btn"},{default:n((()=>[h("删除")])),_:1})):f("",!0),i(A,{onClick:sa},{default:n((()=>[h("发表")])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-f1837cc7"]]);export{q as default};
