import{h as a,j as e,P as t,_ as l,c as s,w as o,l as n,m as i,C as d,g as u,o as r,a as c,e as p,r as m,F as v,b as _,t as f,Q as g,v as y,R as h,U as x,u as b,K as k,V as w,n as S,i as C,S as $,f as j,D as z,X as F,y as E,z as I}from"./index-u2rUIk8T.js";import{b as A,o as D}from"./uni-app.es.DpDa-E5E.js";import{b as L,w as P,a as T}from"./config.DgkxgtZ3.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";const O=V({__name:"sale_news",setup(V){const O=a({title:"",content:"",image_list:[],created_at:0}),B=a({brand_name:"",logo:""}),M=a(!1),U=a(!0),G=a(!1),H=a(""),K=a(0),Q=a(0),R=a(!1),W=a({});let X=a(""),Y=a(1),q=a({});const J=e(),N=a(0),Z=t((()=>{var a;let e=(null==(a=J.safeAreaInsets)?void 0:a.bottom)||10;N.value>0&&(e+=N.value);let t=`${e}px`;return console.log("footer-brand:"+t),t}));function aa(){M.value=!0}function ea(){M.value=!1}const ta=()=>{M.value=!1,w()};function la(a){S({url:"/pages/brand/brand?brand_id="+a})}l({title:"图透详情"});function sa(){n({url:P+"/sale-news-comments?id="+K.value+"&page="+Y.value,method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),W.value.page_index=a.data.data.page_index,W.value.total=a.data.data.total,W.value.comment_list=W.value.comment_list?W.value.comment_list.concat(a.data.data.comment_list):a.data.data.comment_list,null!=a.data.data.comment_list&&(a.data.data.comment_list.length>0&&(Y.value+=1),0==a.data.data.comment_list.length&&Y.value>1&&i({title:"没有更多数据了",icon:"none"}))},fail:a=>{console.log(a),i({title:"网络请求失败",icon:"none"})}})}function oa(){let a=d("token");if(!T.isLogin)return void i({title:"请先登录",icon:"none"});if(""==X.value)return void i({title:"请输入评论内容",icon:"none"});let e={content:X.value,target_id:parseInt(K.value),type:4};q.value.id&&(e.reply_id=q.value.id,e.reply_for=q.value.comment,e.reply_user_id=q.value.user_id),console.log(e),n({url:P+"/with-state/add-comment",method:"POST",header:{Authorization:a},data:e,success:a=>(console.log(a.data),"success"==a.data.status?(i({title:"评论成功",icon:"success"}),X.value="",Y.value=1,W.value={},void sa()):void i({title:a.data.msg,icon:"none"})),fail:a=>{console.log(a),i({title:"网络请求失败",icon:"none"})}})}function na(a){const e=new Date(1e3*a),t=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),o=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${t}-${l}-${s} ${o}:${n}`}const ia=()=>{n({url:P+"/brand-info?id="+Q.value,success:a=>{"success"===a.data.status&&(B.value=a.data.data,l({title:a.data.data.brand_name}),ua())},fail:()=>handleError("品牌信息加载失败")})},da=async()=>{if(!T.isLogin)return void i({title:"请先登录",icon:"none"});const a="/with-state/"+(R.value?"unlike":"add-like");n({url:P+a,method:"POST",header:{Authorization:d("token")},data:{id:parseInt(Q.value),type:2},success:a=>{"success"===a.data.status&&(R.value=!R.value,i({title:R.value?"关注成功":"已取消关注",icon:"none"}))}})},ua=()=>{T.isLogin&&n({url:`${P}/with-state/hasLike?id=${Q.value}&type=2`,method:"POST",header:{Authorization:d("token")},success:a=>{var e;R.value=(null==(e=a.data.data)?void 0:e.id)>0}})};return A((()=>{})),D((a=>{a.id&&a.brand_id?(K.value=a.id,Q.value=a.brand_id,(async a=>{try{const e=await n({url:`${P}/sale-news-detail?id=${a}`,timeout:5e3});"success"===e.data.status?(O.value={...e.data.data,image_list:e.data.data.image_list||[]},ia()):handleError(e.data.msg||"数据加载失败")}catch(e){handleError("网络请求失败")}finally{U.value=!1}})(a.id),sa(),L().then(ua)):handleError("缺少必要参数")})),(a,e)=>{const t=C,l=I,n=$,i=u,d=j,w=z,A=F;return r(),s(i,null,{default:o((()=>[c(i,{style:{position:"relative"}},{default:o((()=>[c(n,{class:"swiper-box","indicator-dots":!0,autoplay:!1},{default:o((()=>[(r(!0),p(v,null,m(O.value.image_list,((a,e)=>(r(),s(l,{key:e},{default:o((()=>[c(t,{src:a,mode:"aspectFill",class:"swiper-image",onClick:a=>{E({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),c(i,{class:"brand-info"},{default:o((()=>[c(t,{class:"brand-logo",src:B.value.logo_image,mode:"aspectFill",onClick:e[0]||(e[0]=a=>la(B.value.id))},null,8,["src"]),c(i,{class:"brand-details",onClick:e[1]||(e[1]=a=>la(B.value.id))},{default:o((()=>[c(d,{class:"brand-name"},{default:o((()=>[_(f(B.value.brand_name),1)])),_:1}),c(d,{class:"publish-time"},{default:o((()=>[_(f(na(O.value.created_at)),1)])),_:1})])),_:1}),c(d,{class:"follow",onClick:da,style:g({background:R.value?"#ff6a6c":"#65C3D6"})},{default:o((()=>[_(f(R.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),c(i,{class:"content-box"},{default:o((()=>[c(i,null,{default:o((()=>[c(d,{class:"title"},{default:o((()=>[_(f(O.value.title),1)])),_:1})])),_:1}),c(i,{style:{margin:"20rpx 0rpx"}},{default:o((()=>[c(d,{class:"content"},{default:o((()=>[_(f(O.value.content),1)])),_:1})])),_:1})])),_:1}),c(i,{style:{padding:"10px"}},{default:o((()=>[W.value.total?(r(),s(d,{key:0,style:{color:"rgb(100, 198, 220)","font-weight":"bold",isplay:"block",margin:"30px 5px",display:"block"}},{default:o((()=>[_("评论区 ("+f(W.value.total||0)+")",1)])),_:1})):y("",!0),c(i,null,{default:o((()=>[W.value.comment_list?(r(),s(i,{key:0},{default:o((()=>[(r(!0),p(v,null,m(W.value.comment_list,((a,e)=>(r(),s(i,{class:"comment_item",key:a.id,style:{"margin-bottom":"20px"}},{default:o((()=>[c(i,{style:{float:"left",width:"80px",padding:"0px 10px 10px 0px"},onClick:e=>{return t=a.uid,void S({url:"/pages/user_page/user_page?uid="+t});var t}},{default:o((()=>[c(t,{style:{width:"50px",height:"50px","border-radius":"100%",display:"block",margin:"10px"},src:a.avatar,mode:"aspectFill"},null,8,["src"]),c(d,{style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},{default:o((()=>[_(f(a.username),1)])),_:2},1024)])),_:2},1032,["onClick"]),c(i,{style:{float:"left",padding:"15px 15px 30px 15px",background:"rgb(245 245 245)",width:"calc(100vw - 170px)","min-height":"60px","border-radius":"15px",position:"relative",top:"2px"}},{default:o((()=>[c(d,{style:{width:"100%","white-space":"normal","word-break":"break-all"}},{default:o((()=>[_(f(a.comment),1)])),_:2},1024),c(d,{style:{color:"#888","font-size":"12px",position:"absolute",bottom:"3px",left:"15px"}},{default:o((()=>[_(f(na(a.created_at))+" floor#"+f(a.floor),1)])),_:2},1024),c(d,{style:g([{fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"},b(q).id===a.id?{color:"#fd6669"}:{color:"#888"}]),onClick:e=>function(a){q.value.id!=a.id?q.value=a:q.value={}}(a)},{default:o((()=>[_(" 引用此回复 ")])),_:2},1032,["style","onClick"])])),_:2},1024),c(i,{style:{clear:"both"}})])),_:2},1024)))),128))])),_:1})):y("",!0),W.value.total?y("",!0):(r(),s(i,{key:1,style:{"font-size":"12px",color:"#888",margin:"20rpx 10rpx",width:"100%","text-align":"center"}},{default:o((()=>[_("- 暂无回复 -")])),_:1})),W.value.total?(r(),s(w,{key:2,class:"load_more",onClick:sa},{default:o((()=>[_("加载更多")])),_:1})):y("",!0)])),_:1})])),_:1}),U.value?(r(),s(i,{key:0,class:"loading"},{default:o((()=>[_("加载中...")])),_:1})):y("",!0),G.value?(r(),s(i,{key:1,class:"error"},{default:o((()=>[_(f(H.value),1)])),_:1})):y("",!0),h(c(i,{class:"mask",onClick:ta},null,512),[[x,M.value]]),c(i,{class:"bottom_tab","adjust-position":!1,style:g({paddingBottom:Z.value})},{default:o((()=>[b(q).id?(r(),s(d,{key:0,class:"replyInfo",style:{}},{default:o((()=>[_(f("@"+b(q).username),1)])),_:1})):y("",!0),c(A,{class:"comment_input",modelValue:b(X),"onUpdate:modelValue":e[2]||(e[2]=a=>k(X)?X.value=a:X=a),onClick:aa,onFocus:aa,onBlur:ea,style:{},"adjust-position":!1},null,8,["modelValue"]),c(w,{style:{"flex-shrink":"0",width:"90px"},onClick:oa},{default:o((()=>[_("写评论")])),_:1})])),_:1},8,["style"]),c(i,{style:{width:"100%",height:"120rpx"}})])),_:1})}}},[["__scopeId","data-v-70c7a575"]]);export{O as default};
