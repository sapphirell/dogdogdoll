import{h as a,_ as e,P as l,aa as s,k as t,c as o,w as u,l as n,o as c,a as i,q as r,b as d,t as m,e as p,r as v,F as f,m as _,s as h,C as g,p as b,a8 as k,f as y,g as x,A as j,i as C,W as w,X as T,ai as F,aj as I,ak as V,D as z,y as A}from"./index-u2rUIk8T.js";import{_ as O}from"./uni-icons.dt1Wr7gO.js";import{r as P}from"./uni-app.es.DpDa-E5E.js";import{_ as S}from"./common-page.CNR2v_s0.js";import{_ as q}from"./cancel.CnEdunnH.js";import{_ as B}from"./add2.S6xx6DwX.js";import{w as D,i as E}from"./config.DgkxgtZ3.js";import{c as G,g as N,u as U}from"./image.BZ6EH6H4.js";import{_ as W}from"./_plugin-vue_export-helper.BCo6x5W8.js";const X=W({__name:"treehole_publish",setup(W){const X=a(""),H=a(0),J=a([]),K=a({}),L=a(""),M=a(-1),Q=a("");function R(a){A({current:J.value[a],urls:J.value})}function Y(a){H.value=a.detail.value.length>0?1:0}e({title:"投稿树洞"});function Z(a){const e=a.detail.value;e>=0&&K.value[e]&&(M.value=e,L.value=K.value[e].value,Q.value=K.value[e].label)}const $=l((()=>X.value.trim().length>0&&null!==L.value));async function aa(){if($.value)if(L.value)try{h({title:"提交中..."});const a=g("token");if(!a)return void _({title:"请先登录",icon:"none"});const e={content:X.value.trim(),images:J.value,is_anonymous:H.value,category_id:L.value},l=await n({url:D+"/with-state/add-submission",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a}});b(),"success"==l.data.status?(_({title:"我们很快审核完成",icon:"success"}),setTimeout((()=>{X.value="",J.value=[],H.value=0,k()}),1500)):_({title:l.data.msg||"提交失败",icon:"none"})}catch(a){b(),console.error("提交失败:",a),_({title:"网络请求失败",icon:"none"})}else _({title:"请选择分类",icon:"none"})}return s((()=>{(async()=>{try{const a=await n({url:D+"/treehole-typelist",method:"GET"});"success"===a.data.status&&(K.value=Object.entries(a.data.data).map((([a,e])=>({value:Number(a),label:e}))))}catch(a){console.error("获取分类失败:",a)}})()})),(a,e)=>{const l=y,s=P(t("uni-icons"),O),n=x,h=j,g=C,b=w,k=T,A=F,D=I,W=V,ea=z,la=P(t("common-page"),S);return c(),o(la,{title:"发布树洞"},{default:u((()=>[i(n,{class:"publish-box"},{default:u((()=>[i(h,{class:"category-picker",range:K.value,"range-key":"label",onChange:Z,value:M.value},{default:u((()=>[i(n,{class:"picker-content"},{default:u((()=>[i(l,{class:r(["picker-text",L.value?"":"placeholder"])},{default:u((()=>[d(m(Q.value||"请选择分类（必选）"),1)])),_:1},8,["class"]),i(s,{type:"right",size:"22",color:"#888"})])),_:1})])),_:1},8,["range","value"]),i(b,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:u((()=>[(c(!0),p(f,null,v(J.value,((e,l)=>(c(),o(n,{class:"upload_item",key:l},{default:u((()=>[i(g,{src:e,class:"uploaded_image",onClick:R,mode:"aspectFill"},null,8,["src"]),i(g,{src:q,class:"close_icon",onClick:e=>a.deleteImage(l)},null,8,["onClick"])])),_:2},1024)))),128)),i(n,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:u((()=>[i(g,{src:B,class:"upload_img",onClick:e[0]||(e[0]=e=>(a.index,console.log("openSelect"),void G().then((a=>{N().then((e=>{console.log(e),U(a,e.token,e.path).then((a=>{200!=a.statusCode&&_({title:"上传失败",icon:"none"}),console.log(E+e.path),J.value.push(E+e.path),_({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),i(k,{modelValue:X.value,"onUpdate:modelValue":e[1]||(e[1]=a=>X.value=a),placeholder:"写下你想说的话...",class:"textarea",maxlength:"500"},null,8,["modelValue"]),i(n,{class:"anonymous"},{default:u((()=>[i(W,{onChange:Y},{default:u((()=>[i(D,null,{default:u((()=>[i(A,{checked:1===H.value,color:"#4cbbd0"},null,8,["checked"]),i(l,null,{default:u((()=>[d("匿名发布")])),_:1})])),_:1})])),_:1})])),_:1}),i(n,{class:"publish-detail"},{default:u((()=>[i(l,null,{default:u((()=>[d("* 目前树洞为审稿发布，只接受娃圈相关投稿，不接受包含人身攻击或违反法律法规的投稿。")])),_:1}),i(l,null,{default:u((()=>[d("* 我们会在工作时间进行审稿，您可以在个人投稿中心查看投稿状态，审核通过后稿件才被可见。")])),_:1}),i(l,null,{default:u((()=>[d("* 如果勾选匿名发布，他人将无法通过稿件进入您的主页。如果稿件遭到过多点踩或投诉，我们可能会隐藏这封稿件。")])),_:1})])),_:1}),i(ea,{class:r(["submit-btn",{disabled:!$.value}]),onClick:aa},{default:u((()=>[d(" 提交 ")])),_:1},8,["class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-fd72e539"]]);export{X as default};
