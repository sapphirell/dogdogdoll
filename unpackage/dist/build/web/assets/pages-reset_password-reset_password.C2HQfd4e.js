import{g as e,j as a,c as l,w as s,f as o,o as t,a as u,b as d,t as r,z as n,x as c,l as p,k as v,a7 as w,e as i,L as h,K as m}from"./index-B55GPRQF.js";import{w as f}from"./config.BIUptOrH.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=_({__name:"reset_password",setup(_){const P=e({telephone:"",code:"",newPassword:"",reNewPassword:""}),y=e({phone:"",code:"",newPassword:"",reNewPassword:""}),b=e(0),x=a((()=>b.value>0)),V=a((()=>b.value>0?`${b.value}秒后重发`:"获取验证码")),g=e(!1),N=()=>P.value.telephone?/^1[3-9]\d{9}$/.test(P.value.telephone)?(y.value.phone="",!0):(y.value.phone="手机号格式不正确",!1):(y.value.phone="手机号不能为空",!1),k=async()=>{if(N())try{const e=await p({url:`${f}/send-sms-code`,method:"POST",data:{tel_phone:P.value.telephone}});"success"===e.data.status?(C(),v({title:"验证码已发送",icon:"none"})):v({title:e.data.msg||"发送失败",icon:"none"})}catch(e){v({title:"网络请求失败",icon:"none"})}},j=()=>P.value.newPassword.length<6?(y.value.newPassword="密码至少需要6位",!1):(y.value.newPassword="",!0),B=()=>P.value.newPassword!==P.value.reNewPassword?(y.value.reNewPassword="两次密码输入不一致",!1):(y.value.reNewPassword="",!0),U=()=>P.value.code?6!==P.value.code.length?(y.value.code="验证码格式不正确",!1):(y.value.code="",!0):(y.value.code="验证码不能为空",!1),$=async()=>{if([N(),U(),j(),B()].every((e=>e)))try{g.value=!0;const e=await p({url:`${f}/reset-password`,method:"POST",data:{telephone:P.value.telephone,code:P.value.code,password:P.value.newPassword,re_password:P.value.reNewPassword}});"success"===e.data.status?v({title:"密码重置成功",icon:"success",complete:()=>{setTimeout((()=>{w()}),1500)}}):v({title:e.data.msg||"重置失败",icon:"none"})}catch(e){v({title:"网络请求失败",icon:"none"})}finally{g.value=!1}},C=()=>{b.value=60;const e=setInterval((()=>{b.value<=0?clearInterval(e):b.value--}),1e3)},I=()=>{w()};return(e,a)=>{const p=i,v=o,w=h,f=m;return t(),l(v,{class:"container"},{default:s((()=>[u(v,{class:"header"},{default:s((()=>[u(p,{class:"title"},{default:s((()=>[d("重置密码")])),_:1})])),_:1}),u(v,{class:"form-box"},{default:s((()=>[u(v,{class:"input-item"},{default:s((()=>[u(v,{class:"input-wrapper"},{default:s((()=>[u(p,{class:"prefix"},{default:s((()=>[d("+86")])),_:1}),u(w,{modelValue:P.value.telephone,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:N},null,8,["modelValue"])])),_:1}),y.value.phone?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(y.value.phone),1)])),_:1})):n("",!0)])),_:1}),u(v,{class:"input-item"},{default:s((()=>[u(v,{class:"code-wrapper"},{default:s((()=>[u(w,{modelValue:P.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value.code=e),type:"number",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:U},null,8,["modelValue"]),u(f,{class:c(["code-btn",{disabled:x.value}]),disabled:x.value,onClick:k},{default:s((()=>[d(r(V.value),1)])),_:1},8,["disabled","class"])])),_:1}),y.value.code?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(y.value.code),1)])),_:1})):n("",!0)])),_:1}),u(v,{class:"input-item"},{default:s((()=>[u(v,{class:"input-wrapper"},{default:s((()=>[u(w,{modelValue:P.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.newPassword=e),type:"password",placeholder:"请输入新密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:j},null,8,["modelValue"])])),_:1}),y.value.newPassword?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(y.value.newPassword),1)])),_:1})):n("",!0)])),_:1}),u(v,{class:"input-item"},{default:s((()=>[u(v,{class:"input-wrapper"},{default:s((()=>[u(w,{modelValue:P.value.reNewPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value.reNewPassword=e),type:"password",placeholder:"请再次输入新密码",class:"input","placeholder-class":"placeholder",onBlur:B},null,8,["modelValue"])])),_:1}),y.value.reNewPassword?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(y.value.reNewPassword),1)])),_:1})):n("",!0)])),_:1}),u(f,{class:c(["submit-btn",{loading:g.value}]),disabled:g.value,onClick:$},{default:s((()=>[d(r(g.value?"提交中...":"重置密码"),1)])),_:1},8,["disabled","class"]),u(v,{class:"bottom-tips"},{default:s((()=>[u(p,{class:"link-text",onClick:I},{default:s((()=>[d("返回登录")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-418709da"]]);export{P as default};
