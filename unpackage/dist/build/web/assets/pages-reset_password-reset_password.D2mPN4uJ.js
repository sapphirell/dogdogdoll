import{r as e,k as a,a as l,v as s,d as o,w as t,F as u,g as d,b as r,e as n,c,t as p,p as v,D as w,q as i,A as m,ab as h,f,N as _,h as P}from"./index-I3aG4WZL.js";import{_ as b}from"./view-logs.C4HVuFxK.js";import{_ as y,r as g}from"./_plugin-vue_export-helper.DF4WgY5m.js";import{w as x}from"./config.BjeWXQ7P.js";const V=y({__name:"reset_password",setup(y){const V=e({telephone:"",code:"",newPassword:"",reNewPassword:""}),N=e({phone:"",code:"",newPassword:"",reNewPassword:""}),k=e(0),j=a((()=>k.value>0)),B=a((()=>k.value>0?`${k.value}秒后重发`:"获取验证码")),C=e(!1),U=()=>V.value.telephone?/^1[3-9]\d{9}$/.test(V.value.telephone)?(N.value.phone="",!0):(N.value.phone="手机号格式不正确",!1):(N.value.phone="手机号不能为空",!1),$=async()=>{if(U())try{const e=await i({url:`${x}/send-sms-code`,method:"POST",data:{tel_phone:V.value.telephone}});"success"===e.data.status?(S(),m({title:"验证码已发送",icon:"none"})):m({title:e.data.msg||"发送失败",icon:"none"})}catch(e){m({title:"网络请求失败",icon:"none"})}},I=()=>V.value.newPassword.length<6?(N.value.newPassword="密码至少需要6位",!1):(N.value.newPassword="",!0),T=()=>V.value.newPassword!==V.value.reNewPassword?(N.value.reNewPassword="两次密码输入不一致",!1):(N.value.reNewPassword="",!0),D=()=>V.value.code?6!==V.value.code.length?(N.value.code="验证码格式不正确",!1):(N.value.code="",!0):(N.value.code="验证码不能为空",!1),O=async()=>{if([U(),D(),I(),T()].every((e=>e)))try{C.value=!0;const e=await i({url:`${x}/reset-password`,method:"POST",data:{telephone:V.value.telephone,code:V.value.code,password:V.value.newPassword,re_password:V.value.reNewPassword}});"success"===e.data.status?m({title:"密码重置成功",icon:"success",complete:()=>{setTimeout((()=>{h()}),1500)}}):m({title:e.data.msg||"重置失败",icon:"none"})}catch(e){m({title:"网络请求失败",icon:"none"})}finally{C.value=!1}},S=()=>{k.value=60;const e=setInterval((()=>{k.value<=0?clearInterval(e):k.value--}),1e3)},q=()=>{h()};return(e,a)=>{const i=g(l("view-logs"),b),m=f,h=d,y=_,x=P;return r(),s(u,null,[o(i),o(h,{class:"container"},{default:t((()=>[o(h,{class:"header"},{default:t((()=>[o(m,{class:"title"},{default:t((()=>[n("重置密码")])),_:1})])),_:1}),o(h,{class:"form-box"},{default:t((()=>[o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(m,{class:"prefix"},{default:t((()=>[n("+86")])),_:1}),o(y,{modelValue:V.value.telephone,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:U},null,8,["modelValue"])])),_:1}),N.value.phone?(r(),c(m,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.phone),1)])),_:1})):v("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"code-wrapper"},{default:t((()=>[o(y,{modelValue:V.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value.code=e),type:"number",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:D},null,8,["modelValue"]),o(x,{class:w(["code-btn",{disabled:j.value}]),disabled:j.value,onClick:$},{default:t((()=>[n(p(B.value),1)])),_:1},8,["disabled","class"])])),_:1}),N.value.code?(r(),c(m,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.code),1)])),_:1})):v("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(y,{modelValue:V.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>V.value.newPassword=e),type:"password",placeholder:"请输入新密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:I},null,8,["modelValue"])])),_:1}),N.value.newPassword?(r(),c(m,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.newPassword),1)])),_:1})):v("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(y,{modelValue:V.value.reNewPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>V.value.reNewPassword=e),type:"password",placeholder:"请再次输入新密码",class:"input","placeholder-class":"placeholder",onBlur:T},null,8,["modelValue"])])),_:1}),N.value.reNewPassword?(r(),c(m,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.reNewPassword),1)])),_:1})):v("",!0)])),_:1}),o(x,{class:w(["submit-btn",{loading:C.value}]),disabled:C.value,onClick:O},{default:t((()=>[n(p(C.value?"提交中...":"重置密码"),1)])),_:1},8,["disabled","class"]),o(h,{class:"bottom-tips"},{default:t((()=>[o(m,{class:"link-text",onClick:q},{default:t((()=>[n("返回登录")])),_:1})])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-42318014"]]);export{V as default};
