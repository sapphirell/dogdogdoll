import{g as e,a6 as a,W as l,a8 as o,j as t,c as s,w as i,l as n,C as d,m as c,f as u,o as r,k as m,a as p,b as v,v as _,d as g,r as f,F as h,x as y,a4 as x,e as b,i as k,S as w,Q as C,a9 as j,H as T,t as I,p as L,B as F}from"./index-CAhh9jg-.js";import{_ as S}from"./common-name-picker.WlSLPQob.js";import{r as V}from"./uni-app.es.CI_TJZj7.js";import{_ as G}from"./common-search.CCwQUJ9J.js";import{_ as $,a as D}from"./common-modal.CGmcSZAO.js";import{_ as E}from"./cancel.CnEdunnH.js";import{_ as z}from"./add2.S6xx6DwX.js";import{_ as A}from"./right2.s_X9TKoF.js";import{w as P,i as U,d as B}from"./config.D_tpLRWx.js";import{c as O,g as H,u as J}from"./image.b6tkzStG.js";import{_ as K}from"./_plugin-vue_export-helper.BCo6x5W8.js";const N=K({__name:"showcase_form",props:["showcase_id"],setup(K){const N=K,Q=e([]),W=e([]),q=e([]),M=e(!1),R=e(""),X=e(0),Y=e(""),Z=e(0),ee=e(""),ae=a((()=>[-1,1,3].includes(se.value))),le=a((()=>N.showcase_id>0)),oe=e(""),te=e(""),se=e(-1);const ie=e([]);function ne(e){F({current:Q.value[e],urls:Q.value})}async function de(){y({title:"确认删除",content:"确定要删除这个展示吗？",success:async e=>{if(e.confirm)try{"success"===(await n({url:`${P}/with-state/delete-showcase?id=`+N.showcase_id,method:"POST",header:{Authorization:d("token")}})).data.status&&(c({title:"删除成功"}),setTimeout((()=>x()),1e3))}catch(a){c({title:"删除失败",icon:"none"})}}})}async function ce(){if(!d("token"))return void c({title:"请先登录",icon:"none"});if(!oe.value.trim()||!te.value.trim())return void c({title:"标题和正文不能为空",icon:"none"});if(0===Q.value.length)return void c({title:"请至少上传一张图片",icon:"none"});let e=B(),a={name:oe.value,description:te.value,image_urls:Q.value.join(","),display:se.value,origin:e,relations:ie.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:2})))};try{let e=`${P}/with-state/add-showcase`;N.showcase_id&&(e=`${P}/with-state/update-showcase`,a={...a,id:parseInt(N.showcase_id,10)});if("failed"===(await n({url:e,method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:d("token")}})).data.code)return void c({title:"提交失败",icon:"none"});c({title:"提交成功"}),setTimeout((()=>x()),1500)}catch(l){console.log(l),c({title:"提交失败",icon:"none"})}}function ue(e,a){console.log("收到品牌ID:",e),console.log("收到品牌Name:",a),X.value=parseInt(e,10),R.value=a,n({url:P+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),W.value=e.data.data,console.log(W.value)},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"})}})}function re(e,a){console.log("选中的 id:",e),console.log("选中的 name:",a),Z.value=parseInt(e,10),Y.value=a}function me(e){console.log("选中的值:",e),ee.value=e,M.value=!0}function pe(){if(""!=R.value)if(""!=Y.value){if(0==Z.value){let e={brand_id:X.value,goods_id:0,brand_name:R.value,goods_name:Y.value,goods_image:"",type:ee.value};return ie.value.push(e),M.value=!1,X.value=0,R.value="",Z.value=0,Y.value="",void(ee.value="")}var e;(e=Z.value,new Promise(((a,l)=>{n({url:P+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),a(e.data)},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"}),l(e)},complete:()=>{L()}})}))).then((e=>{let a={brand_id:X.value,goods_id:Z.value,brand_name:R.value,goods_name:Y.value,goods_image:e.data.goods_images[0],type:ee.value};ie.value.push(a),M.value=!1,X.value=0,R.value="",Z.value=0,Y.value="",ee.value=""}))}else c({title:"请选择或填写商品名称",icon:"none"});else c({title:"请选择或填写品牌名称",icon:"none"})}return l({title:"展示柜"}),o((()=>{n({url:P+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),q.value=e.data.data},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"})}}),async function(){var e;if(N.showcase_id)try{const a=(await n({url:`${P}/with-state/showcase-detail?id=${N.showcase_id}`,method:"GET",header:{Authorization:d("token")}})).data.data;oe.value=a.name,te.value=a.description,se.value=a.display,Q.value=(null==(e=a.image_urls)?void 0:e.split(","))||[],console.log(a),a.relations&&(ie.value=a.relations.map((e=>({goods_id:e.relation_goods_id,goods_name:e.relation_goods_name,brand_id:e.relation_brand_id,brand_name:e.relation_brand_name,type:e.type,goods_image:e.relation_goods_image}))))}catch(a){c({title:"加载失败",icon:"none"})}}()})),(e,a)=>{const l=b,o=u,n=k,d=w,y=C,x=j,L=V(t("common-name-picker"),S),F=V(t("common-search"),G),P=V(t("custom-picker"),$),B=T,K=V(t("common-modal"),D);return r(),s(o,null,{default:i((()=>[m("meta",{name:"theme-color",content:"#F8F8F8"}),ae.value?_("",!0):(r(),s(o,{key:0,class:"edit-tip"},{default:i((()=>[p(l,null,{default:i((()=>[v("当前状态不可编辑")])),_:1})])),_:1})),p(d,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:i((()=>[(r(!0),g(h,null,f(Q.value,((e,a)=>(r(),s(o,{class:"upload_item",key:a},{default:i((()=>[p(n,{src:e,class:"uploaded_image",onClick:ne,mode:"aspectFill"},null,8,["src"]),ae.value?(r(),s(n,{key:0,src:E,class:"close_icon",onClick:e=>function(e){Q.value.splice(e,1)}(a)},null,8,["onClick"])):_("",!0)])),_:2},1024)))),128)),ae.value?(r(),s(o,{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:i((()=>[p(n,{src:z,class:"upload_img",onClick:a[0]||(a[0]=a=>(e.index,console.log("openSelect"),void O().then((e=>{H().then((a=>{console.log(a),J(e,a.token,a.path).then((e=>{200!=e.statusCode&&c({title:"上传失败",icon:"none"}),console.log(U+a.path),Q.value.push(U+a.path),c({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})):_("",!0)])),_:1}),p(y,{modelValue:oe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.value=e),type:"text",disabled:!ae.value,placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue","disabled"]),p(o,{class:"oneLine"}),p(x,{modelValue:te.value,"onUpdate:modelValue":a[2]||(a[2]=e=>te.value=e),disabled:!ae.value,placeholder:"请输入描述",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue","disabled"]),p(o,{class:"oneLine"}),p(o,{class:""},{default:i((()=>[ae.value?(r(),s(o,{key:0,style:{display:"flex",padding:"10px 15px",position:"relative"}},{default:i((()=>[p(L,{style:{width:"650rpx"},dataList:q.value,placeholder:"关联娃物",onSelect:me},null,8,["dataList"]),p(n,{src:A,style:{width:"20px",height:"20px",margin:"10px",position:"absolute",right:"40rpx"},mode:"aspectFill"})])),_:1})):_("",!0)])),_:1}),p(o,{class:"saveCollocationDataList"},{default:i((()=>[(r(!0),g(h,null,f(ie.value,((e,a)=>(r(),s(o,{key:a},{default:i((()=>[p(o,{class:"saveCollocationDataItem"},{default:i((()=>[e.goods_image?(r(),s(n,{key:0,src:e.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(r(),s(l,{key:1,class:"no-image"},{default:i((()=>[v("?")])),_:1})),p(l,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:i((()=>[v(I(e.type)+" "+I(e.brand_name)+" - "+I(e.goods_name),1)])),_:2},1024),ae.value?(r(),s(n,{key:2,src:E,class:"close_icon",onClick:e=>function(e){ie.value.splice(e,1)}(a)},null,8,["onClick"])):_("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),p(K,{visible:M.value,"onUpdate:visible":a[3]||(a[3]=e=>M.value=e)},{default:i((()=>[p(o,{class:"selectTab",style:{border:"1px sold #b2b0b4"}},{default:i((()=>[p(o,{style:{"margin-top":"40rpx"}}),p(F,{mode:"fill",onSelect:ue,width:"calc(100vw - 120px)"}),p(o,{style:{"margin-top":"20rpx"}}),p(P,{dataList:W.value,onSelect:re},null,8,["dataList"]),p(B,{onClick:pe,style:{"margin-top":"20px","background-color":"#fff"}},{default:i((()=>[v("确认")])),_:1})])),_:1})])),_:1},8,["visible"]),p(o,{class:"footer"},{default:i((()=>[le.value?(r(),s(B,{key:0,onClick:de,class:"delete-btn"},{default:i((()=>[v("删除")])),_:1})):_("",!0),p(B,{onClick:ce},{default:i((()=>[v("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-04fd5449"]]);export{N as default};
