import{r as a,N as e,a2 as t,a as l,c as s,w as i,q as c,A as o,j as u,g as n,b as r,B as d,d as v,e as _,t as m,D as f,v as g,x as p,F as h,p as k,i as y,f as b}from"./index-BFzTDSoz.js";import{w,_ as $}from"./view-logs.yEAac7W9.js";import{_ as F,c as C,b as S,r as z}from"./_plugin-vue_export-helper.CXFOpRdI.js";import{_ as x}from"./uni-icons.COaeasi-.js";const j=F({__name:"user_page",props:["uid"],setup(F){const j=a(0),A=a(["搭配","娃柜","点评"]),T=F,D=a({avatar:"",user_name:"加载中..."}),B=a(!1),L=a(!1),q=a([]),E=a([]),G=a([]),I=a([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e(j,(a=>{I.value[a];0===[q,E,G][a].value.length&&M()}));const M=async()=>{if(B.value||L.value)return;const a=I.value[j.value];if(!a.loading&&!a.finished){a.loading=!0;try{let e,t;switch(j.value){case 0:e=`/user-info/collection?user_id=${T.uid}&page=${a.page}`,t="List";break;case 1:e=`/user-info/show-case?user_id=${T.uid}&page=${a.page}`,t="List";break;case 2:e=`/user-info/posts?user_id=${T.uid}&page=${a.page}`,t="comment_list"}const l=await c({url:`${w}${e}`});if("success"===l.data.status){const e=l.data.data,s=e[t].map((a=>{var e,t,l;switch(j.value){case 0:return{id:a.id,cover:(null==(e=a.image_urls)?void 0:e.split(",")[0])||"",images:(null==(t=a.image_urls)?void 0:t.split(","))||[],title:a.title,time:a.created_at};case 1:return{id:a.id,cover:(null==(l=a.image_urls)?void 0:l.split(",")[0])||"",title:a.name,desc:a.description,time:a.created_at};case 2:return{id:a.id,product_thumb:a.target_image,product_name:a.target_name,content:a.comment,create_time:O(a.created_at)}}})),i=[q,E,G][j.value];i.value=[...i.value,...s],a.total=e.total,a.finished=i.value.length>=e.total,a.page++}}catch(e){console.log(e),o({title:"数据加载失败",icon:"none"})}finally{a.loading=!1}}},N=async()=>{try{const a=u("token");if(!a)return void console.log("未登录");const e=B.value?"remove":"add",t=await c({url:`${w}/with-state/blacklist/${e}?target_user_id=`+T.uid,method:"POST",header:{Authorization:a}});"success"===t.data.status?(B.value=!B.value,o({title:B.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(B.value||L.value)&&(q.value=[],E.value=[],G.value=[])):o({title:t.data.msg,icon:"none"})}catch(a){console.log("操作失败",a),o({title:"操作失败",icon:"none"})}},O=a=>{const e=new Date(1e3*a);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`};return t({title:"用户主页"}),C((()=>{(async()=>{try{const a=await c({url:`${w}/user-info?uid=${T.uid}`});"success"===a.data.status&&(D.value=a.data.data)}catch(a){o({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const a=u("token");if(a)try{const e=await c({url:`${w}/with-state/blacklist/status`,method:"GET",data:{target_user_id:T.uid},header:{Authorization:a}});"success"===e.data.status&&(B.value=e.data.data.is_blocked,L.value=e.data.data.they_blocked)}catch(e){console.log("获取黑名单状态失败",e)}else console.log("未登录")})().then((()=>{B.value||L.value||M()}))})),S((()=>{M()})),(a,e)=>{const t=z(l("view-logs"),$),c=y,o=b,u=n,w=z(l("uni-icons"),x);return r(),s(u,{class:"page-container"},{default:i((()=>[d("meta",{name:"theme-color",content:"#F8F8F8"}),v(t),v(u,{class:"header_container"},{default:i((()=>[v(u,{class:"user-info-container"},{default:i((()=>[v(u,{class:"user-info-box"},{default:i((()=>[v(c,{class:"avatar",src:D.value.avatar,mode:"aspectFill"},null,8,["src"]),v(o,{class:"username"},{default:i((()=>[_(m(D.value.user_name),1)])),_:1})])),_:1}),v(u,{class:"action-buttons"},{default:i((()=>[v(u,{class:f(["action-btn block-btn",{blocked:B.value}]),onClick:N},{default:i((()=>[v(w,{type:(B.value,"minus"),size:"16",color:"#fff"},null,8,["type"]),v(o,null,{default:i((()=>[_(m(B.value?"已拉黑":"拉黑"),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),B.value||L.value?k("",!0):(r(),s(u,{key:0,class:"content"},{default:i((()=>[v(u,{class:"tabs-container"},{default:i((()=>[v(u,{class:"tabs"},{default:i((()=>[(r(!0),g(h,null,p(A.value,((a,e)=>(r(),s(u,{key:e,class:f(["tab-item font-alimamashuhei",{active:j.value===e}]),onClick:a=>j.value=e},{default:i((()=>[_(m(a),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),0===j.value?(r(),s(u,{key:0,class:"collocation-list"},{default:i((()=>[(r(!0),g(h,null,p(q.value,((e,t)=>(r(),s(u,{key:t,class:"collocation-item item-image-container",onClick:t=>a.navigateTo(`/pages/collocation_share/collocation_share?collocation_id=${e.id}`)},{default:i((()=>[v(c,{class:"item-image",src:e.cover,mode:"aspectFill"},null,8,["src"]),v(o,{class:"item-title"},{default:i((()=>[_(m(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("",!0),1===j.value?(r(),s(u,{key:1,class:"doll-list"},{default:i((()=>[(r(!0),g(h,null,p(E.value,((e,t)=>(r(),s(u,{key:t,class:"doll-item item-image-container",onClick:t=>a.navigateTo(`/pages/user_doll/user_doll?id=${e.id}`)},{default:i((()=>[v(c,{class:"item-image",src:e.cover,mode:"aspectFill"},null,8,["src"]),v(o,{class:"item-title"},{default:i((()=>[_(m(e.title),1)])),_:2},1024),v(o,{class:"item-price"},{default:i((()=>[_("¥"+m(e.price),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("",!0),2===j.value?(r(),s(u,{key:2,class:"review-list"},{default:i((()=>[(r(!0),g(h,null,p(G.value,((a,e)=>(r(),s(u,{key:e,class:"review-item"},{default:i((()=>[v(c,{class:"product-thumb",src:a.product_thumb,mode:"aspectFill"},null,8,["src"]),v(u,{class:"review-content"},{default:i((()=>[v(o,{class:"product-name"},{default:i((()=>[_(m(a.product_name),1)])),_:2},1024),v(o,{class:"review-text"},{default:i((()=>[_(m(a.content),1)])),_:2},1024),v(o,{class:"review-time"},{default:i((()=>[_(m(a.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):k("",!0)])),_:1})),B.value||L.value?(r(),s(u,{key:1,class:"empty-state"},{default:i((()=>[v(w,{type:"minus",size:"48",color:"#ccc"}),v(o,null,{default:i((()=>[_("你无法查看该用户的主页")])),_:1})])),_:1})):k("",!0)])),_:1})}}},[["__scopeId","data-v-4fd40fbf"]]);export{j as default};
