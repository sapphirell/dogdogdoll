import{r as e,k as a,a as l,v as s,d as o,w as t,F as u,g as d,b as r,e as n,c,t as p,p as i,D as v,q as m,A as w,s as h,V as f,n as _,f as g,M as y,h as b}from"./index-BFzTDSoz.js";import{_ as V,w as x}from"./view-logs.yEAac7W9.js";import{_ as P,r as k}from"./_plugin-vue_export-helper.CXFOpRdI.js";const B=P({__name:"register",setup(P){const B=e({telephone:"",code:"",password:"",rePassword:""}),j=e({phone:"",code:"",password:"",rePassword:""}),U=e(0),$=a((()=>U.value>0)),C=a((()=>U.value>0?`${U.value}秒后重发`:"获取验证码")),I=e(!1),T=()=>B.value.telephone?/^1[3-9]\d{9}$/.test(B.value.telephone)?(j.value.phone="",!0):(j.value.phone="手机号格式不正确",!1):(j.value.phone="手机号不能为空",!1),A=async()=>{if(T())try{const e=await m({url:`${x}/send-sms-code`,method:"POST",data:{tel_phone:B.value.telephone}});"success"===e.data.status?(O(),w({title:"验证码已发送",icon:"none"})):w({title:e.data.msg||"发送失败",icon:"none"})}catch(e){w({title:"网络请求失败",icon:"none"})}},O=()=>{U.value=60;const e=setInterval((()=>{U.value<=0?clearInterval(e):U.value--}),1e3)},S=()=>B.value.password.length<6?(j.value.password="密码至少需要6位",!1):(j.value.password="",!0),q=()=>B.value.password!==B.value.rePassword?(j.value.rePassword="两次密码输入不一致",!1):(j.value.rePassword="",!0),D=()=>B.value.code?6!==B.value.code.length?(j.value.code="验证码格式不正确",!1):(j.value.code="",!0):(j.value.code="验证码不能为空",!1),F=async()=>{if([T(),D(),S(),q()].every((e=>e)))try{I.value=!0;const e=await m({url:`${x}/register`,method:"POST",data:{telephone:B.value.telephone,code:B.value.code,password:B.value.password,re_password:B.value.rePassword}});"success"===e.data.status?(h("token",e.data.data.jwt_token),w({title:"注册成功",icon:"success",complete:()=>{setTimeout((()=>{f({url:"/pages/mine/mine"})}),1500)}})):w({title:e.data.msg||"注册失败",icon:"none"})}catch(e){w({title:"网络请求失败",icon:"none"})}finally{I.value=!1}},M=()=>{_({url:"/pages/login/login"})};return(e,a)=>{const m=k(l("view-logs"),V),w=g,h=d,f=y,_=b;return r(),s(u,null,[o(m),o(h,{class:"container"},{default:t((()=>[o(h,{class:"header"},{default:t((()=>[o(w,{class:"title"},{default:t((()=>[n("手机号注册")])),_:1})])),_:1}),o(h,{class:"form-box"},{default:t((()=>[o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(w,{class:"prefix"},{default:t((()=>[n("+86")])),_:1}),o(f,{modelValue:B.value.telephone,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:T},null,8,["modelValue"])])),_:1}),j.value.phone?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(j.value.phone),1)])),_:1})):i("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"code-wrapper"},{default:t((()=>[o(f,{modelValue:B.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.code=e),type:"number",autocomplete:"new-password",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:D},null,8,["modelValue"]),o(_,{class:v(["code-btn",{disabled:$.value}]),disabled:$.value,onClick:A},{default:t((()=>[n(p(C.value),1)])),_:1},8,["disabled","class"])])),_:1}),j.value.code?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(j.value.code),1)])),_:1})):i("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(f,{modelValue:B.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value.password=e),autocomplete:"new-password",type:"password",placeholder:"请输入密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:S},null,8,["modelValue"])])),_:1}),j.value.password?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(j.value.password),1)])),_:1})):i("",!0)])),_:1}),o(h,{class:"input-item"},{default:t((()=>[o(h,{class:"input-wrapper"},{default:t((()=>[o(f,{modelValue:B.value.rePassword,"onUpdate:modelValue":a[3]||(a[3]=e=>B.value.rePassword=e),type:"password",placeholder:"请再次输入密码",class:"input","placeholder-class":"placeholder",onBlur:q},null,8,["modelValue"])])),_:1}),j.value.rePassword?(r(),c(w,{key:0,class:"error-text"},{default:t((()=>[n(p(j.value.rePassword),1)])),_:1})):i("",!0)])),_:1}),o(_,{class:v(["submit-btn",{loading:I.value}]),disabled:I.value,onClick:F},{default:t((()=>[n(p(I.value?"注册中...":"立即注册"),1)])),_:1},8,["disabled","class"]),o(h,{class:"bottom-tips"},{default:t((()=>[n(" 已有账号？ "),o(w,{class:"link-text",onClick:M},{default:t((()=>[n("去登录")])),_:1})])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-e4f2374a"]]);export{B as default};
