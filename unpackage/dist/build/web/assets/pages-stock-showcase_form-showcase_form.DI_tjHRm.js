import{g as e,U as a,$ as l,ac as o,j as t,c as s,w as i,l as n,C as d,m as c,f as u,o as r,a as p,b as m,v,d as _,r as g,F as f,x as h,a9 as y,e as x,i as b,S as k,Q as w,Z as j,H as C,t as T,p as I,B as L}from"./index-CfMR_IzQ.js";import{_ as E}from"./common-name-picker.kOmYGZ9v.js";import{r as S}from"./uni-app.es.5AkhYBbN.js";import{_ as V}from"./common-search.CyUK2jK_.js";import{_ as D,a as F}from"./common-modal.B0laTwpj.js";import{_ as G}from"./cancel.CnEdunnH.js";import{_ as $}from"./add2.S6xx6DwX.js";import{_ as A}from"./right2.s_X9TKoF.js";import{w as U,i as z,d as B}from"./config.BX5UpUDr.js";import{c as H,g as P,u as N}from"./image.C6s062kk.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const Q=O({__name:"showcase_form",props:["showcase_id"],setup(O){const Q=O,Z=e([]),q=e([]),J=e([]),K=e(!1),M=e(""),R=e(0),W=e(""),X=e(0),Y=e(""),ee=a((()=>[-1,1,3].includes(te.value))),ae=a((()=>!!Q.showcase_id)),le=e(""),oe=e(""),te=e(-1);const se=e([]);function ie(e){L({current:Z.value[e],urls:Z.value})}async function ne(){h({title:"确认删除",content:"确定要删除这个展示吗？",success:async e=>{if(e.confirm)try{200===(await n({url:`${U}/with-state/delete-showcase`,method:"DELETE",data:{id:Q.showcase_id},header:{Authorization:d("token")}})).data.code&&(c({title:"删除成功"}),setTimeout((()=>y()),1e3))}catch(a){c({title:"删除失败",icon:"none"})}}})}async function de(){if(!d("token"))return void c({title:"请先登录",icon:"none"});if(!le.value.trim()||!oe.value.trim())return void c({title:"标题和正文不能为空",icon:"none"});if(0===Z.value.length)return void c({title:"请至少上传一张图片",icon:"none"});let e=B(),a={name:le.value,description:oe.value,image_urls:Z.value.join(","),display:te.value,origin:e,relations:se.value.map((e=>({relation_goods_id:e.goods_id,relation_goods_name:e.goods_name,relation_brand_id:e.brand_id,relation_brand_name:e.brand_name,type:e.type,relation_origin:2})))};try{const e=`${U}/with-state/update-showcase`;Q.showcase_id&&(a={...a,id:parseInt(Q.showcase_id,10)});if("failed"===(await n({url:e,method:"POST",data:a,header:{"Content-Type":"application/json",Authorization:d("token")}})).data.code)return void c({title:"提交失败",icon:"none"});c({title:"提交成功"}),setTimeout((()=>y()),1500)}catch(l){console.log(l),c({title:"提交失败",icon:"none"})}}function ce(e,a){console.log("收到品牌ID:",e),console.log("收到品牌Name:",a),R.value=parseInt(e,10),M.value=a,n({url:U+"/goods-name-list?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),q.value=e.data.data,console.log(q.value)},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"})}})}function ue(e,a){console.log("选中的 id:",e),console.log("选中的 name:",a),X.value=parseInt(e,10),W.value=a}function re(e){console.log("选中的值:",e),Y.value=e,K.value=!0}function pe(){if(""!=M.value)if(""!=W.value){if(0==X.value){let e={brand_id:R.value,goods_id:0,brand_name:M.value,goods_name:W.value,goods_image:"",type:Y.value};return se.value.push(e),K.value=!1,R.value=0,M.value="",X.value=0,W.value="",void(Y.value="")}var e;(e=X.value,new Promise(((a,l)=>{n({url:U+"/goods?id="+e,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),a(e.data)},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"}),l(e)},complete:()=>{I()}})}))).then((e=>{let a={brand_id:R.value,goods_id:X.value,brand_name:M.value,goods_name:W.value,goods_image:e.data.goods_images[0],type:Y.value};se.value.push(a),K.value=!1,R.value=0,M.value="",X.value=0,W.value="",Y.value=""}))}else c({title:"请选择或填写商品名称",icon:"none"});else c({title:"请选择或填写品牌名称",icon:"none"})}return l({title:"展示柜"}),o((()=>{n({url:U+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),J.value=e.data.data},fail:e=>{console.log(e),c({title:"网络请求失败",icon:"none"})}}),async function(){var e;if(Q.showcase_id)try{const a=(await n({url:`${U}/with-state/showcase-detail?id=${Q.showcase_id}`,method:"GET",header:{Authorization:d("token")}})).data.data;le.value=a.name,oe.value=a.description,te.value=a.display,Z.value=(null==(e=a.image_urls)?void 0:e.split(","))||[],console.log(a),a.relations&&(se.value=a.relations.map((e=>({goods_id:e.relation_goods_id,goods_name:e.relation_goods_name,brand_id:e.relation_brand_id,brand_name:e.relation_brand_name,type:e.type,goods_image:e.relation_goods_image}))))}catch(a){c({title:"加载失败",icon:"none"})}}()})),(e,a)=>{const l=x,o=u,n=b,d=k,h=w,y=j,I=S(t("common-name-picker"),E),L=S(t("common-search"),V),U=S(t("custom-picker"),D),B=C,O=S(t("common-modal"),F);return r(),s(o,null,{default:i((()=>[ee.value?v("",!0):(r(),s(o,{key:0,class:"edit-tip"},{default:i((()=>[p(l,null,{default:i((()=>[m("当前状态不可编辑")])),_:1})])),_:1})),p(d,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:i((()=>[(r(!0),_(f,null,g(Z.value,((e,a)=>(r(),s(o,{class:"upload_item",key:a},{default:i((()=>[p(n,{src:e,class:"uploaded_image",onClick:ie,mode:"aspectFill"},null,8,["src"]),ee.value?(r(),s(n,{key:0,src:G,class:"close_icon",onClick:e=>function(e){Z.value.splice(e,1)}(a)},null,8,["onClick"])):v("",!0)])),_:2},1024)))),128)),ee.value?(r(),s(o,{key:0,class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:i((()=>[p(n,{src:$,class:"upload_img",onClick:a[0]||(a[0]=a=>(e.index,console.log("openSelect"),void H().then((e=>{P().then((a=>{console.log(a),N(e,a.token,a.path).then((e=>{200!=e.statusCode&&c({title:"上传失败",icon:"none"}),console.log(z+a.path),Z.value.push(z+a.path),c({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})):v("",!0)])),_:1}),p(h,{modelValue:le.value,"onUpdate:modelValue":a[1]||(a[1]=e=>le.value=e),type:"text",disabled:!ee.value,placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue","disabled"]),p(o,{class:"oneLine"}),p(y,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),disabled:!ee.value,placeholder:"请输入描述",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue","disabled"]),p(o,{class:"oneLine"}),p(o,{class:""},{default:i((()=>[ee.value?(r(),s(o,{key:0,style:{display:"flex",padding:"10px 15px",position:"relative"}},{default:i((()=>[p(I,{style:{width:"650rpx"},dataList:J.value,placeholder:"关联娃物",onSelect:re},null,8,["dataList"]),p(n,{src:A,style:{width:"20px",height:"20px",margin:"10px",position:"absolute",right:"40rpx"},mode:"aspectFill"})])),_:1})):v("",!0)])),_:1}),p(o,{class:"saveCollocationDataList"},{default:i((()=>[(r(!0),_(f,null,g(se.value,((e,a)=>(r(),s(o,{key:a},{default:i((()=>[p(o,{class:"saveCollocationDataItem"},{default:i((()=>[e.goods_image?(r(),s(n,{key:0,src:e.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(r(),s(l,{key:1,class:"no-image"},{default:i((()=>[m("?")])),_:1})),p(l,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:i((()=>[m(T(e.type)+" "+T(e.brand_name)+" - "+T(e.goods_name),1)])),_:2},1024),ee.value?(r(),s(n,{key:2,src:G,class:"close_icon",onClick:e=>function(e){se.value.splice(e,1)}(a)},null,8,["onClick"])):v("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),p(O,{visible:K.value,"onUpdate:visible":a[3]||(a[3]=e=>K.value=e)},{default:i((()=>[p(o,{class:"selectTab",style:{border:"1px sold #b2b0b4"}},{default:i((()=>[p(L,{mode:"fill",onSelect:ce,width:"calc(100vw - 120px)"}),p(U,{dataList:q.value,onSelect:ue,margin:"10px 0 0 8px"},null,8,["dataList"]),p(B,{onClick:pe,style:{"margin-top":"20px","background-color":"#fff"}},{default:i((()=>[m("确认")])),_:1})])),_:1})])),_:1},8,["visible"]),p(o,{class:"footer"},{default:i((()=>[ae.value?(r(),s(B,{key:0,onClick:ne,class:"delete-btn"},{default:i((()=>[m("删除")])),_:1})):v("",!0),p(B,{onClick:de},{default:i((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-7bcd69ca"]]);export{Q as default};
