import{g as a,W as e,a6 as l,a8 as s,j as t,c as o,w as n,l as u,o as c,k as i,a as r,q as d,b as m,t as p,d as v,r as f,F as h,m as _,s as g,C as b,p as k,a4 as y,e as x,f as j,E as C,i as w,S as F,a9 as I,ag as T,a7 as z,ah as S,H as V,B as A}from"./index-CAhh9jg-.js";import{_ as B}from"./uni-icons.DApveqxl.js";import{r as E}from"./uni-app.es.CI_TJZj7.js";import{_ as O}from"./common-page.BrPj6MFC.js";import{_ as q}from"./cancel.CnEdunnH.js";import{_ as D}from"./add2.S6xx6DwX.js";import{w as G,i as H}from"./config.D_tpLRWx.js";import{c as L,g as N,u as P}from"./image.b6tkzStG.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";const W=U({__name:"treehole_publish",setup(U){const W=a(""),J=a(0),K=a([]),M=a({}),Q=a(""),R=a(-1),X=a("");function Y(a){A({current:K.value[a],urls:K.value})}function Z(a){J.value=a.detail.value.length>0?1:0}e({title:"投稿树洞"});function $(a){const e=a.detail.value;e>=0&&M.value[e]&&(R.value=e,Q.value=M.value[e].value,X.value=M.value[e].label)}const aa=l((()=>W.value.trim().length>0&&null!==Q.value));async function ea(){if(aa.value)if(Q.value)try{g({title:"提交中..."});const a=b("token");if(!a)return void _({title:"请先登录",icon:"none"});const e={content:W.value.trim(),images:K.value,is_anonymous:J.value,category_id:Q.value},l=await u({url:G+"/with-state/add-submission",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a}});k(),"success"==l.data.status?(_({title:"我们很快审核完成",icon:"success"}),setTimeout((()=>{W.value="",K.value=[],J.value=0,y()}),1500)):_({title:l.data.msg||"提交失败",icon:"none"})}catch(a){k(),console.error("提交失败:",a),_({title:"网络请求失败",icon:"none"})}else _({title:"请选择分类",icon:"none"})}return s((()=>{(async()=>{try{const a=await u({url:G+"/treehole-typelist",method:"GET"});"success"===a.data.status&&(M.value=Object.entries(a.data.data).map((([a,e])=>({value:Number(a),label:e}))))}catch(a){console.error("获取分类失败:",a)}})()})),(a,e)=>{const l=x,s=E(t("uni-icons"),B),u=j,g=C,b=w,k=F,y=I,A=T,G=z,U=S,la=V,sa=E(t("common-page"),O);return c(),o(sa,{title:"发布树洞"},{default:n((()=>[i("meta",{name:"theme-color",content:"#F8F8F8"}),r(u,{class:"publish-box"},{default:n((()=>[r(g,{class:"category-picker",range:M.value,"range-key":"label",onChange:$,value:R.value},{default:n((()=>[r(u,{class:"picker-content"},{default:n((()=>[r(l,{class:d(["picker-text",Q.value?"":"placeholder"])},{default:n((()=>[m(p(X.value||"请选择分类（必选）"),1)])),_:1},8,["class"]),r(s,{type:"right",size:"22",color:"#888"})])),_:1})])),_:1},8,["range","value"]),r(k,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:n((()=>[(c(!0),v(h,null,f(K.value,((e,l)=>(c(),o(u,{class:"upload_item",key:l},{default:n((()=>[r(b,{src:e,class:"uploaded_image",onClick:Y,mode:"aspectFill"},null,8,["src"]),r(b,{src:q,class:"close_icon",onClick:e=>a.deleteImage(l)},null,8,["onClick"])])),_:2},1024)))),128)),r(u,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:n((()=>[r(b,{src:D,class:"upload_img",onClick:e[0]||(e[0]=e=>(a.index,console.log("openSelect"),void L().then((a=>{N().then((e=>{console.log(e),P(a,e.token,e.path).then((a=>{200!=a.statusCode&&_({title:"上传失败",icon:"none"}),console.log(H+e.path),K.value.push(H+e.path),_({title:"上传成功",icon:"success"})}))}))})))),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1}),r(y,{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),placeholder:"写下你想说的话...",class:"textarea",maxlength:"500"},null,8,["modelValue"]),r(u,{class:"anonymous"},{default:n((()=>[r(U,{onChange:Z},{default:n((()=>[r(G,null,{default:n((()=>[r(A,{checked:1===J.value,color:"#4cbbd0"},null,8,["checked"]),r(l,null,{default:n((()=>[m("匿名发布")])),_:1})])),_:1})])),_:1})])),_:1}),r(u,{class:"publish-detail"},{default:n((()=>[r(l,null,{default:n((()=>[m("* 目前树洞为审稿发布，只接受娃圈相关投稿，不接受包含人身攻击或违反法律法规的投稿。")])),_:1}),r(l,null,{default:n((()=>[m("* 我们会在工作时间进行审稿，您可以在个人投稿中心查看投稿状态，审核通过后稿件才被可见。")])),_:1}),r(l,null,{default:n((()=>[m("* 如果勾选匿名发布，他人将无法通过稿件进入您的主页。如果稿件遭到过多点踩或投诉，我们可能会隐藏这封稿件。")])),_:1})])),_:1}),r(la,{class:d(["submit-btn",{disabled:!aa.value}]),onClick:ea},{default:n((()=>[m(" 提交 ")])),_:1},8,["class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-d7628137"]]);export{W as default};
