import{r as e,k as a,a as l,v as s,d as o,w as t,F as u,g as d,b as r,e as n,c,t as p,p as v,D as w,q as i,A as h,ab as m,f as _,M as f,h as P}from"./index-BFzTDSoz.js";import{_ as b,w as y}from"./view-logs.yEAac7W9.js";import{_ as x,r as V}from"./_plugin-vue_export-helper.CXFOpRdI.js";const g=x({__name:"reset_password",setup(x){const g=e({telephone:"",code:"",newPassword:"",reNewPassword:""}),N=e({phone:"",code:"",newPassword:"",reNewPassword:""}),k=e(0),B=a((()=>k.value>0)),U=a((()=>k.value>0?`${k.value}秒后重发`:"获取验证码")),$=e(!1),j=()=>g.value.telephone?/^1[3-9]\d{9}$/.test(g.value.telephone)?(N.value.phone="",!0):(N.value.phone="手机号格式不正确",!1):(N.value.phone="手机号不能为空",!1),C=async()=>{if(j())try{const e=await i({url:`${y}/send-sms-code`,method:"POST",data:{tel_phone:g.value.telephone}});"success"===e.data.status?(S(),h({title:"验证码已发送",icon:"none"})):h({title:e.data.msg||"发送失败",icon:"none"})}catch(e){h({title:"网络请求失败",icon:"none"})}},I=()=>g.value.newPassword.length<6?(N.value.newPassword="密码至少需要6位",!1):(N.value.newPassword="",!0),T=()=>g.value.newPassword!==g.value.reNewPassword?(N.value.reNewPassword="两次密码输入不一致",!1):(N.value.reNewPassword="",!0),A=()=>g.value.code?6!==g.value.code.length?(N.value.code="验证码格式不正确",!1):(N.value.code="",!0):(N.value.code="验证码不能为空",!1),O=async()=>{if([j(),A(),I(),T()].every((e=>e)))try{$.value=!0;const e=await i({url:`${y}/reset-password`,method:"POST",data:{telephone:g.value.telephone,code:g.value.code,password:g.value.newPassword,re_password:g.value.reNewPassword}});"success"===e.data.status?h({title:"密码重置成功",icon:"success",complete:()=>{setTimeout((()=>{m()}),1500)}}):h({title:e.data.msg||"重置失败",icon:"none"})}catch(e){h({title:"网络请求失败",icon:"none"})}finally{$.value=!1}},S=()=>{k.value=60;const e=setInterval((()=>{k.value<=0?clearInterval(e):k.value--}),1e3)},q=()=>{m()};return(e,a)=>{const i=V(l("view-logs"),b),h=_,m=d,y=f,x=P;return r(),s(u,null,[o(i),o(m,{class:"container"},{default:t((()=>[o(m,{class:"header"},{default:t((()=>[o(h,{class:"title"},{default:t((()=>[n("重置密码")])),_:1})])),_:1}),o(m,{class:"form-box"},{default:t((()=>[o(m,{class:"input-item"},{default:t((()=>[o(m,{class:"input-wrapper"},{default:t((()=>[o(h,{class:"prefix"},{default:t((()=>[n("+86")])),_:1}),o(y,{modelValue:g.value.telephone,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:j},null,8,["modelValue"])])),_:1}),N.value.phone?(r(),c(h,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.phone),1)])),_:1})):v("",!0)])),_:1}),o(m,{class:"input-item"},{default:t((()=>[o(m,{class:"code-wrapper"},{default:t((()=>[o(y,{modelValue:g.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value.code=e),type:"number",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:A},null,8,["modelValue"]),o(x,{class:w(["code-btn",{disabled:B.value}]),disabled:B.value,onClick:C},{default:t((()=>[n(p(U.value),1)])),_:1},8,["disabled","class"])])),_:1}),N.value.code?(r(),c(h,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.code),1)])),_:1})):v("",!0)])),_:1}),o(m,{class:"input-item"},{default:t((()=>[o(m,{class:"input-wrapper"},{default:t((()=>[o(y,{modelValue:g.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value.newPassword=e),type:"password",placeholder:"请输入新密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:I},null,8,["modelValue"])])),_:1}),N.value.newPassword?(r(),c(h,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.newPassword),1)])),_:1})):v("",!0)])),_:1}),o(m,{class:"input-item"},{default:t((()=>[o(m,{class:"input-wrapper"},{default:t((()=>[o(y,{modelValue:g.value.reNewPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value.reNewPassword=e),type:"password",placeholder:"请再次输入新密码",class:"input","placeholder-class":"placeholder",onBlur:T},null,8,["modelValue"])])),_:1}),N.value.reNewPassword?(r(),c(h,{key:0,class:"error-text"},{default:t((()=>[n(p(N.value.reNewPassword),1)])),_:1})):v("",!0)])),_:1}),o(x,{class:w(["submit-btn",{loading:$.value}]),disabled:$.value,onClick:O},{default:t((()=>[n(p($.value?"提交中...":"重置密码"),1)])),_:1},8,["disabled","class"]),o(m,{class:"bottom-tips"},{default:t((()=>[o(h,{class:"link-text",onClick:q},{default:t((()=>[n("返回登录")])),_:1})])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-42318014"]]);export{g as default};
