import{av as o,j as n,q as t,s as e,U as s,A as a,o as i,Q as r}from"./index-BFzTDSoz.js";const l="https://api.fantuanpu.com",c="https://images1.fantuanpu.com/",u="1.0.40";let f=o({isLogin:!1,userInfo:{}});function d(){a({title:"请在微信小程序中登录",icon:"none"})}function h(){return a({title:"请在微信小程序中绑定",icon:"none"}),Promise.reject("请在微信小程序中绑定")}function g(){const o=n("token");if(console.log("token:",o),!o)return console.log("没有token，无法获取用户信息"),void w();console.log("请求接口"),t({url:`${l}/with-state/mine`,method:"GET",header:{Authorization:o},success:o=>{const n=o.data.data;n?(console.log("获取用户信息成功,进行存储",n),v(n)):(console.log("无法获取，清理用户状态"),w())},fail:o=>{k(o,"获取用户信息失败")}})}function m(){return new Promise(((o,e)=>{const s=n("token");if(!s)return w(),void o(null);t({url:`${l}/with-state/mine`,method:"GET",header:{Authorization:s},success:n=>{const t=n.data.data;return t?(console.log("返回：",t),v(t),o(t)):(w(),o(null)),t},fail:n=>{k(n,"获取用户信息失败"),o(null)}})}))}function p(){return console.log("platform:","h5"),1}function v(o){e("userInfo",o),e("token",o.last_token),f.userInfo=o,f.isLogin=!0}function w(){s("userInfo"),f.userInfo={},f.isLogin=!1}function k(o,n="请求失败"){console.error(o),a({title:n,icon:"none"})}const I={__name:"view-logs",setup(o){const s=()=>{let o=n("ft_uvid");return o||(o=Math.floor(2147483647*Math.random())+1,e("ft_uvid",o)),o},a=()=>{const o=r();return 0===o.length?"":o[o.length-1].route||""};return i((()=>{(async()=>{let o=n("userInfo");const e={scene:p(),path:a(),uid:o?o.id:0,uvid:s(),version:"1.0.40"};if(console.log("logData:",e),e.path)try{await t({url:`${l}/log/view`,method:"POST",data:e,header:{"content-type":"application/json"}})}catch(i){console.error("日志发送错误:",i)}else console.warn("无法获取当前页面路径")})()})),(o,n)=>null}};export{I as _,g as a,f as b,m as c,u as d,d as e,h as f,p as g,c as i,l as w};
