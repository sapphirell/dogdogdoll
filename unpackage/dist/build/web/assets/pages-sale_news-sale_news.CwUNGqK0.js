import{g as a,h as t,$ as e,j as l,c as s,w as o,l as i,m as n,C as d,f as r,o as u,a as c,d as p,r as m,F as _,b as f,t as g,V as v,v as y,u as h,N as x,n as b,i as k,y as w,e as S,H as C,B as $,D as j}from"./index-CfMR_IzQ.js";import{_ as z}from"./comment-input.qrWYiM_3.js";import{o as E,r as F}from"./uni-app.es.5AkhYBbN.js";import{b as I,w as A,a as D}from"./config.BX5UpUDr.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=L({__name:"sale_news",setup(L){const T=a({title:"",content:"",image_list:[],created_at:0}),O=a({brand_name:"",logo:""}),P=a(!0),H=a(!1),M=a(""),B=a(0),G=a(0),J=a(!1),N=a({});let U=a(1),V=a({});function W(a){b({url:"/pages/brand/brand?brand_id="+a})}t(),e({title:"图透详情"});function Y(){i({url:A+"/sale-news-comments?id="+B.value+"&page="+U.value,method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),N.value.page_index=a.data.data.page_index,N.value.total=a.data.data.total,N.value.comment_list=N.value.comment_list?N.value.comment_list.concat(a.data.data.comment_list):a.data.data.comment_list,null!=a.data.data.comment_list&&(a.data.data.comment_list.length>0&&(U.value+=1),0==a.data.data.comment_list.length&&U.value>1&&n({title:"没有更多数据了",icon:"none"}))},fail:a=>{console.log(a),n({title:"网络请求失败",icon:"none"})}})}const q=({content:a,replyInfo:t,origin:e})=>{let l=d("token");if(!D.isLogin)return void n({title:"请先登录",icon:"none"});const s={content:a,origin:e,target_id:parseInt(B.value),type:4,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id}};i({url:A+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:s,success:a=>{"success"==a.data.status?(n({title:"评论成功",icon:"success"}),U.value=1,N.value={},Y()):n({title:a.data.msg,icon:"none"})},fail:a=>{n({title:"网络请求失败",icon:"none"})}})};function K(a){const t=new Date(1e3*a),e=t.getFullYear(),l=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${e}-${l}-${s} ${o}:${i}`}const Q=()=>{i({url:A+"/brand-info?id="+G.value,success:a=>{"success"===a.data.status&&(O.value=a.data.data,e({title:a.data.data.brand_name}),X())},fail:()=>handleError("品牌信息加载失败")})},R=async()=>{if(!D.isLogin)return void n({title:"请先登录",icon:"none"});const a="/with-state/"+(J.value?"unlike":"add-like");i({url:A+a,method:"POST",header:{Authorization:d("token")},data:{id:parseInt(G.value),type:2},success:a=>{"success"===a.data.status&&(J.value=!J.value,n({title:J.value?"关注成功":"已取消关注",icon:"none"}))}})},X=()=>{D.isLogin&&i({url:`${A}/with-state/hasLike?id=${G.value}&type=2`,method:"POST",header:{Authorization:d("token")},success:a=>{var t;J.value=(null==(t=a.data.data)?void 0:t.id)>0}})};return E((a=>{a.id&&a.brand_id?(B.value=a.id,G.value=a.brand_id,(async a=>{try{const t=await i({url:`${A}/sale-news-detail?id=${a}`,timeout:5e3});"success"===t.data.status?(T.value={...t.data.data,image_list:t.data.data.image_list||[]},Q()):handleError(t.data.msg||"数据加载失败")}catch(t){handleError("网络请求失败")}finally{P.value=!1}})(a.id),Y(),I().then(X)):handleError("缺少必要参数")})),(a,t)=>{const e=k,i=j,n=w,d=r,E=S,I=C,A=F(l("comment-input"),z);return u(),s(d,null,{default:o((()=>[c(d,{style:{position:"relative"}},{default:o((()=>[c(n,{class:"swiper-box","indicator-dots":!0,autoplay:!1},{default:o((()=>[(u(!0),p(_,null,m(T.value.image_list,((a,t)=>(u(),s(i,{key:t},{default:o((()=>[c(e,{src:a,mode:"aspectFill",class:"swiper-image",onClick:a=>{$({current:goods.value.goods_images.index,urls:goods.value.goods_images})}},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),c(d,{class:"brand-info"},{default:o((()=>[c(e,{class:"brand-logo",src:O.value.logo_image,mode:"aspectFill",onClick:t[0]||(t[0]=a=>W(O.value.id))},null,8,["src"]),c(d,{class:"brand-details",onClick:t[1]||(t[1]=a=>W(O.value.id))},{default:o((()=>[c(E,{class:"brand-name"},{default:o((()=>[f(g(O.value.brand_name),1)])),_:1}),c(E,{class:"publish-time"},{default:o((()=>[f(g(K(T.value.created_at)),1)])),_:1})])),_:1}),c(E,{class:"follow",onClick:R,style:v({background:J.value?"#ff6a6c":"#65C3D6"})},{default:o((()=>[f(g(J.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),c(d,{class:"content-box"},{default:o((()=>[c(d,null,{default:o((()=>[c(E,{class:"title"},{default:o((()=>[f(g(T.value.title),1)])),_:1})])),_:1}),c(d,{style:{margin:"20rpx 0rpx"}},{default:o((()=>[c(E,{class:"content"},{default:o((()=>[f(g(T.value.content),1)])),_:1})])),_:1})])),_:1}),c(d,{style:{padding:"10px"}},{default:o((()=>[N.value.total?(u(),s(E,{key:0,style:{color:"rgb(100, 198, 220)","font-weight":"bold",isplay:"block",margin:"30px 5px",display:"block"}},{default:o((()=>[f("评论区 ("+g(N.value.total||0)+")",1)])),_:1})):y("",!0),c(d,null,{default:o((()=>[N.value.comment_list?(u(),s(d,{key:0},{default:o((()=>[(u(!0),p(_,null,m(N.value.comment_list,((a,t)=>(u(),s(d,{class:"comment_item",key:a.id,style:{"margin-bottom":"20px"}},{default:o((()=>[c(d,{style:{float:"left",width:"80px",padding:"0px 10px 10px 0px"},onClick:t=>{return e=a.uid,void b({url:"/pages/user_page/user_page?uid="+e});var e}},{default:o((()=>[c(e,{style:{width:"50px",height:"50px","border-radius":"100%",display:"block",margin:"10px"},src:a.avatar,mode:"aspectFill"},null,8,["src"]),c(E,{style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},{default:o((()=>[f(g(a.username),1)])),_:2},1024)])),_:2},1032,["onClick"]),c(d,{style:{float:"left",padding:"15px 15px 30px 15px",background:"rgb(245 245 245)",width:"calc(100vw - 170px)","min-height":"60px","border-radius":"15px",position:"relative",top:"2px"}},{default:o((()=>[c(E,{style:{width:"100%","white-space":"normal","word-break":"break-all"}},{default:o((()=>[f(g(a.comment),1)])),_:2},1024),c(E,{style:{color:"#888","font-size":"12px",position:"absolute",bottom:"3px",left:"15px"}},{default:o((()=>[f(g(K(a.created_at))+" floor#"+g(a.floor),1)])),_:2},1024),c(E,{style:v([{fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"},h(V).id===a.id?{color:"#fd6669"}:{color:"#888"}]),onClick:t=>function(a){V.value.id!=a.id?V.value=a:V.value={}}(a)},{default:o((()=>[f(" 引用此回复 ")])),_:2},1032,["style","onClick"])])),_:2},1024),c(d,{style:{clear:"both"}})])),_:2},1024)))),128))])),_:1})):y("",!0),N.value.total?y("",!0):(u(),s(d,{key:1,style:{"font-size":"12px",color:"#888",margin:"20rpx 10rpx",width:"100%","text-align":"center"}},{default:o((()=>[f("- 暂无回复 - ")])),_:1})),N.value.total?(u(),s(I,{key:2,class:"load_more",onClick:Y},{default:o((()=>[f("加载更多")])),_:1})):y("",!0)])),_:1})])),_:1}),P.value?(u(),s(d,{key:0,class:"loading"},{default:o((()=>[f("加载中...")])),_:1})):y("",!0),H.value?(u(),s(d,{key:1,class:"error"},{default:o((()=>[f(g(M.value),1)])),_:1})):y("",!0),c(A,{"reply-info":h(V),"target-id":B.value,onSubmit:q,"onUpdate:replyInfo":t[2]||(t[2]=a=>x(V)?V.value=a:V=a)},null,8,["reply-info","target-id"]),c(d,{style:{width:"100%",height:"120rpx"}})])),_:1})}}},[["__scopeId","data-v-27a694b3"]]);export{T as default};
