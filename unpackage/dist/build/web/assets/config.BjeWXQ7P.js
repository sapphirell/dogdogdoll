import{av as o,j as n,q as t,s as e,U as s,A as a}from"./index-I3aG4WZL.js";const i="https://api.fantuanpu.com",r="https://images1.fantuanpu.com/",c="1.0.41";let u=o({isLogin:!1,userInfo:{}});function l(){a({title:"请在微信小程序中登录",icon:"none"})}function f(){return a({title:"请在微信小程序中绑定",icon:"none"}),Promise.reject("请在微信小程序中绑定")}function d(){const o=n("token");if(console.log("token:",o),!o)return console.log("没有token，无法获取用户信息"),void p();console.log("请求接口"),t({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:o},success:o=>{const n=o.data.data;n?(console.log("获取用户信息成功,进行存储",n),h(n)):(console.log("无法获取，清理用户状态"),p())},fail:o=>{k(o,"获取用户信息失败")}})}function g(){return new Promise(((o,e)=>{const s=n("token");if(!s)return p(),void o(null);t({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:s},success:n=>{const t=n.data.data;return t?(console.log("返回：",t),h(t),o(t)):(p(),o(null)),t},fail:n=>{k(n,"获取用户信息失败"),o(null)}})}))}function m(){return console.log("platform:","h5"),1}function h(o){e("userInfo",o),e("token",o.last_token),u.userInfo=o,u.isLogin=!0}function p(){s("userInfo"),u.userInfo={},u.isLogin=!1}function k(o,n="请求失败"){console.error(o),a({title:n,icon:"none"})}export{d as a,u as b,g as c,c as d,l as e,f,m as g,r as i,i as w};
