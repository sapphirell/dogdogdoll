import{r as a,a as o,c as e,w as l,v as s,A as t,$ as n,g as i,b as d,d as c,k as r,l as u,F as p,e as m,j as _,ab as g,i as f,S as v,M as h,ar as y,f as b,h as x,t as k,J as j}from"./index-6ojkiy1R.js";import{_ as w}from"./relation-picker.BphiaGqN.js";import{r as C}from"./uni-app.es.BMFd5FAr.js";import{_ as L}from"./cancel.CnEdunnH.js";import{_ as F}from"./add2.S6xx6DwX.js";import{_ as I}from"./right2.s_X9TKoF.js";import{w as V,i as z,g as D}from"./config.Bhvn_Gfs.js";import{c as B,g as J,u as T}from"./image.Davh951g.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.C75VRGWb.js";import"./common-search.DQepwF8H.js";import"./search.CsIL0f2m.js";import"./goods-search.BuQh0O7r.js";import"./common-modal.Biav_mER.js";const E=A({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(A){const E=A,G=a([]),P=a([]),U=a([]),M=a(!1);a(""),a(0),a(""),a(0),a("");const S=a=>{try{const o={goods_id:a.goods.id||0,goods_name:a.goods.name,goods_image:a.goods.image||"",brand_id:a.brand.id||0,brand_name:a.brand.name||(a.isFuzzy?"":"未知品牌"),type:a.type||(a.isFuzzy?"未知类型":"")};Q.value.some((a=>0!==a.goods_id&&a.goods_id===o.goods_id||a.goods_name===o.goods_name))?t({title:"已存在相同关联项",icon:"none"}):Q.value.push(o)}catch(o){console.error("保存关联数据失败:",o),t({title:"保存关联信息失败",icon:"none"})}},$=()=>{console.log("用户取消选择")},O=()=>{M.value=!0};const Q=a([]);var R;E.goods_id&&E.goods_name&&E.brand_id&&E.brand_name&&E.type&&(R=E.goods_id,new Promise(((a,o)=>{s({url:V+"/goods?id="+R,method:"GET",timeout:5e3,success:o=>{console.log(o.data.data),a(o.data)},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"}),o(a)},complete:()=>{n()}})}))).then((a=>{let o={brand_id:parseInt(E.brand_id,10),goods_id:parseInt(E.goods_id,10),brand_name:E.brand_name,goods_name:E.goods_name,goods_image:a.data.goods_images[0],type:E.type};console.log(o),Q.value.push(o)}));const q=a(""),H=a("");function K(a){j({current:G.value[a],urls:G.value})}function N(){const a=_("token");if(!a)return void t({title:"请先登录",icon:"none"});if(!q.value.trim())return void t({title:"标题不能为空",icon:"none"});if(0===G.value.length)return void t({title:"请至少上传一张图片",icon:"none"});let o=D();const e={title:q.value,content:H.value,image_url_list:G.value,scene:o,relations:Q.value.map((a=>({relation_goods_id:a.goods_id,relation_goods_name:a.goods_name,relation_brand_id:a.brand_id,relation_brand_name:a.brand_name,type:a.type,relation_origin:1})))};console.log(e),s({url:V+"/with-state/add-collocation",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a},timeout:5e3,success:a=>{"success"===a.data.status?(t({title:"提交成功"}),q.value="",H.value="",G.value=[],Q.value=[],g()):t({title:a.data.msg||"提交失败",icon:"none"})},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}})}return s({url:V+"/goods-types",method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),U.value=a.data.data},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}}),(a,s)=>{const n=f,_=i,g=v,j=h,V=y,D=b,A=C(o("relation-picker"),w),E=x;return d(),e(_,null,{default:l((()=>[c(_,{style:{width:"100%",overflow:"hidden"}},{default:l((()=>[c(g,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(d(!0),r(p,null,u(G.value,((a,o)=>(d(),e(_,{class:"upload_item",key:o},{default:l((()=>[c(n,{src:a,class:"uploaded_image",onClick:K,mode:"aspectFill"},null,8,["src"]),c(n,{src:L,class:"close_icon",onClick:a=>function(a){G.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)))),128)),c(_,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[c(n,{src:F,class:"upload_img",onClick:s[0]||(s[0]=o=>async function(){try{const a=await B(9);for(const o of a){const a=await J();await T(o,a.token,a.path),G.value.push(z+a.path)}t({title:`成功上传${a.length}张图片`,icon:"success"})}catch(a){console.error("上传出错:",a),t({title:"部分图片上传失败",icon:"none"})}}(a.index)),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1})])),_:1}),c(j,{modelValue:q.value,"onUpdate:modelValue":s[1]||(s[1]=a=>q.value=a),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),c(_,{class:"oneLine"}),c(V,{modelValue:H.value,"onUpdate:modelValue":s[2]||(s[2]=a=>H.value=a),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),c(_,{class:"oneLine"}),c(_,{class:""},{default:l((()=>[c(_,{class:"relation-trigger",onClick:O},{default:l((()=>[c(D,{class:"placeholder"},{default:l((()=>[m("点击关联娃物")])),_:1}),c(n,{src:I,class:"arrow-icon"})])),_:1})])),_:1}),c(_,{class:"publish-detail"},{default:l((()=>[c(D,null,{default:l((()=>[m("* 分享您对于打扮BJD的想法✨。")])),_:1}),c(D,null,{default:l((()=>[m("* 不关联商品的搭配不会出现在广场中。")])),_:1}),c(D,null,{default:l((()=>[m("* 可以是BJD相关的贩售广告，但不可以滥用关联。")])),_:1})])),_:1}),c(_,{class:"saveCollocationDataList"},{default:l((()=>[(d(!0),r(p,null,u(Q.value,((a,o)=>(d(),e(_,{key:o},{default:l((()=>[c(_,{class:"saveCollocationDataItem"},{default:l((()=>[a.goods_image?(d(),e(n,{key:0,src:a.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(d(),e(D,{key:1,class:"no-image"},{default:l((()=>[m("?")])),_:1})),c(D,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[m(k(a.type)+" "+k(a.brand_name)+" - "+k(a.goods_name),1)])),_:2},1024),c(n,{src:L,class:"close_icon",onClick:a=>function(a){Q.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),c(A,{visible:M.value,"onUpdate:visible":s[3]||(s[3]=a=>M.value=a),typeList:U.value,goodsList:P.value,onConfirm:S,onCancel:$},null,8,["visible","typeList","goodsList"]),c(_,{class:"footer"},{default:l((()=>[c(E,{onClick:N},{default:l((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-6e610be6"]]);export{E as default};
