import{r as e,m as t,a2 as a,o as l,v as n,A as s,a as o,k as i,c as u,w as r,d as c,D as d,T as p,F as m,j as g,g as v,b as f,B as _,e as h,t as y,l as k,C as w,I as S,x,n as I,i as b,f as j,u as C,J as F}from"./index-6ojkiy1R.js";import{b as $,_ as z,a as A}from"./comment-input.WXDjx_KR.js";import{r as L}from"./uni-app.es.BMFd5FAr.js";import{_ as D}from"./uni-icons.C75VRGWb.js";import{w as R,c as T,b as O}from"./config.Bhvn_Gfs.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./common-modal.Biav_mER.js";const B=P({__name:"treehole_detail",props:{id:{type:String,required:!0}},setup(P){e(!0),e(!1),e("");const B=e(0),M=e(null),q=e(null),E=e(null);e(1);let H=e({});const J=e(!1),N=P,U=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let l=e;null!=t&&(l=t),H.value.id!=l.id?(console.log("item",l),H.value=l,null==(a=E.value)||a.focusInput()):H.value={}},Y=({content:e,replyInfo:t,origin:a})=>{let l=g("token");if(!O.isLogin)return void s({title:"请先登录",icon:"none"});console.log("reply_info",t);const o={content:e,origin:a,target_id:parseInt(B.value),type:5,...t.id&&{reply_id:t.id,reply_for:t.comment,reply_user_id:t.user_id,parent_id:t.parent_id>0?t.parent_id:t.id}};n({url:R+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:o,success:e=>{var t,a;if("success"==e.data.status){const l=e.data.data;0===l.parent_id?(console.log("添加主评论"),null==(t=q.value)||t.addNewComment(l)):(console.log("添加子评论"),null==(a=q.value)||a.addReplyComment(l)),s({title:"评论成功",icon:"success"})}else s({title:e.data.msg,icon:"none"})},fail:e=>{s({title:"网络请求失败",icon:"none"})}})};const G=()=>{if(!O.isLogin)return void x({title:"提示",content:"需要登录后才能点赞",success:e=>{e.confirm&&I({url:"/pages/login/login"})}});const e=g("token"),t=R+(J.value?"/with-state/unlike":"/with-state/add-like");n({url:t,method:"POST",header:{Authorization:e},data:{id:parseInt(N.id),type:5},success:e=>{"success"===e.data.status&&(J.value=!J.value,M.value.like_count+=J.value?1:-1)}})};const K=t((()=>{var e,t;return(null==(t=null==(e=M.value)?void 0:e.images)?void 0:t.slice(0,9))||[]})),Q=t((()=>{var e,t;return((null==(t=null==(e=M.value)?void 0:e.images)?void 0:t.length)||0)-9})),V=t((()=>{var e,t;return((null==(t=null==(e=M.value)?void 0:e.images)?void 0:t.length)||0)>9}));a({title:"投稿详情"});const W=t((()=>{const e=K.value.length;return 1===e?"single":2===e?"double":"multi"})),X=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return l((async()=>{B.value=N.id,console.log("pageId",B.value);try{const e=await n({url:`${R}/treehole-detail?id=${N.id}`});"success"===e.data.status&&(M.value=e.data.data)}catch(e){console.log(e),s({title:"加载失败",icon:"none"})}T(),function(){let e=g("token");""!=e&&n({url:R+"/with-state/hasLike?id="+N.id+"&type=5",method:"POST",header:{Authorization:e},success:e=>{console.log(e.data),"success"==e.data.status?e.data.data.id>0?J.value=!0:J.value=!1:s({title:e.data.msg,icon:"none"})},fail:e=>{console.log(e),s({title:"网络请求失败",icon:"none"})}})}()})),(e,t)=>{const a=b,l=j,n=v,g=L(o("report-button"),$),x=L(o("uni-icons"),D),I=L(o("comment-list"),z),R=L(o("comment-input"),A);return f(),i(m,null,[M.value?(f(),u(n,{key:0,class:"container"},{default:r((()=>[_("meta",{name:"theme-color",content:"#F8F8F8"}),c(n,{class:"header"},{default:r((()=>[c(n,{class:"author-info"},{default:r((()=>[c(a,{src:M.value.avatar||"/static/noname.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),c(n,{style:{width:"500rpx"}},{default:r((()=>[c(l,{class:"author-name"},{default:r((()=>[h(y(M.value.author_name),1)])),_:1}),c(n,{class:"time"},{default:r((()=>[h(y(X(M.value.created_at)),1)])),_:1})])),_:1}),c(n,{style:{width:"120rpx"}},{default:r((()=>[c(g,{"report-type":"3","relation-id":parseInt(N.id),"button-text":"举报","icon-type":"flag","icon-size":"24","icon-color":"#666"},null,8,["relation-id"])])),_:1})])),_:1})])),_:1}),c(n,{class:"content"},{default:r((()=>[h(y(M.value.content),1)])),_:1}),c(n,{class:w(["image-container",W.value])},{default:r((()=>[(f(!0),i(m,null,k(K.value,((e,t)=>(f(),u(n,{key:t,class:"image-wrapper"},{default:r((()=>[c(a,{src:e,mode:"aspectFill",class:"image-item",onClick:e=>(e=>{F({current:e,urls:M.value.images})})(t)},null,8,["src","onClick"]),V.value&&8===t?(f(),u(n,{key:0,class:"image-overlay"},{default:r((()=>[h(" +"+y(Q.value),1)])),_:1})):C("",!0)])),_:2},1024)))),128))])),_:1},8,["class"]),c(n,{class:"action-bar"},{default:r((()=>[c(n,{class:"action-group"},{default:r((()=>[c(n,{class:"action-item",onClick:G},{default:r((()=>[c(x,{type:J.value?"hand-up-filled":"hand-up",size:"24",color:J.value?"#ff4d4f":"#666"},null,8,["type","color"]),c(l,{class:"action-text"},{default:r((()=>[h(y(M.value.like_count||0),1)])),_:1})])),_:1}),c(n,{class:"action-item",onClick:t[0]||(t[0]=e=>function(e){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+e.id;S({data:t,success:function(){s({title:"复制链接成功",icon:"none"})}})}(M.value))},{default:r((()=>[c(x,{type:"redo",size:"24",color:"#666"}),c(l,{class:"action-text"},{default:r((()=>[h("分享")])),_:1})])),_:1})])),_:1}),c(l,{class:"time-text"},{default:r((()=>[h("审核于 "+y(X(M.value.approve_time)),1)])),_:1})])),_:1})])),_:1})):(f(),u(n,{key:1,class:"loading"},{default:r((()=>[h("加载中...")])),_:1})),c(n,{style:{padding:"10px"}},{default:r((()=>[c(I,{ref_key:"commentListRef",ref:q,type:5,"relation-id":parseInt(N.id),onReply:U},null,8,["relation-id"])])),_:1}),c(R,{ref_key:"commentInputRef",ref:E,"reply-info":d(H),"target-id":B.value,onSubmit:Y,"onUpdate:replyInfo":t[1]||(t[1]=e=>p(H)?H.value=e:H=e)},null,8,["reply-info","target-id"]),c(n,{style:{width:"100%",height:"120rpx"}})],64)}}},[["__scopeId","data-v-142495e8"]]);export{B as default};
