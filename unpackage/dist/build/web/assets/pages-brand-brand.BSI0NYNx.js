import{Y as t,k as e,o as a,c as l,w as o,a as s,e as i,F as n,r as d,q as u,Q as r,Z as c,g as h,h as m,s as p,j as f,P as g,l as _,_ as v,m as y,p as b,C as x,u as S,b as w,t as k,d as C,v as z,K as M,R as P,U as R,V as I,i as N,f as T,D as V,X as $,n as F,$ as B}from"./index-u2rUIk8T.js";import{_ as L}from"./uni-icons.dt1Wr7gO.js";import{r as j,b as A,c as X}from"./uni-app.es.DpDa-E5E.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{w as O,a as W,v as D,d as G}from"./config.DgkxgtZ3.js";const U=E({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(t){this.valueSync=Number(t)},modelValue(t){this.valueSync=Number(t)}},computed:{stars(){const t=this.valueSync?this.valueSync:0,e=[],a=Math.floor(t),l=Math.ceil(t);for(let o=0;o<this.max;o++)a>o?e.push({activeWitch:"100%"}):l-1===o?e.push({activeWitch:100*(t-a)+"%"}):e.push({activeWitch:"0"});return e},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(t){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:e,screenX:a}=t.changedTouches[0];this._getRateCount(e||a)},touchmove(t){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:e,screenX:a}=t.changedTouches[0];this._getRateCount(e||a)},mousedown(t){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:e}=t;this.userLastRate=this.valueSync,this._getRateCount(e),this.userRated=!0},mousemove(t){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:e}=t;this._getRateCount(e)},mouseleave(t){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let l=0;l<e.length-1;l++)if(t.indexOf(e[l])>0){a=!1;break}return a},_getRateCount(t){this._getSize();const e=Number(this.size);if(isNaN(e))return new Error("size 属性只能设置为数字");const a=t-this._rateBoxLeft;let l=parseInt(a/(e+this.marginNumber));l=l<0?0:l,l=l>this.max?this.max:l;const o=parseInt(a-(e+this.marginNumber)*l);let s=0;(this._oldValue!==l||this.PC)&&(this._oldValue=l,s=this.allowHalf?o>e/2?l+1:l+.5:l+1,s=Math.max(.5,Math.min(s,this.max)),this.valueSync=s,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){t().in(this).select(".uni-rate").boundingClientRect().exec((t=>{t&&(this._rateBoxLeft=t[0].left)}))}}},[["render",function(t,m,p,f,g,_){const v=j(e("uni-icons"),L),y=h;return a(),l(y,null,{default:o((()=>[s(y,{ref:"uni-rate",class:"uni-rate"},{default:o((()=>[(a(!0),i(n,null,d(_.stars,((t,e)=>(a(),l(y,{class:u(["uni-rate__icon",{"uni-cursor-not-allowed":p.disabled}]),style:r({"margin-right":_.marginNumber+"px"}),key:e,onTouchstart:c(_.touchstart,["stop"]),onTouchmove:c(_.touchmove,["stop"]),onMousedown:c(_.mousedown,["stop"]),onMousemove:c(_.mousemove,["stop"]),onMouseleave:_.mouseleave},{default:o((()=>[s(v,{color:p.color,size:p.size,type:p.isFill?"star-filled":"star"},null,8,["color","size","type"]),s(y,{style:r({width:t.activeWitch}),class:"uni-rate__icon-on"},{default:o((()=>[s(v,{color:p.disabled?p.disabledColor:p.activeColor,size:p.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]),H=E({__name:"brand",props:["brand_id"],setup(t){const c=t;console.log(c);const L=m(!1);p({title:"加载中"});const E=f(),H=m(0),Y=m(!1);function q(){Y.value=!0}function K(){Y.value=!1}const Q=()=>{Y.value=!1,I()};A((()=>{})),X((()=>{}));const Z=g((()=>{var t;let e=(null==(t=E.safeAreaInsets)?void 0:t.bottom)||10;H.value>0&&(e+=H.value);let a=`${e}px`;return console.log("footer-brand:"+a),a}));let J=m(""),tt=m(0),et=m(!1);function at(){0!=tt.value?tt.value>5?y({title:"评分不能大于5",icon:"none"}):(console.log(tt.value,c.brand_id),D(1,tt.value,c.brand_id)):y({title:"请先评分",icon:"none"})}function lt(){_({url:O+"/brand-info?id="+c.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),mt.value=t.data.data,v({title:t.data.data.brand_name}),st()},fail:t=>{console.log(t),y({title:"网络请求失败",icon:"none"})},complete:()=>{b()}})}const ot=async()=>{let t=x("token");if(W.isLogin)try{const e=`${O}/with-state/${L.value?"unlike":"add-like"}`,a=await _({url:e,method:"POST",header:{Authorization:t},data:{id:parseInt(c.brand_id),type:2}});"success"===a.data.status?(L.value=!L.value,y({title:L.value?"关注成功":"已取消关注",icon:"none"}),lt()):y({title:a.data.msg,icon:"none"})}catch(e){console.error(e),y({title:"操作失败",icon:"none"})}else y({title:"请先登录",icon:"none"})},st=async()=>{var t;try{const e=await _({url:`${O}/with-state/hasLike?id=${parseInt(c.brand_id)}&type=2`,method:"POST",header:{Authorization:x("token")}});L.value=(null==(t=e.data.data)?void 0:t.id)>0}catch(e){console.error("获取关注状态失败:",e)}};function it(t){const e=new Date(1e3*t),a=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0"),s=e.getHours().toString().padStart(2,"0"),i=e.getMinutes().toString().padStart(2,"0");return e.getSeconds().toString().padStart(2,"0"),`${a}-${l}-${o} ${s}:${i}`}function nt(){_({url:O+"/brand-goods?brand_id="+c.brand_id+"&page="+ht.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),ct.value.page_index=t.data.data.page_index,ct.value.total=t.data.data.total,ct.value.goods_list=ct.value.goods_list?ct.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(ht.value+=1),0==t.data.data.goods_list.length&&ht.value>1&&y({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),y({title:"网络请求失败",icon:"none"})}})}function dt(){_({url:O+"/brand-comment?brand_id="+c.brand_id+"&page="+ft.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),pt.value.page_index=t.data.data.page_index,pt.value.total=t.data.data.total,pt.value.comment_list=pt.value.comment_list?pt.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(ft.value+=1),0==t.data.data.comment_list.length&&ft.value>1&&y({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),y({title:"网络请求失败",icon:"none"})}})}function ut(t){et.value=!et.value}function rt(){let t=x("token");if(!t)return void y({title:"请先登录",icon:"none"});if(""==J.value)return void y({title:"请输入评论内容",icon:"none"});let e=G();_({url:O+"/with-state/add-comment",method:"POST",header:{Authorization:t},data:{target_id:parseInt(c.brand_id),content:J.value,type:1,origin:e},success:t=>(console.log(t.data),"success"==t.data.status?(y({title:"评论成功",icon:"success"}),J.value="",ft.value=1,pt.value={},void dt()):void y({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),y({title:"网络请求失败",icon:"none"})}})}let ct=m({}),ht=m(1),mt=m({}),pt=m({}),ft=m(1);return lt(),nt(),dt(),function(t,e){let a=x("token");a&&W.isLogin&&_({url:O+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(e),type:t},success:t=>(console.log(t.data.data),"success"==t.data.status?(tt.value=t.data.data.score,t.data.data.score):(y({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),y({title:"网络请求失败",icon:"none"}),0)})}(1,c.brand_id),(t,c)=>{const m=N,p=T,f=h,g=j(e("uni-rate"),U),_=B,v=V,y=$;return a(),l(f,null,{default:o((()=>[s(m,{src:S(mt).logo_image,mode:"aspectFit",class:"brand_logo"},null,8,["src"]),s(f,{class:"body"},{default:o((()=>[s(f,null,{default:o((()=>[s(p,{style:{float:"left","font-size":"20px"},selectable:"true","user-select":"true"},{default:o((()=>[w(k(S(mt).brand_name),1)])),_:1}),s(p,{style:{float:"right",margin:"5px 0px"}},{default:o((()=>[w(k(S(mt).country_name)+" / "+k(S(mt).type),1)])),_:1}),s(f,{style:{clear:"both"}})])),_:1}),s(f,{style:{margin:"20rpx 0rpx",display:"flex","justify-content":"space-between"}},{default:o((()=>[s(f,{onClick:c[0]||(c[0]=t=>ut()),style:{display:"inline-block",position:"relative",left:"-8rpx"}},{default:o((()=>[s(g,{style:{"margin-top":"5px",float:"left"},value:S(mt).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"},null,8,["value"]),s(p,{style:{float:"left",position:"relative",top:"5px"}},{default:o((()=>[w(k(S(mt).score)+"（"+k(S(mt).vote_number)+"次评分）",1)])),_:1}),s(f,{style:{clear:"both"}})])),_:1}),s(p,{class:"follow",onClick:ot,style:r({background:L.value?"#ff6a6c":"#65C3D6"})},{default:o((()=>[w(k(L.value?"已关注":"+ 关注品牌"),1)])),_:1},8,["style"])])),_:1}),s(f,{style:{"margin-top":"15px"}},{default:o((()=>[s(p,null,{default:o((()=>[w("别名："+k(S(mt).nickname_list),1)])),_:1})])),_:1}),s(f,{style:{"margin-top":"10px"}},{default:o((()=>[s(p,null,{default:o((()=>[w("简介："+k(S(mt).description),1)])),_:1})])),_:1}),C("div",{style:{clear:"both"}}),s(p,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:o((()=>[w("收录作品 ("+k(S(ct).total)+")",1)])),_:1}),s(f,{class:"brand_goods"},{default:o((()=>[(a(!0),i(n,null,d(S(ct).goods_list,((t,e)=>(a(),l(f,{class:"brand_goods_item",style:{},key:t.id},{default:o((()=>[s(_,{onClick:e=>{return a=t.id,void F({url:"/pages/goods/goods?goods_id="+a});var a},style:{width:"100%",height:"100%"}},{default:o((()=>[s(f,{style:{width:"100%",height:"calc(100% - 20px)"}},{default:o((()=>[s(m,{style:{width:"100%",height:"100%"},src:t.goods_images[0],mode:"aspectFill",class:"brand_goods_image"},null,8,["src"])])),_:2},1024),s(p,{style:{display:"block",width:"100%","text-align":"center","font-weight":"900",color:"#586f88"}},{default:o((()=>[w(k(t.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),s(v,{class:"load_more",onClick:nt},{default:o((()=>[w("加载更多")])),_:1}),s(f,null,{default:o((()=>[s(p,{style:{color:"rgb(100, 198, 220)",display:"block",margin:"20px 0px"}},{default:o((()=>[w("讨论 ("+k(S(pt).total)+")",1)])),_:1}),S(pt).comment_list?(a(),l(f,{key:0},{default:o((()=>[(a(!0),i(n,null,d(S(pt).comment_list,((t,e)=>(a(),l(f,{class:"comment_item",key:t.id,style:{"margin-bottom":"20px"}},{default:o((()=>[s(f,{style:{float:"left",width:"80px",padding:"0px 10px 10px 0px"},onClick:e=>{return a=t.uid,void F({url:"/pages/user_page/user_page?uid="+a});var a}},{default:o((()=>[s(m,{style:{width:"50px",height:"50px","border-radius":"100%",display:"block",margin:"10px"},src:t.avatar,mode:"aspectFill"},null,8,["src"]),s(p,{style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},{default:o((()=>[w(k(t.username),1)])),_:2},1024)])),_:2},1032,["onClick"]),s(f,{style:{float:"left",padding:"15px 15px 30px 15px",background:"rgb(245 245 245)",width:"calc(100vw - 170px)","min-height":"60px","border-radius":"15px",position:"relative",top:"2px"}},{default:o((()=>[s(p,{style:{width:"100%","white-space":"normal","word-break":"break-all"}},{default:o((()=>[w(k(t.comment),1)])),_:2},1024),s(p,{style:{color:"#888","font-size":"12px",position:"absolute",bottom:"3px",left:"15px"}},{default:o((()=>[w(k(it(t.created_at))+" floor#"+k(t.floor),1)])),_:2},1024)])),_:2},1024),s(f,{style:{clear:"both"}})])),_:2},1024)))),128)),s(v,{class:"load_more",onClick:dt},{default:o((()=>[w("加载更多")])),_:1})])),_:1})):z("",!0)])),_:1})])),_:1}),s(f,{style:{height:"80px"}}),s(f,{class:u(["modal_shadow",{none:!S(et)}]),onClick:c[2]||(c[2]=t=>ut())},{default:o((()=>[s(f,{class:"modal_box"},{default:o((()=>[s(f,null,{default:o((()=>[s(p,{style:{"font-size":"25px",color:"#7b6d6d",width:"100%","text-align":"center","margin-bottom":"13px",display:"block"}},{default:o((()=>[w("您的评分 "+k(S(tt)),1)])),_:1}),s(g,{modelValue:S(tt),"onUpdate:modelValue":c[1]||(c[1]=t=>M(tt)?tt.value=t:tt=t),"allow-half":"true",style:{"margin-top":"5px",float:"left"},size:"45"},null,8,["modelValue"])])),_:1}),s(f,{style:{clear:"both"}}),s(v,{style:{display:"block",width:"100px",position:"absolute",bottom:"0px",right:"20px"},class:"light_button",onClick:at},{default:o((()=>[s(p,{style:{color:"#fff"}},{default:o((()=>[w("提交")])),_:1})])),_:1})])),_:1})])),_:1},8,["class"]),P(s(f,{class:"mask",onClick:Q},null,512),[[R,Y.value]]),s(f,{class:"bottom_tab",style:r({paddingBottom:Z.value})},{default:o((()=>[s(y,{class:"comment_input",modelValue:S(J),"onUpdate:modelValue":c[3]||(c[3]=t=>M(J)?J.value=t:J=t),style:{},"adjust-position":!1,onClick:q,onFocus:q,onBlur:K},null,8,["modelValue"]),s(v,{style:{"flex-shrink":"0",width:"90px"},onClick:rt},{default:o((()=>[w("写评论")])),_:1})])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-3289a595"]]);export{H as default};
