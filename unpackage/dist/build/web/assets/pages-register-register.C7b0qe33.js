import{h as e,P as a,c as l,w as s,g as o,o as t,a as u,b as d,t as r,v as c,q as n,l as p,m as i,M as v,ae as m,n as h,f as w,N as f,D as _}from"./index-u2rUIk8T.js";import{w as g}from"./config.DgkxgtZ3.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=y({__name:"register",setup(y){const b=e({telephone:"",code:"",password:"",rePassword:""}),x=e({phone:"",code:"",password:"",rePassword:""}),P=e(0),V=a((()=>P.value>0)),k=a((()=>P.value>0?`${P.value}秒后重发`:"获取验证码")),j=e(!1),B=()=>b.value.telephone?/^1[3-9]\d{9}$/.test(b.value.telephone)?(x.value.phone="",!0):(x.value.phone="手机号格式不正确",!1):(x.value.phone="手机号不能为空",!1),U=async()=>{if(B())try{const e=await p({url:`${g}/send-sms-code`,method:"POST",data:{tel_phone:b.value.telephone}});"success"===e.data.status?($(),i({title:"验证码已发送",icon:"none"})):i({title:e.data.msg||"发送失败",icon:"none"})}catch(e){i({title:"网络请求失败",icon:"none"})}},$=()=>{P.value=60;const e=setInterval((()=>{P.value<=0?clearInterval(e):P.value--}),1e3)},C=()=>b.value.password.length<6?(x.value.password="密码至少需要6位",!1):(x.value.password="",!0),I=()=>b.value.password!==b.value.rePassword?(x.value.rePassword="两次密码输入不一致",!1):(x.value.rePassword="",!0),T=()=>b.value.code?6!==b.value.code.length?(x.value.code="验证码格式不正确",!1):(x.value.code="",!0):(x.value.code="验证码不能为空",!1),O=async()=>{if([B(),T(),C(),I()].every((e=>e)))try{j.value=!0;const e=await p({url:`${g}/register`,method:"POST",data:{telephone:b.value.telephone,code:b.value.code,password:b.value.password,re_password:b.value.rePassword}});"success"===e.data.status?(v("token",e.data.data.jwt_token),i({title:"注册成功",icon:"success",complete:()=>{setTimeout((()=>{m({url:"/pages/mine/mine"})}),1500)}})):i({title:e.data.msg||"注册失败",icon:"none"})}catch(e){i({title:"网络请求失败",icon:"none"})}finally{j.value=!1}},S=()=>{h({url:"/pages/login/login"})};return(e,a)=>{const p=w,i=o,v=f,m=_;return t(),l(i,{class:"container"},{default:s((()=>[u(i,{class:"header"},{default:s((()=>[u(p,{class:"title"},{default:s((()=>[d("手机号注册")])),_:1})])),_:1}),u(i,{class:"form-box"},{default:s((()=>[u(i,{class:"input-item"},{default:s((()=>[u(i,{class:"input-wrapper"},{default:s((()=>[u(p,{class:"prefix"},{default:s((()=>[d("+86")])),_:1}),u(v,{modelValue:b.value.telephone,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value.telephone=e),type:"number",placeholder:"请输入手机号",maxlength:"11",class:"input","placeholder-class":"placeholder",onBlur:B},null,8,["modelValue"])])),_:1}),x.value.phone?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(x.value.phone),1)])),_:1})):c("",!0)])),_:1}),u(i,{class:"input-item"},{default:s((()=>[u(i,{class:"code-wrapper"},{default:s((()=>[u(v,{modelValue:b.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value.code=e),type:"number",autocomplete:"new-password",placeholder:"请输入验证码",maxlength:"6",class:"input","placeholder-class":"placeholder",onBlur:T},null,8,["modelValue"]),u(m,{class:n(["code-btn",{disabled:V.value}]),disabled:V.value,onClick:U},{default:s((()=>[d(r(k.value),1)])),_:1},8,["disabled","class"])])),_:1}),x.value.code?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(x.value.code),1)])),_:1})):c("",!0)])),_:1}),u(i,{class:"input-item"},{default:s((()=>[u(i,{class:"input-wrapper"},{default:s((()=>[u(v,{modelValue:b.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>b.value.password=e),autocomplete:"new-password",type:"password",placeholder:"请输入密码（至少6位）",class:"input","placeholder-class":"placeholder",onBlur:C},null,8,["modelValue"])])),_:1}),x.value.password?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(x.value.password),1)])),_:1})):c("",!0)])),_:1}),u(i,{class:"input-item"},{default:s((()=>[u(i,{class:"input-wrapper"},{default:s((()=>[u(v,{modelValue:b.value.rePassword,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value.rePassword=e),type:"password",placeholder:"请再次输入密码",class:"input","placeholder-class":"placeholder",onBlur:I},null,8,["modelValue"])])),_:1}),x.value.rePassword?(t(),l(p,{key:0,class:"error-text"},{default:s((()=>[d(r(x.value.rePassword),1)])),_:1})):c("",!0)])),_:1}),u(m,{class:n(["submit-btn",{loading:j.value}]),disabled:j.value,onClick:O},{default:s((()=>[d(r(j.value?"注册中...":"立即注册"),1)])),_:1},8,["disabled","class"]),u(i,{class:"bottom-tips"},{default:s((()=>[d(" 已有账号？ "),u(p,{class:"link-text",onClick:S},{default:s((()=>[d("去登录")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-c20f9fc8"]]);export{b as default};
