import{g as a,m as o,c as e,w as l,l as s,k as t,v as n,f as i,o as d,a as c,d as r,r as u,F as p,b as m,H as _,a7 as g,i as f,S as v,L as h,ao as y,e as b,K as x,t as k,G as j}from"./index-B55GPRQF.js";import{_ as w}from"./relation-picker.C_3PEIrw.js";import{r as C}from"./uni-app.es.CzHle-z4.js";import{_ as L}from"./cancel.CnEdunnH.js";import{_ as z}from"./add2.S6xx6DwX.js";import{_ as I}from"./right2.s_X9TKoF.js";import{w as V,i as D,e as F}from"./config.BIUptOrH.js";import{a as B,g as G,u as T}from"./image.BvaLdYzg.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.B2Wm8RW1.js";import"./common-search.OBIzXxZ7.js";import"./search.CsIL0f2m.js";import"./goods-search.DumlFeXD.js";import"./common-modal.MV9iS1Pr.js";import"./uni-transition.CvFnBj2q.js";const J=E({__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(E){const J=E,P=a([]),U=a([]),A=a([]),H=a(!1);a(""),a(0),a(""),a(0),a("");const S=a=>{try{const o={goods_id:a.goods.id||0,goods_name:a.goods.name,goods_image:a.goods.image||"",brand_id:a.brand.id||0,brand_name:a.brand.name||(a.isFuzzy?"":"未知品牌"),type:a.type||(a.isFuzzy?"未知类型":"")};O.value.some((a=>0!==a.goods_id&&a.goods_id===o.goods_id||a.goods_name===o.goods_name))?t({title:"已存在相同关联项",icon:"none"}):O.value.push(o)}catch(o){console.error("保存关联数据失败:",o),t({title:"保存关联信息失败",icon:"none"})}},K=()=>{console.log("用户取消选择")},M=()=>{H.value=!0};const O=a([]);var Q;J.goods_id&&J.goods_name&&J.brand_id&&J.brand_name&&J.type&&(Q=J.goods_id,new Promise(((a,o)=>{s({url:V+"/goods?id="+Q,method:"GET",timeout:5e3,success:o=>{console.log(o.data.data),a(o.data)},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"}),o(a)},complete:()=>{n()}})}))).then((a=>{let o={brand_id:parseInt(J.brand_id,10),goods_id:parseInt(J.goods_id,10),brand_name:J.brand_name,goods_name:J.goods_name,goods_image:a.data.goods_images[0],type:J.type};console.log(o),O.value.push(o)}));const R=a(""),$=a("");function q(a){j({current:P.value[a],urls:P.value})}function N(){const a=_("token");if(!a)return void t({title:"请先登录",icon:"none"});if(!R.value.trim())return void t({title:"标题不能为空",icon:"none"});if(0===P.value.length)return void t({title:"请至少上传一张图片",icon:"none"});let o=F();const e={title:R.value,content:$.value,image_url_list:P.value,scene:o,relations:O.value.map((a=>({relation_goods_id:a.goods_id,relation_goods_name:a.goods_name,relation_brand_id:a.brand_id,relation_brand_name:a.brand_name,type:a.type,relation_origin:1})))};console.log(e),s({url:V+"/with-state/add-collocation",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:a},timeout:5e3,success:a=>{"success"===a.data.status?(t({title:"提交成功"}),R.value="",$.value="",P.value=[],O.value=[],g()):t({title:a.data.msg||"提交失败",icon:"none"})},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}})}return s({url:V+"/goods-types",method:"GET",timeout:5e3,success:a=>{console.log(a.data.data),A.value=a.data.data},fail:a=>{console.log(a),t({title:"网络请求失败",icon:"none"})}}),(a,s)=>{const n=f,_=i,g=v,j=h,V=y,F=b,E=C(o("relation-picker"),w),J=x;return d(),e(_,null,{default:l((()=>[c(_,{style:{width:"100%",overflow:"hidden"}},{default:l((()=>[c(g,{"scroll-x":"true",class:"upload_box","ll-with-animation":"true","show-scrollbar":!1},{default:l((()=>[(d(!0),r(p,null,u(P.value,((a,o)=>(d(),e(_,{class:"upload_item",key:o},{default:l((()=>[c(n,{src:a,class:"uploaded_image",onClick:q,mode:"aspectFill"},null,8,["src"]),c(n,{src:L,class:"close_icon",onClick:a=>function(a){P.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)))),128)),c(_,{class:"uploadImageBox",style:{background:"#f8f8f8"}},{default:l((()=>[c(n,{src:z,class:"upload_img",onClick:s[0]||(s[0]=o=>async function(){try{const a=await B(9);for(const o of a){const a=await G();await T(o,a.token,a.path),P.value.push(D+a.path)}t({title:`成功上传${a.length}张图片`,icon:"success"})}catch(a){console.error("上传出错:",a),t({title:"部分图片上传失败",icon:"none"})}}(a.index)),style:{width:"50px",height:"50px",margin:"25px"}})])),_:1})])),_:1})])),_:1}),c(j,{modelValue:R.value,"onUpdate:modelValue":s[1]||(s[1]=a=>R.value=a),type:"text",placeholder:"请输入标题",style:{padding:"10px",margin:"20px 15px 5px 15px",display:"block"}},null,8,["modelValue"]),c(_,{class:"oneLine"}),c(V,{modelValue:$.value,"onUpdate:modelValue":s[2]||(s[2]=a=>$.value=a),placeholder:"请输入正文",style:{padding:"10px",margin:"10px 15px 5px 15px",display:"block","line-height":"28px",width:"calc(100% - 50px)"}},null,8,["modelValue"]),c(_,{class:"oneLine"}),c(_,{class:""},{default:l((()=>[c(_,{class:"relation-trigger",onClick:M},{default:l((()=>[c(F,{class:"placeholder"},{default:l((()=>[m("点击关联娃物")])),_:1}),c(n,{src:I,class:"arrow-icon"})])),_:1})])),_:1}),c(_,{class:"publish-detail"},{default:l((()=>[c(F,null,{default:l((()=>[m("* 分享您对于打扮BJD的想法✨。")])),_:1}),c(F,null,{default:l((()=>[m("* 不关联商品的搭配不会出现在广场中。")])),_:1}),c(F,null,{default:l((()=>[m("* 可以是BJD相关的贩售广告，但不可以滥用关联。")])),_:1})])),_:1}),c(_,{class:"saveCollocationDataList"},{default:l((()=>[(d(!0),r(p,null,u(O.value,((a,o)=>(d(),e(_,{key:o},{default:l((()=>[c(_,{class:"saveCollocationDataItem"},{default:l((()=>[a.goods_image?(d(),e(n,{key:0,src:a.goods_image,mode:"aspectFill",style:{width:"70px",height:"70px"}},null,8,["src"])):(d(),e(F,{key:1,class:"no-image"},{default:l((()=>[m("?")])),_:1})),c(F,{class:"info-tap",style:{width:"calc(100% - 120px)",display:"inline-block"}},{default:l((()=>[m(k(a.type)+" "+k(a.brand_name)+" - "+k(a.goods_name),1)])),_:2},1024),c(n,{src:L,class:"close_icon",onClick:a=>function(a){O.value.splice(a,1)}(o)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),c(E,{visible:H.value,"onUpdate:visible":s[3]||(s[3]=a=>H.value=a),typeList:A.value,goodsList:U.value,onConfirm:S,onCancel:K},null,8,["visible","typeList","goodsList"]),c(_,{class:"footer"},{default:l((()=>[c(J,{onClick:N},{default:l((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-6e610be6"]]);export{J as default};
