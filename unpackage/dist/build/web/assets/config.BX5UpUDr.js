import{ah as o,C as t,l as n,P as e,O as s,m as a}from"./index-CfMR_IzQ.js";const i="http://localhost:8080",c="https://images1.fantuanpu.com/";let l=o({isLogin:!1,userInfo:{}});function r(){a({title:"请在微信小程序中登录",icon:"none"})}function u(){const o=t("token");if(console.log("token:",o),!o)return console.log("没有token，无法获取用户信息"),void m();console.log("请求接口"),n({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:o},success:o=>{const t=o.data.data;t?(console.log("获取用户信息成功,进行存储",t),g(t)):(console.log("无法获取，清理用户状态"),m())},fail:o=>{p(o,"获取用户信息失败")}})}function d(){return new Promise(((o,e)=>{const s=t("token");if(!s)return m(),void o(null);n({url:`${i}/with-state/mine`,method:"GET",header:{Authorization:s},success:t=>{const n=t.data.data;n?(console.log("返回：",n),g(n),o(n)):(m(),o(null))},fail:t=>{p(t,"获取用户信息失败"),o(null)}})}))}async function f(o,e,s){let c=t("token");return c?(n({url:i+"/with-state/add-vote-score",method:"POST",header:{Authorization:c},data:{target_id:parseInt(s),score:parseInt(e),type:o},success:o=>(console.log(o.data),"success"==o.data.status?(a({title:"评分成功",icon:"success"}),activeModal.value=!1,0):(a({title:o.data.msg,icon:"none"}),0)),fail:o=>{console.log(o),a({title:"网络请求失败",icon:"none"})}}),0):(a({title:"请先登录",icon:"none"}),0)}function h(){return 1}function g(o){e("userInfo",o),e("token",o.last_token),l.userInfo=o,l.isLogin=!0}function m(){s("userInfo"),l.userInfo={},l.isLogin=!1}function p(o,t="请求失败"){console.error(o),a({title:t,icon:"none"})}export{l as a,d as b,r as c,h as d,u as g,c as i,f as v,i as w};
