"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/config.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const a={__name:"username",setup(a){e.index.setNavigationBarTitle({title:"修改用户名"});const o=e.ref(t.global.userInfo.username||""),n=e.ref(!1),s=e.computed((()=>o.value.length>=2&&o.value!==t.global.userInfo.username));async function i(){if(s.value)try{n.value=!0;const a=await e.index.request({url:t.websiteUrl+"/with-state/update-profile",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:{username:o.value}});"success"===a.data.status?(e.index.showToast({title:"更新成功",icon:"success"}),await t.getUserInfo(),setTimeout((()=>e.index.navigateBack()),1500)):e.index.showToast({title:a.data.msg||"更新失败",icon:"none"})}catch(a){e.index.showToast({title:"请求失败，请稍后重试",icon:"none"})}finally{n.value=!1}}return(t,a)=>e.e({a:o.value,b:e.o((e=>o.value=e.detail.value)),c:e.p({type:"person",size:"18",color:"#999"}),d:e.t(n.value?"提交中...":"更新用户名"),e:n.value},(n.value,{}),{f:s.value?1:"",g:e.o(i),h:!s.value,i:e.p({type:"info",size:"16",color:"#666"})})}},o=e._export_sfc(a,[["__scopeId","data-v-960efc4b"]]);wx.createPage(o);
