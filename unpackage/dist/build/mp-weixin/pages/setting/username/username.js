"use strict";const e=require("../../../common/vendor.js"),o=require("../../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../../components/view-logs/view-logs.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const t={__name:"username",setup(t){e.index.setNavigationBarTitle({title:"修改用户名"});const n=e.ref(o.global.userInfo.username||""),a=e.ref(!1),s=e.computed((()=>n.value.length>=2&&n.value!==o.global.userInfo.username));async function i(){if(s.value)try{a.value=!0;const t=await e.index.request({url:o.websiteUrl.value+"/with-state/update-profile",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:{username:n.value}});"success"===t.data.status?(e.index.showToast({title:"更新成功",icon:"success"}),await o.getUserInfo(),setTimeout((()=>e.index.navigateBack()),1500)):e.index.showToast({title:t.data.msg||"更新失败",icon:"none"})}catch(t){e.index.showToast({title:"请求失败，请稍后重试",icon:"none"})}finally{a.value=!1}}return(o,t)=>e.e({a:n.value,b:e.o((e=>n.value=e.detail.value)),c:e.p({type:"person",size:"18",color:"#999"}),d:e.t(a.value?"提交中...":"更新用户名"),e:a.value},(a.value,{}),{f:s.value?1:"",g:e.o(i),h:!s.value,i:e.p({type:"info",size:"16",color:"#666"})})}},n=e._export_sfc(t,[["__scopeId","data-v-c4a49249"]]);wx.createPage(n);
