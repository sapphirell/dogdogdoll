"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("report-button")+e.resolveComponent("uni-icons")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../components/report-button/report-button.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const o={__name:"treehole_detail",props:{id:{type:String,required:!0}},setup(o){e.ref(!0),e.ref(!1),e.ref("");const n=e.ref(0),a=e.ref(null),i=e.ref(null),l=e.ref(null);e.ref(1);let s=e.ref({});const r=e.ref(!1),u=o,d=({parent:e,target:t})=>{var o;console.log("parent",e),console.log("target",t);let n=e;null!=t&&(n=t),s.value.id!=n.id?(console.log("item",n),s.value=n,null==(o=l.value)||o.focusInput()):s.value={}},c=({content:o,replyInfo:a,origin:l})=>{let s=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",a);const r={content:o,origin:l,target_id:parseInt(n.value),type:5,...a.id&&{reply_id:a.id,reply_for:a.comment,reply_user_id:a.user_id,parent_id:a.parent_id>0?a.parent_id:a.id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:r,success:t=>{var o,n;if("success"==t.data.status){const a=t.data.data;0===a.parent_id?(console.log("添加主评论"),null==(o=i.value)||o.addNewComment(a)):(console.log("添加子评论"),null==(n=i.value)||n.addReplyComment(a)),e.index.showToast({title:"评论成功",icon:"success"})}else e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})};const p=()=>{if(!t.global.isLogin)return void e.index.showModal({title:"提示",content:"需要登录后才能点赞",success:t=>{t.confirm&&e.index.navigateTo({url:"/pages/login/login"})}});const o=e.index.getStorageSync("token"),n=t.websiteUrl+(r.value?"/with-state/unlike":"/with-state/add-like");e.index.request({url:n,method:"POST",header:{Authorization:o},data:{id:parseInt(u.id),type:5},success:e=>{"success"===e.data.status&&(r.value=!r.value,a.value.like_count+=r.value?1:-1)}})};const v=e.computed((()=>{var e,t;return(null==(t=null==(e=a.value)?void 0:e.images)?void 0:t.slice(0,9))||[]})),m=e.computed((()=>{var e,t;return((null==(t=null==(e=a.value)?void 0:e.images)?void 0:t.length)||0)-9})),g=e.computed((()=>{var e,t;return((null==(t=null==(e=a.value)?void 0:e.images)?void 0:t.length)||0)>9}));e.index.setNavigationBarTitle({title:"投稿详情"});const f=e.computed((()=>{const e=v.value.length;return 1===e?"single":2===e?"double":"multi"})),h=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return e.onMounted((async()=>{n.value=u.id,console.log("pageId",n.value);try{const o=await e.index.request({url:`${t.websiteUrl}/treehole-detail?id=${u.id}`});"success"===o.data.status&&(a.value=o.data.data)}catch(o){console.log(o),e.index.showToast({title:"加载失败",icon:"none"})}t.asyncGetUserInfo(),function(){let o=e.index.getStorageSync("token");""!=o&&e.index.request({url:t.websiteUrl+"/with-state/hasLike?id="+u.id+"&type=5",method:"POST",header:{Authorization:o},success:t=>{console.log(t.data),"success"==t.data.status?t.data.data.id>0?r.value=!0:r.value=!1:e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}()})),(t,o)=>e.e({a:a.value},a.value?{b:a.value.avatar||"/static/noname.png",c:e.t(a.value.author_name),d:e.t(h(a.value.created_at)),e:e.p({"report-type":"3","relation-id":parseInt(u.id),"button-text":"举报","icon-type":"flag","icon-size":"24","icon-color":"#666"}),f:e.t(a.value.content),g:e.f(v.value,((t,o,n)=>e.e({a:t,b:e.o((t=>(t=>{e.index.previewImage({current:t,urls:a.value.images})})(o)),o),c:g.value&&8===o},g.value&&8===o?{d:e.t(m.value)}:{},{e:o}))),h:e.n(f.value),i:e.p({type:r.value?"hand-up-filled":"hand-up",size:"24",color:r.value?"#ff4d4f":"#666"}),j:e.t(a.value.like_count||0),k:e.o(p),l:e.p({type:"redo",size:"24",color:"#666"}),m:e.o((t=>function(t){let o="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+t.id;e.index.setClipboardData({data:o,success:function(){e.index.showToast({title:"复制链接成功",icon:"none"})}})}(a.value))),n:e.t(h(a.value.approve_time))}:{},{o:e.sr(i,"f102c4f6-3",{k:"commentListRef"}),p:e.o(d),q:e.p({type:5,"relation-id":parseInt(u.id)}),r:e.sr(l,"f102c4f6-4",{k:"commentInputRef"}),s:e.o(c),t:e.o((t=>e.isRef(s)?s.value=t:s=t)),v:e.p({"reply-info":e.unref(s),"target-id":n.value})})},__runtimeHooks:2};wx.createPage(o);
