"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("comment-input"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/comment-input/comment-input.js"))();const a={__name:"treehole_detail",props:{id:{type:String,required:!0}},setup(a){e.ref(!0);const o=e.ref(!1),n=e.ref(""),i=e.ref(0),l=e.ref(null),s=e.ref(!1),u=e.ref({});let d=e.ref(1),r=e.ref({});const c=a;const v=()=>{if(!t.global.isLogin)return void e.index.showModal({title:"提示",content:"需要登录后才能点赞",success:t=>{t.confirm&&e.index.navigateTo({url:"/pages/login/login"})}});const a=e.index.getStorageSync("token"),o=t.websiteUrl+(s.value?"/with-state/unlike":"/with-state/add-like");e.index.request({url:o,method:"POST",header:{Authorization:a},data:{id:parseInt(c.id),type:5},success:e=>{"success"===e.data.status&&(s.value=!s.value,l.value.like_count+=s.value?1:-1)}})};const m=({content:a,replyInfo:o,origin:n})=>{let i=e.index.getStorageSync("token");if(!i)return void e.index.showToast({title:"请先登录",icon:"none"});const l={content:a,target_id:parseInt(c.id),type:5,origin:n,...o.id&&{reply_id:o.id,reply_for:o.comment,reply_user_id:o.user_id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:i},data:l,success:t=>{"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),d.value=1,u.value={},S()):e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})},g=e.computed((()=>{var e,t;return(null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.slice(0,9))||[]})),p=e.computed((()=>{var e,t;return((null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.length)||0)-9})),h=e.computed((()=>{var e,t;return((null==(t=null==(e=l.value)?void 0:e.images)?void 0:t.length)||0)>9}));function f(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),l=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${i}:${l}`}e.index.setNavigationBarTitle({title:"投稿详情"});const _=e.computed((()=>{const e=g.value.length;return 1===e?"single":2===e?"double":"multi"})),x=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};function S(){e.index.request({url:t.websiteUrl+"/treehole-comment?treehole_id="+c.id+"&page="+d.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),u.value.page_index=t.data.data.page_index,u.value.total=t.data.data.total,u.value.comment_list=u.value.comment_list?u.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(d.value+=1),0==t.data.data.comment_list.length&&d.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}return e.onMounted((async()=>{try{const a=await e.index.request({url:`${t.websiteUrl}/treehole-detail?id=${c.id}`});"success"===a.data.status&&(l.value=a.data.data)}catch(a){console.log(a),e.index.showToast({title:"加载失败",icon:"none"})}S(),t.asyncGetUserInfo(),function(){let a=e.index.getStorageSync("token");""!=a&&e.index.request({url:t.websiteUrl+"/with-state/hasLike?id="+c.id+"&type=5",method:"POST",header:{Authorization:a},success:t=>{console.log(t.data),"success"==t.data.status?t.data.data.id>0?s.value=!0:s.value=!1:e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}()})),(t,a)=>e.e({a:l.value},l.value?{b:l.value.avatar||"/static/noname.png",c:e.t(l.value.author_name),d:e.t(x(l.value.created_at)),e:e.t(l.value.content),f:e.f(g.value,((t,a,o)=>e.e({a:t,b:e.o((t=>(t=>{e.index.previewImage({current:t,urls:l.value.images})})(a)),a),c:h.value&&8===a},h.value&&8===a?{d:e.t(p.value)}:{},{e:a}))),g:e.n(_.value),h:e.p({type:s.value?"hand-up-filled":"hand-up",size:"24",color:s.value?"#ff4d4f":"#666"}),i:e.t(l.value.like_count||0),j:e.o(v),k:e.p({type:"redo",size:"24",color:"#666"}),l:e.o((t=>function(t){let a="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+t.id;e.index.setClipboardData({data:a,success:function(){e.index.showToast({title:"复制链接成功",icon:"none"})}})}(l.value))),m:e.t(x(l.value.approve_time))}:{},{n:u.value.total},u.value.total?{o:e.t(u.value.total||0)}:{},{p:u.value.comment_list},u.value.comment_list?{q:e.f(u.value.comment_list,((a,o,n)=>({a:a.avatar,b:e.t(a.username),c:e.o((e=>t.jump2user(a.uid)),a.id),d:e.t(a.comment),e:e.t(f(a.created_at)),f:e.t(a.floor),g:e.s(e.unref(r).id===a.id?{color:"#fd6669"}:{color:"#888"}),h:e.o((e=>function(e){r.value.id!=e.id?r.value=e:r.value={}}(a)),a.id),i:a.id}))),r:e.s({fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"})}:{},{s:!u.value.total},(u.value.total,{}),{t:u.value.total},u.value.total?{v:e.o(S)}:{},{w:o.value},o.value?{x:e.t(n.value)}:{},{y:e.o(m),z:e.o((t=>e.isRef(r)?r.value=t:r=t)),A:e.p({"reply-info":e.unref(r),"target-id":i.value})})},__runtimeHooks:2};wx.createPage(a);
