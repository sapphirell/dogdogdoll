"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js"),a={__name:"sale_news",setup(a){const o=e.ref({title:"",content:"",image_list:[],created_at:0}),n=e.ref({brand_name:"",logo:""}),l=e.ref(!1),i=e.ref(!0),s=e.ref(!1),d=e.ref(""),u=e.ref(0),r=e.ref(0),c=e.ref(!1),v=e.ref({});let g=e.ref(""),m=e.ref(1),f=e.ref({});const _=e.index.getSystemInfoSync(),h=e.ref(0),x=e.computed((()=>{var e;let t=(null==(e=_.safeAreaInsets)?void 0:e.bottom)||10;h.value>0&&(t+=h.value);let a=`${t}px`;return console.log("footer-brand:"+a),a}));const p=e=>{console.log("键盘高度变化",e),h.value=e.height};function b(){l.value=!0}function w(){l.value=!1}const S=()=>{l.value=!1,e.index.hideKeyboard()};function y(t){e.index.navigateTo({url:"/pages/brand/brand?brand_id="+t})}e.index.setNavigationBarTitle({title:"图透详情"});function T(){e.index.request({url:t.websiteUrl+"/sale-news-comments?id="+u.value+"&page="+m.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),v.value.page_index=t.data.data.page_index,v.value.total=t.data.data.total,v.value.comment_list=v.value.comment_list?v.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(m.value+=1),0==t.data.data.comment_list.length&&m.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function $(){let a=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});if(""==g.value)return void e.index.showToast({title:"请输入评论内容",icon:"none"});let o={content:g.value,target_id:parseInt(u.value),type:4};f.value.id&&(o.reply_id=f.value.id,o.reply_for=f.value.comment,o.reply_user_id=f.value.user_id),console.log(o),e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:a},data:o,success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),g.value="",m.value=1,v.value={},void T()):void e.index.showToast({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function q(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${l}:${i}`}const k=()=>{e.index.request({url:t.websiteUrl+"/brand-info?id="+r.value,success:t=>{"success"===t.data.status&&(n.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),U())},fail:()=>handleError("品牌信息加载失败")})},I=async()=>{if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});const a="/with-state/"+(c.value?"unlike":"add-like");e.index.request({url:t.websiteUrl+a,method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:{id:parseInt(r.value),type:2},success:t=>{"success"===t.data.status&&(c.value=!c.value,e.index.showToast({title:c.value?"关注成功":"已取消关注",icon:"none"}))}})},U=()=>{t.global.isLogin&&e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${r.value}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")},success:e=>{var t;c.value=(null==(t=e.data.data)?void 0:t.id)>0}})};return e.onShow((()=>{console.log("注册键盘弹出事件"),e.index.onKeyboardHeightChange(p)})),e.onLoad((a=>{a.id&&a.brand_id?(u.value=a.id,r.value=a.brand_id,(async a=>{try{const n=await e.index.request({url:`${t.websiteUrl}/sale-news-detail?id=${a}`,timeout:5e3});"success"===n.data.status?(o.value={...n.data.data,image_list:n.data.data.image_list||[]},k()):handleError(n.data.msg||"数据加载失败")}catch(n){handleError("网络请求失败")}finally{i.value=!1}})(a.id),T(),t.asyncGetUserInfo().then(U)):handleError("缺少必要参数")})),(t,a)=>e.e({a:e.f(o.value.image_list,((t,a,o)=>({a:t,b:e.o((t=>{e.index.previewImage({current:goods.value.goods_images.index,urls:goods.value.goods_images})}),a),c:a}))),b:n.value.logo_image,c:e.o((e=>y(n.value.id))),d:e.t(n.value.brand_name),e:e.t(q(o.value.created_at)),f:e.o((e=>y(n.value.id))),g:e.t(c.value?"已关注":"+ 关注品牌"),h:e.o(I),i:c.value?"#ff6a6c":"#65C3D6",j:e.t(o.value.title),k:e.t(o.value.content),l:v.value.total},v.value.total?{m:e.t(v.value.total||0)}:{},{n:v.value.comment_list},v.value.comment_list?{o:e.f(v.value.comment_list,((t,a,o)=>({a:t.avatar,b:e.t(t.username),c:e.o((a=>{return o=t.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+o});var o}),t.id),d:e.t(t.comment),e:e.t(q(t.created_at)),f:e.t(t.floor),g:e.s(e.unref(f).id===t.id?{color:"#fd6669"}:{color:"#888"}),h:e.o((e=>function(e){f.value.id!=e.id?f.value=e:f.value={}}(t)),t.id),i:t.id}))),p:e.s({fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"})}:{},{q:!v.value.total},(v.value.total,{}),{r:v.value.total},v.value.total?{s:e.o(T)}:{},{t:i.value},(i.value,{}),{v:s.value},s.value?{w:e.t(d.value)}:{},{x:l.value,y:e.o(S),z:e.unref(f).id},e.unref(f).id?{A:e.t("@"+e.unref(f).username)}:{},{B:e.o(b),C:e.o(b),D:e.o(w),E:e.unref(g),F:e.o((t=>e.isRef(g)?g.value=t.detail.value:g=t.detail.value)),G:e.o($),H:x.value})}},o=e._export_sfc(a,[["__scopeId","data-v-70c7a575"]]);wx.createPage(o);
