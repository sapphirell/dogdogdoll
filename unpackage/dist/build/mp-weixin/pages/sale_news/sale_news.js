"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){e.resolveComponent("comment-input")()}Math;const a={__name:"sale_news",setup(a){const o=e.ref({title:"",content:"",image_list:[],created_at:0}),n=e.ref({brand_name:"",logo:""}),i=e.ref(!0),l=e.ref(!1),s=e.ref(""),d=e.ref(0),r=e.ref(0),u=e.ref(!1),c=e.ref({});let v=e.ref(1),g=e.ref({});function m(t){e.index.navigateTo({url:"/pages/brand/brand?brand_id="+t})}e.index.getSystemInfoSync(),e.index.setNavigationBarTitle({title:"图透详情"});function _(){e.index.request({url:t.websiteUrl+"/sale-news-comments?id="+d.value+"&page="+v.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),c.value.page_index=t.data.data.page_index,c.value.total=t.data.data.total,c.value.comment_list=c.value.comment_list?c.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(v.value+=1),0==t.data.data.comment_list.length&&v.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}const f=({content:a,replyInfo:o,origin:n})=>{let i=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});const l={content:a,origin:n,target_id:parseInt(d.value),type:4,...o.id&&{reply_id:o.id,reply_for:o.comment,reply_user_id:o.user_id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:i},data:l,success:t=>{"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),v.value=1,c.value={},_()):e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})};function h(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),l=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${i}:${l}`}const p=()=>{e.index.request({url:t.websiteUrl+"/brand-info?id="+r.value,success:t=>{"success"===t.data.status&&(n.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),w())},fail:()=>handleError("品牌信息加载失败")})},x=async()=>{if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});const a="/with-state/"+(u.value?"unlike":"add-like");e.index.request({url:t.websiteUrl+a,method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:{id:parseInt(r.value),type:2},success:t=>{"success"===t.data.status&&(u.value=!u.value,e.index.showToast({title:u.value?"关注成功":"已取消关注",icon:"none"}))}})},w=()=>{t.global.isLogin&&e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${r.value}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")},success:e=>{var t;u.value=(null==(t=e.data.data)?void 0:t.id)>0}})};return e.onLoad((a=>{a.id&&a.brand_id?(d.value=a.id,r.value=a.brand_id,(async a=>{try{const n=await e.index.request({url:`${t.websiteUrl}/sale-news-detail?id=${a}`,timeout:5e3});"success"===n.data.status?(o.value={...n.data.data,image_list:n.data.data.image_list||[]},p()):handleError(n.data.msg||"数据加载失败")}catch(n){handleError("网络请求失败")}finally{i.value=!1}})(a.id),_(),t.asyncGetUserInfo().then(w)):handleError("缺少必要参数")})),(t,a)=>e.e({a:e.f(o.value.image_list,((t,a,o)=>({a:t,b:e.o((t=>{e.index.previewImage({current:goods.value.goods_images.index,urls:goods.value.goods_images})}),a),c:a}))),b:n.value.logo_image,c:e.o((e=>m(n.value.id))),d:e.t(n.value.brand_name),e:e.t(h(o.value.created_at)),f:e.o((e=>m(n.value.id))),g:e.t(u.value?"已关注":"+ 关注品牌"),h:e.o(x),i:u.value?"#ff6a6c":"#65C3D6",j:e.t(o.value.title),k:e.t(o.value.content),l:c.value.total},c.value.total?{m:e.t(c.value.total||0)}:{},{n:c.value.comment_list},c.value.comment_list?{o:e.f(c.value.comment_list,((t,a,o)=>({a:t.avatar,b:e.t(t.username),c:e.o((a=>{return o=t.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+o});var o}),t.id),d:e.t(t.comment),e:e.t(h(t.created_at)),f:e.t(t.floor),g:e.s(e.unref(g).id===t.id?{color:"#fd6669"}:{color:"#888"}),h:e.o((e=>function(e){g.value.id!=e.id?g.value=e:g.value={}}(t)),t.id),i:t.id}))),p:e.s({fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"})}:{},{q:!c.value.total},(c.value.total,{}),{r:c.value.total},c.value.total?{s:e.o(_)}:{},{t:i.value},(i.value,{}),{v:l.value},l.value?{w:e.t(s.value)}:{},{x:e.o(f),y:e.o((t=>e.isRef(g)?g.value=t:g=t)),z:e.p({"reply-info":e.unref(g),"target-id":d.value})})}},o=e._export_sfc(a,[["__scopeId","data-v-27a694b3"]]);wx.createPage(o);
