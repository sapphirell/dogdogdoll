"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const a={__name:"sale_news",setup(a){const n=e.ref({title:"",content:"",image_list:[],created_at:0}),o=e.ref({brand_name:"",logo:""}),i=e.ref(!0),s=e.ref(!1),r=e.ref(""),l=e.ref(0),d=e.ref(0),u=e.ref(!1),c=e.ref(null),g=e.ref(null);e.ref(1);let v=e.ref({});e.index.getSystemInfoSync();const m=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let n=e;null!=t&&(n=t),v.value.id!=n.id?(console.log("item",n),v.value=n,null==(a=g.value)||a.focusInput()):v.value={}};function p(t){e.index.navigateTo({url:"/pages/brand/brand?brand_id="+t})}e.index.setNavigationBarTitle({title:"图透详情"});const f=({content:a,replyInfo:n,origin:o})=>{let i=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",n);const s={content:a,origin:o,target_id:parseInt(l.value),type:4,...n.id&&{reply_id:n.id,reply_for:n.comment,reply_user_id:n.user_id,parent_id:n.parent_id>0?n.parent_id:n.id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:i},data:s,success:t=>{var a,n;if("success"==t.data.status){const o=t.data.data;0===o.parent_id?null==(a=c.value)||a.addNewComment(o):null==(n=c.value)||n.addReplyComment(o),e.index.showToast({title:"评论成功",icon:"success"})}else e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})};function _(e){const t=new Date(1e3*e),a=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${n}-${o} ${i}:${s}`}const h=()=>{e.index.request({url:t.websiteUrl+"/brand-info?id="+d.value,success:t=>{"success"===t.data.status&&(o.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),y())},fail:()=>handleError("品牌信息加载失败")})},x=async()=>{if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});const a="/with-state/"+(u.value?"unlike":"add-like");e.index.request({url:t.websiteUrl+a,method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:{id:parseInt(d.value),type:2},success:t=>{"success"===t.data.status&&(u.value=!u.value,e.index.showToast({title:u.value?"关注成功":"已取消关注",icon:"none"}))}})},y=()=>{t.global.isLogin&&e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${d.value}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")},success:e=>{var t;u.value=(null==(t=e.data.data)?void 0:t.id)>0}})};return e.onLoad((a=>{a.id&&a.brand_id?(l.value=a.id,d.value=a.brand_id,(async a=>{try{const o=await e.index.request({url:`${t.websiteUrl}/sale-news-detail?id=${a}`,timeout:5e3});"success"===o.data.status?(n.value={...o.data.data,image_list:o.data.data.image_list||[]},h()):handleError(o.data.msg||"数据加载失败")}catch(o){handleError("网络请求失败")}finally{i.value=!1}})(a.id),t.asyncGetUserInfo().then(y)):handleError("缺少必要参数")})),(t,a)=>e.e({a:e.f(n.value.image_list,((t,a,n)=>({a:t,b:e.o((t=>{e.index.previewImage({current:goods.value.goods_images.index,urls:goods.value.goods_images})}),a),c:a}))),b:o.value.logo_image,c:e.o((e=>p(o.value.id))),d:e.t(o.value.brand_name),e:e.t(_(n.value.created_at)),f:e.o((e=>p(o.value.id))),g:e.t(u.value?"已关注":"+ 关注品牌"),h:e.o(x),i:u.value?"#ff6a6c":"#65C3D6",j:e.t(n.value.title),k:e.t(n.value.content),l:e.sr(c,"212e1d04-0",{k:"commentListRef"}),m:e.o(m),n:e.p({type:4,"relation-id":parseInt(l.value)}),o:i.value},(i.value,{}),{p:s.value},s.value?{q:e.t(r.value)}:{},{r:e.sr(g,"212e1d04-1",{k:"commentInputRef"}),s:e.o(f),t:e.o((t=>e.isRef(v)?v.value=t:v=t)),v:e.p({"reply-info":e.unref(v),"target-id":l.value})})}},n=e._export_sfc(a,[["__scopeId","data-v-212e1d04"]]);wx.createPage(n);
