"use strict";const e=require("../../common/vendor.js"),a=require("../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../components/view-logs/view-logs.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const t={__name:"user_page",props:["uid"],setup(t){const o=e.ref(0),i=e.ref(["搭配","娃柜","点评"]),l=t,s=e.ref({avatar:"",user_name:"加载中..."}),n=e.ref(!1),u=e.ref(!1),c=e.ref([]),r=e.ref([]),d=e.ref([]),v=e.ref([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e.watch(o,(e=>{v.value[e];0===[c,r,d][e].value.length&&p()}));const g=a=>{e.index.navigateTo({url:a})},p=async()=>{if(n.value||u.value)return;const t=v.value[o.value];if(!t.loading&&!t.finished){t.loading=!0;try{let i,s;switch(o.value){case 0:i=`/user-info/collection?user_id=${l.uid}&page=${t.page}`,s="List";break;case 1:i=`/user-info/show-case?user_id=${l.uid}&page=${t.page}`,s="List";break;case 2:i=`/user-info/posts?user_id=${l.uid}&page=${t.page}`,s="comment_list"}const n=await e.index.request({url:`${a.websiteUrl.value}${i}`});if("success"===n.data.status){const e=n.data.data,a=e[s].map((e=>{var a,t,i;switch(o.value){case 0:return{id:e.id,cover:(null==(a=e.image_urls)?void 0:a.split(",")[0])||"",images:(null==(t=e.image_urls)?void 0:t.split(","))||[],title:e.title,time:e.created_at};case 1:return{id:e.id,cover:(null==(i=e.image_urls)?void 0:i.split(",")[0])||"",title:e.name,desc:e.description,time:e.created_at,price:e.price||0};case 2:return{id:e.id,product_thumb:e.target_image,product_name:e.target_name,content:e.comment,create_time:h(e.created_at),target_id:e.relation_id}}})),i=[c,r,d][o.value];i.value=[...i.value,...a],t.total=e.total,t.finished=i.value.length>=e.total,t.page++}}catch(i){console.log(i),e.index.showToast({title:"数据加载失败",icon:"none"})}finally{t.loading=!1}}},_=async()=>{try{const t=e.index.getStorageSync("token");if(!t)return void console.log("未登录");const o=n.value?"remove":"add",i=await e.index.request({url:`${a.websiteUrl.value}/with-state/blacklist/${o}?target_user_id=`+l.uid,method:"POST",header:{Authorization:t}});"success"===i.data.status?(n.value=!n.value,e.index.showToast({title:n.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(n.value||u.value)&&(c.value=[],r.value=[],d.value=[])):e.index.showToast({title:i.data.msg,icon:"none"})}catch(t){console.log("操作失败",t),e.index.showToast({title:"操作失败",icon:"none"})}},h=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`};return e.index.setNavigationBarTitle({title:"用户主页"}),e.onShow((()=>{(async()=>{try{const t=await e.index.request({url:`${a.websiteUrl.value}/user-info?uid=${l.uid}`});"success"===t.data.status&&(s.value=t.data.data)}catch(t){e.index.showToast({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const t=e.index.getStorageSync("token");if(t)try{const o=await e.index.request({url:`${a.websiteUrl.value}/with-state/blacklist/status`,method:"GET",data:{target_user_id:l.uid},header:{Authorization:t}});"success"===o.data.status&&(n.value=o.data.data.is_blocked,u.value=o.data.data.they_blocked)}catch(o){console.log("获取黑名单状态失败",o)}else console.log("未登录")})().then((()=>{n.value||u.value||p()}))})),e.onReachBottom((()=>{p()})),(a,t)=>e.e({a:s.value.avatar,b:e.t(s.value.user_name),c:e.p({type:(n.value,"minus"),size:"16",color:"#fff"}),d:e.t(n.value?"已拉黑":"拉黑"),e:n.value?1:"",f:e.o(_),g:!n.value&&!u.value},n.value||u.value?{}:e.e({h:e.f(i.value,((a,t,i)=>({a:e.t(a),b:t,c:o.value===t?1:"",d:e.o((e=>o.value=t),t)}))),i:0===o.value},0===o.value?{j:e.f(c.value,((a,t,o)=>({a:a.cover,b:e.t(a.title),c:t,d:e.o((e=>g(`/pages/collocation_share/collocation_share?collocation_id=${a.id}&origin=1`)),t)})))}:{},{k:1===o.value},1===o.value?{l:e.f(r.value,((a,t,o)=>({a:a.cover,b:e.t(a.title),c:e.t(a.price),d:t,e:e.o((e=>g(`/pages/collocation_share/collocation_share?collocation_id=${a.id}&origin=2`)),t)})))}:{},{m:2===o.value},2===o.value?{n:e.f(d.value,((a,t,o)=>({a:a.product_thumb,b:e.t(a.product_name),c:e.t(a.content),d:e.t(a.create_time),e:t,f:e.o((e=>g(`/pages/goods/goods?goods_id=${a.target_id}`)),t)})))}:{}),{o:n.value||u.value},n.value||u.value?{p:e.p({type:"minus",size:"48",color:"#ccc"})}:{})}},o=e._export_sfc(t,[["__scopeId","data-v-a6fca59b"]]);wx.createPage(o);
