"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../components/view-logs/view-logs.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const a={__name:"user_page",props:["uid"],setup(a){const o=e.ref(0),i=e.ref(["搭配","娃柜","点评"]),s=a,l=e.ref({avatar:"",user_name:"加载中..."}),n=e.ref(!1),u=e.ref(!1),c=e.ref([]),r=e.ref([]),d=e.ref([]),v=e.ref([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e.watch(o,(e=>{v.value[e];0===[c,r,d][e].value.length&&g()}));const g=async()=>{if(n.value||u.value)return;const a=v.value[o.value];if(!a.loading&&!a.finished){a.loading=!0;try{let i,l;switch(o.value){case 0:i=`/user-info/collection?user_id=${s.uid}&page=${a.page}`,l="List";break;case 1:i=`/user-info/show-case?user_id=${s.uid}&page=${a.page}`,l="List";break;case 2:i=`/user-info/posts?user_id=${s.uid}&page=${a.page}`,l="comment_list"}const n=await e.index.request({url:`${t.websiteUrl}${i}`});if("success"===n.data.status){const e=n.data.data,t=e[l].map((e=>{var t,a,i;switch(o.value){case 0:return{id:e.id,cover:(null==(t=e.image_urls)?void 0:t.split(",")[0])||"",images:(null==(a=e.image_urls)?void 0:a.split(","))||[],title:e.title,time:e.created_at};case 1:return{id:e.id,cover:(null==(i=e.image_urls)?void 0:i.split(",")[0])||"",title:e.name,desc:e.description,time:e.created_at};case 2:return{id:e.id,product_thumb:e.target_image,product_name:e.target_name,content:e.comment,create_time:m(e.created_at)}}})),i=[c,r,d][o.value];i.value=[...i.value,...t],a.total=e.total,a.finished=i.value.length>=e.total,a.page++}}catch(i){console.log(i),e.index.showToast({title:"数据加载失败",icon:"none"})}finally{a.loading=!1}}},p=async()=>{try{const a=e.index.getStorageSync("token");if(!a)return void console.log("未登录");const o=n.value?"remove":"add",i=await e.index.request({url:`${t.websiteUrl}/with-state/blacklist/${o}?target_user_id=`+s.uid,method:"POST",header:{Authorization:a}});"success"===i.data.status?(n.value=!n.value,e.index.showToast({title:n.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(n.value||u.value)&&(c.value=[],r.value=[],d.value=[])):e.index.showToast({title:i.data.msg,icon:"none"})}catch(a){console.log("操作失败",a),e.index.showToast({title:"操作失败",icon:"none"})}},m=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`};return e.index.setNavigationBarTitle({title:"用户主页"}),e.onShow((()=>{(async()=>{try{const a=await e.index.request({url:`${t.websiteUrl}/user-info?uid=${s.uid}`});"success"===a.data.status&&(l.value=a.data.data)}catch(a){e.index.showToast({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const a=e.index.getStorageSync("token");if(a)try{const o=await e.index.request({url:`${t.websiteUrl}/with-state/blacklist/status`,method:"GET",data:{target_user_id:s.uid},header:{Authorization:a}});"success"===o.data.status&&(n.value=o.data.data.is_blocked,u.value=o.data.data.they_blocked)}catch(o){console.log("获取黑名单状态失败",o)}else console.log("未登录")})().then((()=>{n.value||u.value||g()}))})),e.onReachBottom((()=>{g()})),(t,a)=>e.e({a:l.value.avatar,b:e.t(l.value.user_name),c:e.p({type:(n.value,"minus"),size:"16",color:"#fff"}),d:e.t(n.value?"已拉黑":"拉黑"),e:n.value?1:"",f:e.o(p),g:!n.value&&!u.value},n.value||u.value?{}:e.e({h:e.f(i.value,((t,a,i)=>({a:e.t(t),b:a,c:o.value===a?1:"",d:e.o((e=>o.value=a),a)}))),i:0===o.value},0===o.value?{j:e.f(c.value,((a,o,i)=>({a:a.cover,b:e.t(a.title),c:o,d:e.o((e=>t.navigateTo(`/pages/collocation_share/collocation_share?collocation_id=${a.id}`)),o)})))}:{},{k:1===o.value},1===o.value?{l:e.f(r.value,((a,o,i)=>({a:a.cover,b:e.t(a.title),c:e.t(a.price),d:o,e:e.o((e=>t.navigateTo(`/pages/user_doll/user_doll?id=${a.id}`)),o)})))}:{},{m:2===o.value},2===o.value?{n:e.f(d.value,((t,a,o)=>({a:t.product_thumb,b:e.t(t.product_name),c:e.t(t.content),d:e.t(t.create_time),e:a})))}:{}),{o:n.value||u.value},n.value||u.value?{p:e.p({type:"minus",size:"48",color:"#ccc"})}:{})}},o=e._export_sfc(a,[["__scopeId","data-v-4fd40fbf"]]);wx.createPage(o);
