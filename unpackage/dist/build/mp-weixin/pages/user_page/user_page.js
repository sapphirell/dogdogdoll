"use strict";const e=require("../../common/vendor.js"),a=require("../../common/config.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const t={__name:"user_page",props:["uid"],setup(t){const i=e.ref(0),o=e.ref(["搭配","娃柜","点评"]),l=t,s=e.ref({avatar:"",user_name:"加载中..."}),n=e.ref(!1),u=e.ref(!1),r=e.ref([]),c=e.ref([]),d=e.ref([]),v=e.ref([{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1},{page:1,pageSize:10,total:0,loading:!1,finished:!1}]);e.watch(i,(e=>{v.value[e];0===[r,c,d][e].value.length&&g()}));const g=async()=>{if(n.value||u.value)return;const t=v.value[i.value];if(!t.loading&&!t.finished){t.loading=!0;try{let o,s;switch(i.value){case 0:o=`/user-info/collection?user_id=${l.uid}&page=${t.page}`,s="List";break;case 1:o=`/user-info/show-case?user_id=${l.uid}&page=${t.page}`,s="List";break;case 2:o=`/user-info/posts?user_id=${l.uid}&page=${t.page}`,s="comment_list"}const n=await e.index.request({url:`${a.websiteUrl}${o}`});if("success"===n.data.status){const e=n.data.data,a=e[s].map((e=>{var a,t,o;switch(i.value){case 0:return{id:e.id,cover:(null==(a=e.image_urls)?void 0:a.split(",")[0])||"",images:(null==(t=e.image_urls)?void 0:t.split(","))||[],title:e.title,time:e.created_at};case 1:return{id:e.id,cover:(null==(o=e.image_urls)?void 0:o.split(",")[0])||"",title:e.name,desc:e.description,time:e.created_at};case 2:return{id:e.id,product_thumb:e.target_image,product_name:e.target_name,content:e.comment,create_time:h(e.created_at)}}})),o=[r,c,d][i.value];o.value=[...o.value,...a],t.total=e.total,t.finished=o.value.length>=e.total,t.page++}}catch(o){console.log(o),e.index.showToast({title:"数据加载失败",icon:"none"})}finally{t.loading=!1}}},p=async()=>{try{const t=e.index.getStorageSync("token");if(!t)return void console.log("未登录");const i=n.value?"remove":"add",o=await e.index.request({url:`${a.websiteUrl}/with-state/blacklist/${i}?target_user_id=`+l.uid,method:"POST",header:{Authorization:t}});"success"===o.data.status?(n.value=!n.value,e.index.showToast({title:n.value?"已加入黑名单":"已移除黑名单",icon:"none"}),(n.value||u.value)&&(r.value=[],c.value=[],d.value=[])):e.index.showToast({title:o.data.msg,icon:"none"})}catch(t){console.log("操作失败",t),e.index.showToast({title:"操作失败",icon:"none"})}},h=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`};return e.index.setNavigationBarTitle({title:"用户主页"}),e.onShow((()=>{(async()=>{try{const t=await e.index.request({url:`${a.websiteUrl}/user-info?uid=${l.uid}`});"success"===t.data.status&&(s.value=t.data.data)}catch(t){e.index.showToast({title:"用户信息加载失败",icon:"none"})}})(),(async()=>{const t=e.index.getStorageSync("token");if(t)try{const i=await e.index.request({url:`${a.websiteUrl}/with-state/blacklist/status`,method:"GET",data:{target_user_id:l.uid},header:{Authorization:t}});"success"===i.data.status&&(n.value=i.data.data.is_blocked,u.value=i.data.data.they_blocked)}catch(i){console.log("获取黑名单状态失败",i)}else console.log("未登录")})().then((()=>{n.value||u.value||g()}))})),e.onReachBottom((()=>{g()})),(a,t)=>e.e({a:s.value.avatar,b:e.t(s.value.user_name),c:e.p({type:(n.value,"minus"),size:"16",color:"#fff"}),d:e.t(n.value?"已拉黑":"拉黑"),e:n.value?1:"",f:e.o(p),g:!n.value&&!u.value},n.value||u.value?{}:e.e({h:e.f(o.value,((a,t,o)=>({a:e.t(a),b:t,c:i.value===t?1:"",d:e.o((e=>i.value=t),t)}))),i:0===i.value},0===i.value?{j:e.f(r.value,((t,i,o)=>({a:t.cover,b:e.t(t.title),c:i,d:e.o((e=>a.navigateTo(`/pages/collocation_share/collocation_share?collocation_id=${t.id}`)),i)})))}:{},{k:1===i.value},1===i.value?{l:e.f(c.value,((t,i,o)=>({a:t.cover,b:e.t(t.title),c:e.t(t.price),d:i,e:e.o((e=>a.navigateTo(`/pages/user_doll/user_doll?id=${t.id}`)),i)})))}:{},{m:2===i.value},2===i.value?{n:e.f(d.value,((a,t,i)=>({a:a.product_thumb,b:e.t(a.product_name),c:e.t(a.content),d:e.t(a.create_time),e:t})))}:{}),{o:n.value||u.value},n.value||u.value?{p:e.p({type:"minus",size:"48",color:"#ccc"})}:{})}},i=e._export_sfc(t,[["__scopeId","data-v-5804dea1"]]);wx.createPage(i);
