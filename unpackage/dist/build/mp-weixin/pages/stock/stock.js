"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-transition")+e.resolveComponent("uni-icons")+e.resolveComponent("common-modal")+e.resolveComponent("common-page"))()}Math||((()=>"../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/common-modal/common-modal.js")+(()=>"../../components/common-page/common-page.js"))();const a={__name:"stock",setup(a){const n=e.index.getSystemInfoSync();e.ref(n.statusBarHeight);const s=e.ref(1),i=e.ref(1);function l(){return s.value>1?["fade","slide-left"]:["fade","slide-right"]}function c(e){const o=s.value;switch(i.value=o,s.value=e,console.log(`从 tab ${o} 切换到 tab ${e}，方向: ${l()}`),e){case 1:S();break;case 2:j();break;case 3:$()}}function r(e){let o=0,t=0;return e.forEach((e=>{const a=parseFloat(e.price)||0;o+=a,1===e.status&&(t+=a)})),`${t.toFixed(1)}/${o.toFixed(1)}`}const u=e.ref(0),d=e.ref(!1),m=e.ref(""),f=e.ref([]),v=["全部","娃头","娃衣","素体","眼珠","假发","娃鞋"],h=e.computed((()=>[...v,...f.value.map((e=>e.name))])),g=()=>{d.value=!0},p=async()=>{const o=e.index.getStorageSync("token");try{const a=await e.index.request({url:t.websiteUrl+"/with-state/account-types",method:"GET",header:{Authorization:o}});f.value=a.data.data||[]}catch(a){console.error("获取分类失败:",a)}},b=async()=>{if(!m.value.trim())return void e.index.showToast({title:"请输入分类名称",icon:"none"});const o=e.index.getStorageSync("token");try{await e.index.request({url:t.websiteUrl+"/with-state/add-account-type",method:"POST",header:{Authorization:o},data:{name:m.value.trim()}}),await p(),m.value="",e.index.showToast({title:"添加成功"})}catch(a){e.index.showToast({title:"添加失败",icon:"none"})}};function _(){switch(s.value){case 1:e.index.navigateTo({url:"/pages/stock/account_book_form/account_book_form"});break;case 2:e.index.navigateTo({url:"/pages/stock/showcase_form/showcase_form"});break;case 3:z(!1)}}const w=e.ref({}),y=e.ref({}),k=e.ref({}),x=e.computed((()=>w.value.account_books?w.value.account_books.reduce(((e,o)=>e+(parseFloat(o.price)||0)),0).toFixed(2):0));function T(e){u.value=e.detail.value;const o=h.value[u.value];S("全部"===o?"":o)}function S(o){if(console.log(t.global),!t.global.isLogin)return;let a=e.index.getStorageSync("token"),n=t.websiteUrl+"/with-state/account-book";o&&"全部"!==o&&(n=t.websiteUrl+"/with-state/account-book?type="+o),e.index.request({url:n,method:"GET",header:{Authorization:a},success:e=>{console.log(e.data.data),w.value=e.data.data},fail:e=>{console.log(e)}})}function j(){if(console.log(t.global),!t.global.isLogin)return;let o=e.index.getStorageSync("token");e.index.request({url:t.websiteUrl+"/with-state/showcase",method:"GET",header:{Authorization:o},success:e=>{console.log(e.data.data),y.value=e.data.data},fail:e=>{console.log(e)}})}function q(e){if(!e)return"";const o=e.split(",");if(1===o.length&&""!==o[0].trim())return o[0].trim();for(const t of o)if(""!==t.trim())return t.trim();return""}function $(){if(console.log(t.global),!t.global.isLogin)return;let o=e.index.getStorageSync("token");e.index.request({url:t.websiteUrl+"/with-state/tail-bill",method:"GET",header:{Authorization:o},success:e=>{console.log(e.data.data),k.value=e.data.data},fail:e=>{console.log(e)}})}function z(o){0!=o?e.index.navigateTo({url:"/pages/stock/bill_form/bill_form?bill_id="+o}):e.index.navigateTo({url:"/pages/stock/bill_form/bill_form"})}return e.onShow((()=>{t.asyncGetUserInfo().then((e=>{p(),S(),j(),$()}))})),(a,n)=>{var i,v;return e.e({a:e.o((e=>c(1))),b:1===s.value?1:"",c:e.o((e=>c(2))),d:2===s.value?1:"",e:e.o((e=>c(3))),f:3===s.value?1:"",g:e.t(h.value[u.value]),h:u.value,i:h.value,j:e.o(T),k:e.o(g),l:e.t(x.value),m:(null==(i=w.value.account_books)?void 0:i.length)>0},(null==(v=w.value.account_books)?void 0:v.length)>0?{n:e.f(w.value.account_books,((o,t,a)=>({a:q(o.image_url),b:e.t(o.type),c:e.t(o.price),d:e.t(o.name),e:t,f:e.o((t=>{return a=o.id,void e.index.navigateTo({url:"/pages/stock/account_book_form/account_book_form?account_book_id="+a});var a}),t)})))}:{o:o._imports_0$3},{p:e.p({name:l(),"mode-class":["fade","slide-left"],duration:300,show:1===s.value}),q:y.value.showcases&&y.value.showcases.length>0},y.value.showcases&&y.value.showcases.length>0?{r:e.f(y.value.showcases,((o,t,a)=>{return e.e({a:1!==o.display},1!==o.display?{b:e.t((n=o.display,{0:"审核中",2:"人工复核中",3:"违规隐藏中"}[n]||""))}:{},{c:o.image_url_list[0],d:e.t(o.name),e:e.t(o.description),f:e.t(o.views||0),g:e.t(o.likes||0),h:1!==o.display?1:"",i:t,j:e.o((t=>{return a=o.id,void e.index.navigateTo({url:"/pages/stock/showcase_form/showcase_form?showcase_id="+a});var a}),t)});var n})),s:o._imports_1$2,t:o._imports_2$1}:{v:o._imports_0$3},{w:e.p({name:l(),"mode-class":l(),duration:300,show:2===s.value}),x:Object.keys(k.value).length>0},Object.keys(k.value).length>0?{y:e.f(k.value,((o,t,a)=>({a:e.t(t),b:e.t(r(o)),c:e.f(o,((o,t,a)=>({a:e.t(o.name),b:e.t(o.price),c:e.t(o.ymd),d:e.t(0===o.status?"未补款":"已补款"),e:1===o.status?1:"",f:o.id,g:e.o((e=>z(o.id)),o.id)}))),d:t})))}:{z:o._imports_0$3},{A:e.p({name:l(),"mode-class":["fade","slide-bottom"],duration:300,show:3===s.value}),B:e.f(f.value,((o,a,n)=>({a:e.t(o.name),b:e.o((a=>(async o=>{e.index.showModal({title:"确认删除",success:async a=>{if(a.confirm){const a=e.index.getStorageSync("token");try{const n=(await e.index.request({url:t.websiteUrl+"/with-state/delete-account-type",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{id:o}})).data;"success"===n.status?(await p(),e.index.showToast({title:"删除成功"})):e.index.showToast({title:n.msg||"删除失败",icon:"none"})}catch(n){console.error("删除失败:",n),e.index.showToast({title:n.errMsg||"请求失败",icon:"none"})}}}})})(o.id)),o.id),c:"c1691f56-5-"+n+",c1691f56-4",d:o.id}))),C:e.p({type:"trash",size:"22",color:"#ff6666"}),D:m.value,E:e.o((e=>m.value=e.detail.value)),F:e.o(b),G:e.o((e=>d.value=e)),H:e.p({visible:d.value,top:"300rpx",height:"60%"}),I:e.p({type:"plusempty",size:"30",color:"#fff"}),J:e.o(_),K:e.p({head_color:"#d8deff"})})}}},n=e._export_sfc(a,[["__scopeId","data-v-c1691f56"]]);wx.createPage(n);
