"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),a=require("../../../common/config.js"),o=require("../../../common/image.js");if(!Array){e.resolveComponent("goods-search")()}Math;const n={__name:"account_book_form",props:["account_book_id"],setup(n){const s=n,i=!!s.account_book_id,c=e.index.getSystemInfoSync();e.ref(c.statusBarHeight);let u=e.ref(""),l=e.ref("");e.ref(1);const d=e.ref(0),r=e.ref(["请选择","娃衣","娃头","眼珠","假发","娃鞋","其它"]);e.ref({});const g=e.ref("");function m(e){d.value=e.detail.value}const h=async t=>{var o;try{const n=await e.index.request({url:a.websiteUrl+`/goods?id=${t.id}`,method:"GET"});if("success"===n.data.status){const e=n.data.data;u.value=e.name,l.value=e.fin_amount+e.sub_amount,(null==(o=e.goods_images)?void 0:o[0])&&(g.value=e.goods_images[0])}}catch(n){console.error("获取商品详情失败:",n),e.index.showToast({title:"获取商品信息失败",icon:"none"})}};function v(){e.index.showModal({title:"提示",content:"确定删除该账本吗？",success:t=>{t.confirm&&e.index.request({url:a.websiteUrl+"/with-state/delete-account-book?id="+parseInt(s.account_book_id,10),method:"POST",header:{Authorization:e.index.getStorageSync("token")},success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}})}function f(){o.chooseImage().then((t=>{o.getQiniuToken().then((n=>{console.log(n),o.uploadImageToQiniu(t,n.token,n.path).then((t=>{200!=t.statusCode&&e.index.showToast({title:"上传失败",icon:"none"}),console.log(a.image1Url+n.path),g.value=a.image1Url+n.path,e.index.showToast({title:"上传成功",icon:"success"})}))}))}))}function x(){i?function(){let t={name:u.value,price:parseInt(l.value,10),type:r.value[d.value],image_url:g.value,id:parseInt(s.account_book_id,10)};e.index.request({url:a.websiteUrl+"/with-state/update-account-book",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:t,success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}():function(){let t={name:u.value,price:parseInt(l.value,10),type:r.value[d.value],image_url:g.value};console.log(t),e.index.request({url:a.websiteUrl+"/with-state/add-account-book",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:t,success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}()}return a.asyncGetUserInfo().then((t=>{i?(!function(t){let o=e.index.getStorageSync("token");e.index.request({url:a.websiteUrl+"/with-state/account-book-detail",method:"GET",header:{Authorization:o},data:{id:t},success:e=>{console.log(e.data.data),u.value=e.data.data.name,l.value=e.data.data.price,d.value=r.value.indexOf(e.data.data.type),g.value=e.data.data.image_url},fail:e=>{console.log(e)}})}(s.account_book_id),e.index.setNavigationBarTitle({title:"编辑账本"})):e.index.setNavigationBarTitle({title:"新增账本"})})),(a,o)=>e.e({a:e.t(r.value[d.value]||"请选择分类"),b:d.value,c:r.value,d:e.o(m),e:e.o(h),f:e.o((t=>e.isRef(u)?u.value=t:u=t)),g:e.p({"font-size":"24rpx",mode:"fill",background:"#fff",width:"640rpx","show-icon":!1,modelValue:e.unref(u)}),h:e.unref(l),i:e.o((t=>e.isRef(l)?l.value=t.detail.value:l=t.detail.value)),j:g.value},g.value?{k:g.value}:{l:e.o(f)},{m:t._imports_0$4,n:e.unref(i)},e.unref(i)?{o:e.o(v)}:{},{p:e.t(e.unref(i)?"修改":"新增"),q:e.o(x)})}},s=e._export_sfc(n,[["__scopeId","data-v-aceb20e1"]]);wx.createPage(s);
