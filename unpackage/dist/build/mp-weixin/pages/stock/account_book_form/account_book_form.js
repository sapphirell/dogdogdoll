"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),a=require("../../../common/config.js"),o=require("../../../common/image.js"),n={__name:"account_book_form",props:["account_book_id"],setup(n){const s=n,i=!!s.account_book_id,u=e.index.getSystemInfoSync();e.ref(u.statusBarHeight);let c=e.ref(""),l=e.ref("");e.ref(1);const d=e.ref(0),r=e.ref(["请选择","娃衣","娃头","眼珠","假发","娃鞋","其它"]);e.ref({});const g=e.ref("");function v(e){d.value=e.detail.value}function h(){e.index.showModal({title:"提示",content:"确定删除该账本吗？",success:t=>{t.confirm&&e.index.request({url:a.websiteUrl+"/with-state/delete-account-book?id="+parseInt(s.account_book_id,10),method:"POST",header:{Authorization:e.index.getStorageSync("token")},success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}})}function m(){o.chooseImage().then((t=>{o.getQiniuToken().then((n=>{console.log(n),o.uploadImageToQiniu(t,n.token,n.path).then((t=>{200!=t.statusCode&&e.index.showToast({title:"上传失败",icon:"none"}),console.log(a.image1Url+n.path),g.value=a.image1Url+n.path,e.index.showToast({title:"上传成功",icon:"success"})}))}))}))}function f(){i?function(){let t={name:c.value,price:parseInt(l.value,10),type:r.value[d.value],image_url:g.value,id:parseInt(s.account_book_id,10)};e.index.request({url:a.websiteUrl+"/with-state/update-account-book",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:t,success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}():function(){let t={name:c.value,price:parseInt(l.value,10),type:r.value[d.value],image_url:g.value};console.log(t),e.index.request({url:a.websiteUrl+"/with-state/add-account-book",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:t,success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}()}return a.asyncGetUserInfo().then((t=>{i?(!function(t){let o=e.index.getStorageSync("token");e.index.request({url:a.websiteUrl+"/with-state/account-book-detail",method:"GET",header:{Authorization:o},data:{id:t},success:e=>{console.log(e.data.data),c.value=e.data.data.name,l.value=e.data.data.price,d.value=r.value.indexOf(e.data.data.type),g.value=e.data.data.image_url},fail:e=>{console.log(e)}})}(s.account_book_id),e.index.setNavigationBarTitle({title:"编辑账本"})):e.index.setNavigationBarTitle({title:"新增账本"})})),(a,o)=>e.e({a:e.t(r.value[d.value]||"请选择分类"),b:d.value,c:r.value,d:e.o(v),e:e.unref(c),f:e.o((t=>e.isRef(c)?c.value=t.detail.value:c=t.detail.value)),g:e.unref(l),h:e.o((t=>e.isRef(l)?l.value=t.detail.value:l=t.detail.value)),i:g.value},g.value?{j:g.value}:{k:e.o(m)},{l:t._imports_0$4,m:e.unref(i)},e.unref(i)?{n:e.o(h)}:{},{o:e.t(e.unref(i)?"修改":"新增"),p:e.o(f)})}},s=e._export_sfc(n,[["__scopeId","data-v-c0e3dca5"]]);wx.createPage(s);
