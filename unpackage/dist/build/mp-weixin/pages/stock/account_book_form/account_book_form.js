"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/config.js"),a=require("../../../common/image.js"),o={__name:"account_book_form",props:["account_book_id"],setup(o){const n=o,i=!!n.account_book_id,s=e.index.getSystemInfoSync();e.ref(s.statusBarHeight);let u=e.ref(""),l=e.ref("");e.ref(1);const c=e.ref(0),d=e.ref(["请选择","娃衣","娃头","眼珠","假发","娃鞋","其它"]);e.ref({});const r=e.ref("");function v(e){c.value=e.detail.value}function g(){a.chooseImage().then((o=>{a.getQiniuToken().then((n=>{console.log(n),a.uploadImageToQiniu(o,n.token,n.path).then((a=>{200!=a.statusCode&&e.index.showToast({title:"上传失败",icon:"none"}),console.log(t.image1Url+n.path),r.value=t.image1Url+n.path,e.index.showToast({title:"上传成功",icon:"success"})}))}))}))}function h(){i?function(){let a={name:u.value,price:parseInt(l.value,10),type:d.value[c.value],image_url:r.value,id:parseInt(n.account_book_id,10)};e.index.request({url:t.websiteUrl+"/with-state/update-account-book",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:a,success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}():function(){let a={name:u.value,price:parseInt(l.value,10),type:d.value[c.value],image_url:r.value};console.log(a),e.index.request({url:t.websiteUrl+"/with-state/add-account-book",method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:a,success:t=>{console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),500)):e.index.showToast({title:t.data.msg,icon:"none"})}})}()}return t.asyncGetUserInfo().then((a=>{i?(!function(a){let o=e.index.getStorageSync("token");e.index.request({url:t.websiteUrl+"/with-state/account-book-detail",method:"GET",header:{Authorization:o},data:{id:a},success:e=>{console.log(e.data.data),u.value=e.data.data.name,l.value=e.data.data.price,c.value=d.value.indexOf(e.data.data.type),r.value=e.data.data.image_url},fail:e=>{console.log(e)}})}(n.account_book_id),e.index.setNavigationBarTitle({title:"编辑账本"})):e.index.setNavigationBarTitle({title:"新增账本"})})),(t,a)=>e.e({a:e.t(d.value[c.value]),b:c.value,c:d.value,d:e.o(v),e:e.unref(u),f:e.o((t=>e.isRef(u)?u.value=t.detail.value:u=t.detail.value)),g:e.unref(l),h:e.o((t=>e.isRef(l)?l.value=t.detail.value:l=t.detail.value)),i:r.value},r.value?{j:r.value}:{},{k:e.o(g),l:e.o(h)})}};wx.createPage(o);
