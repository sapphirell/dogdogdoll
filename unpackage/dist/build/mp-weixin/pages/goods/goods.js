"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),o=require("../../common/config.js"),n={__name:"goods",props:["goods_id"],setup(n){const a=n,i=e.index.getSystemInfoSync(),s=e.ref(0);e.onShow((()=>{})),e.onHide((()=>{}));const l=e.computed((()=>{var e;let t=(null==(e=i.safeAreaInsets)?void 0:e.bottom)||10;s.value>0&&(t+=s.value);let o=`${t}px`;return console.log("footer:"+o),o}));let r=e.ref({}),d=e.ref({}),u=e.ref(1),c=e.ref(1),g=e.ref(""),f=e.ref(!1),_=e.ref(!1),m=e.ref({});const v=e.ref(400),h=e.ref([]);function p(e){console.log(e.detail.current),c.value=e.detail.current+1}function x(){e.index.request({url:o.websiteUrl+"/goods?id="+a.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),r.value=e.data.data},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}function w(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}function b(e){const t=new Date(1e3*e),o=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${o}-${n}-${a} ${i}:${s}`}function y(){e.index.request({url:o.websiteUrl+"/goods-comment?goods_id="+a.goods_id+"&page="+u.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),d.value.page_index=t.data.data.page_index,d.value.total=t.data.data.total,d.value.comment_list=d.value.comment_list?d.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(u.value+=1),0==t.data.data.comment_list.length&&u.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function S(){let t=e.index.getStorageSync("token");if(!o.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});if(""==g.value)return void e.index.showToast({title:"请输入评论内容",icon:"none"});let n={content:g.value,target_id:parseInt(a.goods_id),type:2};m.value.id&&(n.reply_id=m.value.id,n.reply_for=m.value.comment,n.reply_user_id=m.value.user_id),console.log(n),e.index.request({url:o.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:t},data:n,success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),g.value="",u.value=1,d.value={},void y()):void e.index.showToast({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function T(){let t=e.index.getStorageSync("token");""!=t&&e.index.request({url:o.websiteUrl+"/with-state/hasLike?id="+a.goods_id+"&type=1",method:"POST",header:{Authorization:t},success:t=>{console.log(t.data),"success"==t.data.status?t.data.data.id>0?f.value=!0:f.value=!1:e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function $(){e.index.navigateTo({url:"/pages/collocation/collocation?goods_id="+a.goods_id+"&brand_id="+r.value.brand_id+"&goods_name="+r.value.name+"&brand_name="+r.value.brand_name+"&type="+r.value.type})}function k(e){if(!e)return"";return e.split(",")[0].trim()}return e.index.showLoading({title:"加载中"}),x(),y(),e.index.request({url:o.websiteUrl+"/goods-collocation?goods_id="+a.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),_.value=e.data.data},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}}),o.asyncGetUserInfo().then((e=>{console.log(e),T()})),(n,i)=>e.e({a:e.unref(r).name},e.unref(r).name?e.e({b:!e.unref(f)},e.unref(f)?{d:t._imports_1$4}:{c:t._imports_0$5},{e:e.t(w(e.unref(r).goods_like_count)),f:e.o((t=>function(){let t=e.index.getStorageSync("token");if(!o.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let n={id:parseInt(a.goods_id),type:1},i=f.value?"/with-state/unlike":"/with-state/add-like";e.index.request({url:o.websiteUrl+i,method:"POST",header:{Authorization:t},data:n,success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"操作成功",icon:"success"}),f.value=!f.value,T(),void x()):void e.index.showToast({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}())),g:e.f(e.unref(r).goods_images,((t,o,n)=>({a:t,b:e.n("swiper-image-"+o),c:e.o((t=>{e.index.previewImage({current:r.value.goods_images.index,urls:r.value.goods_images})}),o),d:e.o((t=>function(t){console.log("图片加载完成",t);const o=e.index.createSelectorQuery();setTimeout((()=>{o.select(`.swiper-image-${t}`).boundingClientRect((e=>{try{if(!e)return void console.warn("未找到图片元素");console.log(e),h.value[t]=e.height;const o=h.value.filter((e=>e>0));if(0===o.length)return;v.value=Math.max(...o)}catch(o){console.error("高度计算异常:",o)}})).exec()}),20)}(o)),o),e:o}))),h:e.o(p),i:v.value+"px",j:e.t(e.unref(c)),k:e.t(e.unref(r).goods_images.length),l:e.t(e.unref(r).name),m:e.t(e.unref(r).type),n:e.unref(r).total_amount},e.unref(r).total_amount?{o:e.t(e.unref(r).total_amount+" "+e.unref(r).currency)}:e.unref(r).goods_sales&&e.unref(r).goods_sales.length>0?{q:e.t(e.unref(r).goods_sales[0].sub_amount+e.unref(r).goods_sales[0].fin_amount),r:e.t(e.unref(r).goods_sales[0].currency)}:{},{p:e.unref(r).goods_sales&&e.unref(r).goods_sales.length>0,s:e.t(e.unref(r).size),t:e.t(e.unref(r).size_detail),v:"单体"===e.unref(r).type||"整体"===e.unref(r).type||"单头"===e.unref(r).type},"单体"===e.unref(r).type||"整体"===e.unref(r).type||"单头"===e.unref(r).type?{w:e.t(e.unref(r).body_size)}:{},{x:e.t(e.unref(r).skin),y:null==e.unref(r).goods_sales},(e.unref(r).goods_sales,{}),{z:e.f(e.unref(r).goods_sales,((t,o,n)=>({a:e.t(b(t.sub_time)),b:e.t(t.sale_type),c:e.t(t.sub_amount+t.fin_amount),d:e.t(t.currency),e:t.id}))),A:e.t(e.unref(r).brand_name),B:e.o((t=>{return o=e.unref(r).brand_id,void e.index.navigateTo({url:"/pages/brand/brand?brand_id="+o});var o})),C:t._imports_2$2,D:e.unref(_)&&e.unref(_).collocation_relation_list.length>0},e.unref(_)&&e.unref(_).collocation_relation_list.length>0?{E:e.f(e.unref(_).collocation_relation_list,((t,o,n)=>({a:k(t.image_urls),b:t.collocation_id,c:e.o((o=>{return n=t.collocation_id,a=t.relation_origin,void e.index.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+n+"&origin="+a});var n,a}),t.collocation_id)})))}:{},{F:t._imports_3$2,G:e.o($),H:e.t(e.unref(d).total||0),I:e.unref(d).comment_list},e.unref(d).comment_list?{J:e.f(e.unref(d).comment_list,((t,o,n)=>({a:t.avatar,b:e.t(t.username),c:e.o((o=>{return n=t.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+n});var n}),t.id),d:e.t(t.comment),e:e.t(b(t.created_at)),f:e.t(t.floor),g:e.s(e.unref(m).id===t.id?{color:"#fd6669"}:{color:"#888"}),h:e.o((e=>function(e){m.value.id!=e.id?m.value=e:m.value={}}(t)),t.id),i:t.id}))),K:e.s({fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"}),L:e.o(y)}:{},{M:e.unref(m).id},e.unref(m).id?{N:e.t("@"+e.unref(m).username)}:{},{O:e.unref(g),P:e.o((t=>e.isRef(g)?g.value=t.detail.value:g=t.detail.value)),Q:e.o(S),R:l.value}):{})}},a=e._export_sfc(n,[["__scopeId","data-v-a3891232"]]);wx.createPage(a);
