"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("item-impression")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/item-impression/item-impression.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const n={__name:"goods",props:["goods_id"],setup(n){const i=n;e.index.getSystemInfoSync(),e.ref(!1),e.ref(!1),e.ref("");const s=e.ref(null),a=e.ref(null);e.ref(1);let r=e.ref({}),d=e.ref({}),l=e.ref(1),u=e.ref(!1),c=e.ref(!1);const g=e.ref(400),_=e.ref([]),f=({parent:e,target:o})=>{var t;console.log("parent",e),console.log("target",o);let n=e;null!=o&&(n=o),r.value.id!=n.id?(console.log("item",n),r.value=n,null==(t=a.value)||t.focusInput()):r.value={}},m=({content:o,replyInfo:n,origin:a})=>{let r=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",n);const d={content:o,origin:a,target_id:parseInt(i.goods_id),type:2,...n.id&&{reply_id:n.id,reply_for:n.comment,reply_user_id:n.user_id,parent_id:n.parent_id>0?n.parent_id:n.id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:r},data:d,success:o=>{var t,n;if("success"==o.data.status){const i=o.data.data;0===i.parent_id?null==(t=s.value)||t.addNewComment(i):null==(n=s.value)||n.addReplyComment(i),e.index.showToast({title:"评论成功",icon:"success"})}else e.index.showToast({title:o.data.msg,icon:"none"})},fail:o=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})};function p(e){console.log(e.detail.current),l.value=e.detail.current+1}function h(){e.index.request({url:t.websiteUrl+"/goods?id="+i.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),d.value=e.data.data},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}function v(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}function y(e){if(!e||e<=0)return"未知";const o=new Date(1e3*e);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}function x(){let o=e.index.getStorageSync("token");""!=o&&e.index.request({url:t.websiteUrl+"/with-state/hasLike?id="+i.goods_id+"&type=1",method:"POST",header:{Authorization:o},success:o=>{console.log(o.data),"success"==o.data.status?o.data.data.id>0?u.value=!0:u.value=!1:e.index.showToast({title:o.data.msg,icon:"none"})},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function b(){e.index.navigateTo({url:"/pages/collocation/collocation?goods_id="+i.goods_id+"&brand_id="+d.value.brand_id+"&goods_name="+d.value.name+"&brand_name="+d.value.brand_name+"&type="+d.value.type})}function w(e){if(!e)return"";return e.split(",")[0].trim()}return e.index.showLoading({title:"加载中"}),h(),e.index.request({url:t.websiteUrl+"/goods-collocation?goods_id="+i.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),c.value=e.data.data},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}}),t.asyncGetUserInfo().then((e=>{console.log(e),x()})),(n,S)=>e.e({a:e.unref(d).name},e.unref(d).name?e.e({b:e.p({type:e.unref(u)?"heart-filled":"heart",size:"28",color:"#ff4d4f"}),c:e.t(v(e.unref(d).goods_like_count)),d:e.o((o=>function(){let o=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let n={id:parseInt(i.goods_id),type:1},s=u.value?"/with-state/unlike":"/with-state/add-like";e.index.request({url:t.websiteUrl+s,method:"POST",header:{Authorization:o},data:n,success:o=>(console.log(o.data),"success"==o.data.status?(e.index.showToast({title:"操作成功",icon:"success"}),u.value=!u.value,x(),void h()):void e.index.showToast({title:o.data.msg,icon:"none"})),fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}())),e:e.f(e.unref(d).goods_images,((o,t,n)=>({a:o,b:e.n("swiper-image-"+t),c:e.o((o=>{e.index.previewImage({current:d.value.goods_images.index,urls:d.value.goods_images})}),t),d:e.o((o=>function(o){console.log("图片加载完成",o);const t=e.index.createSelectorQuery();setTimeout((()=>{t.select(`.swiper-image-${o}`).boundingClientRect((e=>{try{if(!e)return void console.warn("未找到图片元素");console.log(e),_.value[o]=e.height;const t=_.value.filter((e=>e>0));if(0===t.length)return;g.value=Math.max(...t)}catch(t){console.error("高度计算异常:",t)}})).exec()}),20)}(t)),t),e:t}))),f:e.o(p),g:g.value+"px",h:e.t(e.unref(l)),i:e.t(e.unref(d).goods_images.length),j:e.unref(d).goods_name_image,k:e.t(e.unref(d).type),l:e.unref(d).goods_price_image},e.unref(d).goods_price_image?{m:e.unref(d).goods_price_image}:e.unref(d).goods_sales&&e.unref(d).goods_sales.length>0?{o:e.t(e.unref(d).goods_sales[0].sub_amount+e.unref(d).goods_sales[0].fin_amount),p:e.t(e.unref(d).goods_sales[0].currency)}:{},{n:e.unref(d).goods_sales&&e.unref(d).goods_sales.length>0,q:e.t(e.unref(d).sub_time1>0?y(e.unref(d).sub_time1):"未知"),r:e.t(e.unref(d).size),s:e.t(e.unref(d).size_detail),t:"单体"===e.unref(d).type||"整体"===e.unref(d).type||"单头"===e.unref(d).type},"单体"===e.unref(d).type||"整体"===e.unref(d).type||"单头"===e.unref(d).type?{v:e.t(e.unref(d).body_size||"未知")}:{},{w:e.t(e.unref(d).skin),x:e.unref(d).goods_brand_name_image},e.unref(d).goods_brand_name_image?{y:e.o((o=>{return t=e.unref(d).brand_id,void e.index.navigateTo({url:"/pages/brand/brand?brand_id="+t});var t})),z:e.unref(d).goods_brand_name_image}:{},{A:e.t(e.unref(d).desc_content||"暂无备注信息"),B:e.unref(d).goods_sales&&e.unref(d).goods_sales.length>0},e.unref(d).goods_sales&&e.unref(d).goods_sales.length>0?{C:e.f(e.unref(d).goods_sales,((o,t,n)=>e.e({a:e.t(o.sale_type),b:e.t(o.sub_amount+o.fin_amount),c:e.t(o.currency),d:e.t(y(o.sub_time)),e:o.sub_time_end>0},(o.sub_time_end,{}),{f:o.sub_time_end>0},o.sub_time_end>0?{g:e.t(y(o.sub_time_end))}:{},{h:e.t(o.size),i:e.t(o.size_detail),j:o.id})))}:{},{D:e.p({target_id:i.goods_id,type:"2","goods-type":e.unref(d).type}),E:o._imports_2$3,F:e.o(b),G:e.f(e.unref(c).collocation_relation_list,((o,t,n)=>({a:w(o.image_urls),b:o.collocation_id,c:e.o((t=>{return n=o.collocation_id,i=o.relation_origin,void e.index.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+n+"&origin="+i});var n,i}),o.collocation_id)}))),H:o._imports_1$4,I:e.o(b),J:e.sr(s,"d89efcee-2",{k:"commentListRef"}),K:e.o(f),L:e.p({type:2,"relation-id":parseInt(i.goods_id)}),M:e.sr(a,"d89efcee-3",{k:"commentInputRef"}),N:e.o(m),O:e.o((o=>e.isRef(r)?r.value=o:r=o)),P:e.p({"reply-info":e.unref(r),"target-id":i.goods_id})}):{})}},i=e._export_sfc(n,[["__scopeId","data-v-d89efcee"]]);n.__runtimeHooks=2,wx.createPage(i);
