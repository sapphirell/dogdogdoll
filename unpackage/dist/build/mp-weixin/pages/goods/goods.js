"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),t=require("../../common/config.js"),n={__name:"goods",props:["goods_id"],setup(n){const a=n,i=e.index.getSystemInfoSync(),s=e.ref(0),l=e.ref(!1),r=e=>{console.log("键盘高度变化",e),s.value=e.height};e.onShow((()=>{console.log("注册键盘弹出事件"),e.index.onKeyboardHeightChange(r)})),e.onHide((()=>{var o,t;console.log("卸载键盘弹出事件"),null==(t=(o=e.index).offKeyboardHeightChange)||t.call(o,r)}));const d=e.computed((()=>{var e;let o=(null==(e=i.safeAreaInsets)?void 0:e.bottom)||10;s.value>0&&(o+=s.value);let t=`${o}px`;return console.log("footer:"+t),t}));let u=e.ref({}),c=e.ref({}),g=e.ref(1),f=e.ref(1),_=e.ref(""),m=e.ref(!1),v=e.ref(!1),h=e.ref({});const p=e.ref(400),x=e.ref([]);function w(){l.value=!0}function b(){l.value=!1}const y=()=>{l.value=!1,e.index.hideKeyboard()};function S(e){console.log(e.detail.current),f.value=e.detail.current+1}function T(){e.index.request({url:t.websiteUrl+"/goods?id="+a.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),u.value=e.data.data},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}function $(e){if(e<1e3)return e.toString();return`${Math.floor(e/1e3)}k+`}function k(e){const o=new Date(1e3*e),t=o.getFullYear(),n=(o.getMonth()+1).toString().padStart(2,"0"),a=o.getDate().toString().padStart(2,"0"),i=o.getHours().toString().padStart(2,"0"),s=o.getMinutes().toString().padStart(2,"0");return o.getSeconds().toString().padStart(2,"0"),`${t}-${n}-${a} ${i}:${s}`}function q(){e.index.request({url:t.websiteUrl+"/goods-comment?goods_id="+a.goods_id+"&page="+g.value,method:"GET",timeout:5e3,success:o=>{console.log(o.data.data),c.value.page_index=o.data.data.page_index,c.value.total=o.data.data.total,c.value.comment_list=c.value.comment_list?c.value.comment_list.concat(o.data.data.comment_list):o.data.data.comment_list,null!=o.data.data.comment_list&&(o.data.data.comment_list.length>0&&(g.value+=1),0==o.data.data.comment_list.length&&g.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function z(){let o=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});if(""==_.value)return void e.index.showToast({title:"请输入评论内容",icon:"none"});let n={content:_.value,target_id:parseInt(a.goods_id),type:2};h.value.id&&(n.reply_id=h.value.id,n.reply_for=h.value.comment,n.reply_user_id=h.value.user_id),console.log(n),e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:o},data:n,success:o=>(console.log(o.data),"success"==o.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),_.value="",g.value=1,c.value={},void q()):void e.index.showToast({title:o.data.msg,icon:"none"})),fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function I(){let o=e.index.getStorageSync("token");""!=o&&e.index.request({url:t.websiteUrl+"/with-state/hasLike?id="+a.goods_id+"&type=1",method:"POST",header:{Authorization:o},success:o=>{console.log(o.data),"success"==o.data.status?o.data.data.id>0?m.value=!0:m.value=!1:e.index.showToast({title:o.data.msg,icon:"none"})},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function U(){e.index.navigateTo({url:"/pages/collocation/collocation?goods_id="+a.goods_id+"&brand_id="+u.value.brand_id+"&goods_name="+u.value.name+"&brand_name="+u.value.brand_name+"&type="+u.value.type})}function L(e){if(!e)return"";return e.split(",")[0].trim()}return e.index.showLoading({title:"加载中"}),T(),q(),e.index.request({url:t.websiteUrl+"/goods-collocation?goods_id="+a.goods_id,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),v.value=e.data.data},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}}),t.asyncGetUserInfo().then((e=>{console.log(e),I()})),(n,i)=>e.e({a:e.unref(u).name},e.unref(u).name?e.e({b:!e.unref(m)},e.unref(m)?{d:o._imports_1$4}:{c:o._imports_0$4},{e:e.t($(e.unref(u).goods_like_count)),f:e.o((o=>function(){let o=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let n={id:parseInt(a.goods_id),type:1},i=m.value?"/with-state/unlike":"/with-state/add-like";e.index.request({url:t.websiteUrl+i,method:"POST",header:{Authorization:o},data:n,success:o=>(console.log(o.data),"success"==o.data.status?(e.index.showToast({title:"操作成功",icon:"success"}),m.value=!m.value,I(),void T()):void e.index.showToast({title:o.data.msg,icon:"none"})),fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}())),g:e.f(e.unref(u).goods_images,((o,t,n)=>({a:o,b:e.n("swiper-image-"+t),c:e.o((o=>{e.index.previewImage({current:u.value.goods_images.index,urls:u.value.goods_images})}),t),d:e.o((o=>function(o){console.log("图片加载完成",o);const t=e.index.createSelectorQuery();setTimeout((()=>{t.select(`.swiper-image-${o}`).boundingClientRect((e=>{try{if(!e)return void console.warn("未找到图片元素");console.log(e),x.value[o]=e.height;const t=x.value.filter((e=>e>0));if(0===t.length)return;p.value=Math.max(...t)}catch(t){console.error("高度计算异常:",t)}})).exec()}),20)}(t)),t),e:t}))),h:e.o(S),i:p.value+"px",j:e.t(e.unref(f)),k:e.t(e.unref(u).goods_images.length),l:e.t(e.unref(u).name),m:e.t(e.unref(u).type),n:e.unref(u).total_amount},e.unref(u).total_amount?{o:e.t(e.unref(u).total_amount+" "+e.unref(u).currency)}:e.unref(u).goods_sales&&e.unref(u).goods_sales.length>0?{q:e.t(e.unref(u).goods_sales[0].sub_amount+e.unref(u).goods_sales[0].fin_amount),r:e.t(e.unref(u).goods_sales[0].currency)}:{},{p:e.unref(u).goods_sales&&e.unref(u).goods_sales.length>0,s:e.t(e.unref(u).size),t:e.t(e.unref(u).size_detail),v:"单体"===e.unref(u).type||"整体"===e.unref(u).type||"单头"===e.unref(u).type},"单体"===e.unref(u).type||"整体"===e.unref(u).type||"单头"===e.unref(u).type?{w:e.t(e.unref(u).body_size||"未知")}:{},{x:e.t(e.unref(u).skin),y:null==e.unref(u).goods_sales},(e.unref(u).goods_sales,{}),{z:e.f(e.unref(u).goods_sales,((o,t,n)=>({a:e.t(k(o.sub_time)),b:e.t(o.sale_type),c:e.t(o.sub_amount+o.fin_amount),d:e.t(o.currency),e:o.id}))),A:e.t(e.unref(u).brand_name),B:e.o((o=>{return t=e.unref(u).brand_id,void e.index.navigateTo({url:"/pages/brand/brand?brand_id="+t});var t})),C:e.t(e.unref(u).desc_content),D:o._imports_2$2,E:e.unref(v)&&e.unref(v).collocation_relation_list.length>0},e.unref(v)&&e.unref(v).collocation_relation_list.length>0?{F:e.f(e.unref(v).collocation_relation_list,((o,t,n)=>({a:L(o.image_urls),b:o.collocation_id,c:e.o((t=>{return n=o.collocation_id,a=o.relation_origin,void e.index.navigateTo({url:"/pages/collocation_share/collocation_share?collocation_id="+n+"&origin="+a});var n,a}),o.collocation_id)})))}:{},{G:o._imports_3$2,H:e.o(U),I:e.t(e.unref(c).total||0),J:e.unref(c).comment_list},e.unref(c).comment_list?{K:e.f(e.unref(c).comment_list,((o,t,n)=>({a:o.avatar,b:e.t(o.username),c:e.o((t=>{return n=o.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+n});var n}),o.id),d:e.t(o.comment),e:e.t(k(o.created_at)),f:e.t(o.floor),g:e.s(e.unref(h).id===o.id?{color:"#fd6669"}:{color:"#888"}),h:e.o((e=>function(e){h.value.id!=e.id?h.value=e:h.value={}}(o)),o.id),i:o.id}))),L:e.s({fontSize:"12px",position:"absolute",bottom:"3px",right:"15px",fontWeight:"1000"}),M:e.o(q)}:{},{N:l.value,O:e.o(y),P:e.unref(h).id},e.unref(h).id?{Q:e.t("@"+e.unref(h).username)}:{},{R:e.o(w),S:e.o(w),T:e.o(b),U:e.unref(_),V:e.o((o=>e.isRef(_)?_.value=o.detail.value:_=o.detail.value)),W:e.o(z),X:d.value}):{})}},a=e._export_sfc(n,[["__scopeId","data-v-160574f6"]]);wx.createPage(a);
