"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("goods-search")+e.resolveComponent("uni-transition")+e.resolveComponent("index-brand")+e.resolveComponent("uni-icons")+e.resolveComponent("common-page"))()}Math||((()=>"../../components/goods-search/goods-search.js")+(()=>"../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../components/index-brand/index-brand.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/common-page/common-page.js"))();const l={__name:"index",setup(l){let n=e.ref([]),o=e.ref({}),s=e.ref("");const i=e.ref([{label:"中国娃社",value:1},{label:"个人作者",value:2},{label:"外国娃社",value:3}]),u=e.ref(1);e.ref(0),e.index.getSystemInfoSync(),e.ref(0);const d=e.ref(1),r=e.ref(10),c=e.ref(!0),v=e.ref(!1);let g=e.ref([]);const h=e.ref(1),f=e.ref(10),p=e.ref(!0),_=e.ref(!1);let m=e.ref([]);const w=e.ref(1),x=e.ref(10),b=e.ref(!0),y=e.ref(!1);let T=e.ref([]);const k=e.ref(1),z=e.ref(10),L=e.ref(!0),j=e.ref(!1),q=e.ref("news"),S=e=>{q.value=e};e.onPullDownRefresh((async()=>{try{await D(),e.index.stopPullDownRefresh()}catch(a){e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新失败",icon:"none"})}}));const D=async()=>{const e={brands:()=>{d.value=1,n.value=[],c.value=!0,$(!0)},news:()=>{h.value=1,g.value=[],p.value=!0,C(!0)},hot:()=>{w.value=1,m.value=[],b.value=!0,P(!0)},second:()=>{k.value=1,T.value=[],L.value=!0,I(!0)}};await e[q.value](),U()};const U=()=>{e.index.request({url:t.websiteUrl+"/articles",data:{page:1,page_size:10,status:1},success:e=>{"success"===e.data.status&&(o.value=e.data.data.list)},fail:e=>{console.error("获取Banner失败:",e),o.value={}}})};const C=async(a=!1)=>{a&&(h.value=1),p.value&&!_.value&&(_.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/sale-news",data:{page:h.value,pageSize:f.value},success:e=>{const a=e.data.data.news_list;0!==a.length?(g.value=[...g.value,...a],p.value=e.data.data.news_list.length===f.value,h.value++):p.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{_.value=!1,e.index.hideLoading()}}))};const P=async(a=!1)=>{a&&(w.value=1),b.value&&!y.value&&(y.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/hot-collocation",data:{page:w.value,pageSize:x.value},success:e=>{const a=e.data.data.collocation_relation_list;0!==a.length?(m.value=[...m.value,...a.map((e=>({...e})))],b.value=m.value.length<e.data.data.total,w.value++):b.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{y.value=!1,e.index.hideLoading()}}))};const $=async(a=!1)=>{if(a&&(d.value=1,n.value=[],c.value=!0,s.value=""),!c.value||v.value)return;v.value=!0,e.index.showLoading();const l={pageSize:r.value};s.value?l.cursor=s.value:u.value&&(l.searchType=u.value),e.index.request({url:t.websiteUrl+"/brands-info-list",data:l,success:a=>{if("success"!==a.data.status)return void e.index.showToast({title:"加载失败: "+a.data.message,icon:"none"});const t=a.data.data,l=t.data;console.log("newData:",l),s.value=t.next_cursor||"",0!==l.length?(n.value=[...n.value,...l],c.value=t.has_more):c.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{v.value=!1,e.index.hideLoading()}})},I=async(a=!1)=>{a&&(k.value=1),L.value&&!j.value&&(j.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/treehole-submissions",data:{page:k.value,pageSize:z.value},success:e=>{const a=e.data.data.submission_list.map((e=>({...e,images:e.images||[]})));0!==a.length?(T.value=[...T.value,...a],L.value=T.value.length<e.data.data.total,k.value++):L.value=!1},fail:a=>{e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{j.value=!1,e.index.hideLoading()}}))};function R(){t.global.isLogin?e.index.navigateTo({url:"/pages/treehole_publish/treehole_publish"}):e.index.showModal({title:"提示",content:"需要登录后才能发布树洞",success:a=>{a.confirm&&e.index.navigateTo({url:"/pages/login/login"})}})}const M=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`};return e.onLoad((()=>{t.getUserInfo(),$(),C(),P(),I(),U()})),e.onReachBottom((()=>{"brands"===q.value&&c.value?$():"news"===q.value&&p.value?C():"second"===q.value&&L.value&&I()})),(l,r)=>e.e({a:a._imports_7,b:e.p({width:"720rpx"}),c:e.f(e.unref(o),((a,t,l)=>({a:a.banner,b:e.o((t=>(a=>{e.index.navigateTo({url:`/pages/article_detail/article_detail?id=${a.id}`})})(a)),a.id),c:a.id}))),d:0===e.unref(o).length},0===e.unref(o).length?{e:a._imports_1}:{},{f:a._imports_2,g:"news"===q.value?1:"",h:e.o((e=>S("news"))),i:a._imports_3,j:"brands"===q.value?1:"",k:e.o((e=>S("brands"))),l:a._imports_4,m:"hot"===q.value?1:"",n:e.o((e=>S("hot"))),o:a._imports_5,p:"second"===q.value?1:"",q:e.o((e=>S("second"))),r:"news"===q.value},"news"===q.value?e.e({s:e.f(e.unref(g),((a,t,l)=>e.e({a:a.image_list.length>0},a.image_list.length>0?{b:e.f(a.image_list,((e,a,t)=>({a:e,b:a})))}:{},{c:e.t(a.title),d:e.t(a.content),e:e.t(a.brand_name),f:e.t(M(a.created_at)),g:a.id,h:e.o((t=>function(a){e.index.navigateTo({url:"/pages/sale_news/sale_news?id="+a.id+"&brand_id="+a.brand_id})}(a)),a.id)}))),t:_.value},(_.value,{}),{v:!p.value},(p.value,{})):{},{w:e.p({"mode-class":["fade"],show:"news"===q.value}),x:"brands"===q.value},"brands"===q.value?e.e({y:e.f(i.value,((a,t,l)=>({a:e.t(a.label),b:t,c:u.value===a.value?1:"",d:e.o((e=>{return t=a.value,u.value===t?u.value=null:u.value=t,d.value=1,c.value=!0,n.value=[],s.value="",void $();var t}),t)}))),z:1==u.value},(u.value,{}),{A:2==u.value},(u.value,{}),{B:3==u.value},(u.value,{}),{C:e.f(e.unref(n),((a,t,l)=>({a:"89eda4a3-4-"+l+",89eda4a3-3",b:e.p({brand:a}),c:a.id}))),D:v.value},(v.value,{}),{E:!c.value},(c.value,{})):{},{F:e.p({"mode-class":["fade"],show:"brands"===q.value}),G:"hot"===q.value},"hot"===q.value?e.e({H:e.f(e.unref(m),((a,t,l)=>e.e({a:a.image_urls.length>0},a.image_urls.length>0?{b:e.f(a.image_urls,((e,a,t)=>({a:e,b:a})))}:{},{c:e.t(a.title),d:e.t(a.content),e:e.f(a.relation_list,((a,t,l)=>({a:e.t(a.relation_goods_name),b:e.t(a.relation_brand_name),c:t}))),f:a.avatar,g:e.t(1==a.origin?"搭配":"展示柜"),h:e.t(M(a.created_at)),i:"89eda4a3-6-"+l+",89eda4a3-5",j:e.t(a.like_count),k:a.collocation_id,l:e.o((t=>function(a){e.index.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${a.collocation_id}&origin=${a.origin}`})}(a)),a.collocation_id)}))),I:e.p({type:"heart",size:"18",color:"#ff4d4f"}),J:y.value},(y.value,{}),{K:!b.value},(b.value,{})):{},{L:e.p({"mode-class":["fade"],show:"hot"===q.value}),M:"second"===q.value},"second"===q.value?e.e({N:e.p({type:"plusempty",size:"30",color:"#fff"}),O:e.o(R),P:e.f(e.unref(T),((l,n,o)=>e.e({a:""!==l.avatar},""!==l.avatar?{b:l.avatar}:{c:a._imports_6},{d:e.t(l.is_anonymous?"匿名用户":l.author_name),e:e.t(M(l.created_at)),f:e.t(l.id),g:e.o((a=>function(a){1!=a.is_anonymous&&e.index.navigateTo({url:"/pages/user_page/user_page?uid="+a.uid})}(l)),l.id),h:e.t(l.content),i:l.images.length>0},l.images.length>0?{j:e.f(l.images,((a,t,n)=>({a:a,b:e.o((a=>{return n=l.images,o=t,void e.index.previewImage({current:o,urls:n});var n,o}),t),c:t})))}:{},{k:"89eda4a3-9-"+o+",89eda4a3-7",l:e.p({type:l.has_liked?"hand-up-filled":"hand-up",size:"18",color:l.has_liked?"#ff4d4f":"#666"}),m:e.t(l.like_count||0),n:e.o((a=>function(a){if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let l=e.index.getStorageSync("token");l?e.index.request({url:t.websiteUrl+(a.has_liked?"/with-state/unlike":"/with-state/add-like"),method:"POST",header:{Authorization:l},data:{id:a.id,type:5},success:t=>{"success"===t.data.status?(a.has_liked=!a.has_liked,a.like_count+=a.has_liked?1:-1):e.index.showD}}):e.index.showToast({title:"请先登录",icon:"none"})}(l)),l.id),o:"89eda4a3-10-"+o+",89eda4a3-7",p:e.t(l.comment_count||0),q:"89eda4a3-11-"+o+",89eda4a3-7",r:e.o((a=>function(a){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+a.id;e.index.setClipboardData({data:t,success:function(){e.index.showToast({title:"复制链接成功",icon:"none"})}})}(l)),l.id),s:l.id,t:e.o((a=>function(a){e.index.navigateTo({url:"/pages/treehole_detail/treehole_detail?id="+a.id})}(l)),l.id)}))),Q:e.p({type:"chat",size:"18",color:"#666"}),R:e.p({type:"redo",size:"18",color:"#666"}),S:j.value},(j.value,{}),{T:!L.value},(L.value,{})):{},{U:e.p({"mode-class":["fade"],show:"second"===q.value}),V:e.p({head_color:"rgb(255 230 215) "})})}},n=e._export_sfc(l,[["__scopeId","data-v-89eda4a3"]]);l.__runtimeHooks=2,wx.createPage(n);
