"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("privacy-permission-modal")+e.resolveComponent("version-check")+e.resolveComponent("loading-toast")+e.resolveComponent("switch-search")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-transition")+e.resolveComponent("common-search")+e.resolveComponent("index-brand"))()}Math||((()=>"../../components/view-logs/view-logs.js")+(()=>"../../components/privacy-permission-modal/privacy-permission-modal.js")+(()=>"../../components/version-check/version-check.js")+(()=>"../../components/loading-toast/loading-toast.js")+(()=>"../../components/switch-search/switch-search.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../components/common-search/common-search.js")+(()=>"../../components/index-brand/index-brand.js"))();const t={__name:"index",setup(t){e.useCssVars((e=>({"5b6a5054":U.value})));let l=e.ref([]),n=e.ref({}),s=e.ref(""),i=e.ref(!1);const u=e.ref([{label:"中国娃社",value:1},{label:"个人作者",value:2},{label:"外国娃社",value:3}]),d=e.ref(1);e.ref(0);const r=e.index.getSystemInfoSync();e.ref(0);const c=e.ref(1),v=e.ref(10),g=e.ref(!0),m=e.ref(!1);let f=e.ref([]);const p=e.ref(1),h=e.ref(10),_=e.ref(!0),b=e.ref(!1);let w=e.ref([]);const x=e.ref(1),y=e.ref(10),C=e.ref(!0),k=e.ref(!1);let T=e.ref([]);const L=e.ref(1),j=e.ref(10),z=e.ref(!0),S=e.ref(!1),q=e.ref("news"),D=e=>{q.value=e},$=e.computed((()=>{const a=e.index.getMenuButtonBoundingClientRect(),o=r.statusBarHeight||32;return a.bottom+a.top-2*o})),U=e.computed((()=>$.value+"px"));e.onPullDownRefresh((async()=>{try{await B(),e.index.stopPullDownRefresh()}catch(a){e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新失败",icon:"none"})}}));const B=async()=>{i.value=!0,setTimeout((async()=>{const e={brands:()=>{c.value=1,l.value=[],g.value=!0,I(!0)},news:()=>{p.value=1,f.value=[],_.value=!0,P(!0)},hot:()=>{x.value=1,w.value=[],C.value=!0,R(!0)},second:()=>{L.value=1,T.value=[],z.value=!0,M(!0)}};await e[q.value]()}),800)};const P=async(a=!1)=>{a&&(p.value=1),_.value&&!b.value&&(b.value=!0,i.value=!0,e.index.request({url:o.websiteUrl+"/sale-news",data:{page:p.value,pageSize:h.value},success:e=>{const a=e.data.data.news_list.map((e=>({...e,imagesLoaded:!1,loadCount:0})));0!==a.length?(f.value=[...f.value,...a],_.value=e.data.data.news_list.length===h.value,p.value++):_.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{b.value=!1,i.value=!1}}))};const R=async(a=!1)=>{a&&(x.value=1),C.value&&!k.value&&(k.value=!0,i.value=!0,e.index.request({url:o.websiteUrl+"/hot-collocation",data:{page:x.value,pageSize:y.value},success:e=>{const a=e.data.data.collocation_relation_list;0!==a.length?(w.value=[...w.value,...a.map((e=>({...e})))],C.value=w.value.length<e.data.data.total,x.value++):C.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{k.value=!1,i.value=!1}}))};const I=async(a=!1)=>{if(a&&(c.value=1,l.value=[],g.value=!0,s.value=""),!g.value||m.value)return;m.value=!0,i.value=!0;const t={pageSize:v.value};s.value?t.cursor=s.value:d.value&&(t.searchType=d.value),e.index.request({url:o.websiteUrl+"/brands-info-list",data:t,success:a=>{if("success"!==a.data.status)return void e.index.showToast({title:"加载失败: "+a.data.message,icon:"none"});const o=a.data.data,t=o.data;console.log("newData:",t),s.value=o.next_cursor||"",0!==t.length?(l.value=[...l.value,...t],g.value=o.has_more):g.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{m.value=!1,i.value=!1}})},M=async(a=!1)=>{a&&(L.value=1),z.value&&!S.value&&(S.value=!0,i.value=!0,e.index.request({url:o.websiteUrl+"/treehole-submissions",data:{page:L.value,pageSize:j.value},success:e=>{const a=e.data.data.submission_list.map((e=>({...e,images:e.images||[],imagesLoaded:!1,loadCount:0})));0!==a.length?(T.value=[...T.value,...a],z.value=T.value.length<e.data.data.total,L.value++):z.value=!1},fail:a=>{e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{S.value=!1,i.value=!1}}))};function V(){o.global.isLogin?e.index.navigateTo({url:"/pages/treehole_publish/treehole_publish"}):e.index.showModal({title:"提示",content:"需要登录后才能发布树洞",success:a=>{a.confirm&&e.index.navigateTo({url:"/pages/login/login"})}})}const A=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`};return e.onLoad((()=>{o.getUserInfo(),I(),P(),R(),M(),e.index.request({url:o.websiteUrl+"/articles",data:{page:1,page_size:10,status:1},success:e=>{"success"===e.data.status&&(n.value=e.data.data.list)},fail:e=>{console.error("获取Banner失败:",e),n.value={}}})})),e.onReachBottom((()=>{"brands"===q.value&&g.value?I():"news"===q.value&&_.value?P():"second"===q.value&&z.value&&M()})),(t,r)=>e.e({a:e.s(t.__cssVars()),b:e.s(t.__cssVars()),c:e.p({"show-up-to-date-toast":!0}),d:e.p({show:e.unref(i)}),e:a._imports_0,f:e.o(t.handleSearchSelect),g:e.p({mode:"jump",width:"95%",background:"#f8f8f8"}),h:a._imports_1,i:"news"===q.value?1:"",j:e.o((e=>D("news"))),k:a._imports_2,l:"brands"===q.value?1:"",m:e.o((e=>D("brands"))),n:a._imports_3,o:"hot"===q.value?1:"",p:e.o((e=>D("hot"))),q:a._imports_0$1,r:"second"===q.value?1:"",s:e.o((e=>D("second"))),t:"news"===q.value},"news"===q.value?e.e({v:e.f(e.unref(n),((a,o,t)=>({a:a.banner,b:e.o((o=>(a=>{e.index.navigateTo({url:`/pages/article_detail/article_detail?id=${a.id}`})})(a)),a.id),c:a.id}))),w:0===e.unref(n).length},0===e.unref(n).length?{x:a._imports_5}:{},{y:e.f(e.unref(f),((a,o,t)=>e.e({a:a.image_list.length>0},a.image_list.length>0?{b:e.f(a.image_list,((o,l,n)=>e.e({a:o,b:e.o((e=>(e=>{e.loadCount++,e.loadCount>=e.image_list.length&&(e.imagesLoaded=!0)})(a)),l),c:e.o((e=>((e,a)=>{console.error(`新闻图片加载失败: ${e.image_list[a]}`),e.loadCount||(e.loadCount=0),e.loadCount++,e.loadCount>=e.image_list.length&&(e.imagesLoaded=!0)})(a,l)),l)},a.imagesLoaded?{}:{d:"8b8fa7db-7-"+t+"-"+n+",8b8fa7db-6",e:e.p({type:"loop",size:"28",color:"rgb(185 185 185)"})},{f:l}))),c:a.imagesLoaded?1:"",d:!a.imagesLoaded,e:a.imagesLoaded}:{},{f:e.t(a.title),g:e.t(a.content),h:e.t(a.brand_name),i:e.t(A(a.created_at)),j:a.id,k:e.o((o=>function(a){e.index.navigateTo({url:"/pages/sale_news/sale_news?id="+a.id+"&brand_id="+a.brand_id})}(a)),a.id)}))),z:b.value},(b.value,{}),{A:!_.value},(_.value,{})):{},{B:e.p({"mode-class":["fade"],show:"news"===q.value}),C:e.p({width:"720rpx"}),D:e.f(u.value,((a,o,t)=>({a:e.t(a.label),b:o,c:d.value===a.value?1:"",d:e.o((e=>{return o=a.value,d.value===o?d.value=null:d.value=o,c.value=1,g.value=!0,l.value=[],s.value="",void I();var o}),o)}))),E:1==d.value},(d.value,{}),{F:2==d.value},(d.value,{}),{G:3==d.value},(d.value,{}),{H:"brands"===q.value},"brands"===q.value?e.e({I:e.f(e.unref(l),((a,o,t)=>({a:"8b8fa7db-10-"+t+",8b8fa7db-8",b:e.p({brand:a}),c:a.id}))),J:m.value},(m.value,{}),{K:!g.value},(g.value,{})):{},{L:e.p({"mode-class":["fade"],show:"brands"===q.value}),M:"hot"===q.value},"hot"===q.value?e.e({N:e.f(e.unref(w),((a,o,t)=>e.e({a:a.image_urls.length>0},a.image_urls.length>0?{b:e.f(a.image_urls,((o,t,l)=>({a:o,b:e.o((e=>(e=>{console.log("搭配图片加载完成",e),e.loadCount||(e.loadCount=0),e.loadCount++,console.log(e.id,"加载进度:",e.loadCount,"/",e.image_urls.length),setTimeout((()=>{e.imagesLoaded=!0}),300)})(a)),t),c:t}))),c:a.imagesLoaded?1:""}:{},{d:e.t(a.title),e:e.t(a.content),f:e.f(a.relation_list,((a,o,t)=>({a:e.t(a.relation_goods_name),b:e.t(a.relation_brand_name),c:o}))),g:a.avatar,h:e.t(1==a.origin?"搭配":"展示柜"),i:e.t(A(a.created_at)),j:"8b8fa7db-12-"+t+",8b8fa7db-11",k:e.t(a.like_count),l:a.collocation_id,m:e.o((o=>function(a){e.index.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${a.collocation_id}&origin=${a.origin}`})}(a)),a.collocation_id)}))),O:e.p({type:"heart",size:"18",color:"#ff4d4f"}),P:k.value},(k.value,{}),{Q:!C.value},(C.value,{})):{},{R:e.p({"mode-class":["fade"],show:"hot"===q.value}),S:"second"===q.value},"second"===q.value?e.e({T:e.p({type:"plusempty",size:"30",color:"#fff"}),U:e.o(V),V:e.f(e.unref(T),((t,l,n)=>e.e({a:""!==t.avatar},""!==t.avatar?{b:t.avatar}:{c:a._imports_6},{d:e.t(t.is_anonymous?"匿名用户":t.author_name),e:e.t(A(t.created_at)),f:e.t(t.id),g:e.o((a=>function(a){1!=a.is_anonymous&&e.index.navigateTo({url:"/pages/user_page/user_page?uid="+a.uid})}(t)),t.id),h:e.t(t.content),i:t.images.length>0},t.images.length>0?{j:e.f(t.images,((a,o,l)=>e.e({a:a,b:e.o((a=>{return l=t.images,n=o,void e.index.previewImage({current:n,urls:l});var l,n}),o),c:e.o((e=>(e=>{e.loadCount++,e.loadCount>=e.images.length&&(e.imagesLoaded=!0)})(t)),o),d:e.o((e=>((e,a)=>{console.error(`图片加载失败: ${e.images[a]}`),e.loadCount++,e.loadCount>=e.images.length&&(e.imagesLoaded=!0)})(t,o)),o)},t.imagesLoaded?{}:{e:"8b8fa7db-15-"+n+"-"+l+",8b8fa7db-13",f:e.p({type:"spinner-cycle",size:"28",color:"#4cbbd0"})},{g:o}))),k:t.imagesLoaded?1:"",l:!t.imagesLoaded,m:t.imagesLoaded,n:t.images.length>1}:{},{o:"8b8fa7db-16-"+n+",8b8fa7db-13",p:e.p({type:t.has_liked?"hand-up-filled":"hand-up",size:"18",color:t.has_liked?"#ff4d4f":"#666"}),q:e.t(t.like_count||0),r:e.o((a=>function(a){if(!o.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let t=e.index.getStorageSync("token");t?e.index.request({url:o.websiteUrl+(a.has_liked?"/with-state/unlike":"/with-state/add-like"),method:"POST",header:{Authorization:t},data:{id:a.id,type:5},success:o=>{"success"===o.data.status?(a.has_liked=!a.has_liked,a.like_count+=a.has_liked?1:-1):e.index.showD}}):e.index.showToast({title:"请先登录",icon:"none"})}(t)),t.id),s:"8b8fa7db-17-"+n+",8b8fa7db-13",t:e.t(t.comment_count||0),v:"8b8fa7db-18-"+n+",8b8fa7db-13",w:e.o((a=>function(a){let o="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+a.id;e.index.setClipboardData({data:o,success:function(){e.index.showToast({title:"复制链接成功",icon:"none"})}})}(t)),t.id),x:t.id,y:e.o((a=>function(a){e.index.navigateTo({url:"/pages/treehole_detail/treehole_detail?id="+a.id})}(t)),t.id)}))),W:e.p({type:"chat",size:"18",color:"#666"}),X:e.p({type:"redo",size:"18",color:"#666"}),Y:S.value},(S.value,{}),{Z:!z.value},(z.value,{})):{},{aa:e.p({"mode-class":["fade"],show:"second"===q.value}),ab:e.s(t.__cssVars())})}},l=e._export_sfc(t,[["__scopeId","data-v-8b8fa7db"]]);t.__runtimeHooks=2,wx.createPage(l);
