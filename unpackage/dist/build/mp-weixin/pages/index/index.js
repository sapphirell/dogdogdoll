"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("common-search")+e.resolveComponent("transition")+e.resolveComponent("index-brand")+e.resolveComponent("uni-icons")+e.resolveComponent("common-page"))()}Math||((()=>"../../components/common-search/common-search.js")+(()=>"../../components/index-brand/index-brand.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/common-page/common-page.js"))();const o={__name:"index",setup(o){let n=e.ref([]),l=e.ref(["https://images1.fantuanpu.com/spd/log/2025_04_21/234a245d0f8963b1b9b022efe3653cfb.jpg","https://images1.fantuanpu.com/box/100024/16524d8c1583feacbeebc37d37ee02a4","https://images1.fantuanpu.com/spd/log/2025_04_21/d34dfe99334e9f5a82a9f63708fcfefe.jpg","https://images1.fantuanpu.com/box/100024/16524d8c1583feacbeebc37d37ee02a4"]);const i=e.ref([{label:"中国娃社",value:1},{label:"个人作者",value:2},{label:"外国娃社",value:3}]),s=e.ref(1);e.ref(0),e.index.getSystemInfoSync(),e.ref(0);const u=e.ref(1),d=e.ref(10),r=e.ref(!0),c=e.ref(!1);let v=e.ref([]);const g=e.ref(1),f=e.ref(10),m=e.ref(!0),p=e.ref(!1);let h=e.ref([]);const _=e.ref(1),b=e.ref(10),x=e.ref(!0),w=e.ref(!1);let k=e.ref([]);const T=e.ref(1),y=e.ref(10),j=e.ref(!0),L=e.ref(!1),z=e.ref("news"),q=e=>{z.value=e};function S(e){this.swiperIndex.value=e.detail.current}function C(){m.value&&!p.value&&(p.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/sale-news",data:{page:g.value,pageSize:f.value},success:e=>{const a=e.data.data.news_list;0!==a.length?(v.value=[...v.value,...a],m.value=v.value.length<e.data.data.total,g.value++):m.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{p.value=!1,e.index.hideLoading()}}))}function U(){r.value&&!c.value&&(c.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/brands",data:{page:u.value,pageSize:d.value,...s.value&&{searchType:s.value}},success:e=>{const a=e.data.data.brands_list;0!==a.length?(n.value=[...n.value,...a],r.value=n.value.length<e.data.data.total,u.value++):r.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{c.value=!1,e.index.hideLoading()}}))}function I(){j.value&&!L.value&&(L.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/treehole-submissions",data:{page:T.value,pageSize:y.value},success:e=>{const a=e.data.data.submission_list.map((e=>({...e,images:e.images||[]})));0!==a.length?(k.value=[...k.value,...a],j.value=k.value.length<e.data.data.total,T.value++):j.value=!1},fail:a=>{e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{L.value=!1,e.index.hideLoading()}}))}function D(){t.global.isLogin?e.index.navigateTo({url:"/pages/treehole_publish/treehole_publish"}):e.index.showModal({title:"提示",content:"需要登录后才能发布树洞",success:a=>{a.confirm&&e.index.navigateTo({url:"/pages/login/login"})}})}const $=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`};return e.onLoad((()=>{t.getUserInfo(),U(),C(),x.value&&!w.value&&(w.value=!0,e.index.showLoading(),e.index.request({url:t.websiteUrl+"/hot-collocation",data:{page:_.value,pageSize:b.value},success:e=>{const a=e.data.data.collocation_relation_list;0!==a.length?(h.value=[...h.value,...a.map((e=>({...e})))],x.value=h.value.length<e.data.data.total,_.value++):x.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{w.value=!1,e.index.hideLoading()}})),I()})),e.onReachBottom((()=>{"brands"===z.value?U():"news"===z.value?C():"second"===z.value&&I()})),(o,d)=>e.e({a:a._imports_7,b:e.p({width:"680rpx"}),c:e.f(e.unref(l),((e,a,t)=>({a:e,b:e}))),d:e.o(S),e:a._imports_1,f:"news"===z.value?1:"",g:e.o((e=>q("news"))),h:a._imports_2,i:"brands"===z.value?1:"",j:e.o((e=>q("brands"))),k:a._imports_3,l:"hot"===z.value?1:"",m:e.o((e=>q("hot"))),n:a._imports_4,o:"second"===z.value?1:"",p:e.o((e=>q("second"))),q:"news"===z.value},"news"===z.value?e.e({r:e.f(e.unref(v),((a,t,o)=>e.e({a:a.image_list.length>0},a.image_list.length>0?{b:e.f(a.image_list,((e,a,t)=>({a:e,b:a})))}:{},{c:e.t(a.title),d:e.t(a.content),e:e.t(a.brand_name),f:e.t($(a.created_at)),g:a.id,h:e.o((t=>function(a){e.index.navigateTo({url:"/pages/sale_news/sale_news?id="+a.id+"&brand_id="+a.brand_id})}(a)),a.id)}))),s:p.value},(p.value,{}),{t:!m.value},(m.value,{})):{},{v:e.p({name:"fade",mode:"out-in"}),w:"brands"===z.value},"brands"===z.value?e.e({x:e.f(i.value,((a,t,o)=>({a:e.t(a.label),b:t,c:s.value===a.value?1:"",d:e.o((e=>{return t=a.value,s.value===t?s.value=null:s.value=t,u.value=1,r.value=!0,n.value=[],void U();var t}),t)}))),y:1==s.value},(s.value,{}),{z:2==s.value},(s.value,{}),{A:3==s.value},(s.value,{}),{B:e.f(e.unref(n),((a,t,o)=>({a:"bab764da-4-"+o+",bab764da-3",b:e.p({brand:a}),c:a.id}))),C:c.value},(c.value,{}),{D:!r.value},(r.value,{})):{},{E:e.p({name:"fade",mode:"out-in"}),F:"hot"===z.value},"hot"===z.value?e.e({G:e.f(e.unref(h),((a,t,o)=>e.e({a:a.image_urls.length>0},a.image_urls.length>0?{b:e.f(a.image_urls,((e,a,t)=>({a:e,b:a})))}:{},{c:e.t(a.title),d:e.t(a.content),e:e.f(a.relation_list,((a,t,o)=>({a:e.t(a.relation_goods_name),b:e.t(a.relation_brand_name),c:t}))),f:a.avatar,g:e.t(1==a.origin?"搭配":"展示柜"),h:e.t($(a.created_at)),i:"bab764da-6-"+o+",bab764da-5",j:e.t(a.like_count),k:a.collocation_id,l:e.o((t=>function(a){e.index.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${a.collocation_id}&origin=${a.origin}`})}(a)),a.collocation_id)}))),H:e.p({type:"heart",size:"18",color:"#ff4d4f"}),I:w.value},(w.value,{}),{J:!x.value},(x.value,{})):{},{K:e.p({name:"fade",mode:"out-in"}),L:"second"===z.value},"second"===z.value?e.e({M:e.p({type:"plusempty",size:"30",color:"#fff"}),N:e.o(D),O:e.f(e.unref(k),((o,n,l)=>e.e({a:""!==o.avatar},""!==o.avatar?{b:o.avatar}:{c:a._imports_5},{d:e.t(o.is_anonymous?"匿名用户":o.author_name),e:e.t($(o.created_at)),f:e.t(o.id),g:e.o((a=>function(a){1!=a.is_anonymous&&e.index.navigateTo({url:"/pages/user_page/user_page?uid="+a.uid})}(o)),o.id),h:e.t(o.content),i:o.images.length>0},o.images.length>0?{j:e.f(o.images,((a,t,n)=>({a:a,b:e.o((a=>{return n=o.images,l=t,void e.index.previewImage({current:l,urls:n});var n,l}),t),c:t})))}:{},{k:"bab764da-9-"+l+",bab764da-7",l:e.p({type:o.has_liked?"hand-up-filled":"hand-up",size:"18",color:o.has_liked?"#ff4d4f":"#666"}),m:e.t(o.like_count||0),n:e.o((a=>function(a){if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let o=e.index.getStorageSync("token");o?e.index.request({url:t.websiteUrl+(a.has_liked?"/with-state/unlike":"/with-state/add-like"),method:"POST",header:{Authorization:o},data:{id:a.id,type:5},success:t=>{"success"===t.data.status?(a.has_liked=!a.has_liked,a.like_count+=a.has_liked?1:-1):e.index.showD}}):e.index.showToast({title:"请先登录",icon:"none"})}(o)),o.id),o:"bab764da-10-"+l+",bab764da-7",p:e.t(o.comment_count||0),q:"bab764da-11-"+l+",bab764da-7",r:e.o((a=>function(a){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+a.id;e.index.setClipboardData({data:t,success:function(){e.index.showToast({title:"复制链接成功",icon:"none"})}})}(o)),o.id),s:o.id,t:e.o((a=>function(a){e.index.navigateTo({url:"/pages/treehole_detail/treehole_detail?id="+a.id})}(o)),o.id)}))),P:e.p({type:"chat",size:"18",color:"#666"}),Q:e.p({type:"redo",size:"18",color:"#666"}),R:L.value},(L.value,{}),{S:!j.value},(j.value,{})):{},{T:e.p({name:"fade",mode:"out-in"}),U:e.p({head_color:"rgb(255 230 215) "})})}},n=e._export_sfc(o,[["__scopeId","data-v-bab764da"]]);o.__runtimeHooks=2,wx.createPage(n);
