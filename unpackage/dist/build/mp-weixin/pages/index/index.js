"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("privacy-permission-modal")+e.resolveComponent("version-check")+e.resolveComponent("loading-toast")+e.resolveComponent("goods-search")+e.resolveComponent("uni-transition")+e.resolveComponent("common-search")+e.resolveComponent("index-brand")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../components/privacy-permission-modal/privacy-permission-modal.js")+(()=>"../../components/version-check/version-check.js")+(()=>"../../components/loading-toast/loading-toast.js")+(()=>"../../components/goods-search/goods-search.js")+(()=>"../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../components/common-search/common-search.js")+(()=>"../../components/index-brand/index-brand.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const o={__name:"index",setup(o){e.useCssVars((e=>({"62eac472":B.value})));let l=e.ref([]),n=e.ref({}),s=e.ref(""),i=e.ref(!1);const u=e.ref([{label:"中国娃社",value:1},{label:"个人作者",value:2},{label:"外国娃社",value:3}]),r=e.ref(1);e.ref(0);const c=e.index.getSystemInfoSync();e.ref(0);const d=e.ref(1),v=e.ref(10),f=e.ref(!0),p=e.ref(!1);let g=e.ref([]);const h=e.ref(1),m=e.ref(10),_=e.ref(!0),w=e.ref(!1);let b=e.ref([]);const x=e.ref(1),y=e.ref(10),T=e.ref(!0),k=e.ref(!1);let j=e.ref([]);const z=e.ref(1),C=e.ref(10),q=e.ref(!0),S=e.ref(!1),D=e.ref("news"),U=e=>{D.value=e},$=e.computed((()=>{const a=e.index.getMenuButtonBoundingClientRect(),t=c.statusBarHeight||32;return a.bottom+a.top-2*t})),B=e.computed((()=>$.value+"px"));e.onPullDownRefresh((async()=>{try{await I(),e.index.stopPullDownRefresh()}catch(a){e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新失败",icon:"none"})}}));const I=async()=>{i.value=!0,setTimeout((async()=>{const e={brands:()=>{d.value=1,l.value=[],f.value=!0,M(!0)},news:()=>{h.value=1,g.value=[],_.value=!0,P(!0)},hot:()=>{x.value=1,b.value=[],T.value=!0,R(!0)},second:()=>{z.value=1,j.value=[],q.value=!0,L(!0)}};await e[D.value]()}),800)};const P=async(a=!1)=>{a&&(h.value=1),_.value&&!w.value&&(w.value=!0,i.value=!0,e.index.request({url:t.websiteUrl+"/sale-news",data:{page:h.value,pageSize:m.value},success:e=>{const a=e.data.data.news_list;0!==a.length?(g.value=[...g.value,...a],_.value=e.data.data.news_list.length===m.value,h.value++):_.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{w.value=!1,i.value=!1}}))};const R=async(a=!1)=>{a&&(x.value=1),T.value&&!k.value&&(k.value=!0,i.value=!0,e.index.request({url:t.websiteUrl+"/hot-collocation",data:{page:x.value,pageSize:y.value},success:e=>{const a=e.data.data.collocation_relation_list;0!==a.length?(b.value=[...b.value,...a.map((e=>({...e})))],T.value=b.value.length<e.data.data.total,x.value++):T.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{k.value=!1,i.value=!1}}))};const M=async(a=!1)=>{if(a&&(d.value=1,l.value=[],f.value=!0,s.value=""),!f.value||p.value)return;p.value=!0,i.value=!0;const o={pageSize:v.value};s.value?o.cursor=s.value:r.value&&(o.searchType=r.value),e.index.request({url:t.websiteUrl+"/brands-info-list",data:o,success:a=>{if("success"!==a.data.status)return void e.index.showToast({title:"加载失败: "+a.data.message,icon:"none"});const t=a.data.data,o=t.data;console.log("newData:",o),s.value=t.next_cursor||"",0!==o.length?(l.value=[...l.value,...o],f.value=t.has_more):f.value=!1},fail:a=>{console.log(a),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{p.value=!1,i.value=!1}})},L=async(a=!1)=>{a&&(z.value=1),q.value&&!S.value&&(S.value=!0,i.value=!0,e.index.request({url:t.websiteUrl+"/treehole-submissions",data:{page:z.value,pageSize:C.value},success:e=>{const a=e.data.data.submission_list.map((e=>({...e,images:e.images||[]})));0!==a.length?(j.value=[...j.value,...a],q.value=j.value.length<e.data.data.total,z.value++):q.value=!1},fail:a=>{e.index.showToast({title:"加载失败",icon:"none"})},complete:()=>{S.value=!1,i.value=!1}}))};function V(){t.global.isLogin?e.index.navigateTo({url:"/pages/treehole_publish/treehole_publish"}):e.index.showModal({title:"提示",content:"需要登录后才能发布树洞",success:a=>{a.confirm&&e.index.navigateTo({url:"/pages/login/login"})}})}const A=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`};return e.onLoad((()=>{t.getUserInfo(),M(),P(),R(),L(),e.index.request({url:t.websiteUrl+"/articles",data:{page:1,page_size:10,status:1},success:e=>{"success"===e.data.status&&(n.value=e.data.data.list)},fail:e=>{console.error("获取Banner失败:",e),n.value={}}})})),e.onReachBottom((()=>{"brands"===D.value&&f.value?M():"news"===D.value&&_.value?P():"second"===D.value&&q.value&&L()})),(o,c)=>e.e({a:e.s(o.__cssVars()),b:e.p({"show-up-to-date-toast":!0}),c:e.p({show:e.unref(i)}),d:a._imports_0,e:e.p({width:"720rpx",hiddenIcon:!1}),f:a._imports_1,g:"news"===D.value?1:"",h:e.o((e=>U("news"))),i:a._imports_2,j:"brands"===D.value?1:"",k:e.o((e=>U("brands"))),l:a._imports_3,m:"hot"===D.value?1:"",n:e.o((e=>U("hot"))),o:a._imports_0$1,p:"second"===D.value?1:"",q:e.o((e=>U("second"))),r:"news"===D.value},"news"===D.value?e.e({s:e.f(e.unref(n),((a,t,o)=>({a:a.banner,b:e.o((t=>(a=>{e.index.navigateTo({url:`/pages/article_detail/article_detail?id=${a.id}`})})(a)),a.id),c:a.id}))),t:0===e.unref(n).length},0===e.unref(n).length?{v:a._imports_5}:{},{w:e.f(e.unref(g),((a,t,o)=>e.e({a:a.image_list.length>0},a.image_list.length>0?{b:e.f(a.image_list,((e,a,t)=>({a:e,b:a})))}:{},{c:e.t(a.title),d:e.t(a.content),e:e.t(a.brand_name),f:e.t(A(a.created_at)),g:a.id,h:e.o((t=>function(a){e.index.navigateTo({url:"/pages/sale_news/sale_news?id="+a.id+"&brand_id="+a.brand_id})}(a)),a.id)}))),x:w.value},(w.value,{}),{y:!_.value},(_.value,{})):{},{z:e.p({"mode-class":["fade"],show:"news"===D.value}),A:e.p({width:"720rpx"}),B:e.f(u.value,((a,t,o)=>({a:e.t(a.label),b:t,c:r.value===a.value?1:"",d:e.o((e=>{return t=a.value,r.value===t?r.value=null:r.value=t,d.value=1,f.value=!0,l.value=[],s.value="",void M();var t}),t)}))),C:1==r.value},(r.value,{}),{D:2==r.value},(r.value,{}),{E:3==r.value},(r.value,{}),{F:"brands"===D.value},"brands"===D.value?e.e({G:e.f(e.unref(l),((a,t,o)=>({a:"fc01e2f8-7-"+o+",fc01e2f8-5",b:e.p({brand:a}),c:a.id}))),H:p.value},(p.value,{}),{I:!f.value},(f.value,{})):{},{J:e.p({"mode-class":["fade"],show:"brands"===D.value}),K:"hot"===D.value},"hot"===D.value?e.e({L:e.f(e.unref(b),((a,t,o)=>e.e({a:a.image_urls.length>0},a.image_urls.length>0?{b:e.f(a.image_urls,((e,a,t)=>({a:e,b:a})))}:{},{c:e.t(a.title),d:e.t(a.content),e:e.f(a.relation_list,((a,t,o)=>({a:e.t(a.relation_goods_name),b:e.t(a.relation_brand_name),c:t}))),f:a.avatar,g:e.t(1==a.origin?"搭配":"展示柜"),h:e.t(A(a.created_at)),i:"fc01e2f8-9-"+o+",fc01e2f8-8",j:e.t(a.like_count),k:a.collocation_id,l:e.o((t=>function(a){e.index.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${a.collocation_id}&origin=${a.origin}`})}(a)),a.collocation_id)}))),M:e.p({type:"heart",size:"18",color:"#ff4d4f"}),N:k.value},(k.value,{}),{O:!T.value},(T.value,{})):{},{P:e.p({"mode-class":["fade"],show:"hot"===D.value}),Q:"second"===D.value},"second"===D.value?e.e({R:e.p({type:"plusempty",size:"30",color:"#fff"}),S:e.o(V),T:e.f(e.unref(j),((o,l,n)=>e.e({a:""!==o.avatar},""!==o.avatar?{b:o.avatar}:{c:a._imports_6},{d:e.t(o.is_anonymous?"匿名用户":o.author_name),e:e.t(A(o.created_at)),f:e.t(o.id),g:e.o((a=>function(a){1!=a.is_anonymous&&e.index.navigateTo({url:"/pages/user_page/user_page?uid="+a.uid})}(o)),o.id),h:e.t(o.content),i:o.images.length>0},o.images.length>0?{j:e.f(o.images,((a,t,l)=>({a:a,b:e.o((a=>{return l=o.images,n=t,void e.index.previewImage({current:n,urls:l});var l,n}),t),c:t})))}:{},{k:"fc01e2f8-12-"+n+",fc01e2f8-10",l:e.p({type:o.has_liked?"hand-up-filled":"hand-up",size:"18",color:o.has_liked?"#ff4d4f":"#666"}),m:e.t(o.like_count||0),n:e.o((a=>function(a){if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});let o=e.index.getStorageSync("token");o?e.index.request({url:t.websiteUrl+(a.has_liked?"/with-state/unlike":"/with-state/add-like"),method:"POST",header:{Authorization:o},data:{id:a.id,type:5},success:t=>{"success"===t.data.status?(a.has_liked=!a.has_liked,a.like_count+=a.has_liked?1:-1):e.index.showD}}):e.index.showToast({title:"请先登录",icon:"none"})}(o)),o.id),o:"fc01e2f8-13-"+n+",fc01e2f8-10",p:e.t(o.comment_count||0),q:"fc01e2f8-14-"+n+",fc01e2f8-10",r:e.o((a=>function(a){let t="http://m.dogdogdoll.com/#/pages/treehole_detail/treehole_detail?id="+a.id;e.index.setClipboardData({data:t,success:function(){e.index.showToast({title:"复制链接成功",icon:"none"})}})}(o)),o.id),s:o.id,t:e.o((a=>function(a){e.index.navigateTo({url:"/pages/treehole_detail/treehole_detail?id="+a.id})}(o)),o.id)}))),U:e.p({type:"chat",size:"18",color:"#666"}),V:e.p({type:"redo",size:"18",color:"#666"}),W:S.value},(S.value,{}),{X:!q.value},(q.value,{})):{},{Y:e.p({"mode-class":["fade"],show:"second"===D.value}),Z:e.s(o.__cssVars())})}},l=e._export_sfc(o,[["__scopeId","data-v-fc01e2f8"]]);o.__runtimeHooks=2,wx.createPage(l);
