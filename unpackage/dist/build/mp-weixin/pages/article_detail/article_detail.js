"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("mp-html")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../components/view-logs/view-logs.js")+(()=>"../../uni_modules/mp-html/components/mp-html/mp-html.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const n={__name:"article_detail",setup(n){const a=e.ref({title:"",content:"",banner:"",created_at:0});e.ref(1),e.ref(!1),e.ref(!1),e.ref(null);const o=e.ref(null),i=e.ref(null),r=e.ref({}),s=async({content:n,replyInfo:i,origin:r})=>{var s,l;if(!(await d(!0)))return;const c={content:n,origin:r,target_id:parseInt(a.value.id),type:7,...i.id&&{reply_id:i.id,reply_for:i.comment,reply_user_id:i.user_id,parent_id:i.parent_id>0?i.parent_id:i.id}};try{const{data:n}=await e.index.request({url:`${t.websiteUrl}/with-state/add-comment`,method:"POST",header:{Authorization:e.index.getStorageSync("token")},data:c});"success"===n.status&&(0===n.data.parent_id?null==(s=o.value)||s.addNewComment(n.data):null==(l=o.value)||l.addReplyComment(n.data),e.index.showToast({title:"评论成功"}))}catch(u){e.index.showToast({title:"评论失败",icon:"none"})}},l=({parent:e,target:t})=>{var n;const a=t||e;r.value=a,null==(n=i.value)||n.focusInput()};e.onLoad((async n=>{if(!n.id)return e.index.navigateBack();t.asyncGetUserInfo(),await c(n.id)}));const c=async n=>{try{const{data:o}=await e.index.request({url:`${t.websiteUrl}/article-detail?id=${n}`});"success"===o.status&&(a.value=o.data,e.index.setNavigationBarTitle({title:o.data.title}))}catch(o){e.index.showToast({title:"加载失败",icon:"none"})}},d=async(n=!1)=>!!t.global.isLogin||(n&&e.index.showToast({title:"请先登录",icon:"none"}),!1);return(t,n)=>e.e({a:a.value.banner},a.value.banner?{b:a.value.banner}:{},{c:e.t(a.value.title),d:e.p({content:a.value.content}),e:a.value.id>0},a.value.id>0?{f:e.sr(o,"0a6aa1de-2",{k:"commentListRef"}),g:e.o(l),h:e.p({type:7,"relation-id":parseInt(a.value.id)}),i:e.sr(i,"0a6aa1de-3",{k:"commentInputRef"}),j:e.o(s),k:e.o((e=>r.value=e)),l:e.p({"reply-info":r.value,"target-id":a.value.id.toString()})}:{})}},a=e._export_sfc(n,[["__scopeId","data-v-0a6aa1de"]]);wx.createPage(a);
