"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-rate")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const a={__name:"brand",props:["brand_id"],setup(a){const n=a;console.log(n);const o=e.ref(!1);let i=e.ref([]),s=e.ref({page_index:1,page_size:3,total:0});e.index.showLoading({title:"加载中"}),e.index.getSystemInfoSync();let d=e.ref(0);const l=e.ref(0),r=e.ref(null),u=e.ref(null);e.ref(1);let c=e.ref({});const g=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let n=e;null!=t&&(n=t),c.value.id!=n.id?(console.log("item",n),c.value=n,null==(a=u.value)||a.focusInput()):c.value={}},m=({content:a,replyInfo:o,origin:i})=>{let s=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",o);const d={content:a,origin:i,target_id:parseInt(n.brand_id),type:1,...o.id&&{reply_id:o.id,reply_for:o.comment,reply_user_id:o.user_id,parent_id:o.parent_id>0?o.parent_id:o.id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:d,success:t=>{var a,n;if("success"==t.data.status){const o=t.data.data;0===o.parent_id?null==(a=r.value)||a.addNewComment(o):null==(n=r.value)||n.addReplyComment(o),e.index.showToast({title:"评论成功",icon:"success"})}else e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})},_=a=>{if(console.log(a),!t.global.isLogin)return e.index.showToast({title:"请先登录",icon:"none"}),void(d.value=0);d.value=a.value,l.value=a.value,async function(){if(0==d.value)return void e.index.showToast({title:"请先评分",icon:"none"});try{let a=e.index.getStorageSync("token");if(!a)return void e.index.showToast({title:"请先登录",icon:"none"});e.index.showLoading({title:"提交中..."});const o=await e.index.request({url:t.websiteUrl+"/with-state/add-vote-score",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{type:1,score:d.value,target_id:parseInt(n.brand_id)}});e.index.hideLoading(),"success"===o.data.status?(p(),e.index.showToast({title:"评分成功",icon:"success"})):e.index.showToast({title:o.data.msg||"评分失败",icon:"none"})}catch(a){e.index.hideLoading(),console.error("评分失败:",a),e.index.showToast({title:"评分失败，请重试",icon:"none"})}}()};function p(){e.index.request({url:t.websiteUrl+"/brand-info?id="+n.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),T.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),v()},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}const f=async()=>{let a=e.index.getStorageSync("token");if(t.global.isLogin)try{const i=`${t.websiteUrl}/with-state/${o.value?"unlike":"add-like"}`,s=await e.index.request({url:i,method:"POST",header:{Authorization:a},data:{id:parseInt(n.brand_id),type:2}});"success"===s.data.status?(o.value=!o.value,e.index.showToast({title:o.value?"关注成功":"已取消关注",icon:"none"}),p()):e.index.showToast({title:s.data.msg,icon:"none"})}catch(i){console.error(i),e.index.showToast({title:"操作失败",icon:"none"})}else e.index.showToast({title:"请先登录",icon:"none"})},v=async()=>{var a;try{const i=await e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${parseInt(n.brand_id)}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")}});o.value=(null==(a=i.data.data)?void 0:a.id)>0}catch(i){console.error("获取关注状态失败:",i)}};function h(e){const t=new Date(1e3*e),a=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${n}-${o} ${i}:${s}`}function x(){e.index.request({url:t.websiteUrl+"/brand-goods?brand_id="+n.brand_id+"&page="+b.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),w.value.page_index=t.data.data.page_index,w.value.total=t.data.data.total,w.value.goods_list=w.value.goods_list?w.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(b.value+=1),0==t.data.data.goods_list.length&&b.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}let w=e.ref({}),b=e.ref(1),T=e.ref({});return e.onShow((()=>{t.getUserInfo(),p(),x(),e.index.request({url:`${t.websiteUrl}/brand-news-list?brand_id=${n.brand_id}&page=${s.value.page_index}&page_size=${s.value.page_size}`,method:"GET",success:t=>{if("success"===t.data.status){const e=t.data.data;i.value=[...i.value,...e.news_list],s.value.total=e.total,e.news_list.length>0&&(s.value.page_index+=1)}else e.index.showToast({title:t.data.msg||"获取图透失败",icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}}),t.global.isLogin?function(a,n){let o=e.index.getStorageSync("token");o&&t.global.isLogin&&e.index.request({url:t.websiteUrl+"/with-state/my-vote-record",method:"GET",header:{Authorization:o,"Content-Type":"application/json"},data:{target_id:parseInt(n),type:a},success:t=>(console.log(t.data.data),"success"==t.data.status?(l.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,n.brand_id):d.value=0})),(t,a)=>({a:e.unref(T).logo_image,b:e.unref(T).brand_name_image,c:e.t(e.unref(T).country_name),d:e.t(e.unref(T).type),e:e.o(_),f:e.p({value:e.unref(T).score,"allow-half":"true",activeColor:"#65C3D6","is-fill":"false"}),g:e.t(e.unref(T).score),h:e.t(e.unref(T).vote_number),i:e.t(o.value?"已关注":"+ 关注品牌"),j:e.o(f),k:o.value?"#ff6a6c":"#65C3D6",l:e.t(e.unref(T).nickname_list),m:e.t(e.unref(T).description),n:e.t(e.unref(w).total),o:e.f(e.unref(w).goods_list,((t,a,n)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((a=>{return n=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+n});var n}),t.id),d:t.id}))),p:e.o(x),q:e.t(e.unref(s).total),r:e.f(e.unref(i),((t,a,n)=>e.e({a:e.t(t.title),b:t.image_list&&t.image_list.length>0},t.image_list&&t.image_list.length>0?{c:e.f(t.image_list,((a,n,o)=>({a:a,b:e.o((n=>{return o=a,i=t.image_list,void e.index.previewImage({current:o,urls:i});var o,i}),n),c:n})))}:{},{d:e.t(t.content),e:e.t(h(t.created_at)),f:e.o((a=>function(t){e.index.navigateTo({url:`/pages/sale_news/sale_news?id=${t.id}&brand_id=${t.brand_id}`})}(t)),t.id),g:t.id}))),s:e.sr(r,"8a9e13b2-1",{k:"commentListRef"}),t:e.o(g),v:e.p({type:1,"relation-id":parseInt(n.brand_id)}),w:e.sr(u,"8a9e13b2-2",{k:"commentInputRef"}),x:e.o(m),y:e.o((t=>e.isRef(c)?c.value=t:c=t)),z:e.p({"reply-info":e.unref(c),"target-id":n.brand_id})})}},n=e._export_sfc(a,[["__scopeId","data-v-8a9e13b2"]]);a.__runtimeHooks=2,wx.createPage(n);
