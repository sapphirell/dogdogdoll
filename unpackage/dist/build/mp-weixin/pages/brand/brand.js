"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("uni-rate")+e.resolveComponent("uni-icons")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../components/view-logs/view-logs.js")+(()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const a={__name:"brand",props:["brand_id"],setup(a){const n=a;console.log(n);const o=e.ref(!0),i=e.ref(0),s=e.ref(!1),l=e.ref([{label:"贩售作品"},{label:"消息动态"}]),d=()=>{e.index.navigateTo({url:`/pages/artist_info/artist_info?brand_id=${n.brand_id}`})},r=e.ref(!1);let u=e.ref([]),c=e.ref({page_index:1,page_size:10,total:0});e.index.showLoading({title:"加载中"}),e.index.getSystemInfoSync();let v=e.ref(0);const g=e.ref(0),_=e.ref(null),m=e.ref(null);e.ref(1);let p=e.ref({});const f=({parent:e,target:t})=>{var a;console.log("parent",e),console.log("target",t);let n=e;null!=t&&(n=t),p.value.id!=n.id?(console.log("item",n),p.value=n,null==(a=m.value)||a.focusInput()):p.value={}},h=a=>{var o,i,s;let l=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",p.value);const d={content:a.content,origin:a.origin,target_id:parseInt(n.brand_id),type:1,image_url:a.image_url||"",association_id:a.association_id||0,association_type:a.association_type||0,is_anonymous:a.is_anonymous||0,...p.value.id&&{reply_id:p.value.id,reply_for:p.value.comment,reply_uid:p.value.user_id,parent_id:p.value.parent_id>0?p.value.parent_id:p.value.id}},r={id:Date.now(),content:a.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...a.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:t.global.userInfo.avatar,username:t.global.userInfo.nickname,is_anonymous:0},...a.association_id&&{association_id:a.association_id,association_type:a.association_type},...a.image_url&&{image_url:a.image_url},...p.value.id&&{reply_id:p.value.id,reply_for:p.value.comment,reply_uid:p.value.user_id,parent_id:p.value.parent_id>0?p.value.parent_id:p.value.id,reply_username:p.value.is_anonymous?"匿名用户":p.value.username}};p.value.id?0===p.value.parent_id?null==(i=_.value)||i.addReplyComment({...r,parent_id:p.value.id}):null==(s=_.value)||s.addReplyComment({...r,parent_id:p.value.parent_id}):null==(o=_.value)||o.addNewComment(r),e.index.request({url:t.websiteUrl.value+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:d,success:n=>{var o,i;if("success"==n.data.status){const i=n.data.data,s={...i,...a.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:t.global.userInfo.avatar,username:t.global.userInfo.nickname,is_anonymous:0}};i.reply_uid&&p.value.is_anonymous&&(s.reply_username="匿名用户"),null==(o=_.value)||o.updateTempComment(r.id,s),e.index.showToast({title:"评论成功",icon:"success"})}else null==(i=_.value)||i.removeTempComment(r.id),e.index.showToast({title:n.data.msg,icon:"none"})},fail:t=>{var a;null==(a=_.value)||a.removeTempComment(r.id),e.index.showToast({title:"网络请求失败",icon:"none"})}})},w=a=>{if(console.log(a),!t.global.isLogin)return e.index.showToast({title:"请先登录",icon:"none"}),void(v.value=0);v.value=a.value,g.value=a.value,async function(){if(0==v.value)return void e.index.showToast({title:"请先评分",icon:"none"});try{let a=e.index.getStorageSync("token");if(!a)return void e.index.showToast({title:"请先登录",icon:"none"});e.index.showLoading({title:"提交中..."});const o=await e.index.request({url:t.websiteUrl.value+"/with-state/add-vote-score",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{type:1,score:v.value,target_id:parseInt(n.brand_id)}});e.index.hideLoading(),"success"===o.data.status?(x(),e.index.showToast({title:"评分成功",icon:"success"})):e.index.showToast({title:o.data.msg||"评分失败",icon:"none"})}catch(a){e.index.hideLoading(),console.error("评分失败:",a),e.index.showToast({title:"评分失败，请重试",icon:"none"})}}()};function x(){e.index.request({url:t.websiteUrl.value+"/brand-info?id="+n.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),$.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),b(),s.value||1!=$.value.is_bjd_artist&&1!=$.value.is_bjd_hairstylist||(l.value.push({label:"接单主页"}),s.value=!0)},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}const y=async()=>{let a=e.index.getStorageSync("token");if(t.global.isLogin)try{const o=`${t.websiteUrl.value}/with-state/${r.value?"unlike":"add-like"}`,i=await e.index.request({url:o,method:"POST",header:{Authorization:a},data:{id:parseInt(n.brand_id),type:2}});"success"===i.data.status?(r.value=!r.value,e.index.showToast({title:r.value?"关注成功":"已取消关注",icon:"none"}),x()):e.index.showToast({title:i.data.msg,icon:"none"})}catch(o){console.error(o),e.index.showToast({title:"操作失败",icon:"none"})}else e.index.showToast({title:"请先登录",icon:"none"})},b=async()=>{var a;try{const o=await e.index.request({url:`${t.websiteUrl.value}/with-state/hasLike?id=${parseInt(n.brand_id)}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")}});r.value=(null==(a=o.data.data)?void 0:a.id)>0}catch(o){console.error("获取关注状态失败:",o)}};function T(e){const t=new Date(1e3*e),a=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${n}-${o} ${i}:${s}`}function S(a=!1){e.index.request({url:t.websiteUrl.value+"/brand-goods?brand_id="+n.brand_id+"&page="+k.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),C.value.page_index=t.data.data.page_index,C.value.total=t.data.data.total,C.value.goods_list=a?C.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(k.value+=1),a&&0==t.data.data.goods_list.length&&k.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}),o.value=!1},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}let C=e.ref({}),k=e.ref(1),$=e.ref({});return e.onShow((()=>{t.getUserInfo(),x(),o.value&&S(),e.index.request({url:`${t.websiteUrl.value}/brand-news-list?brand_id=${n.brand_id}&page=${c.value.page_index}&page_size=${c.value.page_size}`,method:"GET",success:t=>{if("success"===t.data.status){const e=t.data.data;u.value=[...u.value,...e.news_list],c.value.total=e.total,e.news_list.length>0&&(c.value.page_index+=1)}else e.index.showToast({title:t.data.msg||"获取图透失败",icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}}),t.global.isLogin?function(a,n){let o=e.index.getStorageSync("token");o&&t.global.isLogin&&e.index.request({url:t.websiteUrl.value+"/with-state/my-vote-record",method:"GET",header:{Authorization:o,"Content-Type":"application/json"},data:{target_id:parseInt(n),type:a},success:t=>(console.log(t.data.data),"success"==t.data.status?(g.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,n.brand_id):v.value=0})),(t,a)=>({a:e.unref($).logo_image,b:e.unref($).brand_name_image,c:e.t(e.unref($).country_name),d:e.t(e.unref($).type),e:e.o(w),f:e.p({value:e.unref($).score,"allow-half":"true",activeColor:"#65C3D6","is-fill":"false"}),g:e.t(e.unref($).score),h:e.t(e.unref($).vote_number),i:e.t(r.value?"已关注":"+ 关注品牌"),j:e.o(y),k:r.value?"#ff6a6c":"#65C3D6",l:e.t(e.unref($).nickname_list||"暂无设置"),m:e.t(e.unref($).description||"暂未设置"),n:e.o((t=>{var a;(a=e.unref($).website_url)?0!==g.value?e.index.setClipboardData({data:a,success:()=>{e.index.showToast({title:"已复制贩售地址",icon:"success"})},fail:t=>{console.error("复制失败:",t),e.index.showToast({title:"复制失败",icon:"none"})}}):e.index.showToast({title:"请先评分后再复制",icon:"none"}):e.index.showToast({title:"暂无贩售地址",icon:"none"})})),o:e.f(l.value,((t,a,n)=>({a:e.t(t.label),b:a,c:i.value===a?1:"",d:e.o((e=>(e=>{i.value=e})(a)),a)}))),p:e.f(e.unref(C).goods_list,((t,a,n)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((a=>{return n=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+n});var n}),t.id),d:t.id}))),q:e.o(S),r:0===i.value,s:e.f(e.unref(u),((t,a,n)=>e.e({a:e.t(t.title),b:t.image_list&&t.image_list.length>0},t.image_list&&t.image_list.length>0?{c:e.f(t.image_list,((a,n,o)=>({a:a,b:e.o((a=>function(t){e.index.navigateTo({url:`/pages/sale_news/sale_news?id=${t.id}&brand_id=${t.brand_id}`})}(t)),n),c:n})))}:{},{d:e.t(t.content),e:e.t(T(t.created_at)),f:t.id}))),t:1===i.value,v:e.p({type:"arrow-right",size:"20",color:"#65C3D6"}),w:e.o(d),x:2===i.value,y:e.sr(_,"0cd78ede-3",{k:"commentListRef"}),z:e.o(f),A:e.p({type:1,"relation-id":parseInt(n.brand_id)}),B:e.sr(m,"0cd78ede-4",{k:"commentInputRef"}),C:e.o(h),D:e.o((t=>e.isRef(p)?p.value=t:p=t)),E:e.p({"reply-info":e.unref(p),"target-id":n.brand_id})})}},n=e._export_sfc(a,[["__scopeId","data-v-0cd78ede"]]);a.__runtimeHooks=2,wx.createPage(n);
