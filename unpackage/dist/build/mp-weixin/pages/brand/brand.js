"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){e.resolveComponent("uni-rate")()}Math;const a={__name:"brand",props:["brand_id"],setup(a){const o=a;console.log(o),e.index.showLoading({title:"加载中"});const n=e.index.getSystemInfoSync(),i=e.ref(0);e.onShow((()=>{})),e.onHide((()=>{}));const d=e.computed((()=>{var e;let t=(null==(e=n.safeAreaInsets)?void 0:e.bottom)||10;i.value>0&&(t+=i.value);let a=`${t}px`;return console.log("footer-brand:"+a),a}));let l=e.ref(""),s=e.ref(0),r=e.ref(!1);function u(){0!=s.value?s.value>5?e.index.showToast({title:"评分不能大于5",icon:"none"}):(console.log(s.value,o.brand_id),t.voteScore(1,s.value,o.brand_id)):e.index.showToast({title:"请先评分",icon:"none"})}function c(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),d=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${i}:${d}`}function g(){e.index.request({url:t.websiteUrl+"/brand-goods?brand_id="+o.brand_id+"&page="+h.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),_.value.page_index=t.data.data.page_index,_.value.total=t.data.data.total,_.value.goods_list=_.value.goods_list?_.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(h.value+=1),0==t.data.data.goods_list.length&&h.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function m(){e.index.request({url:t.websiteUrl+"/brand-comment?brand_id="+o.brand_id+"&page="+b.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),x.value.page_index=t.data.data.page_index,x.value.total=t.data.data.total,x.value.comment_list=x.value.comment_list?x.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(b.value+=1),0==t.data.data.comment_list.length&&b.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function f(e){r.value=!r.value}function v(){let a=e.index.getStorageSync("token");if(!a)return void e.index.showToast({title:"请先登录",icon:"none"});if(""==l.value)return void e.index.showToast({title:"请输入评论内容",icon:"none"});let n=t.getScene();e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:a},data:{target_id:parseInt(o.brand_id),content:l.value,type:1,origin:n},success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),l.value="",b.value=1,x.value={},void m()):void e.index.showToast({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}let _=e.ref({}),h=e.ref(1),p=e.ref({}),x=e.ref({}),b=e.ref(1);return e.index.request({url:t.websiteUrl+"/brand-info?id="+o.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),p.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}}),g(),m(),function(a,o){let n=e.index.getStorageSync("token");n&&t.global.isLogin&&e.index.request({url:t.websiteUrl+"/with-state/my-vote-record",method:"GET",header:{Authorization:n,"Content-Type":"application/json"},data:{target_id:parseInt(o),type:a},success:t=>(console.log(t.data.data),"success"==t.data.status?(s.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,o.brand_id),(t,a)=>e.e({a:e.unref(p).logo_image,b:e.t(e.unref(p).brand_name),c:e.t(e.unref(p).country_name),d:e.t(e.unref(p).type),e:e.p({value:e.unref(p).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"}),f:e.t(e.unref(p).score),g:e.t(e.unref(p).vote_number),h:e.o((e=>f())),i:e.t(e.unref(p).nickname_list),j:e.t(e.unref(p).description),k:e.t(e.unref(_).total),l:e.f(e.unref(_).goods_list,((t,a,o)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((a=>{return o=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+o});var o}),t.id),d:t.id}))),m:e.o(g),n:e.t(e.unref(x).total),o:e.unref(x).comment_list},e.unref(x).comment_list?{p:e.f(e.unref(x).comment_list,((t,a,o)=>({a:t.avatar,b:e.t(t.username),c:e.o((a=>{return o=t.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+o});var o}),t.id),d:e.t(t.comment),e:e.t(c(t.created_at)),f:e.t(t.floor),g:t.id}))),q:e.o(m)}:{},{r:e.t(e.unref(s)),s:e.o((t=>e.isRef(s)?s.value=t:s=t)),t:e.p({"allow-half":"true",size:"45",modelValue:e.unref(s)}),v:e.o(u),w:e.unref(r)?"":1,x:e.o((e=>f())),y:e.unref(l),z:e.o((t=>e.isRef(l)?l.value=t.detail.value:l=t.detail.value)),A:e.o(v),B:d.value})}},o=e._export_sfc(a,[["__scopeId","data-v-4e53729d"]]);wx.createPage(o);
