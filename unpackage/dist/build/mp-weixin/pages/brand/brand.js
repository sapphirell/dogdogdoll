"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){e.resolveComponent("uni-rate")()}Math;const a={__name:"brand",props:["brand_id"],setup(a){const o=a;console.log(o);const n=e.ref(!1);e.index.showLoading({title:"加载中"});const i=e.index.getSystemInfoSync(),d=e.ref(0);e.onShow((()=>{})),e.onHide((()=>{}));const s=e.computed((()=>{var e;let t=(null==(e=i.safeAreaInsets)?void 0:e.bottom)||10;d.value>0&&(t+=d.value);let a=`${t}px`;return console.log("footer-brand:"+a),a}));let l=e.ref(""),r=e.ref(0),u=e.ref(!1);function c(){0!=r.value?r.value>5?e.index.showToast({title:"评分不能大于5",icon:"none"}):(console.log(r.value,o.brand_id),t.voteScore(1,r.value,o.brand_id)):e.index.showToast({title:"请先评分",icon:"none"})}function g(){e.index.request({url:t.websiteUrl+"/brand-info?id="+o.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),T.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),f()},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}const v=async()=>{let a=e.index.getStorageSync("token");if(t.global.isLogin)try{const i=`${t.websiteUrl}/with-state/${n.value?"unlike":"add-like"}`,d=await e.index.request({url:i,method:"POST",header:{Authorization:a},data:{id:parseInt(o.brand_id),type:2}});"success"===d.data.status?(n.value=!n.value,e.index.showToast({title:n.value?"关注成功":"已取消关注",icon:"none"}),g()):e.index.showToast({title:d.data.msg,icon:"none"})}catch(i){console.error(i),e.index.showToast({title:"操作失败",icon:"none"})}else e.index.showToast({title:"请先登录",icon:"none"})},f=async()=>{var a;try{const i=await e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${parseInt(o.brand_id)}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")}});n.value=(null==(a=i.data.data)?void 0:a.id)>0}catch(i){console.error("获取关注状态失败:",i)}};function m(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),d=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${i}:${d}`}function _(){e.index.request({url:t.websiteUrl+"/brand-goods?brand_id="+o.brand_id+"&page="+b.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),w.value.page_index=t.data.data.page_index,w.value.total=t.data.data.total,w.value.goods_list=w.value.goods_list?w.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(b.value+=1),0==t.data.data.goods_list.length&&b.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function h(){e.index.request({url:t.websiteUrl+"/brand-comment?brand_id="+o.brand_id+"&page="+y.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),S.value.page_index=t.data.data.page_index,S.value.total=t.data.data.total,S.value.comment_list=S.value.comment_list?S.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(y.value+=1),0==t.data.data.comment_list.length&&y.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function x(e){u.value=!u.value}function p(){let a=e.index.getStorageSync("token");if(!a)return void e.index.showToast({title:"请先登录",icon:"none"});if(""==l.value)return void e.index.showToast({title:"请输入评论内容",icon:"none"});let n=t.getScene();e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:a},data:{target_id:parseInt(o.brand_id),content:l.value,type:1,origin:n},success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),l.value="",y.value=1,S.value={},void h()):void e.index.showToast({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}let w=e.ref({}),b=e.ref(1),T=e.ref({}),S=e.ref({}),y=e.ref(1);return g(),_(),h(),function(a,o){let n=e.index.getStorageSync("token");n&&t.global.isLogin&&e.index.request({url:t.websiteUrl+"/with-state/my-vote-record",method:"GET",header:{Authorization:n,"Content-Type":"application/json"},data:{target_id:parseInt(o),type:a},success:t=>(console.log(t.data.data),"success"==t.data.status?(r.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,o.brand_id),(t,a)=>e.e({a:e.unref(T).logo_image,b:e.t(e.unref(T).brand_name),c:e.t(e.unref(T).country_name),d:e.t(e.unref(T).type),e:e.p({value:e.unref(T).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"}),f:e.t(e.unref(T).score),g:e.t(e.unref(T).vote_number),h:e.o((e=>x())),i:e.t(n.value?"已关注":"+ 关注品牌"),j:e.o(v),k:n.value?"#ff6a6c":"#65C3D6",l:e.t(e.unref(T).nickname_list),m:e.t(e.unref(T).description),n:e.t(e.unref(w).total),o:e.f(e.unref(w).goods_list,((t,a,o)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((a=>{return o=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+o});var o}),t.id),d:t.id}))),p:e.o(_),q:e.t(e.unref(S).total),r:e.unref(S).comment_list},e.unref(S).comment_list?{s:e.f(e.unref(S).comment_list,((t,a,o)=>({a:t.avatar,b:e.t(t.username),c:e.o((a=>{return o=t.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+o});var o}),t.id),d:e.t(t.comment),e:e.t(m(t.created_at)),f:e.t(t.floor),g:t.id}))),t:e.o(h)}:{},{v:e.t(e.unref(r)),w:e.o((t=>e.isRef(r)?r.value=t:r=t)),x:e.p({"allow-half":"true",size:"45",modelValue:e.unref(r)}),y:e.o(c),z:e.unref(u)?"":1,A:e.o((e=>x())),B:e.unref(l),C:e.o((t=>e.isRef(l)?l.value=t.detail.value:l=t.detail.value)),D:e.o(p),E:s.value})}},o=e._export_sfc(a,[["__scopeId","data-v-b0d5b7fc"]]);wx.createPage(o);
