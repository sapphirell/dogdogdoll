"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-rate")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const o={__name:"brand",props:["brand_id"],setup(o){const n=o;console.log(n);const a=e.ref(!1),i=e.ref(!1);e.index.showLoading({title:"加载中"}),e.index.getSystemInfoSync();let s=e.ref(0);const d=e.ref(null),l=e.ref(null);e.ref(1);let r=e.ref({});const u=({parent:e,target:t})=>{var o;console.log("parent",e),console.log("target",t);let n=e;null!=t&&(n=t),r.value.id!=n.id?(console.log("item",n),r.value=n,null==(o=l.value)||o.focusInput()):r.value={}},c=({content:o,replyInfo:n,origin:a})=>{let i=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",n);const s={content:o,origin:a,target_id:parseInt(pageId.value),type:1,...n.id&&{reply_id:n.id,reply_for:n.comment,reply_user_id:n.user_id,parent_id:n.parent_id>0?n.parent_id:n.id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:i},data:s,success:t=>{var o,n;if("success"==t.data.status){const a=t.data.data;0===a.parent_id?null==(o=d.value)||o.addNewComment(a):null==(n=d.value)||n.addReplyComment(a),e.index.showToast({title:"评论成功",icon:"success"})}else e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})};function g(){0!=s.value?s.value>5?e.index.showToast({title:"评分不能大于5",icon:"none"}):(console.log(s.value,n.brand_id),t.voteScore(1,s.value,n.brand_id)):e.index.showToast({title:"请先评分",icon:"none"})}function m(){e.index.request({url:t.websiteUrl+"/brand-info?id="+n.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),w.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),p()},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}const f=async()=>{let o=e.index.getStorageSync("token");if(t.global.isLogin)try{const i=`${t.websiteUrl}/with-state/${a.value?"unlike":"add-like"}`,s=await e.index.request({url:i,method:"POST",header:{Authorization:o},data:{id:parseInt(n.brand_id),type:2}});"success"===s.data.status?(a.value=!a.value,e.index.showToast({title:a.value?"关注成功":"已取消关注",icon:"none"}),m()):e.index.showToast({title:s.data.msg,icon:"none"})}catch(i){console.error(i),e.index.showToast({title:"操作失败",icon:"none"})}else e.index.showToast({title:"请先登录",icon:"none"})},p=async()=>{var o;try{const i=await e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${parseInt(n.brand_id)}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")}});a.value=(null==(o=i.data.data)?void 0:o.id)>0}catch(i){console.error("获取关注状态失败:",i)}};function v(){e.index.request({url:t.websiteUrl+"/brand-goods?brand_id="+n.brand_id+"&page="+x.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),h.value.page_index=t.data.data.page_index,h.value.total=t.data.data.total,h.value.goods_list=h.value.goods_list?h.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(x.value+=1),0==t.data.data.goods_list.length&&x.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function _(e){i.value=!i.value}let h=e.ref({}),x=e.ref(1),w=e.ref({});return m(),v(),function(o,n){let a=e.index.getStorageSync("token");a&&t.global.isLogin&&e.index.request({url:t.websiteUrl+"/with-state/my-vote-record",method:"GET",header:{Authorization:a,"Content-Type":"application/json"},data:{target_id:parseInt(n),type:o},success:t=>(console.log(t.data.data),"success"==t.data.status?(s.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,n.brand_id),(t,o)=>e.e({a:e.unref(w).logo_image,b:e.t(e.unref(w).brand_name),c:e.t(e.unref(w).country_name),d:e.t(e.unref(w).type),e:e.p({value:e.unref(w).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"}),f:e.t(e.unref(w).score),g:e.t(e.unref(w).vote_number),h:e.o((e=>_())),i:e.t(a.value?"已关注":"+ 关注品牌"),j:e.o(f),k:a.value?"#ff6a6c":"#65C3D6",l:e.t(e.unref(w).nickname_list),m:e.t(e.unref(w).description),n:e.t(e.unref(h).total),o:e.f(e.unref(h).goods_list,((t,o,n)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((o=>{return n=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+n});var n}),t.id),d:t.id}))),p:e.o(v),q:e.sr(d,"9ec5304f-1",{k:"commentListRef"}),r:e.o(u),s:e.p({type:1,"relation-id":parseInt(n.brand_id)}),t:t.loading},(t.loading,{}),{v:t.error},t.error?{w:e.t(t.errorMsg)}:{},{x:e.t(e.unref(s)),y:e.o((t=>e.isRef(s)?s.value=t:s=t)),z:e.p({"allow-half":"true",size:"45",modelValue:e.unref(s)}),A:e.o(g),B:i.value?"":1,C:e.o((e=>_())),D:e.sr(l,"9ec5304f-3",{k:"commentInputRef"}),E:e.o(c),F:e.o((t=>e.isRef(r)?r.value=t:r=t)),G:e.p({"reply-info":e.unref(r),"target-id":n.brand_id})})}},n=e._export_sfc(o,[["__scopeId","data-v-9ec5304f"]]);o.__runtimeHooks=2,wx.createPage(n);
