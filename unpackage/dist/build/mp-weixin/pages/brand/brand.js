"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-rate")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const n={__name:"brand",props:["brand_id"],setup(n){const a=n;console.log(a);const o=e.ref(!1);let i=e.ref([]),s=e.ref({page_index:1,page_size:3,total:0});e.index.showLoading({title:"加载中"}),e.index.getSystemInfoSync();let d=e.ref(0);const l=e.ref(null),r=e.ref(null);e.ref(1);let u=e.ref({});const c=({parent:e,target:t})=>{var n;console.log("parent",e),console.log("target",t);let a=e;null!=t&&(a=t),u.value.id!=a.id?(console.log("item",a),u.value=a,null==(n=r.value)||n.focusInput()):u.value={}},g=({content:n,replyInfo:o,origin:i})=>{let s=e.index.getStorageSync("token");if(!t.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});console.log("reply_info",o);const d={content:n,origin:i,target_id:parseInt(a.brand_id),type:1,...o.id&&{reply_id:o.id,reply_for:o.comment,reply_user_id:o.user_id,parent_id:o.parent_id>0?o.parent_id:o.id}};e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:s},data:d,success:t=>{var n,a;if("success"==t.data.status){const o=t.data.data;0===o.parent_id?null==(n=l.value)||n.addNewComment(o):null==(a=l.value)||a.addReplyComment(o),e.index.showToast({title:"评论成功",icon:"success"})}else e.index.showToast({title:t.data.msg,icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}})},m=n=>{if(!t.global.isLogin)return e.index.showToast({title:"请先登录",icon:"none"}),void(d.value=0);!async function(){if(0==d.value)return void e.index.showToast({title:"请先评分",icon:"none"});try{let n=e.index.getStorageSync("token");if(!n)return void e.index.showToast({title:"请先登录",icon:"none"});e.index.showLoading({title:"提交中..."});const o=await e.index.request({url:t.websiteUrl+"/with-state/add-vote-score",method:"POST",header:{Authorization:n,"Content-Type":"application/json"},data:{type:1,score:d.value,target_id:parseInt(a.brand_id)}});e.index.hideLoading(),"success"===o.data.status?(_(),e.index.showToast({title:"评分成功",icon:"success"})):e.index.showToast({title:o.data.msg||"评分失败",icon:"none"})}catch(n){e.index.hideLoading(),console.error("评分失败:",n),e.index.showToast({title:"评分失败，请重试",icon:"none"})}}()};function _(){e.index.request({url:t.websiteUrl+"/brand-info?id="+a.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),b.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),f()},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}const p=async()=>{let n=e.index.getStorageSync("token");if(t.global.isLogin)try{const i=`${t.websiteUrl}/with-state/${o.value?"unlike":"add-like"}`,s=await e.index.request({url:i,method:"POST",header:{Authorization:n},data:{id:parseInt(a.brand_id),type:2}});"success"===s.data.status?(o.value=!o.value,e.index.showToast({title:o.value?"关注成功":"已取消关注",icon:"none"}),_()):e.index.showToast({title:s.data.msg,icon:"none"})}catch(i){console.error(i),e.index.showToast({title:"操作失败",icon:"none"})}else e.index.showToast({title:"请先登录",icon:"none"})},f=async()=>{var n;try{const i=await e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${parseInt(a.brand_id)}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")}});o.value=(null==(n=i.data.data)?void 0:n.id)>0}catch(i){console.error("获取关注状态失败:",i)}};function h(e){const t=new Date(1e3*e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${n}-${a}-${o} ${i}:${s}`}function v(){e.index.request({url:t.websiteUrl+"/brand-goods?brand_id="+a.brand_id+"&page="+w.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),x.value.page_index=t.data.data.page_index,x.value.total=t.data.data.total,x.value.goods_list=x.value.goods_list?x.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&(w.value+=1),0==t.data.data.goods_list.length&&w.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}let x=e.ref({}),w=e.ref(1),b=e.ref({});return e.onShow((()=>{_(),v(),e.index.request({url:`${t.websiteUrl}/brand-news-list?brand_id=${a.brand_id}&page=${s.value.page_index}&page_size=${s.value.page_size}`,method:"GET",success:t=>{if("success"===t.data.status){const e=t.data.data;i.value=[...i.value,...e.news_list],s.value.total=e.total,e.news_list.length>0&&(s.value.page_index+=1)}else e.index.showToast({title:t.data.msg||"获取图透失败",icon:"none"})},fail:t=>{e.index.showToast({title:"网络请求失败",icon:"none"})}}),t.global.isLogin?function(n,a){let o=e.index.getStorageSync("token");o&&t.global.isLogin&&e.index.request({url:t.websiteUrl+"/with-state/my-vote-record",method:"GET",header:{Authorization:o,"Content-Type":"application/json"},data:{target_id:parseInt(a),type:n},success:t=>(console.log(t.data.data),"success"==t.data.status?(d.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,a.brand_id):d.value=0})),(n,_)=>({a:e.unref(b).logo_image,b:e.unref(b).brand_name_image,c:e.t(e.unref(b).country_name),d:e.t(e.unref(b).type),e:e.o(m),f:e.o((t=>e.isRef(d)?d.value=t:d=t)),g:e.p({"allow-half":"true",disabled:!e.unref(t.global).isLogin,color:e.unref(t.global).isLogin?"#65C3D6":"#FF9DDB",modelValue:e.unref(d)}),h:e.t(e.unref(b).score),i:e.t(e.unref(b).vote_number),j:e.t(o.value?"已关注":"+ 关注品牌"),k:e.o(p),l:o.value?"#ff6a6c":"#65C3D6",m:e.t(e.unref(b).nickname_list),n:e.t(e.unref(b).description),o:e.t(e.unref(x).total),p:e.f(e.unref(x).goods_list,((t,n,a)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((n=>{return a=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+a});var a}),t.id),d:t.id}))),q:e.o(v),r:e.t(e.unref(s).total),s:e.f(e.unref(i),((t,n,a)=>e.e({a:e.t(t.title),b:t.image_list&&t.image_list.length>0},t.image_list&&t.image_list.length>0?{c:e.f(t.image_list,((n,a,o)=>({a:n,b:e.o((a=>{return o=n,i=t.image_list,void e.index.previewImage({current:o,urls:i});var o,i}),a),c:a})))}:{},{d:e.t(t.content),e:e.t(h(t.created_at)),f:e.o((n=>function(t){e.index.navigateTo({url:`/pages/sale_news/sale_news?id=${t.id}&brand_id=${t.brand_id}`})}(t)),t.id),g:t.id}))),t:e.sr(l,"abdfe402-1",{k:"commentListRef"}),v:e.o(c),w:e.p({type:1,"relation-id":parseInt(a.brand_id)}),x:e.sr(r,"abdfe402-2",{k:"commentInputRef"}),y:e.o(g),z:e.o((t=>e.isRef(u)?u.value=t:u=t)),A:e.p({"reply-info":e.unref(u),"target-id":a.brand_id})})}},a=e._export_sfc(n,[["__scopeId","data-v-abdfe402"]]);n.__runtimeHooks=2,wx.createPage(a);
