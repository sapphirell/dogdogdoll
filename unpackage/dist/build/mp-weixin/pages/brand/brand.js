"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){e.resolveComponent("uni-rate")()}Math;const a={__name:"brand",props:["brand_id"],setup(a){const o=a;console.log(o);const n=e.ref(!1);e.index.showLoading({title:"加载中"});const i=e.index.getSystemInfoSync(),d=e.ref(0),l=e.ref(!1);function s(){l.value=!0}function r(){l.value=!1}const u=()=>{l.value=!1,e.index.hideKeyboard()},c=e=>{console.log(e),d.value=e.height};e.onShow((()=>{e.index.onKeyboardHeightChange(c)})),e.onHide((()=>{var t,a;null==(a=(t=e.index).offKeyboardHeightChange)||a.call(t,c)}));const g=e.computed((()=>{var e;let t=(null==(e=i.safeAreaInsets)?void 0:e.bottom)||10;d.value>0&&(t+=d.value);let a=`${t}px`;return console.log("footer-brand:"+a),a}));let v=e.ref(""),f=e.ref(0),m=e.ref(!1);function h(){0!=f.value?f.value>5?e.index.showToast({title:"评分不能大于5",icon:"none"}):(console.log(f.value,o.brand_id),t.voteScore(1,f.value,o.brand_id)):e.index.showToast({title:"请先评分",icon:"none"})}function _(){e.index.request({url:t.websiteUrl+"/brand-info?id="+o.brand_id,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),k.value=t.data.data,e.index.setNavigationBarTitle({title:t.data.data.brand_name}),p()},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})}const x=async()=>{let a=e.index.getStorageSync("token");if(t.global.isLogin)try{const i=`${t.websiteUrl}/with-state/${n.value?"unlike":"add-like"}`,d=await e.index.request({url:i,method:"POST",header:{Authorization:a},data:{id:parseInt(o.brand_id),type:2}});"success"===d.data.status?(n.value=!n.value,e.index.showToast({title:n.value?"关注成功":"已取消关注",icon:"none"}),_()):e.index.showToast({title:d.data.msg,icon:"none"})}catch(i){console.error(i),e.index.showToast({title:"操作失败",icon:"none"})}else e.index.showToast({title:"请先登录",icon:"none"})},p=async()=>{var a;try{const i=await e.index.request({url:`${t.websiteUrl}/with-state/hasLike?id=${parseInt(o.brand_id)}&type=2`,method:"POST",header:{Authorization:e.index.getStorageSync("token")}});n.value=(null==(a=i.data.data)?void 0:a.id)>0}catch(i){console.error("获取关注状态失败:",i)}};function b(e){const t=new Date(1e3*e),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=t.getHours().toString().padStart(2,"0"),d=t.getMinutes().toString().padStart(2,"0");return t.getSeconds().toString().padStart(2,"0"),`${a}-${o}-${n} ${i}:${d}`}function w(){e.index.request({url:t.websiteUrl+"/brand-goods?brand_id="+o.brand_id+"&page="+$.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),q.value.page_index=t.data.data.page_index,q.value.total=t.data.data.total,q.value.goods_list=q.value.goods_list?q.value.goods_list.concat(t.data.data.goods_list):t.data.data.goods_list,t.data.data.goods_list.length>0&&($.value+=1),0==t.data.data.goods_list.length&&$.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"})},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function T(){e.index.request({url:t.websiteUrl+"/brand-comment?brand_id="+o.brand_id+"&page="+A.value,method:"GET",timeout:5e3,success:t=>{console.log(t.data.data),I.value.page_index=t.data.data.page_index,I.value.total=t.data.data.total,I.value.comment_list=I.value.comment_list?I.value.comment_list.concat(t.data.data.comment_list):t.data.data.comment_list,null!=t.data.data.comment_list&&(t.data.data.comment_list.length>0&&(A.value+=1),0==t.data.data.comment_list.length&&A.value>1&&e.index.showToast({title:"没有更多数据了",icon:"none"}))},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function S(e){m.value=!m.value}function y(){let a=e.index.getStorageSync("token");if(!a)return void e.index.showToast({title:"请先登录",icon:"none"});if(""==v.value)return void e.index.showToast({title:"请输入评论内容",icon:"none"});let n=t.getScene();e.index.request({url:t.websiteUrl+"/with-state/add-comment",method:"POST",header:{Authorization:a},data:{target_id:parseInt(o.brand_id),content:v.value,type:1,origin:n},success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"评论成功",icon:"success"}),v.value="",A.value=1,I.value={},void T()):void e.index.showToast({title:t.data.msg,icon:"none"})),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}})}let q=e.ref({}),$=e.ref(1),k=e.ref({}),I=e.ref({}),A=e.ref(1);return _(),w(),T(),function(a,o){let n=e.index.getStorageSync("token");n&&t.global.isLogin&&e.index.request({url:t.websiteUrl+"/with-state/my-vote-record",method:"GET",header:{Authorization:n,"Content-Type":"application/json"},data:{target_id:parseInt(o),type:a},success:t=>(console.log(t.data.data),"success"==t.data.status?(f.value=t.data.data.score,t.data.data.score):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>(console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"}),0)})}(1,o.brand_id),(t,a)=>e.e({a:e.unref(k).logo_image,b:e.t(e.unref(k).brand_name),c:e.t(e.unref(k).country_name),d:e.t(e.unref(k).type),e:e.p({value:e.unref(k).score,"allow-half":"true","disabled-color":"rgb(255 157 219)"}),f:e.t(e.unref(k).score),g:e.t(e.unref(k).vote_number),h:e.o((e=>S())),i:e.t(n.value?"已关注":"+ 关注品牌"),j:e.o(x),k:n.value?"#ff6a6c":"#65C3D6",l:e.t(e.unref(k).nickname_list),m:e.t(e.unref(k).description),n:e.t(e.unref(q).total),o:e.f(e.unref(q).goods_list,((t,a,o)=>({a:t.goods_images[0],b:e.t(t.name),c:e.o((a=>{return o=t.id,void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+o});var o}),t.id),d:t.id}))),p:e.o(w),q:e.t(e.unref(I).total),r:e.unref(I).comment_list},e.unref(I).comment_list?{s:e.f(e.unref(I).comment_list,((t,a,o)=>({a:t.avatar,b:e.t(t.username),c:e.o((a=>{return o=t.uid,void e.index.navigateTo({url:"/pages/user_page/user_page?uid="+o});var o}),t.id),d:e.t(t.comment),e:e.t(b(t.created_at)),f:e.t(t.floor),g:t.id}))),t:e.o(T)}:{},{v:e.t(e.unref(f)),w:e.o((t=>e.isRef(f)?f.value=t:f=t)),x:e.p({"allow-half":"true",size:"45",modelValue:e.unref(f)}),y:e.o(h),z:e.unref(m)?"":1,A:e.o((e=>S())),B:l.value,C:e.o(u),D:e.o(s),E:e.o(s),F:e.o(r),G:e.unref(v),H:e.o((t=>e.isRef(v)?v.value=t.detail.value:v=t.detail.value)),I:e.o(y),J:g.value})}},o=e._export_sfc(a,[["__scopeId","data-v-3289a595"]]);wx.createPage(o);
