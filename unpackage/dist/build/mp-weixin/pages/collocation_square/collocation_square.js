"use strict";const e=require("../../common/vendor.js"),o=require("../../common/config.js");if(!Array){(e.resolveComponent("common-search")+e.resolveComponent("custom-picker")+e.resolveComponent("common-modal")+e.resolveComponent("common-page"))()}Math||((()=>"../../components/common-search/common-search.js")+(()=>"../../components/custom-picker/custom-picker.js")+(()=>"../../components/common-modal/common-modal.js")+(()=>"../../components/common-page/common-page.js"))();const a={__name:"collocation_square",setup(a){const t=e.ref([]),l=e.ref(!1),n=e.ref(!1),s=e.ref(1),u=e.ref(0),i=e.ref(0),c=e.reactive([0,0]),r=e.ref(!1),v=e.ref(""),d=e.ref([]),m=e.getCurrentInstance(),p=e.ref(null),f=e.ref([]),g=e.ref(null),_=e=>{const o=t.value[e];return o.position?{left:`${o.position.left}px`,top:`${o.position.top}px`,width:`${i.value}px`}:{}},h=o=>{if(!o)return void console.log("无法获取instance");if(!t.value)return void console.log("无列表数据，不需要计算布局");const a=e.index.createSelectorQuery().in(o.ctx),l=t.value.map(((e,o)=>new Promise((e=>{a.select(`#card-${o}`).boundingClientRect((a=>{e({index:o,rect:a})}))}))));a.exec((async()=>{c[0]=0,c[1]=0;(await Promise.all(l)).forEach((({index:e,rect:o})=>{if(!o)return;const a=t.value[e],l=c[0]<=c[1]?0:1,n=l*(i.value+10),s=c[l]+10;c[l]=s+o.height,a.position={left:n,top:s}})),u.value=Math.max(...c)+20}))};e.onMounted((()=>{const o=e.index.getSystemInfoSync();i.value=(o.windowWidth-30)/2}));const x=async(a=!1)=>{if(l.value||n.value)console.log("正在加载中或没有更多了");else try{l.value=!0,a&&(t.value=[],s.value=1);const u={page:s.value,page_size:10,filter_goods_id_list:f.value.map((e=>e.goods_id))},i=await e.index.request({url:`${o.websiteUrl}/collocation-list`,method:"POST",data:u});if("success"===i.data.status){const o=i.data.data,l=o.collocation_relation_list;t.value=a?l:[...t.value,...l],n.value=o.total<=10*s.value,s.value++,await e.nextTick$1(),h(m),setTimeout((()=>{h(m)}),500)}}finally{l.value=!1}},w=()=>r.value=!0,y=(e,o)=>{p.value={id:e,name:o},v.value=o,e&&b(e)},b=async a=>{try{const t=await e.index.request({url:`${o.websiteUrl}/goods-name-list?id=${a}`,method:"GET"});console.log("商品列表:",t.data),"success"===t.data.status&&(d.value=t.data.data)}catch(t){console.error("加载商品失败:",t)}},$=(e,o)=>{!f.value.some((o=>o.goods_id===e))&&e&&(g.value={goods_id:e,goods_name:o})},j=()=>{p.value=null,v.value="",f.value=[],d.value=[]},q=async()=>{f.value.push(g.value),r.value=!1,n.value=!1,await x(!0)},C=()=>{n.value||x()};return e.onMounted(x),(o,a)=>e.e({a:e.f(f.value,((o,a,t)=>({a:e.t(o.goods_name),b:e.o((e=>{return a=o.goods_id,event.stopPropagation(),f.value=f.value.filter((e=>e.goods_id!==a)),n.value=!1,void x(!0);var a}),o.goods_id),c:o.goods_id}))),b:!f.value.length},(f.value.length,{}),{c:e.o(w),d:e.o((e=>x(!0))),e:e.f(t.value,((o,a,t)=>({a:o.image_urls[0],b:e.t(o.title),c:e.t(o.content),d:e.f(o.relation_list,((o,a,t)=>({a:e.t(o.relation_goods_name||"未命名商品"),b:a}))),e:o.collocation_id,f:"card-"+a,g:e.s(_(a))}))),f:u.value+"px",g:l.value},(l.value,{}),{h:n.value},(n.value,{}),{i:e.o(C),j:e.o((e=>r.value=!1)),k:e.o(y),l:e.p({mode:"fill",width:"450rpx"}),m:p.value},p.value?{n:e.o($),o:e.p({dataList:d.value,multiple:!0})}:{},{p:e.o(j),q:e.o(q),r:e.o((e=>r.value=e)),s:e.p({visible:r.value}),t:e.p({head_color:"#f5f5f5"})})}},t=e._export_sfc(a,[["__scopeId","data-v-4b30986d"]]);wx.createPage(t);
