"use strict";const e=require("../../../common/vendor.js"),o=require("../../../common/assets.js"),a=require("../../../common/config.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const t={__name:"collocation_list",setup(t){const i=e.useRoute(),n=e.ref(i.query.goods_id||""),l=e.ref([]),s=e.ref(!0),c=e.ref(null),r=async()=>{if(n.value)try{s.value=!0;const o=await e.index.request({url:`${a.websiteUrl.value}/goods-collocation`,method:"GET",data:{goods_id:n.value,official:!0}});if("success"!==o.data.status)throw new Error(o.data.msg||"获取搭配数据失败");{const e=o.data.data;l.value=e.collocation_relation_list.map((e=>({...e,imageList:e.image_urls.split(",").map((e=>e.trim()))})))}}catch(o){e.index.showToast({title:o.message||"请求失败",icon:"none"}),console.error("获取搭配数据失败:",o)}finally{s.value=!1}else e.index.showToast({title:"商品ID缺失",icon:"none"})},d=async()=>{if(!c.value&&n.value)try{const o=await e.index.request({url:`${a.websiteUrl.value}/goods`,method:"GET",data:{id:n.value}});"success"===o.data.status&&(c.value=o.data.data)}catch(i){console.error("获取商品信息失败:",i)}const o={goods_id:n.value};c.value&&(o.brand_id=c.value.brand_id,o.goods_name=c.value.name,o.brand_name=c.value.brand_name,o.type=c.value.type);const t=Object.entries(o).map((([e,o])=>`${e}=${o}`)).join("&");e.index.navigateTo({url:`/pages/collocation/collocation?${t}`})},u=e=>{const o=new Date(1e3*e);return`${o.getMonth()+1}-${o.getDate()} ${o.getHours()}:${o.getMinutes()}`};return e.onMounted((async()=>{e.index.setNavigationBarTitle({title:"官方搭配管理"}),a.global.isLogin||await a.asyncGetUserInfo(),r()})),(t,i)=>e.e({a:e.o(d),b:l.value.length>0},l.value.length>0?{c:e.f(l.value,((o,t,i)=>({a:e.t(o.title),b:e.t(u(o.created_at)),c:e.t(o.content),d:e.f(o.imageList,((a,t,i)=>({a:t,b:a,c:e.o((a=>((o,a)=>{e.index.previewImage({current:a,urls:o})})(o.imageList,t)),t)}))),e:"1bd3f7a4-0-"+i,f:e.o((a=>{return t=o.collocation_id,void e.index.navigateTo({url:`/pages/collocation_share/collocation_share?collocation_id=${t}&origin=1`});var t}),o.relation_id),g:"1bd3f7a4-1-"+i,h:e.o((a=>{return t=o.collocation_id,void e.index.navigateTo({url:`/pages/collocation/collocation?collocation_id=${t}`});var t}),o.relation_id),i:"1bd3f7a4-2-"+i,j:e.o((t=>(async o=>{e.index.showModal({title:"确认删除",content:"确定要删除这个搭配参考吗？",success:async t=>{if(t.confirm){console.log(o);try{const t=e.index.getStorageSync("token"),i=await e.index.request({url:`${a.websiteUrl.value}/with-state/delete-collocation?collocation_id=${o.collocation_id}`,method:"POST",header:{Authorization:t},data:{collocation_id:o.collocation_id}});if("success"!==i.data.status)throw new Error(i.data.msg||"删除失败");e.index.showToast({title:"删除成功"}),r()}catch(i){e.index.showToast({title:i.message||"删除失败",icon:"none"})}}}})})(o)),o.relation_id),k:o.relation_id}))),d:e.p({type:"eye",size:"14",color:"#3a3a3a"}),e:e.p({type:"compose",size:"14",color:"#3a3a3a"}),f:e.p({type:"closeempty",size:"14",color:"#3a3a3a"})}:{g:o._imports_0$11})}};wx.createPage(t);
