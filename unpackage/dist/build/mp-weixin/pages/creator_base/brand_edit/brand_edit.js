"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/config.js"),n=require("../../../common/image.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const t={__name:"brand_edit",setup(t){const o=e.reactive({id:0,brand_name:"",nickname_list:"",country_name:"",type:"",website_url:"",description:"",logo_image:""}),i=e.ref({}),r=e.ref(["公司","个人作者"]),l=e.ref(!1),s=e.computed((()=>{var e,a,n;return""!==(null==(e=o.brand_name)?void 0:e.trim())&&""!==(null==(a=o.type)?void 0:a.trim())&&""!==(null==(n=o.website_url)?void 0:n.trim())})),c=e=>{o.type=r.value[e.detail.value]},d=async()=>{try{l.value=!0;const n=await a.asyncGetUserInfo();if(console.log(n),!n||!n.brand_id)return void e.index.showToast({title:"您尚未管理任何品牌",icon:"none"});const t=null==n?void 0:n.brand_id;if(!t)return void e.index.showToast({title:"用户未关联品牌信息",icon:"none"});const r=await e.index.request({url:`${a.websiteUrl.value}/brand-info?id=${t}`,method:"GET",header:{Authorization:e.index.getStorageSync("token")}});"success"===r.data.status?(i.value=r.data.data,Object.assign(o,{id:i.value.id,brand_name:i.value.brand_name||"",nickname_list:i.value.nickname_list||"",country_name:i.value.country_name||"",type:i.value.type||"",website_url:i.value.website_url||"",description:i.value.description||"",logo_image:i.value.logo_image||""})):e.index.showToast({title:"获取品牌信息失败: "+(r.data.msg||"未知错误"),icon:"none"})}catch(n){console.error("获取品牌信息失败:",n),e.index.showToast({title:"获取品牌信息失败，请重试",icon:"none"})}finally{l.value=!1}},u=async()=>{try{const a=await n.chooseImage();e.index.showLoading({title:"上传中...",mask:!0});const t=await n.getQiniuToken();if(!t||!t.path||!t.token)throw new Error("获取上传凭证失败: 缺少必要字段");const i=t.path,r=await n.uploadImageToQiniu(a,t.token,i);r&&r.imageUrl&&(o.logo_image=r.imageUrl,e.index.showToast({title:"上传成功,保存生效",icon:"success"}))}catch(a){console.error("上传LOGO失败:",a),e.index.showToast({title:`上传LOGO失败: ${a.message||a}`,icon:"none",duration:3e3})}finally{e.index.hideLoading()}},m=async()=>{if(s.value)try{l.value=!0;const n={id:o.id,brand_name:o.brand_name,nickname_list:o.nickname_list,country_name:o.country_name,type:o.type,website_url:o.website_url,description:o.description,logo_image:o.logo_image},t=await e.index.request({url:`${a.websiteUrl.value}/brand-manager/update-brand`,method:"POST",header:{"Content-Type":"application/json",Authorization:e.index.getStorageSync("token")},data:n});"success"===t.data.status?(e.index.showToast({title:"已更新",icon:"success"}),d()):e.index.showToast({title:"更新失败: "+(t.data.msg||"未知错误"),icon:"none"})}catch(n){console.error("提交失败:",n),e.index.showToast({title:"提交失败，请重试",icon:"none"})}finally{l.value=!1}};return e.onMounted((()=>{e.index.setNavigationBarTitle({title:"编辑品牌信息"}),d()})),(a,n)=>e.e({a:o.logo_image||i.value.logo_image,b:e.o(u),c:o.brand_name,d:e.o((e=>o.brand_name=e.detail.value)),e:e.p({type:"compose",size:"18",color:"#999"}),f:o.brand_name&&i.value.brand_name_image},o.brand_name&&i.value.brand_name_image?{g:i.value.brand_name_image}:{},{h:o.nickname_list,i:e.o((e=>o.nickname_list=e.detail.value)),j:e.p({type:"flag",size:"18",color:"#999"}),k:o.country_name,l:e.o((e=>o.country_name=e.detail.value)),m:e.p({type:"location",size:"18",color:"#999"}),n:e.t(o.type||"请选择身份类型"),o:e.p({type:"arrowdown",size:"16",color:"#999"}),p:r.value.indexOf(o.type),q:r.value,r:e.o(c),s:e.p({type:"person",size:"18",color:"#999"}),t:o.website_url,v:e.o((e=>o.website_url=e.detail.value)),w:e.p({type:"link",size:"18",color:"#999"}),x:o.description,y:e.o((e=>o.description=e.detail.value)),z:e.p({type:"chat",size:"18",color:"#999"}),A:s.value?1:"",B:e.o(m),C:!s.value||l.value,D:l.value},l.value?{E:e.p({type:"spinner-cycle",size:"32",color:"#fff"})}:{})}},o=e._export_sfc(t,[["__scopeId","data-v-e6fe0f2d"]]);wx.createPage(o);
