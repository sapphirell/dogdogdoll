"use strict";const t=require("../../../common/vendor.js"),e=require("../../../common/config.js"),a=require("../../../common/image.js");if(!Array){t.resolveComponent("uni-icons")()}Math;const i={__name:"artist_info",setup(i){const s=t.ref("artist"),o=t.ref({artist_highlight_images:[],hairstylist_highlight_images:[],status_of_artist:0,status_of_hairstylist:0,base_price_of_artist:0,base_price_of_hairstylist:0,overload_ratio_of_artist:1,overload_ratio_of_hairstylist:1,rule_of_artist:"",rule_of_hairstylist:"",contact:""}),l=t.ref([{label:"请选择状态",value:0},{label:"长期接单",value:1},{label:"限时手速投递",value:2},{label:"限时抽选投递",value:3},{label:"限时黑箱卡投递",value:4},{label:"暂停接单",value:5}]),r=t.ref(!1),n=t.ref(0),u=t.ref(""),_=t.ref(!1),h=t.ref(0),c=t.ref(""),v=t.computed((()=>l.value.findIndex((t=>t.value===o.value.status_of_artist)))),g=t.computed((()=>l.value.findIndex((t=>t.value===o.value.status_of_hairstylist)))),d=t=>{s.value=t},f=(e,a)=>{t.index.previewImage({current:e,urls:a})},y=async()=>{try{const i=9-o.value.artist_highlight_images.length;if(i<=0)return void t.index.showToast({title:"最多只能上传9张图片",icon:"none"});const s=await a.chooseImageList(i);r.value=!0,n.value=0,u.value="准备上传...",u.value="获取上传凭证...";const l=await a.getQiniuToken();if(!l||!l.token)throw new Error("获取上传凭证失败");const _=l;for(let r=0;r<s.length;r++)try{const t=s[r];u.value=`上传中 (${r+1}/${s.length})`,n.value=Math.round(r/s.length*100);const e=_.path,i=await a.uploadImageToQiniu(t,_.token,e);i&&i.imageUrl&&o.value.artist_highlight_images.push(i.imageUrl)}catch(e){console.error(`第 ${r+1} 张图片上传失败:`,e),t.index.showToast({title:`第 ${r+1} 张图片上传失败: ${e.message||e}`,icon:"none",duration:3e3})}t.index.showToast({title:"上传成功",icon:"success"})}catch(e){console.error("上传失败:",e),t.index.showToast({title:"上传失败: "+(e.message||"未知错误"),icon:"none"})}finally{r.value=!1,n.value=0}},m=async()=>{try{const i=9-o.value.hairstylist_highlight_images.length;if(i<=0)return void t.index.showToast({title:"最多只能上传9张图片",icon:"none"});const s=await a.chooseImageList(i);_.value=!0,h.value=0,c.value="准备上传...",c.value="获取上传凭证...";const l=await a.getQiniuToken();if(!l||!l.token)throw new Error("获取上传凭证失败");const r=l;for(let n=0;n<s.length;n++)try{const t=s[n];c.value=`上传中 (${n+1}/${s.length})`,h.value=Math.round(n/s.length*100);const e=r.path,i=await a.uploadImageToQiniu(t,r.token,e);i&&i.imageUrl&&o.value.hairstylist_highlight_images.push(i.imageUrl)}catch(e){console.error(`第 ${n+1} 张图片上传失败:`,e),t.index.showToast({title:`第 ${n+1} 张图片上传失败: ${e.message||e}`,icon:"none",duration:3e3})}t.index.showToast({title:"上传成功",icon:"success"})}catch(e){console.error("上传失败:",e),t.index.showToast({title:"上传失败: "+(e.message||"未知错误"),icon:"none"})}finally{_.value=!1,h.value=0}},p=async()=>{const a=t.index.getStorageSync("token");if(a){t.index.showLoading({title:"加载中..."});try{const i=await t.index.request({url:`${e.websiteUrl.value}/brand-manager/get-artist-info`,method:"GET",header:{Authorization:a}});if("success"===i.data.status){console.log(i.data.data);const t=i.data.data;o.value={artist_highlight_images:t.artist_highlight_images||[],hairstylist_highlight_images:t.hairstylist_highlight_images||[],status_of_artist:Number(t.status_of_artist)||0,status_of_hairstylist:Number(t.status_of_hairstylist)||0,base_price_of_artist:parseFloat(t.base_price_of_artist)||0,base_price_of_hairstylist:parseFloat(t.base_price_of_hairstylist)||0,overload_ratio_of_artist:parseFloat(t.overload_ratio_of_artist)||1,overload_ratio_of_hairstylist:parseFloat(t.overload_ratio_of_hairstylist)||1,rule_of_artist:t.rule_of_artist||"",rule_of_hairstylist:t.rule_of_hairstylist||"",contact:t.contact||""}}else t.index.showToast({title:i.data.msg||"获取信息失败",icon:"none"})}catch(i){console.error("获取创作者信息失败:",i),t.index.showToast({title:"网络请求失败",icon:"none"})}finally{t.index.hideLoading()}}else t.index.showToast({title:"请先登录",icon:"none"})},w=async()=>{const a=t.index.getStorageSync("token");if(a){t.index.showLoading({title:"保存中..."});try{o.value.base_price_of_artist=parseFloat(o.value.base_price_of_artist);const i=await t.index.request({url:`${e.websiteUrl.value}/brand-manager/update-artist-info`,method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:o.value});"success"===i.data.status?(t.index.showToast({title:"保存成功",icon:"success"}),p()):t.index.showToast({title:i.data.msg||"保存失败",icon:"none"})}catch(i){console.error("保存创作者信息失败:",i),t.index.showToast({title:"网络请求失败",icon:"none"})}finally{t.index.hideLoading()}}else t.index.showToast({title:"请先登录",icon:"none"})};return t.onMounted((()=>{p(),t.index.setNavigationBarTitle({title:"妆师毛娘信息设置"})})),(e,a)=>t.e({a:"artist"===s.value?1:"",b:t.o((t=>d("artist"))),c:"hairstylist"===s.value?1:"",d:t.o((t=>d("hairstylist"))),e:"artist"===s.value},"artist"===s.value?t.e({f:t.t(l.value[v.value].label),g:l.value,h:v.value,i:o.value.base_price_of_artist,j:t.o((t=>o.value.base_price_of_artist=t.detail.value)),k:o.value.overload_ratio_of_artist,l:t.o((t=>o.value.overload_ratio_of_artist=t.detail.value)),m:o.value.contact,n:t.o((t=>o.value.contact=t.detail.value)),o:t.f(o.value.artist_highlight_images,((e,a,i)=>({a:e,b:t.o((t=>f(e,o.value.artist_highlight_images)),a),c:t.o((e=>(e=>{t.index.showModal({title:"提示",content:"确定要删除这张展示图吗？",success:a=>{a.confirm&&(o.value.artist_highlight_images.splice(e,1),t.index.showToast({title:"删除成功",icon:"success"}))}})})(a)),a),d:"4a33a18f-0-"+i,e:a}))),p:t.p({type:"trash",size:"24",color:"#ff4d6a"}),q:o.value.artist_highlight_images.length<9},o.value.artist_highlight_images.length<9?{r:t.p({type:"plus",size:"32",color:"#999"}),s:t.o(y)}:{},{t:r.value},r.value?{v:n.value,w:t.t(u.value)}:{},{x:o.value.rule_of_artist,y:t.o((t=>o.value.rule_of_artist=t.detail.value))}):{},{z:"hairstylist"===s.value},"hairstylist"===s.value?t.e({A:t.t(l.value[g.value].label),B:l.value,C:g.value,D:o.value.base_price_of_hairstylist,E:t.o((t=>o.value.base_price_of_hairstylist=t.detail.value)),F:o.value.overload_ratio_of_hairstylist,G:t.o((t=>o.value.overload_ratio_of_hairstylist=t.detail.value)),H:o.value.contact,I:t.o((t=>o.value.contact=t.detail.value)),J:t.f(o.value.hairstylist_highlight_images,((e,a,i)=>({a:e,b:t.o((t=>f(e,o.value.hairstylist_highlight_images)),a),c:t.o((e=>(e=>{t.index.showModal({title:"提示",content:"确定要删除这张展示图吗？",success:a=>{a.confirm&&(o.value.hairstylist_highlight_images.splice(e,1),t.index.showToast({title:"删除成功",icon:"success"}))}})})(a)),a),d:"4a33a18f-2-"+i,e:a}))),K:t.p({type:"trash",size:"24",color:"#ff4d6a"}),L:t.p({type:"plus",size:"24",color:"#fff"}),M:t.o(m),N:_.value},_.value?{O:h.value,P:t.t(c.value)}:{},{Q:o.value.rule_of_hairstylist,R:t.o((t=>o.value.rule_of_hairstylist=t.detail.value))}):{},{S:t.o(w)})}},s=t._export_sfc(i,[["__scopeId","data-v-4a33a18f"]]);wx.createPage(s);
