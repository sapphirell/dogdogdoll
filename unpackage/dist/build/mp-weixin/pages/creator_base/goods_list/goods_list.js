"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-load-more")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t={__name:"goods_list",setup(t){const o=e.ref([]),n=e.ref(!0),l=e.ref("more"),u=e.ref(null),i=e.ref(null),s=e.ref(1),r=e.ref({}),d=e.ref("all"),v=e.ref(0),c=e.ref(null),m=e.ref([]),_=e.ref(0),p=e.ref(!1),g=e.ref(!1),f=e.ref(0),h=e.ref(!1),b=e.ref(0),y=e.ref({"限量预定":"限量预定","限时预定":"限时预定","限时限量预定":"限时限量预定","限量现货":"限量现货","现货":"现货"}),x=e.ref(["限量预定","限时预定","限时限量预定","限量现货","现货"]),w=e=>{const a=e.detail.value;f.value=a,q.value.sale_type=x.value[a]},T=e.ref([{value:"CNY",text:"人民币 (CNY)"},{value:"USD",text:"美元 (USD)"},{value:"JPY",text:"日元 (JPY)"},{value:"KRW",text:"韩元 (KRW)"}]),S=e.ref(""),z=e.ref(""),$=e.ref(""),k=e.ref(""),U=e.ref(""),j=e.ref(""),q=e.ref({goods_id:0,sale_type:"",sub_amount:"",fin_amount:"",sub_date:"",sub_time:"",fin_date:"",fin_time:"",currency:"CNY"}),C=()=>{e.index.navigateTo({url:"/pages/creator_base/goods_editor/goods_editor"})},D=e.computed((()=>T.value.map((e=>e.text)))),M=e=>{d.value=e,s.value=1,o.value=[],F(1)},Y=()=>{c.value.close(),A()},A=()=>{q.value={},p.value=!1,g.value=!1,h.value=!1,S.value="",z.value="",$.value="",k.value="",U.value="",j.value=""},E=()=>{A()},N=()=>{q.value={goods_id:_.value,sale_type:"",sub_amount:"",fin_amount:"",sub_time:"",fin_time:"",currency:"CNY"},p.value=!0},P=e=>{const a=e.detail.value;b.value=a,q.value.currency=T.value[a].value},G=e=>{S.value=e.detail.value},I=e=>{z.value=e.detail.value},J=e=>{U.value=e.detail.value},K=e=>{j.value=e.detail.value},L=async()=>{try{if(!q.value.sale_type)return void e.index.showToast({title:"请选择贩售模式",icon:"none"});if(!q.value.sub_amount)return void e.index.showToast({title:"请输入定金金额",icon:"none"});if(!q.value.fin_amount)return void e.index.showToast({title:"请输入尾款金额",icon:"none"});if(!q.value.currency)return void e.index.showToast({title:"请选择币种",icon:"none"});if(!S.value||!z.value)return void e.index.showToast({title:"请选择完整的开始时间",icon:"none"});if(!U.value||!j.value)return void e.index.showToast({title:"请选择完整的预定/购买截止时间",icon:"none"});const t=`${S.value} ${z.value}`;q.value.sub_time=Math.floor(new Date(t).getTime()/1e3);const o=`${U.value} ${j.value}`;q.value.sub_time_end=Math.floor(new Date(o).getTime()/1e3);const n=e.index.getStorageSync("token"),l="POST",u=q.value.id?`${a.websiteUrl.value}/brand-manager/update-sales`:`${a.websiteUrl.value}/brand-manager/create-sales`,i={...q.value,sub_amount:parseInt(q.value.sub_amount),fin_amount:parseInt(q.value.fin_amount)},s=await e.index.request({url:u,method:l,header:{Authorization:n,"Content-Type":"application/json"},data:i});"success"===s.data.status?(e.index.showToast({title:"保存成功",icon:"success"}),await R(_.value),A()):e.index.showToast({title:s.data.msg||"保存失败",icon:"none"})}catch(t){console.error("保存贩售计划失败:",t),e.index.showToast({title:"保存失败",icon:"none"})}},R=async t=>{try{const o=e.index.getStorageSync("token"),n=await e.index.request({url:`${a.websiteUrl.value}/brand-manager/goods-sales`,method:"GET",header:{Authorization:o},data:{goods_id:t}});"success"===n.data.status?m.value=n.data.data||[]:(e.index.showToast({title:n.data.msg||"获取贩售计划失败",icon:"none"}),m.value=[])}catch(o){console.error("获取贩售计划失败:",o),m.value=[],e.index.showToast({title:"获取贩售计划失败",icon:"none"})}},W=e=>{if(!e)return"";return(e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`)(new Date(1e3*e))},B=e=>{if(!e)return"";const a=new Date(1e3*e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`},F=async(t=1)=>{try{t>1?l.value="loading":n.value=!0;const r=e.index.getStorageSync("token");if(!r)return u.value="未登录，请先登录",n.value=!1,void(l.value="more");const v=(await e.index.request({url:`${a.websiteUrl.value}/brand-manager/get-goods-list`,method:"GET",header:{Authorization:r},data:{page:t,page_size:10,type:"all"===d.value?"":d.value}})).data;if("success"===v.status){const e=v.data.goods_list||[];s.value=t,o.value=1===t?e:[...o.value,...e],i.value={page_index:v.data.page_index,page_size:v.data.page_size,total:v.data.total};const a=Math.ceil(i.value.total/i.value.page_size);l.value=i.value.page_index<a?"more":"noMore"}else u.value=v.msg||"获取商品列表失败",e.index.showToast({title:u.value,icon:"none"}),l.value="more"}catch(r){u.value="网络请求失败",console.error("获取商品列表失败:",r),e.index.showToast({title:"网络请求失败",icon:"none"}),l.value="more"}finally{n.value=!1}},H=()=>{"more"===l.value&&F(s.value+1)};return e.onShow((async()=>{e.index.setNavigationBarTitle({title:"作品管理"});if(!(await a.asyncGetUserInfo()))return e.index.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{e.index.reLaunch({url:"/pages/login/login"})}),1500);await(async()=>{try{const t=e.index.getStorageSync("token"),o=await e.index.request({url:`${a.websiteUrl.value}/brand-manager/get-goods-count`,method:"GET",header:{Authorization:t},data:{brand_id:1}});if("success"===o.data.status){let e=0;const a=o.data.data;for(const t in a)e+=a[t];r.value=a,v.value=e}else e.index.showToast({title:o.data.msg||"获取分类数量失败",icon:"none"})}catch(t){console.error("获取分类数量失败:",t),e.index.showToast({title:"获取分类数量失败",icon:"none"})}})(),F(1)})),(t,u)=>e.e({a:e.t(r.value.all||0),b:"all"===d.value?1:"",c:e.o((e=>M("all"))),d:"all"!==t.e_type},"all"!==t.e_type?{e:e.f(r.value,((a,t,o)=>({a:e.t(t),b:e.t(a),c:t,d:d.value===t?1:"",e:e.o((e=>M(t)),t)})))}:{},{f:n.value},n.value||0===o.value.length?{}:{h:e.f(o.value,((a,t,n)=>e.e({a:a.goods_images[0]||"/static/default-goods.png",b:e.t(a.name),c:a.is_hot},(a.is_hot,{}),{d:e.t(a.size||"无"),e:e.t(a.skin||"无"),f:e.t(a.total_amount),g:e.t(a.currency),h:"b98d0671-0-"+n,i:e.o((t=>{return o=a.id,void e.index.navigateTo({url:`/pages/goods/goods?goods_id=${o}`});var o}),a.id),j:"b98d0671-1-"+n,k:e.o((t=>{return o=a.id,void e.index.navigateTo({url:`/pages/creator_base/goods_editor/goods_editor?goods_id=${o}`});var o}),a.id),l:"b98d0671-2-"+n,m:e.o((t=>{return o=a.id,void e.index.navigateTo({url:`/pages/creator_base/collocation_list/collocation_list?goods_id=${o}`});var o}),a.id),n:"b98d0671-3-"+n,o:e.o((e=>(async e=>{_.value=e,await R(e),c.value.open()})(a.id)),a.id),p:a.id,q:t===o.value.length-1?1:""}))),i:e.p({type:"eye",size:"14",color:"#3a3a3a"}),j:e.p({type:"compose",size:"14",color:"#3a3a3a"}),k:e.p({type:"star",size:"14",color:"#3a3a3a"}),l:e.p({type:"shop",size:"14",color:"#3a3a3a"}),m:e.p({status:l.value,contentText:{contentdown:"上拉加载更多",contentrefresh:"正在加载...",contentnomore:"没有更多了"}}),n:e.o(H)},{g:0===o.value.length,o:e.o(Y),p:e.p({type:"close",size:"20",color:"#999"}),q:m.value.length>0},m.value.length>0?{r:e.f(m.value,((t,o,n)=>({a:e.t(y.value[t.sale_type]||t.sale_type),b:e.t(B(t.sub_time)),c:e.t(W(t.sub_time)),d:e.t(B(t.sub_time_end)),e:e.t(W(t.sub_time_end)),f:e.t(t.sub_amount),g:e.t(t.fin_amount),h:e.o((e=>(e=>{q.value={...e},e.sub_time&&e.sub_time>0?(S.value=B(e.sub_time),z.value=W(e.sub_time)):(S.value="",z.value=""),e.sub_time_end&&e.sub_time_end>0?(U.value=B(e.sub_time_end),j.value=W(e.sub_time_end)):(U.value="",j.value=""),p.value=!0})(t)),t.id),i:"b98d0671-7-"+n+",b98d0671-5",j:e.o((o=>(async t=>{e.index.showModal({title:"删除确认",content:"确定要删除这条贩售计划吗？",success:async o=>{if(o.confirm)try{const o=e.index.getStorageSync("token"),n=await e.index.request({url:`${a.websiteUrl.value}/brand-manager/sale`,method:"DELETE",header:{Authorization:o},data:{id:t}});"success"===n.data.status?(e.index.showToast({title:"删除成功",icon:"success"}),await R(_.value)):e.index.showToast({title:n.data.msg||"删除失败",icon:"none"})}catch(n){console.error("删除贩售计划失败:",n),e.index.showToast({title:"删除失败",icon:"none"})}}})})(t.id)),t.id),k:"b98d0671-8-"+n+",b98d0671-5",l:t.id}))),s:e.p({type:"compose",size:"18",color:"#666"}),t:e.p({type:"trash",size:"18",color:"#f56c6c"})}:{},{v:e.p({type:"plus",size:"16",color:"#fff"}),w:e.o(N),x:p.value},p.value?{y:e.t(y.value[q.value.sale_type]||"请选择贩售模式"),z:x.value,A:f.value,B:e.o(w),C:q.value.sub_amount,D:e.o((e=>q.value.sub_amount=e.detail.value)),E:q.value.fin_amount,F:e.o((e=>q.value.fin_amount=e.detail.value)),G:e.t(S.value||"选择日期"),H:S.value,I:e.o(G),J:e.t(z.value||"选择时间"),K:z.value,L:e.o(I),M:e.t(U.value||"选择日期"),N:U.value,O:e.o(J),P:e.t(j.value||"选择时间"),Q:j.value,R:e.o(K),S:e.t(q.value.currency||"请选择币种"),T:D.value,U:b.value,V:e.o(P),W:e.o(E),X:e.o(L)}:{},{Y:e.sr(c,"b98d0671-5",{k:"salesPopup"}),Z:e.p({type:"bottom","background-color":"#fff"}),aa:e.p({type:"plusempty",size:"30",color:"#fff"}),ab:e.o(C)})}},o=e._export_sfc(t,[["__scopeId","data-v-b98d0671"]]);wx.createPage(o);
