"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/config.js"),t=require("../../../common/image.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const i={__name:"set_showcase",setup(i){const s=e.ref("highlight"),r=e.ref({artist_id:0,brand_id:0,brand_name:"",description:"",logo_image:"",artist_highlight_images:[],status_of_artist:0,status_of_artist_text:"",status_of_hairstylist:0,status_of_hairstylist_text:""}),o=e.ref([]),n=e.ref(1),l=e.ref(20),u=e.ref(!0),c=e.ref(0),d=e.ref(!1),g=e.ref(0),h=e.ref(""),_=e=>{s.value=e,"faceup"===e&&0===o.value.length&&f()},v=async()=>{try{const t=await e.index.request({url:`${a.websiteUrl.value}/brand-manager/get-artist-info`,method:"GET",header:{Authorization:`${e.index.getStorageSync("token")}`}});if("success"===t.data.status&&t.data.data){const e=t.data.data;r.value={...r.value,brand_id:e.brand_id,artist_highlight_images:e.artist_highlight_images||[]},c.value=e.brand_id}else e.index.showToast({title:"获取艺术家信息失败",icon:"none"})}catch(t){e.index.showToast({title:"网络错误",icon:"none"})}},f=async()=>{if(c.value)try{const t=await e.index.request({url:`${a.websiteUrl.value}/brand-artist/bjd-faceup?brand_id=${c.value}&page=${n.value}&size=${l.value}`,method:"GET"});if("success"===t.data.status){const e=t.data.data.list.map((e=>({...e,image_urls:Array.isArray(e.image_urls)?e.image_urls:(e.image_urls||"").split(",")})));1===n.value?o.value=e:o.value=[...o.value,...e],u.value=o.value.length<t.data.data.total}else e.index.showToast({title:"获取妆图列表失败",icon:"none"})}catch(t){e.index.showToast({title:"网络错误",icon:"none"})}else console.log("无Brand_id")},m=async()=>{try{const a=await t.chooseImageList(1);if(!a||0===a.length)return;d.value=!0,h.value="准备上传...",h.value="获取上传凭证...";const i=await t.getQiniuToken();if(!i||!i.token)throw new Error("获取上传凭证失败");const s=a[0];h.value="上传中...",g.value=50;const o=i.path,n=await t.uploadImageToQiniu(s,i.token,o);n&&n.imageUrl&&(r.value.artist_highlight_images.push(n.imageUrl),g.value=100,await p(),e.index.showToast({title:"上传成功",icon:"success"}))}catch(a){console.error("上传图片失败:",a),e.index.showToast({title:"上传图片失败",icon:"none"})}finally{d.value=!1,g.value=0}},p=async()=>{try{const t=await e.index.request({url:`${a.websiteUrl.value}/brand-manager/update-highlight-images`,method:"POST",data:{brand_id:r.value.brand_id,artist_highlight_images:r.value.artist_highlight_images.join(",")},header:{Authorization:`${e.index.getStorageSync("token")}`}});"success"!==t.data.status&&console.error("更新展示图失败:",t.data.msg),v()}catch(t){console.error("更新展示图失败:",t)}},w=e=>{const a=new Date(e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`},x=()=>{e.index.navigateTo({url:"/pages/creator_base/faceup_editor/faceup_editor"})};return e.onMounted((()=>{e.index.setNavigationBarTitle({title:"作品展示设置"}),v()})),(a,t)=>e.e({a:"highlight"===s.value?1:"",b:e.o((e=>_("highlight"))),c:"faceup"===s.value?1:"",d:e.o((e=>_("faceup"))),e:"highlight"===s.value},"highlight"===s.value?e.e({f:e.f(r.value.artist_highlight_images,((a,t,i)=>({a:a,b:e.o((t=>{return i=a,void e.index.previewImage({current:i,urls:r.value.artist_highlight_images});var i}),t),c:e.o((a=>(async a=>{e.index.showModal({title:"提示",content:"确定要删除这张展示图吗？",success:async t=>{t.confirm&&(r.value.artist_highlight_images.splice(a,1),await p(),e.index.showToast({title:"删除成功",icon:"success"}))}})})(t)),t),d:"5c83d6a7-0-"+i,e:t}))),g:e.p({type:"trash",size:"24",color:"#ff4d6a"}),h:e.p({type:"plus",size:"24",color:"#fff"}),i:e.o(m),j:d.value},d.value?{k:g.value,l:e.t(h.value)}:{}):{m:e.f(o.value,((a,t,i)=>({a:a.image_urls[0],b:e.t(a.head_name),c:e.f(a.style_tags,((a,t,i)=>({a:e.t(a),b:t}))),d:e.t(a.sex),e:e.n("男"===a.sex?"male":"female"),f:e.t(w(a.created_at)),g:"5c83d6a7-2-"+i,h:a.id,i:e.o((t=>{return i=a.id,void e.index.navigateTo({url:`/pages/creator_base/faceup_editor/faceup_editor?id=${i}`});var i}),a.id)}))),n:e.p({type:"arrowright",size:"20",color:"#999"}),o:e.p({type:"plus",size:"24",color:"#fff"}),p:e.o(x)})}},s=e._export_sfc(i,[["__scopeId","data-v-5c83d6a7"]]);wx.createPage(s);
