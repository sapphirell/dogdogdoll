"use strict";const e=require("../../common/vendor.js"),a=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("comment-list")+e.resolveComponent("comment-input"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/comment-list/comment-list.js")+(()=>"../../components/comment-input/comment-input.js"))();const t={__name:"artwork",setup(t){const n=e.ref({id:0,title:"",head_name:"",faceup_tag_content:[],sex:0,created_at:0,brand_id:0,art_type:1,goods_id:0,images:[],like_count:0}),o=e.ref(null),u=e.ref(null),l=e.ref(!0),i=e.ref(!1),s=e.ref(""),r=e.ref(!1),d=e.ref(0),v=e.ref(8),c=e.ref(null),m=e.ref(null),_=e.ref({});function p(e){if(!e)return"";const a=new Date(1e3*e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`}const g=async t=>{try{const n=await e.index.request({url:a.websiteUrl.value+`/goods?id=${t}`,method:"GET"});"success"===n.data.status&&(o.value=n.data.data)}catch(n){console.error("获取商品信息失败:",n)}},f=async t=>{try{const n=await e.index.request({url:a.websiteUrl.value+`/brand-info?id=${t}`,method:"GET"});"success"===n.data.status&&(u.value=n.data.data)}catch(n){console.error("获取品牌信息失败:",n)}},y=a=>{i.value=!0,s.value=a,e.index.showToast({title:a,icon:"none"})};const h=({parent:e,target:a})=>{var t;let n=e;null!=a&&(n=a),_.value.id!=n.id?(_.value=n,null==(t=m.value)||t.focusInput()):_.value={}},w=t=>{var n,o,u;let l=e.index.getStorageSync("token");if(!a.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});const i={content:t.content,origin:t.origin,target_id:parseInt(d.value),type:8,image_url:t.image_url||"",association_id:t.association_id||0,association_type:t.association_type||0,is_anonymous:t.is_anonymous||0,..._.value.id&&{reply_id:_.value.id,reply_for:_.value.comment,reply_uid:_.value.user_id,parent_id:_.value.parent_id>0?_.value.parent_id:_.value.id}},s={id:Date.now(),content:t.content,created_at:Math.floor(Date.now()/1e3),like_count:0,reply_count:0,is_liked:!1,floor:0,...t.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:a.global.userInfo.avatar,username:a.global.userInfo.nickname,is_anonymous:0},...t.image_url&&{image_url:t.image_url},..._.value.id&&{reply_id:_.value.id,reply_for:_.value.comment,reply_uid:_.value.user_id,parent_id:_.value.parent_id>0?_.value.parent_id:_.value.id,reply_username:_.value.is_anonymous?"匿名用户":_.value.username}};_.value.id?0===_.value.parent_id?null==(o=c.value)||o.addReplyComment({...s,parent_id:_.value.id}):null==(u=c.value)||u.addReplyComment({...s,parent_id:_.value.parent_id}):null==(n=c.value)||n.addNewComment(s),e.index.request({url:a.websiteUrl.value+"/with-state/add-comment",method:"POST",header:{Authorization:l},data:i,success:n=>{var o,u;if("success"==n.data.status){const u=n.data.data,l={...u,...t.is_anonymous?{avatar:"https://images1.fantuanpu.com/home/default_avatar.jpg",username:"匿名用户",is_anonymous:1}:{avatar:a.global.userInfo.avatar,username:a.global.userInfo.nickname,is_anonymous:0}};u.reply_uid&&_.value.is_anonymous&&(l.reply_username="匿名用户"),null==(o=c.value)||o.updateTempComment(s.id,l),e.index.showToast({title:"评论成功",icon:"success"})}else null==(u=c.value)||u.removeTempComment(s.id),e.index.showToast({title:n.data.msg,icon:"none"})},fail:a=>{var t;null==(t=c.value)||t.removeTempComment(s.id),e.index.showToast({title:"网络请求失败",icon:"none"})}})};return e.onLoad((t=>{t.id?(d.value=t.id,(async t=>{try{l.value=!0;const o=await e.index.request({url:a.websiteUrl.value+`/faceup/detail?id=${t}`});if("success"!==o.data.status)return void y(o.data.msg||"数据加载失败");n.value=o.data.data,Array.isArray(n.value.images)||(n.value.images=n.value.face_up_image_urls?n.value.face_up_image_urls.split(","):[]),n.value.goods_id&&g(n.value.goods_id),n.value.brand_id&&f(n.value.brand_id)}catch(o){console.error("获取作品详情失败:",o),y("数据加载失败")}finally{l.value=!1}})(t.id),a.asyncGetUserInfo().then((()=>{!function(){let t=e.index.getStorageSync("token");t&&e.index.request({url:a.websiteUrl.value+"/with-state/hasLike?id="+d.value+"&type=7",method:"POST",header:{Authorization:t},success:e=>{"success"==e.data.status&&(r.value=e.data.data.id>0)}})}()}))):y("缺少必要参数")})),(t,g)=>{var f,y,b,x,k;return e.e({a:!r.value},r.value?{c:e.p({type:"heart-filled",size:"28",color:"#ff4d4f"})}:{b:e.p({type:"heart",size:"28",color:"#ff4d4f"})},{d:e.t((null==(f=n.value)?void 0:f.like_count)?(k=n.value.like_count,k?k<1e3?k.toString():`${Math.floor(k/1e3)}k+`:"0"):0),e:e.o((t=>function(){let t=e.index.getStorageSync("token");if(!a.global.isLogin)return void e.index.showToast({title:"请先登录",icon:"none"});const o={id:parseInt(d.value),type:7};let u=r.value?"/with-state/unlike":"/with-state/add-like";e.index.request({url:a.websiteUrl.value+u,method:"POST",header:{Authorization:t},data:o,success:a=>{"success"==a.data.status?(e.index.showToast({title:r.value?"取消点赞":"点赞成功",icon:"success"}),r.value=!r.value,r.value?n.value.like_count+=1:n.value.like_count-=1):e.index.showToast({title:a.data.msg||"操作失败",icon:"none"})},fail:a=>{console.log(a),e.index.showToast({title:"网络请求失败",icon:"none"})}})}())),f:e.f(n.value.images,((a,t,o)=>({a:a,b:e.o((a=>function(a){e.index.previewImage({current:n.value.images[a],urls:n.value.images})}(t)),t),c:t}))),g:u.value},u.value?{h:u.value.logo_image,i:e.t(u.value.brand_name),j:e.t(p(n.value.created_at)),k:e.o((a=>{return t=n.value.brand_id,void e.index.navigateTo({url:`/pages/brand/brand?brand_id=${t}`});var t}))}:{},{l:e.t(n.value.title),m:e.t(n.value.head_name),n:e.t((x=n.value.sex,{0:"未知",1:"男",2:"女"}[x]||"未知")),o:e.t((b=n.value.art_type,{1:"妆师",2:"毛娘"}[b]||"未知类型")),p:n.value.faceup_tag_content&&n.value.faceup_tag_content.length},n.value.faceup_tag_content&&n.value.faceup_tag_content.length?{q:e.f(n.value.faceup_tag_content,((a,t,n)=>({a:e.t(a),b:t})))}:{},{r:n.value.goods_id&&o.value},n.value.goods_id&&o.value?{s:(null==(y=o.value.goods_images)?void 0:y[0])||"/static/goods-default.png",t:e.t(o.value.name),v:e.t(o.value.brand_name),w:e.o((a=>{return t=n.value.goods_id,void e.index.navigateTo({url:`/pages/goods/goods?goods_id=${t}`});var t}))}:{},{x:e.sr(c,"9b227152-2",{k:"commentListRef"}),y:e.o(h),z:e.p({type:v.value,"relation-id":parseInt(d.value)}),A:e.sr(m,"9b227152-3",{k:"commentInputRef"}),B:e.o(w),C:e.o((e=>_.value=e)),D:e.p({"reply-info":_.value,"target-id":d.value}),E:l.value},(l.value,{}),{F:i.value},i.value?{G:e.t(s.value)}:{})}}},n=e._export_sfc(t,[["__scopeId","data-v-9b227152"]]);wx.createPage(n);
