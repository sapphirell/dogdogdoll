"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),a=require("../../common/config.js"),n=require("../../common/image.js");if(!Array){(e.resolveComponent("relation-picker")+e.resolveComponent("common-page"))()}Math||((()=>"../../components/relation-picker/relation-picker.js")+(()=>"../../components/common-page/common-page.js"))();const t={__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(t){const i=t,s=e.ref([]),d=e.ref([]),l=e.ref([]),r=e.ref(!1);e.ref(""),e.ref(0),e.ref(""),e.ref(0),e.ref("");const c=e=>{console.log("收到选择数据:",e),m.value.push({brand_id:e.brand_id,goods_id:e.goods.id,brand_name:e.brand.name,goods_name:e.goods.name,goods_image:e.goods.image,type:e.type})},u=()=>{console.log("用户取消选择")},g=()=>{r.value=!0};const m=e.ref([]);var _;i.goods_id&&i.goods_name&&i.brand_id&&i.brand_name&&i.type&&(_=i.goods_id,new Promise(((o,n)=>{e.index.request({url:a.websiteUrl+"/goods?id="+_,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),o(e.data)},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"}),n(o)},complete:()=>{e.index.hideLoading()}})}))).then((e=>{let o={brand_id:parseInt(i.brand_id,10),goods_id:parseInt(i.goods_id,10),brand_name:i.brand_name,goods_name:i.goods_name,goods_image:e.data.goods_images[0],type:i.type};console.log(o),m.value.push(o)}));const p=e.ref(""),v=e.ref("");function f(o){e.index.previewImage({current:s.value[o],urls:s.value})}function h(){const o=e.index.getStorageSync("token");if(!o)return void e.index.showToast({title:"请先登录",icon:"none"});if(!p.value.trim())return void e.index.showToast({title:"标题不能为空",icon:"none"});if(0===s.value.length)return void e.index.showToast({title:"请至少上传一张图片",icon:"none"});let n=a.getScene();const t={title:p.value,content:v.value,image_url_list:s.value,scene:n,relation_data_list:m.value.map((e=>({goods_id:e.goods_id,goods_name:e.goods_name,brand_id:e.brand_id,brand_name:e.brand_name,type:e.type})))};console.log(t),e.index.request({url:a.websiteUrl+"/with-state/add-collocation",method:"POST",data:t,header:{"Content-Type":"application/json",Authorization:o},timeout:5e3,success:o=>{"success"===o.data.status?(e.index.showToast({title:"提交成功"}),p.value="",v.value="",s.value=[],m.value=[],e.index.navigateBack()):e.index.showToast({title:o.data.msg||"提交失败",icon:"none"})},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}return e.index.request({url:a.websiteUrl+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),l.value=e.data.data},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}}),(t,i)=>({a:e.f(s.value,((o,a,n)=>({a:o,b:e.o(f,a),c:e.o((e=>function(e){s.value.splice(e,1)}(a)),a),d:a}))),b:o._imports_1$6,c:o._imports_1$5,d:e.o((o=>async function(){try{const o=await n.chooseImageList(9);for(const e of o){const o=await n.getQiniuToken();await n.uploadImageToQiniu(e,o.token,o.path),s.value.push(a.image1Url+o.path)}e.index.showToast({title:`成功上传${o.length}张图片`,icon:"success"})}catch(o){console.error("上传出错:",o),e.index.showToast({title:"部分图片上传失败",icon:"none"})}}(t.index))),e:p.value,f:e.o((e=>p.value=e.detail.value)),g:v.value,h:e.o((e=>v.value=e.detail.value)),i:o._imports_2$3,j:e.o(g),k:e.f(m.value,((o,a,n)=>e.e({a:o.goods_image},o.goods_image?{b:o.goods_image}:{},{c:e.t(o.type),d:e.t(o.brand_name),e:e.t(o.goods_name),f:e.o((e=>function(e){m.value.splice(e,1)}(a)),a),g:a}))),l:o._imports_1$6,m:e.o(c),n:e.o(u),o:e.o((e=>r.value=e)),p:e.p({typeList:l.value,goodsList:d.value,visible:r.value}),q:e.o(h)})}};wx.createPage(t);
