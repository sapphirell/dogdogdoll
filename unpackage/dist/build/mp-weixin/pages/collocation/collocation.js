"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),a=require("../../common/config.js"),n=require("../../common/image.js");if(!Array){(e.resolveComponent("common-name-picker")+e.resolveComponent("common-search")+e.resolveComponent("custom-picker")+e.resolveComponent("common-modal")+e.resolveComponent("common-page"))()}Math||((()=>"../../components/common-name-picker/common-name-picker.js")+(()=>"../../components/common-search/common-search.js")+(()=>"../../components/custom-picker/custom-picker.js")+(()=>"../../components/common-modal/common-modal.js")+(()=>"../../components/common-page/common-page.js"))();const t={__name:"collocation",props:["goods_id","goods_name","brand_id","brand_name","type"],setup(t){const s=t,l=e.ref([]),i=e.ref([]),d=e.ref([]),u=e.ref(!1),c=e.ref(""),m=e.ref(0),r=e.ref(""),v=e.ref(0),g=e.ref("");function p(o){return new Promise(((n,t)=>{e.index.request({url:a.websiteUrl+"/goods?id="+o,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),n(e.data)},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"}),t(o)},complete:()=>{e.index.hideLoading()}})}))}const _=e.ref([]);s.goods_id&&s.goods_name&&s.brand_id&&s.brand_name&&s.type&&p(s.goods_id).then((e=>{let o={brand_id:parseInt(s.brand_id,10),goods_id:parseInt(s.goods_id,10),brand_name:s.brand_name,goods_name:s.goods_name,goods_image:e.data.goods_images[0],type:s.type};console.log(o),_.value.push(o)}));const h=e.ref(""),f=e.ref("");function x(o){e.index.previewImage({current:l.value[o],urls:l.value})}function b(){const o=e.index.getStorageSync("token");if(!o)return void e.index.showToast({title:"请先登录",icon:"none"});if(!h.value.trim()||!f.value.trim())return void e.index.showToast({title:"标题和正文不能为空",icon:"none"});if(0===l.value.length)return void e.index.showToast({title:"请至少上传一张图片",icon:"none"});let n=a.getScene();const t={title:h.value,content:f.value,image_url_list:l.value,scene:n,relation_data_list:_.value.map((e=>({goods_id:e.goods_id,goods_name:e.goods_name,brand_id:e.brand_id,brand_name:e.brand_name,type:e.type})))};console.log(t),e.index.request({url:a.websiteUrl+"/with-state/add-collocation",method:"POST",data:t,header:{"Content-Type":"application/json",Authorization:o},timeout:5e3,success:o=>{200===o.data.code?(e.index.showToast({title:"提交成功"}),h.value="",f.value="",l.value=[],_.value=[],e.index.navigateBack()):e.index.showToast({title:o.data.msg||"提交失败",icon:"none"})},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function w(o,n){var t;console.log("收到品牌ID:",o),console.log("收到品牌Name:",n),m.value=parseInt(o,10),c.value=n,t=o,e.index.request({url:a.websiteUrl+"/goods-name-list?id="+t,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),i.value=e.data.data,console.log(i.value)},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}function T(e,o){console.log("选中的 id:",e),console.log("选中的 name:",o),v.value=parseInt(e,10),r.value=o}function y(e){console.log("选中的值:",e),g.value=e,u.value=!0}function j(){if(""!=c.value)if(""!=r.value){if(0==v.value){let e={brand_id:m.value,goods_id:0,brand_name:c.value,goods_name:r.value,goods_image:"",type:g.value};return _.value.push(e),u.value=!1,m.value=0,c.value="",v.value=0,r.value="",void(g.value="")}p(v.value).then((e=>{let o={brand_id:m.value,goods_id:v.value,brand_name:c.value,goods_name:r.value,goods_image:e.data.goods_images[0],type:g.value};_.value.push(o),u.value=!1,m.value=0,c.value="",v.value=0,r.value="",g.value=""}))}else e.index.showToast({title:"请选择或填写商品名称",icon:"none"});else e.index.showToast({title:"请选择或填写品牌名称",icon:"none"})}return e.index.request({url:a.websiteUrl+"/goods-types",method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),d.value=e.data.data},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}}),(t,s)=>({a:e.f(l.value,((o,a,n)=>({a:o,b:e.o(x,a),c:e.o((e=>function(e){l.value.splice(e,1)}(a)),a),d:a}))),b:o._imports_1$6,c:o._imports_1$5,d:e.o((o=>(t.index,console.log("openSelect"),void n.chooseImage().then((o=>{n.getQiniuToken().then((t=>{console.log(t),n.uploadImageToQiniu(o,t.token,t.path).then((o=>{200!=o.statusCode&&e.index.showToast({title:"上传失败",icon:"none"}),console.log(a.image1Url+t.path),l.value.push(a.image1Url+t.path),e.index.showToast({title:"上传成功",icon:"success"})}))}))}))))),e:h.value,f:e.o((e=>h.value=e.detail.value)),g:f.value,h:e.o((e=>f.value=e.detail.value)),i:e.o(y),j:e.p({dataList:d.value,placeholder:"关联娃物"}),k:o._imports_2$3,l:e.f(_.value,((o,a,n)=>e.e({a:o.goods_image},o.goods_image?{b:o.goods_image}:{},{c:e.t(o.type),d:e.t(o.brand_name),e:e.t(o.goods_name),f:e.o((e=>function(e){_.value.splice(e,1)}(a)),a),g:a}))),m:o._imports_1$6,n:e.o(w),o:e.p({mode:"fill",width:"calc(100vw - 120px)"}),p:e.o(T),q:e.p({dataList:i.value,margin:"10px 0 0 0px"}),r:e.o(j),s:e.o((e=>u.value=e)),t:e.p({visible:u.value}),v:e.o(b)})}};wx.createPage(t);
