"use strict";const e=require("../../common/vendor.js"),a=require("../../common/config.js");if(!Array){e.resolveComponent("view-logs")()}Math;const o={__name:"register",setup(o){const s=e.ref({telephone:"",code:"",password:"",rePassword:""}),l=e.ref({phone:"",code:"",password:"",rePassword:""}),t=e.ref(0),u=e.computed((()=>t.value>0)),n=e.computed((()=>t.value>0?`${t.value}秒后重发`:"获取验证码")),r=e.ref(!1),d=()=>s.value.telephone?/^1[3-9]\d{9}$/.test(s.value.telephone)?(l.value.phone="",!0):(l.value.phone="手机号格式不正确",!1):(l.value.phone="手机号不能为空",!1),v=async()=>{if(d())try{const o=await e.index.request({url:`${a.websiteUrl.value}/send-sms-code`,method:"POST",data:{tel_phone:s.value.telephone}});"success"===o.data.status?(c(),e.index.showToast({title:"验证码已发送",icon:"none"})):e.index.showToast({title:o.data.msg||"发送失败",icon:"none"})}catch(o){e.index.showToast({title:"网络请求失败",icon:"none"})}},c=()=>{t.value=60;const e=setInterval((()=>{t.value<=0?clearInterval(e):t.value--}),1e3)},i=()=>s.value.password.length<6?(l.value.password="密码至少需要6位",!1):(l.value.password="",!0),p=()=>s.value.password!==s.value.rePassword?(l.value.rePassword="两次密码输入不一致",!1):(l.value.rePassword="",!0),w=()=>s.value.code?6!==s.value.code.length?(l.value.code="验证码格式不正确",!1):(l.value.code="",!0):(l.value.code="验证码不能为空",!1),h=async()=>{if([d(),w(),i(),p()].every((e=>e)))try{r.value=!0;const o=await e.index.request({url:`${a.websiteUrl.value}/register`,method:"POST",data:{telephone:s.value.telephone,code:s.value.code,password:s.value.password,re_password:s.value.rePassword}});"success"===o.data.status?(e.index.setStorageSync("token",o.data.data.jwt_token),e.index.showToast({title:"注册成功",icon:"success",complete:()=>{setTimeout((()=>{e.index.switchTab({url:"/pages/mine/mine"})}),1500)}})):e.index.showToast({title:o.data.msg||"注册失败",icon:"none"})}catch(o){e.index.showToast({title:"网络请求失败",icon:"none"})}finally{r.value=!1}},m=()=>{e.index.navigateTo({url:"/pages/login/login"})};return(a,o)=>e.e({a:e.o(d),b:s.value.telephone,c:e.o((e=>s.value.telephone=e.detail.value)),d:l.value.phone},l.value.phone?{e:e.t(l.value.phone)}:{},{f:e.o(w),g:s.value.code,h:e.o((e=>s.value.code=e.detail.value)),i:e.t(n.value),j:u.value,k:e.o(v),l:u.value?1:"",m:l.value.code},l.value.code?{n:e.t(l.value.code)}:{},{o:e.o(i),p:s.value.password,q:e.o((e=>s.value.password=e.detail.value)),r:l.value.password},l.value.password?{s:e.t(l.value.password)}:{},{t:e.o(p),v:s.value.rePassword,w:e.o((e=>s.value.rePassword=e.detail.value)),x:l.value.rePassword},l.value.rePassword?{y:e.t(l.value.rePassword)}:{},{z:e.t(r.value?"注册中...":"立即注册"),A:r.value,B:e.o(h),C:r.value?1:"",D:e.o(m)})}},s=e._export_sfc(o,[["__scopeId","data-v-2c7e0c3f"]]);wx.createPage(s);
