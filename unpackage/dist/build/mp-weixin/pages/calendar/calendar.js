"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a=require("../../common/config.js");if(!Array){(e.resolveComponent("view-logs")+e.resolveComponent("uni-icons")+e.resolveComponent("loading-toast")+e.resolveComponent("common-page"))()}Math||((()=>"../../components/view-logs/view-logs.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/loading-toast/loading-toast.js")+(()=>"../../components/common-page/common-page.js"))();const n={__name:"calendar",setup(n){const o=e.ref("sale"),s=e.ref(["全部","整体","单头","单体","娃衣","眼珠","娃鞋","手型","脚型","袜子","配饰"]),r=e.ref(["全部尺寸","四分","六分","三分","其它大尺寸","八分","十二分","一分","二分","五分","棉花娃","眼珠"]);let i=e.ref("全部"),l=e.ref("全部尺寸");const u=e.ref({}),d=e.ref({}),c=e.ref({}),v=e.ref({}),f=new Date,g=f.getFullYear(),p=String(f.getMonth()+1).padStart(2,"0"),_=String(f.getDate()).padStart(2,"0"),m=e.ref(`${g}-${p}-${_}`);e.ref(null);const h=e.index.getSystemInfoSync().screenWidth/7;let b=e.ref(0),y=e.ref(m.value),w=e.ref({}),k=e.ref(!0);const x=e.computed((()=>"sale"===o.value?S.value:d.value)),j=e=>{const t=M(e);if(!t||0===t.length)return"待定";const a=t.map((e=>parseFloat(e.price))).filter((e=>!isNaN(e)));if(0===a.length)return"待定";const n=Math.min(...a),o=Math.max(...a);return n===o?`${n}元`:`${n}-${o}元`},z=e=>{o.value!==e&&(o.value=e,y.value=m.value,"makeup"===e&&0===Object.keys(d.value).length?D():O())},S=e.computed((()=>{const e={};return Object.entries(u.value).forEach((([t,a])=>{const n={...a};n.goods&&(n.goods=n.goods.filter((e=>{const t="全部"===i.value||e.type===i.value;let a="全部尺寸"===l.value;return!a&&e.sizes&&e.sizes.length>0?a=e.sizes.some((e=>e.goods_size===l.value)):a||(a=e.size===l.value),t&&a})),n.goods_number=n.goods.length,0===n.goods.length&&(n.goods=null)),e[t]=n})),e})),$=()=>{k.value=!0,e.index.request({url:a.websiteUrl.value+"/goods-news",method:"GET",timeout:5e3,success:e=>{u.value=e.data.data,w.value=u.value[m.value]||{goods:null}},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{b.value=7*h-5,k.value=!1}})},D=()=>{k.value=!0,e.index.request({url:a.websiteUrl.value+"/bjd-makeup-news",method:"GET",timeout:5e3,success:e=>{d.value=e.data.data,w.value=d.value[m.value]||{plans:null}},fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{k.value=!1}})};function q(e){return e===m.value}const T=e=>{if(!e||0===e.length)return[];const t={};return e.forEach((e=>{const a=e.goods_size;t[a]||(t[a]=[]),e.size_detail&&t[a].push(e.size_detail)})),Object.keys(t).map((e=>({category:e,details:t[e]})))};function O(){const e=x.value;if(e[y.value])return void(w.value=e[y.value]);const t=Object.entries(e).find((([e,t])=>"sale"===o.value&&t.goods||"makeup"===o.value&&t.plans));t?(y.value=t[0],w.value=t[1]):w.value="sale"===o.value?{goods:null}:{plans:null}}function I(e){const t=new Date(1e3*e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}const M=e=>{try{return JSON.parse(e.order_config).tiers||[]}catch{return[]}},C=e=>{try{return JSON.parse(e.order_config).addons||[]}catch{return[]}};return e.watch([S,d],(()=>{O()})),e.onLoad((()=>{$(),c.value={938:"小圆点儿工作室"}})),e.onPullDownRefresh((async()=>{try{"sale"===o.value?$():D(),e.index.stopPullDownRefresh()}catch(t){e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新失败",icon:"none"})}})),(n,u)=>e.e({a:"sale"===o.value},(o.value,{}),{b:"sale"===o.value?1:"",c:e.o((e=>z("sale"))),d:"makeup"===o.value},(o.value,{}),{e:"makeup"===o.value?1:"",f:e.o((e=>z("makeup"))),g:"sale"===o.value},"sale"===o.value?{h:e.f(s.value,((t,a,n)=>({a:e.t(t),b:a,c:e.unref(i)===t?1:"",d:e.o((e=>{return a=t,void(i.value=a);var a}),a)})))}:{},{i:"sale"===o.value},"sale"===o.value?{j:e.f(r.value,((t,a,n)=>({a:e.t(t),b:a,c:e.unref(l)===t?1:"",d:e.o((e=>{return a=t,void(l.value=a);var a}),a)})))}:{},{k:"makeup"===o.value},(o.value,{}),{l:e.f(x.value,((t,a,n)=>e.e({a:"sale"===o.value&&t.goods_number>0},"sale"===o.value&&t.goods_number>0?{b:e.t(t.goods_number)}:"makeup"===o.value&&t.plans_number>0?{d:e.t(t.plans_number)}:{},{c:"makeup"===o.value&&t.plans_number>0,e:e.t(t.weekday),f:"周日"===t.weekday||"周六"===t.weekday?1:"",g:e.t(q(a)?"今天":t.day_number),h:e.unref(y)===a?1:"",i:a,j:e.o((e=>function(e,t){y.value=e,w.value=t}(a,t)),a)}))),m:e.unref(b),n:"sale"===o.value},"sale"===o.value?e.e({o:e.t(e.unref(y)),p:e.t(e.unref(w).weekday),q:null==e.unref(w).goods},null==e.unref(w).goods?{r:t._imports_0$6}:{s:e.f(e.unref(w).goods,((t,n,o)=>e.e({a:t.goods_image,b:e.t(t.type),c:e.t(t.sale_type),d:1==t.is_first_sale_day},(t.is_first_sale_day,{}),{e:e.t(t.brand_name),f:e.t(t.goods_name),g:t.sizes&&t.sizes.length>0},t.sizes&&t.sizes.length>0?{h:e.f(T(t.sizes),((t,a,n)=>({a:e.t(t.category),b:e.t(t.details.join("、")),c:a})))}:{i:e.t(t.size),j:e.t(t.size_detail)},{k:e.t(I(t.sub_time)),l:t.sub_time_end},t.sub_time_end?{m:e.t(I(t.sub_time_end))}:{},{n:"限量现货"!=t.sale_type&&"不限量现货"!=t.sale_type},"限量现货"!=t.sale_type&&"不限量现货"!=t.sale_type?{o:e.t(t.sub_amount),p:e.t(t.currency),q:e.t(t.fin_amount)}:{r:e.t(t.sub_amount+t.fin_amount),s:e.t(t.currency)},{t:t.id,v:e.o((n=>{return o=t.id,s=t.goods_id,e.index.request({url:a.websiteUrl.value+"/sale-record-click?id="+o,method:"POST",header:{"Content-Type":"application/json"},success:()=>console.log("点击记录成功"),fail:e=>console.error("点击记录失败:",e)}),void e.index.navigateTo({url:"/pages/goods/goods?goods_id="+s});var o,s}),t.id)})))}):e.e({t:e.t(e.unref(y)),v:e.t(e.unref(w).weekday),w:null==e.unref(w).plans||0===e.unref(w).plans.length},null==e.unref(w).plans||0===e.unref(w).plans.length?{x:t._imports_0$6}:{y:e.f(e.unref(w).plans,((t,a,n)=>{return e.e({a:t.artist_info&&t.artist_info.LogoImage},t.artist_info&&t.artist_info.LogoImage?{b:t.artist_info.LogoImage}:{},{c:e.t(t.artist_name),d:e.t(j(t)),e:t.artist_info&&t.artist_info.Description},t.artist_info&&t.artist_info.Description?{f:e.t(t.artist_info.Description)}:{},{g:t.artist_info&&t.artist_info.artist_highlight_images},t.artist_info&&t.artist_info.artist_highlight_images?{h:e.f((s=t.artist_info.artist_highlight_images,s?s.split(",").filter((e=>""!==e.trim())):[]),((t,a,n)=>({a:a,b:t,c:e.o((a=>{return n=t,void e.index.previewImage({urls:[n],current:n});var n}),a)})))}:{},{i:e.t(I(t.open_time)),j:e.t(I(t.close_time)),k:e.t((o=t.order_type,{1:"限时手速",2:"抽选投递",3:"黑箱卡投递"}[o]||"未知类型")),l:e.t(0===t.max_participants?"不限量":t.max_participants),m:e.t(t.max_submissions_per_user),n:e.f(M(t),((t,a,n)=>({a:e.t(t.title),b:e.t(t.price),c:e.t(t.description),d:t.title}))),o:C(t).length>0},C(t).length>0?{p:e.f(C(t),((t,a,n)=>({a:e.t(t.title),b:e.t(t.price),c:e.t(t.description),d:t.title})))}:{},{q:v.value[t.id]?1:"",r:e.t(v.value[t.id]?"收起":"展开"),s:"29fbcd97-2-"+n+",29fbcd97-0",t:e.p({type:v.value[t.id]?"arrowup":"arrowdown",size:"16",color:"#81D8cf"}),v:e.o((e=>{return a=t.id,void(v.value[a]=!v.value[a]);var a}),t.id),w:t.id,x:e.o((a=>{return n=t.artist_info,void e.index.navigateTo({url:"/pages/artist_info/artist_info?brand_id="+n.brand_id});var n}),t.id)});var o,s}))}),{z:e.p({show:e.unref(k)}),A:e.p({head_color:"rgb(185 195 253)"})})}},o=e._export_sfc(n,[["__scopeId","data-v-29fbcd97"]]);wx.createPage(o);
