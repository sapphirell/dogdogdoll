"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("shmily-drag-image")+e.resolveComponent("common-modal"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../shmily-drag-image/shmily-drag-image.js")+(()=>"../common-modal/common-modal.js"))();const a={__name:"stock-myitems",props:{accountBookData:Object},emits:["go2editor","update-type","init-request","update:accountBookData"],setup(a,{emit:n}){const c=a,s=e.ref(!0),i=n,r=e.ref(!1),u=e.ref(""),l=e.ref([]),d=e.ref(0),p=["全部"],m=e.computed((()=>[...p,...l.value.map((e=>e.name))])),v=e.computed((()=>c.accountBookData.account_books?c.accountBookData.account_books.reduce(((e,o)=>e+(parseFloat(o.price)||0)),0).toFixed(2):0)),h=async()=>{const o=e.index.getStorageSync("token");try{const a=await e.index.request({url:t.websiteUrl+"/with-state/account-types",method:"GET",header:{Authorization:o}});l.value=a.data.data||[]}catch(a){console.error("获取分类失败:",a)}},y=async()=>{if(!u.value.trim())return void e.index.showToast({title:"请输入分类名称",icon:"none"});const o=e.index.getStorageSync("token");try{await e.index.request({url:t.websiteUrl+"/with-state/add-account-type",method:"POST",header:{Authorization:o},data:{name:u.value.trim()}}),await h(),u.value="",e.index.showToast({title:"添加成功"})}catch(a){e.index.showToast({title:"添加失败",icon:"none"})}},b=o=>{const a=e.index.getStorageSync("token");e.index.request({url:t.websiteUrl+"/with-state/sort-account-book",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{sorted_ids:o},success:e=>{},fail:e=>{console.error("排序失败:",e)}})},g=e=>{d.value=e.detail.value;const o=m.value[d.value];i("update-type","全部"===o?"":o)};return e.watch(s,(o=>{e.index.setStorageSync("accountBookPriceVisible",o.toString())})),e.onShow((()=>{const o=e.index.getStorageSync("accountBookPriceVisible");""!==o&&(s.value="true"===o),h()})),(n,c)=>{var i,p;return e.e({a:e.t(m.value[d.value]),b:e.p({type:"arrowdown",size:"14",color:"#747EE5"}),c:d.value,d:m.value,e:e.o(g),f:e.p({type:"gear",size:"16",color:"#fff"}),g:e.o((e=>r.value=!0)),h:e.p({type:"money",size:"18",color:"#74c9e5"}),i:s.value},s.value?{j:e.t(v.value)}:{},{k:e.o((e=>s.value=!s.value)),l:e.p({type:s.value?"eye":"eye-slash",size:"18",color:"#74c9e5"}),m:(null==(i=a.accountBookData.account_books)?void 0:i.length)>0},(null==(p=a.accountBookData.account_books)?void 0:p.length)>0?{n:e.o(b),o:e.o((e=>a.accountBookData.account_books=e)),p:e.p({"border-radius":"20",modelValue:a.accountBookData.account_books})}:{q:o._imports_0$3},{r:e.o((e=>r.value=!1)),s:e.p({type:"closeempty",size:"24",color:"#999"}),t:e.f(l.value,((o,a,n)=>({a:"bbc35c2e-7-"+n+",bbc35c2e-5",b:e.t(o.name),c:e.o((a=>(async o=>{e.index.showModal({title:"确认删除",success:async a=>{if(a.confirm){const a=e.index.getStorageSync("token");try{const n=(await e.index.request({url:t.websiteUrl+"/with-state/delete-account-type",method:"POST",header:{Authorization:a,"Content-Type":"application/json"},data:{id:o}})).data;"success"===n.status?(await h(),e.index.showToast({title:"删除成功"})):e.index.showToast({title:n.msg||"删除失败",icon:"none"})}catch(n){console.error("删除失败:",n),e.index.showToast({title:n.errMsg||"请求失败",icon:"none"})}}}})})(o.id)),o.id),d:"bbc35c2e-8-"+n+",bbc35c2e-5",e:o.id}))),v:e.p({type:"folder-add",size:"20",color:"#3db5c7"}),w:e.p({type:"trash",size:"20",color:"#ff6666"}),x:0===l.value.length},0===l.value.length?{y:o._imports_1$8}:{},{z:u.value,A:e.o((e=>u.value=e.detail.value)),B:e.p({type:"plus",size:"16",color:"#fff"}),C:e.o(y),D:e.o((e=>r.value=e)),E:e.p({visible:r.value,top:"250rpx"})})}}},n=e._export_sfc(a,[["__scopeId","data-v-bbc35c2e"]]);wx.createComponent(n);
