"use strict";const e=require("../../common/vendor.js"),o=require("../../common/config.js"),a=require("../../common/image.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("switch-search")+e.resolveComponent("bottom-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../switch-search/switch-search.js")+(()=>"../bottom-popup/bottom-popup.js"))();const l={__name:"comment-input",props:{replyInfo:{type:Object,default:()=>({})},targetId:{type:String,required:!0},safeBottom:{type:Number,default:10}},emits:["submit","update:replyInfo"],setup(l,{expose:t,emit:n}){const u=e.ref(!1),s=l;e.ref(null);const i=e.ref(!1),r=n,c=e.ref(""),p=e.ref(!1),v=e.ref(!1),f=e.ref(!1),d=e.ref(!1),m=e.ref(null),y=e.ref(""),g=e.ref(0),h=e.index.getSystemInfoSync(),I=e.computed((()=>{var e,o;let a=(null==(e=h.safeAreaInsets)?void 0:e.bottom)||10;console.log("底部安全距离1:",null==(o=h.safeAreaInsets)?void 0:o.bottom,"=>",a);let l=a+g.value;return console.log("底部最终距离2:",l),`${l}px`})),b=e=>{console.log("键盘高度变化",e),g.value=e.height},x=o=>{console.log("切换匿名状态",d.value),d.value=!d.value,d.value?e.index.showToast({title:"进入匿名状态",icon:"none"}):e.index.showToast({title:"退出匿名状态",icon:"none"})},_=()=>{p.value=!0,i.value=!0,f.value=!0},w=()=>{setTimeout((()=>{v.value||(f.value||(p.value=!1),i.value=!1),v.value=!1}),200)};async function j(){e.index.chooseImage({count:1,success:async e=>{const l=e.tempFilePaths;for(const n of l)try{const e=await a.getQiniuToken(),l=await a.uploadImageToQiniu(n,e.token,e.path);if(console.log("res:",l),200===l.qiniuRes.statusCode){const a=o.image1Url+e.path;y.value=a}else console.error("上传失败:",n)}catch(t){console.error("上传错误:",t)}}})}const z=()=>{console.log("蒙版被点击"),p.value=!1,i.value=!1,f.value=!1,e.index.hideKeyboard()};function C(e){let o={};"goods"===e.type?(console.log("选择了商品:",e.data),u.value=!1,o.type=1,o.id=e.data.id,o.name=e.data.name):"brand"===e.type&&(console.log("选择了品牌:",e.data),u.value=!1,o.type=2,o.id=e.data.id,o.name=e.data.name),m.value=o}const q=()=>{if(!c.value.trim()&&!y.value)return void e.index.showToast({title:"请输入评论内容或上传图片",icon:"none"});let a=o.getScene();console.log("scene",a);const l={content:c.value,target_id:s.targetId,type:4,replyInfo:s.replyInfo,origin:a,image_url:y.value||"",association_id:m.value?m.value.id:0,association_type:m.value?m.value.type:0,is_anonymous:d.value?1:0};r("submit",l),c.value="",y.value="",m.value=null,d.value=!1,r("update:replyInfo",{}),z()};return t({focusInput:()=>{i.value=!0}}),e.onMounted((()=>{console.log("注册键盘弹出事件"),e.index.onKeyboardHeightChange(b)})),(o,a)=>e.e({a:p.value,b:e.o(z),c:m.value},m.value?{d:e.p({type:"paperclip",size:"20",color:"#fff"}),e:e.t(m.value.name),f:e.o((e=>m.value=null)),g:e.p({type:"close",size:"20",color:"#fff"})}:{},{h:y.value},y.value?{i:y.value,j:e.p({type:"close",size:"18",color:"#fff"}),k:e.o((e=>y.value=""))}:{},{l:i.value,m:i.value?1:"",n:e.o(_),o:e.o(w),p:l.replyInfo.username?"回复@"+l.replyInfo.username+" ":"写评论...",q:c.value,r:e.o((e=>c.value=e.detail.value)),s:e.o(q),t:d.value},d.value?{v:e.p({type:"eye-slash",size:"22",color:d.value?"#007aff":""})}:{w:e.p({type:"eye",size:"22",color:"#696a6c"})},{x:e.o(x),y:e.p({type:"plus",size:"22",color:"#696a6c"}),z:e.o((e=>u.value=!0)),A:e.p({type:"image",size:"22",color:"#696a6c"}),B:e.o(j),C:f.value,D:u.value},u.value?{E:e.o(C),F:e.p({"target-id":s.targetId,"reply-info":s.replyInfo,mode:"fill"})}:{},{G:e.o((e=>u.value=!1)),H:e.p({show:u.value}),I:I.value})}},t=e._export_sfc(l,[["__scopeId","data-v-ec330e93"]]);wx.createComponent(t);
