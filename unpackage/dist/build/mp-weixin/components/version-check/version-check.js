"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){e.resolveComponent("common-modal")()}Math;const o={__name:"version-check",props:{showUpToDateToast:{type:Boolean,default:!1},currentVersion:{type:String,required:!0},autoCheck:{type:Boolean,default:!0}},setup(o,{expose:n}){const a=o,r=e.ref(!1),s=e.ref(null),l=e.ref(!1),i=e.ref("1.0.0"),u=e.computed((()=>e.index.getSystemInfoSync().platform||"unknown")),c=e=>{if(!e)return"未知日期";const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},d=async()=>{try{let o=t.getScene();if(1===o||4===o)return void console.log("scene:",o);if((()=>{const t=e.index.getStorageSync("ignoreUpdateTime");if(console.log("忽略时间：",t),!t)return!1;const o=Date.now();return console.log("当前时间",o),o-t<2592e5})())return void console.log("在忽略期内，不显示更新提示 ");e.index.getAppBaseInfo().appVersion;const n=await e.index.request({url:`${t.websiteUrl}/latest-version?version=1.0.40`,method:"GET"});n&&n.data&&("success"===n.data.status&&n.data.data?(s.value=n.data.data,r.value=!0):"failed"===n.data.status&&a.showUpToDateToast&&(l.value=!0,setTimeout((()=>{l.value=!1}),2e3)))}catch(o){console.error("版本检查失败:",o)}},p=()=>{e.index.setStorageSync("ignoreUpdateTime",Date.now()),r.value=!1;const o=u.value.toLowerCase();console.log(o);let n=t.getScene();2===n||3===n?plus.runtime.openURL("https://apps.apple.com/app/id6747564362"):e.index.showModal({title:"更新提示",content:"请前往应用商店更新最新版本",showCancel:!1})},v=()=>{e.index.setStorageSync("ignoreUpdateTime",Date.now()),r.value=!1};return n({checkVersion:d}),e.onMounted((()=>{i.value=e.index.getAppBaseInfo().appVersion,a.autoCheck&&setTimeout((()=>{d()}),1500)})),(t,o)=>{var n,a,i;return e.e({a:e.t(null==(n=s.value)?void 0:n.version),b:e.t(),c:e.t((null==(a=s.value)?void 0:a.note)||"优化用户体验，修复已知问题"),d:e.t(c(null==(i=s.value)?void 0:i.created_at)),e:e.o(v),f:e.o(p),g:e.o((e=>r.value=e)),h:e.p({visible:r.value,top:"15vh"}),i:l.value},(l.value,{}))}}};wx.createComponent(o);
