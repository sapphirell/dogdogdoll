"use strict";const e=require("../../common/vendor.js"),o=require("../../common/config.js");if(!Array){e.resolveComponent("common-modal")()}Math;const t={__name:"version-check",props:{showUpToDateToast:{type:Boolean,default:!1},currentVersion:{type:String,required:!1},autoCheck:{type:Boolean,default:!0}},setup(t,{expose:n}){const a=t,r=e.ref(!1),l=e.ref(null),s=e.ref(!1),i=e.ref("1.0.0"),u=e.computed((()=>e.index.getSystemInfoSync().platform||"unknown")),d=e=>{if(!e)return"未知日期";const o=new Date(1e3*e);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`},c=async()=>{try{let t=o.getScene();if(1===t||4===t)return void console.log("不检查版本原因scene:",t);if((()=>{const o=e.index.getStorageSync("ignoreUpdateTime");if(console.log("忽略时间：",o),!o)return!1;const t=Date.now();return console.log("当前时间",t),t-o<2592e5})())return void console.log("在忽略期内，不显示更新提示 ");e.index.getAppBaseInfo().appVersion;const n=await e.index.request({url:`${o.websiteUrl.value}/latest-version?version=${o.dogdogdollVersion}`,method:"GET"});n&&n.data&&(console.log(`${o.websiteUrl.value}/latest-version?version=${o.dogdogdollVersion}`),console.log(n.data),"success"===n.data.status&&n.data.data?(l.value=n.data.data,r.value=!0):"failed"===n.data.status&&a.showUpToDateToast&&(s.value=!0,setTimeout((()=>{s.value=!1}),2e3)))}catch(t){console.error("版本检查失败:",t)}},p=()=>{e.index.setStorageSync("ignoreUpdateTime",Date.now()),r.value=!1;const t=u.value.toLowerCase();console.log(t);let n=o.getScene();2===n?plus.runtime.openURL("https://apps.apple.com/app/id6747564362"):3===n?plus.runtime.openURL("https://www.dogdogdoll.com/"):e.index.showModal({title:"更新提示",content:"请前往应用商店更新最新版本",showCancel:!1})},g=()=>{e.index.setStorageSync("ignoreUpdateTime",Date.now()),r.value=!1};return n({checkVersion:c}),e.onMounted((()=>{i.value=e.index.getAppBaseInfo().appVersion,a.autoCheck&&setTimeout((()=>{c()}),1500)})),(t,n)=>{var a,i,u;return e.e({a:e.t(null==(a=l.value)?void 0:a.version),b:e.t(e.unref(o.dogdogdollVersion)),c:e.t((null==(i=l.value)?void 0:i.note)||"优化用户体验，修复已知问题"),d:e.t(d(null==(u=l.value)?void 0:u.created_at)),e:e.o(g),f:e.o(p),g:e.o((e=>r.value=e)),h:e.p({visible:r.value,top:"15vh"}),i:s.value},(s.value,{}))}}};wx.createComponent(t);
