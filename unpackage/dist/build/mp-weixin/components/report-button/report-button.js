"use strict";const e=require("../../common/vendor.js"),t=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("common-modal"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../common-modal/common-modal.js"))();const o={__name:"report-button",props:{reportType:{type:Number,required:!0},relationId:{type:Number,required:!0},buttonText:{type:String,default:"举报"},iconType:{type:String,default:""},iconSize:{type:Number,default:24},iconColor:{type:String,default:"#999"},themeColor:{type:String,default:"#64c6dc"},autoFocus:{type:Boolean,default:!1}},emits:["success","error","cancel","before-submit"],setup(o,{emit:a}){const n=o,r=a,i=e.ref(!1),l=e.ref([]),s=e.ref(""),u=e.ref(""),c=e.ref(!1),d=async()=>{await(async()=>{try{const o=e.index.getStorageSync("token"),a=await e.index.request({url:`${t.websiteUrl}/report/reasons?type=${n.reportType}`,method:"GET",header:{Authorization:o}});return"success"===a.data.status?(l.value=a.data.data,!0):(e.index.showToast({title:"获取举报原因失败: "+(a.data.msg||""),icon:"none"}),!1)}catch(o){return e.index.showToast({title:"网络请求失败",icon:"none"}),!1}})()&&(s.value="",u.value="",i.value=!0)},p=async()=>{if(!c.value){c.value=!0;try{if(!s.value)return void e.index.showToast({title:"请选择举报原因",icon:"none"});r("before-submit",{type:n.reportType,relationId:n.relationId,reason:s.value,details:u.value});const o=e.index.getStorageSync("token"),a={type:n.reportType,relation_id:n.relationId,reason:s.value,details:u.value};let l=`${t.websiteUrl}/with-state/report/submit`;""==o&&(l=`${t.websiteUrl}/report/submit`);const d=await e.index.request({url:l,method:"POST",header:{Authorization:o,"Content-Type":"application/json"},data:a,timeout:1e4});"success"===d.data.status?(e.index.showToast({title:"举报提交成功",icon:"success",duration:2e3}),i.value=!1,r("success",d.data)):(e.index.showToast({title:d.data.msg||"举报提交失败",icon:"none"}),r("error",d.data))}catch(o){e.index.showToast({title:"举报提交失败: "+(o.errMsg||"网络错误"),icon:"none"}),r("error",o)}finally{c.value=!1}}};return e.watch(i,(e=>{e||r("cancel")})),(t,a)=>({a:e.p({"v-if":""!==o.iconType,type:o.iconType,size:o.iconSize,color:o.iconColor}),b:e.t(o.buttonText),c:e.o(d),d:e.o((e=>i.value=!1)),e:e.p({type:"closeempty",size:"24",color:"#999"}),f:e.f(l.value,((t,o,a)=>({a:t.label,b:s.value===t.label,c:e.t(t.label),d:t.id,e:e.o((e=>(e=>{s.value===e?s.value="":s.value=e})(t.label)),t.id),f:s.value===t.label?1:""}))),g:o.themeColor,h:o.autoFocus,i:u.value,j:e.o((e=>u.value=e.detail.value)),k:e.t(u.value.length),l:e.o((e=>i.value=!1)),m:e.o(p),n:o.themeColor,o:e.o((e=>i.value=e)),p:e.p({visible:i.value,top:"10vh"})})}},a=e._export_sfc(o,[["__scopeId","data-v-c773ae3c"]]);wx.createComponent(a);
