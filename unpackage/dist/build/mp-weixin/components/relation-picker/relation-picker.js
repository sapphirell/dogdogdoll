"use strict";const e=require("../../common/vendor.js"),o=require("../../common/config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("common-name-picker")+e.resolveComponent("common-search")+e.resolveComponent("custom-picker")+e.resolveComponent("goods-search")+e.resolveComponent("common-modal"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../common-name-picker/common-name-picker.js")+(()=>"../common-search/common-search.js")+(()=>"../custom-picker/custom-picker.js")+(()=>"../goods-search/goods-search.js")+(()=>"../common-modal/common-modal.js"))();const a={__name:"relation-picker",props:{typeList:{type:Array,default:()=>[]},visible:{type:Boolean,default:!1}},emits:["update:visible","confirm","cancel"],setup(a,{emit:n}){const l=a,s=n,t=e.ref([]),i=e.ref(!1),r=e.ref(""),c=e.ref(!1),d=e=>{console.log(e),c.value=e,r.value="",v.value={type:null,brand:null,goods:null},t.value=[]},u=async o=>{var a;try{const e=await f(o.id);v.value={type:e.type||"其他",brand:{id:e.brand_id,name:e.brand_name},goods:{id:o.id,name:o.name,image:(null==(a=null==e?void 0:e.goods_images)?void 0:a[0])||""}}}catch(n){console.error("商品信息获取失败",n),e.index.showToast({title:"商品信息获取失败",icon:"none"})}},m=()=>{i.value=!1,r.value="",v.value={type:null,brand:null,goods:null}};e.watch((()=>l.visible),(e=>{i.value=e})),e.watch(i,(e=>{s("update:visible",e)}));const v=e.ref({type:null,brand:null,goods:null}),p=e=>{i.value=e,e||m()},g=e=>{v.value.type=e},f=a=>new Promise(((n,l)=>{e.index.request({url:o.websiteUrl+"/goods?id="+a,method:"GET",timeout:5e3,success:e=>{n(e.data.data)},fail:e=>{console.error("商品详情获取失败",e),l(e)}})})),h=(a,n)=>{v.value.brand={id:a,name:n};try{l=a,e.index.request({url:o.websiteUrl+"/goods-name-list?id="+l,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),t.value=e.data.data,console.log(t.value)},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}catch(s){console.error("获取商品失败",s)}var l},y=async(o,a)=>{var n;try{v.value.goods=null;const e=await f(o);if(!e)throw new Error("未找到商品信息");v.value.goods={id:o,name:a,image:(null==(n=null==e?void 0:e.goods_images)?void 0:n[0])||""}}catch(l){console.error("商品选择失败",l),e.index.showToast({title:"商品信息获取失败，请重新选择",icon:"none"})}};const b=async()=>{var o;try{const e=await f(v.value.goods.id),a={...v.value,goods_image:(null==(o=null==e?void 0:e.goods_images)?void 0:o[0])||"",goods_id:v.value.goods.id,brand_id:v.value.brand.id,brand_name:v.value.brand.name,type:v.value.type};s("confirm",a),m()}catch(a){console.error("商品信息获取失败",a),e.index.showToast({title:"商品信息获取失败",icon:"none"})}},w=()=>{s("cancel"),m()};return(o,n)=>e.e({a:!c.value},c.value?{}:{b:e.p({type:"search",size:"18",color:"#fff"}),c:e.o((e=>d(!0)))},{d:c.value},c.value?{e:e.p({type:"list",size:"18",color:"#fff"}),f:e.o((e=>d(!1)))}:{},{g:c.value},c.value?{h:e.o(g),i:e.p({dataList:a.typeList,placeholder:"选择类型"}),j:e.o(h),k:e.p({mode:"fill",width:"520rpx",background:"#f8f8f8"}),l:e.o(y),m:e.p({dataList:t.value})}:{n:e.o(u),o:e.o((e=>r.value=e)),p:e.p({mode:"fill",width:"520rpx",background:"#f8f8f8","show-icon":!1,modelValue:r.value})},{q:e.o(w),r:e.o(b),s:e.o(p),t:e.p({visible:i.value,top:"3%"})})}},n=e._export_sfc(a,[["__scopeId","data-v-e78794c9"]]);wx.createComponent(n);
