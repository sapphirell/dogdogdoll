"use strict";const e=require("../../common/vendor.js"),o=require("../../common/config.js");if(!Array){(e.resolveComponent("common-name-picker")+e.resolveComponent("common-search")+e.resolveComponent("custom-picker")+e.resolveComponent("common-modal"))()}Math||((()=>"../common-name-picker/common-name-picker.js")+(()=>"../common-search/common-search.js")+(()=>"../custom-picker/custom-picker.js")+(()=>"../common-modal/common-modal.js"))();const a={__name:"relation-picker",props:{typeList:{type:Array,default:()=>[]},visible:{type:Boolean,default:!1}},emits:["update:visible","confirm","cancel"],setup(a,{emit:n}){const t=a,s=n,l=e.ref([]),c=e.ref(!1);e.watch((()=>t.visible),(e=>{c.value=e})),e.watch(c,(e=>{s("update:visible",e)}));const i=e.ref({type:null,brand:null,goods:null}),r=e=>{c.value=e,e||f()},d=e=>{i.value.type=e},m=a=>new Promise(((n,t)=>{e.index.request({url:o.websiteUrl+"/goods?id="+a,method:"GET",timeout:5e3,success:e=>{n(e.data.data)},fail:e=>{console.error("商品详情获取失败",e),t(e)}})})),u=(a,n)=>{i.value.brand={id:a,name:n};try{t=a,e.index.request({url:o.websiteUrl+"/goods-name-list?id="+t,method:"GET",timeout:5e3,success:e=>{console.log(e.data.data),l.value=e.data.data,console.log(l.value)},fail:o=>{console.log(o),e.index.showToast({title:"网络请求失败",icon:"none"})}})}catch(s){console.error("获取商品失败",s)}var t},p=async(e,o)=>{var a;try{const n=await m(e);i.value.goods={id:e,name:o,image:(null==(a=n.goods_images)?void 0:a[0])||""}}catch(n){console.error("商品选择失败",n)}};const v=async()=>{var o;try{const e=await m(i.value.goods.id),a={...i.value,goods_image:(null==(o=e.goods_images)?void 0:o[0])||"",goods_id:i.value.goods.id,brand_id:i.value.brand.id,brand_name:i.value.brand.name,type:i.value.type};s("confirm",a),f()}catch(a){e.index.showToast({title:"商品信息获取失败",icon:"none"})}},g=()=>{s("cancel"),f()},f=()=>{c.value=!1,i.value={type:null,brand:null,goods:null}};return(o,n)=>({a:e.o(d),b:e.p({dataList:a.typeList,placeholder:"选择类型"}),c:e.o(u),d:e.p({mode:"fill",width:"520rpx",background:"#f8f8f8"}),e:e.o(p),f:e.p({dataList:l.value}),g:e.o(g),h:e.o(v),i:e.o(r),j:e.p({visible:c.value})})}},n=e._export_sfc(a,[["__scopeId","data-v-fcd5bdff"]]);wx.createComponent(n);
