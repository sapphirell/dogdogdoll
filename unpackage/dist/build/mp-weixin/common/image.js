"use strict";const e=require("./vendor.js"),t=require("./config.js");exports.chooseImage=function(){return new Promise((t=>{e.index.chooseImage({count:1,success:e=>{t(e.tempFilePaths[0])}})}))},exports.chooseImageList=function(t=9){return new Promise(((o,n)=>{e.index.chooseImage({count:t,success:e=>{o(e.tempFilePaths)},fail:e=>{n(e)}})}))},exports.getQiniuToken=function(){return new Promise(((o,n)=>{let i=e.index.getStorageSync("token");e.index.request({url:t.websiteUrl+"/with-state/qiniu-token",method:"POST",header:{Authorization:i},success:t=>{t.data.data&&t.data.data.token?(console.log("获取到的七牛token："+t.data.data.token),o(t.data.data)):(e.index.showToast({title:"获取上传凭证失败",icon:"none"}),n("获取上传凭证失败"))},fail:t=>{e.index.showToast({title:"获取上传凭证失败",icon:"none"}),n("获取上传凭证失败")}})}))},exports.uploadImageToQiniu=function(o,n,i){let a=e.index.getStorageSync("token");return new Promise(((s,r)=>{e.index.uploadFile({url:"https://up-cn-east-2.qiniup.com",name:"file",method:"POST",filePath:o,fileType:"image",formData:{token:n,key:i,scope:"hobby-box:"+i},success:async o=>{try{const n=t.image1Url+i,r=await e.index.request({url:`${t.websiteUrl}/with-state/add-image-log`,method:"POST",header:{"Content-Type":"application/json",Authorization:a},data:{image_url:n}});if(console.log(r),"success"!==r.data.status)throw new Error("上传图片失败");s({qiniuRes:o,imageUrl:n})}catch(n){console.error("日志记录失败:",n),e.index.showToast({title:"日志记录失败",icon:"none"}),r("日志记录失败")}},fail:t=>{e.index.showToast({title:"上传失败",icon:"none"}),r("上传失败")}})}))};
