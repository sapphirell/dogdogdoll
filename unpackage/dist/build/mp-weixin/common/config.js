"use strict";const e=require("./vendor.js"),t="https://api.fantuanpu.com";let o=e.reactive({isLogin:!1,userInfo:{}});function n(){const o=e.index.getStorageSync("token");o?e.index.request({url:`${t}/with-state/mine`,method:"GET",header:{Authorization:o},success:e=>{const t=e.data.data;t?s(t):i()},fail:e=>{a(e,"获取用户信息失败")}}):i()}function s(t){e.index.setStorageSync("userInfo",t),o.userInfo=t,o.isLogin=!0}function i(){e.index.removeStorageSync("userInfo"),o.userInfo={},o.isLogin=!1}function a(t,o="请求失败"){console.error(t),e.index.showToast({title:o,icon:"none"})}exports.asyncGetUserInfo=function(){return new Promise(((o,n)=>{const c=e.index.getStorageSync("token");if(!c)return i(),void o(null);e.index.request({url:`${t}/with-state/mine`,method:"GET",header:{Authorization:c},success:e=>{const t=e.data.data;t?(console.log("返回：",t),s(t),o(t)):(i(),o(null))},fail:e=>{a(e,"获取用户信息失败"),o(null)}})}))},exports.getUserInfo=n,exports.global=o,exports.image1Url="https://images1.fantuanpu.com/",exports.voteScore=async function(o,n,s){let i=e.index.getStorageSync("token");return i?(e.index.request({url:t+"/with-state/add-vote-score",method:"POST",header:{Authorization:i},data:{target_id:parseInt(s),score:parseInt(n),type:o},success:t=>(console.log(t.data),"success"==t.data.status?(e.index.showToast({title:"评分成功",icon:"success"}),activeModal.value=!1,0):(e.index.showToast({title:t.data.msg,icon:"none"}),0)),fail:t=>{console.log(t),e.index.showToast({title:"网络请求失败",icon:"none"})}}),0):(e.index.showToast({title:"请先登录",icon:"none"}),0)},exports.websiteUrl=t,exports.wechatSignLogin=function(){e.index.login({provider:"weixin",onlyAuthorize:!0,success:o=>{const{code:i}=o;i?e.index.request({url:`${t}/login-with-wechat`,method:"POST",data:{js_token:i},success:t=>{const o=t.data.data;console.log(o),"success"==t.data.status?o.jwt_token&&(e.index.setStorageSync("token",o.jwt_token),s(o),n()):e.index.showToast({title:o.msg,icon:"none"})},fail:e=>{a(e,"微信登录失败")}}):e.index.showToast({title:"微信登录失败，授权初始化失败",icon:"none"})},fail:e=>{a(e,"微信授权失败")}})};
