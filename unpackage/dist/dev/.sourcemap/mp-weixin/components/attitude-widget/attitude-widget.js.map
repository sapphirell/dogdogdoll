{"version":3,"file":"attitude-widget.js","sources":["components/attitude-widget/attitude-widget.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/attitude-widget/attitude-widget.vue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"attitude-container\">\r\n\t\t<view v-if=\"showPanel\" class=\"mask\" @click.stop=\"togglePanel\" @touchmove.stop.prevent></view>\r\n\r\n\t\t<!-- ÂêàÂπ∂ÂêéÁöÑÂÖ®Â±ÄÁªüËÆ° -->\r\n\t\t<view class=\"counts-and-expand\">\r\n\t\t\t<view class=\"global-counts\">\r\n\t\t\t\t<view v-for=\"action in visibleGlobalCounts\" :key=\"action.value\" class=\"count-item\" :class=\"{ \r\n            'active': currentStatus === action.value,\r\n            'has-count': action.count > 0 \r\n          }\">\r\n\t\t\t\t\t<text class=\"emoji\">{{ action.emoji }}</text>\r\n\t\t\t\t\t<text class=\"count\">{{ action.count }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"expand-btn\" @click.stop=\"togglePanel\">\r\n\t\t\t\t<uni-icons :type=\"showPanel ? 'arrowup' : 'plus'\" size=\"16\" color=\"#888\" />\r\n\t\t\t\t<text class=\"btn-text\">{{ showPanel ? 'Êî∂Ëµ∑' : 'Ë°®ÊÄÅ' }}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- Ë°®ÊÄÅÈù¢Êùø -->\r\n\t\t<view v-if=\"showPanel\" class=\"attitude-panel\">\r\n\t\t\t<view v-for=\"action in attitudeTypes\" :key=\"action.value\" class=\"attitude-btn\"\r\n\t\t\t\t:class=\"{ active: currentStatus === action.value }\" @click.stop=\"handleAction(action.value)\">\r\n\t\t\t\t<text class=\"emoji\">{{ action.emoji }}</text>\r\n\t\t\t\t<view class=\"text-container\">\r\n\t\t\t\t\t<text class=\"label\">{{ action.label }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tcomputed,\r\n\t\twatch\r\n\t} from 'vue'\n\t\n\timport {\n\t\twebsiteUrl,\n\t\tasyncGetUserInfo,\n\t\twechatSignLogin,\n\t\tgetScene\n\t} from '../../common/config.js'\r\n\r\n\tconst props = defineProps({\r\n\t\ttargetId: Number,\r\n\t\ttype: Number,\r\n\t\tattitudeStatus: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tattitudeCounts: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({})\r\n\t\t}\r\n\t})\r\n\r\n\tconst emit = defineEmits(['change'])\r\n\r\n\t// Êú¨Âú∞Áä∂ÊÄÅ\r\n\tconst showPanel = ref(false)\r\n\tconst currentStatus = ref(props.attitudeStatus)\r\n\tconst currentCounts = ref({})\r\n\r\n\t// ÈÖçÁΩÆÈ°π\r\n\tconst attitudeTypes = ref([{\r\n\t\t\temoji: 'üòù',\r\n\t\t\tvalue: 1,\r\n\t\t\tlabel: 'ÂæàÊúâË∂£'\r\n\t\t},\r\n\t\t{\r\n\t\t\temoji: 'üò®',\r\n\t\t\tvalue: 2,\r\n\t\t\tlabel: 'Ëøô‰∏™...'\r\n\t\t},\r\n\t\t{\r\n\t\t\temoji: 'ü§§',\r\n\t\t\tvalue: 3,\r\n\t\t\tlabel: 'Êàë‰πüÊÉ≥Ë¶Å'\r\n\t\t},\r\n\t\t{\r\n\t\t\temoji: 'ü§¶‚Äç‚ôÄÔ∏è',\r\n\t\t\tvalue: 4,\r\n\t\t\tlabel: 'Èöæ‰ª•Áõ¥ËßÜ'\r\n\t\t},\r\n\t\t{\r\n\t\t\temoji: 'ü§°',\r\n\t\t\tvalue: 5,\r\n\t\t\tlabel: 'Ë∞ÅÁöÑÈºªÂ≠êÊéâ‰∫Ü?'\r\n\t\t}\r\n\t])\r\n\r\n\t// ÂàùÂßãÂåñËÆ°Êï∞\r\n\twatch(() => props.attitudeCounts, (newVal) => {\r\n\t\tattitudeTypes.value.forEach(t => {\r\n\t\t\tcurrentCounts.value[t.value] = Number(newVal[t.value] ?? 0)\r\n\t\t})\r\n\t\tcurrentCounts.value = {\r\n\t\t\t...currentCounts.value\r\n\t\t}\r\n\t}, {\r\n\t\timmediate: true,\r\n\t\tdeep: true\r\n\t})\r\n\r\n\t// ËøáÊª§ÊòæÁ§∫ÁöÑÈùûÈõ∂ËÆ°Êï∞\r\n\tconst visibleGlobalCounts = computed(() => {\r\n\t\treturn attitudeTypes.value\r\n\t\t\t.map(t => ({\r\n\t\t\t\t...t,\r\n\t\t\t\tcount: currentCounts.value[t.value] || 0\r\n\t\t\t}))\r\n\t\t\t.filter(t => t.count > 0 || t.value === currentStatus.value)\r\n\t\t\t.filter(t => t.count > 0) // ÊúÄÁªàÁ°Æ‰øùÂè™ÊòæÁ§∫count>0ÁöÑ\r\n\t})\r\n\r\n\tconst togglePanel = () => {\r\n\t\tshowPanel.value = !showPanel.value\r\n\t}\r\n\r\n\tconst handleAction = async (actionType) => {\r\n\t\ttry {\r\n\t\t\tconst token = uni.getStorageSync('token')\r\n\t\t\tif (!token) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: 'ËØ∑ÂÖàÁôªÂΩï',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tconst isActive = currentStatus.value === actionType\r\n\t\t\tconst apiUrl = `${websiteUrl}/with-state/attitude/${isActive ? 'remove' : 'add'}`\r\n\r\n\t\t\tconst res = await uni.request({\r\n\t\t\t\turl: apiUrl,\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\ttarget_id: props.targetId,\r\n\t\t\t\t\ttype: props.type,\r\n\t\t\t\t\taction_type: actionType\r\n\t\t\t\t},\r\n\t\t\t\theader: {\r\n\t\t\t\t\tAuthorization: token\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tif (res.data.status === 'success') {\r\n\t\t\t\t// Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ\r\n\t\t\t\tif (isActive) {\r\n\t\t\t\t\tcurrentCounts.value[actionType]--\r\n\t\t\t\t\tcurrentStatus.value = 0\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (currentStatus.value > 0) {\r\n\t\t\t\t\t\tcurrentCounts.value[currentStatus.value]--\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrentStatus.value = actionType\r\n\t\t\t\t\tcurrentCounts.value[actionType] = (currentCounts.value[actionType] || 0) + 1\r\n\t\t\t\t}\r\n\r\n\t\t\t\temit('change', {\r\n\t\t\t\t\tstatus: currentStatus.value,\r\n\t\t\t\t\tcounts: {\r\n\t\t\t\t\t\t...currentCounts.value\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tshowPanel.value = false\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log(err)\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'Êìç‰ΩúÂ§±Ë¥•',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\t.mask {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100vw;\r\n\t\theight: 100vh;\r\n\t\tbackground: rgba(255, 255, 255, 0.0);\r\n\t\tbackdrop-filter: blur(2px);\r\n\t\tz-index: 998;\r\n\t}\r\n\r\n\t.attitude-container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.counts-and-expand {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: 12rpx;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.global-counts {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tgap: 16rpx;\r\n\r\n\t\t.count-item {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 4rpx 12rpx;\r\n\t\t\tborder-radius: 20rpx;\r\n\t\t\tbackground: #f5f5f5;\r\n\t\t\ttransition: all 0.3s;\r\n\r\n\t\t\t&.active {\r\n\t\t\t\tbackground: #e0f0ff;\r\n\r\n\t\t\t\t.emoji,\r\n\t\t\t\t.count {\r\n\t\t\t\t\tcolor: #007AFF;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.emoji {\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.count {\r\n\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\tmargin-left: 5rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.expand-btn {\r\n\t\tflex-shrink: 0;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 4rpx 8rpx;\r\n\r\n\t\t.btn-text {\r\n\t\t\tfont-size: 22rpx;\r\n\t\t\tcolor: #888;\r\n\t\t\tmargin-left: 4rpx;\r\n\t\t}\r\n\t}\r\n\r\n\t.attitude-panel {\r\n\t\tposition: absolute;\r\n\t\ttop: 110%;\r\n\t\tright: 0;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 8rpx;\r\n\t\tbox-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);\r\n\t\tpadding: 16rpx;\r\n\t\tz-index: 10;\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: repeat(2, 1fr);\r\n\t\tgap: 12rpx;\r\n\t\tz-index: 999;\r\n\r\n\t\t.attitude-btn {\r\n\t\t\tpadding: 12rpx;\r\n\t\t\tborder-radius: 8rpx;\r\n\t\t\tbackground: #f5f5f5;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\r\n\t\t\t&.active {\r\n\t\t\t\tbackground: #e0f0ff;\r\n\r\n\t\t\t\t.emoji,\r\n\t\t\t\t.label {\r\n\t\t\t\t\tcolor: #007AFF;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.emoji {\r\n\t\t\t\tmargin-right: 8rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.label {\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/attitude-widget/attitude-widget.vue'\nwx.createComponent(Component)"],"names":["ref","watch","computed","uni","websiteUrl"],"mappings":"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"}