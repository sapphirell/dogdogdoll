{"version":3,"file":"view-logs.js","sources":["components/view-logs/view-logs.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/view-logs/view-logs.vue?type=component"],"sourcesContent":["<script setup>\r\n\timport {\r\n\t\tonMounted\r\n\t} from 'vue';\r\n\timport {\r\n\t\tgetScene,\r\n\t\tdogdogdollVersion,\r\n\t\tglobal,\r\n\t\twebsiteUrl\r\n\t} from '../../common/config.js'\r\n\r\n\t// 生成独立访客ID\r\n\tconst getUVId = () => {\r\n\t\tlet uvid = uni.getStorageSync('ft_uvid');\r\n\t\tif (!uvid) {\r\n\t\t\t// 生成随机ID (1到2147483647之间)\r\n\t\t\tuvid = Math.floor(Math.random() * 2147483647) + 1;\r\n\t\t\tuni.setStorageSync('ft_uvid', uvid);\r\n\t\t}\r\n\t\treturn uvid;\r\n\t};\r\n\r\n\t// 获取当前页面路径\r\n\tconst getCurrentPagePath = () => {\r\n\t\tconst pages = getCurrentPages();\r\n\t\tif (pages.length === 0) return '';\r\n\t\treturn pages[pages.length - 1].route || '';\r\n\t};\r\n\r\n\t// 发送日志数据到后端\r\n\tconst sendViewLog = async () => {\r\n\t\tlet userInfo = uni.getStorageSync('userInfo')\r\n\t\tconst logData = {\r\n\t\t\tscene: getScene(), // 访问场景\r\n\t\t\tpath: getCurrentPagePath(), // 当前页面路径\r\n\t\t\tuid: userInfo ? userInfo.id : 0, // 用户ID（如果登录）\r\n\t\t\tuvid: getUVId(), // 独立访客ID\r\n\t\t\tversion: dogdogdollVersion // 版本号\r\n\t\t};\r\n\t\tconsole.log(\"logData:\", logData)\r\n\r\n\t\t// 确保所有必要数据都存在\r\n\t\tif (!logData.path) {\r\n\t\t\tconsole.warn('无法获取当前页面路径');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst res = await uni.request({\r\n\t\t\t\turl: `${websiteUrl}/log/view`,\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: logData,\r\n\t\t\t\theader: {\r\n\t\t\t\t\t'content-type': 'application/json'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('日志发送错误:', error);\r\n\t\t}\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\t// 在组件挂载时发送日志\r\n\t\tsendViewLog();\r\n\t});\r\n</script>\r\n\r\n<template>\r\n\t<!-- 这是一个无UI组件，不需要渲染任何内容 -->\r\n</template>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/view-logs/view-logs.vue'\nwx.createComponent(Component)"],"names":["uni","getScene","dogdogdollVersion","websiteUrl","onMounted","Component"],"mappings":";;;;;;AAYC,UAAM,UAAU,MAAM;AACrB,UAAI,OAAOA,cAAAA,MAAI,eAAe,SAAS;AACvC,UAAI,CAAC,MAAM;AAEV,eAAO,KAAK,MAAM,KAAK,WAAW,UAAU,IAAI;AAChDA,sBAAAA,MAAI,eAAe,WAAW,IAAI;AAAA,MAClC;AACD,aAAO;AAAA,IACT;AAGC,UAAM,qBAAqB,MAAM;AAChC,YAAM,QAAQ;AACd,UAAI,MAAM,WAAW;AAAG,eAAO;AAC/B,aAAO,MAAM,MAAM,SAAS,CAAC,EAAE,SAAS;AAAA,IAC1C;AAGC,UAAM,cAAc,YAAY;AAC/B,UAAI,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC5C,YAAM,UAAU;AAAA,QACf,OAAOC,cAAAA,SAAU;AAAA;AAAA,QACjB,MAAM,mBAAoB;AAAA;AAAA,QAC1B,KAAK,WAAW,SAAS,KAAK;AAAA;AAAA,QAC9B,MAAM,QAAS;AAAA;AAAA,QACf,SAASC,cAAiB;AAAA;AAAA,MAC7B;AACEF,oBAAAA,+DAAY,YAAY,OAAO;AAG/B,UAAI,CAAC,QAAQ,MAAM;AAClBA,sBAAAA,MAAA,MAAA,QAAA,4CAAa,YAAY;AACzB;AAAA,MACA;AAED,UAAI;AACH,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC7B,KAAK,GAAGG,cAAU,UAAA;AAAA,UAClB,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,QAAQ;AAAA,YACP,gBAAgB;AAAA,UAChB;AAAA,QACL,CAAI;AAAA,MACD,SAAQ,OAAO;AACfH,sBAAc,MAAA,MAAA,SAAA,4CAAA,WAAW,KAAK;AAAA,MAC9B;AAAA,IACH;AAECI,kBAAAA,UAAU,MAAM;AAEf;IACF,CAAE;;;;;;AC/DF,GAAG,gBAAgBC,SAAS;"}