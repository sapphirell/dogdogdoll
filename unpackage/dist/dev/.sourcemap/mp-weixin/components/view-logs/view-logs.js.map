{"version":3,"file":"view-logs.js","sources":["components/view-logs/view-logs.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/view-logs/view-logs.vue?type=component"],"sourcesContent":["<script setup>\n\timport {\n\t\tonMounted\n\t} from 'vue';\n\timport {\n\t\tgetScene,\n\t\tdogdogdollVersion,\n\t\tglobal,\n\t\twebsiteUrl\n\t} from '../../common/config.js'\n\n\t// 生成独立访客ID\n\tconst getUVId = () => {\n\t\tlet uvid = uni.getStorageSync('ft_uvid');\n\t\tif (!uvid) {\n\t\t\t// 生成随机ID (1到2147483647之间)\n\t\t\tuvid = Math.floor(Math.random() * 2147483647) + 1;\n\t\t\tuni.setStorageSync('ft_uvid', uvid);\n\t\t}\n\t\treturn uvid;\n\t};\n\n\t// 获取当前页面路径\n\tconst getCurrentPagePath = () => {\n\t\tconst pages = getCurrentPages();\n\t\tif (pages.length === 0) return '';\n\t\treturn pages[pages.length - 1].route || '';\n\t};\n\n\t// 发送日志数据到后端\n\tconst sendViewLog = async () => {\n\t\tlet userInfo = uni.getStorageSync('userInfo')\n\t\tconst logData = {\n\t\t\tscene: getScene(), // 访问场景\n\t\t\tpath: getCurrentPagePath(), // 当前页面路径\n\t\t\tuid: userInfo ? userInfo.id : 0, // 用户ID（如果登录）\n\t\t\tuvid: getUVId(), // 独立访客ID\n\t\t\tversion: dogdogdollVersion // 版本号\n\t\t};\n\t\tconsole.log(\"logData:\", logData)\n\n\t\t// 确保所有必要数据都存在\n\t\tif (!logData.path) {\n\t\t\tconsole.warn('无法获取当前页面路径');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: `${websiteUrl.value}/log/view`,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdata: logData,\n\t\t\t\theader: {\n\t\t\t\t\t'content-type': 'application/json'\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tconsole.error('日志发送错误:', error);\n\t\t}\n\t};\n\n\tonMounted(() => {\n\t\t// 在组件挂载时发送日志\n\t\tsendViewLog();\n\t});\n</script>\n\n<template>\n\t<!-- 这是一个无UI组件，不需要渲染任何内容 -->\n</template>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/view-logs/view-logs.vue'\nwx.createComponent(Component)"],"names":["uni","getScene","dogdogdollVersion","websiteUrl","onMounted","Component"],"mappings":";;;;;;AAYC,UAAM,UAAU,MAAM;AACrB,UAAI,OAAOA,cAAAA,MAAI,eAAe,SAAS;AACvC,UAAI,CAAC,MAAM;AAEV,eAAO,KAAK,MAAM,KAAK,WAAW,UAAU,IAAI;AAChDA,sBAAAA,MAAI,eAAe,WAAW,IAAI;AAAA,MAClC;AACD,aAAO;AAAA,IACT;AAGC,UAAM,qBAAqB,MAAM;AAChC,YAAM,QAAQ;AACd,UAAI,MAAM,WAAW;AAAG,eAAO;AAC/B,aAAO,MAAM,MAAM,SAAS,CAAC,EAAE,SAAS;AAAA,IAC1C;AAGC,UAAM,cAAc,YAAY;AAC/B,UAAI,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC5C,YAAM,UAAU;AAAA,QACf,OAAOC,cAAAA,SAAU;AAAA;AAAA,QACjB,MAAM,mBAAoB;AAAA;AAAA,QAC1B,KAAK,WAAW,SAAS,KAAK;AAAA;AAAA,QAC9B,MAAM,QAAS;AAAA;AAAA,QACf,SAASC,cAAiB;AAAA;AAAA,MAC7B;AACEF,oBAAAA,+DAAY,YAAY,OAAO;AAG/B,UAAI,CAAC,QAAQ,MAAM;AAClBA,sBAAAA,MAAA,MAAA,QAAA,4CAAa,YAAY;AACzB;AAAA,MACA;AAED,UAAI;AACH,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC7B,KAAK,GAAGG,yBAAW,KAAK;AAAA,UACxB,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,QAAQ;AAAA,YACP,gBAAgB;AAAA,UAChB;AAAA,QACL,CAAI;AAAA,MACD,SAAQ,OAAO;AACfH,sBAAc,MAAA,MAAA,SAAA,4CAAA,WAAW,KAAK;AAAA,MAC9B;AAAA,IACH;AAECI,kBAAAA,UAAU,MAAM;AAEf;IACF,CAAE;;;;;;AC/DF,GAAG,gBAAgBC,SAAS;"}