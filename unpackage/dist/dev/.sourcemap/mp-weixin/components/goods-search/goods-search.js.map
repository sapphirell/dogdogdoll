{"version":3,"file":"goods-search.js","sources":["components/goods-search/goods-search.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/goods-search/goods-search.vue?type=component"],"sourcesContent":["<!-- goods-search -->\n<template>\r\n\t<!-- 新增遮罩层 -->\r\n\t<view v-if=\"showResults\" class=\"mask-layer\" @tap=\"closeResults\"></view>\r\n\t<view class=\"search_tab\" :class=\"$attrs.class\" :style=\"{ background: background || '#fff' }\">\r\n\t\t<image v-if=\"!hiddenIcon\" class=\"icon_image\" src=\"../../static/search.png\"></image>\r\n\t\t<input class=\"common_search_input\" placeholder=\"请输入娃物名称 (ㅇㅅㅇ❀)...\" :value=\"inputValue\" @input=\"onSearchInput\"\r\n\t\t\t:style=\"{ fontSize: fontSize || '23rpx' }\" />\r\n\t\t<image class=\"icon_image\" src=\"../../static/cancel.png\" @tap=\"cancel\" v-if=\"results.length > 0\"></image>\r\n\t</view>\r\n\r\n\t<!-- 商品搜索结果 -->\r\n\t <scroll-view \n\t    v-if=\"results.length > 0\" \n\t    class=\"search_results\" \n\t    :style=\"{ width: width }\" \n\t    scroll-y\n\t  >\r\n\t\t<view v-for=\"item in results\" :key=\"item.id\" class=\"result_item\" @tap=\"onTap(item)\">\r\n\t\t\t<view class=\"brand-tag\" v-if=\"item.brand_name\">{{ item.brand_name }}</view>\r\n\t\t\t<text class=\"goods-name\">{{ item.name }}</text>\r\n\t\t</view>\r\n\t</scroll-view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tcomputed,\n\t\twatch,\r\n\t} from 'vue';\r\n\timport {\r\n\t\twebsiteUrl\r\n\t} from \"../../common/config.js\";\r\n\r\n\t// 新增显示状态\r\n\tconst showResults = ref(false);\r\n\r\n\tconst props = defineProps({\r\n\t\tmodelValue: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: '100%'\r\n\t\t},\r\n\t\tbackground: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t},\r\n\t\tfontSize: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t},\r\n\t\ttagColor: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: '#666' // 新增标签颜色控制\r\n\t\t},\r\n\t\tmode: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'jump',\r\n\t\t\tvalidator: (value) => ['jump', 'fill'].includes(value)\r\n\t\t},\r\n\t\thiddenIcon: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\r\n\t});\r\n\r\n\tconst emit = defineEmits(['select', 'update:modelValue']);\r\n\t// const searchTerm = ref('');\r\n\tconst results = ref([]);\r\n\r\n\t// 使用computed处理输入值\r\n\tconst inputValue = computed({\r\n\t\tget: () => props.modelValue,\r\n\t\tset: (val) => emit('update:modelValue', val)\r\n\t});\r\n\r\n\r\n\t// 监听results变化控制遮罩层\r\n\twatch(results, (newVal) => {\r\n\t\tshowResults.value = newVal.length > 0;\r\n\t});\r\n\r\n\t// 新增关闭方法\r\n\tconst closeResults = () => {\r\n\t\tresults.value = [];\r\n\t\tshowResults.value = false;\r\n\t};\r\n\r\n\r\n\r\n\t// 修改onSearchInput方法\r\n\tconst onSearchInput = async (e) => {\r\n\t\tinputValue.value = e.detail.value; // 更新双向绑定值\r\n\t\tconst searchValue = e.detail.value.trim();\r\n\t\tshowResults.value = true; // 新增显示控制\r\n\t\tif (!searchValue) {\r\n\t\t\tresults.value = [];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst res = await uni.request({\r\n\t\t\t\turl: websiteUrl + `/search-goods?search=${encodeURIComponent(searchValue)}`,\r\n\t\t\t\tmethod: 'GET'\r\n\t\t\t});\r\n\r\n\t\t\tresults.value = res.data?.status === \"success\" ? res.data.data || [] : [];\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('搜索失败:', error);\r\n\t\t\tresults.value = [];\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tconst onTap = (goods) => {\r\n\t\tif (props.mode === 'jump') {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: `/pages/goods/goods?goods_id=${goods.id}`\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (props.mode === 'fill') {\r\n\t\t\temit('select', goods);\r\n\t\t\tinputValue.value = goods.name; // 直接更新双向绑定值\r\n\t\t\tresults.value = [];\r\n\t\t}\r\n\t\tcloseResults(); // 新增关闭\r\n\t};\r\n\r\n\tconst cancel = () => {\r\n\t\tcloseResults(); // 替换原有清空逻辑\r\n\t};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\t.search_tab {\r\n\t\t  display: flex;\n\t\t  align-items: center;\n\t\t  padding: 0 20rpx; /* 统一内边距 */\n\t\t  border-radius: 12rpx;\n\t\t  background: #fff;\n\t\t  height: 72rpx; /* 统一高度 */\n\t\t  width: 95%;\r\n\r\n\t\t.icon_image {\r\n\t\t\twidth: 36rpx;\r\n\t\t\theight: 36rpx;\r\n\t\t\tflex-shrink: 0;\r\n\r\n\t\t\t&:first-child {\r\n\t\t\t\tmargin-right: 16rpx;\r\n\t\t\t}\r\n\r\n\t\t\t&:last-child {\r\n\t\t\t\tmargin-left: 16rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.common_search_input {\r\n\t\t    flex: 1;\n\t\t    height: 100%;\n\t\t    padding: 0; /* 统一内边距 */\n\t\t    font-size: 23rpx; /* 统一字体大小 */\r\n\t\t}\r\n\t}\r\n\r\n\t.search_results {\r\n\t\t// margin-top: 100rpx;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 12rpx;\r\n\t\tbox-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.08);\r\n\t\tmax-height: 60vh;\r\n\t\tposition: absolute;\r\n\t\tz-index: 1001;\n\t\ttop: 80rpx;\r\n\r\n\t\t.result_item {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 24rpx;\r\n\t\t\tborder-bottom: 1rpx solid #f0f0f0;\r\n\r\n\t\t\t&:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t&:active {\r\n\t\t\t\tbackground: #f8f8f8;\r\n\t\t\t}\r\n\r\n\t\t\t.brand-tag {\r\n\t\t\t\tbackground: #f0f0f0;\r\n\t\t\t\tcolor: #666;\r\n\t\t\t\tfont-size: 20rpx;\r\n\t\t\t\tpadding: 4rpx 12rpx;\r\n\t\t\t\tborder-radius: 6rpx;\r\n\t\t\t\tmargin-right: 16rpx;\r\n\t\t\t\tline-height: 1.4;\r\n\t\t\t\tmax-width: 200rpx;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t}\r\n\r\n\t\t\t.goods-name {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.mask-layer {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground: rgba(0, 0, 0, 0);\r\n\t\tz-index: 20;\r\n\t\t/* 确保在搜索结果下方 */\r\n\t}\r\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/goods-search/goods-search.vue'\nwx.createComponent(Component)"],"names":["ref","computed","watch","uni","websiteUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCC,UAAM,cAAcA,kBAAI,KAAK;AAE7B,UAAM,QAAQ;AAiCd,UAAM,OAAO;AAEb,UAAM,UAAUA,kBAAI,CAAA,CAAE;AAGtB,UAAM,aAAaC,cAAAA,SAAS;AAAA,MAC3B,KAAK,MAAM,MAAM;AAAA,MACjB,KAAK,CAAC,QAAQ,KAAK,qBAAqB,GAAG;AAAA,IAC7C,CAAE;AAIDC,wBAAM,SAAS,CAAC,WAAW;AAC1B,kBAAY,QAAQ,OAAO,SAAS;AAAA,IACtC,CAAE;AAGD,UAAM,eAAe,MAAM;AAC1B,cAAQ,QAAQ;AAChB,kBAAY,QAAQ;AAAA,IACtB;AAKC,UAAM,gBAAgB,OAAO,MAAM;;AAClC,iBAAW,QAAQ,EAAE,OAAO;AAC5B,YAAM,cAAc,EAAE,OAAO,MAAM,KAAI;AACvC,kBAAY,QAAQ;AACpB,UAAI,CAAC,aAAa;AACjB,gBAAQ,QAAQ;AAChB;AAAA,MACA;AAED,UAAI;AACH,cAAM,MAAM,MAAMC,cAAG,MAAC,QAAQ;AAAA,UAC7B,KAAKC,cAAU,aAAG,wBAAwB,mBAAmB,WAAW,CAAC;AAAA,UACzE,QAAQ;AAAA,QACZ,CAAI;AAED,gBAAQ,UAAQ,SAAI,SAAJ,mBAAU,YAAW,YAAY,IAAI,KAAK,QAAQ,CAAA,IAAK,CAAA;AAAA,MACvE,SAAQ,OAAO;AACfD,sBAAA,MAAA,MAAA,SAAA,mDAAc,SAAS,KAAK;AAC5B,gBAAQ,QAAQ;MAChB;AAAA,IACH;AAGC,UAAM,QAAQ,CAAC,UAAU;AACxB,UAAI,MAAM,SAAS,QAAQ;AAC1BA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK,+BAA+B,MAAM,EAAE;AAAA,QAChD,CAAI;AAAA,MACD;AACD,UAAI,MAAM,SAAS,QAAQ;AAC1B,aAAK,UAAU,KAAK;AACpB,mBAAW,QAAQ,MAAM;AACzB,gBAAQ,QAAQ;MAChB;AACD;IACF;AAEC,UAAM,SAAS,MAAM;AACpB;IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtIA,GAAG,gBAAgB,SAAS;"}