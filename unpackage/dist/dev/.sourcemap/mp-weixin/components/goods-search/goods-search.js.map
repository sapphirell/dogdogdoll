{"version":3,"file":"goods-search.js","sources":["components/goods-search/goods-search.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/goods-search/goods-search.vue?type=component"],"sourcesContent":["<!-- goods-search -->\n<template>\n\t<!-- 新增遮罩层 -->\n\t<view v-if=\"showResults\" class=\"mask-layer\" @tap=\"closeResults\"></view>\n\t<view class=\"search_tab\" :class=\"$attrs.class\" :style=\"{ background: background || '#fff' }\">\n\t\t<image v-if=\"!hiddenIcon\" class=\"icon_image\" src=\"../../static/search.png\"></image>\n\t\t<input class=\"common_search_input\" placeholder=\"请输入娃物名称 (ㅇㅅㅇ❀)...\" :value=\"inputValue\" @input=\"onSearchInput\"\n\t\t\t:style=\"{ fontSize: fontSize || '23rpx' }\" />\n\t\t<image class=\"icon_image\" src=\"../../static/cancel.png\" @tap=\"cancel\" v-if=\"results.length > 0\"></image>\n\t</view>\n\n\t<!-- 商品搜索结果 -->\n\t <scroll-view \n\t    v-if=\"results.length > 0\" \n\t    class=\"search_results\" \n\t    :style=\"{ width: width }\" \n\t    scroll-y\n\t  >\n\t\t<view v-for=\"item in results\" :key=\"item.id\" class=\"result_item\" @tap=\"onTap(item)\">\n\t\t\t<view class=\"brand-tag\" v-if=\"item.brand_name\">{{ item.brand_name }}</view>\n\t\t\t<text class=\"goods-name\">{{ item.name }}</text>\n\t\t</view>\n\t</scroll-view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tcomputed,\n\t\twatch,\n\t} from 'vue';\n\timport {\n\t\twebsiteUrl\n\t} from \"../../common/config.js\";\n\n\t// 新增显示状态\n\tconst showResults = ref(false);\n\n\tconst props = defineProps({\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\twidth: {\n\t\t\ttype: String,\n\t\t\tdefault: '100%'\n\t\t},\n\t\tbackground: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tfontSize: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\ttagColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#666' // 新增标签颜色控制\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\tdefault: 'jump',\n\t\t\tvalidator: (value) => ['jump', 'fill'].includes(value)\n\t\t},\n\t\thiddenIcon: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t brandId: { // 新增brandId属性\n\t\t  type: Number,\n\t\t  default: 0\n\t\t}\n\t});\n\n\tconst emit = defineEmits(['select', 'update:modelValue']);\n\t// const searchTerm = ref('');\n\tconst results = ref([]);\n\n\t// 使用computed处理输入值\n\tconst inputValue = computed({\n\t\tget: () => props.modelValue,\n\t\tset: (val) => emit('update:modelValue', val)\n\t});\n\n\n\t// 监听results变化控制遮罩层\n\twatch(results, (newVal) => {\n\t\tshowResults.value = newVal.length > 0;\n\t});\n\n\t// 新增关闭方法\n\tconst closeResults = () => {\n\t\tresults.value = [];\n\t\tshowResults.value = false;\n\t};\n\n\n\n\t// 修改onSearchInput方法\n\tconst onSearchInput = async (e) => {\n\t\tinputValue.value = e.detail.value; // 更新双向绑定值\n\t\tconst searchValue = e.detail.value.trim();\n\t\tshowResults.value = true; // 新增显示控制\n\t\tif (!searchValue) {\n\t\t\tresults.value = [];\n\t\t\treturn;\n\t\t}\n\t\tlet url = `${websiteUrl.value}/search-goods?search=${encodeURIComponent(searchValue)}`;\n\t\t  if (props.brandId && props.brandId !== 0) {\n\t\t\turl += `&brand_id=${props.brandId}`;\n\t\t  }\n\t\ttry {\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: url,\n\t\t\t\tmethod: 'GET'\n\t\t\t});\n\n\t\t\tresults.value = res.data?.status === \"success\" ? res.data.data || [] : [];\n\t\t} catch (error) {\n\t\t\tconsole.error('搜索失败:', error);\n\t\t\tresults.value = [];\n\t\t}\n\t};\n\n\n\tconst onTap = (goods) => {\n\t\tif (props.mode === 'jump') {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/goods/goods?goods_id=${goods.id}`\n\t\t\t});\n\t\t}\n\t\tif (props.mode === 'fill') {\n\t\t\temit('select', goods);\n\t\t\tinputValue.value = goods.name; // 直接更新双向绑定值\n\t\t\tresults.value = [];\n\t\t}\n\t\tcloseResults(); // 新增关闭\n\t};\n\n\tconst cancel = () => {\n\t\tcloseResults(); // 替换原有清空逻辑\n\t};\n</script>\n\n<style lang=\"less\" scoped>\n\t.search_tab {\n\t\t  display: flex;\n\t\t  align-items: center;\n\t\t  padding: 0 20rpx; /* 统一内边距 */\n\t\t  border-radius: 12rpx;\n\t\t  background: #fff;\n\t\t  height: 72rpx; /* 统一高度 */\n\t\t  width: 95%;\n\n\t\t.icon_image {\n\t\t\twidth: 36rpx;\n\t\t\theight: 36rpx;\n\t\t\tflex-shrink: 0;\n\n\t\t\t&:first-child {\n\t\t\t\tmargin-right: 16rpx;\n\t\t\t}\n\n\t\t\t&:last-child {\n\t\t\t\tmargin-left: 16rpx;\n\t\t\t}\n\t\t}\n\n\t\t.common_search_input {\n\t\t    flex: 1;\n\t\t    height: 100%;\n\t\t    padding: 0; /* 统一内边距 */\n\t\t    font-size: 23rpx; /* 统一字体大小 */\n\t\t}\n\t}\n\n\t.search_results {\n\t\t// margin-top: 100rpx;\n\t\tbackground: #fff;\n\t\tborder-radius: 12rpx;\n\t\tbox-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.08);\n\t\tmax-height: 60vh;\n\t\tposition: absolute;\n\t\tz-index: 1001;\n\t\t// top: 80rpx;\n\n\t\t.result_item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tpadding: 24rpx;\n\t\t\tborder-bottom: 1rpx solid #f0f0f0;\n\n\t\t\t&:last-child {\n\t\t\t\tborder-bottom: none;\n\t\t\t}\n\n\t\t\t&:active {\n\t\t\t\tbackground: #f8f8f8;\n\t\t\t}\n\n\t\t\t.brand-tag {\n\t\t\t\tbackground: #f0f0f0;\n\t\t\t\tcolor: #666;\n\t\t\t\tfont-size: 20rpx;\n\t\t\t\tpadding: 4rpx 12rpx;\n\t\t\t\tborder-radius: 6rpx;\n\t\t\t\tmargin-right: 16rpx;\n\t\t\t\tline-height: 1.4;\n\t\t\t\tmax-width: 200rpx;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t}\n\n\t\t\t.goods-name {\n\t\t\t\tflex: 1;\n\t\t\t\tcolor: #333;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\t\t}\n\t}\n\n\t.mask-layer {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: rgba(0, 0, 0, 0);\n\t\tz-index: 20;\n\t\t/* 确保在搜索结果下方 */\n\t}\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/goods-search/goods-search.vue'\nwx.createComponent(Component)"],"names":["ref","computed","watch","websiteUrl","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCC,UAAM,cAAcA,kBAAI,KAAK;AAE7B,UAAM,QAAQ;AAoCd,UAAM,OAAO;AAEb,UAAM,UAAUA,kBAAI,CAAA,CAAE;AAGtB,UAAM,aAAaC,cAAAA,SAAS;AAAA,MAC3B,KAAK,MAAM,MAAM;AAAA,MACjB,KAAK,CAAC,QAAQ,KAAK,qBAAqB,GAAG;AAAA,IAC7C,CAAE;AAIDC,wBAAM,SAAS,CAAC,WAAW;AAC1B,kBAAY,QAAQ,OAAO,SAAS;AAAA,IACtC,CAAE;AAGD,UAAM,eAAe,MAAM;AAC1B,cAAQ,QAAQ;AAChB,kBAAY,QAAQ;AAAA,IACtB;AAKC,UAAM,gBAAgB,OAAO,MAAM;;AAClC,iBAAW,QAAQ,EAAE,OAAO;AAC5B,YAAM,cAAc,EAAE,OAAO,MAAM,KAAI;AACvC,kBAAY,QAAQ;AACpB,UAAI,CAAC,aAAa;AACjB,gBAAQ,QAAQ;AAChB;AAAA,MACA;AACD,UAAI,MAAM,GAAGC,yBAAW,KAAK,wBAAwB,mBAAmB,WAAW,CAAC;AAClF,UAAI,MAAM,WAAW,MAAM,YAAY,GAAG;AAC3C,eAAO,aAAa,MAAM,OAAO;AAAA,MAC/B;AACH,UAAI;AACH,cAAM,MAAM,MAAMC,cAAG,MAAC,QAAQ;AAAA,UAC7B;AAAA,UACA,QAAQ;AAAA,QACZ,CAAI;AAED,gBAAQ,UAAQ,SAAI,SAAJ,mBAAU,YAAW,YAAY,IAAI,KAAK,QAAQ,CAAA,IAAK,CAAA;AAAA,MACvE,SAAQ,OAAO;AACfA,sBAAA,MAAA,MAAA,SAAA,mDAAc,SAAS,KAAK;AAC5B,gBAAQ,QAAQ;MAChB;AAAA,IACH;AAGC,UAAM,QAAQ,CAAC,UAAU;AACxB,UAAI,MAAM,SAAS,QAAQ;AAC1BA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK,+BAA+B,MAAM,EAAE;AAAA,QAChD,CAAI;AAAA,MACD;AACD,UAAI,MAAM,SAAS,QAAQ;AAC1B,aAAK,UAAU,KAAK;AACpB,mBAAW,QAAQ,MAAM;AACzB,gBAAQ,QAAQ;MAChB;AACD;IACF;AAEC,UAAM,SAAS,MAAM;AACpB;IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5IA,GAAG,gBAAgB,SAAS;"}