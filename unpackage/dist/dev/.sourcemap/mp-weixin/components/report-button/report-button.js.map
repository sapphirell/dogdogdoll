{"version":3,"file":"report-button.js","sources":["components/report-button/report-button.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/report-button/report-button.vue?type=component"],"sourcesContent":["<template>\n\t<!-- 举报按钮 - 横向布局 -->\n\t<view class=\"report-button\" @click=\"handleClick\">\n\t\t<slot>\n\t\t\t<view class=\"default-button horizontal\">\n\t\t\t\t<uni-icons :v-if=\"iconType !== ''\" :type=\"iconType\" :size=\"  parseInt(iconSize)\" :color=\"iconColor\"></uni-icons>\n\t\t\t\t<text class=\"button-text\">{{ buttonText }}</text>\n\t\t\t</view>\n\t\t</slot>\n\t</view>\n\t\n\t<!-- 举报弹窗 -->\n\t<common-modal :visible=\"reportVisible\" @update:visible=\"val => reportVisible = val\" top=\"10vh\">\n\t\t<view class=\"report-dialog\">\n\t\t\t<view class=\"dialog-header\">\n\t\t\t\t<text class=\"dialog-title\">举报内容</text>\n\t\t\t\t<uni-icons type=\"closeempty\" size=\"24\" color=\"#999\" @click=\"reportVisible = false\"></uni-icons>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"reason-list\">\n\t\t\t\t<view \n\t\t\t\t\tv-for=\"reason in reportReasons\" \n\t\t\t\t\t:key=\"reason.id\" \n\t\t\t\t\tclass=\"reason-item\"\n\t\t\t\t\t@click=\"selectReason(reason.label)\"\n\t\t\t\t\t:class=\"{'selected': selectedReason === reason.label}\"\n\t\t\t\t>\n\t\t\t\t\t<radio \n\t\t\t\t\t\t:value=\"reason.label\" \n\t\t\t\t\t\t:checked=\"selectedReason === reason.label\"\n\t\t\t\t\t\t:color=\"themeColor\" \n\t\t\t\t\t/>\n\t\t\t\t\t<text class=\"reason-label\">{{ reason.label }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"details-box\">\n\t\t\t\t<textarea \n\t\t\t\t\tv-model=\"reportDetails\" \n\t\t\t\t\tplaceholder=\"请详细描述举报原因（选填）\" \n\t\t\t\t\tclass=\"details-input\" \n\t\t\t\t\tmaxlength=\"200\"\n\t\t\t\t\t:focus=\"autoFocus\"\n\t\t\t\t/>\n\t\t\t\t<text class=\"word-count\">{{ reportDetails.length }}/200</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"button-group\">\n\t\t\t\t<button class=\"cancel-btn\" @click=\"reportVisible = false\">取消</button>\n\t\t\t\t<button class=\"submit-btn\" @click=\"submitReport\" :style=\"{ backgroundColor: themeColor }\">提交举报</button>\n\t\t\t</view>\n\t\t</view>\n\t</common-modal>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tcomputed,\n\t\twatch\n\t} from 'vue'\n\timport {\n\t\twebsiteUrl,\n\t\tglobal,\n\t\tasyncGetUserInfo,\n\t\twechatSignLogin\n\t} from '@/common/config.js'\n\n\tconst props = defineProps({\n\t\t// 举报类型（1=展示柜,2=搭配,3=树洞发帖,4=用户，5=回帖）\n\t\treportType: {\n\t\t\ttype: Number,\n\t\t\trequired: true\n\t\t},\n\t\t// 关联ID（被举报内容的ID）\n\t\trelationId: {\n\t\t\ttype: Number,\n\t\t\trequired: true\n\t\t},\n\t\t// 按钮文本\n\t\tbuttonText: {\n\t\t\ttype: String,\n\t\t\tdefault: '举报'\n\t\t},\n\t\t// 图标类型\n\t\ticonType: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\t// 图标大小\n\t\ticonSize: {\n\t\t\ttype: String,\n\t\t\tdefault: 24\n\t\t},\n\t\t// 图标颜色\n\t\ticonColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#999'\n\t\t},\n\t\t// 主题颜色\n\t\tthemeColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#64c6dc'\n\t\t},\n\t\t// 是否自动聚焦文本输入框\n\t\tautoFocus: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t}\n\t})\n\n\tconst emit = defineEmits(['success', 'error', 'cancel', 'before-submit'])\n\n\tconst reportVisible = ref(false)\n\tconst reportReasons = ref([])\n\tconst selectedReason = ref('')\n\tconst reportDetails = ref('')\n\tconst isSubmitting = ref(false)\n\n\t// 选择举报原因\n\tconst selectReason = (reason) => {\n\t\t// 如果点击的是已选中的原因，则取消选择\n\t\tif (selectedReason.value === reason) {\n\t\t\tselectedReason.value = ''\n\t\t} else {\n\t\t\tselectedReason.value = reason\n\t\t}\n\t}\n\n\n\n\t// 获取举报原因\n\tconst fetchReportReasons = async () => {\n\t\ttry {\n\t\t\tconst token = uni.getStorageSync('token')\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: `${websiteUrl}/report/reasons?type=${props.reportType}`,\n\t\t\t\tmethod: 'GET',\n\t\t\t\theader: {\n\t\t\t\t\t'Authorization': token,\n\t\t\t\t},\n\t\t\t})\n\n\t\t\tif (res.data.status === 'success') {\n\t\t\t\treportReasons.value = res.data.data\n\t\t\t\treturn true\n\t\t\t} else {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '获取举报原因失败: ' + (res.data.msg || ''),\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn false\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '网络请求失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t\treturn false\n\t\t}\n\t}\n\n\t// 处理举报按钮点击\n\tconst handleClick = async () => {\n\t\t// 获取举报原因\n\t\tconst success = await fetchReportReasons()\n\t\tif (!success) return\n\n\t\t// 重置表单\n\t\tselectedReason.value = ''\n\t\treportDetails.value = ''\n\n\t\t// 显示弹窗\n\t\treportVisible.value = true\n\t}\n\n\t// 提交举报\n\tconst submitReport = async () => {\n\t\tif (isSubmitting.value) return\n\t\tisSubmitting.value = true\n\n\t\ttry {\n\t\t\tif (!selectedReason.value) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '请选择举报原因',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// 触发提交前事件\n\t\t\temit('before-submit', {\n\t\t\t\ttype: props.reportType,\n\t\t\t\trelationId: props.relationId,\n\t\t\t\treason: selectedReason.value,\n\t\t\t\tdetails: reportDetails.value\n\t\t\t})\n\n\t\t\tconst token = uni.getStorageSync('token')\n\t\t\tconst reportData = {\n\t\t\t\ttype: props.reportType,\n\t\t\t\trelation_id: props.relationId,\n\t\t\t\treason: selectedReason.value,\n\t\t\t\tdetails: reportDetails.value\n\t\t\t}\n\t\t\tlet url = `${websiteUrl}/with-state/report/submit`\n\t\t\t\n\t\t\tif (token == \"\") {\n\t\t\t\turl = `${websiteUrl}/report/submit`\n\t\t\t}\n\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: url,\n\t\t\t\tmethod: 'POST',\n\t\t\t\theader: {\n\t\t\t\t\t'Authorization': token,\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tdata: reportData,\n\t\t\t\ttimeout: 10000 // 10秒超时\n\t\t\t})\n\n\t\t\tif (res.data.status === 'success') {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '举报提交成功',\n\t\t\t\t\ticon: 'success',\n\t\t\t\t\tduration: 2000\n\t\t\t\t})\n\t\t\t\treportVisible.value = false\n\t\t\t\t// 触发成功事件\n\t\t\t\temit('success', res.data)\n\t\t\t} else {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: res.data.msg || '举报提交失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\t// 触发错误事件\n\t\t\t\temit('error', res.data)\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '举报提交失败: ' + (error.errMsg || '网络错误'),\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t\t// 触发错误事件\n\t\t\temit('error', error)\n\t\t} finally {\n\t\t\tisSubmitting.value = false\n\t\t}\n\t}\n\n\t// 监听弹窗关闭\n\twatch(reportVisible, (newVal) => {\n\t\tif (!newVal) {\n\t\t\temit('cancel')\n\t\t}\n\t})\n</script>\n\n<style lang=\"less\" scoped>\n.report-button {\n  display: inline-flex;\n  align-items: center;\n  cursor: pointer;\n  background-color: transparent; /* 透明背景 */\n  \n  /* 横向按钮样式 */\n  .default-button.horizontal {\n    display: flex;\n    flex-direction: row; /* 横向布局 */\n    align-items: center;\n    padding: 6rpx 16rpx;\n    border-radius: 36rpx;\n    background-color: transparent; /* 透明背景 */\n    \n    .button-text {\n      font-size: 22rpx; /* 稍微放大文字 */\n      color: #999; /* 深一点的颜色 */\n      margin-left: 8rpx; /* 图标和文字间距 */\n      font-weight: 500;\n\t  width: 50rpx;\n    }\n  }\n  \n  /* 移除默认按钮的边框 */\n  &::after {\n    border: none;\n  }\n}\n\nuni-button {\n  &::after {\n    border: none;\n  }\n}\n\n.report-dialog {\n  padding: 24rpx;\n  width: 86vw;\n  max-width: 560rpx;\n  background-color: #fff;\n  border-radius: 14rpx;\n  box-sizing: border-box;\n}\n\n.dialog-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20rpx;\n  padding-bottom: 16rpx;\n  border-bottom: 1rpx solid #eee;\n  \n  .dialog-title {\n    font-size: 32rpx;\n    font-weight: bold;\n    color: #333;\n  }\n}\n\n.reason-list {\n  max-height: 50vh;\n  overflow-y: auto;\n  margin-bottom: 24rpx;\n  padding: 8rpx 0;\n}\n\n.reason-item {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 0;\n  border-radius: 8rpx;\n  cursor: pointer; /* 手型指针 */\n  \n  /* 选中状态效果 */\n  &.selected {\n    background-color: rgba(100, 198, 220, 0.1); /* 浅蓝色背景 */\n  }\n  \n  /* 悬停效果 */\n  &:hover {\n    background-color: #f9f9f9;\n  }\n  \n  .reason-label {\n    font-size: 26rpx;\n    margin-left: 16rpx;\n    color: #333;\n    flex: 1;\n    padding: 10rpx 0; /* 扩大点击区域 */\n  }\n}\n\n.details-box {\n  position: relative;\n  margin-bottom: 32rpx;\n  background-color: #f8f8f8;\n  border-radius: 10rpx;\n  overflow: hidden;\n  \n  .details-input {\n    width: 100%;\n    height: 180rpx;\n    padding: 16rpx;\n    font-size: 26rpx;\n    box-sizing: border-box;\n    background-color: transparent;\n  }\n  \n  .word-count {\n    position: absolute;\n    right: 12rpx;\n    bottom: 12rpx;\n    font-size: 22rpx;\n    color: #999;\n  }\n}\n\n.button-group {\n  display: flex;\n  justify-content: space-between;\n  gap: 16rpx;\n  \n  .cancel-btn, .submit-btn {\n    flex: 1;\n    height: 72rpx;\n    line-height: 72rpx;\n    border-radius: 36rpx;\n    font-size: 28rpx;\n    transition: all 0.3s;\n    \n    &:active {\n      opacity: 0.8;\n      transform: scale(0.98);\n    }\n  }\n  \n  .cancel-btn {\n    background-color: #f5f5f5;\n    color: #666;\n    font-size: 26rpx;\n  }\n  \n  .submit-btn {\n    color: white;\n    border: none;\n    background-color: #64c6dc;\n  }\n}\n\n/* 单选按钮使用新主题色 */\n::v-deep .uni-radio-input.uni-radio-input-checked {\n  border-color: #64c6dc !important;\n  background-color: #64c6dc !important;\n}\n\n/* 弹窗关闭按钮缩小 */\n::v-deep .uni-icons {\n  font-size: 22rpx !important;\n}\n</style>\n","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/report-button/report-button.vue'\nwx.createComponent(Component)"],"names":["ref","uni","websiteUrl","watch"],"mappings":"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"}