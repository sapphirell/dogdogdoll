{"version":3,"file":"comment-input.js","sources":["components/comment-input/comment-input.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/comment-input/comment-input.vue?type=component"],"sourcesContent":["<!-- /components/comment-input.vue -->\r\n<template>\r\n\t<!-- 蒙版层 -->\r\n\t<view class=\"mask\" v-show=\"displayMask\" @tap=\"handleMaskTap\"></view>\r\n\r\n\t<!-- 评论框 -->\r\n\t<view class=\"bottom_tab\" :adjust-position=\"false\" :style=\"{ paddingBottom: footerBottomHeight }\">\r\n\t\t<!-- 输入框 -->\r\n\t\t<textarea :focus=\"isFocused\" class=\"comment_input unified-textarea\" :class=\"{ expanded: isFocused }\" ref=\"inputRef\"\r\n\t\t\tv-model=\"commentText\" @focus=\"handleFocus\" @blur=\"handleBlur\" :adjust-position=\"false\"\r\n\t\t\t:placeholder=\"replyInfo.username ? '回复@' + replyInfo.username + ' ' : '写评论...'\"></textarea>\r\n\r\n\t\t<!-- 按钮 -->\r\n\t\t<button @click=\"handleSubmit\">写评论</button>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tcomputed,\r\n\t\tgetCurrentInstance,\r\n\t} from 'vue'\r\n\timport {\r\n\t\tonLoad,\r\n\t\tonShow\r\n\t} from \"@dcloudio/uni-app\";\r\n\r\n\timport {\r\n\t\tgetScene\r\n\t} from \"@/common/config.js\"\r\n\tconst props = defineProps({\r\n\t\treplyInfo: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({})\r\n\t\t},\r\n\t\ttargetId: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\tsafeBottom: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 10\r\n\t\t}\r\n\t})\r\n\t// 暴露聚焦方法\r\n\tconst inputRef = ref(null) // 需要关联到真实的textarea元素\r\n\t// 聚焦状态\r\n\tconst isFocused = ref(false)\r\n\r\n\tconst emit = defineEmits(['submit', 'update:replyInfo'])\r\n\tconst instance = getCurrentInstance()\r\n\tconst commentText = ref('')\r\n\tconst displayMask = ref(false)\r\n\tconst keyboardHeight = ref(0)\r\n\tconst systemInfo = uni.getSystemInfoSync()\r\n\tconst footerBottomHeight = computed(() => {\r\n\t\tlet safeBottomVar = systemInfo.safeAreaInsets?.bottom || 10\r\n\t\tconsole.log(\"底部安全距离1:\", systemInfo.safeAreaInsets?.bottom, \"=>\", safeBottomVar)\r\n\r\n\t\tconst safeBottom = safeBottomVar + keyboardHeight.value\r\n\t\treturn `${safeBottom}px`\r\n\t})\r\n\r\n\tconst keyboardHeightChangeHandler = (res) => {\r\n\t\tconsole.log(\"键盘高度变化\", res)\r\n\t\tkeyboardHeight.value = res.height\r\n\t}\r\n\r\n\tconst handleFocus = () => {\r\n\t\tdisplayMask.value = true\r\n\t\tisFocused.value = true\r\n\t}\r\n\r\n\tconst handleBlur = () => {\r\n\t\tdisplayMask.value = false\r\n\t\tisFocused.value = false\r\n\t}\r\n\r\n\tconst handleMaskTap = () => {\r\n\t\tdisplayMask.value = false\r\n\t\tisFocused.value = false\r\n\t\tuni.hideKeyboard()\r\n\t}\r\n\r\n\tconst handleSubmit = () => {\r\n\t\tif (!commentText.value.trim()) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请输入评论内容',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet scene = getScene()\r\n\t\tconsole.log(\"scene\", scene)\r\n\t\temit('submit', {\r\n\t\t\tcontent: commentText.value,\r\n\t\t\ttarget_id: props.targetId,\r\n\t\t\ttype: 4,\r\n\t\t\treplyInfo: props.replyInfo,\r\n\t\t\torigin: scene,\r\n\t\t})\r\n\r\n\t\tcommentText.value = ''\r\n\t\temit('update:replyInfo', {})\r\n\t}\r\n\r\n\r\n\t// 暴露聚焦方法\r\n\tconst focusInput = () => {\n\t\tisFocused.value = true\r\n\t}\r\n\r\n\tdefineExpose({\r\n\t\tfocusInput\r\n\t})\r\n\r\n\tonShow(() => {\r\n\t\tif (process.env.VUE_APP_PLATFORM == \"h5\") {\r\n\t\t\t//h5不会弹出软键盘\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconsole.log(\"注册键盘弹出事件\")\r\n\t\tuni.onKeyboardHeightChange(keyboardHeightChangeHandler)\r\n\t})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\t/* 保持原样式不变 */\r\n\t.mask {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground: #fff;\r\n\t\topacity: 0;\r\n\t\tz-index: 99;\r\n\t\twidth: 100vw;\r\n\t\theight: 100vh;\r\n\t}\r\n\r\n\t// 底部tab\r\n\t.bottom_tab {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\t/* 垂直居中 */\r\n\t\tgap: 8px;\r\n\t\t/* 元素间距 */\r\n\t\tpadding: 10px;\r\n\t\tbox-sizing: border-box;\r\n\t\tleft: 0px;\r\n\t\tposition: fixed;\r\n\t\tbottom: 0px;\r\n\t\tz-index: 100;\r\n\t\twidth: 100vw;\r\n\t\tbackground: #fff;\r\n\r\n\t\t.replyInfo {\r\n\t\t\tflex-shrink: 0;\r\n\t\t\t/* 禁止缩小 */\r\n\t\t\tmax-width: 50px;\r\n\t\t\t/* 最大宽度限制 */\r\n\t\t\toverflow: hidden;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t\twhite-space: nowrap;\r\n\t\t\tflex-shrink: 0;\r\n\t\t\tmax-width: 50px;\r\n\t\t\tmargin-right: 8px;\r\n\t\t}\r\n\r\n\t\t.comment_input {\r\n\t\t\tflex: 1;\r\n\t\t\t/* 占据剩余空间 */\r\n\t\t\tmin-width: 0;\r\n\t\t\t/* 允许缩小 */\r\n\t\t\tflex: 1;\r\n\t\t\tmargin-right: 8px;\r\n\t\t\t// min-height: 56rpx;\r\n\t\t\tbackground: #f2f2f2;\r\n\t\t\tborder-radius: 5px;\r\n\t\t\tpadding: 8px 8px 8px 10px;\r\n\t\t\tline-height: normal;\r\n\t\t\tfont-size: 26rpx;\r\n\t\t\tcolor: #373838;\r\n\t\t\t// 聚焦时高度2倍\r\n\t\t\theight: 40rpx;\r\n\t\t\ttransition: height 0.3s ease;\r\n\r\n\t\t}\r\n\r\n\t\t.comment_input.expanded {\r\n\t\t\theight: 80rpx !important;\r\n\t\t}\r\n\r\n\t\tbutton {\r\n\t\t\tflex-shrink: 0;\r\n\t\t\t/* 固定宽度 */\r\n\t\t\twidth: 90px;\r\n\t\t\t/* 按钮固定宽度 */\r\n\t\t\tbackground: rgb(100, 198, 220);\r\n\t\t\tborder-radius: 10px;\r\n\t\t\twidth: 90px;\r\n\t\t\tcolor: rgb(255, 255, 255);\r\n\t\t\tfont-size: 14px;\r\n\t\t}\r\n\t}\r\n\r\n\tuni-button:after {\r\n\t\tborder: none;\r\n\t}\r\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/comment-input/comment-input.vue'\nwx.createComponent(Component)"],"names":["ref","uni","computed","getScene","onShow"],"mappings":";;;;;;;;;;;;;;;;;;;;;AA+BC,UAAM,QAAQ;AAeGA,kBAAAA,IAAI,IAAI;AAEnB,UAAA,YAAYA,kBAAI,KAAK;AAE3B,UAAM,OAAO;AAEP,UAAA,cAAcA,kBAAI,EAAE;AACpB,UAAA,cAAcA,kBAAI,KAAK;AACvB,UAAA,iBAAiBA,kBAAI,CAAC;AACtB,UAAA,aAAaC,oBAAI;AACjB,UAAA,qBAAqBC,cAAAA,SAAS,MAAM;;AACrC,UAAA,kBAAgB,gBAAW,mBAAX,mBAA2B,WAAU;AACzDD,oBAAAA,MAAA,MAAA,OAAA,oDAAY,aAAY,gBAAW,mBAAX,mBAA2B,QAAQ,MAAM,aAAa;AAExE,YAAA,aAAa,gBAAgB,eAAe;AAClD,aAAO,GAAG,UAAU;AAAA,IAAA,CACpB;AAEK,UAAA,8BAA8B,CAAC,QAAQ;AAC5CA,oBAAA,MAAY,MAAA,OAAA,oDAAA,UAAU,GAAG;AACzB,qBAAe,QAAQ,IAAI;AAAA,IAAA;AAG5B,UAAM,cAAc,MAAM;AACzB,kBAAY,QAAQ;AACpB,gBAAU,QAAQ;AAAA,IAAA;AAGnB,UAAM,aAAa,MAAM;AACxB,kBAAY,QAAQ;AACpB,gBAAU,QAAQ;AAAA,IAAA;AAGnB,UAAM,gBAAgB,MAAM;AAC3B,kBAAY,QAAQ;AACpB,gBAAU,QAAQ;AAClBA,oBAAA,MAAI,aAAa;AAAA,IAAA;AAGlB,UAAM,eAAe,MAAM;AAC1B,UAAI,CAAC,YAAY,MAAM,QAAQ;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AACD;AAAA,MACD;AACA,UAAI,QAAQE,cAAAA;AACZF,oBAAA,MAAY,MAAA,OAAA,oDAAA,SAAS,KAAK;AAC1B,WAAK,UAAU;AAAA,QACd,SAAS,YAAY;AAAA,QACrB,WAAW,MAAM;AAAA,QACjB,MAAM;AAAA,QACN,WAAW,MAAM;AAAA,QACjB,QAAQ;AAAA,MAAA,CACR;AAED,kBAAY,QAAQ;AACf,WAAA,oBAAoB,CAAA,CAAE;AAAA,IAAA;AAK5B,UAAM,aAAa,MAAM;AACxB,gBAAU,QAAQ;AAAA,IAAA;AAGN,aAAA;AAAA,MACZ;AAAA,IAAA,CACA;AAEDG,kBAAAA,OAAO,MAAM;AAKZH,oBAAAA,MAAA,MAAA,OAAA,qDAAY,UAAU;AACtBA,0BAAI,uBAAuB,2BAA2B;AAAA,IAAA,CACtD;;;;;;;;;;;;;;;;;;;AC3HF,GAAG,gBAAgB,SAAS;"}