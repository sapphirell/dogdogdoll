{"version":3,"file":"common-search.js","sources":["components/common-search/common-search.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/common-search/common-search.vue?type=component"],"sourcesContent":["<!-- common-search -->\n<template>\n\t<view style=\"width:100%\">\n\t\t<view class=\"search_tab\" :class=\"$attrs.class\" :style=\"{\n\t\t\t\tbackground: background || '#fff'\n\t\t\t}\">\n\t\t\t<image class=\"icon_image\" src=\"../../static/search.png\" v-if=\"props.mode == 'jump'\"></image>\n\t\t\t<!-- 索引选择器 - 修改为蓝色样式 -->\n\t\t\t<view v-if=\"showIndexSelector\" class=\"index-selector\">\n\t\t\t\t<picker mode=\"selector\" :value=\"selectedIndex\" :range=\"indexLabels\" @change=\"handleIndexChange\">\n\t\t\t\t\t<view class=\"selector-content\">\n\t\t\t\t\t\t<text>{{ currentIndexLabel }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t<input class=\"common_search_input\" placeholder=\"可以模糊搜索 o( ❛ᴗ❛ )o …\" v-model=\"searchTerm\"\n\t\t\t\t@input=\"onSearchInput\" :ignoreCompositionEvent=\"false\" />\n\t\t\t<view class=\"search-info-tap\" v-if=\"results.length > 0\">\n\t\t\t\t<text v-if=\"results.length > 0 && searchTerm.length < 5\">拼音、缩写、别名都可以搜</text>\n\t\t\t\t<image class=\"icon_image\" src=\"../../static/cancel.png\" @tap=\"cancel\"></image>\n\t\t\t</view>\n\t\t\t\n\t\t\t\n\t\t</view>\n\n\t\t<view style=\"position: relative;\">\n\t\t\t<!-- 显示搜索结果 -->\n\t\t\t<scroll-view v-if=\"results.length > 0\" class=\"search_results\" style=\"height: 600rpx;\"\n\t\t\t\t:style=\"{width: width}\" scroll-y>\n\t\t\t\t<view class=\"close-associate result_item\" @tap=\"closeAssociate\" style=\"padding-top: 0;text-align: center;\">\n\t\t\t\t\t<text>关闭联想</text>\n\t\t\t\t</view>\n\t\t\t\t<view v-for=\"item in results\" :key=\"item.id\" class=\"result_item\" @tap=\"onTap(item.id, item.name)\">\n\t\t\t\t\t{{ item.name }}\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tcomputed\n\t} from 'vue';\n\timport {\n\t\twebsiteUrl,\n\t} from \"../../common/config.js\";\n\n\t// 新增 props 接收父组件参数\n\tconst props = defineProps({\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\tdefault: 'jump', // 默认跳转模式\n\t\t\tvalidator: (value) => ['jump', 'fill'].includes(value) // 参数校验\n\t\t},\n\t\twidth: {\n\t\t\ttype: String,\n\t\t\tdefault: '100%'\n\t\t},\n\t\tbackground: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tfontSize: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\t// 新增：是否显示索引选择器\n\t\tshowIndexSelector: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\t// 新增：索引选项配置\n\t\tindexOptions: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [\n\t\t\t\t{ label: \"店铺\", value: \"\" },\n\t\t\t\t{ label: \"妆师\", value: \"bjd_artist\" },\n\t\t\t\t{ label: \"毛娘\", value: \"hairstylist\" }\n\t\t\t]\n\t\t},\n\t\t// 新增：默认选中的索引\n\t\tdefaultIndex: {\n\t\t\ttype: String,\n\t\t\tdefault: \"\"\n\t\t}\n\t});\n\t\n\tdefineOptions({\n\t\tinheritAttrs: false\n\t})\n\t\n\t// 新增事件定义\n\tconst emit = defineEmits(['select', 'close-associate', 'index-change']);\n\n\tconst searchTerm = ref('');\n\tconst results = ref([]);\n\tconst currentIndex = ref(props.defaultIndex || (props.indexOptions[0]?.value || \"\"));\n\t\n\t// 当前索引对应的标签\n\tconst currentIndexLabel = computed(() => {\n\t\tconst option = props.indexOptions.find(opt => opt.value === currentIndex.value);\n\t\treturn option ? option.label : \"选择类型\";\n\t});\n\t\n\t// 索引标签数组（用于picker的range属性）\n\tconst indexLabels = computed(() => {\n\t\treturn props.indexOptions.map(opt => opt.label);\n\t});\n\t\n\t// 当前选中的索引位置\n\tconst selectedIndex = computed(() => {\n\t\treturn props.indexOptions.findIndex(opt => opt.value === currentIndex.value);\n\t});\n\t\n\t// 关闭联想功能\n\tconst closeAssociate = () => {\n\t\tconsole.log(\"开始通知\", searchTerm.value)\n\t\tresults.value = []; // 清空搜索结果\n\t\temit('close-associate', searchTerm.value); // 通知父组件关闭联想\n\t};\n\t\n\t// 处理索引变更\n\tconst handleIndexChange = (e) => {\n\t\tconst index = e.detail.value;\n\t\tcurrentIndex.value = props.indexOptions[index]?.value || \"\";\n\t\temit('index-change', currentIndex.value);\n\t\t\n\t\t// 如果已有搜索词，则重新搜索\n\t\tif (searchTerm.value.trim() !== '') {\n\t\t\tonSearchInput();\n\t\t}\n\t};\n\n\tconst onSearchInput = async () => {\n\t\tif (searchTerm.value.trim() === '') {\n\t\t\tresults.value = []; // 如果输入框为空，则清空结果\n\t\t\treturn;\n\t\t}\n\n\t\temit('select', 0, searchTerm.value); // 清空向父组件传递的id\n\n\t\t// 构建请求URL\n\t\tlet url = `${websiteUrl.value}/search-brand?search=${encodeURIComponent(searchTerm.value)}`;\n\t\t\n\t\t// 如果当前索引不为空，添加到URL参数\n\t\tif (currentIndex.value) {\n\t\t\turl += `&index=${currentIndex.value}`;\n\t\t}\n\n\t\ttry {\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: url,\n\t\t\t\tmethod: 'GET',\n\t\t\t\theader: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconsole.log('请求结果:', res.data);\n\t\t\tif (res.data.status == \"success\") {\n\t\t\t\t// 判断res.data.data 是不是null\n\t\t\t\tif (res.data.data == null) {\n\t\t\t\t\tresults.value = [];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tresults.value = res.data.data;\n\t\t\t\treturn\n\t\t\t} else {\n\t\t\t\tresults.value = [];\n\t\t\t\treturn\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.error('请求错误:', error);\n\t\t\tresults.value = []; // 请求失败时清空结果\n\t\t\treturn\n\t\t}\n\t};\n\n\tconst onTap = (brandId, brandName) => {\n\t\tif (props.mode === 'jump') {\n\t\t\t// 跳转模式\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/brand/brand?brand_id=${brandId}`\n\t\t\t});\n\t\t} else if (props.mode === 'fill') {\n\t\t\t// 填充模式\n\t\t\tsearchTerm.value = brandName; // 填充品牌名称\n\t\t\tresults.value = []; // 清空搜索结果\n\t\t\temit('select', brandId, brandName); // 向父组件传递选中ID\n\t\t}\n\t};\n\n\tfunction cancel() {\n\t\tsearchTerm.value = '';\n\t\tresults.value = [];\n\t}\n</script>\n\n<style lang=\"less\" scoped>\n\t.search_tab {\n\t\tbox-sizing: border-box;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tbackground: #fff;\n\t\tborder-radius: 10px;\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\theight: 72rpx;\n\t\t/* 统一高度 */\n\t\tpadding: 0 20rpx;\n\t\t/* 统一内边距 */\n\n\t\t.icon_image {\n\t\t\twidth: 36rpx;\n\t\t\t/* 统一图标大小 */\n\t\t\theight: 36rpx;\n\t\t\t/* 统一图标大小 */\n\t\t\tmargin-right: 16rpx;\n\t\t\t/* 统一图标间距 */\n\t\t}\n\n\t\t.common_search_input {\n\t\t\tflex: 1;\n\t\t\theight: 100%;\n\t\t\tpadding: 0;\n\t\t\t/* 统一内边距 */\n\t\t\tfont-size: 23rpx;\n\t\t\t/* 统一字体大小 */\n\t\t}\n\t\t\n\t\t/* 索引选择器样式 - 修改为蓝色 */\n\t\t.index-selector {\n\t\t\t\n\t\t\t.selector-content {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tpadding: 0 20rpx;\n\t\t\t\theight: 60rpx;\n\t\t\t\tborder-radius: 30rpx;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tcolor: white;\n\t\t\t\tbox-shadow: 0 4rpx 10rpx rgba(116, 126, 229, 0.3);\n\t\t\t\ttransition: all 0.3s ease;\n\t\t\t\tmargin-right: 15rpx;\n\t\t\t\t\n\t\t\t\t&:active {\n\t\t\t\t\ttransform: translateY(2rpx);\n\t\t\t\t\tbox-shadow: 0 2rpx 8rpx rgba(116, 126, 229, 0.3);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttext {\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t.search_results {\n\t\tpadding: 10px;\n\t\tbackground-color: #f8f8f8;\n\t\tborder-radius: 5px;\n\t\tposition: absolute;\n\t\tz-index: 120;\n\t\tbox-shadow: 0 0 15px #0000002b;\n\t\tmax-height: 400rpx;\n\t\tfont-size: 22rpx;\n\t\tbox-sizing: border-box;\n\n\t\t.result_item {\n\t\t\tfont-size: 22rpx;\n\t\t\tpadding: 15px 0;\n\t\t\tcursor: pointer;\n\t\t\tcolor: #333;\n\t\t\tborder-bottom: 1px solid #ececec;\n\n\t\t\t&:last-child {\n\t\t\t\tborder-bottom: none;\n\t\t\t}\n\n\t\t\t&:hover {\n\t\t\t\tcolor: #007aff;\n\t\t\t}\n\t\t}\n\t}\n\n\t.search-info-tap {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tposition: relative;\n\t\t/* 改为相对定位 */\n\t\tmargin-left: 10rpx;\n\t\t/* 添加左边距 */\n\n\t\ttext {\n\t\t\tcolor: #fff;\n\t\t\tbackground: linear-gradient(135deg, #a494b2, #fad0c4);\n\t\t\tfont-size: 20rpx;\n\t\t\tpadding: 3px 5px;\n\t\t\tborder-radius: 3px;\n\t\t\tfont-weight: 900;\n\t\t\tposition: relative;\n\t\t\tbottom: 0;\n\t\t\t/* 取消垂直偏移 */\n\t\t\tmargin-right: 8rpx;\n\t\t\t/* 添加右边距 */\n\t\t}\n\n\t\t.icon_image {\n\t\t\twidth: 36rpx;\n\t\t\theight: 36rpx;\n\t\t\tmargin-left: 0;\n\t\t\t/* 重置左边距 */\n\t\t}\n\t}\n\n\t.close-associate {\n\t\ttext {\n\t\t\tfont-size: 22rpx;\n\t\t\tcolor: #ccc;\n\t\t}\n\t\t&:active {\n\t\t\tbackground-color: #f0f0f0;\n\t\t}\n\t}\n</style>\n","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/common-search/common-search.vue'\nwx.createComponent(Component)"],"names":["ref","computed","uni","_a","websiteUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDC,UAAM,QAAQ;AA4Cd,UAAM,OAAO;AAEb,UAAM,aAAaA,kBAAI,EAAE;AACzB,UAAM,UAAUA,kBAAI,CAAA,CAAE;AACtB,UAAM,eAAeA,cAAAA,IAAI,MAAM,mBAAiB,WAAM,aAAa,CAAC,MAApB,mBAAuB,UAAS,GAAG;AAGnF,UAAM,oBAAoBC,cAAAA,SAAS,MAAM;AACxC,YAAM,SAAS,MAAM,aAAa,KAAK,SAAO,IAAI,UAAU,aAAa,KAAK;AAC9E,aAAO,SAAS,OAAO,QAAQ;AAAA,IACjC,CAAE;AAGD,UAAM,cAAcA,cAAAA,SAAS,MAAM;AAClC,aAAO,MAAM,aAAa,IAAI,SAAO,IAAI,KAAK;AAAA,IAChD,CAAE;AAGD,UAAM,gBAAgBA,cAAAA,SAAS,MAAM;AACpC,aAAO,MAAM,aAAa,UAAU,SAAO,IAAI,UAAU,aAAa,KAAK;AAAA,IAC7E,CAAE;AAGD,UAAM,iBAAiB,MAAM;AAC5BC,oBAAY,MAAA,MAAA,OAAA,qDAAA,QAAQ,WAAW,KAAK;AACpC,cAAQ,QAAQ;AAChB,WAAK,mBAAmB,WAAW,KAAK;AAAA,IAC1C;AAGC,UAAM,oBAAoB,CAAC,MAAM;;AAChC,YAAM,QAAQ,EAAE,OAAO;AACvB,mBAAa,UAAQC,MAAA,MAAM,aAAa,KAAK,MAAxB,gBAAAA,IAA2B,UAAS;AACzD,WAAK,gBAAgB,aAAa,KAAK;AAGvC,UAAI,WAAW,MAAM,KAAI,MAAO,IAAI;AACnC;MACA;AAAA,IACH;AAEC,UAAM,gBAAgB,YAAY;AACjC,UAAI,WAAW,MAAM,KAAI,MAAO,IAAI;AACnC,gBAAQ,QAAQ;AAChB;AAAA,MACA;AAED,WAAK,UAAU,GAAG,WAAW,KAAK;AAGlC,UAAI,MAAM,GAAGC,cAAAA,WAAW,KAAK,wBAAwB,mBAAmB,WAAW,KAAK,CAAC;AAGzF,UAAI,aAAa,OAAO;AACvB,eAAO,UAAU,aAAa,KAAK;AAAA,MACnC;AAED,UAAI;AACH,cAAM,MAAM,MAAMF,cAAG,MAAC,QAAQ;AAAA,UAC7B;AAAA,UACA,QAAQ;AAAA,UACR,QAAQ;AAAA,YACP,gBAAgB;AAAA,UAChB;AAAA,QACL,CAAI;AAEDA,sBAAY,MAAA,MAAA,OAAA,qDAAA,SAAS,IAAI,IAAI;AAC7B,YAAI,IAAI,KAAK,UAAU,WAAW;AAEjC,cAAI,IAAI,KAAK,QAAQ,MAAM;AAC1B,oBAAQ,QAAQ;AAChB;AAAA,UACA;AACD,kBAAQ,QAAQ,IAAI,KAAK;AACzB;AAAA,QACJ,OAAU;AACN,kBAAQ,QAAQ;AAChB;AAAA,QACA;AAAA,MAED,SAAQ,OAAO;AACfA,sBAAA,MAAA,MAAA,SAAA,qDAAc,SAAS,KAAK;AAC5B,gBAAQ,QAAQ;AAChB;AAAA,MACA;AAAA,IACH;AAEC,UAAM,QAAQ,CAAC,SAAS,cAAc;AACrC,UAAI,MAAM,SAAS,QAAQ;AAE1BA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK,+BAA+B,OAAO;AAAA,QAC/C,CAAI;AAAA,MACJ,WAAa,MAAM,SAAS,QAAQ;AAEjC,mBAAW,QAAQ;AACnB,gBAAQ,QAAQ;AAChB,aAAK,UAAU,SAAS,SAAS;AAAA,MACjC;AAAA,IACH;AAEC,aAAS,SAAS;AACjB,iBAAW,QAAQ;AACnB,cAAQ,QAAQ;IAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrMF,GAAG,gBAAgB,SAAS;"}