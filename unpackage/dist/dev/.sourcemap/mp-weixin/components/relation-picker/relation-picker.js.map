{"version":3,"file":"relation-picker.js","sources":["components/relation-picker/relation-picker.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/relation-picker/relation-picker.vue?type=component"],"sourcesContent":["<!-- components/relation-picker/relation-picker.vue -->\r\n<template>\r\n\t<common-modal :visible=\"internalVisible\" @update:visible=\"handleModalVisibilityChange\">\r\n\t\t<view class=\"relation-picker-container\">\r\n\t\t\t<view class=\"picker-header\">\r\n\t\t\t\t<text class=\"title\">关联娃物</text>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"picker-body\">\r\n\t\t\t\t<!-- 类型选择 -->\r\n\t\t\t\t<common-name-picker :dataList=\"typeList\" placeholder=\"选择类型\" @select=\"handleTypeSelect\"\r\n\t\t\t\t\tclass=\"type-picker\" />\r\n\r\n\t\t\t\t<!-- 品牌搜索 -->\r\n\t\t\t\t<common-search mode=\"fill\" @select=\"handleBrandSelect\" width=\"520rpx\" background=\"#f8f8f8\" class=\"brand-search\" />\r\n\r\n\t\t\t\t<!-- 商品选择 -->\r\n\t\t\t\t<custom-picker :dataList=\"goodsList\" @select=\"handleGoodsSelect\" class=\"goods-picker\" />\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"picker-footer\">\r\n\t\t\t\t<button class=\"cancel-btn\" @tap=\"handleCancel\">取消</button>\r\n\t\t\t\t<button class=\"confirm-btn\" @tap=\"handleConfirm\">确认</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</common-modal>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\twatch\r\n\t} from 'vue';\r\n\r\n\timport {\r\n\t\twebsiteUrl,\r\n\t\timage1Url,\r\n\t\twechatSignLogin,\r\n\t\tgetUserInfo,\r\n\t\tglobal,\r\n\t\tasyncGetUserInfo,\r\n\t\tgetScene,\r\n\t} from \"../../common/config.js\"\r\n\r\n\r\n\tconst props = defineProps({\r\n\t\ttypeList: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tvisible: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t})\r\n\r\n\tconst emit = defineEmits([\r\n\t\t'update:visible',\r\n\t\t'confirm',\r\n\t\t'cancel'\r\n\t])\r\n\r\n\tconst goodsList = ref([])\r\n\r\n\t// 使用内部状态管理可见性\r\n\tconst internalVisible = ref(false)\r\n\r\n\t// 监听父组件传来的 visible 变化\r\n\twatch(() => props.visible, (val) => {\r\n\t\tinternalVisible.value = val\r\n\t})\r\n\r\n\t// 监听内部状态变化通知父组件\r\n\twatch(internalVisible, (val) => {\r\n\t\temit('update:visible', val)\r\n\t})\r\n\r\n\t// 选择数据存储\r\n\tconst selectedData = ref({\r\n\t\ttype: null,\r\n\t\tbrand: null,\r\n\t\tgoods: null\r\n\t})\r\n\t// 新增 modal 可见性变化处理\r\n\tconst handleModalVisibilityChange = (newVal) => {\r\n\t\tinternalVisible.value = newVal\r\n\t\t// 当 modal 自身触发关闭时（如点击遮罩层）\r\n\t\tif (!newVal) {\r\n\t\t\tclosePicker()\r\n\t\t}\r\n\t}\r\n\t// 类型选择\r\n\tconst handleTypeSelect = (type) => {\r\n\t\tselectedData.value.type = type\r\n\t}\r\n\tconst getGoodsInfo = (id) => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuni.request({\r\n\t\t\t\turl: websiteUrl + '/goods?id=' + id,\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\ttimeout: 5000,\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tresolve(res.data.data)\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\tconsole.error('商品详情获取失败', err)\r\n\t\t\t\t\treject(err)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t// 品牌选择\r\n\tconst handleBrandSelect = (brandId, brandName) => {\r\n\t\tselectedData.value.brand = {\r\n\t\t\tid: brandId,\r\n\t\t\tname: brandName\r\n\t\t}\r\n\t\t// 添加商品加载逻辑\r\n\t\ttry {\r\n\t\t\tgetGoods(brandId)\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('获取商品失败', error)\r\n\t\t}\r\n\t}\r\n\r\n\t// 商品选择\r\n\tconst handleGoodsSelect = async (goodsId, goodsName) => {\r\n\t\ttry {\r\n\t\t\tconst detail = await getGoodsInfo(goodsId)\r\n\t\t\tselectedData.value.goods = {\r\n\t\t\t\tid: goodsId,\r\n\t\t\t\tname: goodsName,\r\n\t\t\t\timage: detail?.goods_images?.[0] || ''\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('商品选择失败', error)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getGoods(id) {\r\n\t\t// 请求 /goods-name-list 并赋值goodsList\r\n\t\tuni.request({\r\n\t\t\turl: websiteUrl + '/goods-name-list?id=' + id,\r\n\t\t\tmethod: 'GET',\r\n\t\t\ttimeout: 5000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconsole.log(res.data.data);\r\n\t\t\t\tgoodsList.value = res.data.data\r\n\t\t\t\tconsole.log(goodsList.value)\r\n\t\t\t},\r\n\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '网络请求失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t}\r\n\t// 确认操作\r\n\tconst handleConfirm = async () => {\r\n\t\ttry {\r\n\t\t\t// 获取商品图片信息\r\n\t\t\tconst goodsDetail = await getGoodsInfo(selectedData.value.goods.id)\r\n\r\n\t\t\t// 构建完整数据对象\r\n\t\t\tconst resultData = {\r\n\t\t\t\t...selectedData.value,\r\n\t\t\t\tgoods_image: goodsDetail?.goods_images?.[0] || '',\r\n\t\t\t\tgoods_id: selectedData.value.goods.id,\r\n\t\t\t\tbrand_id: selectedData.value.brand.id,\r\n\t\t\t\tbrand_name: selectedData.value.brand.name,\r\n\t\t\t\ttype: selectedData.value.type\r\n\t\t\t}\r\n\r\n\t\t\temit('confirm', resultData)\r\n\t\t\tclosePicker()\r\n\t\t} catch (error) {\n\t\t\tconsole.error('商品信息获取失败', error)\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '商品信息获取失败',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// 取消操作\r\n\tconst handleCancel = () => {\r\n\t\temit('cancel')\r\n\t\tclosePicker()\r\n\t}\r\n\r\n\t// 关闭弹窗\r\n\tconst closePicker = () => {\r\n\t\tinternalVisible.value = false\r\n\t\t// 重置选择数据\r\n\t\tselectedData.value = {\r\n\t\t\ttype: null,\r\n\t\t\tbrand: null,\r\n\t\t\tgoods: null\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\t.relation-picker-container {\r\n\t\tpadding: 24rpx;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\twidth: 600rpx;\r\n\t\tbox-sizing: border-box;\r\n\r\n\t\t.picker-header {\r\n\t\t\tmargin-bottom: 24rpx;\r\n\t\t\tborder-bottom: 1rpx solid #eee;\r\n\t\t\tpadding-bottom: 24rpx;\r\n\r\n\t\t\t.title {\r\n\t\t\t\tfont-size: 24rpx; // 标题字号调整\r\n\t\t\t\tfont-weight: 700; // 加粗程度提升\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.picker-body {\r\n\r\n\r\n\t\t\t/deep/ .type-picker {\n\t\t\t\tmargin-bottom: 40rpx;\r\n\t\t\t\t.select-input {\r\n\t\t\t\t\tbackground: #f8f8f8;\r\n\t\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\t\tpadding: 16rpx 24rpx;\r\n\t\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/* 品牌搜索样式加强 */\r\n\t\t\t/deep/ .brand-search {\r\n\r\n\t\t\t\tbackground: #f8f8f8 !important;\r\n\t\t\t\tborder-radius: 12rpx !important;\r\n\t\t\t\t// padding: 12rpx 24rpx !important;\r\n\t\t\t\tmin-height: 72rpx; // 新增固定高度\r\n\r\n\t\t\t\t.common_search_input {\r\n\t\t\t\t\tfont-size: 22rpx !important;\r\n\t\t\t\t\tcolor: #333 !important;\r\n\t\t\t\t\tflex: 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.icon_image {\r\n\t\t\t\t\twidth: 36rpx !important;\r\n\t\t\t\t\theight: 36rpx !important;\r\n\t\t\t\t\tmargin: 0 12rpx !important;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.search_results {\r\n\t\t\t\t\tbackground: #fff !important;\r\n\t\t\t\t\tborder: 1rpx solid #eee !important;\r\n\t\t\t\t\tbox-shadow: 0 4rpx 24rpx rgba(0, 0, 0, 0.08) !important;\r\n\r\n\t\t\t\t\t.result_item {\r\n\t\t\t\t\t\tfont-size: 22rpx !important;\r\n\t\t\t\t\t\tpadding: 24rpx !important;\r\n\t\t\t\t\t\tcolor: #666 !important;\r\n\r\n\t\t\t\t\t\t&:active {\r\n\t\t\t\t\t\t\tbackground: #f8f8f8 !important;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/* 按钮尺寸优化 */\r\n\t\t\t.picker-footer {\r\n\t\t\t\tbutton {\r\n\t\t\t\t\theight: 64rpx !important; // 缩小按钮高度\r\n\t\t\t\t\tline-height: 64rpx !important;\r\n\t\t\t\t\tfont-size: 22rpx !important;\r\n\t\t\t\t\tpadding: 0 24rpx !important;\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/deep/ .goods-picker {\r\n\t\t\t\t.select-input {\r\n\t\t\t\t\tbackground: #f8f8f8;\r\n\t\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\t\tpadding: 16rpx 24rpx;\r\n\t\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.picker-footer {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\tmargin-top: 32rpx;\r\n\t\t\tgap: 20rpx;\r\n\r\n\t\t\tbutton {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\theight: 72rpx;\r\n\t\t\t\tline-height: 72rpx;\r\n\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\tfont-size: 22rpx; // 字号统一调整\r\n\t\t\t\ttransition: all 0.3s;\r\n\t\t\t\tmargin: 0;\r\n\r\n\t\t\t\t&::after {\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.cancel-btn {\r\n\t\t\t\tbackground: #f5f5f5;\r\n\t\t\t\tcolor: #666;\r\n\r\n\t\t\t\t&:active {\r\n\t\t\t\t\tbackground: #e8e8e8;\r\n\t\t\t\t\topacity: 0.8;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.confirm-btn {\r\n\t\t\t\tbackground: #78d0dd;\r\n\t\t\t\tcolor: #fff;\r\n\r\n\t\t\t\t&:active {\r\n\t\t\t\t\topacity: 0.8;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/* 品牌搜索样式加强 */\r\n\t/deep/ .brand-search {\n\t\r\n\r\n\t\tbackground: #f8f8f8 !important;\r\n\t\tborder-radius: 12rpx !important;\r\n\t\t// padding: 12rpx 24rpx !important;\r\n\t\tmin-height: 72rpx; // 新增固定高度\r\n\t\tmargin-bottom: 20rpx;\n\t\tdisplay: block;\r\n\r\n\t\t.common_search_input {\r\n\t\t\tfont-size: 22rpx !important;\r\n\t\t\tcolor: #333 !important;\n\t\t\tbackground: #f8f8f8 !important;\r\n\t\t\t// padding: 0 16rpx !important;\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.icon_image {\r\n\t\t\twidth: 36rpx !important;\r\n\t\t\theight: 36rpx !important;\r\n\t\t\tmargin: 0 12rpx !important;\r\n\t\t}\r\n\r\n\r\n\t\t.search_results {\n\t\t\tmargin-top: 0rpx!important;\r\n\t\t\tbackground: #fff !important;\r\n\t\t\tborder: 1rpx solid #eee !important;\r\n\t\t\tbox-shadow: 0 4rpx 24rpx rgba(0, 0, 0, 0.08) !important;\r\n\r\n\t\t\t.result_item {\r\n\t\t\t\tfont-size: 22rpx !important;\r\n\t\t\t\tpadding: 24rpx !important;\r\n\t\t\t\tcolor: #666 !important;\r\n\r\n\t\t\t\t&:active {\r\n\t\t\t\t\tbackground: #f8f8f8 !important;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/* 按钮尺寸优化 */\r\n\t.picker-footer {\r\n\t\tbutton {\r\n\t\t\theight: 64rpx !important; // 缩小按钮高度\r\n\t\t\tline-height: 64rpx !important;\r\n\t\t\tfont-size: 22rpx !important;\r\n\t\t\tpadding: 0 24rpx !important;\r\n\t\t}\r\n\t}\n\t.search_tab {\n\t\tbackground: #f8f8f8 !important;\n\t}\r\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/relation-picker/relation-picker.vue'\nwx.createComponent(Component)"],"names":["ref","watch","uni","websiteUrl"],"mappings":"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"}