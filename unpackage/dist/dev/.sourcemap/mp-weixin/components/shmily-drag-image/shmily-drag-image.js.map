{"version":3,"file":"shmily-drag-image.js","sources":["components/shmily-drag-image/shmily-drag-image.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/shmily-drag-image/shmily-drag-image.vue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"con\">\r\n\t\t<template v-if=\"viewWidth\">\r\n\t\t\t<movable-area class=\"area\" :style=\"{ height: areaHeight }\" @mouseenter=\"mouseenter\"\r\n\t\t\t\t@mouseleave=\"mouseleave\">\r\n\t\t\t\t<movable-view v-for=\"(item, index) in imageList\" :key=\"item.id\" class=\"view\" direction=\"all\" :y=\"item.y\"\r\n\t\t\t\t\t:x=\"item.x\" :damping=\"40\" :disabled=\"item.disable || !item.ready\" @change=\"onChange($event, item)\"\r\n\t\t\t\t\t@touchstart=\"onLongPressStart(item, $event)\" @touchend=\"touchend(item)\" @tap=\"go2preview(item.id)\"\r\n\t\t\t\t\t@touchmove=\"onTouchMove($event, item)\" :style=\"{\r\n\t\t\t\t\t\twidth: viewWidth + 'px', \r\n\t\t\t\t\t\theight: viewHeight + 'px', \r\n\t\t\t\t\t\t'z-index': item.zIndex, \r\n\t\t\t\t\t\topacity: item.opacity \r\n\t\t\t\t\t  }\">\r\n\t\t\t\t\t<view class=\"area-con\" :style=\"{\r\n\t\t\t\t\t\t\t  width: childWidth, \r\n\t\t\t\t\t\t\t  height: childHeight, \r\n\t\t\t\t\t\t\t  borderRadius: borderRadius + 'rpx',\r\n\t\t\t\t\t\t\t  transform: 'scale(' + item.scale + ')',\r\n\t\t\t\t\t\t\t  margin: itemMargin + 'px'\r\n\t\t\t\t\t\t\t}\" :class=\"{ 'ready' : !item.disable && item.ready  }\">\r\n\t\t\t\t\t\t<image class=\"pre-image\" :src=\"getFirstImage(item.src)\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t<view class=\"info-container\">\r\n\t\t\t\t\t\t\t<text class=\"name\">{{ item.name }}</text>\r\n\t\t\t\t\t\t\t<!-- <text class=\"name\">状态{{ item.disable || !item.ready }}</text> -->\r\n\t\t\t\t\t\t\t<text class=\"price\">{{item.price}}</text>\r\n\t\t\t\t\t\t\t<text class=\"type\">{{ item.type }}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</movable-view>\r\n\t\t\t</movable-area>\r\n\t\t</template>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tcomputed,\r\n\t\twatch,\r\n\t\tonMounted,\r\n\t\tnextTick,\r\n\t\tgetCurrentInstance\r\n\t} from 'vue'\r\n\r\n\timport {\r\n\t\twebsiteUrl,\r\n\t\twechatSignLogin,\r\n\t\tgetUserInfo,\r\n\t\tglobal,\r\n\t\tasyncGetUserInfo,\r\n\t} from \"../../common/config.js\";\r\n\t// 定义 props\r\n\tconst props = defineProps({\r\n\t\tvalue: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tmodelValue: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tkeyName: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'image_url' // 默认使用image_url作为图片字段\r\n\t\t},\r\n\t\tnumber: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 6\r\n\t\t},\r\n\t\timageWidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tcols: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 3\r\n\t\t},\r\n\t\tborderRadius: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tpadding: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 10\r\n\t\t},\r\n\t\tscale: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1.1\r\n\t\t},\r\n\t\topacity: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0.7\r\n\t\t},\r\n\t\t// 新增：每个项目之间的边距\r\n\t\titemMargin: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 10\r\n\t\t},\r\n\t\t// 新增：图片与文字的比例\r\n\t\timageRatio: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0.7 // 图片区域占总高度的70%\r\n\t\t}\r\n\t})\r\n\r\n\t// 定义 emits\r\n\tconst emit = defineEmits(['input', 'update:modelValue', 'sort-change']);\r\n\r\n\t// 响应式变量\r\n\tconst imageList = ref([])\r\n\tconst width = ref(0)\r\n\tconst add = ref({\r\n\t\tx: 0,\r\n\t\ty: 0\r\n\t})\r\n\tconst colsValue = ref(0)\r\n\tconst viewWidth = ref(0)\r\n\tconst viewHeight = ref(0) // 新增高度变量\r\n\tconst tempItem = ref(null)\r\n\tconst timer = ref(null)\r\n\tconst changeStatus = ref(true)\r\n\tconst preStatus = ref(true)\r\n\tconst first = ref(true)\r\n\tconst touchStartY = ref(0); // 触摸起始Y坐标\r\n\tconst longPressTimer = ref(null);\r\n\tconst isDragging = ref(false); // 全局拖拽状态\r\n\r\n\tconst isMounted = ref(false); // 是否已挂载\r\n\r\n\t// 计算属性\r\n\tconst areaHeight = computed(() => {\r\n\t\tif (imageList.value.length < props.number) {\r\n\t\t\treturn (Math.ceil((imageList.value.length + 1) / colsValue.value) * viewHeight.value) + 'px'\r\n\t\t}\r\n\t\treturn (Math.ceil(imageList.value.length / colsValue.value) * viewHeight.value) + 'px'\r\n\t})\r\n\r\n\t// 调整内部容器宽度计算\r\n\tconst childWidth = computed(() => {\r\n\t\treturn (viewWidth.value - rpx2px(props.padding) * 2) + 'px'\r\n\t})\r\n\t// 新增：内部容器高度计算\r\n\tconst childHeight = computed(() => {\r\n\t\treturn (viewHeight.value - rpx2px(props.padding) * 2) + 'px'\r\n\t})\r\n\t// 方法\r\n\tconst getSrc = (item) => {\r\n\t\treturn props.keyName !== null ? item[props.keyName] : item\r\n\t}\r\n\tconst getItemData = (item) => {\r\n\t\treturn {\r\n\t\t\tid: item.id,\r\n\t\t\tsrc: getSrc(item),\r\n\t\t\tname: item.name,\r\n\t\t\tprice: item.price,\r\n\t\t\ttype: item.type\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tconst onChange = (e, item) => {\r\n\t\tif (!item) return\r\n\t\titem.oldX = e.detail.x\r\n\t\titem.oldY = e.detail.y\r\n\t\tif (e.detail.source === 'touch') {\r\n\t\t\tif (item.moveEnd) {\r\n\t\t\t\titem.offset = Math.sqrt(\r\n\t\t\t\t\tMath.pow(item.oldX - item.absX * viewWidth.value, 2) +\r\n\t\t\t\t\tMath.pow(item.oldY - item.absY * viewHeight.value, 2) // 使用viewHeight\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\tlet x = Math.floor((e.detail.x + viewWidth.value / 2) / viewWidth.value)\r\n\t\t\tif (x >= colsValue.value) return\r\n\t\t\tlet y = Math.floor((e.detail.y + viewHeight.value / 2) / viewHeight.value) // 使用viewHeight\r\n\t\t\tlet index = colsValue.value * y + x\r\n\r\n\t\t\tif (item.index !== index && index < imageList.value.length) {\r\n\t\t\t\tchangeStatus.value = false\r\n\t\t\t\timageList.value.forEach(obj => {\r\n\t\t\t\t\tif (item.index > index && obj.index >= index && obj.index < item.index) {\r\n\t\t\t\t\t\tchangeObj(obj, 1)\r\n\t\t\t\t\t} else if (item.index < index && obj.index <= index && obj.index > item.index) {\r\n\t\t\t\t\t\tchangeObj(obj, -1)\r\n\t\t\t\t\t} else if (obj.id !== item.id) {\r\n\t\t\t\t\t\tobj.offset = 0\r\n\t\t\t\t\t\tobj.x = obj.oldX\r\n\t\t\t\t\t\tobj.y = obj.oldY\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\t\t\tobj.x = obj.absX * viewWidth.value\r\n\t\t\t\t\t\t\t\tobj.y = obj.absY * viewHeight.value\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}, 0)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// 移动数组元素到新位置\r\n\t\t\t\tmoveItem(item, index);\r\n\r\n\t\t\t\titem.index = index\r\n\t\t\t\titem.absX = x\r\n\t\t\t\titem.absY = y\r\n\t\t\t\tif (!item.moveEnd) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\t\titem.x = item.absX * viewWidth.value\r\n\t\t\t\t\t\t\titem.y = item.absY * viewHeight.value\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 0)\r\n\t\t\t\t}\r\n\t\t\t\tsortList()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 移动数组元素到新位置\r\n\tconst moveItem = (item, newIndex) => {\r\n\t\tconst oldIndex = imageList.value.findIndex(i => i.id === item.id);\r\n\t\tif (oldIndex === -1 || oldIndex === newIndex) return;\r\n\r\n\t\t// 移动元素到新位置\r\n\t\timageList.value.splice(newIndex, 0, imageList.value.splice(oldIndex, 1)[0]);\r\n\r\n\t\t// 更新所有元素的 index\r\n\t\timageList.value.forEach((item, idx) => {\r\n\t\t\titem.index = idx;\r\n\t\t});\r\n\r\n\t\tsortList();\r\n\t}\r\n\r\n\tconst changeObj = (obj, i) => {\r\n\t\tobj.index += i\r\n\t\tobj.offset = 0\r\n\t\tobj.x = obj.oldX\r\n\t\tobj.y = obj.oldY\r\n\t\tobj.absX = obj.index % colsValue.value\r\n\t\tobj.absY = Math.floor(obj.index / colsValue.value)\r\n\t\tsetTimeout(() => {\r\n\t\t\tnextTick(() => {\r\n\t\t\t\tobj.x = obj.absX * viewWidth.value\r\n\t\t\t\tobj.y = obj.absY * viewHeight.value\r\n\t\t\t})\r\n\t\t}, 0)\r\n\t}\r\n\t// 长按开始拖拽\r\n\tconst onLongPressStart = (item, e) => {\r\n\t\t// 记录触摸起始位置\r\n\t\ttouchStartY.value = e.touches[0].clientY;\r\n\r\n\t\t// 清除之前的计时器\r\n\t\tif (longPressTimer.value) {\r\n\t\t\tclearTimeout(longPressTimer.value);\r\n\t\t\tlongPressTimer.value = null;\r\n\t\t}\r\n\r\n\t\t// 遍历清除所有item的ready\r\n\t\timageList.value.forEach(item => {\r\n\t\t\titem.ready = false\r\n\t\t\titem.disable = true\r\n\t\t})\r\n\t\tconsole.log(\"长按开始\")\r\n\r\n\t\t// 设置长按计时器（500ms）\r\n\t\tlongPressTimer.value = setTimeout(() => {\r\n\t\t\tconsole.log(\"长按成功！\")\r\n\t\t\tuni.vibrateShort({\r\n\t\t\t\tsuccess: () => {\r\n\t\t\t\t\tconsole.log('触感反馈');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\titem.ready = true\r\n\t\t\titem.disable = false\r\n\t\t\tisDragging.value = true\r\n\t\t\ttouchstart(item);\r\n\t\t}, 240);\r\n\t};\r\n\r\n\tconst touchstart = (item, e) => {\r\n\t\tconsole.log(\"进入touchstart\")\r\n\t\timageList.value.forEach(v => {\r\n\t\t\tv.zIndex = v.index + 9\r\n\t\t})\r\n\t\titem.zIndex = 99\r\n\t\titem.moveEnd = true\r\n\t\ttempItem.value = item\r\n\t\ttimer.value = setTimeout(() => {\r\n\t\t\titem.scale = props.scale\r\n\t\t\titem.opacity = props.opacity\r\n\t\t\tclearTimeout(timer.value)\r\n\t\t\ttimer.value = null\r\n\t\t}, 200)\r\n\t}\r\n\r\n\tconst touchend = (item) => {\r\n\t\t// previewImage(item)\r\n\t\titem.scale = 1\r\n\t\titem.opacity = 1\r\n\t\titem.x = item.oldX\r\n\t\titem.y = item.oldY\r\n\t\titem.offset = 0\r\n\t\titem.moveEnd = false\r\n\r\n\t\t// 遍历清除所有item的ready\r\n\t\tconsole.log(\"结束点击，清理ready\")\r\n\t\timageList.value.forEach(item => {\r\n\t\t\titem.ready = false\r\n\t\t\titem.disable = true\r\n\t\t})\r\n\t\tif (isDragging.value == true) {\r\n\t\t\tconsole.log(\"来自于拖拽的结束,上报排序事件\")\r\n\r\n\t\t\t// 直接使用当前顺序的ID\r\n\t\t\tconst sortedIds = imageList.value.map(item => item.id);\r\n\r\n\t\t\temit('sort-change', sortedIds);\r\n\t\t\t// console.log(\"排序后的ID\", sortedIds)\r\n\r\n\t\t}\r\n\r\n\t\tisDragging.value = false\r\n\t\t// 清除之前的计时器\r\n\t\tif (longPressTimer.value) {\r\n\t\t\tclearTimeout(longPressTimer.value);\r\n\t\t\tlongPressTimer.value = null;\r\n\t\t}\r\n\t\t// 修复：确保所有项目位置正确恢复\r\n\t\tsetTimeout(() => {\r\n\t\t\timageList.value.forEach(obj => {\r\n\t\t\t\tif (obj.ready) return; // 跳过当前拖拽项\r\n\r\n\t\t\t\tobj.x = obj.absX * viewWidth.value;\r\n\t\t\t\tobj.y = obj.absY * viewHeight.value;\r\n\t\t\t\tobj.offset = 0;\r\n\t\t\t\tobj.moveEnd = false;\r\n\t\t\t});\r\n\r\n\t\t\t// 当前拖拽项单独处理\r\n\t\t\tnextTick(() => {\r\n\t\t\t\titem.x = item.absX * viewWidth.value;\r\n\t\t\t\titem.y = item.absY * viewHeight.value;\r\n\t\t\t\ttempItem.value = null;\r\n\t\t\t\tchangeStatus.value = true;\r\n\t\t\t});\r\n\t\t}, 50); // 稍作延迟确保渲染完成\r\n\t}\r\n\t// 获取第一张图片 - 修复路径问题\r\n\tconst getFirstImage = (imageUrls) => {\r\n\t\tif (!imageUrls) return '';\r\n\r\n\t\t// 处理可能包含逗号分隔的多个URL\r\n\t\tconst urls = imageUrls.split(',');\r\n\t\tconst firstUrl = urls[0]?.trim() || '';\r\n\r\n\t\t// 如果是完整URL直接返回\r\n\t\tif (firstUrl.startsWith('http')) {\r\n\t\t\treturn firstUrl;\r\n\t\t}\r\n\r\n\t\t// 默认返回空字符串\r\n\t\treturn '';\r\n\t};\r\n\r\n\r\n\tconst previewImage = (item) => {\r\n\t\tif (timer.value && preStatus.value && changeStatus.value && item.offset < 28.28) {\r\n\t\t\tclearTimeout(timer.value)\r\n\t\t\ttimer.value = null\r\n\t\t\tconst list = props.modelValue.length ? props.modelValue : props.value\r\n\t\t\tlet srcList = list.map(v => getSrc(v))\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: srcList,\r\n\t\t\t\tcurrent: item.src,\r\n\t\t\t\tsuccess: () => {\r\n\t\t\t\t\tpreStatus.value = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tpreStatus.value = true\r\n\t\t\t\t\t}, 600)\r\n\t\t\t\t},\r\n\t\t\t\tfail: (e) => {\r\n\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else if (timer.value) {\r\n\t\t\tclearTimeout(timer.value)\r\n\t\t\ttimer.value = null\r\n\t\t}\r\n\t}\r\n\r\n\tconst mouseenter = () => {\r\n\t\t//#ifdef H5\r\n\t\timageList.value.forEach(v => {\r\n\t\t\tv.disable = false\r\n\t\t})\r\n\t\t//#endif\r\n\t}\r\n\r\n\tconst mouseleave = () => {\r\n\t\t//#ifdef H5\r\n\t\tif (tempItem.value) {\r\n\t\t\timageList.value.forEach(v => {\r\n\t\t\t\tv.disable = true\r\n\t\t\t\tv.zIndex = v.index + 9\r\n\t\t\t\tv.offset = 0\r\n\t\t\t\tv.moveEnd = false\r\n\t\t\t\tif (v.id === tempItem.value.id) {\r\n\t\t\t\t\tif (timer.value) {\r\n\t\t\t\t\t\tclearTimeout(timer.value)\r\n\t\t\t\t\t\ttimer.value = null\r\n\t\t\t\t\t}\r\n\t\t\t\t\tv.scale = 1\r\n\t\t\t\t\tv.opacity = 1\r\n\t\t\t\t\tv.x = v.oldX\r\n\t\t\t\t\tv.y = v.oldY\r\n\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\tv.x = v.absX * viewWidth.value\r\n\t\t\t\t\t\tv.y = v.absY * viewHeight.value\r\n\t\t\t\t\t\ttempItem.value = null\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tchangeStatus.value = true\r\n\t\t}\r\n\t\t//#endif\r\n\t}\r\n\r\n\tconst onTouchMove = (e, item) => {\r\n\t\t// 如果正在拖拽，直接返回\r\n\t\tif (isDragging.value) return;\r\n\r\n\t\t// 计算移动距离\r\n\t\tconst touchY = e.touches[0].clientY;\r\n\t\tconst deltaY = Math.abs(touchY - touchStartY.value);\r\n\r\n\t\t// 如果垂直移动超过10px，取消长按计时器\r\n\t\tif (deltaY > 10 && longPressTimer.value) {\r\n\t\t\tclearTimeout(longPressTimer.value);\r\n\t\t\tlongPressTimer.value = null;\r\n\t\t}\r\n\t};\r\n\r\n\tconst delImageHandle = (item, index) => {\r\n\t\timageList.value.splice(index, 1)\r\n\t\timageList.value.forEach(obj => {\r\n\t\t\tif (obj.index > item.index) {\r\n\t\t\t\tobj.index -= 1\r\n\t\t\t\tobj.x = obj.oldX\r\n\t\t\t\tobj.y = obj.oldY\r\n\t\t\t\tobj.absX = obj.index % colsValue.value\r\n\t\t\t\tobj.absY = Math.floor(obj.index / colsValue.value)\r\n\t\t\t\tnextTick(() => {\r\n\t\t\t\t\tobj.x = obj.absX * viewWidth.value\r\n\t\t\t\t\tobj.y = obj.absY * viewHeight.value\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t\tadd.value.x = (imageList.value.length % colsValue.value) * viewWidth.value\r\n\t\tadd.value.y = Math.floor(imageList.value.length / colsValue.value) * viewHeight.value\r\n\t\tsortList()\r\n\t}\r\n\r\n\r\n\r\n\tconst delImageMp = (item, index) => {\r\n\t\t//#ifdef MP\r\n\t\tdelImageHandle(item, index)\r\n\t\t//#endif\r\n\t}\r\n\r\n\r\n\t//跳转到编辑\r\n\tfunction go2editor(id) {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '/pages/stock/account_book_form/account_book_form?account_book_id=' + id\r\n\t\t})\r\n\t}\r\n\r\n\tfunction go2preview(id) {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '/pages/account_book_preview/account_book_preview?account_book_id=' + id\r\n\t\t})\r\n\t}\r\n\r\n\t// 长按取消\r\n\tconst onLongPressCancel = () => {\r\n\t\tif (longPressTimer.value) {\r\n\t\t\tclearTimeout(longPressTimer.value);\r\n\t\t\tlongPressTimer.value = null;\r\n\t\t}\r\n\t};\r\n\t// 更新所有项目的位置（根据当前索引）\r\n\tconst updateAllItemsPosition = () => {\r\n\t\tlistItems.value.forEach(item => {\r\n\t\t\t// 根据新的索引计算网格位置\r\n\t\t\tconst newAbsX = item.index % colsValue.value;\r\n\t\t\tconst newAbsY = Math.floor(item.index / colsValue.value);\r\n\r\n\t\t\t// 确保位置精确对齐网格\r\n\t\t\tconst targetX = newAbsX * viewWidth.value;\r\n\t\t\tconst targetY = newAbsY * viewWidth.value;\r\n\r\n\t\t\t// 直接设置位置，不使用过渡\r\n\t\t\titem.x = targetX;\r\n\t\t\titem.y = targetY;\r\n\t\t\titem.originX = targetX;\r\n\t\t\titem.originY = targetY;\r\n\t\t\titem.absX = newAbsX;\r\n\t\t\titem.absY = newAbsY;\r\n\t\t});\r\n\t};\r\n\r\n\r\n\tconst sortList = () => {\r\n\t\tconst result = []\r\n\t\tconst source = props.modelValue.length ? props.modelValue : props.value\r\n\t\tconst list = [...imageList.value].sort((a, b) => a.index - b.index)\r\n\r\n\t\tfor (let s of list) {\r\n\t\t\tconst item = source.find(d => getSrc(d) === s.src)\r\n\t\t\tif (item) {\r\n\t\t\t\tresult.push(item)\r\n\t\t\t} else {\r\n\t\t\t\tif (props.keyName !== null) {\r\n\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\t[props.keyName]: s.src\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(s.src)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\temit('input', result)\r\n\t\temit('update:modelValue', result)\r\n\t}\r\n\r\n\tconst addProperties = (item) => {\r\n\t\tconst data = getItemData(item)\r\n\t\tconst absX = imageList.value.length % colsValue.value\r\n\t\tconst absY = Math.floor(imageList.value.length / colsValue.value)\r\n\t\tconst x = absX * viewWidth.value\r\n\t\tconst y = absY * viewHeight.value // 使用viewHeight计算y坐标\r\n\r\n\t\timageList.value.push({\r\n\t\t\t...data,\r\n\t\t\tx,\r\n\t\t\ty,\r\n\t\t\toldX: x,\r\n\t\t\toldY: y,\r\n\t\t\tabsX,\r\n\t\t\tabsY,\r\n\t\t\tscale: 1,\r\n\t\t\tzIndex: 9,\r\n\t\t\topacity: 1,\r\n\t\t\tindex: imageList.value.length,\r\n\t\t\tid: item.id,\r\n\t\t\tdisable: false,\r\n\t\t\toffset: 0,\r\n\t\t\tmoveEnd: false\r\n\t\t})\r\n\r\n\t\tadd.value.x = (imageList.value.length % colsValue.value) * viewWidth.value\r\n\t\tadd.value.y = Math.floor(imageList.value.length / colsValue.value) * viewHeight.value\r\n\t}\r\n\r\n\tconst rpx2px = (v) => {\r\n\t\treturn width.value * v / 750\r\n\t}\r\n\r\n\tconst guid = (len = 32) => {\r\n\t\tconst chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('')\r\n\t\tconst uuid = []\r\n\t\tconst radix = chars.length\r\n\t\tfor (let i = 0; i < len; i++) uuid[i] = chars[0 | Math.random() * radix]\r\n\t\tuuid.shift()\r\n\t\treturn `u${uuid.join('')}`\r\n\t}\r\n\tconst instanceRef = ref(null); // 保存组件实例引用\r\n\t// 初始化\r\n\tonMounted(() => {\r\n\t\twidth.value = uni.getSystemInfoSync().windowWidth\r\n\r\n\t\t// 获取当前组件实例\r\n\t\tinstanceRef.value = getCurrentInstance(); // 在挂载时保存实例\r\n\r\n\t\t// 使用 nextTick 确保元素已渲染\r\n\t\tnextTick(() => {\r\n\t\t\tconst query = uni.createSelectorQuery().in(instanceRef.value.proxy)\r\n\t\t\tquery.select('.con').boundingClientRect(data => {\r\n\t\t\t\tif (!data) {\r\n\t\t\t\t\tconsole.error('未找到 .con 元素')\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolsValue.value = props.cols\r\n\r\n\t\t\t\t// 计算宽度（保持正方形）\r\n\t\t\t\tviewWidth.value = data.width / props.cols\r\n\r\n\t\t\t\t// 计算高度（宽度 + 文字区域高度）\r\n\t\t\t\t// 假设文字区域高度为图片区域的30%，整体高度为宽度的1.3倍\r\n\t\t\t\tviewHeight.value = viewWidth.value * 1.3\r\n\r\n\t\t\t\tif (props.imageWidth > 0) {\r\n\t\t\t\t\tviewWidth.value = rpx2px(props.imageWidth)\r\n\t\t\t\t\tviewHeight.value = viewWidth.value * 1.3 // 保持比例\r\n\t\t\t\t\tcolsValue.value = Math.floor(data.width / viewWidth.value)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst list = props.modelValue.length ? props.modelValue : props.value\r\n\t\t\t\tlist.forEach(item => {\r\n\t\t\t\t\taddProperties(item)\r\n\t\t\t\t})\r\n\t\t\t\tfirst.value = false\r\n\t\t\t}).exec()\r\n\t\t})\r\n\t\tisMounted.value = true;\r\n\t})\r\n\tconst initViewSize = () => {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\t// 检查实例是否可用\r\n\t\t\tif (!instanceRef.value || !instanceRef.value.proxy) {\r\n\t\t\t\tconsole.warn('Component instance not available for selector query');\r\n\t\t\t\treturn resolve();\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\tconst query = uni.createSelectorQuery().in(instanceRef.value.proxy);\r\n\t\t\tquery.select('.con').boundingClientRect(data => {\r\n\t\t\t\tif (!data) return resolve();\r\n\r\n\t\t\t\tcolsValue.value = props.cols;\r\n\t\t\t\tviewWidth.value = data.width / props.cols;\r\n\t\t\t\tviewHeight.value = viewWidth.value * 1.3;\r\n\r\n\t\t\t\tif (props.imageWidth > 0) {\r\n\t\t\t\t\tviewWidth.value = rpx2px(props.imageWidth);\r\n\t\t\t\t\tviewHeight.value = viewWidth.value * 1.3;\r\n\t\t\t\t\tcolsValue.value = Math.floor(data.width / viewWidth.value);\r\n\t\t\t\t}\r\n\t\t\t\tresolve();\r\n\t\t\t}).exec();\r\n\t\t});\r\n\t};\r\n\t// 监听 value 和 modelValue 的变化\r\n\twatch(() => props.modelValue, (newVal) => {\r\n\t\tif (isMounted.value) {\r\n\t\t\tnextTick(() => {\r\n\t\t\t\tinitViewSize().then(() => {\r\n\t\t\t\t\tupdateImageList(newVal);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}, {\r\n\t\tdeep: true\r\n\t});\r\n\r\n\t// 更新图片列表的公共方法\r\n\tconst updateImageList = (newList) => {\r\n\t\t// 保留原有位置信息\r\n\t\tconst oldItems = imageList.value.reduce((map, item) => {\r\n\t\t\tmap[item.id] = item;\r\n\t\t\treturn map;\r\n\t\t}, {});\r\n\r\n\t\t// 重建列表，保留原有位置状态\r\n\t\timageList.value = newList.map(item => {\r\n\t\t\tconst existing = oldItems[item.id];\r\n\t\t\tif (existing) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...existing,\r\n\t\t\t\t\t...getItemData(item) // 更新可能变化的数据\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn createNewItem(item);\r\n\t\t});\r\n\t};\r\n\r\n\t// 创建新项目的方法\r\n\tconst createNewItem = (item) => {\r\n\t\tconst data = getItemData(item);\r\n\t\tconst absX = imageList.value.length % colsValue.value;\r\n\t\tconst absY = Math.floor(imageList.value.length / colsValue.value);\r\n\r\n\t\treturn {\r\n\t\t\t...data,\r\n\t\t\tx: absX * viewWidth.value,\r\n\t\t\ty: absY * viewHeight.value,\r\n\t\t\toldX: absX * viewWidth.value,\r\n\t\t\toldY: absY * viewHeight.value,\r\n\t\t\tabsX,\r\n\t\t\tabsY,\r\n\t\t\tscale: 1,\r\n\t\t\tzIndex: 9,\r\n\t\t\topacity: 1,\r\n\t\t\tindex: imageList.value.length,\r\n\t\t\tdisable: false,\r\n\t\t\toffset: 0,\r\n\t\t\tmoveEnd: false,\r\n\t\t\tready: false\r\n\t\t};\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.con {\r\n\t\twidth: 100%;\r\n\t\t// padding: 30rpx;\r\n\t\tbox-sizing: border-box;\r\n\r\n\t\t.area {\r\n\t\t\twidth: 100%;\r\n\t\t\tposition: relative;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tborder-radius: 16rpx;\r\n\t\t\toverflow: hidden;\r\n\r\n\r\n\t\t\t.view {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t.ready {\r\n\t\t\t\t\tborder: 3px solid #65c6d9;\r\n\t\t\t\t\tbox-shadow: 0 0 5px #65c6d9;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.area-con {\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\tbackground-color: #fff;\r\n\t\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.08);\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\r\n\t\t\t\t\t.pre-image {\r\n\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\theight: 85%;\r\n\t\t\t\t\t\t/* 图片区域占70% */\r\n\t\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.info-container {\r\n\t\t\t\t\t\tpadding: 8rpx;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\t\theight: 30%;\r\n\t\t\t\t\t\t/* 信息区域占30% */\r\n\r\n\t\t\t\t\t\t.name {\r\n\t\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.price {\r\n\t\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\t\tcolor: #e64340;\r\n\t\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t\t\tcolor: #ff9c9a;\r\n\t\t\t\t\t\t\tfont-weight: 1000;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.type {\r\n\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\ttop: 0;\r\n\t\t\t\t\t\t\tleft: 0;\r\n\t\t\t\t\t\t\tbackground: rgba(105, 196, 226, 0.8);\r\n\t\t\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\t\t\tpadding: 8rpx 18rpx;\r\n\t\t\t\t\t\t\tborder-radius: 10rpx 0 10rpx 0;\r\n\t\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\t\tfont-weight: 600;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/shmily-drag-image/shmily-drag-image.vue'\nwx.createComponent(Component)"],"names":["ref","computed","nextTick","item","uni","onMounted","getCurrentInstance","watch"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDC,UAAM,QAAQ;AAsDd,UAAM,OAAO;AAGb,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,QAAQA,cAAG,IAAC,CAAC;AACnB,UAAM,MAAMA,cAAAA,IAAI;AAAA,MACf,GAAG;AAAA,MACH,GAAG;AAAA,IACL,CAAE;AACD,UAAM,YAAYA,cAAG,IAAC,CAAC;AACvB,UAAM,YAAYA,cAAG,IAAC,CAAC;AACvB,UAAM,aAAaA,cAAG,IAAC,CAAC;AACxB,UAAM,WAAWA,cAAG,IAAC,IAAI;AACzB,UAAM,QAAQA,cAAG,IAAC,IAAI;AACtB,UAAM,eAAeA,cAAG,IAAC,IAAI;AACXA,kBAAAA,IAAI,IAAI;AAC1B,UAAM,QAAQA,cAAG,IAAC,IAAI;AACtB,UAAM,cAAcA,kBAAI,CAAC;AACzB,UAAM,iBAAiBA,kBAAI,IAAI;AAC/B,UAAM,aAAaA,kBAAI,KAAK;AAE5B,UAAM,YAAYA,kBAAI,KAAK;AAG3B,UAAM,aAAaC,cAAAA,SAAS,MAAM;AACjC,UAAI,UAAU,MAAM,SAAS,MAAM,QAAQ;AAC1C,eAAQ,KAAK,MAAM,UAAU,MAAM,SAAS,KAAK,UAAU,KAAK,IAAI,WAAW,QAAS;AAAA,MACxF;AACD,aAAQ,KAAK,KAAK,UAAU,MAAM,SAAS,UAAU,KAAK,IAAI,WAAW,QAAS;AAAA,IACpF,CAAE;AAGD,UAAM,aAAaA,cAAAA,SAAS,MAAM;AACjC,aAAQ,UAAU,QAAQ,OAAO,MAAM,OAAO,IAAI,IAAK;AAAA,IACzD,CAAE;AAED,UAAM,cAAcA,cAAAA,SAAS,MAAM;AAClC,aAAQ,WAAW,QAAQ,OAAO,MAAM,OAAO,IAAI,IAAK;AAAA,IAC1D,CAAE;AAED,UAAM,SAAS,CAAC,SAAS;AACxB,aAAO,MAAM,YAAY,OAAO,KAAK,MAAM,OAAO,IAAI;AAAA,IACtD;AACD,UAAM,cAAc,CAAC,SAAS;AAC7B,aAAO;AAAA,QACN,IAAI,KAAK;AAAA,QACT,KAAK,OAAO,IAAI;AAAA,QAChB,MAAM,KAAK;AAAA,QACX,OAAO,KAAK;AAAA,QACZ,MAAM,KAAK;AAAA,MACX;AAAA,IACD;AAGD,UAAM,WAAW,CAAC,GAAG,SAAS;AAC7B,UAAI,CAAC;AAAM;AACX,WAAK,OAAO,EAAE,OAAO;AACrB,WAAK,OAAO,EAAE,OAAO;AACrB,UAAI,EAAE,OAAO,WAAW,SAAS;AAChC,YAAI,KAAK,SAAS;AACjB,eAAK,SAAS,KAAK;AAAA,YAClB,KAAK,IAAI,KAAK,OAAO,KAAK,OAAO,UAAU,OAAO,CAAC,IACnD,KAAK,IAAI,KAAK,OAAO,KAAK,OAAO,WAAW,OAAO,CAAC;AAAA;AAAA,UACpD;AAAA,QACD;AACD,YAAI,IAAI,KAAK,OAAO,EAAE,OAAO,IAAI,UAAU,QAAQ,KAAK,UAAU,KAAK;AACvE,YAAI,KAAK,UAAU;AAAO;AAC1B,YAAI,IAAI,KAAK,OAAO,EAAE,OAAO,IAAI,WAAW,QAAQ,KAAK,WAAW,KAAK;AACzE,YAAI,QAAQ,UAAU,QAAQ,IAAI;AAElC,YAAI,KAAK,UAAU,SAAS,QAAQ,UAAU,MAAM,QAAQ;AAC3D,uBAAa,QAAQ;AACrB,oBAAU,MAAM,QAAQ,SAAO;AAC9B,gBAAI,KAAK,QAAQ,SAAS,IAAI,SAAS,SAAS,IAAI,QAAQ,KAAK,OAAO;AACvE,wBAAU,KAAK,CAAC;AAAA,YAChB,WAAU,KAAK,QAAQ,SAAS,IAAI,SAAS,SAAS,IAAI,QAAQ,KAAK,OAAO;AAC9E,wBAAU,KAAK,EAAE;AAAA,YACjB,WAAU,IAAI,OAAO,KAAK,IAAI;AAC9B,kBAAI,SAAS;AACb,kBAAI,IAAI,IAAI;AACZ,kBAAI,IAAI,IAAI;AACZ,yBAAW,MAAM;AAChBC,8BAAAA,WAAS,MAAM;AACd,sBAAI,IAAI,IAAI,OAAO,UAAU;AAC7B,sBAAI,IAAI,IAAI,OAAO,WAAW;AAAA,gBACtC,CAAQ;AAAA,cACD,GAAE,CAAC;AAAA,YACJ;AAAA,UACN,CAAK;AAGD,mBAAS,MAAM,KAAK;AAEpB,eAAK,QAAQ;AACb,eAAK,OAAO;AACZ,eAAK,OAAO;AACZ,cAAI,CAAC,KAAK,SAAS;AAClB,uBAAW,MAAM;AAChBA,4BAAAA,WAAS,MAAM;AACd,qBAAK,IAAI,KAAK,OAAO,UAAU;AAC/B,qBAAK,IAAI,KAAK,OAAO,WAAW;AAAA,cACvC,CAAO;AAAA,YACD,GAAE,CAAC;AAAA,UACJ;AACD,mBAAU;AAAA,QACV;AAAA,MACD;AAAA,IACD;AAGD,UAAM,WAAW,CAAC,MAAM,aAAa;AACpC,YAAM,WAAW,UAAU,MAAM,UAAU,OAAK,EAAE,OAAO,KAAK,EAAE;AAChE,UAAI,aAAa,MAAM,aAAa;AAAU;AAG9C,gBAAU,MAAM,OAAO,UAAU,GAAG,UAAU,MAAM,OAAO,UAAU,CAAC,EAAE,CAAC,CAAC;AAG1E,gBAAU,MAAM,QAAQ,CAACC,OAAM,QAAQ;AACtC,QAAAA,MAAK,QAAQ;AAAA,MAChB,CAAG;AAED;IACA;AAED,UAAM,YAAY,CAAC,KAAK,MAAM;AAC7B,UAAI,SAAS;AACb,UAAI,SAAS;AACb,UAAI,IAAI,IAAI;AACZ,UAAI,IAAI,IAAI;AACZ,UAAI,OAAO,IAAI,QAAQ,UAAU;AACjC,UAAI,OAAO,KAAK,MAAM,IAAI,QAAQ,UAAU,KAAK;AACjD,iBAAW,MAAM;AAChBD,sBAAAA,WAAS,MAAM;AACd,cAAI,IAAI,IAAI,OAAO,UAAU;AAC7B,cAAI,IAAI,IAAI,OAAO,WAAW;AAAA,QAClC,CAAI;AAAA,MACD,GAAE,CAAC;AAAA,IACJ;AAED,UAAM,mBAAmB,CAAC,MAAM,MAAM;AAErC,kBAAY,QAAQ,EAAE,QAAQ,CAAC,EAAE;AAGjC,UAAI,eAAe,OAAO;AACzB,qBAAa,eAAe,KAAK;AACjC,uBAAe,QAAQ;AAAA,MACvB;AAGD,gBAAU,MAAM,QAAQ,CAAAC,UAAQ;AAC/B,QAAAA,MAAK,QAAQ;AACb,QAAAA,MAAK,UAAU;AAAA,MAClB,CAAG;AACDC,oBAAAA,gFAAY,MAAM;AAGlB,qBAAe,QAAQ,WAAW,MAAM;AACvCA,sBAAAA,MAAA,MAAA,OAAA,6DAAY,OAAO;AACnBA,sBAAAA,MAAI,aAAa;AAAA,UAChB,SAAS,MAAM;AACdA,0BAAAA,MAAY,MAAA,OAAA,6DAAA,MAAM;AAAA,UAClB;AAAA,QACL,CAAI;AACD,aAAK,QAAQ;AACb,aAAK,UAAU;AACf,mBAAW,QAAQ;AACnB,mBAAW,IAAI;AAAA,MACf,GAAE,GAAG;AAAA,IACR;AAEC,UAAM,aAAa,CAAC,MAAM,MAAM;AAC/BA,oBAAAA,MAAY,MAAA,OAAA,6DAAA,cAAc;AAC1B,gBAAU,MAAM,QAAQ,OAAK;AAC5B,UAAE,SAAS,EAAE,QAAQ;AAAA,MACxB,CAAG;AACD,WAAK,SAAS;AACd,WAAK,UAAU;AACf,eAAS,QAAQ;AACjB,YAAM,QAAQ,WAAW,MAAM;AAC9B,aAAK,QAAQ,MAAM;AACnB,aAAK,UAAU,MAAM;AACrB,qBAAa,MAAM,KAAK;AACxB,cAAM,QAAQ;AAAA,MACd,GAAE,GAAG;AAAA,IACN;AAED,UAAM,WAAW,CAAC,SAAS;AAE1B,WAAK,QAAQ;AACb,WAAK,UAAU;AACf,WAAK,IAAI,KAAK;AACd,WAAK,IAAI,KAAK;AACd,WAAK,SAAS;AACd,WAAK,UAAU;AAGfA,oBAAAA,MAAY,MAAA,OAAA,6DAAA,cAAc;AAC1B,gBAAU,MAAM,QAAQ,CAAAD,UAAQ;AAC/B,QAAAA,MAAK,QAAQ;AACb,QAAAA,MAAK,UAAU;AAAA,MAClB,CAAG;AACD,UAAI,WAAW,SAAS,MAAM;AAC7BC,sBAAAA,MAAY,MAAA,OAAA,6DAAA,iBAAiB;AAG7B,cAAM,YAAY,UAAU,MAAM,IAAI,CAAAD,UAAQA,MAAK,EAAE;AAErD,aAAK,eAAe,SAAS;AAAA,MAG7B;AAED,iBAAW,QAAQ;AAEnB,UAAI,eAAe,OAAO;AACzB,qBAAa,eAAe,KAAK;AACjC,uBAAe,QAAQ;AAAA,MACvB;AAED,iBAAW,MAAM;AAChB,kBAAU,MAAM,QAAQ,SAAO;AAC9B,cAAI,IAAI;AAAO;AAEf,cAAI,IAAI,IAAI,OAAO,UAAU;AAC7B,cAAI,IAAI,IAAI,OAAO,WAAW;AAC9B,cAAI,SAAS;AACb,cAAI,UAAU;AAAA,QAClB,CAAI;AAGDD,sBAAAA,WAAS,MAAM;AACd,eAAK,IAAI,KAAK,OAAO,UAAU;AAC/B,eAAK,IAAI,KAAK,OAAO,WAAW;AAChC,mBAAS,QAAQ;AACjB,uBAAa,QAAQ;AAAA,QACzB,CAAI;AAAA,MACD,GAAE,EAAE;AAAA,IACL;AAED,UAAM,gBAAgB,CAAC,cAAc;;AACpC,UAAI,CAAC;AAAW,eAAO;AAGvB,YAAM,OAAO,UAAU,MAAM,GAAG;AAChC,YAAM,aAAW,UAAK,CAAC,MAAN,mBAAS,WAAU;AAGpC,UAAI,SAAS,WAAW,MAAM,GAAG;AAChC,eAAO;AAAA,MACP;AAGD,aAAO;AAAA,IACT;AA4BC,UAAM,aAAa,MAAM;AAAA,IAMxB;AAED,UAAM,aAAa,MAAM;AAAA,IA2BxB;AAED,UAAM,cAAc,CAAC,GAAG,SAAS;AAEhC,UAAI,WAAW;AAAO;AAGtB,YAAM,SAAS,EAAE,QAAQ,CAAC,EAAE;AAC5B,YAAM,SAAS,KAAK,IAAI,SAAS,YAAY,KAAK;AAGlD,UAAI,SAAS,MAAM,eAAe,OAAO;AACxC,qBAAa,eAAe,KAAK;AACjC,uBAAe,QAAQ;AAAA,MACvB;AAAA,IACH;AAsCC,aAAS,WAAW,IAAI;AACvBE,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,sEAAsE;AAAA,MAC9E,CAAG;AAAA,IACD;AA+BD,UAAM,WAAW,MAAM;AACtB,YAAM,SAAS,CAAE;AACjB,YAAM,SAAS,MAAM,WAAW,SAAS,MAAM,aAAa,MAAM;AAClE,YAAM,OAAO,CAAC,GAAG,UAAU,KAAK,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AAElE,eAAS,KAAK,MAAM;AACnB,cAAM,OAAO,OAAO,KAAK,OAAK,OAAO,CAAC,MAAM,EAAE,GAAG;AACjD,YAAI,MAAM;AACT,iBAAO,KAAK,IAAI;AAAA,QACpB,OAAU;AACN,cAAI,MAAM,YAAY,MAAM;AAC3B,mBAAO,KAAK;AAAA,cACX,CAAC,MAAM,OAAO,GAAG,EAAE;AAAA,YACzB,CAAM;AAAA,UACN,OAAW;AACN,mBAAO,KAAK,EAAE,GAAG;AAAA,UACjB;AAAA,QACD;AAAA,MACD;AAED,WAAK,SAAS,MAAM;AACpB,WAAK,qBAAqB,MAAM;AAAA,IAChC;AAED,UAAM,gBAAgB,CAAC,SAAS;AAC/B,YAAM,OAAO,YAAY,IAAI;AAC7B,YAAM,OAAO,UAAU,MAAM,SAAS,UAAU;AAChD,YAAM,OAAO,KAAK,MAAM,UAAU,MAAM,SAAS,UAAU,KAAK;AAChE,YAAM,IAAI,OAAO,UAAU;AAC3B,YAAM,IAAI,OAAO,WAAW;AAE5B,gBAAU,MAAM,KAAK;AAAA,QACpB,GAAG;AAAA,QACH;AAAA,QACA;AAAA,QACA,MAAM;AAAA,QACN,MAAM;AAAA,QACN;AAAA,QACA;AAAA,QACA,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,SAAS;AAAA,QACT,OAAO,UAAU,MAAM;AAAA,QACvB,IAAI,KAAK;AAAA,QACT,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,SAAS;AAAA,MACZ,CAAG;AAED,UAAI,MAAM,IAAK,UAAU,MAAM,SAAS,UAAU,QAAS,UAAU;AACrE,UAAI,MAAM,IAAI,KAAK,MAAM,UAAU,MAAM,SAAS,UAAU,KAAK,IAAI,WAAW;AAAA,IAChF;AAED,UAAM,SAAS,CAAC,MAAM;AACrB,aAAO,MAAM,QAAQ,IAAI;AAAA,IACzB;AAUD,UAAM,cAAcJ,kBAAI,IAAI;AAE5BK,kBAAAA,UAAU,MAAM;AACf,YAAM,QAAQD,oBAAI,kBAAmB,EAAC;AAGtC,kBAAY,QAAQE,cAAAA;AAGpBJ,oBAAAA,WAAS,MAAM;AACd,cAAM,QAAQE,cAAAA,MAAI,oBAAmB,EAAG,GAAG,YAAY,MAAM,KAAK;AAClE,cAAM,OAAO,MAAM,EAAE,mBAAmB,UAAQ;AAC/C,cAAI,CAAC,MAAM;AACVA,0BAAAA,MAAc,MAAA,SAAA,6DAAA,aAAa;AAC3B;AAAA,UACA;AAED,oBAAU,QAAQ,MAAM;AAGxB,oBAAU,QAAQ,KAAK,QAAQ,MAAM;AAIrC,qBAAW,QAAQ,UAAU,QAAQ;AAErC,cAAI,MAAM,aAAa,GAAG;AACzB,sBAAU,QAAQ,OAAO,MAAM,UAAU;AACzC,uBAAW,QAAQ,UAAU,QAAQ;AACrC,sBAAU,QAAQ,KAAK,MAAM,KAAK,QAAQ,UAAU,KAAK;AAAA,UACzD;AAED,gBAAM,OAAO,MAAM,WAAW,SAAS,MAAM,aAAa,MAAM;AAChE,eAAK,QAAQ,UAAQ;AACpB,0BAAc,IAAI;AAAA,UACvB,CAAK;AACD,gBAAM,QAAQ;AAAA,QACd,CAAA,EAAE,KAAM;AAAA,MACZ,CAAG;AACD,gBAAU,QAAQ;AAAA,IACpB,CAAE;AACD,UAAM,eAAe,MAAM;AAC1B,aAAO,IAAI,QAAQ,aAAW;AAE7B,YAAI,CAAC,YAAY,SAAS,CAAC,YAAY,MAAM,OAAO;AACnDA,wBAAAA,MAAa,MAAA,QAAA,6DAAA,qDAAqD;AAClE,iBAAO,QAAO;AAAA,QACd;AAID,cAAM,QAAQA,cAAG,MAAC,oBAAqB,EAAC,GAAG,YAAY,MAAM,KAAK;AAClE,cAAM,OAAO,MAAM,EAAE,mBAAmB,UAAQ;AAC/C,cAAI,CAAC;AAAM,mBAAO;AAElB,oBAAU,QAAQ,MAAM;AACxB,oBAAU,QAAQ,KAAK,QAAQ,MAAM;AACrC,qBAAW,QAAQ,UAAU,QAAQ;AAErC,cAAI,MAAM,aAAa,GAAG;AACzB,sBAAU,QAAQ,OAAO,MAAM,UAAU;AACzC,uBAAW,QAAQ,UAAU,QAAQ;AACrC,sBAAU,QAAQ,KAAK,MAAM,KAAK,QAAQ,UAAU,KAAK;AAAA,UACzD;AACD;QACJ,CAAI,EAAE,KAAI;AAAA,MACV,CAAG;AAAA,IACH;AAECG,kBAAAA,MAAM,MAAM,MAAM,YAAY,CAAC,WAAW;AACzC,UAAI,UAAU,OAAO;AACpBL,sBAAAA,WAAS,MAAM;AACd,uBAAY,EAAG,KAAK,MAAM;AACzB,4BAAgB,MAAM;AAAA,UAC3B,CAAK;AAAA,QACL,CAAI;AAAA,MACD;AAAA,IACH,GAAI;AAAA,MACF,MAAM;AAAA,IACR,CAAE;AAGD,UAAM,kBAAkB,CAAC,YAAY;AAEpC,YAAM,WAAW,UAAU,MAAM,OAAO,CAAC,KAAK,SAAS;AACtD,YAAI,KAAK,EAAE,IAAI;AACf,eAAO;AAAA,MACP,GAAE,CAAE,CAAA;AAGL,gBAAU,QAAQ,QAAQ,IAAI,UAAQ;AACrC,cAAM,WAAW,SAAS,KAAK,EAAE;AACjC,YAAI,UAAU;AACb,iBAAO;AAAA,YACN,GAAG;AAAA,YACH,GAAG,YAAY,IAAI;AAAA;AAAA,UACxB;AAAA,QACI;AACD,eAAO,cAAc,IAAI;AAAA,MAC5B,CAAG;AAAA,IACH;AAGC,UAAM,gBAAgB,CAAC,SAAS;AAC/B,YAAM,OAAO,YAAY,IAAI;AAC7B,YAAM,OAAO,UAAU,MAAM,SAAS,UAAU;AAChD,YAAM,OAAO,KAAK,MAAM,UAAU,MAAM,SAAS,UAAU,KAAK;AAEhE,aAAO;AAAA,QACN,GAAG;AAAA,QACH,GAAG,OAAO,UAAU;AAAA,QACpB,GAAG,OAAO,WAAW;AAAA,QACrB,MAAM,OAAO,UAAU;AAAA,QACvB,MAAM,OAAO,WAAW;AAAA,QACxB;AAAA,QACA;AAAA,QACA,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,SAAS;AAAA,QACT,OAAO,UAAU,MAAM;AAAA,QACvB,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,SAAS;AAAA,QACT,OAAO;AAAA,MACV;AAAA,IACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9rBA,GAAG,gBAAgB,SAAS;"}