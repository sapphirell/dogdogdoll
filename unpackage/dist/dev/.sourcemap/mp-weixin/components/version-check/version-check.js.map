{"version":3,"file":"version-check.js","sources":["components/version-check/version-check.vue","/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/version-check/version-check.vue?type=component"],"sourcesContent":["<template>\n\t<!-- 版本检查组件 -->\n\t<view>\n\t\t<!-- 新版本提示弹窗 -->\n\t\t<common-modal :visible=\"modalVisible\" @update:visible=\"modalVisible = $event\" top=\"15vh\">\n\t\t\t<view class=\"version-update-container\">\n\t\t\t\t<view class=\"update-title\">发现新版本 v{{newVersionInfo?.version}} 当前 v{{}}</view>\n\n\t\t\t\t<scroll-view class=\"update-content\" scroll-y>\n\t\t\t\t\t<view class=\"update-section\">\n\t\t\t\t\t\t<view class=\"section-title\">更新内容</view>\n\t\t\t\t\t\t<view class=\"section-content\">{{newVersionInfo?.note || '优化用户体验，修复已知问题'}}</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"update-section\">\n\t\t\t\t\t\t<view class=\"section-title\">更新日期</view>\n\t\t\t\t\t\t<view class=\"section-content\">{{formatTime(newVersionInfo?.created_at)}}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\n\t\t\t\t<view class=\"update-buttons\">\n\t\t\t\t\t<button class=\"update-btn ignore\" @tap=\"ignoreUpdate\">暂不更新</button>\n\t\t\t\t\t<button class=\"update-btn confirm\" @tap=\"handleUpdate\">立即更新</button>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</common-modal>\n\n\t\t<!-- 已是最新版本提示 -->\n\t\t<view v-if=\"showUpToDateToast\" class=\"toast-message\">\n\t\t\t<text>已是最新版本</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tonMounted,\n\t\tcomputed\n\t} from 'vue';\n\timport {\n\t\twebsiteUrl,\n\t\tgetScene,\n\t\tdogdogdollVersion,\n\t} from '../../common/config.js';\n\n\t// 组件属性\n\tconst props = defineProps({\n\t\t// 是否显示已是最新版本的提示\n\t\tshowUpToDateToast: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\t// 当前版本号\n\t\tcurrentVersion: {\n\t\t\ttype: String,\n\t\t\trequired: false\n\t\t},\n\t\t// 是否自动检查版本\n\t\tautoCheck: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t}\n\t});\n\n\t// 弹窗可见性\n\tconst modalVisible = ref(false);\n\t// 新版本信息\n\tconst newVersionInfo = ref(null);\n\t// 显示已是最新提示\n\tconst showUpToDateToast = ref(false);\n\tconst cv = ref(\"1.0.0\")\n\t// 获取平台信息\n\tconst platform = computed(() => {\n\t\tconst systemInfo = uni.getSystemInfoSync();\n\t\treturn systemInfo.platform || 'unknown';\n\t});\n\n\t// 格式化时间\n\tconst formatTime = (timestamp) => {\n\t\tif (!timestamp) return '未知日期';\n\t\tconst date = new Date(timestamp * 1000);\n\t\treturn `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;\n\t}\n\n\t// 检查是否在忽略期内\n\tconst isIgnored = () => {\n\t\tconst ignoreTime = uni.getStorageSync('ignoreUpdateTime');\n\t\tconsole.log(\"忽略时间：\", ignoreTime)\n\t\tif (!ignoreTime) return false;\n\n\t\t// 检查是否在3天（259200000毫秒）内\n\t\tconst now = Date.now();\n\t\tconsole.log(\"当前时间\", now)\n\t\treturn (now - ignoreTime) < 259200000;\n\t}\n\n\t// 检查版本更新\n\tconst checkVersion = async () => {\n\t\ttry {\n\t\t\t// 平台检查：H5或小程序不弹出\n\t\t\tlet scene = getScene()\n\t\t\tif (scene === 1 || scene === 4) {\n\t\t\t\tconsole.log(\"scene:\", scene)\n\t\t\t\treturn\n\t\t\t}\n\t\t\t// 检查是否在忽略期内\n\t\t\tif (isIgnored()) {\n\t\t\t\tconsole.log('在忽略期内，不显示更新提示 ');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst cv = uni.getAppBaseInfo().appVersion;\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: `${websiteUrl.value}/latest-version?version=${dogdogdollVersion}`,\n\t\t\t\tmethod: 'GET'\n\t\t\t});\n\n\t\t\tif (res && res.data) {\n\t\t\t\tif (res.data.status === 'success' && res.data.data) {\n\t\t\t\t\t// 有新版本\n\t\t\t\t\tnewVersionInfo.value = res.data.data;\n\t\t\t\t\tmodalVisible.value = true;\n\t\t\t\t} else if (res.data.status === 'failed' && props.showUpToDateToast) {\n\t\t\t\t\t// 已是最新版本\n\t\t\t\t\tshowUpToDateToast.value = true;\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tshowUpToDateToast.value = false;\n\t\t\t\t\t}, 2000);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error('版本检查失败:', err);\n\t\t}\n\t};\n\n\t// 处理更新操作\n\tconst handleUpdate = () => {\n\t\t// 记录用户选择了更新（3天内不再提示）\n\t\tuni.setStorageSync('ignoreUpdateTime', Date.now());\n\n\t\tmodalVisible.value = false;\n\n\t\t// 平台特定的更新处理\n\t\tconst platformValue = platform.value.toLowerCase();\n\t\tconsole.log(platformValue)\n\n\t\tlet scene = getScene()\n\n\t\tif (scene === 2) {\n\t\t\t// iOS 跳转 App Store\n\t\t\tplus.runtime.openURL('https://apps.apple.com/app/id6747564362');\n\t\t} else if (scene === 3) {\n\t\t\tplus.runtime.openURL('https://apps.apple.com/app/id6747564362');\n\t\t} else {\n\t\t\t// 其他平台提示\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '更新提示',\n\t\t\t\tcontent: '请前往应用商店更新最新版本',\n\t\t\t\tshowCancel: false\n\t\t\t});\n\t\t}\n\t};\n\n\t// 忽略更新\n\tconst ignoreUpdate = () => {\n\t\t// 记录忽略时间（3天内不再提示）\n\t\tuni.setStorageSync('ignoreUpdateTime', Date.now());\n\t\tmodalVisible.value = false;\n\t};\n\n\t// 暴露检查方法给父组件\n\tdefineExpose({\n\t\tcheckVersion\n\t});\n\n\t// 自动检查版本\n\tonMounted(() => {\n\t\tcv.value = uni.getAppBaseInfo().appVersion;\n\t\tif (props.autoCheck) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tcheckVersion();\n\t\t\t}, 1500);\n\t\t}\n\t});\n</script>\n\n<style lang=\"less\">\n\t.version-update-container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 30rpx;\n\t\twidth: 600rpx;\n\t\tbox-sizing: border-box;\n\n\t\t.update-icon {\n\t\t\twidth: 160rpx;\n\t\t\theight: 160rpx;\n\t\t\tmargin-bottom: 20rpx;\n\t\t}\n\n\t\t.update-title {\n\t\t\tfont-size: 32rpx;\n\t\t\tfont-weight: bold;\n\t\t\tcolor: #333;\n\t\t\tmargin-bottom: 30rpx;\n\t\t\ttext-align: center;\n\t\t}\n\n\t\t.update-content {\n\t\t\twidth: 100%;\n\t\t\tmax-height: 300rpx;\n\t\t\tmargin-bottom: 40rpx;\n\t\t\tborder-radius: 12rpx;\n\t\t\tbackground-color: #f8f9fa;\n\t\t\tpadding: 20rpx;\n\t\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n\n\t\t\t.update-section {\n\t\t\t\tmargin-bottom: 40rpx;\n\n\t\t\t\t.section-title {\n\t\t\t\t\tfont-size: 26rpx;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tcolor: #4a90e2;\n\t\t\t\t\tmargin-bottom: 10rpx;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tpadding-left: 20rpx;\n\n\t\t\t\t\t&::before {\n\t\t\t\t\t\tcontent: '';\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\ttop: 50%;\n\t\t\t\t\t\ttransform: translateY(-50%);\n\t\t\t\t\t\twidth: 8rpx;\n\t\t\t\t\t\theight: 26rpx;\n\t\t\t\t\t\tbackground: linear-gradient(to bottom, #4facfe, #00f2fe);\n\t\t\t\t\t\tborder-radius: 4rpx;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.section-content {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: #666;\n\t\t\t\t\tline-height: 1.6;\n\t\t\t\t\tpadding-left: 20rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.update-buttons {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\twidth: 100%;\n\t\t\tgap: 20rpx;\n\n\t\t\t.update-btn {\n\t\t\t\tflex: 1;\n\t\t\t\theight: 60rpx;\n\t\t\t\tborder-radius: 40rpx;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\ttransition: all 0.3s;\n\t\t\t\tposition: relative;\n\t\t\t\toverflow: hidden;\n\n\t\t\t\t&::after {\n\t\t\t\t\tborder: none;\n\t\t\t\t}\n\n\t\t\t\t&.ignore {\n\t\t\t\t\tbackground-color: #f5f5f5;\n\t\t\t\t\tcolor: #666;\n\t\t\t\t\tborder: 1rpx solid #e5e5e5;\n\n\t\t\t\t\t&:active {\n\t\t\t\t\t\tbackground-color: #e5e5e5;\n\t\t\t\t\t\ttransform: translateY(2rpx);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t&.confirm {\n\t\t\t\t\tbackground: linear-gradient(135deg, #a6e9f7, #1ed1e1);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(30, 209, 225, 0.4);\n\n\t\t\t\t\t&:active {\n\t\t\t\t\t\topacity: 0.9;\n\t\t\t\t\t\ttransform: translateY(2rpx);\n\t\t\t\t\t\tbox-shadow: 0 2rpx 6rpx rgba(30, 209, 225, 0.4);\n\t\t\t\t\t}\n\n\t\t\t\t\t// &::before {\n\t\t\t\t\t//   content: '';\n\t\t\t\t\t//   position: absolute;\n\t\t\t\t\t//   top: -50%;\n\t\t\t\t\t//   left: -50%;\n\t\t\t\t\t//   width: 200%;\n\t\t\t\t\t//   height: 200%;\n\t\t\t\t\t//   background: linear-gradient(\n\t\t\t\t\t//     to right,\n\t\t\t\t\t//     rgba(255, 255, 255, 0) 0%,\n\t\t\t\t\t//     rgba(255, 255, 255, 0.8) 50%,\n\t\t\t\t\t//     rgba(255, 255, 255, 0) 100%\n\t\t\t\t\t//   );\n\t\t\t\t\t//   transform: rotate(30deg);\n\t\t\t\t\t//   animation: shine 2s infinite;\n\t\t\t\t\t// }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t.toast-message {\n\t\tposition: fixed;\n\t\tbottom: 150rpx;\n\t\tleft: 50%;\n\t\ttransform: translateX(-50%);\n\t\tbackground-color: rgba(0, 0, 0, 0.7);\n\t\tcolor: white;\n\t\tpadding: 20rpx 40rpx;\n\t\tborder-radius: 50rpx;\n\t\tfont-size: 26rpx;\n\t\tz-index: 9999;\n\t\tanimation: fadeInOut 2s forwards;\n\t}\n\n\t@keyframes fadeInOut {\n\t\t0% {\n\t\t\topacity: 0;\n\t\t}\n\n\t\t20% {\n\t\t\topacity: 1;\n\t\t}\n\n\t\t80% {\n\t\t\topacity: 1;\n\t\t}\n\n\t\t100% {\n\t\t\topacity: 0;\n\t\t}\n\t}\n\n\t@keyframes shine {\n\t\t0% {\n\t\t\ttransform: translateX(-100%) rotate(30deg);\n\t\t}\n\n\t\t100% {\n\t\t\ttransform: translateX(100%) rotate(30deg);\n\t\t}\n\t}\n</style>","import Component from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/components/version-check/version-check.vue'\nwx.createComponent(Component)"],"names":["ref","computed","uni","getScene","cv","websiteUrl","dogdogdollVersion","onMounted","Component"],"mappings":"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"}