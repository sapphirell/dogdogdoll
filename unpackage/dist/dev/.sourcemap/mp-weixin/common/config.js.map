{"version":3,"file":"config.js","sources":["common/config.js"],"sourcesContent":["import {\r\n\treactive\r\n} from 'vue';\r\n\r\n// 网站域名\r\n// export const websiteUrl = 'http://localhost:8080';\r\nexport const websiteUrl = 'https://api.fantuanpu.com';\t\r\n// 图片域名\r\nexport const image1Url = 'https://images1.fantuanpu.com/';\r\n\r\n// 全局状态\r\nexport let global = reactive({\r\n\tisLogin: false,\r\n\tuserInfo: {},\r\n});\r\n\r\n// 微信登录\r\nexport function wechatSignLogin() {\r\n\tif (process.env.VUE_APP_PLATFORM !== 'mp-weixin') {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '请在微信小程序中登录',\r\n\t\t\ticon: 'none',\r\n\t\t});\r\n\t\treturn;\r\n\t}\r\n\r\n\tuni.login({\r\n\t\tprovider: 'weixin',\r\n\t\tonlyAuthorize: true,\r\n\t\tsuccess: (event) => {\r\n\t\t\tconst {\r\n\t\t\t\tcode\r\n\t\t\t} = event;\r\n\t\t\tif (!code) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '微信登录失败，授权初始化失败',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tuni.request({\r\n\t\t\t\turl: `${websiteUrl}/login-with-wechat`,\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tjs_token: code\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tconst data = res.data.data;\r\n\t\t\t\t\tconsole.log(data)\r\n\t\t\t\t\tif (res.data.status != \"success\") {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: data.msg,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data.jwt_token) {\n\t\t\t\t\t\t// 微信登录成功\n\t\t\t\t\t\tconsole.log(\"data.token:\", data.jwt_token);\r\n\t\t\t\t\t\tuni.setStorageSync('token', data.jwt_token);\r\n\t\t\t\t\t\t\n\t\t\t\t\t\t//刷新当前页面数据\r\n\t\t\t\t\t\tgetUserInfo();\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\thandleRequestError(err, '微信登录失败');\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t},\r\n\t\tfail: (err) => {\r\n\t\t\thandleRequestError(err, '微信授权失败');\r\n\t\t},\r\n\t});\r\n}\r\n\r\n// 获取用户信息\r\nexport function getUserInfo() {\r\n\tconst token = uni.getStorageSync('token');\n\tconsole.log(\"token:\", token)\r\n\tif (!token) {\n\t\tconsole.log(\"没有token，无法获取用户信息\");\r\n\t\tclearUserInfo();\r\n\t\treturn;\r\n\t}\r\n\tconsole.log(\"请求接口\")\r\n\tuni.request({\r\n\t\turl: `${websiteUrl}/with-state/mine`,\r\n\t\tmethod: 'GET',\r\n\t\theader: {\r\n\t\t\tAuthorization: token\r\n\t\t},\r\n\t\tsuccess: (res) => {\r\n\t\t\tconst data = res.data.data;\r\n\t\t\tif (data) {\n\t\t\t\tconsole.log(\"获取用户信息成功,进行存储\", data);\r\n\t\t\t\tsaveUserInfo(data);\r\n\t\t\t} else {\n\t\t\t\tconsole.log(\"无法获取，清理用户状态\")\r\n\t\t\t\tclearUserInfo();\r\n\t\t\t}\r\n\t\t},\r\n\t\tfail: (err) => {\r\n\t\t\thandleRequestError(err, '获取用户信息失败');\r\n\t\t},\r\n\t});\r\n}\r\n\r\n\r\n\r\n// 获取用户信息，返回 Promise\r\nexport function asyncGetUserInfo() {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst token = uni.getStorageSync('token');\r\n\t\tif (!token) {\r\n\t\t\tclearUserInfo();\r\n\t\t\tresolve(null); // 返回 null 表示没有 token，无法获取用户信息\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tuni.request({\r\n\t\t\turl: `${websiteUrl}/with-state/mine`,\r\n\t\t\tmethod: 'GET',\r\n\t\t\theader: {\r\n\t\t\t\tAuthorization: token\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconst data = res.data.data;\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tconsole.log(\"返回：\", data);\r\n\t\t\t\t\tsaveUserInfo(data);\r\n\t\t\t\t\tresolve(data); // 返回用户信息\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclearUserInfo();\r\n\t\t\t\t\tresolve(null); // 如果没有数据，清空用户信息并返回 null\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\thandleRequestError(err, '获取用户信息失败');\r\n\t\t\t\tresolve(null); // 请求失败，返回 null\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n\r\n//提交评分\r\nexport async function voteScore(type, score, targetId) {\r\n\tlet token = uni.getStorageSync('token')\r\n\tif (!token) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '请先登录',\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t\treturn 0;\r\n\t}\r\n\tuni.request({\r\n\t\turl: websiteUrl + '/with-state/add-vote-score',\r\n\t\tmethod: 'POST',\r\n\t\theader: {\r\n\t\t\t'Authorization': token,\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttarget_id: parseInt(targetId),\r\n\t\t\tscore: parseInt(score),\r\n\t\t\ttype: type\r\n\t\t},\r\n\t\tsuccess: (res) => {\r\n\t\t\tconsole.log(res.data);\r\n\t\t\tif (res.data.status == \"success\") {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '评分成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\t//关闭弹窗\r\n\t\t\t\tactiveModal.value = false\r\n\t\t\t\treturn 0;\r\n\t\t\t} else {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.data.msg,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\t\tfail: (err) => {\r\n\t\t\tconsole.log(err);\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '网络请求失败',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t},\r\n\t});\r\n\r\n\treturn 0;\r\n}\r\n// 获取当前场景  评论来源 1=网页 2=ios 3=安卓 4=微信小程序\r\nexport function getScene() {\r\n\t// 获取运行平台信息\r\n\tconst platform = process.env.UNI_PLATFORM\r\n\r\n\t// 微信小程序\r\n\tif (platform === 'mp-weixin') {\r\n\t\treturn 4\r\n\t}\r\n\r\n\t// H5网页\r\n\tif (platform === 'h5') {\r\n\t\treturn 1\r\n\t}\r\n\r\n\t// App 环境\r\n\tif (platform === 'app-plus') {\r\n\t\tconst systemInfo = uni.getSystemInfoSync()\r\n\t\t// iOS 设备\r\n\t\tif (systemInfo.osName === 'ios') {\r\n\t\t\treturn 2\r\n\t\t}\r\n\t\t// Android 设备\r\n\t\tif (systemInfo.osName === 'android') {\r\n\t\t\treturn 3\r\n\t\t}\r\n\t}\r\n\r\n\t// 默认返回网页（可根据需要修改）\r\n\treturn 1\r\n}\r\n\r\n\r\n// 工具函数\r\nfunction saveUserInfo(data) {\r\n\tuni.setStorageSync('userInfo', data);\n\tuni.setStorageSync('token', data.last_token)\r\n\tglobal.userInfo = data;\r\n\tglobal.isLogin = true;\r\n}\r\n\r\nfunction clearUserInfo() {\r\n\tuni.removeStorageSync('userInfo');\r\n\tglobal.userInfo = {};\r\n\tglobal.isLogin = false;\r\n}\r\n\r\nfunction handleRequestError(error, message = '请求失败') {\r\n\tconsole.error(error);\r\n\tuni.showToast({\r\n\t\ttitle: message,\r\n\t\ticon: 'none'\r\n\t});\r\n}"],"names":["reactive","uni"],"mappings":"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"}