{"version":3,"file":"article_detail.js","sources":["pages/article_detail/article_detail.vue","pages/article_detail/article_detail.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"article-container\">\n    <!-- 文章封面 -->\n    <image \n      v-if=\"article.banner\" \n      :src=\"article.banner\" \n      mode=\"widthFix\" \n      class=\"banner\"\n    />\n\n    <!-- 文章主体 -->\n    <view class=\"content-wrapper\">\n      <text class=\"title\">{{ article.title }}</text>\n      \n      <!-- HTML内容渲染 -->\n      <mp-html\n        :content=\"article.content\" \n        class=\"content-html\"\n      />\n\n       <!-- 评论区组件 -->\n\t   <view v-if=\"article.id > 0\">\n\t\t   <view>\n\t\t       <comment-list \n\t\t         ref=\"commentListRef\"\n\t\t         :type=\"7\"\n\t\t         :relation-id=\"parseInt(article.id)\" \n\t\t         @reply=\"handleReplyComment\"\n\t\t       />\n\t\t     </view>\n\t\t      \n\t\t     <!-- 评论输入框组件 -->\n\t\t     <comment-input \n\t\t       ref=\"commentInputRef\"\n\t\t       :reply-info=\"replyForItem\" \n\t\t       :target-id=\"article.id.toString()\" \n\t\t       @submit=\"handleCommentSubmit\"\n\t\t       @update:reply-info=\"val => replyForItem = val\"\n\t\t     />\n\t\t   </view>\n\t   </view>\n      \n\n\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { websiteUrl, global, asyncGetUserInfo } from '../../common/config.js'\n\n\n\nconst article = ref({\n  title: '',\n  content: '',\n  banner: '',\n  created_at: 0\n})\n\nconst currentPage = ref(1)\nconst loading = ref(false)\nconst noMore = ref(false)\nconst replyComment = ref(null)\n\nconst commentListRef = ref(null)\nconst commentInputRef = ref(null)\nconst replyForItem = ref({})\n\n// 处理评论提交\nconst handleCommentSubmit = async ({ content, replyInfo, origin }) => {\n  if (!await checkLogin(true)) return\n  const requestData = {\n  \tcontent,\n  \torigin,\n  \ttarget_id: parseInt(article.value.id),\n  \ttype: 7,\n  \t...(replyInfo.id && {\n  \t\treply_id: replyInfo.id,\n  \t\treply_for: replyInfo.comment,\n  \t\treply_user_id: replyInfo.user_id,\n  \t\tparent_id: replyInfo.parent_id > 0  ? replyInfo.parent_id : replyInfo.id,\n  \t})\n  }\n  \n  try {\n    const { data } = await uni.request({\n      url: `${websiteUrl}/with-state/add-comment`,\n      method: 'POST',\n      header: { Authorization: uni.getStorageSync('token') },\n      data: requestData,\n    })\n\n    if (data.status === 'success') {\n      // 更新评论列表\n      if (data.data.parent_id === 0) {\n        commentListRef.value?.addNewComment(data.data)\n      } else {\n        commentListRef.value?.addReplyComment(data.data)\n      }\n      uni.showToast({ title: '评论成功' })\n    }\n  } catch (error) {\n    uni.showToast({ title: '评论失败', icon: 'none' })\n  }\n}\n\n// 处理回复事件\nconst handleReplyComment = ({ parent, target }) => {\n  const item = target || parent\n  replyForItem.value = item\n  commentInputRef.value?.focusInput()\n}\n\n\nonLoad(async (options) => {\n  if (!options.id) return uni.navigateBack()\n  asyncGetUserInfo()\n  await fetchArticle(options.id)\n})\n\n// 获取文章详情\nconst fetchArticle = async (id) => {\n  try {\n    const { data } = await uni.request({\n      url: `${websiteUrl}/article-detail?id=${id}`\n    })\n    if (data.status === 'success') {\n      article.value = data.data\n      uni.setNavigationBarTitle({ title: data.data.title })\n    }\n  } catch (error) {\n    uni.showToast({ title: '加载失败', icon: 'none' })\n  }\n}\n\n\n// 登录检查\nconst checkLogin = async (showToast = false) => {\n  if (global.isLogin) return true\n  if (showToast) {\n    uni.showToast({ title: '请先登录', icon: 'none' })\n  }\n  return false\n}\n\n// 时间格式化\nconst formatTime = (timestamp) => {\n  const date = new Date(timestamp * 1000)\n  return `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`\n}\n</script>\n\n<style lang=\"less\" scoped>\n.article-container {\n  background: #fff;\n  min-height: 100vh;\n  padding-bottom: 120rpx;\n\n  .banner {\n    width: 100%;\n    height: 420rpx;\n  }\n\n  .content-wrapper {\n    padding: 30rpx;\n\n    .title {\n      font-size: 36rpx;\n      font-weight: 600;\n      color: #333;\n      line-height: 1.4;\n      margin-bottom: 20rpx;\n    }\n\n    .content-html {\n      font-size: 28rpx;\n      line-height: 1.6;\n      color: #444;\n    }\n  }\n\n  .comment-section {\n    margin-top: 40rpx;\n    border-top: 1rpx solid #eee;\n\n    .section-title {\n      display: block;\n      padding: 30rpx 0;\n      font-size: 28rpx;\n      color: #666;\n    }\n\n    .comment-item {\n      display: flex;\n      padding: 20rpx 0;\n      border-bottom: 1rpx solid #f5f5f5;\n\n      .avatar {\n        width: 64rpx;\n        height: 64rpx;\n        border-radius: 50%;\n        margin-right: 20rpx;\n      }\n\n      .comment-main {\n        flex: 1;\n\n        .user-info {\n          display: flex;\n          align-items: center;\n          margin-bottom: 10rpx;\n\n          .username {\n            font-size: 22rpx;\n            color: #666;\n            margin-right: 20rpx;\n          }\n\n          .time {\n            font-size: 20rpx;\n            color: #999;\n          }\n        }\n\n        .comment-content {\n          font-size: 22rpx;\n          color: #333;\n          line-height: 1.4;\n        }\n\n        .comment-actions {\n          margin-top: 15rpx;\n\n          .reply-btn {\n            font-size: 20rpx;\n            color: #4cbbd0;\n            padding: 6rpx 12rpx;\n          }\n        }\n      }\n    }\n\n    .loading-status {\n      text-align: center;\n      padding: 30rpx;\n      color: #999;\n      font-size: 22rpx;\n    }\n  }\n\n  .comment-input-wrapper {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: #fff;\n    padding: 20rpx 30rpx;\n    display: flex;\n    align-items: center;\n    border-top: 1rpx solid #eee;\n\n    .input {\n      flex: 1;\n      height: 72rpx;\n      background: #f5f5f5;\n      border-radius: 36rpx;\n      padding: 0 30rpx;\n      font-size: 22rpx;\n    }\n\n    .submit-btn {\n      width: 120rpx;\n      text-align: center;\n      color: #4cbbd0;\n      font-size: 22rpx;\n      margin-left: 20rpx;\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/pages/article_detail/article_detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","websiteUrl","onLoad","asyncGetUserInfo","global"],"mappings":";;;;;;;;;;;;;;;;;;AAsDA,UAAM,UAAUA,cAAAA,IAAI;AAAA,MAClB,OAAO;AAAA,MACP,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,YAAY;AAAA,IACd,CAAC;AAEmBA,kBAAG,IAAC,CAAC;AACTA,kBAAG,IAAC,KAAK;AACVA,kBAAG,IAAC,KAAK;AACHA,kBAAG,IAAC,IAAI;AAE7B,UAAM,iBAAiBA,cAAG,IAAC,IAAI;AAC/B,UAAM,kBAAkBA,cAAG,IAAC,IAAI;AAChC,UAAM,eAAeA,cAAG,IAAC,EAAE;AAG3B,UAAM,sBAAsB,OAAO,EAAE,SAAS,WAAW,OAAM,MAAO;;AACpE,UAAI,CAAC,MAAM,WAAW,IAAI;AAAG;AAC7B,YAAM,cAAc;AAAA,QACnB;AAAA,QACA;AAAA,QACA,WAAW,SAAS,QAAQ,MAAM,EAAE;AAAA,QACpC,MAAM;AAAA,QACN,GAAI,UAAU,MAAM;AAAA,UACnB,UAAU,UAAU;AAAA,UACpB,WAAW,UAAU;AAAA,UACrB,eAAe,UAAU;AAAA,UACzB,WAAW,UAAU,YAAY,IAAK,UAAU,YAAY,UAAU;AAAA,QACtE;AAAA,MACD;AAED,UAAI;AACF,cAAM,EAAE,KAAI,IAAK,MAAMC,cAAAA,MAAI,QAAQ;AAAA,UACjC,KAAK,GAAGC,cAAU,UAAA;AAAA,UAClB,QAAQ;AAAA,UACR,QAAQ,EAAE,eAAeD,cAAG,MAAC,eAAe,OAAO,EAAG;AAAA,UACtD,MAAM;AAAA,QACZ,CAAK;AAED,YAAI,KAAK,WAAW,WAAW;AAE7B,cAAI,KAAK,KAAK,cAAc,GAAG;AAC7B,iCAAe,UAAf,mBAAsB,cAAc,KAAK;AAAA,UACjD,OAAa;AACL,iCAAe,UAAf,mBAAsB,gBAAgB,KAAK;AAAA,UAC5C;AACDA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAM,CAAE;AAAA,QAChC;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC9C;AAAA,IACH;AAGA,UAAM,qBAAqB,CAAC,EAAE,QAAQ,aAAa;;AACjD,YAAM,OAAO,UAAU;AACvB,mBAAa,QAAQ;AACrB,4BAAgB,UAAhB,mBAAuB;AAAA,IACzB;AAGAE,kBAAM,OAAC,OAAO,YAAY;AACxB,UAAI,CAAC,QAAQ;AAAI,eAAOF,cAAAA,MAAI,aAAc;AAC1CG,qCAAkB;AAClB,YAAM,aAAa,QAAQ,EAAE;AAAA,IAC/B,CAAC;AAGD,UAAM,eAAe,OAAO,OAAO;AACjC,UAAI;AACF,cAAM,EAAE,KAAI,IAAK,MAAMH,cAAAA,MAAI,QAAQ;AAAA,UACjC,KAAK,GAAGC,cAAAA,UAAU,sBAAsB,EAAE;AAAA,QAChD,CAAK;AACD,YAAI,KAAK,WAAW,WAAW;AAC7B,kBAAQ,QAAQ,KAAK;AACrBD,wBAAG,MAAC,sBAAsB,EAAE,OAAO,KAAK,KAAK,OAAO;AAAA,QACrD;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC9C;AAAA,IACH;AAIA,UAAM,aAAa,OAAO,YAAY,UAAU;AAC9C,UAAII,cAAM,OAAC;AAAS,eAAO;AAC3B,UAAI,WAAW;AACbJ,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC9C;AACD,aAAO;AAAA,IACT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChJA,GAAG,WAAW,eAAe;"}