{"version":3,"file":"my_comment.js","sources":["pages/my_comment/my_comment.vue","pages/my_comment/my_comment.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"page-container\">\n\t\t<view-logs />\r\n\t\t<!-- 列表区域 -->\r\n\t\t<scroll-view class=\"comment-list\" scroll-y @scrolltolower=\"loadMore\" :show-scrollbar=\"false\">\r\n\t\t\t<!-- 列表内容 -->\r\n\t\t\t<view v-for=\"(item, index) in commentList\" :key=\"index\" class=\"comment-item\"\r\n\t\t\t\t@click=\"navigateToTarget(item)\">\r\n\t\t\t\t<!-- 用户信息 -->\r\n\t\t\t\t<view class=\"user-info\">\r\n\t\t\t\t\t<image class=\"avatar\" :src=\"item.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\" />\r\n\t\t\t\t\t<view class=\"user-meta\">\r\n\t\t\t\t\t\t<text class=\"username\">{{item.username}}</text>\r\n\t\t\t\t\t\t<text class=\"time\">{{ formatTime(item.created_at) }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<!-- 回复内容 -->\r\n\t\t\t\t<view class=\"content-box\">\r\n\t\t\t\t\t<text class=\"content\">{{ item.comment }}</text>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<!-- 关联目标 -->\r\n\t\t\t\t<view class=\"target-box\" @click=\"navigateToTarget(item)\">\r\n\t\t\t\t\t<image class=\"target-image\" :src=\"item.target_image\" mode=\"aspectFill\" v-if=\"item.target_image\" />\r\n\t\t\t\t\t<view class=\"target-info\">\r\n\t\t\t\t\t\t<view class=\"type-tag\" :class=\"getTypeClass(item.type)\">\r\n\t\t\t\t\t\t\t{{ getTypeName(item.type) }}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"target-name\">{{ item.target_name }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 加载状态 -->\r\n\t\t\t<view class=\"loading-status\">\r\n\t\t\t\t<text v-if=\"loading\" class=\"loading-text\">加载中...</text>\r\n\t\t\t\t<text v-if=\"noMore\" class=\"no-more-text\">没有更多了</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue'\r\n\timport {\r\n\t\twebsiteUrl,\r\n\t\timage1Url\r\n\t} from '../../common/config.js'\r\n\r\n\t// 响应式数据\r\n\tconst commentList = ref([])\r\n\tconst currentPage = ref(1)\r\n\tconst pageSize = ref(10)\r\n\tconst total = ref(0)\r\n\tconst loading = ref(false)\r\n\tconst noMore = ref(false)\r\n\r\n\t// 类型映射\r\n\tconst commentTypes = {\r\n\t\t1: {\r\n\t\t\tname: '品牌',\r\n\t\t\tclass: 'brand'\r\n\t\t},\r\n\t\t2: {\r\n\t\t\tname: '商品',\r\n\t\t\tclass: 'goods'\r\n\t\t},\r\n\t\t3: {\r\n\t\t\tname: '搭配',\r\n\t\t\tclass: 'collocation'\r\n\t\t},\r\n\t\t4: {\r\n\t\t\tname: '资讯',\r\n\t\t\tclass: 'news'\r\n\t\t},\r\n\t\t5: {\r\n\t\t\tname: '树洞',\r\n\t\t\tclass: 'treehole'\r\n\t\t},\n\t\t6: {\n\t\t\tname: '展示柜',\n\t\t\tclass: 'collocation'\n\t\t},\n\t\t7: {\n\t\t\tname: '文章',\n\t\t\tclass: 'collocation'\n\t\t}\r\n\t}\r\n\r\n\t// 生命周期\r\n\tonMounted(() => {\r\n\t\tloadComments()\r\n\t})\r\n\r\n\t// 加载评论\r\n\tconst loadComments = async (isLoadMore = false) => {\r\n\t\tif (loading.value || noMore.value) return\r\n\r\n\t\tloading.value = true\r\n\t\ttry {\r\n\t\t\tconst res = await uni.request({\r\n\t\t\t\turl: `${websiteUrl}/with-state/my-comment`,\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\theader: {\r\n\t\t\t\t\t\"Authorization\": uni.getStorageSync('token')\r\n\t\t\t\t},\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tpage: currentPage.value,\r\n\t\t\t\t\tpage_size: pageSize.value\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tif (res.data.status === 'success') {\r\n\t\t\t\tconst data = res.data.data\r\n\t\t\t\tcommentList.value = isLoadMore ?\r\n\t\t\t\t\t[...commentList.value, ...data.comment_list] :\r\n\t\t\t\t\tdata.comment_list\r\n\r\n\t\t\t\ttotal.value = data.total\r\n\t\t\t\tcurrentPage.value++\r\n\t\t\t\tnoMore.value = commentList.value.length >= total.value\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tloading.value = false\r\n\t\t}\r\n\t}\r\n\r\n\t// 加载更多\r\n\tconst loadMore = () => {\r\n\t\tif (!noMore.value) loadComments(true)\r\n\t}\r\n\r\n\t// 跳转到页面\r\n\tconst navigateToTarget = (item) => {\r\n\t\tlet url = ''\r\n\t\tconst id = item.relation_id\n\r\n\r\n\t\t// 根据类型跳转不同页面（路径需要您根据实际路由补全）\r\n\t\tswitch (item.type) {\r\n\t\t\tcase 1: // BrandComment\r\n\t\t\t\turl = `/pages/brand/brand?brand_id=${id}` // 品牌详情页\r\n\t\t\t\tbreak\r\n\t\t\tcase 2: // GoodsComment\r\n\t\t\t\turl = `/pages/goods/goods?goods_id=${id}` // 商品详情页\r\n\t\t\t\tbreak\r\n\t\t\tcase 3: // CollocationComment\r\n\t\t\t\turl = `/pages/collocation_share/collocation_share?collocation_id=${id}&origin=1` // 搭配详情页\r\n\t\t\t\tbreak\r\n\t\t\tcase 4: // SaleNewsComment\r\n\t\t\t\turl = `/pages/sale_news/sale_news?id=${id}&brand_id=0` // 资讯详情页\r\n\t\t\t\tbreak\r\n\t\t\tcase 5: // TreeholeComment\r\n\t\t\t\turl = `/pages/treehole_detail/treehole_detail?id=${id}` // 树洞详情页\r\n\t\t\t\tbreak\n\t\t\tcase 6: // Showcase\n\t\t\t\turl = `/pages/collocation_share/collocation_share?collocation_id=${id}&origin=2` \n\t\t\t\tbreak\r\n\t\t\tdefault:\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '未知类型',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (url) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: url\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// 类型处理\r\n\tconst getTypeName = (type) => commentTypes[type]?.name || '未知'\r\n\tconst getTypeClass = (type) => commentTypes[type]?.class || ''\r\n\r\n\t// 文本截断\r\n\tconst truncate = (text, length) => {\r\n\t\treturn text.length > length ? text.substring(0, length) + '...' : text\r\n\t}\r\n\r\n\r\n\t//格式化时间戳\r\n\tfunction formatTime(timestamp) {\r\n\t\tconst date = new Date(timestamp * 1000);\r\n\t\tconst year = date.getFullYear();\r\n\t\tconst month = (date.getMonth() + 1).toString().padStart(2, '0'); // 月份从0开始，需要+1\r\n\t\tconst day = date.getDate().toString().padStart(2, '0');\r\n\t\tconst hours = date.getHours().toString().padStart(2, '0');\r\n\t\tconst minutes = date.getMinutes().toString().padStart(2, '0');\r\n\t\tconst seconds = date.getSeconds().toString().padStart(2, '0');\r\n\r\n\t\t// 返回格式化后的日期时间\r\n\t\treturn `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n\t}\n\t\n\t// 设置标题\n\tuni.setNavigationBarTitle({\n\t\ttitle: '我的评论'\n\t})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\t.page-container {\r\n\t\tpadding: 20rpx 30rpx;\r\n\t\tbackground-color: #f8f8f8;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\r\n\t.comment-list {\r\n\t\theight: calc(100vh - 40rpx);\r\n\t}\r\n\r\n\t.comment-item {\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tmargin-bottom: 24rpx;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n\t}\r\n\r\n\t.user-info {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t.avatar {\r\n\t\t\twidth: 64rpx;\r\n\t\t\theight: 64rpx;\r\n\t\t\tborder-radius: 50%;\r\n\t\t\tmargin-right: 20rpx;\r\n\t\t}\r\n\r\n\t\t.user-meta {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t}\r\n\r\n\t\t.username {\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #333;\r\n\t\t\tfont-weight: 500;\r\n\t\t\tmargin-bottom: 6rpx;\r\n\t\t\tmax-width: 400rpx;\r\n\t\t\t/* 根据设计调整 */\r\n\t\t\toverflow: hidden;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t\twhite-space: nowrap;\r\n\t\t}\r\n\r\n\t\t.time {\r\n\t\t\tfont-size: 20rpx;\r\n\t\t\tcolor: #999;\r\n\t\t}\r\n\t}\r\n\r\n\t.content-box {\r\n\t\tmargin-bottom: 24rpx;\r\n\r\n\t\t.content {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tline-height: 1.5;\r\n\t\t\tcolor: #333;\r\n\t\t}\r\n\t}\r\n\r\n\t.target-box {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 16rpx;\r\n\t\tbackground: #f5f5f5;\r\n\t\tborder-radius: 12rpx;\r\n\r\n\t\t.target-image {\r\n\t\t\twidth: 80rpx;\r\n\t\t\theight: 80rpx;\r\n\t\t\tborder-radius: 8rpx;\r\n\t\t\tmargin-right: 20rpx;\r\n\t\t}\r\n\r\n\t\t.target-info {\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: hidden;\r\n\t\t}\r\n\r\n\t\t.type-tag {\r\n\t\t\tdisplay: inline-block;\r\n\t\t\tpadding: 4rpx 12rpx;\r\n\t\t\tborder-radius: 6rpx;\r\n\t\t\tfont-size: 20rpx;\r\n\t\t\tmargin-bottom: 8rpx;\r\n\r\n\t\t\t&.brand {\r\n\t\t\t\tbackground: #ffeaea;\r\n\t\t\t\tcolor: #ff4444;\r\n\t\t\t}\r\n\r\n\t\t\t&.goods {\r\n\t\t\t\tbackground: #e8f4ff;\r\n\t\t\t\tcolor: #409eff;\r\n\t\t\t}\r\n\r\n\t\t\t&.collocation {\r\n\t\t\t\tbackground: #fff6e6;\r\n\t\t\t\tcolor: #ff9900;\r\n\t\t\t}\r\n\r\n\t\t\t&.news {\r\n\t\t\t\tbackground: #e6f8f0;\r\n\t\t\t\tcolor: #67c23a;\r\n\t\t\t}\r\n\r\n\t\t\t&.treehole {\r\n\t\t\t\tbackground: #f0e6ff;\r\n\t\t\t\tcolor: #9254de;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.target-name {\r\n\t\t\tmax-width: 400rpx;\r\n\t\t\t/* 根据设计调整 */\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #666;\r\n\t\t\tdisplay: block;\r\n\t\t\toverflow: hidden;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t\twhite-space: nowrap;\r\n\t\t}\r\n\t}\r\n\r\n\t.loading-status {\r\n\t\ttext-align: center;\r\n\t\tpadding: 30rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\r\n\t\t.loading-text {\r\n\t\t\t&::after {\r\n\t\t\t\tcontent: '...';\r\n\t\t\t\tanimation: loading 1s infinite;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t@keyframes loading {\r\n\t\t0% {\r\n\t\t\tcontent: '.';\r\n\t\t}\r\n\r\n\t\t33% {\r\n\t\t\tcontent: '..';\r\n\t\t}\r\n\r\n\t\t66% {\r\n\t\t\tcontent: '...';\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/pages/my_comment/my_comment.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","websiteUrl"],"mappings":";;;;;;;;;;;;;;AAsDC,UAAM,cAAcA,cAAG,IAAC,EAAE;AAC1B,UAAM,cAAcA,cAAG,IAAC,CAAC;AACzB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,QAAQA,cAAG,IAAC,CAAC;AACnB,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,SAASA,cAAG,IAAC,KAAK;AAGxB,UAAM,eAAe;AAAA,MACpB,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,MACD,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,MACD,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,MACD,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,MACD,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,MACD,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,MACD,GAAG;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,MACP;AAAA,IACD;AAGDC,kBAAAA,UAAU,MAAM;AACf,mBAAc;AAAA,IAChB,CAAE;AAGD,UAAM,eAAe,OAAO,aAAa,UAAU;AAClD,UAAI,QAAQ,SAAS,OAAO;AAAO;AAEnC,cAAQ,QAAQ;AAChB,UAAI;AACH,cAAM,MAAM,MAAMC,cAAG,MAAC,QAAQ;AAAA,UAC7B,KAAK,GAAGC,cAAU,UAAA;AAAA,UAClB,QAAQ;AAAA,UACR,QAAQ;AAAA,YACP,iBAAiBD,cAAAA,MAAI,eAAe,OAAO;AAAA,UAC3C;AAAA,UACD,MAAM;AAAA,YACL,MAAM,YAAY;AAAA,YAClB,WAAW,SAAS;AAAA,UACpB;AAAA,QACL,CAAI;AAED,YAAI,IAAI,KAAK,WAAW,WAAW;AAClC,gBAAM,OAAO,IAAI,KAAK;AACtB,sBAAY,QAAQ,aACnB,CAAC,GAAG,YAAY,OAAO,GAAG,KAAK,YAAY,IAC3C,KAAK;AAEN,gBAAM,QAAQ,KAAK;AACnB,sBAAY;AACZ,iBAAO,QAAQ,YAAY,MAAM,UAAU,MAAM;AAAA,QACjD;AAAA,MACJ,UAAY;AACT,gBAAQ,QAAQ;AAAA,MAChB;AAAA,IACD;AAGD,UAAM,WAAW,MAAM;AACtB,UAAI,CAAC,OAAO;AAAO,qBAAa,IAAI;AAAA,IACpC;AAGD,UAAM,mBAAmB,CAAC,SAAS;AAClC,UAAI,MAAM;AACV,YAAM,KAAK,KAAK;AAIhB,cAAQ,KAAK,MAAI;AAAA,QAChB,KAAK;AACJ,gBAAM,+BAA+B,EAAE;AACvC;AAAA,QACD,KAAK;AACJ,gBAAM,+BAA+B,EAAE;AACvC;AAAA,QACD,KAAK;AACJ,gBAAM,6DAA6D,EAAE;AACrE;AAAA,QACD,KAAK;AACJ,gBAAM,iCAAiC,EAAE;AACzC;AAAA,QACD,KAAK;AACJ,gBAAM,6CAA6C,EAAE;AACrD;AAAA,QACD,KAAK;AACJ,gBAAM,6DAA6D,EAAE;AACrE;AAAA,QACD;AACCA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACX,CAAK;AACD;AAAA,MACD;AAED,UAAI,KAAK;AACRA,sBAAAA,MAAI,WAAW;AAAA,UACd;AAAA,QACJ,CAAI;AAAA,MACD;AAAA,IACD;AAID,UAAM,cAAc,CAAC,SAAI;;AAAK,iCAAa,IAAI,MAAjB,mBAAoB,SAAQ;AAAA;AAC1D,UAAM,eAAe,CAAC,SAAI;;AAAK,iCAAa,IAAI,MAAjB,mBAAoB,UAAS;AAAA;AAS5D,aAAS,WAAW,WAAW;AAC9B,YAAM,OAAO,IAAI,KAAK,YAAY,GAAI;AACtC,YAAM,OAAO,KAAK;AAClB,YAAM,SAAS,KAAK,aAAa,GAAG,SAAQ,EAAG,SAAS,GAAG,GAAG;AAC9D,YAAM,MAAM,KAAK,QAAS,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACrD,YAAM,QAAQ,KAAK,SAAU,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACxD,YAAM,UAAU,KAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AAC5D,YAAM,UAAU,KAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AAG5D,aAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK,IAAI,OAAO,IAAI,OAAO;AAAA,IAC7D;AAGDA,kBAAAA,MAAI,sBAAsB;AAAA,MACzB,OAAO;AAAA,IACT,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5MF,GAAG,WAAW,eAAe;"}