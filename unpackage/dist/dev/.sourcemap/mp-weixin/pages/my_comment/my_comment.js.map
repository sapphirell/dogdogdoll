{"version":3,"file":"my_comment.js","sources":["pages/my_comment/my_comment.vue","pages/my_comment/my_comment.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"page-container\">\n\t\t<view-logs />\n\t\t<!-- 列表区域 -->\n\t\t<scroll-view class=\"comment-list\" scroll-y @scrolltolower=\"loadMore\" :show-scrollbar=\"false\">\n\t\t\t<!-- 列表内容 -->\n\t\t\t<view v-for=\"(item, index) in commentList\" :key=\"index\" class=\"comment-item\"\n\t\t\t\t@click=\"navigateToTarget(item)\">\n\t\t\t\t<!-- 用户信息 -->\n\t\t\t\t<view class=\"user-info\">\n\t\t\t\t\t<image class=\"avatar\" :src=\"item.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\" />\n\t\t\t\t\t<view class=\"user-meta\">\n\t\t\t\t\t\t<text class=\"username\">{{item.username}}</text>\n\t\t\t\t\t\t<text class=\"time\">{{ formatTime(item.created_at) }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 回复内容 -->\n\t\t\t\t<view class=\"content-box\">\n\t\t\t\t\t<text class=\"content\">{{ item.comment }}</text>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 关联目标 -->\n\t\t\t\t<view class=\"target-box\" @click=\"navigateToTarget(item)\">\n\t\t\t\t\t<image class=\"target-image\" :src=\"item.target_image\" mode=\"aspectFill\" v-if=\"item.target_image\" />\n\t\t\t\t\t<view class=\"target-info\">\n\t\t\t\t\t\t<view class=\"type-tag\" :class=\"getTypeClass(item.type)\">\n\t\t\t\t\t\t\t{{ getTypeName(item.type) }}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"target-name\">{{ item.target_name }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 加载状态 -->\n\t\t\t<view class=\"loading-status\">\n\t\t\t\t<text v-if=\"loading\" class=\"loading-text\">加载中...</text>\n\t\t\t\t<text v-if=\"noMore\" class=\"no-more-text\">没有更多了</text>\n\t\t\t</view>\n\t\t</scroll-view>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tonMounted\n\t} from 'vue'\n\timport {\n\t\twebsiteUrl,\n\t\timage1Url\n\t} from '../../common/config.js'\n\n\t// 响应式数据\n\tconst commentList = ref([])\n\tconst currentPage = ref(1)\n\tconst pageSize = ref(10)\n\tconst total = ref(0)\n\tconst loading = ref(false)\n\tconst noMore = ref(false)\n\n\t// 类型映射\n\tconst commentTypes = {\n\t\t1: {\n\t\t\tname: '品牌',\n\t\t\tclass: 'brand'\n\t\t},\n\t\t2: {\n\t\t\tname: '商品',\n\t\t\tclass: 'goods'\n\t\t},\n\t\t3: {\n\t\t\tname: '搭配',\n\t\t\tclass: 'collocation'\n\t\t},\n\t\t4: {\n\t\t\tname: '资讯',\n\t\t\tclass: 'news'\n\t\t},\n\t\t5: {\n\t\t\tname: '树洞',\n\t\t\tclass: 'treehole'\n\t\t},\n\t\t6: {\n\t\t\tname: '展示柜',\n\t\t\tclass: 'collocation'\n\t\t},\n\t\t7: {\n\t\t\tname: '文章',\n\t\t\tclass: 'collocation'\n\t\t}\n\t}\n\n\t// 生命周期\n\tonMounted(() => {\n\t\tloadComments()\n\t})\n\n\t// 加载评论\n\tconst loadComments = async (isLoadMore = false) => {\n\t\tif (loading.value || noMore.value) return\n\n\t\tloading.value = true\n\t\ttry {\n\t\t\tconst res = await uni.request({\n\t\t\t\turl: `${websiteUrl.value}/with-state/my-comment`,\n\t\t\t\tmethod: 'GET',\n\t\t\t\theader: {\n\t\t\t\t\t\"Authorization\": uni.getStorageSync('token')\n\t\t\t\t},\n\t\t\t\tdata: {\n\t\t\t\t\tpage: currentPage.value,\n\t\t\t\t\tpage_size: pageSize.value\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tif (res.data.status === 'success') {\n\t\t\t\tconst data = res.data.data\n\t\t\t\tcommentList.value = isLoadMore ?\n\t\t\t\t\t[...commentList.value, ...data.comment_list] :\n\t\t\t\t\tdata.comment_list\n\n\t\t\t\ttotal.value = data.total\n\t\t\t\tcurrentPage.value++\n\t\t\t\tnoMore.value = commentList.value.length >= total.value\n\t\t\t}\n\t\t} finally {\n\t\t\tloading.value = false\n\t\t}\n\t}\n\n\t// 加载更多\n\tconst loadMore = () => {\n\t\tif (!noMore.value) loadComments(true)\n\t}\n\n\t// 跳转到页面\n\tconst navigateToTarget = (item) => {\n\t\tlet url = ''\n\t\tconst id = item.relation_id\n\n\n\t\t// 根据类型跳转不同页面（路径需要您根据实际路由补全）\n\t\tswitch (item.type) {\n\t\t\tcase 1: // BrandComment\n\t\t\t\turl = `/pages/brand/brand?brand_id=${id}` // 品牌详情页\n\t\t\t\tbreak\n\t\t\tcase 2: // GoodsComment\n\t\t\t\turl = `/pages/goods/goods?goods_id=${id}` // 商品详情页\n\t\t\t\tbreak\n\t\t\tcase 3: // CollocationComment\n\t\t\t\turl = `/pages/collocation_share/collocation_share?collocation_id=${id}&origin=1` // 搭配详情页\n\t\t\t\tbreak\n\t\t\tcase 4: // SaleNewsComment\n\t\t\t\turl = `/pages/sale_news/sale_news?id=${id}&brand_id=0` // 资讯详情页\n\t\t\t\tbreak\n\t\t\tcase 5: // TreeholeComment\n\t\t\t\turl = `/pages/treehole_detail/treehole_detail?id=${id}` // 树洞详情页\n\t\t\t\tbreak\n\t\t\tcase 6: // Showcase\n\t\t\t\turl = `/pages/collocation_share/collocation_share?collocation_id=${id}&origin=2` \n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '未知类型',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn\n\t\t}\n\n\t\tif (url) {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: url\n\t\t\t})\n\t\t}\n\t}\n\n\n\t// 类型处理\n\tconst getTypeName = (type) => commentTypes[type]?.name || '未知'\n\tconst getTypeClass = (type) => commentTypes[type]?.class || ''\n\n\t// 文本截断\n\tconst truncate = (text, length) => {\n\t\treturn text.length > length ? text.substring(0, length) + '...' : text\n\t}\n\n\n\t//格式化时间戳\n\tfunction formatTime(timestamp) {\n\t\tconst date = new Date(timestamp * 1000);\n\t\tconst year = date.getFullYear();\n\t\tconst month = (date.getMonth() + 1).toString().padStart(2, '0'); // 月份从0开始，需要+1\n\t\tconst day = date.getDate().toString().padStart(2, '0');\n\t\tconst hours = date.getHours().toString().padStart(2, '0');\n\t\tconst minutes = date.getMinutes().toString().padStart(2, '0');\n\t\tconst seconds = date.getSeconds().toString().padStart(2, '0');\n\n\t\t// 返回格式化后的日期时间\n\t\treturn `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n\t}\n\t\n\t// 设置标题\n\tuni.setNavigationBarTitle({\n\t\ttitle: '我的评论'\n\t})\n</script>\n\n<style lang=\"less\" scoped>\n\t.page-container {\n\t\tpadding: 20rpx 30rpx;\n\t\tbackground-color: #f8f8f8;\n\t\tmin-height: 100vh;\n\t}\n\n\t.comment-list {\n\t\theight: calc(100vh - 40rpx);\n\t}\n\n\t.comment-item {\n\t\tbackground: #fff;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 24rpx;\n\t\tmargin-bottom: 24rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n\t}\n\n\t.user-info {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tmargin-bottom: 20rpx;\n\n\t\t.avatar {\n\t\t\twidth: 64rpx;\n\t\t\theight: 64rpx;\n\t\t\tborder-radius: 50%;\n\t\t\tmargin-right: 20rpx;\n\t\t}\n\n\t\t.user-meta {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t}\n\n\t\t.username {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #333;\n\t\t\tfont-weight: 500;\n\t\t\tmargin-bottom: 6rpx;\n\t\t\tmax-width: 400rpx;\n\t\t\t/* 根据设计调整 */\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t\twhite-space: nowrap;\n\t\t}\n\n\t\t.time {\n\t\t\tfont-size: 20rpx;\n\t\t\tcolor: #999;\n\t\t}\n\t}\n\n\t.content-box {\n\t\tmargin-bottom: 24rpx;\n\n\t\t.content {\n\t\t\tfont-size: 28rpx;\n\t\t\tline-height: 1.5;\n\t\t\tcolor: #333;\n\t\t}\n\t}\n\n\t.target-box {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 16rpx;\n\t\tbackground: #f5f5f5;\n\t\tborder-radius: 12rpx;\n\n\t\t.target-image {\n\t\t\twidth: 80rpx;\n\t\t\theight: 80rpx;\n\t\t\tborder-radius: 8rpx;\n\t\t\tmargin-right: 20rpx;\n\t\t}\n\n\t\t.target-info {\n\t\t\tflex: 1;\n\t\t\toverflow: hidden;\n\t\t}\n\n\t\t.type-tag {\n\t\t\tdisplay: inline-block;\n\t\t\tpadding: 4rpx 12rpx;\n\t\t\tborder-radius: 6rpx;\n\t\t\tfont-size: 20rpx;\n\t\t\tmargin-bottom: 8rpx;\n\n\t\t\t&.brand {\n\t\t\t\tbackground: #ffeaea;\n\t\t\t\tcolor: #ff4444;\n\t\t\t}\n\n\t\t\t&.goods {\n\t\t\t\tbackground: #e8f4ff;\n\t\t\t\tcolor: #409eff;\n\t\t\t}\n\n\t\t\t&.collocation {\n\t\t\t\tbackground: #fff6e6;\n\t\t\t\tcolor: #ff9900;\n\t\t\t}\n\n\t\t\t&.news {\n\t\t\t\tbackground: #e6f8f0;\n\t\t\t\tcolor: #67c23a;\n\t\t\t}\n\n\t\t\t&.treehole {\n\t\t\t\tbackground: #f0e6ff;\n\t\t\t\tcolor: #9254de;\n\t\t\t}\n\t\t}\n\n\t\t.target-name {\n\t\t\tmax-width: 400rpx;\n\t\t\t/* 根据设计调整 */\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #666;\n\t\t\tdisplay: block;\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t\twhite-space: nowrap;\n\t\t}\n\t}\n\n\t.loading-status {\n\t\ttext-align: center;\n\t\tpadding: 30rpx;\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\n\t\t.loading-text {\n\t\t\t&::after {\n\t\t\t\tcontent: '...';\n\t\t\t\tanimation: loading 1s infinite;\n\t\t\t}\n\t\t}\n\t}\n\n\t@keyframes loading {\n\t\t0% {\n\t\t\tcontent: '.';\n\t\t}\n\n\t\t33% {\n\t\t\tcontent: '..';\n\t\t}\n\n\t\t66% {\n\t\t\tcontent: '...';\n\t\t}\n\t}\n</style>","import MiniProgramPage from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/pages/my_comment/my_comment.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","websiteUrl"],"mappings":"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"}