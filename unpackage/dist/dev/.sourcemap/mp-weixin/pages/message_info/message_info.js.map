{"version":3,"file":"message_info.js","sources":["pages/message_info/message_info.vue","pages/message_info/message_info.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n\t  <view-logs />\n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"loading-wrapper\">\n      <uni-load-more status=\"loading\"></uni-load-more>\n    </view>\n\n    <!-- 错误提示 -->\n    <view v-else-if=\"error\" class=\"error-wrapper\">\n      <uni-icons type=\"info\" size=\"24\" color=\"#ff4d4f\"></uni-icons>\n      <text class=\"error-text\">{{ error }}</text>\n      <button class=\"retry-btn\" @tap=\"fetchMessageDetail\">重试</button>\n    </view>\n\n    <!-- 内容区域 -->\n    <scroll-view v-else class=\"content-wrapper\" scroll-y>\n      <!-- 封面图 -->\n      <image \n        class=\"cover-image\" \n        :src=\"messageDetail.cover_image\" \n        mode=\"widthFix\" \n        lazy-load\n      />\n\n      <view class=\"main-content\">\n        <!-- 标题和时间 -->\n        <view class=\"header\">\n          <text class=\"title\">{{ messageDetail.title }}</text>\n          <text class=\"time\">{{ formatTime(messageDetail.created_at) }}</text>\n        </view>\n\n        <!-- 消息正文 -->\n        <view class=\"message-content\">\n          <text class=\"message-text\">{{ messageDetail.msg }}</text>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { websiteUrl, asyncGetUserInfo } from '../../common/config.js';\n\nconst props = defineProps([\"message_id\"])\nconst messageDetail = ref(null);\nconst loading = ref(true);\nconst error = ref('');\nconst messageId = ref('');\n\n// // 获取路由参数\n// const getQueryParams = () => {\n//   const pages = getCurrentPages();\n//   const currentPage = pages[pages.length - 1];\n//   messageId.value = currentPage.$page.options?.id || '';\n// };\n\n// 获取消息详情\nconst fetchMessageDetail = async () => {\n  try {\n    loading.value = true;\n    error.value = '';\n    \n    // 验证必要参数\n    if (!messageId.value) {\n      error.value = '无效的消息ID';\n      return;\n    }\n\n    // 验证用户登录状态\n    const userInfo = await asyncGetUserInfo();\n    if (!userInfo) {\n      error.value = '请先登录';\n      return;\n    }\n\n    const res = await uni.request({\n      url: `${websiteUrl.value}/with-state/message-detail`,\n      method: 'GET',\n      data: { id: messageId.value },\n      header: { Authorization: uni.getStorageSync('token') }\n    });\n\n    if (res.data.status === 'success') {\n      messageDetail.value = res.data.data;\n      // 通知列表页更新已读状态\n      uni.$emit('message-status-update', { \n        id: messageId.value,\n        is_read: 1\n      });\n    } else {\n      error.value = res.data.msg || '获取详情失败';\n    }\n  } catch (err) {\n    error.value = '请求失败，请检查网络';\n    console.error('详情请求失败:', err);\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 时间格式化\nconst formatTime = (timestamp) => {\n  const date = new Date(timestamp * 1000);\n  return date.toLocaleDateString('zh-CN', { \n    year: 'numeric',\n    month: '2-digit', \n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit'\n  }).replace(/\\//g, '-');\n};\n\nonMounted(() => {\n\tuni.setNavigationBarTitle({\n\t\ttitle: \"消息详情\"\n\t})\n  messageId.value = props.message_id\n  fetchMessageDetail();\n});\n</script>\n\n<style lang=\"less\">\n@primary-color: #2a6af4;\n@error-color: #ff4d4f;\n\n.container {\n  background: #f5f6f7;\n  min-height: 100vh;\n}\n\n.loading-wrapper {\n  padding: 40rpx 0;\n  display: flex;\n  justify-content: center;\n}\n\n.error-wrapper {\n  padding: 80rpx 40rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  \n  .error-text {\n    font-size: 28rpx;\n    color: @error-color;\n    margin: 20rpx 0;\n  }\n  \n  .retry-btn {\n    width: 200rpx;\n    height: 70rpx;\n    line-height: 70rpx;\n    background: @primary-color;\n    color: white;\n    font-size: 28rpx;\n    border-radius: 8rpx;\n    margin-top: 20rpx;\n  }\n}\n\n.content-wrapper {\n  padding: 30rpx;\n  box-sizing: border-box;\n\n  .cover-image {\n    width: 100%;\n    border-radius: 16rpx;\n    margin-bottom: 30rpx;\n    background: #f0f0f0;\n    min-height: 300rpx;\n  }\n\n  .main-content {\n    background: white;\n    border-radius: 16rpx;\n    padding: 32rpx;\n    box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.04);\n\n    .header {\n      margin-bottom: 32rpx;\n\n      .title {\n        font-size: 36rpx;\n        font-weight: 600;\n        color: #333;\n        line-height: 1.4;\n        margin-bottom: 16rpx;\n      }\n\n      .time {\n        font-size: 24rpx;\n        color: #999;\n        display: block;\n      }\n    }\n\n    .message-content {\n      .message-text {\n        font-size: 30rpx;\n        line-height: 1.6;\n        color: #666;\n        white-space: pre-wrap;\n      }\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/sapphirell/Documents/git/dogdogdoll-uniapp/pages/message_info/message_info.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","asyncGetUserInfo","uni","websiteUrl","onMounted","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;AA6CA,UAAM,QAAQ;AACd,UAAM,gBAAgBA,cAAAA,IAAI,IAAI;AAC9B,UAAM,UAAUA,cAAAA,IAAI,IAAI;AACxB,UAAM,QAAQA,cAAAA,IAAI,EAAE;AACpB,UAAM,YAAYA,cAAAA,IAAI,EAAE;AAUxB,UAAM,qBAAqB,YAAY;AACrC,UAAI;AACF,gBAAQ,QAAQ;AAChB,cAAM,QAAQ;AAGd,YAAI,CAAC,UAAU,OAAO;AACpB,gBAAM,QAAQ;AACd;AAAA,QACD;AAGD,cAAM,WAAW,MAAMC,cAAAA;AACvB,YAAI,CAAC,UAAU;AACb,gBAAM,QAAQ;AACd;AAAA,QACD;AAED,cAAM,MAAM,MAAMC,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK,GAAGC,yBAAW,KAAK;AAAA,UACxB,QAAQ;AAAA,UACR,MAAM,EAAE,IAAI,UAAU,MAAO;AAAA,UAC7B,QAAQ,EAAE,eAAeD,cAAG,MAAC,eAAe,OAAO,EAAG;AAAA,QAC5D,CAAK;AAED,YAAI,IAAI,KAAK,WAAW,WAAW;AACjC,wBAAc,QAAQ,IAAI,KAAK;AAE/BA,wBAAG,MAAC,MAAM,yBAAyB;AAAA,YACjC,IAAI,UAAU;AAAA,YACd,SAAS;AAAA,UACjB,CAAO;AAAA,QACP,OAAW;AACL,gBAAM,QAAQ,IAAI,KAAK,OAAO;AAAA,QAC/B;AAAA,MACF,SAAQ,KAAK;AACZ,cAAM,QAAQ;AACdA,wFAAc,WAAW,GAAG;AAAA,MAChC,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,aAAa,CAAC,cAAc;AAChC,YAAM,OAAO,IAAI,KAAK,YAAY,GAAI;AACtC,aAAO,KAAK,mBAAmB,SAAS;AAAA,QACtC,MAAM;AAAA,QACN,OAAO;AAAA,QACP,KAAK;AAAA,QACL,MAAM;AAAA,QACN,QAAQ;AAAA,MACT,CAAA,EAAE,QAAQ,OAAO,GAAG;AAAA,IACvB;AAEAE,kBAAAA,UAAU,MAAM;AACfF,oBAAAA,MAAI,sBAAsB;AAAA,QACzB,OAAO;AAAA,MACT,CAAE;AACA,gBAAU,QAAQ,MAAM;AACxB;IACF,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvHD,GAAG,WAAWG,SAAe;"}